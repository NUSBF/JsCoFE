(function(){var n,s,l,a,c,e,t,i=function(){return this}();i||"undefined"==typeof window||(i=window),"undefined"==typeof requirejs&&((n=function(e,t,i){"string"!=typeof e?n.original?n.original.apply(this,arguments):(console.error("dropping module because define wasn't a string."),console.trace()):(2==arguments.length&&(i=t),n.modules[e]||(n.payloads[e]=i,n.modules[e]=null))}).modules={},n.payloads={},s=function(e,t,i){if("string"==typeof t){var o=c(e,t);if(null!=o)return i&&i(),o}else if("[object Array]"===Object.prototype.toString.call(t)){for(var n=[],s=0,a=t.length;s<a;++s){var r=c(e,t[s]);if(null==r&&l.original)return;n.push(r)}return i&&i.apply(null,n)||!0}},l=function(e,t){var i=s("",e,t);return null==i&&l.original?l.original.apply(this,arguments):i},a=function(e,t){var i;if(-1!==t.indexOf("!"))return i=t.split("!"),a(e,i[0])+"!"+a(e,i[1]);if("."==t.charAt(0))for(t=e.split("/").slice(0,-1).join("/")+"/"+t;-1!==t.indexOf(".")&&o!=t;){var o=t;t=t.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}return t},c=function(e,i){i=a(e,i);var t,o,e=n.modules[i];return e||("function"==typeof(e=n.payloads[i])&&(t={id:i,uri:"",exports:o={},packaged:!0},o=e(function(e,t){return s(i,e,t)},o,t)||t.exports,n.modules[i]=o,delete n.payloads[i]),e=n.modules[i]=o||e),e},t=i,(e="")&&(i[e]||(i[e]={}),t=i[e]),t.define&&t.define.packaged||(n.original=t.define,t.define=n,t.define.packaged=!0),t.require&&t.require.packaged||(l.original=t.require,t.require=l,t.require.packaged=!0))})(),define("ace/lib/es6-shim",["require","exports","module"],function(e,t,i){function o(e,t,i){Object.defineProperty(e,t,{value:i,enumerable:!1,writable:!0,configurable:!0})}String.prototype.startsWith||o(String.prototype,"startsWith",function(e,t){return this.lastIndexOf(e,t=t||0)===t}),String.prototype.endsWith||o(String.prototype,"endsWith",function(e,t){(void 0===t||t>this.length)&&(t=this.length),t-=e.length;e=this.indexOf(e,t);return-1!==e&&e===t}),String.prototype.repeat||o(String.prototype,"repeat",function(e){for(var t="",i=this;0<e;)1&e&&(t+=i),(e>>=1)&&(i+=i);return t}),String.prototype.includes||o(String.prototype,"includes",function(e,t){return-1!=this.indexOf(e,t)}),Object.assign||(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var o=arguments[i];null!=o&&Object.keys(o).forEach(function(e){t[e]=o[e]})}return t}),Object.values||(Object.values=function(t){return Object.keys(t).map(function(e){return t[e]})}),Array.prototype.find||o(Array.prototype,"find",function(e){for(var t=this.length,i=arguments[1],o=0;o<t;o++){var n=this[o];if(e.call(i,n,o,this))return n}}),Array.prototype.findIndex||o(Array.prototype,"findIndex",function(e){for(var t=this.length,i=arguments[1],o=0;o<t;o++){var n=this[o];if(e.call(i,n,o,this))return o}}),Array.prototype.includes||o(Array.prototype,"includes",function(e,t){return-1!=this.indexOf(e,t)}),Array.prototype.fill||o(Array.prototype,"fill",function(e){for(var t=this.length>>>0,i=arguments[1]>>0,o=i<0?Math.max(t+i,0):Math.min(i,t),i=arguments[2],i=void 0===i?t:i>>0,n=i<0?Math.max(t+i,0):Math.min(i,t);o<n;)this[o]=e,o++;return this}),Array.of||o(Array,"of",function(){return Array.prototype.slice.call(arguments)})}),define("ace/lib/fixoldbrowsers",["require","exports","module","ace/lib/es6-shim"],function(e,t,i){"use strict";e("./es6-shim")}),define("ace/lib/lang",["require","exports","module"],function(e,t,i){"use strict";t.last=function(e){return e[e.length-1]},t.stringReverse=function(e){return e.split("").reverse().join("")},t.stringRepeat=function(e,t){for(var i="";0<t;)1&t&&(i+=e),(t>>=1)&&(e+=e);return i};var o=/^\s\s*/,n=/\s\s*$/;t.stringTrimLeft=function(e){return e.replace(o,"")},t.stringTrimRight=function(e){return e.replace(n,"")},t.copyObject=function(e){var t,i={};for(t in e)i[t]=e[t];return i},t.copyArray=function(e){for(var t=[],i=0,o=e.length;i<o;i++)e[i]&&"object"==typeof e[i]?t[i]=this.copyObject(e[i]):t[i]=e[i];return t},t.deepCopy=function e(t){if("object"!=typeof t||!t)return t;if(Array.isArray(t))for(var i=[],o=0;o<t.length;o++)i[o]=e(t[o]);else{if("[object Object]"!==Object.prototype.toString.call(t))return t;for(var o in i={},t)i[o]=e(t[o])}return i},t.arrayToMap=function(e){for(var t={},i=0;i<e.length;i++)t[e[i]]=1;return t},t.createMap=function(e){var t,i=Object.create(null);for(t in e)i[t]=e[t];return i},t.arrayRemove=function(e,t){for(var i=0;i<=e.length;i++)t===e[i]&&e.splice(i,1)},t.escapeRegExp=function(e){return e.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},t.escapeHTML=function(e){return(""+e).replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")},t.getMatchOffsets=function(e,t){var i=[];return e.replace(t,function(e){i.push({offset:arguments[arguments.length-2],length:e.length})}),i},t.deferredCall=function(e){function t(){o=null,e()}function i(e){return i.cancel(),o=setTimeout(t,e||0),i}var o=null;return(i.schedule=i).call=function(){return this.cancel(),e(),i},i.cancel=function(){return clearTimeout(o),o=null,i},i.isPending=function(){return o},i},t.delayedCall=function(e,t){function i(){n=null,e()}function o(e){null==n&&(n=setTimeout(i,e||t))}var n=null;return o.delay=function(e){n&&clearTimeout(n),n=setTimeout(i,e||t)},(o.schedule=o).call=function(){this.cancel(),e()},o.cancel=function(){n&&clearTimeout(n),n=null},o.isPending=function(){return n},o}}),define("ace/lib/oop",["require","exports","module"],function(e,i,t){"use strict";i.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},i.mixin=function(e,t){for(var i in t)e[i]=t[i];return e},i.implement=function(e,t){i.mixin(e,t)}}),define("ace/lib/useragent",["require","exports","module"],function(e,t,i){"use strict";t.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"},t.getOS=function(){return t.isMac?t.OS.MAC:t.isLinux?t.OS.LINUX:t.OS.WINDOWS};var o="object"==typeof navigator?navigator:{},n=(/mac|win|linux/i.exec(o.platform)||["other"])[0].toLowerCase(),s=o.userAgent||"",o=o.appName||"";t.isWin="win"==n,t.isMac="mac"==n,t.isLinux="linux"==n,t.isIE="Microsoft Internet Explorer"==o||0<=o.indexOf("MSAppHost")?parseFloat((s.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]):parseFloat((s.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]),t.isOldIE=t.isIE&&t.isIE<9,t.isGecko=t.isMozilla=s.match(/ Gecko\/\d+/),t.isOpera="object"==typeof opera&&"[object Opera]"==Object.prototype.toString.call(window.opera),t.isWebKit=parseFloat(s.split("WebKit/")[1])||void 0,t.isChrome=parseFloat(s.split(" Chrome/")[1])||void 0,t.isEdge=parseFloat(s.split(" Edge/")[1])||void 0,t.isAIR=0<=s.indexOf("AdobeAIR"),t.isAndroid=0<=s.indexOf("Android"),t.isChromeOS=0<=s.indexOf(" CrOS "),t.isIOS=/iPad|iPhone|iPod/.test(s)&&!window.MSStream,t.isIOS&&(t.isMac=!0),t.isMobile=t.isIOS||t.isAndroid}),define("ace/lib/dom",["require","exports","module","ace/lib/useragent"],function(e,s,t){"use strict";function a(){var e=l;l=null,e&&e.forEach(function(e){i(e[0],e[1])})}function i(e,t,i){if("undefined"!=typeof document){if(l)if(i)a();else if(!1===i)return l.push([e,t]);if(!r){var o=i,i=(o=i&&i.getRootNode&&(o=i.getRootNode())&&o!=i?o:document).ownerDocument||o;if(t&&s.hasCssString(t,o))return null;t&&(e+="\n/*# sourceURL=ace/css/"+t+" */");var n=s.createElement("style");n.appendChild(i.createTextNode(e)),t&&(n.id=t),(o=o==i?s.getDocumentHead(i):o).insertBefore(n,o.firstChild)}}}e=e("./useragent");s.buildDom=function e(t,i,o){if("string"==typeof t&&t)return c=document.createTextNode(t),i&&i.appendChild(c),c;if(!Array.isArray(t))return t&&t.appendChild&&i&&i.appendChild(t),t;if("string"!=typeof t[0]||!t[0]){for(var n=[],s=0;s<t.length;s++){var a=e(t[s],i,o);a&&n.push(a)}return n}for(var r=document.createElement(t[0]),l=t[1],c=1,s=c=l&&"object"==typeof l&&!Array.isArray(l)?2:c;s<t.length;s++)e(t[s],r,o);return 2==c&&Object.keys(l).forEach(function(e){var t=l[e];"class"===e?r.className=Array.isArray(t)?t.join(" "):t:"function"==typeof t||"value"==e||"$"==e[0]?r[e]=t:"ref"===e?o&&(o[t]=r):"style"===e?"string"==typeof t&&(r.style.cssText=t):null!=t&&r.setAttribute(e,t)}),i&&i.appendChild(r),r},s.getDocumentHead=function(e){return(e=e||document).head||e.getElementsByTagName("head")[0]||e.documentElement},s.createElement=function(e,t){return document.createElementNS?document.createElementNS(t||"http://www.w3.org/1999/xhtml",e):document.createElement(e)},s.removeChildren=function(e){e.innerHTML=""},s.createTextNode=function(e,t){return(t?t.ownerDocument:document).createTextNode(e)},s.createFragment=function(e){return(e?e.ownerDocument:document).createDocumentFragment()},s.hasCssClass=function(e,t){return-1!==(e.className+"").split(/\s+/g).indexOf(t)},s.addCssClass=function(e,t){s.hasCssClass(e,t)||(e.className+=" "+t)},s.removeCssClass=function(e,t){for(var i=e.className.split(/\s+/g);;){var o=i.indexOf(t);if(-1==o)break;i.splice(o,1)}e.className=i.join(" ")},s.toggleCssClass=function(e,t){for(var i=e.className.split(/\s+/g),o=!0;;){var n=i.indexOf(t);if(-1==n)break;o=!1,i.splice(n,1)}return o&&i.push(t),e.className=i.join(" "),o},s.setCssClass=function(e,t,i){i?s.addCssClass(e,t):s.removeCssClass(e,t)},s.hasCssString=function(e,t){var i,o=0;if(i=(t=t||document).querySelectorAll("style"))for(;o<i.length;)if(i[o++].id===e)return!0},s.removeElementById=function(e,t){(t=t||document).getElementById(e)&&t.getElementById(e).remove()};var r,o,l=[];s.useStrictCSP=function(e){0==(r=e)?a():l=l||[]},s.importCssString=i,s.importCssStylsheet=function(e,t){s.buildDom(["link",{rel:"stylesheet",href:e}],s.getDocumentHead(t))},s.scrollbarWidth=function(e){var t=s.createElement("ace_inner"),i=(t.style.width="100%",t.style.minWidth="0px",t.style.height="200px",t.style.display="block",s.createElement("ace_outer")),o=i.style,e=(o.position="absolute",o.left="-10000px",o.overflow="hidden",o.width="200px",o.minWidth="0px",o.height="150px",o.display="block",i.appendChild(t),e.documentElement),n=(e.appendChild(i),t.offsetWidth),o=(o.overflow="scroll",t.offsetWidth);return n==o&&(o=i.clientWidth),e.removeChild(i),n-o},s.computedStyle=function(e,t){return window.getComputedStyle(e,"")||{}},s.setStyle=function(e,t,i){e[t]!==i&&(e[t]=i)},s.HAS_CSS_ANIMATION=!1,s.HAS_CSS_TRANSFORMS=!1,s.HI_DPI=!e.isWin||"undefined"!=typeof window&&1.5<=window.devicePixelRatio,e.isChromeOS&&(s.HI_DPI=!1),"undefined"!=typeof document&&(o=document.createElement("div"),s.HI_DPI&&void 0!==o.style.transform&&(s.HAS_CSS_TRANSFORMS=!0),e.isEdge||void 0===o.style.animationName||(s.HAS_CSS_ANIMATION=!0),o=null),s.HAS_CSS_TRANSFORMS?s.translate=function(e,t,i){e.style.transform="translate("+Math.round(t)+"px, "+Math.round(i)+"px)"}:s.translate=function(e,t,i){e.style.top=Math.round(i)+"px",e.style.left=Math.round(t)+"px"}}),define("ace/lib/net",["require","exports","module","ace/lib/dom"],function(e,t,i){"use strict";var n=e("./dom");t.get=function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.onreadystatechange=function(){4===i.readyState&&t(i.responseText)},i.send(null)},t.loadScript=function(e,i){var t=n.getDocumentHead(),o=document.createElement("script");o.src=e,t.appendChild(o),o.onload=o.onreadystatechange=function(e,t){!t&&o.readyState&&"loaded"!=o.readyState&&"complete"!=o.readyState||(o=o.onload=o.onreadystatechange=null,t||i())}},t.qualifyURL=function(e){var t=document.createElement("a");return t.href=e,t.href}}),define("ace/lib/event_emitter",["require","exports","module"],function(e,t,i){"use strict";function s(){this.propagationStopped=!0}function a(){this.defaultPrevented=!0}var o={};o._emit=o._dispatchEvent=function(e,t){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var i=this._eventRegistry[e]||[],o=this._defaultHandlers[e];if(i.length||o){(t="object"==typeof t&&t?t:{}).type||(t.type=e),t.stopPropagation||(t.stopPropagation=s),t.preventDefault||(t.preventDefault=a);for(var i=i.slice(),n=0;n<i.length&&(i[n](t,this),!t.propagationStopped);n++);return o&&!t.defaultPrevented?o(t,this):void 0}},o._signal=function(e,t){if(i=(this._eventRegistry||{})[e])for(var i=i.slice(),o=0;o<i.length;o++)i[o](t,this)},o.once=function(t,i){var o=this;if(this.on(t,function e(){o.off(t,e),i.apply(null,arguments)}),!i)return new Promise(function(e){i=e})},o.setDefaultHandler=function(e,t){var i,o,n=this._defaultHandlers;(n=n||(this._defaultHandlers={_disabled_:{}}))[e]&&(o=n[e],(i=n._disabled_[e])||(n._disabled_[e]=i=[]),i.push(o),-1!=(o=i.indexOf(t))&&i.splice(o,1)),n[e]=t},o.removeDefaultHandler=function(e,t){var i,o=this._defaultHandlers;o&&(i=o._disabled_[e],o[e]==t?i&&this.setDefaultHandler(e,i.pop()):i&&-1!=(o=i.indexOf(t))&&i.splice(o,1))},o.on=o.addEventListener=function(e,t,i){this._eventRegistry=this._eventRegistry||{};var o=this._eventRegistry[e];return-1==(o=o||(this._eventRegistry[e]=[])).indexOf(t)&&o[i?"unshift":"push"](t),t},o.off=o.removeListener=o.removeEventListener=function(e,t){this._eventRegistry=this._eventRegistry||{};e=this._eventRegistry[e];!e||-1!==(t=e.indexOf(t))&&e.splice(t,1)},o.removeAllListeners=function(e){e||(this._eventRegistry=this._defaultHandlers=void 0),this._eventRegistry&&(this._eventRegistry[e]=void 0),this._defaultHandlers&&(this._defaultHandlers[e]=void 0)},t.EventEmitter=o}),define("ace/lib/app_config",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(e,t,i){function o(e){"undefined"!=typeof console&&console.warn&&console.warn.apply(console,arguments)}function n(e,t){var i=new Error(e);i.data=t,"object"==typeof console&&console.error&&console.error(i),setTimeout(function(){throw i})}function s(){this.$defaultOptions={}}var a=e("./oop"),r=e("./event_emitter").EventEmitter,l={setOptions:function(t){Object.keys(t).forEach(function(e){this.setOption(e,t[e])},this)},getOptions:function(e){var t,i={};return e?Array.isArray(e)||(i=e,e=Object.keys(i)):(t=this.$options,e=Object.keys(t).filter(function(e){return!t[e].hidden})),e.forEach(function(e){i[e]=this.getOption(e)},this),i},setOption:function(e,t){var i;if(this["$"+e]!==t)return i=this.$options[e],i?i.forwardTo?this[i.forwardTo]&&this[i.forwardTo].setOption(e,t):(i.handlesSet||(this["$"+e]=t),void(i&&i.set&&i.set.call(this,t))):o('misspelled option "'+e+'"')},getOption:function(e){var t=this.$options[e];return t?t.forwardTo?this[t.forwardTo]&&this[t.forwardTo].getOption(e):t&&t.get?t.get.call(this):this["$"+e]:o('misspelled option "'+e+'"')}};(function(){a.implement(this,r),this.defineOptions=function(i,e,o){return i.$options||(this.$defaultOptions[e]=i.$options={}),Object.keys(o).forEach(function(e){var t=o[e];(t="string"==typeof t?{forwardTo:t}:t).name||(t.name=e),"initialValue"in(i.$options[t.name]=t)&&(i["$"+t.name]=t.initialValue)}),a.implement(i,l),this},this.resetOptions=function(i){Object.keys(i.$options).forEach(function(e){var t=i.$options[e];"value"in t&&i.setOption(e,t.value)})},this.setDefaultValue=function(e,t,i){if(!e){for(e in this.$defaultOptions)if(this.$defaultOptions[e][t])break;if(!this.$defaultOptions[e][t])return!1}var o=this.$defaultOptions[e]||(this.$defaultOptions[e]={});o[t]&&(o.forwardTo?this.setDefaultValue(o.forwardTo,t,i):o[t].value=i)},this.setDefaultValues=function(t,i){Object.keys(i).forEach(function(e){this.setDefaultValue(t,e,i[e])},this)},this.warn=o,this.reportError=n}).call(s.prototype),t.AppConfig=s}),define("ace/theme/textmate.css",["require","exports","module"],function(e,t,i){i.exports='.ace-tm .ace_gutter {\n  background: #f0f0f0;\n  color: #333;\n}\n\n.ace-tm .ace_print-margin {\n  width: 1px;\n  background: #e8e8e8;\n}\n\n.ace-tm .ace_fold {\n    background-color: #6B72E6;\n}\n\n.ace-tm {\n  background-color: #FFFFFF;\n  color: black;\n}\n\n.ace-tm .ace_cursor {\n  color: black;\n}\n        \n.ace-tm .ace_invisible {\n  color: rgb(191, 191, 191);\n}\n\n.ace-tm .ace_storage,\n.ace-tm .ace_keyword {\n  color: blue;\n}\n\n.ace-tm .ace_constant {\n  color: rgb(197, 6, 11);\n}\n\n.ace-tm .ace_constant.ace_buildin {\n  color: rgb(88, 72, 246);\n}\n\n.ace-tm .ace_constant.ace_language {\n  color: rgb(88, 92, 246);\n}\n\n.ace-tm .ace_constant.ace_library {\n  color: rgb(6, 150, 14);\n}\n\n.ace-tm .ace_invalid {\n  background-color: rgba(255, 0, 0, 0.1);\n  color: red;\n}\n\n.ace-tm .ace_support.ace_function {\n  color: rgb(60, 76, 114);\n}\n\n.ace-tm .ace_support.ace_constant {\n  color: rgb(6, 150, 14);\n}\n\n.ace-tm .ace_support.ace_type,\n.ace-tm .ace_support.ace_class {\n  color: rgb(109, 121, 222);\n}\n\n.ace-tm .ace_keyword.ace_operator {\n  color: rgb(104, 118, 135);\n}\n\n.ace-tm .ace_string {\n  color: rgb(3, 106, 7);\n}\n\n.ace-tm .ace_comment {\n  color: rgb(76, 136, 107);\n}\n\n.ace-tm .ace_comment.ace_doc {\n  color: rgb(0, 102, 255);\n}\n\n.ace-tm .ace_comment.ace_doc.ace_tag {\n  color: rgb(128, 159, 191);\n}\n\n.ace-tm .ace_constant.ace_numeric {\n  color: rgb(0, 0, 205);\n}\n\n.ace-tm .ace_variable {\n  color: rgb(49, 132, 149);\n}\n\n.ace-tm .ace_xml-pe {\n  color: rgb(104, 104, 91);\n}\n\n.ace-tm .ace_entity.ace_name.ace_function {\n  color: #0000A2;\n}\n\n\n.ace-tm .ace_heading {\n  color: rgb(12, 7, 255);\n}\n\n.ace-tm .ace_list {\n  color:rgb(185, 6, 144);\n}\n\n.ace-tm .ace_meta.ace_tag {\n  color:rgb(0, 22, 142);\n}\n\n.ace-tm .ace_string.ace_regex {\n  color: rgb(255, 0, 0)\n}\n\n.ace-tm .ace_marker-layer .ace_selection {\n  background: rgb(181, 213, 255);\n}\n.ace-tm.ace_multiselect .ace_selection.ace_start {\n  box-shadow: 0 0 3px 0px white;\n}\n.ace-tm .ace_marker-layer .ace_step {\n  background: rgb(252, 255, 0);\n}\n\n.ace-tm .ace_marker-layer .ace_stack {\n  background: rgb(164, 229, 101);\n}\n\n.ace-tm .ace_marker-layer .ace_bracket {\n  margin: -1px 0 0 -1px;\n  border: 1px solid rgb(192, 192, 192);\n}\n\n.ace-tm .ace_marker-layer .ace_active-line {\n  background: rgba(0, 0, 0, 0.07);\n}\n\n.ace-tm .ace_gutter-active-line {\n    background-color : #dcdcdc;\n}\n\n.ace-tm .ace_marker-layer .ace_selected-word {\n  background: rgb(250, 250, 255);\n  border: 1px solid rgb(200, 200, 250);\n}\n\n.ace-tm .ace_indent-guide {\n  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;\n}\n\n.ace-tm .ace_indent-guide-active {\n  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAAZSURBVHjaYvj///9/hivKyv8BAAAA//8DACLqBhbvk+/eAAAAAElFTkSuQmCC") right repeat-y;\n}\n'}),define("ace/theme/textmate",["require","exports","module","ace/theme/textmate.css","ace/lib/dom"],function(e,t,i){"use strict";t.isDark=!1,t.cssClass="ace-tm",t.cssText=e("./textmate.css"),t.$id="ace/theme/textmate",e("../lib/dom").importCssString(t.cssText,t.cssClass,!1)}),define("ace/config",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/lib/net","ace/lib/dom","ace/lib/app_config","ace/theme/textmate"],function(n,s,e){var t=n("./lib/lang"),a=(n("./lib/oop"),n("./lib/net")),i=n("./lib/dom"),o=n("./lib/app_config").AppConfig,r=(e.exports=s=new o,{packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{},loadWorkerFromBlob:!0,sharedPopups:!1,useStrictCSP:null}),l=(s.get=function(e){if(r.hasOwnProperty(e))return r[e];throw new Error("Unknown config key: "+e)},s.set=function(e,t){if(r.hasOwnProperty(e))r[e]=t;else if(0==this.setDefaultValue("",e,t))throw new Error("Unknown config key: "+e);"useStrictCSP"==e&&i.useStrictCSP(t)},s.all=function(){return t.copyObject(r)},s.$modes={},s.moduleUrl=function(e,t){if(r.$moduleUrls[e])return r.$moduleUrls[e];var e=e.split("/"),i="snippets"==(t=t||e[e.length-2]||"")?"/":"-",o=e[e.length-1],n=("worker"==t&&"-"==i&&(n=new RegExp("^"+t+"[\\-_]|[\\-_]"+t+"$","g"),o=o.replace(n,"")),(!o||o==t)&&1<e.length&&(o=e[e.length-2]),r[t+"Path"]);return null==n?n=r.basePath:"/"==i&&(t=i=""),n&&"/"!=n.slice(-1)&&(n+="/"),n+t+i+o+this.get("suffix")},s.setModuleUrl=function(e,t){return r.$moduleUrls[e]=t},function(e,t){return"ace/theme/textmate"==e?t(null,n("./theme/textmate")):console.error("loader is not configured")}),c=(s.setLoader=function(e){l=e},s.$loading={},s.loadModule=function(o,e){var t,i;Array.isArray(o)&&(t=o[0],o=o[1]);try{i=n(o)}catch(e){}if(i&&!s.$loading[o])return e&&e(i);if(s.$loading[o]||(s.$loading[o]=[]),s.$loading[o].push(e),!(1<s.$loading[o].length))return i=function(){l(o,function(e,t){s._emit("load.module",{name:o,module:t});var i=s.$loading[o];s.$loading[o]=null,i.forEach(function(e){e&&e(t)})})},s.get("packaged")?(a.loadScript(s.moduleUrl(o,t),i),void c()):i()},function(){r.basePath||r.workerPath||r.modePath||r.themePath||Object.keys(r.$moduleUrls).length||(console.error("Unable to infer path to ace from script src,","use ace.config.set('basePath', 'path') to enable dynamic loading of modes and themes","or with webpack use ace/webpack-resolver"),c=function(){})});s.version="1.10.1"}),define("ace/loader_build",["require","exports","module","ace/lib/fixoldbrowsers","ace/config"],function(u,e,p){"use strict";function t(e){if(f&&f.document){m.set("packaged",e||u.packaged||p.packaged||f.define&&define.packaged);for(var t,i={},o="",e=document.currentScript||document._currentScript,n=(e&&e.ownerDocument||document).getElementsByTagName("script"),s=0;s<n.length;s++){var a=n[s],r=a.src||a.getAttribute("src");if(r){for(var l=a.attributes,c=0,d=l.length;c<d;c++){var h=l[c];0===h.name.indexOf("data-ace-")&&(i[h.name.replace(/^data-ace-/,"").replace(/-(.)/g,function(e,t){return t.toUpperCase()})]=h.value)}a=r.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);a&&(o=a[1])}}for(t in o&&(i.base=i.base||o,i.packaged=!0),i.basePath=i.base,i.workerPath=i.workerPath||i.base,i.modePath=i.modePath||i.base,i.themePath=i.themePath||i.base,delete i.base,i)void 0!==i[t]&&m.set(t,i[t])}}u("./lib/fixoldbrowsers");var m=u("./config"),f=(m.setLoader(function(e,t){u([e],function(e){t(null,e)})}),function(){return this||"undefined"!=typeof window&&window}());p.exports=function(e){m.init=t,e.require=u,"function"==typeof define&&(e.define=define)}}),define("ace/lib/keys",["require","exports","module","ace/lib/oop"],function(e,t,i){"use strict";var s=e("./oop"),o=function(){var e,t,i={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta",91:"MetaLeft",92:"MetaRight",93:"ContextMenu"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,super:8,meta:8,command:8,cmd:8,control:1},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*"}};for(t in i.FUNCTION_KEYS)e=i.FUNCTION_KEYS[t].toLowerCase(),i[e]=parseInt(t,10);for(t in i.PRINTABLE_KEYS)e=i.PRINTABLE_KEYS[t].toLowerCase(),i[e]=parseInt(t,10);s.mixin(i,i.MODIFIER_KEYS),s.mixin(i,i.PRINTABLE_KEYS),s.mixin(i,i.FUNCTION_KEYS),i.enter=i.return,i.escape=i.esc,i.del=i.delete,i[173]="-";for(var o=["cmd","ctrl","alt","shift"],n=Math.pow(2,o.length);n--;)i.KEY_MODS[n]=o.filter(function(e){return n&i.KEY_MODS[e]}).join("-")+"-";return i.KEY_MODS[0]="",i.KEY_MODS[-1]="input-",i}();s.mixin(t,o),t.keyCodeToString=function(e){var t=o[e];return(t="string"!=typeof t?String.fromCharCode(e):t).toLowerCase()}}),define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(e,h,t){"use strict";function n(){if(null==i){i=!1;try{document.createComment("").addEventListener("test",function(){},{get passive(){i={passive:!1}}})}catch(e){}}return i}function s(e,t,i){this.elem=e,this.type=t,this.callback=i}function a(e,t,i){var o=l(t);if(!u.isMac&&p){if(t.getModifierState&&(t.getModifierState("OS")||t.getModifierState("Win"))&&(o|=8),p.altGr){if(3==(3&o))return;p.altGr=0}18!==i&&17!==i||(n="location"in t?t.location:t.keyLocation,17===i&&1===n?1==p[i]&&(m=t.timeStamp):18===i&&3===o&&2===n&&t.timeStamp-m<50&&(p.altGr=!0))}if(i in d.MODIFIER_KEYS&&(i=-1),!o&&13===i){var n="location"in t?t.location:t.keyLocation;if(3===n&&(e(t,o,-i),t.defaultPrevented))return}if(u.isChromeOS&&8&o){if(e(t,o,i),t.defaultPrevented)return;o&=-9}return!!(o||i in d.FUNCTION_KEYS||i in d.PRINTABLE_KEYS)&&e(t,o,i)}function r(){p=Object.create(null)}function l(e){return 0|(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0)}var i,c,d=e("./keys"),u=e("./useragent"),p=null,m=0,f=(s.prototype.destroy=function(){g(this.elem,this.type,this.callback),this.elem=this.type=this.callback=void 0},h.addListener=function(e,t,i,o){e.addEventListener(t,i,n()),o&&o.$toDestroy.push(new s(e,t,i))}),g=h.removeListener=function(e,t,i){e.removeEventListener(t,i,n())};h.stopEvent=function(e){return h.stopPropagation(e),h.preventDefault(e),!1},h.stopPropagation=function(e){e.stopPropagation&&e.stopPropagation()},h.preventDefault=function(e){e.preventDefault&&e.preventDefault()},h.getButton=function(e){return"dblclick"==e.type?0:"contextmenu"==e.type||u.isMac&&e.ctrlKey&&!e.altKey&&!e.shiftKey?2:e.button},h.capture=function(e,t,i){function o(e){t&&t(e),i&&i(e),g(n,"mousemove",t),g(n,"mouseup",o),g(n,"dragstart",o)}var n=e&&e.ownerDocument||document;return f(n,"mousemove",t),f(n,"mouseup",o),f(n,"dragstart",o),o},h.addMouseWheelListener=function(e,o,t){f(e,"wheel",function(e){var t=e.deltaX||0,i=e.deltaY||0;switch(e.deltaMode){case e.DOM_DELTA_PIXEL:e.wheelX=.15*t,e.wheelY=.15*i;break;case e.DOM_DELTA_LINE:e.wheelX=15*t,e.wheelY=15*i;break;case e.DOM_DELTA_PAGE:e.wheelX=150*t,e.wheelY=150*i}o(e)},t)},h.addMultiMouseDownListener=function(e,i,o,n,t){function s(e){var t;if(0!==h.getButton(e)?c=0:1<e.detail?4<++c&&(c=1):c=1,u.isIE&&(t=5<Math.abs(e.clientX-a)||5<Math.abs(e.clientY-r),l&&!t||(c=1),l&&clearTimeout(l),l=setTimeout(function(){l=null},i[c-1]||600),1==c&&(a=e.clientX,r=e.clientY)),e._clicks=c,o[n]("mousedown",e),4<c)c=0;else if(1<c)return o[n](d[c],e)}var a,r,l,c=0,d={2:"dblclick",3:"tripleclick",4:"quadclick"};(e=Array.isArray(e)?e:[e]).forEach(function(e){f(e,"mousedown",s,t)})};h.getModifierString=function(e){return d.KEY_MODS[l(e)]},h.addCommandKeyListener=function(e,i,t){var o,n;u.isOldGecko||u.isOpera&&!("KeyboardEvent"in window)?(o=null,f(e,"keydown",function(e){o=e.keyCode},t),f(e,"keypress",function(e){return a(i,e,o)},t)):(n=null,f(e,"keydown",function(e){p[e.keyCode]=(p[e.keyCode]||0)+1;var t=a(i,e,e.keyCode);return n=e.defaultPrevented,t},t),f(e,"keypress",function(e){n&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)&&(h.stopEvent(e),n=null)},t),f(e,"keyup",function(e){p[e.keyCode]=null},t),p||(r(),f(window,"focus",r)))},"object"==typeof window&&window.postMessage&&!u.isOldIE&&(c=1,h.nextTick=function(t,i){i=i||window;function o(e){e.data==n&&(h.stopPropagation(e),g(i,"message",o),t())}var n="zero-timeout-message-"+c++;f(i,"message",o),i.postMessage(n,"*")}),h.$idleBlocked=!1,h.onIdle=function(t,e){return setTimeout(function e(){h.$idleBlocked?setTimeout(e,100):t()},e)},h.$idleBlockId=null,h.blockIdle=function(e){h.$idleBlockId&&clearTimeout(h.$idleBlockId),h.$idleBlocked=!0,h.$idleBlockId=setTimeout(function(){h.$idleBlocked=!1},e||100)},h.nextFrame="object"==typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),h.nextFrame?h.nextFrame=h.nextFrame.bind(window):h.nextFrame=function(e){setTimeout(e,17)}}),define("ace/range",["require","exports","module"],function(e,t,i){"use strict";function s(e,t,i,o){this.start={row:e,column:t},this.end={row:i,column:o}}(function(){this.isEqual=function(e){return this.start.row===e.start.row&&this.end.row===e.end.row&&this.start.column===e.start.column&&this.end.column===e.end.column},this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(e,t){return 0==this.compare(e,t)},this.compareRange=function(e){var t=e.end,e=e.start,t=this.compare(t.row,t.column);return 1==t?1==(t=this.compare(e.row,e.column))?2:0==t?1:0:-1==t?-2:-1==(t=this.compare(e.row,e.column))?-1:1==t?42:0},this.comparePoint=function(e){return this.compare(e.row,e.column)},this.containsRange=function(e){return 0==this.comparePoint(e.start)&&0==this.comparePoint(e.end)},this.intersects=function(e){e=this.compareRange(e);return-1==e||0==e||1==e},this.isEnd=function(e,t){return this.end.row==e&&this.end.column==t},this.isStart=function(e,t){return this.start.row==e&&this.start.column==t},this.setStart=function(e,t){"object"==typeof e?(this.start.column=e.column,this.start.row=e.row):(this.start.row=e,this.start.column=t)},this.setEnd=function(e,t){"object"==typeof e?(this.end.column=e.column,this.end.row=e.row):(this.end.row=e,this.end.column=t)},this.inside=function(e,t){return 0==this.compare(e,t)&&(!this.isEnd(e,t)&&!this.isStart(e,t))},this.insideStart=function(e,t){return 0==this.compare(e,t)&&!this.isEnd(e,t)},this.insideEnd=function(e,t){return 0==this.compare(e,t)&&!this.isStart(e,t)},this.compare=function(e,t){return this.isMultiLine()||e!==this.start.row?e<this.start.row?-1:e>this.end.row?1:this.start.row===e?t>=this.start.column?0:-1:this.end.row!==e||t<=this.end.column?0:1:t<this.start.column?-1:t>this.end.column?1:0},this.compareStart=function(e,t){return this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.compareEnd=function(e,t){return this.end.row==e&&this.end.column==t?1:this.compare(e,t)},this.compareInside=function(e,t){return this.end.row==e&&this.end.column==t?1:this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.clipRows=function(e,t){var i,o;return this.end.row>t?i={row:t+1,column:0}:this.end.row<e&&(i={row:e,column:0}),this.start.row>t?o={row:t+1,column:0}:this.start.row<e&&(o={row:e,column:0}),s.fromPoints(o||this.start,i||this.end)},this.extend=function(e,t){var i,o,n=this.compare(e,t);return 0==n?this:(-1==n?i={row:e,column:t}:o={row:e,column:t},s.fromPoints(i||this.start,o||this.end))},this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return s.fromPoints(this.start,this.end)},this.collapseRows=function(){return 0==this.end.column?new s(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new s(this.start.row,0,this.end.row,0)},this.toScreenRange=function(e){var t=e.documentToScreenPosition(this.start),e=e.documentToScreenPosition(this.end);return new s(t.row,t.column,e.row,e.column)},this.moveBy=function(e,t){this.start.row+=e,this.start.column+=t,this.end.row+=e,this.end.column+=t}}).call(s.prototype),s.fromPoints=function(e,t){return new s(e.row,e.column,t.row,t.column)},s.comparePoints=function(e,t){return e.row-t.row||e.column-t.column},s.comparePoints=function(e,t){return e.row-t.row||e.column-t.column},t.Range=s}),define("ace/clipboard",["require","exports","module"],function(e,t,i){"use strict";var o;i.exports={lineMode:!1,pasteCancelled:function(){return!!(o&&o>Date.now()-50)||(o=!1)},cancel:function(){o=Date.now()}}}),define("ace/keyboard/textinput",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/lib/dom","ace/lib/lang","ace/clipboard","ace/lib/keys"],function(e,t,i){"use strict";var F=e("../lib/event"),B=e("../lib/useragent"),$=e("../lib/dom"),W=e("../lib/lang"),H=e("../clipboard"),z=B.isChrome<18,U=B.isIE,V=63<B.isChrome,q=e("../lib/keys"),G=q.KEY_MODS,K=B.isIOS,X=K?/\s/:/\n/,Y=B.isMobile;t.TextInput=function(e,h){function t(){i=!0,u.blur(),u.focus(),i=!1}function r(){clearTimeout(R),R=setTimeout(function(){l&&(u.style.cssText=l,l=""),h.renderer.$isMousePressed=!1,h.renderer.$keepTextAreaAtCursor&&h.renderer.$moveTextAreaToCursor()},0)}var u=$.createElement("textarea"),s=(u.className="ace_text-input",u.setAttribute("wrap","off"),u.setAttribute("autocorrect","off"),u.setAttribute("autocapitalize","off"),u.setAttribute("spellcheck",!1),u.style.opacity="0",e.insertBefore(u,e.firstChild),!1),p=!1,a=!1,m=!1,l="",f=(Y||(u.style.fontSize="1px"),!1),i=!1,g="",_=0,b=0,y=0;try{var c=document.activeElement===u}catch(e){}F.addListener(u,"blur",function(e){i||(h.onBlur(e),c=!1)},h),F.addListener(u,"focus",function(e){if(!i){if(c=!0,B.isEdge)try{if(!document.hasFocus())return}catch(e){}h.onFocus(e),B.isEdge?setTimeout(v):v()}},h),this.$focusScroll=!1,this.focus=function(){if(l||V||"browser"==this.$focusScroll)return u.focus({preventScroll:!0});var e=u.style.top;u.style.position="fixed",u.style.top="0px";try{var t=0!=u.getBoundingClientRect().top}catch(e){return}var i=[];if(t)for(var o=u.parentElement;o&&1==o.nodeType;)i.push(o),o.setAttribute("ace_nocontext",!0),o=!o.parentElement&&o.getRootNode?o.getRootNode().host:o.parentElement;u.focus({preventScroll:!0}),t&&i.forEach(function(e){e.removeAttribute("ace_nocontext")}),setTimeout(function(){u.style.position="","0px"==u.style.top&&(u.style.top=e)},0)},this.blur=function(){u.blur()},this.isFocused=function(){return c},h.on("beforeEndOperation",function(){var e=h.curOp,t=e&&e.command&&e.command.name;"insertstring"!=t&&(t=t&&(e.docChanged||e.selectionChanged),a&&t&&(g=u.value="",L()),v())});function o(e){C(e,!0)}function n(e){C(e,!1)}function d(e){var t=x(e);H.pasteCancelled()||("string"==typeof t?(t&&h.onPaste(t,e),B.isIE&&setTimeout(v),F.preventDefault(e)):(u.value="",p=!0))}var v=K?function(e){var t;!c||s&&!e||m||((t="\n ab"+(e=e||"")+"cde fg\n")!=u.value&&(u.value=g=t),t=4+(e.length||(h.selection.isEmpty()?0:1)),4==_&&b==t||u.setSelectionRange(4,t),_=4,b=t)}:function(){if(!a&&!m&&(c||w)){a=!0;var e,t,i=0,o=0,n="",s=(h.session&&(s=(e=h.selection).getRange(),e=e.cursor.row,i=s.start.column,o=s.end.column,n=h.session.getLine(e),s.start.row!=e?(t=h.session.getLine(e-1),i=s.start.row<e-1?0:i,o+=t.length+1,n=t+"\n"+n):s.end.row!=e?(t=h.session.getLine(e+1),o=s.end.row>e+1?t.length:o,o+=n.length+1,n=n+"\n"+t):Y&&0<e&&(n="\n"+n,o+=1,i+=1),400<n.length&&(i<400&&o<400?n=n.slice(0,400):(n="\n",i==o?i=o=0:(i=0,o=1)))),n+"\n\n");if(s!=g&&(u.value=g=s,_=b=s.length),w&&(_=u.selectionStart,b=u.selectionEnd),b!=o||_!=i||u.selectionEnd!=b)try{u.setSelectionRange(i,o),_=i,b=o}catch(e){}a=!1}},O=(this.resetSelection=v,c&&h.onFocus(),function(e){return 0===e.selectionStart&&e.selectionEnd>=g.length&&e.value===g&&g&&e.selectionEnd!==b}),k=null,w=(this.setInputHandler=function(e){k=e},!(this.getInputHandler=function(){return k})),T=function(e,t){if(w=w&&!1,p)return v(),e&&h.onPaste(e),p=!1,"";for(var i=u.selectionStart,o=u.selectionEnd,n=_,s=g.length-b,a=e,r=e.length-i,l=e.length-o,c=0;0<n&&g[c]==e[c];)c++,n--;for(a=a.slice(c),c=1;0<s&&g.length-c>_-1&&g[g.length-c]==e[e.length-c];)c++,s--;r-=c-1,l-=c-1;var d=a.length-c+1;if(d<0&&(n=-d,d=0),a=a.slice(0,d),!(t||a||r||n||s||l))return"";d=!(m=!0);return B.isAndroid&&". "==a&&(a="  ",d=!0),a&&!n&&!s&&!r&&!l||f?h.onTextInput(a):h.onTextInput(a,{extendLeft:n,extendRight:s,restoreStart:r,restoreEnd:l}),m=!1,g=e,_=i,b=o,y=l,d?"\n":a},S=function(e){if(a)return D();if(e&&e.inputType){if("historyUndo"==e.inputType)return h.execCommand("undo");if("historyRedo"==e.inputType)return h.execCommand("redo")}var e=u.value,t=T(e,!0);(500<e.length||X.test(t)||Y&&_<1&&_==b)&&v()},x=function(e,t,i){var o=e.clipboardData||window.clipboardData;if(o&&!z){var n=U||i?"Text":"text/plain";try{return t?!1!==o.setData(n,t):o.getData(n)}catch(e){if(!i)return x(e,t,!0)}}},C=function(e,t){var i=h.getCopyText();if(!i)return F.preventDefault(e);x(e,i)?(K&&(v(i),s=i,setTimeout(function(){s=!1},10)),t?h.onCut():h.onCopy(),F.preventDefault(e)):(s=!0,u.value=i,u.select(),setTimeout(function(){s=!1,v(),t?h.onCut():h.onCopy()}))},D=(F.addCommandKeyListener(u,h.onCommandKey.bind(h),h),F.addListener(u,"select",function(e){a||(s?s=!1:O(u)?(h.selectAll(),v()):Y&&u.selectionStart!=_&&v())},h),F.addListener(u,"input",S,h),F.addListener(u,"cut",o,h),F.addListener(u,"copy",n,h),F.addListener(u,"paste",d,h),"oncut"in u&&"oncopy"in u&&"onpaste"in u||F.addListener(e,"keydown",function(e){if((!B.isMac||e.metaKey)&&e.ctrlKey)switch(e.keyCode){case 67:n(e);break;case 86:d(e);break;case 88:o(e)}},h),function(){var e;if(a&&h.onCompositionUpdate&&!h.$readOnly)return f?t():void(a.useTextareaForIME?h.onCompositionUpdate(u.value):(e=u.value,T(e),a.markerRange&&(a.context&&(a.markerRange.start.column=a.selectionStart=a.context.compositionStartOffset),a.markerRange.end.column=a.markerRange.start.column+b-a.selectionStart+y)))}),L=function(e){h.onCompositionEnd&&!h.$readOnly&&(a=!1,h.onCompositionEnd(),h.off("mousedown",t),e&&S())},A=W.delayedCall(D,50).schedule.bind(null,null);F.addListener(u,"compositionstart",function(e){a||!h.onCompositionStart||h.$readOnly||(a={},f||(e.data&&(a.useTextareaForIME=!1),setTimeout(D,0),h._signal("compositionStart"),h.on("mousedown",t),(e=h.getSelectionRange()).end.row=e.start.row,e.end.column=e.start.column,a.markerRange=e,a.selectionStart=_,h.onCompositionStart(a),a.useTextareaForIME?(g=u.value="",b=_=0):(u.msGetInputContext&&(a.context=u.msGetInputContext()),u.getInputContext&&(a.context=u.getInputContext()))))},h),F.addListener(u,"compositionupdate",D,h),F.addListener(u,"keyup",function(e){27==e.keyCode&&u.value.length<u.selectionStart&&(a||(g=u.value),_=b=-1,v()),A()},h),F.addListener(u,"keydown",A,h),F.addListener(u,"compositionend",L,h),this.getElement=function(){return u},this.setCommandMode=function(e){f=e,u.readOnly=!1},this.setReadOnly=function(e){f||(u.readOnly=e)},this.setCopyWithEmptySelection=function(e){},this.onContextMenu=function(e){w=!0,v(),h._emit("nativecontextmenu",{target:h,domEvent:e}),this.moveToMouse(e,!0)},this.moveToMouse=function(e,t){l=l||u.style.cssText,u.style.cssText=(t?"z-index:100000;":"")+(B.isIE?"opacity:0.1;":"")+"text-indent: -"+(_+b)*h.renderer.characterWidth*.5+"px;";function i(e){$.translate(u,e.clientX-s-2,Math.min(e.clientY-n-2,a))}var t=h.container.getBoundingClientRect(),o=$.computedStyle(h.container),n=t.top+(parseInt(o.borderTopWidth)||0),s=t.left+(parseInt(t.borderLeftWidth)||0),a=t.bottom-n-u.clientHeight-2;i(e),"mousedown"==e.type&&(h.renderer.$isMousePressed=!0,clearTimeout(R),B.isWin&&F.capture(h.container,i,r))},this.onContextMenuClose=r;function I(e){h.textInput.onContextMenu(e),r()}var R,E,P,M,j;function N(e){var t,i,o,n;document.activeElement!==P||j||a||E.$mouseHandler.isMousePressed||s||(t=P.selectionStart,i=P.selectionEnd,o=null,(n=0)==t?o=q.up:1==t?o=q.home:b<i&&"\n"==g[i]?o=q.end:t<_&&" "==g[t-1]?(o=q.left,n=G.option):t<_||t==_&&b!=_&&t==i?o=q.left:b<i&&2<g.slice(0,i).split("\n").length?o=q.down:b<i&&" "==g[i-1]?(o=q.right,n=G.option):(b<i||i==b&&b!=_&&t==i)&&(o=q.right),t!==i&&(n|=G.shift),o&&(!E.onCommandKey({},n,o)&&E.commands&&(o=q.keyCodeToString(o),(n=E.commands.findKeyCommand(n,o))&&E.execCommand(n)),_=t,b=i,v("")))}F.addListener(u,"mouseup",I,h),F.addListener(u,"mousedown",function(e){e.preventDefault(),r()},h),F.addListener(h.renderer.scroller,"contextmenu",I,h),F.addListener(u,"contextmenu",I,h),K&&(E=h,M=null,j=!1,(P=u).addEventListener("keydown",function(e){M&&clearTimeout(M),j=!0},!0),P.addEventListener("keyup",function(e){M=setTimeout(function(){j=!1},100)},!0),document.addEventListener("selectionchange",N),E.on("destroy",function(){document.removeEventListener("selectionchange",N)})),this.destroy=function(){u.parentElement&&u.parentElement.removeChild(u)}},t.$setUserAgentForTests=function(e,t){Y=e,K=t}}),define("ace/mouse/default_handlers",["require","exports","module","ace/lib/useragent"],function(e,t,i){"use strict";function o(t){t.$clickSelection=null;var e=t.editor;e.setDefaultHandler("mousedown",this.onMouseDown.bind(t)),e.setDefaultHandler("dblclick",this.onDoubleClick.bind(t)),e.setDefaultHandler("tripleclick",this.onTripleClick.bind(t)),e.setDefaultHandler("quadclick",this.onQuadClick.bind(t)),e.setDefaultHandler("mousewheel",this.onMouseWheel.bind(t));["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"].forEach(function(e){t[e]=this[e]},this),t.selectByLines=this.extendSelectionBy.bind(t,"getLineRange"),t.selectByWords=this.extendSelectionBy.bind(t,"getWordRange")}function a(e,t){return(e.start.row==e.end.row?2*t.column-e.start.column-e.end.column:e.start.row!=e.end.row-1||e.start.column||e.end.column?2*t.row-e.start.row-e.end.row:t.column-4)<0?{cursor:e.start,anchor:e.end}:{cursor:e.end,anchor:e.start}}var s=e("../lib/useragent");(function(){this.onMouseDown=function(e){var t=e.inSelection(),i=e.getDocumentPosition(),o=(this.mousedownEvent=e,this.editor),n=e.getButton();if(0!==n)!o.getSelectionRange().isEmpty()&&1!=n||o.selection.moveToPosition(i),2==n&&(o.textInput.onContextMenu(e.domEvent),s.isMozilla||e.preventDefault());else{if(this.mousedownEvent.time=Date.now(),!t||o.isFocused()||(o.focus(),!this.$focusTimeout||this.$clickSelection||o.inMultiSelectMode))return this.captureMouse(e),this.startSelect(i,1<e.domEvent._clicks),e.preventDefault();this.setState("focusWait"),this.captureMouse(e)}},this.startSelect=function(e,t){e=e||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var i=this.editor;this.mousedownEvent&&(this.mousedownEvent.getShiftKey()?i.selection.selectToPosition(e):t||i.selection.moveToPosition(e),t||this.select(),i.renderer.scroller.setCapture&&i.renderer.scroller.setCapture(),i.setStyle("ace_selecting"),this.setState("select"))},this.select=function(){var e,t=this.editor,i=t.renderer.screenToTextCoordinates(this.x,this.y);this.$clickSelection&&(e=-1==(e=this.$clickSelection.comparePoint(i))?this.$clickSelection.end:1==e?this.$clickSelection.start:(i=(e=a(this.$clickSelection,i)).cursor,e.anchor),t.selection.setSelectionAnchor(e.row,e.column)),t.selection.selectToPosition(i),t.renderer.scrollCursorIntoView()},this.extendSelectionBy=function(e){var t,i,o,n=this.editor,s=n.renderer.screenToTextCoordinates(this.x,this.y),e=n.selection[e](s.row,s.column);this.$clickSelection&&(i=this.$clickSelection.comparePoint(e.start),t=this.$clickSelection.comparePoint(e.end),-1==i&&t<=0?(o=this.$clickSelection.end,e.end.row==s.row&&e.end.column==s.column||(s=e.start)):1==t&&0<=i?(o=this.$clickSelection.start,e.start.row==s.row&&e.start.column==s.column||(s=e.end)):o=-1==i&&1==t?(s=e.end,e.start):(s=(i=a(this.$clickSelection,s)).cursor,i.anchor),n.selection.setSelectionAnchor(o.row,o.column)),n.selection.selectToPosition(s),n.renderer.scrollCursorIntoView()},this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.$clickSelection=null,this.editor.unsetStyle("ace_selecting"),this.editor.renderer.scroller.releaseCapture&&this.editor.renderer.scroller.releaseCapture()},this.focusWait=function(){o=this.mousedownEvent.x,e=this.mousedownEvent.y,i=this.x,t=this.y;var e,t,i=Math.sqrt(Math.pow(i-o,2)+Math.pow(t-e,2)),o=Date.now();(0<i||o-this.mousedownEvent.time>this.$focusTimeout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())},this.onDoubleClick=function(e){var e=e.getDocumentPosition(),t=this.editor,i=t.session.getBracketRange(e);i?(i.isEmpty()&&(i.start.column--,i.end.column++),this.setState("select")):(i=t.selection.getWordRange(e.row,e.column),this.setState("selectByWords")),this.$clickSelection=i,this.select()},this.onTripleClick=function(e){var e=e.getDocumentPosition(),t=this.editor,i=(this.setState("selectByLines"),t.getSelectionRange());i.isMultiLine()&&i.contains(e.row,e.column)?(this.$clickSelection=t.selection.getLineRange(i.start.row),this.$clickSelection.end=t.selection.getLineRange(i.end.row).end):this.$clickSelection=t.selection.getLineRange(e.row),this.select()},this.onQuadClick=function(e){var t=this.editor;t.selectAll(),this.$clickSelection=t.getSelectionRange(),this.setState("selectAll")},this.onMouseWheel=function(e){var t,i,o,n,s,a,r;if(!e.getAccelKey())return e.getShiftKey()&&e.wheelY&&!e.wheelX&&(e.wheelX=e.wheelY,e.wheelY=0),t=this.editor,this.$lastScroll||(this.$lastScroll={t:0,vx:0,vy:0,allowed:0}),i=this.$lastScroll,o=e.domEvent.timeStamp,a=o-i.t,n=a?e.wheelX/a:i.vx,s=a?e.wheelY/a:i.vy,a<550&&(n=(n+i.vx)/2,s=(s+i.vy)/2),a=Math.abs(n/s),r=!1,1<=a&&t.renderer.isScrollableBy(e.wheelX*e.speed,0)&&(r=!0),(r=a<=1&&t.renderer.isScrollableBy(0,e.wheelY*e.speed)?!0:r)?i.allowed=o:o-i.allowed<550&&(Math.abs(n)<=1.5*Math.abs(i.vx)&&Math.abs(s)<=1.5*Math.abs(i.vy)?(r=!0,i.allowed=o):i.allowed=0),i.t=o,i.vx=n,i.vy=s,r?(t.renderer.scrollBy(e.wheelX*e.speed,e.wheelY*e.speed),e.stop()):void 0}}).call(o.prototype),t.DefaultHandlers=o}),define("ace/tooltip",["require","exports","module","ace/lib/oop","ace/lib/dom"],function(e,t,i){"use strict";function o(e){this.isOpen=!1,this.$element=null,this.$parentNode=e}e("./lib/oop");var n=e("./lib/dom"),s="ace_tooltip";(function(){this.$init=function(){return this.$element=n.createElement("div"),this.$element.className=s,this.$element.style.display="none",this.$parentNode.appendChild(this.$element),this.$element},this.getElement=function(){return this.$element||this.$init()},this.setText=function(e){this.getElement().textContent=e},this.setHtml=function(e){this.getElement().innerHTML=e},this.setPosition=function(e,t){this.getElement().style.left=e+"px",this.getElement().style.top=t+"px"},this.setClassName=function(e){n.addCssClass(this.getElement(),e)},this.show=function(e,t,i){null!=e&&this.setText(e),null!=t&&null!=i&&this.setPosition(t,i),this.isOpen||(this.getElement().style.display="block",this.isOpen=!0)},this.hide=function(){this.isOpen&&(this.getElement().style.display="none",this.getElement().className=s,this.isOpen=!1)},this.getHeight=function(){return this.getElement().offsetHeight},this.getWidth=function(){return this.getElement().offsetWidth},this.destroy=function(){this.isOpen=!1,this.$element&&this.$element.parentNode&&this.$element.parentNode.removeChild(this.$element)}}).call(o.prototype),t.Tooltip=o}),define("ace/mouse/default_gutter_handler",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event","ace/tooltip"],function(e,t,i){"use strict";function h(e){a.call(this,e)}var u=e("../lib/dom"),o=e("../lib/oop"),p=e("../lib/event"),a=e("../tooltip").Tooltip;o.inherits(h,a),function(){this.setPosition=function(e,t){var i=window.innerWidth||document.documentElement.clientWidth,o=window.innerHeight||document.documentElement.clientHeight,n=this.getWidth(),s=this.getHeight();i<(e+=15)+n&&(e-=e+n-i),o<(t+=15)+s&&(t-=20+s),a.prototype.setPosition.call(this,e,t)}}.call(h.prototype),t.GutterHandler=function(o){function n(){i=i&&clearTimeout(i),r&&(d.hide(),r=null,l._signal("hideGutterTooltip",d),l.off("mousewheel",n))}function s(e){d.setPosition(e.x,e.y)}var i,a,r,l=o.editor,c=l.renderer.$gutterLayer,d=new h(l.container);o.editor.setDefaultHandler("guttermousedown",function(e){if(l.isFocused()&&0==e.getButton()){var t=c.getRegion(e);if("foldWidgets"!=t){var t=e.getDocumentPosition().row,i=l.session.selection;if(e.getShiftKey())i.selectTo(t,0);else{if(2==e.domEvent.detail)return l.selectAll(),e.preventDefault();o.$clickSelection=l.selection.getLineRange(t)}return o.setState("selectByLines"),o.captureMouse(e),e.preventDefault()}}}),o.editor.setDefaultHandler("guttermousemove",function(e){var t=e.domEvent.target||e.domEvent.srcElement;if(u.hasCssClass(t,"ace_fold-widget"))return n();r&&o.$tooltipFollowsMouse&&s(e),a=e,i=i||setTimeout(function(){i=null,(a&&!o.isMousePressed?function(){var e=a.getDocumentPosition().row,t=c.$annotations[e];if(!t)return n();if(e==l.session.getLength()){var e=l.renderer.pixelToScreenCoordinates(0,a.y).row,i=a.$pos;if(e>l.session.documentToScreenRow(i.row,i.column))return n()}r!=t&&(r=t.text.join("<br/>"),d.setHtml(r),(e=t.className)&&d.setClassName(e.trim()),d.show(),l._signal("showGutterTooltip",d),l.on("mousewheel",n),o.$tooltipFollowsMouse?s(a):(i=a.domEvent.target.getBoundingClientRect(),(t=d.getElement().style).left=i.right+"px",t.top=i.bottom+"px"))}:n)()},50)}),p.addListener(l.renderer.$gutter,"mouseout",function(e){a=null,r&&!i&&(i=setTimeout(function(){i=null,n()},50))},l),l.on("changeSession",n)}}),define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(e,t,i){"use strict";var o=e("../lib/event"),n=e("../lib/useragent"),e=t.MouseEvent=function(e,t){this.domEvent=e,this.editor=t,this.x=this.clientX=e.clientX,this.y=this.clientY=e.clientY,this.$pos=null,this.$inSelection=null,this.propagationStopped=!1,this.defaultPrevented=!1};!function(){this.stopPropagation=function(){o.stopPropagation(this.domEvent),this.propagationStopped=!0},this.preventDefault=function(){o.preventDefault(this.domEvent),this.defaultPrevented=!0},this.stop=function(){this.stopPropagation(),this.preventDefault()},this.getDocumentPosition=function(){return this.$pos||(this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY),this.$pos)},this.inSelection=function(){var e,t;return null===this.$inSelection&&((e=this.editor.getSelectionRange()).isEmpty()?this.$inSelection=!1:(t=this.getDocumentPosition(),this.$inSelection=e.contains(t.row,t.column))),this.$inSelection},this.getButton=function(){return o.getButton(this.domEvent)},this.getShiftKey=function(){return this.domEvent.shiftKey},this.getAccelKey=n.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}.call(e.prototype)}),define("ace/mouse/dragdrop_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],function(e,t,i){"use strict";function o(t){function e(){var e,t,i,o,n,s,a,r,l=u;u=b.renderer.screenToTextCoordinates(c,d),n=u,s=l,a=Date.now(),r=!s||n.row!=s.row,s=!s||n.column!=s.column,!g||r||s?(b.moveCursorToPosition(n),g=a,_={x:c,y:d}):5<T(_.x,_.y,c,d)?g=null:200<=a-g&&(b.renderer.scrollCursorIntoView(),g=null),r=u,s=l,n=Date.now(),a=b.renderer.layerConfig.lineHeight,l=b.renderer.layerConfig.characterWidth,e=b.renderer.scroller.getBoundingClientRect(),e={x:{left:c-e.left,right:e.right-c},y:{top:d-e.top,bottom:e.bottom-d}},t=Math.min(e.x.left,e.x.right),i=Math.min(e.y.top,e.y.bottom),o={row:r.row,column:r.column},t/l<=2&&(o.column+=e.x.left<e.x.right?-3:2),i/a<=1&&(o.row+=e.y.top<e.y.bottom?-1:1),t=r.row!=o.row,l=r.column!=o.column,i=!s||r.row!=s.row,t||l&&!i?f?200<=n-f&&b.renderer.scrollCursorIntoView(o):f=n:f=null}function i(){h=b.selection.toOrientedRange(),r=b.session.addMarker(h,"ace_selection",b.getSelectionStyle()),b.clearSelection(),b.isFocused()&&b.renderer.$cursorLayer.setBlinking(!1),clearInterval(l),e(),l=setInterval(e,20),k=0,x.addListener(document,"mousemove",n)}function o(){clearInterval(l),b.session.removeMarker(r),r=null,b.selection.fromOrientedRange(h),b.isFocused()&&!m&&b.$resetCursorStyle(),k=0,g=f=u=h=null,x.removeListener(document,"mousemove",n)}function n(){null==w&&(w=setTimeout(function(){null!=w&&r&&o()},20))}function s(e){e=e.types;return!e||Array.prototype.some.call(e,function(e){return"text/plain"==e||"Text"==e})}function a(e){var t=["copy","copymove","all","uninitialized"],i=C.isMac?e.altKey:e.ctrlKey,o="uninitialized";try{o=e.dataTransfer.effectAllowed.toLowerCase()}catch(e){}var n="none";return i&&0<=t.indexOf(o)?n="copy":0<=["move","copymove","linkmove","all","uninitialized"].indexOf(o)?n="move":0<=t.indexOf(o)&&(n="copy"),n}var r,c,d,l,h,u,p,m,f,g,_,b=t.editor,y=S.createElement("div"),v=(y.style.cssText="top:-100px;position:absolute;z-index:2147483647;opacity:0.5",y.textContent="",["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"].forEach(function(e){t[e]=this[e]},this),b.on("mousedown",this.onMouseDown.bind(t)),b.container),k=0,w=(this.onDragStart=function(e){var t;if(this.cancelDrag||!v.draggable)return t=this,setTimeout(function(){t.startSelect(),t.captureMouse(e)},0),e.preventDefault();h=b.getSelectionRange();var i=e.dataTransfer;i.effectAllowed=b.getReadOnly()?"copy":"copyMove",b.container.appendChild(y),i.setDragImage&&i.setDragImage(y,0,0),setTimeout(function(){b.container.removeChild(y)}),i.clearData(),i.setData("Text",b.session.getTextRange()),m=!0,this.setState("drag")},this.onDragEnd=function(e){v.draggable=!1,m=!1,this.setState(null),b.getReadOnly()||(e=e.dataTransfer.dropEffect,p||"move"!=e||b.session.remove(b.getSelectionRange()),b.$resetCursorStyle()),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle("")},this.onDragEnter=function(e){if(!b.getReadOnly()&&s(e.dataTransfer))return c=e.clientX,d=e.clientY,r||i(),k++,e.dataTransfer.dropEffect=p=a(e),x.preventDefault(e)},this.onDragOver=function(e){if(!b.getReadOnly()&&s(e.dataTransfer))return c=e.clientX,d=e.clientY,r||(i(),k++),null!==w&&(w=null),e.dataTransfer.dropEffect=p=a(e),x.preventDefault(e)},this.onDragLeave=function(e){if(--k<=0&&r)return o(),p=null,x.preventDefault(e)},this.onDrop=function(e){if(u){var t=e.dataTransfer;if(m)switch(p){case"move":h=h.contains(u.row,u.column)?{start:u,end:u}:b.moveText(h,u);break;case"copy":h=b.moveText(h,u,!0)}else{t=t.getData("Text");h={start:u,end:b.session.insert(u,t)},b.focus(),p=null}return o(),x.preventDefault(e)}},x.addListener(v,"dragstart",this.onDragStart.bind(t),b),x.addListener(v,"dragend",this.onDragEnd.bind(t),b),x.addListener(v,"dragenter",this.onDragEnter.bind(t),b),x.addListener(v,"dragover",this.onDragOver.bind(t),b),x.addListener(v,"dragleave",this.onDragLeave.bind(t),b),x.addListener(v,"drop",this.onDrop.bind(t),b),null)}function T(e,t,i,o){return Math.sqrt(Math.pow(i-e,2)+Math.pow(o-t,2))}var S=e("../lib/dom"),x=e("../lib/event"),C=e("../lib/useragent");(function(){this.dragWait=function(){Date.now()-this.mousedownEvent.time>this.editor.getDragDelay()&&this.startDrag()},this.dragWaitEnd=function(){this.editor.container.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(e){this.editor.$resetCursorStyle(),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle(""),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var e=this.editor,t=(e.container.draggable=!0,e.renderer.$cursorLayer.setBlinking(!1),e.setStyle("ace_dragging"),C.isWin?"default":"move");e.renderer.setCursorStyle(t),this.setState("dragReady")},this.onMouseDrag=function(e){var t=this.editor.container;C.isIE&&"dragReady"==this.state&&3<T(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y)&&t.dragDrop(),"dragWait"===this.state&&0<T(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y)&&(t.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()))},this.onMouseDown=function(e){var t,i,o;this.$dragEnabled&&(this.mousedownEvent=e,t=this.editor,i=e.inSelection(),o=e.getButton(),1!==(e.domEvent.detail||1)||0!==o||!i||e.editor.inMultiSelectMode&&(e.getAccelKey()||e.getShiftKey())||(this.mousedownEvent.time=Date.now(),"unselectable"in(o=e.domEvent.target||e.domEvent.srcElement)&&(o.unselectable="on"),t.getDragDelay()?(C.isWebKit&&(this.cancelDrag=!0,t.container.draggable=!0),this.setState("dragWait")):this.startDrag(),this.captureMouse(e,this.onMouseDrag.bind(this)),e.defaultPrevented=!0))}}).call(o.prototype),t.DragdropHandler=o}),define("ace/mouse/touch_handler",["require","exports","module","ace/mouse/mouse_event","ace/lib/event","ace/lib/dom"],function(e,t,i){"use strict";var S=e("./mouse_event").MouseEvent,o=e("../lib/event"),r=e("../lib/dom");t.addTouchListeners=function(e,d){function n(){function t(e){var t,i=e.target.getAttribute("action");"more"!=i&&n?("paste"==i?o.readText().then(function(e){d.execCommand(i,e)}):i&&("cut"!=i&&"copy"!=i||(o?o.writeText(d.getCopyText()):document.execCommand("copy")),d.execCommand(i)),a.firstChild.style.display="none",n=!1,"openCommandPallete"!=i&&d.focus()):(n=!n,e=d.getCopyText(),t=d.session.getUndoManager().hasUndo(),a.replaceChild(r.buildDom(n?["span",!e&&["span",{class:"ace_mobile-button",action:"selectall"},"Select All"],e&&["span",{class:"ace_mobile-button",action:"copy"},"Copy"],e&&["span",{class:"ace_mobile-button",action:"cut"},"Cut"],o&&["span",{class:"ace_mobile-button",action:"paste"},"Paste"],t&&["span",{class:"ace_mobile-button",action:"undo"},"Undo"],["span",{class:"ace_mobile-button",action:"find"},"Find"],["span",{class:"ace_mobile-button",action:"openCommandPallete"},"Palette"]]:["span"]),a.firstChild))}var o=window.navigator&&window.navigator.clipboard,n=!1;a=r.buildDom(["div",{class:"ace_mobile-menu",ontouchstart:function(e){y="menu",e.stopPropagation(),e.preventDefault(),d.textInput.focus()},ontouchend:function(e){e.stopPropagation(),e.preventDefault(),t(e)},onclick:t},["span"],["span",{class:"ace_mobile-button",action:"more"},"..."]],d.container)}function i(){a||n();var e=d.selection.cursor,e=d.renderer.textToScreenCoordinates(e.row,e.column),t=d.renderer.textToScreenCoordinates(0,0).pageX,i=d.renderer.scrollLeft,o=d.container.getBoundingClientRect();a.style.top=e.pageY-o.top-3+"px",e.pageX-o.left<o.width-70?(a.style.left="",a.style.right="10px"):(a.style.right="",a.style.left=t+i-o.left+"px"),a.style.display="",a.firstChild.style.display="none",d.on("input",s)}function s(e){a&&(a.style.display="none"),d.off("input",s)}function h(){g=null,clearTimeout(g);var e=d.selection.getRange(),t=e.contains(_.row,_.column);!e.isEmpty()&&t||(d.selection.moveToPosition(_),d.selection.selectWord()),y="wait",i()}var u,p,m,f,g,t,_,b,a,y="scroll",v=0,k=0,w=0,T=0;o.addListener(e,"contextmenu",function(e){b&&d.textInput.getElement().focus()},d),o.addListener(e,"touchstart",function(e){var t=e.touches;if(g||1<t.length)clearTimeout(g),g=null,m=-1,y="zoom";else{b=d.$mouseHandler.isMousePressed=!0;var i=d.renderer.layerConfig.lineHeight,o=d.renderer.layerConfig.lineHeight,n=e.timeStamp,s=(f=n,t[0]),a=s.clientX,s=s.clientY,a=(Math.abs(u-a)+Math.abs(p-s)>i&&(m=-1),u=e.clientX=a,p=e.clientY=s,w=T=0,new S(e,d));if(_=a.getDocumentPosition(),n-m<500&&1==t.length&&!v)k++,e.preventDefault(),e.button=0,g=null,clearTimeout(g),d.selection.moveToPosition(_),(s=2<=k?d.selection.getLineRange(_.row):d.session.getBracketRange(_))&&!s.isEmpty()?d.selection.setRange(s):d.selection.selectWord(),y="wait";else{k=0;var a=d.selection.cursor,t=d.selection.isEmpty()?a:d.selection.anchor,s=d.renderer.$cursorLayer.getPixelPosition(a,!0),a=d.renderer.$cursorLayer.getPixelPosition(t,!0),t=d.renderer.scroller.getBoundingClientRect(),r=d.renderer.layerConfig.offset,l=d.renderer.scrollLeft,c=function(e,t){return(e/=o)*e+(t=t/i-.75)*t};if(e.clientX<t.left)return void(y="zoom");s=c(e.clientX-t.left-s.left+l,e.clientY-t.top-s.top+r),c=c(e.clientX-t.left-a.left+l,e.clientY-t.top-a.top+r);s<3.5&&c<3.5&&(y=c<s?"cursor":"anchor"),y=c<3.5?"anchor":s<3.5?"cursor":"scroll",g=setTimeout(h,450)}m=n}},d),o.addListener(e,"touchend",function(e){b=d.$mouseHandler.isMousePressed=!1,t&&clearInterval(t),"zoom"==y?(y="",v=0):g?(d.selection.moveToPosition(_),v=0,i()):"scroll"==y?(v+=60,t=setInterval(function(){v--<=0&&(clearInterval(t),t=null),Math.abs(w)<.01&&(w=0),Math.abs(T)<.01&&(T=0),v<20&&(w*=.9),v<20&&(T*=.9);var e=d.session.getScrollTop();d.renderer.scrollBy(10*w,10*T),e==d.session.getScrollTop()&&(v=0)},10),s()):i(),clearTimeout(g),g=null},d),o.addListener(e,"touchmove",function(e){g&&(clearTimeout(g),g=null);var t=e.touches;if(!(1<t.length||"zoom"==y)){var t=t[0],i=u-t.clientX,o=p-t.clientY;if("wait"==y){if(!(4<i*i+o*o))return e.preventDefault();y="cursor"}u=t.clientX,p=t.clientY,e.clientX=t.clientX,e.clientY=t.clientY;var t=e.timeStamp,n=t-f;f=t,"scroll"==y?((t=new S(e,d)).speed=1,t.wheelX=i,t.wheelY=o,10*Math.abs(i)<Math.abs(o)&&(i=0),10*Math.abs(o)<Math.abs(i)&&(o=0),0!=n&&(w=i/n,T=o/n),d._emit("mousewheel",t),t.propagationStopped||(w=T=0)):(i=new S(e,d).getDocumentPosition(),"cursor"==y?d.selection.moveCursorToPosition(i):"anchor"==y&&d.selection.setSelectionAnchor(i.row,i.column),d.renderer.scrollCursorIntoView(i),e.preventDefault())}},d)}}),define("ace/mouse/mouse_handler",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/mouse/default_handlers","ace/mouse/default_gutter_handler","ace/mouse/mouse_event","ace/mouse/dragdrop_handler","ace/mouse/touch_handler","ace/config"],function(e,t,i){"use strict";function o(o){function e(e){document.hasFocus&&document.hasFocus()&&(o.isFocused()||document.activeElement!=(o.textInput&&o.textInput.getElement()))||window.focus(),o.focus(),setTimeout(function(){o.isFocused()||o.focus()})}var n=this,t=(this.editor=o,new s(this),new a(this),new r(this),o.renderer.getMouseEventTarget()),i=(d.addListener(t,"click",this.onMouseEvent.bind(this,"click"),o),d.addListener(t,"mousemove",this.onMouseMove.bind(this,"mousemove"),o),d.addMultiMouseDownListener([t,o.renderer.scrollBarV&&o.renderer.scrollBarV.inner,o.renderer.scrollBarH&&o.renderer.scrollBarH.inner,o.textInput&&o.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent",o),d.addMouseWheelListener(o.container,this.onMouseWheel.bind(this,"mousewheel"),o),l(o.container,o),o.renderer.$gutter);d.addListener(i,"mousedown",this.onMouseEvent.bind(this,"guttermousedown"),o),d.addListener(i,"click",this.onMouseEvent.bind(this,"gutterclick"),o),d.addListener(i,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick"),o),d.addListener(i,"mousemove",this.onMouseEvent.bind(this,"guttermousemove"),o),d.addListener(t,"mousedown",e,o),d.addListener(i,"mousedown",e,o),h.isIE&&o.renderer.scrollBarV&&(d.addListener(o.renderer.scrollBarV.element,"mousedown",e,o),d.addListener(o.renderer.scrollBarH.element,"mousedown",e,o)),o.on("mousemove",function(e){var t,i;n.state||n.$dragDelay||!n.$dragEnabled||(e=o.renderer.screenToTextCoordinates(e.x,e.y),t=o.session.selection.getRange(),i=o.renderer,!t.isEmpty()&&t.insideStart(e.row,e.column)?i.setCursorStyle("default"):i.setCursorStyle(""))},o)}var d=e("../lib/event"),h=e("../lib/useragent"),s=e("./default_handlers").DefaultHandlers,a=e("./default_gutter_handler").GutterHandler,u=e("./mouse_event").MouseEvent,r=e("./dragdrop_handler").DragdropHandler,l=e("./touch_handler").addTouchListeners,e=e("../config");(function(){this.onMouseEvent=function(e,t){this.editor.session&&this.editor._emit(e,new u(t,this.editor))},this.onMouseMove=function(e,t){var i=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;i&&i.length&&this.editor._emit(e,new u(t,this.editor))},this.onMouseWheel=function(e,t){var i=new u(t,this.editor);i.speed=2*this.$scrollSpeed,i.wheelX=t.wheelX,i.wheelY=t.wheelY,this.editor._emit(e,i)},this.setState=function(e){this.state=e},this.captureMouse=function(e,t){this.x=e.x,this.y=e.y,this.isMousePressed=!0;function i(e){if(e)return h.isWebKit&&!e.which&&r.releaseMouse?r.releaseMouse():(r.x=e.clientX,r.y=e.clientY,t&&t(e),r.mouseEvent=new u(e,r.editor),void(r.$mouseMoved=!0))}function o(e){s.off("beforeEndOperation",l),clearInterval(c),s.session&&n(),r[r.state+"End"]&&r[r.state+"End"](e),r.state="",r.isMousePressed=a.$isMousePressed=!1,a.$keepTextAreaAtCursor&&a.$moveTextAreaToCursor(),r.$onCaptureMouseMove=r.releaseMouse=null,e&&r.onMouseEvent("mouseup",e),s.endOperation()}function n(){r[r.state]&&r[r.state](),r.$mouseMoved=!1}var s=this.editor,a=this.editor.renderer,r=(a.$isMousePressed=!0,this);if(h.isOldIE&&"dblclick"==e.domEvent.type)return setTimeout(function(){o(e)});var l=function(e){r.releaseMouse&&s.curOp.command.name&&s.curOp.selectionChanged&&(r[r.state+"End"]&&r[r.state+"End"](),r.state="",r.releaseMouse())},c=(s.on("beforeEndOperation",l),s.startOperation({command:{name:"mouse"}}),r.$onCaptureMouseMove=i,r.releaseMouse=d.capture(this.editor.container,i,o),setInterval(n,20))},this.releaseMouse=null,this.cancelContextMenu=function(){var t=function(e){e&&e.domEvent&&"contextmenu"!=e.domEvent.type||(this.editor.off("nativecontextmenu",t),e&&e.domEvent&&d.stopEvent(e.domEvent))}.bind(this);setTimeout(t,10),this.editor.on("nativecontextmenu",t)},this.destroy=function(){this.releaseMouse&&this.releaseMouse()}}).call(o.prototype),e.defineOptions(o.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:h.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),t.MouseHandler=o}),define("ace/mouse/fold_handler",["require","exports","module","ace/lib/dom"],function(e,t,i){"use strict";var o=e("../lib/dom");t.FoldHandler=function(n){n.on("click",function(e){var t=e.getDocumentPosition(),i=n.session,t=i.getFoldAt(t.row,t.column,1),t=(t&&(e.getAccelKey()?i.removeFold(t):i.expandFold(t),e.stop()),e.domEvent&&e.domEvent.target);t&&o.hasCssClass(t,"ace_inline_button")&&o.hasCssClass(t,"ace_toggle_wrap")&&(i.setOption("wrap",!i.getUseWrapMode()),n.renderer.scrollCursorIntoView())}),n.on("gutterclick",function(e){var t,i;"foldWidgets"==n.renderer.$gutterLayer.getRegion(e)&&(t=e.getDocumentPosition().row,(i=n.session).foldWidgets&&i.foldWidgets[t]&&n.session.onFoldWidgetClick(t,e),n.isFocused()||n.focus(),e.stop())}),n.on("gutterdblclick",function(e){var t,i,o;"foldWidgets"==n.renderer.$gutterLayer.getRegion(e)&&(o=e.getDocumentPosition().row,(i=(i=(t=n.session).getParentFoldRangeData(o,!0)).range||i.firstRange)&&(o=i.start.row,(o=t.getFoldAt(o,t.getLine(o).length,1))?t.removeFold(o):(t.addFold("...",i),n.renderer.scrollCursorIntoView({row:i.start.row,column:0}))),e.stop())})}}),define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"],function(e,t,i){"use strict";function o(e){this.$editor=e,this.$data={editor:e},this.$handlers=[],this.setDefaultHandler(e.commands)}var n=e("../lib/keys"),l=e("../lib/event");(function(){this.setDefaultHandler=function(e){this.removeKeyboardHandler(this.$defaultHandler),this.$defaultHandler=e,this.addKeyboardHandler(e,0)},this.setKeyboardHandler=function(e){var t=this.$handlers;if(t[t.length-1]!=e){for(;t[t.length-1]&&t[t.length-1]!=this.$defaultHandler;)this.removeKeyboardHandler(t[t.length-1]);this.addKeyboardHandler(e,1)}},this.addKeyboardHandler=function(e,t){var i;e&&("function"!=typeof e||e.handleKeyboard||(e.handleKeyboard=e),-1!=(i=this.$handlers.indexOf(e))&&this.$handlers.splice(i,1),null==t?this.$handlers.push(e):this.$handlers.splice(t,0,e),-1==i&&e.attach&&e.attach(this.$editor))},this.removeKeyboardHandler=function(e){var t=this.$handlers.indexOf(e);return-1!=t&&(this.$handlers.splice(t,1),e.detach&&e.detach(this.$editor),!0)},this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]},this.getStatusText=function(){var t=this.$data,i=t.editor;return this.$handlers.map(function(e){return e.getStatusText&&e.getStatusText(i,t)||""}).filter(Boolean).join(" ")},this.$callKeyboardHandlers=function(e,t,i,o){for(var n,s=!1,a=this.$editor.commands,r=this.$handlers.length;r--&&!((n=this.$handlers[r].handleKeyboard(this.$data,e,t,i,o))&&n.command&&((s="null"==n.command||a.exec(n.command,this.$editor,n.args,o))&&o&&-1!=e&&1!=n.passEvent&&1!=n.command.passEvent&&l.stopEvent(o),s)););return s||-1!=e||(n={command:"insertstring"},s=a.exec("insertstring",this.$editor,t)),s&&this.$editor._signal&&this.$editor._signal("keyboardActivity",n),s},this.onCommandKey=function(e,t,i){var o=n.keyCodeToString(i);return this.$callKeyboardHandlers(t,o,i,e)},this.onTextInput=function(e){return this.$callKeyboardHandlers(-1,e)}}).call(o.prototype),t.KeyBinding=o}),define("ace/lib/bidiutil",["require","exports","module"],function(e,l,t){"use strict";function c(e,t,i,o){var n,s,a,r=f?k:v,l=0,c=-1,d=null,h=null,u=[];if(!o)for(d=0,o=[];d<i;d++)o[d]=m(e[d]);for(g=f,y=b=_=!1,h=0;h<i;h++){if(a=l,u[h]=n=function(e,t,i,o){var n,s,a,r=t[o];switch(r){case w:case T:_=!1;case C:case x:return r;case S:return _?x:S;case A:return _=!0,T;case I:return C;case R:return o<1||o+1>=t.length||(n=i[o-1])!=S&&n!=x||(l=t[o+1])!=S&&l!=x?C:(l=_?x:l)==n?l:C;case E:return(n=0<o?i[o-1]:D)==S&&o+1<t.length&&t[o+1]==S?S:C;case P:if(0<o&&i[o-1]==S)return S;if(_)return C;for(a=o+1,s=t.length;a<s&&t[a]==P;)a++;return a<s&&t[a]==S?S:C;case M:for(s=t.length,a=o+1;a<s&&t[a]==M;)a++;if(a<s){var l=e[o],l=1425<=l&&l<=2303||64286==l;if(n=t[a],l&&(n==T||n==A))return T}return o<1||(n=t[o-1])==D?C:i[o-1];case D:return b=!(_=!1),f;case L:return y=!0,C;case j:case O:case F:case B:case N:_=!1;case $:return C}}(e,o,u,h),a=240&(l=r[a][n]),l&=15,t[h]=s=r[l][5],0<a){if(16==a)for(d=c;d<h;d++)t[d]=1;c=-1}if(r[l][6])-1==c&&(c=h);else if(-1<c){for(d=c;d<h;d++)t[d]=s;c=-1}o[h]==D&&(t[h]=0),g|=s}if(y)for(d=0;d<i;d++)if(o[d]==L){t[d]=f;for(var p=d-1;0<=p&&o[p]==I;p--)t[p]=f}}function d(e,t,i){if(!(g<e))if(1!=e||1!=f||b)for(var o,n,s,a,r=i.length,l=0;l<r;){if(t[l]>=e){for(o=l+1;o<r&&t[o]>=e;)o++;for(n=l,s=o-1;n<s;n++,s--)a=i[n],i[n]=i[s],i[s]=a;l=o}l++}else i.reverse()}function m(e){var t=e.charCodeAt(0),i=t>>8;return 0==i?191<t?w:o[t]:5==i?/[\u0591-\u05f4]/.test(e)?T:w:6==i?/[\u0610-\u061a\u064b-\u065f\u06d6-\u06e4\u06e7-\u06ed]/.test(e)?M:/[\u0660-\u0669\u066b-\u066c]/.test(e)?x:1642==t?P:/[\u06f0-\u06f9]/.test(e)?S:A:32==i&&t<=8287?n[255&t]:254==i&&65136<=t?A:C}var f=0,g=0,_=!1,b=!1,y=!1,v=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],k=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],w=0,T=1,S=2,x=3,C=4,D=5,L=6,A=7,I=8,R=9,E=10,P=11,M=12,j=13,O=14,N=15,F=16,B=17,$=18,o=[$,$,$,$,$,$,$,$,$,L,D,L,I,D,$,$,$,$,$,$,$,$,$,$,$,$,$,$,D,D,D,L,I,C,C,P,P,P,C,C,C,C,C,E,R,E,R,R,S,S,S,S,S,S,S,S,S,S,R,C,C,C,C,C,C,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,C,C,C,C,C,C,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,C,C,C,C,$,$,$,$,$,$,D,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,R,C,P,P,P,P,C,C,C,C,w,C,C,$,C,C,P,P,S,S,C,w,C,C,C,S,w,C,C,C,C,C],n=[I,I,I,I,I,I,I,I,I,I,I,$,$,$,w,T,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,I,D,j,O,N,F,B,R,P,P,P,P,P,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,R,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,I];l.L=w,l.R=T,l.EN=S,l.ON_R=3,l.AN=4,l.R_H=5,l.B=6,l.RLE=7,l.DOT="",l.doBidiReorder=function(e,t,i){if(e.length<2)return{};var o=e.split(""),n=new Array(o.length),s=new Array(o.length),a=[];f=i?1:0,c(o,a,o.length,t);for(var r=0;r<n.length;n[r]=r,r++);d(2,a,n),d(1,a,n);for(r=0;r<n.length-1;r++)t[r]===x?a[r]=l.AN:a[r]===T&&(t[r]>A&&t[r]<j||t[r]===C||t[r]===$)?a[r]=l.ON_R:0<r&&""===o[r-1]&&/\u0622|\u0623|\u0625|\u0627/.test(o[r])&&(a[r-1]=a[r]=l.R_H,r++);o[o.length-1]===l.DOT&&(a[o.length-1]=l.B),""===o[0]&&(a[0]=l.RLE);for(r=0;r<n.length;r++)s[r]=a[n[r]];return{logicalFromVisual:n,bidiLevels:s}},l.hasBidiCharacters=function(e,t){for(var i=!1,o=0;o<e.length;o++)t[o]=m(e.charAt(o)),i||t[o]!=T&&t[o]!=A&&t[o]!=x||(i=!0);return i},l.getVisualFromLogicalIdx=function(e,t){for(var i=0;i<t.logicalFromVisual.length;i++)if(t.logicalFromVisual[i]==e)return i;return 0}}),define("ace/bidihandler",["require","exports","module","ace/lib/bidiutil","ace/lib/lang"],function(e,t,i){"use strict";function o(e){this.session=e,this.bidiMap={},this.currentRow=null,this.bidiUtil=r,this.charWidths=[],this.EOL="",this.showInvisibles=!0,this.isRtlDir=!1,this.$isRtl=!1,this.line="",this.wrapIndent=0,this.EOF="",this.RLE="",this.contentWidth=0,this.fontMetrics=null,this.rtlLineOffset=0,this.wrapOffset=0,this.isMoveLeftOperation=!1,this.seenBidi=n.test(e.getValue())}var r=e("./lib/bidiutil"),a=e("./lib/lang"),n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\u202B]/;(function(){this.isBidiRow=function(e,t,i){return!!this.seenBidi&&(e!==this.currentRow&&(this.currentRow=e,this.updateRowLine(t,i),this.updateBidiMap()),this.bidiMap.bidiLevels)},this.onChange=function(e){this.seenBidi?this.currentRow=null:"insert"==e.action&&n.test(e.lines.join("\n"))&&(this.seenBidi=!0,this.currentRow=null)},this.getDocumentRow=function(){var e=0,t=this.session.$screenRowCache;return e=t.length&&0<=(t=this.session.$getRowCacheIndex(t,this.currentRow))?this.session.$docRowCache[t]:e},this.getSplitIndex=function(){var e=0,t=this.session.$screenRowCache;if(t.length)for(var i,o=this.session.$getRowCacheIndex(t,this.currentRow);0<this.currentRow-e&&(i=this.session.$getRowCacheIndex(t,this.currentRow-e-1))===o;)o=i,e++;else e=this.currentRow;return e},this.updateRowLine=function(e,t){var i,o=(e=void 0===e?this.getDocumentRow():e)===this.session.getLength()-1?this.EOF:this.EOL,n=(this.wrapIndent=0,this.line=this.session.getLine(e),this.isRtlDir=this.$isRtl||this.line.charAt(0)===this.RLE,this.session.$useWrapMode?(e=this.session.$wrapData[e])&&(0<(t=void 0===t?this.getSplitIndex():t)&&e.length?(this.wrapIndent=e.indent,this.wrapOffset=this.wrapIndent*this.charWidths[r.L],this.line=t<e.length?this.line.substring(e[t-1],e[t]):this.line.substring(e[e.length-1])):this.line=this.line.substring(0,e[t]),t==e.length&&(this.line+=this.showInvisibles?o:r.DOT)):this.line+=this.showInvisibles?o:r.DOT,this.session),s=0;this.line=this.line.replace(/\t|[\u1100-\u2029, \u202F-\uFFE6]/g,function(e,t){return"\t"===e||n.isFullWidth(e.charCodeAt(0))?(i="\t"===e?n.getScreenTabSize(t+s):2,s+=i-1,a.stringRepeat(r.DOT,i)):e}),this.isRtlDir&&(this.fontMetrics.$main.textContent=this.line.charAt(this.line.length-1)==r.DOT?this.line.substr(0,this.line.length-1):this.line,this.rtlLineOffset=this.contentWidth-this.fontMetrics.$main.getBoundingClientRect().width)},this.updateBidiMap=function(){var e=[];r.hasBidiCharacters(this.line,e)||this.isRtlDir?this.bidiMap=r.doBidiReorder(this.line,e,this.isRtlDir):this.bidiMap={}},this.markAsDirty=function(){this.currentRow=null},this.updateCharacterWidths=function(e){var t;this.characterWidth!==e.$characterSize.width&&(this.fontMetrics=e,t=this.characterWidth=e.$characterSize.width,e=e.$measureCharWidth(""),this.charWidths[r.L]=this.charWidths[r.EN]=this.charWidths[r.ON_R]=t,this.charWidths[r.R]=this.charWidths[r.AN]=e,this.charWidths[r.R_H]=.45*e,this.charWidths[r.B]=this.charWidths[r.RLE]=0,this.currentRow=null)},this.setShowInvisibles=function(e){this.showInvisibles=e,this.currentRow=null},this.setEolChar=function(e){this.EOL=e},this.setContentWidth=function(e){this.contentWidth=e},this.isRtlLine=function(e){return!!this.$isRtl||(null!=e?this.session.getLine(e).charAt(0)==this.RLE:this.isRtlDir)},this.setRtlDirection=function(e,t){for(var i=e.getCursorPosition(),o=e.selection.getSelectionAnchor().row;o<=i.row;o++)t||e.session.getLine(o).charAt(0)!==e.session.$bidiHandler.RLE?t&&e.session.getLine(o).charAt(0)!==e.session.$bidiHandler.RLE&&e.session.doc.insert({column:0,row:o},e.session.$bidiHandler.RLE):e.session.doc.removeInLine(o,0,1)},this.getPosLeft=function(e){e-=this.wrapIndent;var t=this.line.charAt(0)===this.RLE?1:0,i=t<e?this.session.getOverwrite()?e:e-1:t,o=r.getVisualFromLogicalIdx(i,this.bidiMap),n=this.bidiMap.bidiLevels,s=0;!this.session.getOverwrite()&&e<=t&&n[o]%2!=0&&o++;for(var a=0;a<o;a++)s+=this.charWidths[n[a]];return!this.session.getOverwrite()&&t<e&&n[o]%2==0&&(s+=this.charWidths[n[o]]),this.wrapIndent&&(s+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset),this.isRtlDir&&(s+=this.rtlLineOffset),s},this.getSelections=function(e,t){var i,o=this.bidiMap,n=o.bidiLevels,s=[],a=0,r=Math.min(e,t)-this.wrapIndent,l=Math.max(e,t)-this.wrapIndent,c=!1,d=!1,h=0;this.wrapIndent&&(a+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);for(var u,p=0;p<n.length;p++)u=o.logicalFromVisual[p],i=n[p],(c=r<=u&&u<l)&&!d?h=a:!c&&d&&s.push({left:h,width:a-h}),a+=this.charWidths[i],d=c;if(c&&p===n.length&&s.push({left:h,width:a-h}),this.isRtlDir)for(var m=0;m<s.length;m++)s[m].left+=this.rtlLineOffset;return s},this.offsetToCol=function(e){this.isRtlDir&&(e-=this.rtlLineOffset);var t=0,e=Math.max(e,0),i=0,o=0,n=this.bidiMap.bidiLevels,s=this.charWidths[n[o]];for(this.wrapIndent&&(e-=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);i+s/2<e;){if(i+=s,o===n.length-1){s=0;break}s=this.charWidths[n[++o]]}return 0===(t=0<o&&n[o-1]%2!=0&&n[o]%2==0?(e<i&&o--,this.bidiMap.logicalFromVisual[o]):0<o&&n[o-1]%2==0&&n[o]%2!=0?1+(i<e?this.bidiMap.logicalFromVisual[o]:this.bidiMap.logicalFromVisual[o-1]):this.isRtlDir&&o===n.length-1&&0===s&&n[o-1]%2==0||!this.isRtlDir&&0===o&&n[o]%2!=0?1+this.bidiMap.logicalFromVisual[o]:(0<o&&n[o-1]%2!=0&&0!==s&&o--,this.bidiMap.logicalFromVisual[o]))&&this.isRtlDir&&t++,t+this.wrapIndent}}).call(o.prototype),t.BidiHandler=o}),define("ace/selection",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/range"],function(e,t,i){"use strict";function o(e){this.session=e,this.doc=e.getDocument(),this.clearSelection(),this.cursor=this.lead=this.doc.createAnchor(0,0),this.anchor=this.doc.createAnchor(0,0),this.$silent=!1;var t=this;this.cursor.on("change",function(e){t.$cursorChanged=!0,t.$silent||t._emit("changeCursor"),t.$isEmpty||t.$silent||t._emit("changeSelection"),t.$keepDesiredColumnOnChange||e.old.column==e.value.column||(t.$desiredColumn=null)}),this.anchor.on("change",function(){t.$anchorChanged=!0,t.$isEmpty||t.$silent||t._emit("changeSelection")})}var n=e("./lib/oop"),s=e("./lib/lang"),a=e("./lib/event_emitter").EventEmitter,r=e("./range").Range;(function(){n.implement(this,a),this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column},this.isMultiLine=function(){return!this.$isEmpty&&this.anchor.row!=this.cursor.row},this.getCursor=function(){return this.lead.getPosition()},this.setSelectionAnchor=function(e,t){this.$isEmpty=!1,this.anchor.setPosition(e,t)},this.getAnchor=this.getSelectionAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()},this.getSelectionLead=function(){return this.lead.getPosition()},this.isBackwards=function(){var e=this.anchor,t=this.lead;return e.row>t.row||e.row==t.row&&e.column>t.column},this.getRange=function(){var e=this.anchor,t=this.lead;return this.$isEmpty?r.fromPoints(t,t):this.isBackwards()?r.fromPoints(t,e):r.fromPoints(e,t)},this.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit("changeSelection"))},this.selectAll=function(){this.$setSelection(0,0,Number.MAX_VALUE,Number.MAX_VALUE)},this.setRange=this.setSelectionRange=function(e,t){var i=t?e.end:e.start,t=t?e.start:e.end;this.$setSelection(i.row,i.column,t.row,t.column)},this.$setSelection=function(e,t,i,o){var n,s;this.$silent||(n=this.$isEmpty,s=this.inMultiSelectMode,this.$silent=!0,this.$cursorChanged=this.$anchorChanged=!1,this.anchor.setPosition(e,t),this.cursor.setPosition(i,o),this.$isEmpty=!r.comparePoints(this.anchor,this.cursor),this.$silent=!1,this.$cursorChanged&&this._emit("changeCursor"),(this.$cursorChanged||this.$anchorChanged||n!=this.$isEmpty||s)&&this._emit("changeSelection"))},this.$moveSelection=function(e){var t=this.lead;this.$isEmpty&&this.setSelectionAnchor(t.row,t.column),e.call(this)},this.selectTo=function(e,t){this.$moveSelection(function(){this.moveCursorTo(e,t)})},this.selectToPosition=function(e){this.$moveSelection(function(){this.moveCursorToPosition(e)})},this.moveTo=function(e,t){this.clearSelection(),this.moveCursorTo(e,t)},this.moveToPosition=function(e){this.clearSelection(),this.moveCursorToPosition(e)},this.selectUp=function(){this.$moveSelection(this.moveCursorUp)},this.selectDown=function(){this.$moveSelection(this.moveCursorDown)},this.selectRight=function(){this.$moveSelection(this.moveCursorRight)},this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},this.getWordRange=function(e,t){var i;return void 0===t&&(e=(i=e||this.lead).row,t=i.column),this.session.getWordRange(e,t)},this.selectWord=function(){this.setSelectionRange(this.getWordRange())},this.selectAWord=function(){var e=this.getCursor(),e=this.session.getAWordRange(e.row,e.column);this.setSelectionRange(e)},this.getLineRange=function(e,t){var e="number"==typeof e?e:this.lead.row,i=this.session.getFoldLine(e),i=i?(e=i.start.row,i.end.row):e;return!0===t?new r(e,0,i,this.session.getLine(i).length):new r(e,0,i+1,0)},this.selectLine=function(){this.setSelectionRange(this.getLineRange())},this.moveCursorUp=function(){this.moveCursorBy(-1,0)},this.moveCursorDown=function(){this.moveCursorBy(1,0)},this.wouldMoveIntoSoftTab=function(e,t,i){var o=e.column,n=e.column+t;return i<0&&(o=e.column-t,n=e.column),this.session.isTabStop(e)&&this.doc.getLine(e.row).slice(o,n).split(" ").length-1==t},this.moveCursorLeft=function(){var e,t=this.lead.getPosition();(e=this.session.getFoldAt(t.row,t.column,-1))?this.moveCursorTo(e.start.row,e.start.column):0===t.column?0<t.row&&this.moveCursorTo(t.row-1,this.doc.getLine(t.row-1).length):(e=this.session.getTabSize(),this.wouldMoveIntoSoftTab(t,e,-1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,-e):this.moveCursorBy(0,-1))},this.moveCursorRight=function(){var e,t=this.lead.getPosition();(e=this.session.getFoldAt(t.row,t.column,1))?this.moveCursorTo(e.end.row,e.end.column):this.lead.column==this.doc.getLine(this.lead.row).length?this.lead.row<this.doc.getLength()-1&&this.moveCursorTo(this.lead.row+1,0):(e=this.session.getTabSize(),t=this.lead,this.wouldMoveIntoSoftTab(t,e,1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,e):this.moveCursorBy(0,1))},this.moveCursorLineStart=function(){var e=this.lead.row,t=this.lead.column,i=this.session.documentToScreenRow(e,t),i=this.session.screenToDocumentPosition(i,0),e=this.session.getDisplayLine(e,null,i.row,i.column).match(/^\s*/);e[0].length==t||this.session.$useEmacsStyleLineStart||(i.column+=e[0].length),this.moveCursorToPosition(i)},this.moveCursorLineEnd=function(){var e,t=this.lead,t=this.session.getDocumentLastRowColumnPosition(t.row,t.column);this.lead.column==t.column&&(e=this.session.getLine(t.row),t.column==e.length&&0<(e=e.search(/\s+$/))&&(t.column=e)),this.moveCursorTo(t.row,t.column)},this.moveCursorFileEnd=function(){var e=this.doc.getLength()-1,t=this.doc.getLine(e).length;this.moveCursorTo(e,t)},this.moveCursorFileStart=function(){this.moveCursorTo(0,0)},this.moveCursorLongWordRight=function(){var e=this.lead.row,t=this.lead.column,i=this.doc.getLine(e),o=i.substring(t),n=(this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.getFoldAt(e,t,1));n?this.moveCursorTo(n.end.row,n.end.column):(this.session.nonTokenRe.exec(o)&&(t+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,o=i.substring(t)),t>=i.length?(this.moveCursorTo(e,i.length),this.moveCursorRight(),e<this.doc.getLength()-1&&this.moveCursorWordRight()):(this.session.tokenRe.exec(o)&&(t+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(e,t)))},this.moveCursorLongWordLeft=function(){var e,t=this.lead.row,i=this.lead.column;(e=this.session.getFoldAt(t,i,-1))?this.moveCursorTo(e.start.row,e.start.column):(null==(e=this.session.getFoldStringAt(t,i,-1))&&(e=this.doc.getLine(t).substring(0,i)),e=s.stringReverse(e),this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.nonTokenRe.exec(e)&&(i-=this.session.nonTokenRe.lastIndex,e=e.slice(this.session.nonTokenRe.lastIndex),this.session.nonTokenRe.lastIndex=0),i<=0?(this.moveCursorTo(t,0),this.moveCursorLeft(),0<t&&this.moveCursorWordLeft()):(this.session.tokenRe.exec(e)&&(i-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(t,i)))},this.$shortWordEndIndex=function(e){var t,i=0,o=/\s/,n=this.session.tokenRe;if(n.lastIndex=0,this.session.tokenRe.exec(e))i=this.session.tokenRe.lastIndex;else{for(;(t=e[i])&&o.test(t);)i++;if(i<1)for(n.lastIndex=0;(t=e[i])&&!n.test(t);)if(n.lastIndex=0,i++,o.test(t)){if(2<i){i--;break}for(;(t=e[i])&&o.test(t);)i++;if(2<i)break}}return n.lastIndex=0,i},this.moveCursorShortWordRight=function(){var e=this.lead.row,t=this.lead.column,i=this.doc.getLine(e),o=i.substring(t),n=this.session.getFoldAt(e,t,1);if(n)return this.moveCursorTo(n.end.row,n.end.column);if(t==i.length){for(var s=this.doc.getLength();o=this.doc.getLine(++e),e<s&&/^\s*$/.test(o););/^\s+/.test(o)||(o=""),t=0}n=this.$shortWordEndIndex(o);this.moveCursorTo(e,t+n)},this.moveCursorShortWordLeft=function(){var e=this.lead.row,t=this.lead.column;if(o=this.session.getFoldAt(e,t,-1))return this.moveCursorTo(o.start.row,o.start.column);var i=this.session.getLine(e).substring(0,t);if(0===t){for(;i=this.doc.getLine(--e),0<e&&/^\s*$/.test(i););t=i.length,/\s+$/.test(i)||(i="")}var o=s.stringReverse(i),o=this.$shortWordEndIndex(o);return this.moveCursorTo(e,t-o)},this.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()},this.moveCursorWordLeft=function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()},this.moveCursorBy=function(e,t){var i,o=this.session.documentToScreenPosition(this.lead.row,this.lead.column),n=(0===t&&(0!==e&&(this.session.$bidiHandler.isBidiRow(o.row,this.lead.row)?(i=this.session.$bidiHandler.getPosLeft(o.column),o.column=Math.round(i/this.session.$bidiHandler.charWidths[0])):i=o.column*this.session.$bidiHandler.charWidths[0]),this.$desiredColumn?o.column=this.$desiredColumn:this.$desiredColumn=o.column),0!=e&&this.session.lineWidgets&&this.session.lineWidgets[this.lead.row]&&(n=this.session.lineWidgets[this.lead.row],e<0?e-=n.rowsAbove||0:0<e&&(e+=n.rowCount-(n.rowsAbove||0))),this.session.screenToDocumentPosition(o.row+e,o.column,i));0!==e&&0===t&&n.row===this.lead.row&&(n.column,this.lead.column),this.moveCursorTo(n.row,n.column+t,0===t)},this.moveCursorToPosition=function(e){this.moveCursorTo(e.row,e.column)},this.moveCursorTo=function(e,t,i){var o=this.session.getFoldAt(e,t,1),o=(o&&(e=o.start.row,t=o.start.column),this.$keepDesiredColumnOnChange=!0,this.session.getLine(e));/[\uDC00-\uDFFF]/.test(o.charAt(t))&&o.charAt(t-1)&&(this.lead.row==e&&this.lead.column==t+1?--t:t+=1),this.lead.setPosition(e,t),this.$keepDesiredColumnOnChange=!1,i||(this.$desiredColumn=null)},this.moveCursorToScreen=function(e,t,i){e=this.session.screenToDocumentPosition(e,t);this.moveCursorTo(e.row,e.column,i)},this.detach=function(){this.lead.detach(),this.anchor.detach()},this.fromOrientedRange=function(e){this.setSelectionRange(e,e.cursor==e.start),this.$desiredColumn=e.desiredColumn||this.$desiredColumn},this.toOrientedRange=function(e){var t=this.getRange();return e?(e.start.column=t.start.column,e.start.row=t.start.row,e.end.column=t.end.column,e.end.row=t.end.row):e=t,e.cursor=this.isBackwards()?e.start:e.end,e.desiredColumn=this.$desiredColumn,e},this.getRangeOfMovements=function(e){var t=this.getCursor();try{e(this);var i=this.getCursor();return r.fromPoints(t,i)}catch(e){return r.fromPoints(t,t)}finally{this.moveCursorToPosition(t)}},this.toJSON=function(){var e;return this.rangeCount?e=this.ranges.map(function(e){var t=e.clone();return t.isBackwards=e.cursor==e.start,t}):(e=this.getRange()).isBackwards=this.isBackwards(),e},this.fromJSON=function(e){if(null==e.start){if(this.rangeList&&1<e.length){this.toSingleRange(e[0]);for(var t=e.length;t--;){var i=r.fromPoints(e[t].start,e[t].end);e[t].isBackwards&&(i.cursor=i.start),this.addRange(i,!0)}return}e=e[0]}this.rangeList&&this.toSingleRange(e),this.setSelectionRange(e,e.isBackwards)},this.isEqual=function(e){if((e.length||this.rangeCount)&&e.length!=this.rangeCount)return!1;if(!e.length||!this.ranges)return this.getRange().isEqual(e);for(var t=this.ranges.length;t--;)if(!this.ranges[t].isEqual(e[t]))return!1;return!0}}).call(o.prototype),t.Selection=o}),define("ace/tokenizer",["require","exports","module","ace/config"],function(e,t,i){"use strict";function o(e){for(var t in this.states=e,this.regExps={},this.matchMappings={},this.states){for(var i=this.states[t],o=[],n=0,s=this.matchMappings[t]={defaultToken:"text"},a="g",r=[],l=0;l<i.length;l++){var c,d,h=i[l];h.defaultToken&&(s.defaultToken=h.defaultToken),h.caseInsensitive&&-1===a.indexOf("i")&&(a+="i"),h.unicode&&-1===a.indexOf("u")&&(a+="u"),null!=h.regex&&(h.regex instanceof RegExp&&(h.regex=h.regex.toString().slice(1,-1)),c=h.regex,d=new RegExp("(?:("+c+")|(.))").exec("a").length-2,Array.isArray(h.token)?1==h.token.length||1==d?h.token=h.token[0]:d-1!=h.token.length?(this.reportError("number of classes and regexp groups doesn't match",{rule:h,groupCount:d-1}),h.token=h.token[0]):(h.tokenArray=h.token,h.token=null,h.onMatch=this.$arrayTokens):"function"!=typeof h.token||h.onMatch||(h.onMatch=1<d?this.$applyToken:h.token),1<d&&(c=/\\\d/.test(h.regex)?h.regex.replace(/\\([0-9]+)/g,function(e,t){return"\\"+(parseInt(t,10)+n+1)}):(d=1,this.removeCapturingGroups(h.regex)),h.splitRegex||"string"==typeof h.token||r.push(h)),s[n]=l,n+=d,o.push(c),h.onMatch||(h.onMatch=null))}o.length||(s[0]=0,o.push("$")),r.forEach(function(e){e.splitRegex=this.createSplitterRegexp(e.regex,a)},this),this.regExps[t]=new RegExp("("+o.join(")|(")+")|($)",a)}}var n=e("./config"),b=2e3;(function(){this.$setMaxTokenCount=function(e){b=0|e},this.$applyToken=function(e){var t=this.splitRegex.exec(e).slice(1),i=this.token.apply(this,t);if("string"==typeof i)return[{type:i,value:e}];for(var o=[],n=0,s=i.length;n<s;n++)t[n]&&(o[o.length]={type:i[n],value:t[n]});return o},this.$arrayTokens=function(e){if(!e)return[];var t=this.splitRegex.exec(e);if(!t)return"text";for(var i=[],o=this.tokenArray,n=0,s=o.length;n<s;n++)t[n+1]&&(i[i.length]={type:o[n],value:t[n+1]});return i},this.removeCapturingGroups=function(e){return e.replace(/\\.|\[(?:\\.|[^\\\]])*|\(\?[:=!<]|(\()/g,function(e,t){return t?"(?:":e})},this.createSplitterRegexp=function(e,t){var a,r,l;return-1!=e.indexOf("(?=")&&(a=0,r=!1,l={},e.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,function(e,t,i,o,n,s){return r?r="]"!=n:n?r=!0:o?(a==l.stack&&(l.end=s+1,l.stack=-1),a--):i&&(a++,1!=i.length&&(l.stack=a,l.start=s)),e}),null!=l.end&&/^\)*$/.test(e.substr(l.end))&&(e=e.substring(0,l.start)+e.substr(l.end))),"$"!=(e="^"!=e.charAt(0)?"^"+e:e).charAt(e.length-1)&&(e+="$"),new RegExp(e,(t||"").replace("g",""))},this.getLineTokens=function(e,t){t&&"string"!=typeof t?"#tmp"===(t=(i=t.slice(0))[0])&&(i.shift(),t=i.shift()):i=[];for(var i,o,n=t||"start",s=this.states[n],a=(s||(s=this.states[n="start"]),this.matchMappings[n]),r=this.regExps[n],l=[],c=r.lastIndex=0,d=0,h={type:null,value:""};o=r.exec(e);){var u,p=a.defaultToken,m=null,f=o[0],g=r.lastIndex;g-f.length>c&&(u=e.substring(c,g-f.length),h.type==p?h.value+=u:(h.type&&l.push(h),h={type:p,value:u}));for(var _=0;_<o.length-2;_++)if(void 0!==o[_+1]){p=(m=s[a[_]]).onMatch?m.onMatch(f,n,i,e):m.token,m.next&&(n="string"==typeof m.next?m.next:m.next(n,i),(s=this.states[n])||(this.reportError("state doesn't exist",n),s=this.states[n="start"]),a=this.matchMappings[n],(r=this.regExps[n]).lastIndex=c=g),m.consumeLineEnd&&(c=g);break}if(f)if("string"==typeof p)m&&!1===m.merge||h.type!==p?(h.type&&l.push(h),h={type:p,value:f}):h.value+=f;else if(p){h.type&&l.push(h);for(h={type:null,value:""},_=0;_<p.length;_++)l.push(p[_])}if(c==e.length)break;if(c=g,d++>b){for(d>2*e.length&&this.reportError("infinite loop with in ace tokenizer",{startState:t,line:e});c<e.length;)h.type&&l.push(h),h={value:e.substring(c,c+=500),type:"overflow"};n="start",i=[];break}}return h.type&&l.push(h),1<i.length&&i[0]!==n&&i.unshift("#tmp",n),{tokens:l,state:i.length?i:n}},this.reportError=n.reportError}).call(o.prototype),t.Tokenizer=o}),define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/lang"],function(e,t,i){"use strict";function o(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}}var l=e("../lib/lang");(function(){this.addRules=function(e,t){if(t)for(var i in e){for(var o=e[i],n=0;n<o.length;n++){var s=o[n];(s.next||s.onMatch)&&("string"==typeof s.next&&0!==s.next.indexOf(t)&&(s.next=t+s.next),s.nextState&&0!==s.nextState.indexOf(t)&&(s.nextState=t+s.nextState))}this.$rules[t+i]=o}else for(var i in e)this.$rules[i]=e[i]},this.getRules=function(){return this.$rules},this.embedRules=function(e,t,i,o,n){e="function"==typeof e?(new e).getRules():e;if(o)for(var s=0;s<o.length;s++)o[s]=t+o[s];else for(var a in o=[],e)o.push(t+a);if(this.addRules(e,t),i)for(var r=Array.prototype[n?"push":"unshift"],s=0;s<o.length;s++)r.apply(this.$rules[o[s]],l.deepCopy(i));this.$embeds||(this.$embeds=[]),this.$embeds.push(t)},this.getEmbeds=function(){return this.$embeds};function h(e,t){return"start"==e&&!t.length||t.unshift(this.nextState,e),this.nextState}function u(e,t){return t.shift(),t.shift()||"start"}this.normalizeRules=function(){var c=0,d=this.$rules;Object.keys(d).forEach(function e(t){var i=d[t];i.processed=!0;for(var o=0;o<i.length;o++){var n=i[o],s=null,a=(Array.isArray(n)&&(s=n,n={}),!n.regex&&n.start&&(n.regex=n.start,n.next||(n.next=[]),n.next.push({defaultToken:n.token},{token:n.token+".end",regex:n.end||n.start,next:"pop"}),n.token=n.token+".start",n.push=!0),n.next||n.push);if(a&&Array.isArray(a)?((l=n.stateName)||("string"!=typeof(l=n.token)&&(l=l[0]||""),d[l]&&(l+=c++)),d[l]=a,e(n.next=l)):"pop"==a&&(n.next=u),n.push&&(n.nextState=n.next||n.push,n.next=h,delete n.push),n.rules)for(var r in n.rules)d[r]?d[r].push&&d[r].push.apply(d[r],n.rules[r]):d[r]=n.rules[r];var l="string"==typeof n?n:n.include;(s=l?Array.isArray(l)?l.map(function(e){return d[e]}):d[l]:s)&&(a=[o,1].concat(s),n.noEscape&&(a=a.filter(function(e){return!e.next})),i.splice.apply(i,a),o--),n.keywordMap&&(n.token=this.createKeywordMapper(n.keywordMap,n.defaultToken||"text",n.caseInsensitive),delete n.defaultToken)}},this)},this.createKeywordMapper=function(n,t,s,a){var r=Object.create(null);return this.$keywordList=[],Object.keys(n).forEach(function(e){for(var t=n[e].split(a||"|"),i=t.length;i--;){var o=t[i];this.$keywordList.push(o),s&&(o=o.toLowerCase()),r[o]=e}},this),n=null,s?function(e){return r[e.toLowerCase()]||t}:function(e){return r[e]||t}},this.getKeywords=function(){return this.$keywords}}).call(o.prototype),t.TextHighlightRules=o}),define("ace/mode/behaviour",["require","exports","module"],function(e,t,i){"use strict";function o(){this.$behaviours={}}(function(){this.add=function(e,t,i){switch(void 0){case this.$behaviours:this.$behaviours={};case this.$behaviours[e]:this.$behaviours[e]={}}this.$behaviours[e][t]=i},this.addBehaviours=function(e){for(var t in e)for(var i in e[t])this.add(t,i,e[t][i])},this.remove=function(e){this.$behaviours&&this.$behaviours[e]&&delete this.$behaviours[e]},this.inherit=function(e,t){e=("function"==typeof e?new e:e).getBehaviours(t),this.addBehaviours(e)},this.getBehaviours=function(e){if(!e)return this.$behaviours;for(var t={},i=0;i<e.length;i++)this.$behaviours[e[i]]&&(t[e[i]]=this.$behaviours[e[i]]);return t}}).call(o.prototype),t.Behaviour=o}),define("ace/token_iterator",["require","exports","module","ace/range"],function(e,t,i){"use strict";function o(e,t,i){this.$session=e,this.$row=t,this.$rowTokens=e.getTokens(t),e=e.getTokenAt(t,i),this.$tokenIndex=e?e.index:-1}var n=e("./range").Range;(function(){this.stepBackward=function(){for(--this.$tokenIndex;this.$tokenIndex<0;){if(--this.$row,this.$row<0)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]},this.stepForward=function(){var e;for(this.$tokenIndex+=1;this.$tokenIndex>=this.$rowTokens.length;){if(this.$row+=1,e=e||this.$session.getLength(),this.$row>=e)return this.$row=e-1,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]},this.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]},this.getCurrentTokenRow=function(){return this.$row},this.getCurrentTokenColumn=function(){var e=this.$rowTokens,t=this.$tokenIndex,i=e[t].start;if(void 0===i)for(i=0;0<t;)i+=e[--t].value.length;return i},this.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}},this.getCurrentTokenRange=function(){var e=this.$rowTokens[this.$tokenIndex],t=this.getCurrentTokenColumn();return new n(this.$row,t,this.$row,t+e.value.length)}}).call(o.prototype),t.TokenIterator=o}),define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"],function(e,t,i){"use strict";function u(e){var t=-1;if(e.multiSelect&&(t=e.selection.index,l.rangeCount!=e.multiSelect.rangeCount&&(l={rangeCount:e.multiSelect.rangeCount})),l[t])return f=l[t];f=l[t]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}}function p(e,t,i,o){var n=e.end.row-e.start.row;return{text:i+t+o,selection:[0,e.start.column+1,n,e.end.column+(n?0:1)]}}function m(h){this.add("braces","insertion",function(e,t,i,o,n){var s=i.getCursorPosition(),a=o.doc.getLine(s.row);if("{"==n)return u(i),l=i.getSelectionRange(),""!==(c=o.doc.getTextRange(l))&&"{"!==c&&i.getWrapBehavioursEnabled()?p(l,c,"{","}"):m.isSaneInsertion(i,o)?/[\]\}\)]/.test(a[s.column])||i.inMultiSelectMode||h&&h.braces?(m.recordAutoInsert(i,o,"}"),{text:"{}",selection:[1,1]}):(m.recordMaybeInsert(i,o,"{"),{text:"{",selection:[1,1]}):void 0;if("}"==n){u(i);var r=a.substring(s.column,s.column+1);if("}"==r)if(null!==o.$findOpeningBracket("}",{column:s.column+1,row:s.row})&&m.isAutoInsertedClosing(s,a,n))return m.popAutoInsertedClosing(),{text:"",selection:[1,1]}}else{if("\n"==n||"\r\n"==n){u(i);var l="";if(m.isMaybeInsertedClosing(s,a)&&(l=g.stringRepeat("}",f.maybeInsertedBrackets),m.clearMaybeInsertedClosing()),"}"===(r=a.substring(s.column,s.column+1))){var c=o.findMatchingBracket({row:s.row,column:s.column+1},"}");if(!c)return null;var d=this.$getIndent(o.getLine(c.row))}else{if(!l)return void m.clearMaybeInsertedClosing();d=this.$getIndent(a)}n=d+o.getTabString();return{text:"\n"+n+"\n"+d+l,selection:[1,n.length,1,n.length]}}m.clearMaybeInsertedClosing()}}),this.add("braces","deletion",function(e,t,i,o,n){var s=o.doc.getTextRange(n);if(!n.isMultiLine()&&"{"==s){if(u(i),"}"==o.doc.getLine(n.start.row).substring(n.end.column,n.end.column+1))return n.end.column++,n;f.maybeInsertedBrackets--}}),this.add("parens","insertion",function(e,t,i,o,n){if("("==n)return u(i),s=i.getSelectionRange(),""!==(a=o.doc.getTextRange(s))&&i.getWrapBehavioursEnabled()?p(s,a,"(",")"):m.isSaneInsertion(i,o)?(m.recordAutoInsert(i,o,")"),{text:"()",selection:[1,1]}):void 0;if(")"==n){u(i);var s=i.getCursorPosition(),a=o.doc.getLine(s.row),i=a.substring(s.column,s.column+1);if(")"==i)if(null!==o.$findOpeningBracket(")",{column:s.column+1,row:s.row})&&m.isAutoInsertedClosing(s,a,n))return m.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}),this.add("parens","deletion",function(e,t,i,o,n){var s=o.doc.getTextRange(n);if(!n.isMultiLine()&&"("==s&&(u(i),")"==o.doc.getLine(n.start.row).substring(n.start.column+1,n.start.column+2)))return n.end.column++,n}),this.add("brackets","insertion",function(e,t,i,o,n){if("["==n)return u(i),s=i.getSelectionRange(),""!==(a=o.doc.getTextRange(s))&&i.getWrapBehavioursEnabled()?p(s,a,"[","]"):m.isSaneInsertion(i,o)?(m.recordAutoInsert(i,o,"]"),{text:"[]",selection:[1,1]}):void 0;if("]"==n){u(i);var s=i.getCursorPosition(),a=o.doc.getLine(s.row),i=a.substring(s.column,s.column+1);if("]"==i)if(null!==o.$findOpeningBracket("]",{column:s.column+1,row:s.row})&&m.isAutoInsertedClosing(s,a,n))return m.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}),this.add("brackets","deletion",function(e,t,i,o,n){var s=o.doc.getTextRange(n);if(!n.isMultiLine()&&"["==s&&(u(i),"]"==o.doc.getLine(n.start.row).substring(n.start.column+1,n.start.column+2)))return n.end.column++,n}),this.add("string_dquotes","insertion",function(e,t,i,o,n){var s=o.$mode.$quotes||_;if(1==n.length&&s[n]&&(!this.lineCommentStart||-1==this.lineCommentStart.indexOf(n))){u(i);var a=i.getSelectionRange(),r=o.doc.getTextRange(a);if(""!==r&&(1!=r.length||!s[r])&&i.getWrapBehavioursEnabled())return p(a,r,n,n);if(!r){var s=i.getCursorPosition(),a=o.doc.getLine(s.row),r=a.substring(s.column-1,s.column),i=a.substring(s.column,s.column+1),l=o.getTokenAt(s.row,s.column),c=o.getTokenAt(s.row,s.column+1);if("\\"==r&&l&&/escape/.test(l.type))return null;var d,l=l&&/string|escape/.test(l.type),h=!c||/string|escape/.test(c.type);if(i==n)(d=l!==h)&&/string\.end/.test(c.type)&&(d=!1);else{if(l&&!h)return null;if(l&&h)return null;c=o.$mode.tokenRe,l=(c.lastIndex=0,c.test(r)),h=(c.lastIndex=0,c.test(r));if(l||h)return null;if(i&&!/[\s;,.})\]\\]/.test(i))return null;o=a[s.column-2];if(r==n&&(o==n||c.test(o)))return null;d=!0}return{text:d?n+n:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(e,t,i,o,n){var s=o.$mode.$quotes||_,a=o.doc.getTextRange(n);if(!n.isMultiLine()&&s.hasOwnProperty(a)&&(u(i),o.doc.getLine(n.start.row).substring(n.start.column+1,n.start.column+2)==a))return n.end.column++,n})}var f,o=e("../../lib/oop"),n=e("../behaviour").Behaviour,s=e("../../token_iterator").TokenIterator,g=e("../../lib/lang"),a=["text","paren.rparen","rparen","paren","punctuation.operator"],r=["text","paren.rparen","rparen","paren","punctuation.operator","comment"],l={},_={'"':'"',"'":"'"};m.isSaneInsertion=function(e,t){var i=e.getCursorPosition(),o=new s(t,i.row,i.column);if(!this.$matchTokenType(o.getCurrentToken()||"text",a)){if(/[)}\]]/.test(e.session.getLine(i.row)[i.column]))return!0;e=new s(t,i.row,i.column+1);if(!this.$matchTokenType(e.getCurrentToken()||"text",a))return!1}return o.stepForward(),o.getCurrentTokenRow()!==i.row||this.$matchTokenType(o.getCurrentToken()||"text",r)},m.$matchTokenType=function(e,t){return-1<t.indexOf(e.type||e)},m.recordAutoInsert=function(e,t,i){e=e.getCursorPosition(),t=t.doc.getLine(e.row);this.isAutoInsertedClosing(e,t,f.autoInsertedLineEnd[0])||(f.autoInsertedBrackets=0),f.autoInsertedRow=e.row,f.autoInsertedLineEnd=i+t.substr(e.column),f.autoInsertedBrackets++},m.recordMaybeInsert=function(e,t,i){e=e.getCursorPosition(),t=t.doc.getLine(e.row);this.isMaybeInsertedClosing(e,t)||(f.maybeInsertedBrackets=0),f.maybeInsertedRow=e.row,f.maybeInsertedLineStart=t.substr(0,e.column)+i,f.maybeInsertedLineEnd=t.substr(e.column),f.maybeInsertedBrackets++},m.isAutoInsertedClosing=function(e,t,i){return 0<f.autoInsertedBrackets&&e.row===f.autoInsertedRow&&i===f.autoInsertedLineEnd[0]&&t.substr(e.column)===f.autoInsertedLineEnd},m.isMaybeInsertedClosing=function(e,t){return 0<f.maybeInsertedBrackets&&e.row===f.maybeInsertedRow&&t.substr(e.column)===f.maybeInsertedLineEnd&&t.substr(0,e.column)==f.maybeInsertedLineStart},m.popAutoInsertedClosing=function(){f.autoInsertedLineEnd=f.autoInsertedLineEnd.substr(1),f.autoInsertedBrackets--},m.clearMaybeInsertedClosing=function(){f&&(f.maybeInsertedBrackets=0,f.maybeInsertedRow=-1)},o.inherits(m,n),t.CstyleBehaviour=m}),define("ace/unicode",["require","exports","module"],function(e,t,i){"use strict";for(var o=[48,9,8,25,5,0,2,25,48,0,11,0,5,0,6,22,2,30,2,457,5,11,15,4,8,0,2,0,18,116,2,1,3,3,9,0,2,2,2,0,2,19,2,82,2,138,2,4,3,155,12,37,3,0,8,38,10,44,2,0,2,1,2,1,2,0,9,26,6,2,30,10,7,61,2,9,5,101,2,7,3,9,2,18,3,0,17,58,3,100,15,53,5,0,6,45,211,57,3,18,2,5,3,11,3,9,2,1,7,6,2,2,2,7,3,1,3,21,2,6,2,0,4,3,3,8,3,1,3,3,9,0,5,1,2,4,3,11,16,2,2,5,5,1,3,21,2,6,2,1,2,1,2,1,3,0,2,4,5,1,3,2,4,0,8,3,2,0,8,15,12,2,2,8,2,2,2,21,2,6,2,1,2,4,3,9,2,2,2,2,3,0,16,3,3,9,18,2,2,7,3,1,3,21,2,6,2,1,2,4,3,8,3,1,3,2,9,1,5,1,2,4,3,9,2,0,17,1,2,5,4,2,2,3,4,1,2,0,2,1,4,1,4,2,4,11,5,4,4,2,2,3,3,0,7,0,15,9,18,2,2,7,2,2,2,22,2,9,2,4,4,7,2,2,2,3,8,1,2,1,7,3,3,9,19,1,2,7,2,2,2,22,2,9,2,4,3,8,2,2,2,3,8,1,8,0,2,3,3,9,19,1,2,7,2,2,2,22,2,15,4,7,2,2,2,3,10,0,9,3,3,9,11,5,3,1,2,17,4,23,2,8,2,0,3,6,4,0,5,5,2,0,2,7,19,1,14,57,6,14,2,9,40,1,2,0,3,1,2,0,3,0,7,3,2,6,2,2,2,0,2,0,3,1,2,12,2,2,3,4,2,0,2,5,3,9,3,1,35,0,24,1,7,9,12,0,2,0,2,0,5,9,2,35,5,19,2,5,5,7,2,35,10,0,58,73,7,77,3,37,11,42,2,0,4,328,2,3,3,6,2,0,2,3,3,40,2,3,3,32,2,3,3,6,2,0,2,3,3,14,2,56,2,3,3,66,5,0,33,15,17,84,13,619,3,16,2,25,6,74,22,12,2,6,12,20,12,19,13,12,2,2,2,1,13,51,3,29,4,0,5,1,3,9,34,2,3,9,7,87,9,42,6,69,11,28,4,11,5,11,11,39,3,4,12,43,5,25,7,10,38,27,5,62,2,28,3,10,7,9,14,0,89,75,5,9,18,8,13,42,4,11,71,55,9,9,4,48,83,2,2,30,14,230,23,280,3,5,3,37,3,5,3,7,2,0,2,0,2,0,2,30,3,52,2,6,2,0,4,2,2,6,4,3,3,5,5,12,6,2,2,6,67,1,20,0,29,0,14,0,17,4,60,12,5,0,4,11,18,0,5,0,3,9,2,0,4,4,7,0,2,0,2,0,2,3,2,10,3,3,6,4,5,0,53,1,2684,46,2,46,2,132,7,6,15,37,11,53,10,0,17,22,10,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,31,48,0,470,1,36,5,2,4,6,1,5,85,3,1,3,2,2,89,2,3,6,40,4,93,18,23,57,15,513,6581,75,20939,53,1164,68,45,3,268,4,27,21,31,3,13,13,1,2,24,9,69,11,1,38,8,3,102,3,1,111,44,25,51,13,68,12,9,7,23,4,0,5,45,3,35,13,28,4,64,15,10,39,54,10,13,3,9,7,22,4,1,5,66,25,2,227,42,2,1,3,9,7,11171,13,22,5,48,8453,301,3,61,3,105,39,6,13,4,6,11,2,12,2,4,2,0,2,1,2,1,2,107,34,362,19,63,3,53,41,11,5,15,17,6,13,1,25,2,33,4,2,134,20,9,8,25,5,0,2,25,12,88,4,5,3,5,3,5,3,2],n=0,s=[],a=0;a<o.length;a+=2)s.push(n+=o[a]),o[a+1]&&s.push(45,n+=o[a+1]);t.wordChars=String.fromCharCode.apply(null,s)}),define("ace/mode/text",["require","exports","module","ace/config","ace/tokenizer","ace/mode/text_highlight_rules","ace/mode/behaviour/cstyle","ace/unicode","ace/lib/lang","ace/token_iterator","ace/range"],function(e,t,i){"use strict";function o(){this.HighlightRules=s}var a=e("../config"),n=e("../tokenizer").Tokenizer,s=e("./text_highlight_rules").TextHighlightRules,r=e("./behaviour/cstyle").CstyleBehaviour,l=e("../unicode"),k=e("../lib/lang"),f=e("../token_iterator").TokenIterator,g=e("../range").Range;(function(){this.$defaultBehaviour=new r,this.tokenRe=new RegExp("^["+l.wordChars+"\\$_]+","g"),this.nonTokenRe=new RegExp("^(?:[^"+l.wordChars+"\\$_]|\\s])+","g"),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new n(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart="",this.blockComment="",this.toggleCommentLines=function(e,n,i,o){function t(e){for(var t=i;t<=o;t++)e(s.getLine(t),t)}var s=n.doc,a=!0,r=!0,l=1/0,c=n.getTabSize(),d=!1;if(this.lineCommentStart){g=Array.isArray(this.lineCommentStart)?(b=this.lineCommentStart.map(k.escapeRegExp).join("|"),this.lineCommentStart[0]):(b=k.escapeRegExp(this.lineCommentStart),this.lineCommentStart),b=new RegExp("^(\\s*)(?:"+b+") ?"),d=n.getUseSoftTabs();var h=function(e,t){var i,o,n=e.match(b);n&&(i=n[1].length,o=n[0].length,f(e,i,o)||" "!=n[0][o-1]||o--,s.removeInLine(t,i,o))},u=g+" ",p=function(e,t){a&&!/\S/.test(e)||(f(e,l,l)?s.insertInLine({row:t,column:l},u):s.insertInLine({row:t,column:l},g))},m=function(e,t){return b.test(e)},f=function(e,t,i){for(var o=0;t--&&" "==e.charAt(t);)o++;if(o%c!=0)return!1;for(o=0;" "==e.charAt(i++);)o++;return 2<c?o%c!=c-1:o%c==0}}else{if(!this.blockComment)return!1;var g=this.blockComment.start,_=this.blockComment.end,b=new RegExp("^(\\s*)(?:"+k.escapeRegExp(g)+")"),y=new RegExp("(?:"+k.escapeRegExp(_)+")\\s*$"),p=function(e,t){m(e,t)||a&&!/\S/.test(e)||(s.insertInLine({row:t,column:e.length},_),s.insertInLine({row:t,column:l},g))},h=function(e,t){var i;(i=e.match(y))&&s.removeInLine(t,e.length-i[0].length,e.length),(i=e.match(b))&&s.removeInLine(t,i[1].length,i[0].length)},m=function(e,t){if(b.test(e))return!0;for(var i=n.getTokens(t),o=0;o<i.length;o++)if("comment"===i[o].type)return!0}}var v=1/0;t(function(e,t){var i=e.search(/\S/);-1!==i?(i<l&&(l=i),r&&!m(e,t)&&(r=!1)):v>e.length&&(v=e.length)}),l==1/0&&(l=v,r=a=!1),d&&l%c!=0&&(l=Math.floor(l/c)*c),t(r?h:p)},this.toggleBlockComment=function(e,t,i,o){var n=this.blockComment;if(n){!n.start&&n[0]&&(n=n[0]);var s,a,r=(u=new f(t,o.row,o.column)).getCurrentToken(),l=(t.selection,t.selection.toOrientedRange());if(r&&/comment/.test(r.type)){for(;r&&/comment/.test(r.type);){if(-1!=(p=r.value.indexOf(n.start))){var c=u.getCurrentTokenRow(),d=u.getCurrentTokenColumn()+p,h=new g(c,d,c,d+n.start.length);break}r=u.stepBackward()}for(var u,p,r=(u=new f(t,o.row,o.column)).getCurrentToken();r&&/comment/.test(r.type);){if(-1!=(p=r.value.indexOf(n.end))){var c=u.getCurrentTokenRow(),d=u.getCurrentTokenColumn()+p,m=new g(c,d,c,d+n.end.length);break}r=u.stepForward()}m&&t.remove(m),h&&(t.remove(h),s=h.start.row,a=-n.start.length)}else a=n.start.length,s=i.start.row,t.insert(i.end,n.end),t.insert(i.start,n.start);l.start.row==s&&(l.start.column+=a),l.end.row==s&&(l.end.column+=a),t.selection.fromOrientedRange(l)}},this.getNextLineIndent=function(e,t,i){return this.$getIndent(t)},this.checkOutdent=function(e,t,i){return!1},this.autoOutdent=function(e,t,i){},this.$getIndent=function(e){return e.match(/^\s*/)[0]},this.createWorker=function(e){return null},this.createModeDelegates=function(e){for(var o in this.$embeds=[],this.$modes={},e){var t,i,n;e[o]&&(i=(t=e[o]).prototype.$id,(n=a.$modes[i])||(a.$modes[i]=n=new t),a.$modes[o]||(a.$modes[o]=n),this.$embeds.push(o),this.$modes[o]=n)}for(var s=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"],o=0;o<s.length;o++)!function(e){var t=s[o],i=e[t];e[s[o]]=function(){return this.$delegator(t,arguments,i)}}(this)},this.$delegator=function(e,t,i){var o=t[0]||"start";if("string"!=typeof o){if(Array.isArray(o[2])){var n=o[2][o[2].length-1];if(a=this.$modes[n])return a[e].apply(a,[o[1]].concat([].slice.call(t,1)))}o=o[0]||"start"}for(var s=0;s<this.$embeds.length;s++)if(this.$modes[this.$embeds[s]]){var a,r=o.split(this.$embeds[s]);if(!r[0]&&r[1])return t[0]=r[1],(a=this.$modes[this.$embeds[s]])[e].apply(a,t)}n=i.apply(this,t);return i?n:void 0},this.transformAction=function(e,t,i,o,n){if(this.$behaviour){var s,a=this.$behaviour.getBehaviours();for(s in a)if(a[s][t]){var r=a[s][t].apply(this,arguments);if(r)return r}}},this.getKeywords=function(e){if(!this.completionKeywords){var t=this.$tokenizer.rules,i=[];for(o in t)for(var o,n=t[o],s=0,a=n.length;s<a;s++)if("string"==typeof n[s].token)/keyword|support|storage/.test(n[s].token)&&i.push(n[s].regex);else if("object"==typeof n[s].token)for(var r=0,l=n[s].token.length;r<l;r++)/keyword|support|storage/.test(n[s].token[r])&&(o=n[s].regex.match(/\(.+?\)/g)[r],i.push(o.substr(1,o.length-2)));this.completionKeywords=i}return e?i.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(e,t,i,o){return(this.$keywordList||this.$createKeywordList()).map(function(e){return{name:e,value:e,score:0,meta:"keyword"}})},this.$id="ace/mode/text"}).call(o.prototype),t.Mode=o}),define("ace/apply_delta",["require","exports","module"],function(e,t,i){"use strict";t.applyDelta=function(e,t,i){var o=t.start.row,n=t.start.column,s=e[o]||"";switch(t.action){case"insert":1===t.lines.length?e[o]=s.substring(0,n)+t.lines[0]+s.substring(n):(a=[o,1].concat(t.lines),e.splice.apply(e,a),e[o]=s.substring(0,n)+e[o],e[o+t.lines.length-1]+=s.substring(n));break;case"remove":var a=t.end.column,r=t.end.row;o===r?e[o]=s.substring(0,n)+s.substring(a):e.splice(o,r-o+1,s.substring(0,n)+e[r].substring(a))}}}),define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(e,t,i){"use strict";var o=e("./lib/oop"),n=e("./lib/event_emitter").EventEmitter,e=t.Anchor=function(e,t,i){this.$onChange=this.onChange.bind(this),this.attach(e),void 0===i?this.setPosition(t.row,t.column):this.setPosition(t,i)};!function(){function r(e,t,i){i=i?e.column<=t.column:e.column<t.column;return e.row<t.row||e.row==t.row&&i}o.implement(this,n),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(e){var t,i,o,n,s,a;e.start.row==e.end.row&&e.start.row!=this.row||e.start.row>this.row||(e=e,t={row:this.row,column:this.column},i=this.$insertRight,o=((a="insert"==e.action)?1:-1)*(e.end.row-e.start.row),n=(a?1:-1)*(e.end.column-e.start.column),s=e.start,a=a?s:e.end,e=r(t,s,i)?{row:t.row,column:t.column}:r(a,t,!i)?{row:t.row+o,column:t.column+(t.row==a.row?n:0)}:{row:s.row,column:s.column},this.setPosition(e.row,e.column,!0))},this.setPosition=function(e,t,i){i=i?{row:e,column:t}:this.$clipPositionToDocument(e,t);this.row==i.row&&this.column==i.column||(e={row:this.row,column:this.column},this.row=i.row,this.column=i.column,this._signal("change",{old:e,value:i}))},this.detach=function(){this.document.off("change",this.$onChange)},this.attach=function(e){this.document=e||this.document,this.document.on("change",this.$onChange)},this.$clipPositionToDocument=function(e,t){var i={};return e>=this.document.getLength()?(i.row=Math.max(0,this.document.getLength()-1),i.column=this.document.getLine(i.row).length):e<0?(i.row=0,i.column=0):(i.row=e,i.column=Math.min(this.document.getLine(i.row).length,Math.max(0,t))),t<0&&(i.column=0),i}}.call(e.prototype)}),define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],function(e,t,i){"use strict";function o(e){this.$lines=[""],0===e.length?this.$lines=[""]:Array.isArray(e)?this.insertMergedLines({row:0,column:0},e):this.insert({row:0,column:0},e)}var n=e("./lib/oop"),s=e("./apply_delta").applyDelta,a=e("./lib/event_emitter").EventEmitter,r=e("./range").Range,l=e("./anchor").Anchor;(function(){n.implement(this,a),this.setValue=function(e){var t=this.getLength()-1;this.remove(new r(0,0,t,this.getLine(t).length)),this.insert({row:0,column:0},e)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(e,t){return new l(this,e,t)},0==="aaa".split(/a/).length?this.$split=function(e){return e.replace(/\r\n|\r/g,"\n").split("\n")}:this.$split=function(e){return e.split(/\r\n|\r|\n/)},this.$detectNewLine=function(e){e=e.match(/^.*?(\r\n|\r|\n)/m);this.$autoNewLine=e?e[1]:"\n",this._signal("changeNewLineMode")},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\r\n";case"unix":return"\n";default:return this.$autoNewLine||"\n"}},this.$autoNewLine="",this.$newLineMode="auto",this.setNewLineMode=function(e){this.$newLineMode!==e&&(this.$newLineMode=e,this._signal("changeNewLineMode"))},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(e){return"\r\n"==e||"\r"==e||"\n"==e},this.getLine=function(e){return this.$lines[e]||""},this.getLines=function(e,t){return this.$lines.slice(e,t+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(e){return this.getLinesForRange(e).join(this.getNewLineCharacter())},this.getLinesForRange=function(e){var t,i;return e.start.row===e.end.row?t=[this.getLine(e.start.row).substring(e.start.column,e.end.column)]:((t=this.getLines(e.start.row,e.end.row))[0]=(t[0]||"").substring(e.start.column),i=t.length-1,e.end.row-e.start.row==i&&(t[i]=t[i].substring(0,e.end.column))),t},this.insertLines=function(e,t){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(e,t)},this.removeLines=function(e,t){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(e,t)},this.insertNewLine=function(e){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead."),this.insertMergedLines(e,["",""])},this.insert=function(e,t){return this.getLength()<=1&&this.$detectNewLine(t),this.insertMergedLines(e,this.$split(t))},this.insertInLine=function(e,t){var i=this.clippedPos(e.row,e.column),e=this.pos(e.row,e.column+t.length);return this.applyDelta({start:i,end:e,action:"insert",lines:[t]},!0),this.clonePos(e)},this.clippedPos=function(e,t){var i=this.getLength(),i=(void 0===e?e=i:e<0?e=0:i<=e&&(e=i-1,t=void 0),this.getLine(e));return null==t&&(t=i.length),{row:e,column:t=Math.min(Math.max(t,0),i.length)}},this.clonePos=function(e){return{row:e.row,column:e.column}},this.pos=function(e,t){return{row:e,column:t}},this.$clipPosition=function(e){var t=this.getLength();return e.row>=t?(e.row=Math.max(0,t-1),e.column=this.getLine(t-1).length):(e.row=Math.max(0,e.row),e.column=Math.min(Math.max(e.column,0),this.getLine(e.row).length)),e},this.insertFullLines=function(e,t){var i=0,i=(e=Math.min(Math.max(e,0),this.getLength()))<this.getLength()?(t=t.concat([""]),0):(t=[""].concat(t),this.$lines[--e].length);this.insertMergedLines({row:e,column:i},t)},this.insertMergedLines=function(e,t){var e=this.clippedPos(e.row,e.column),i={row:e.row+t.length-1,column:(1==t.length?e.column:0)+t[t.length-1].length};return this.applyDelta({start:e,end:i,action:"insert",lines:t}),this.clonePos(i)},this.remove=function(e){var t=this.clippedPos(e.start.row,e.start.column),e=this.clippedPos(e.end.row,e.end.column);return this.applyDelta({start:t,end:e,action:"remove",lines:this.getLinesForRange({start:t,end:e})}),this.clonePos(t)},this.removeInLine=function(e,t,i){t=this.clippedPos(e,t),e=this.clippedPos(e,i);return this.applyDelta({start:t,end:e,action:"remove",lines:this.getLinesForRange({start:t,end:e})},!0),this.clonePos(t)},this.removeFullLines=function(e,t){e=Math.min(Math.max(0,e),this.getLength()-1);var i=(t=Math.min(Math.max(0,t),this.getLength()-1))==this.getLength()-1&&0<e,o=t<this.getLength()-1,n=i?e-1:e,i=i?this.getLine(n).length:0,s=o?t+1:t,o=o?0:this.getLine(s).length,n=new r(n,i,s,o),i=this.$lines.slice(e,t+1);return this.applyDelta({start:n.start,end:n.end,action:"remove",lines:this.getLinesForRange(n)}),i},this.removeNewLine=function(e){e<this.getLength()-1&&0<=e&&this.applyDelta({start:this.pos(e,this.getLine(e).length),end:this.pos(e+1,0),action:"remove",lines:["",""]})},this.replace=function(e,t){return e instanceof r||(e=r.fromPoints(e.start,e.end)),0===t.length&&e.isEmpty()?e.start:t==this.getTextRange(e)?e.end:(this.remove(e),t?this.insert(e.start,t):e.start)},this.applyDeltas=function(e){for(var t=0;t<e.length;t++)this.applyDelta(e[t])},this.revertDeltas=function(e){for(var t=e.length-1;0<=t;t--)this.revertDelta(e[t])},this.applyDelta=function(e,t){var i="insert"==e.action;(i?e.lines.length<=1&&!e.lines[0]:!r.comparePoints(e.start,e.end))||(i&&2e4<e.lines.length?this.$splitAndapplyLargeDelta(e,2e4):(s(this.$lines,e,t),this._signal("change",e)))},this.$safeApplyDelta=function(e){var t=this.$lines.length;("remove"==e.action&&e.start.row<t&&e.end.row<t||"insert"==e.action&&e.start.row<=t)&&this.applyDelta(e)},this.$splitAndapplyLargeDelta=function(e,t){for(var i=e.lines,o=i.length-t+1,n=e.start.row,s=e.start.column,a=0,r=0;a<o;a=r){r+=t-1;var l=i.slice(a,r);l.push(""),this.applyDelta({start:this.pos(n+a,s),end:this.pos(n+r,s=0),action:e.action,lines:l},!0)}e.lines=i.slice(a),e.start.row=n+a,e.start.column=s,this.applyDelta(e,!0)},this.revertDelta=function(e){this.$safeApplyDelta({start:this.clonePos(e.start),end:this.clonePos(e.end),action:"insert"==e.action?"remove":"insert",lines:e.lines.slice()})},this.indexToPosition=function(e,t){for(var i=this.$lines||this.getAllLines(),o=this.getNewLineCharacter().length,n=t||0,s=i.length;n<s;n++)if((e-=i[n].length+o)<0)return{row:n,column:e+i[n].length+o};return{row:s-1,column:e+i[s-1].length+o}},this.positionToIndex=function(e,t){for(var i=this.$lines||this.getAllLines(),o=this.getNewLineCharacter().length,n=0,s=Math.min(e.row,i.length),a=t||0;a<s;++a)n+=i[a].length+o;return n+e.column}}).call(o.prototype),t.Document=o}),define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(e,t,i){"use strict";function o(e,t){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.tokenizer=e;var r=this;this.$worker=function(){if(r.running){for(var e=new Date,t=r.currentLine,i=-1,o=r.doc,n=t;r.lines[t];)t++;var s=o.getLength(),a=0;for(r.running=!1;t<s;){for(r.$tokenizeRow(t),i=t;t++,r.lines[t];);if(++a%5==0&&20<new Date-e){r.running=setTimeout(r.$worker,20);break}}r.currentLine=t,n<=(i=-1==i?t:i)&&r.fireUpdateEvent(n,i)}}}var n=e("./lib/oop"),s=e("./lib/event_emitter").EventEmitter;(function(){n.implement(this,s),this.setTokenizer=function(e){this.tokenizer=e,this.lines=[],this.states=[],this.start(0)},this.setDocument=function(e){this.doc=e,this.lines=[],this.states=[],this.stop()},this.fireUpdateEvent=function(e,t){this._signal("update",{data:{first:e,last:t}})},this.start=function(e){this.currentLine=Math.min(e||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.states.splice(this.currentLine,this.states.length),this.stop(),this.running=setTimeout(this.$worker,700)},this.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))},this.$updateOnChange=function(e){var t=e.start.row,i=e.end.row-t;0==i?this.lines[t]=null:"remove"==e.action?(this.lines.splice(t,1+i,null),this.states.splice(t,1+i,null)):((e=Array(1+i)).unshift(t,1),this.lines.splice.apply(this.lines,e),this.states.splice.apply(this.states,e)),this.currentLine=Math.min(t,this.currentLine,this.doc.getLength()),this.stop()},this.stop=function(){this.running&&clearTimeout(this.running),this.running=!1},this.getTokens=function(e){return this.lines[e]||this.$tokenizeRow(e)},this.getState=function(e){return this.currentLine==e&&this.$tokenizeRow(e),this.states[e]||"start"},this.$tokenizeRow=function(e){var t=this.doc.getLine(e),i=this.states[e-1],t=this.tokenizer.getLineTokens(t,i,e);return this.states[e]+""!=t.state+""?(this.states[e]=t.state,this.lines[e+1]=null,this.currentLine>e+1&&(this.currentLine=e+1)):this.currentLine==e&&(this.currentLine=e+1),this.lines[e]=t.tokens},this.cleanup=function(){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.removeAllListeners()}}).call(o.prototype),t.BackgroundTokenizer=o}),define("ace/search_highlight",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(e,t,i){"use strict";function o(e,t,i){this.setRegexp(e),this.clazz=t,this.type=i||"text"}var u=e("./lib/lang"),p=(e("./lib/oop"),e("./range").Range);(function(){this.MAX_RANGES=500,this.setRegexp=function(e){this.regExp+""!=e+""&&(this.regExp=e,this.cache=[])},this.update=function(e,t,i,o){if(this.regExp)for(var n=o.firstRow,s=o.lastRow,a={},r=n;r<=s;r++){var l=this.cache[r];null==l&&(l=(l=(l=u.getMatchOffsets(i.getLine(r),this.regExp)).length>this.MAX_RANGES?l.slice(0,this.MAX_RANGES):l).map(function(e){return new p(r,e.offset,r,e.offset+e.length)}),this.cache[r]=l.length?l:"");for(var c=l.length;c--;){var d=l[c].toScreenRange(i),h=d.toString();a[h]||(a[h]=!0,t.drawSingleLineMarker(e,d,this.clazz,o))}}}}).call(o.prototype),t.SearchHighlight=o}),define("ace/edit_session/fold_line",["require","exports","module","ace/range"],function(e,t,i){"use strict";function n(e,t){this.foldData=e,Array.isArray(t)?this.folds=t:t=this.folds=[t];e=t[t.length-1];this.range=new o(t[0].start.row,t[0].start.column,e.end.row,e.end.column),this.start=this.range.start,this.end=this.range.end,this.folds.forEach(function(e){e.setFoldLine(this)},this)}var o=e("../range").Range;(function(){this.shiftRow=function(t){this.start.row+=t,this.end.row+=t,this.folds.forEach(function(e){e.start.row+=t,e.end.row+=t})},this.addFold=function(e){if(e.sameRow){if(e.start.row<this.startRow||e.endRow>this.endRow)throw new Error("Can't add a fold to this FoldLine as it has no connection");this.folds.push(e),this.folds.sort(function(e,t){return-e.range.compareEnd(t.start.row,t.start.column)}),0<this.range.compareEnd(e.start.row,e.start.column)?(this.end.row=e.end.row,this.end.column=e.end.column):this.range.compareStart(e.end.row,e.end.column)<0&&(this.start.row=e.start.row,this.start.column=e.start.column)}else if(e.start.row==this.end.row)this.folds.push(e),this.end.row=e.end.row,this.end.column=e.end.column;else{if(e.end.row!=this.start.row)throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");this.folds.unshift(e),this.start.row=e.start.row,this.start.column=e.start.column}e.foldLine=this},this.containsRow=function(e){return e>=this.start.row&&e<=this.end.row},this.walk=function(e,t,i){var o,n,s=0,a=this.folds,r=!0;null==t&&(t=this.end.row,i=this.end.column);for(var l=0;l<a.length;l++){if(-1==(n=(o=a[l]).range.compareStart(t,i)))return void e(null,t,i,s,r);if(!e(null,o.start.row,o.start.column,s,r)&&e(o.placeholder,o.start.row,o.start.column,s)||0===n)return;r=!o.sameRow,s=o.end.column}e(null,t,i,s,r)},this.getNextFoldTo=function(e,t){for(var i,o,n=0;n<this.folds.length;n++){if(-1==(o=(i=this.folds[n]).range.compareEnd(e,t)))return{fold:i,kind:"after"};if(0===o)return{fold:i,kind:"inside"}}return null},this.addRemoveChars=function(e,t,i){var o,n=this.getNextFoldTo(e,t);if(n)if(o=n.fold,"inside"==n.kind&&o.start.column!=t&&o.start.row!=e)window.console&&window.console.log(e,t,o);else if(o.start.row==e){var s,a=(s=this.folds).indexOf(o);for(0===a&&(this.start.column+=i);a<s.length;a++){if((o=s[a]).start.column+=i,!o.sameRow)return;o.end.column+=i}this.end.column+=i}},this.split=function(e,t){e=this.getNextFoldTo(e,t);if(!e||"inside"==e.kind)return null;var t=e.fold,e=this.folds,i=this.foldData,t=e.indexOf(t),o=e[t-1],o=(this.end.row=o.end.row,this.end.column=o.end.column,new n(i,e=e.splice(t,e.length-t)));return i.splice(i.indexOf(this)+1,0,o),o},this.merge=function(e){for(var t=e.folds,i=0;i<t.length;i++)this.addFold(t[i]);var o=this.foldData;o.splice(o.indexOf(e),1)},this.toString=function(){var t=[this.range.toString()+": ["];return this.folds.forEach(function(e){t.push("  "+e.toString())}),t.push("]"),t.join("\n")},this.idxToPosition=function(e){for(var t=0,i=0;i<this.folds.length;i++){var o=this.folds[i];if((e-=o.start.column-t)<0)return{row:o.start.row,column:o.start.column+e};if((e-=o.placeholder.length)<0)return o.start;t=o.end.column}return{row:this.end.row,column:this.end.column+e}}}).call(n.prototype),t.FoldLine=n}),define("ace/range_list",["require","exports","module","ace/range"],function(e,t,i){"use strict";function o(){this.ranges=[],this.$bias=1}var r=e("./range").Range.comparePoints;(function(){this.comparePoints=r,this.pointIndex=function(e,t,i){for(var o=this.ranges,n=i||0;n<o.length;n++){var s=o[n],a=r(e,s.end);if(0<a);else return s=r(e,s.start),0===a?t&&0!==s?-n-2:n:0<s||0===s&&!t?n:-n-1}return-n-1},this.add=function(e){var t=!e.isEmpty(),i=this.pointIndex(e.start,t),t=this.pointIndex(e.end,t,i=i<0?-i-1:i);return t<0?t=-t-1:t++,this.ranges.splice(i,t-i,e)},this.addList=function(e){for(var t=[],i=e.length;i--;)t.push.apply(t,this.add(e[i]));return t},this.substractPoint=function(e){e=this.pointIndex(e);if(0<=e)return this.ranges.splice(e,1)},this.merge=function(){for(var e=[],t=this.ranges,i=(t=t.sort(function(e,t){return r(e.start,t.start)}))[0],o=1;o<t.length;o++){var n=i,i=t[o],s=r(n.end,i.start);s<0||(0!=s||n.isEmpty()||i.isEmpty())&&(r(n.end,i.end)<0&&(n.end.row=i.end.row,n.end.column=i.end.column),t.splice(o,1),e.push(i),i=n,o--)}return this.ranges=t,e},this.contains=function(e,t){return 0<=this.pointIndex({row:e,column:t})},this.containsPoint=function(e){return 0<=this.pointIndex(e)},this.rangeAtPoint=function(e){e=this.pointIndex(e);if(0<=e)return this.ranges[e]},this.clipRows=function(e,t){var i=this.ranges;if(i[0].start.row>t||i[i.length-1].start.row<e)return[];for(var e=this.pointIndex({row:e,column:0}),o=this.pointIndex({row:t,column:0},e=e<0?-e-1:e),n=(o<0&&(o=-o-1),[]),s=e;s<o;s++)n.push(i[s]);return n},this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)},this.attach=function(e){this.session&&this.detach(),this.session=e,this.onChange=this.$onChange.bind(this),this.session.on("change",this.onChange)},this.detach=function(){this.session&&(this.session.removeListener("change",this.onChange),this.session=null)},this.$onChange=function(e){for(var t=e.start,i=e.end,o=t.row,n=i.row,s=this.ranges,a=0,r=s.length;a<r&&!((d=s[a]).end.row>=o);a++);if("insert"==e.action)for(var l=n-o,c=-t.column+i.column;a<r;a++){if((d=s[a]).start.row>o)break;d.start.row==o&&d.start.column>=t.column&&(d.start.column==t.column&&this.$bias<=0||(d.start.column+=c,d.start.row+=l)),d.end.row==o&&d.end.column>=t.column&&(d.end.column==t.column&&this.$bias<0||(d.end.column==t.column&&0<c&&a<r-1&&d.end.column>d.start.column&&d.end.column==s[a+1].start.column&&(d.end.column-=c),d.end.column+=c,d.end.row+=l))}else for(var d,l=o-n,c=t.column-i.column;a<r;a++){if((d=s[a]).start.row>n)break;d.end.row<n&&(o<d.end.row||o==d.end.row&&t.column<d.end.column)?(d.end.row=o,d.end.column=t.column):d.end.row==n?d.end.column<=i.column?(l||d.end.column>t.column)&&(d.end.column=t.column,d.end.row=t.row):(d.end.column+=c,d.end.row+=l):d.end.row>n&&(d.end.row+=l),d.start.row<n&&(o<d.start.row||o==d.start.row&&t.column<d.start.column)?(d.start.row=o,d.start.column=t.column):d.start.row==n?d.start.column<=i.column?(l||d.start.column>t.column)&&(d.start.column=t.column,d.start.row=t.row):(d.start.column+=c,d.start.row+=l):d.start.row>n&&(d.start.row+=l)}if(0!=l&&a<r)for(;a<r;a++)(d=s[a]).start.row+=l,d.end.row+=l}}).call(o.prototype),t.RangeList=o}),define("ace/edit_session/fold",["require","exports","module","ace/range_list","ace/lib/oop"],function(e,t,i){"use strict";function h(e,t){e.row-=t.row,0==e.row&&(e.column-=t.column)}function o(e,t){0==e.row&&(e.column+=t.column),e.row+=t.row}var n=e("../range_list").RangeList,e=e("../lib/oop"),s=t.Fold=function(e,t){this.foldLine=null,this.placeholder=t,this.range=e,this.start=e.start,this.end=e.end,this.sameRow=e.start.row==e.end.row,this.subFolds=this.ranges=[]};e.inherits(s,n),function(){this.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()},this.setFoldLine=function(t){this.foldLine=t,this.subFolds.forEach(function(e){e.setFoldLine(t)})},this.clone=function(){var e=this.range.clone(),t=new s(e,this.placeholder);return this.subFolds.forEach(function(e){t.subFolds.push(e.clone())}),t.collapseChildren=this.collapseChildren,t},this.addSubFold=function(e){if(!this.range.isEqual(e)){s=e,a=this.start,h(s.start,a),h(s.end,a);for(var t=e.start.row,i=e.start.column,o=0,n=-1;o<this.subFolds.length&&1==(n=this.subFolds[o].range.compare(t,i));o++);var s=this.subFolds[o],a=0;if(0==n){if(s.range.containsRange(e))return s.addSubFold(e);a=1}for(var t=e.range.end.row,i=e.range.end.column,r=o,n=-1;r<this.subFolds.length&&1==(n=this.subFolds[r].range.compare(t,i));r++);0==n&&r++;for(var l=this.subFolds.splice(o,r-o,e),c=0==n?l.length-1:l.length,d=a;d<c;d++)e.addSubFold(l[d]);return e.setFoldLine(this.foldLine),e}},this.restoreRange=function(e){return e=e,t=this.start,o(e.start,t),void o(e.end,t);var t}}.call(s.prototype)}),define("ace/edit_session/folding",["require","exports","module","ace/range","ace/edit_session/fold_line","ace/edit_session/fold","ace/token_iterator"],function(e,t,i){"use strict";var c=e("../range").Range,u=e("./fold_line").FoldLine,p=e("./fold").Fold,d=e("../token_iterator").TokenIterator;t.Folding=function(){this.getFoldAt=function(e,t,i){var o=this.getFoldLine(e);if(!o)return null;for(var n=o.folds,s=0;s<n.length;s++){var a=n[s].range;if(a.contains(e,t)&&(1!=i||!a.isEnd(e,t)||a.isEmpty())&&(-1!=i||!a.isStart(e,t)||a.isEmpty()))return n[s]}},this.getFoldsInRange=function(e){var t=e.start,i=e.end,o=this.$foldData,n=[];t.column+=1,--i.column;for(var s=0;s<o.length;s++){var a=o[s].range.compareRange(e);if(2!=a){if(-2==a)break;for(var r=o[s].folds,l=0;l<r.length;l++){var c=r[l];if(-2==(a=c.range.compareRange(e)))break;if(2!=a){if(42==a)break;n.push(c)}}}}return--t.column,i.column+=1,n},this.getFoldsInRangeList=function(e){var t;return Array.isArray(e)?(t=[],e.forEach(function(e){t=t.concat(this.getFoldsInRange(e))},this)):t=this.getFoldsInRange(e),t},this.getAllFolds=function(){for(var e=[],t=this.$foldData,i=0;i<t.length;i++)for(var o=0;o<t[i].folds.length;o++)e.push(t[i].folds[o]);return e},this.getFoldStringAt=function(e,t,i,o){if(!(o=o||this.getFoldLine(e)))return null;for(var n,s={end:{column:0}},a=0;a<o.folds.length;a++){var r,l=(r=o.folds[a]).range.compareEnd(e,t);if(-1==l){n=this.getLine(r.start.row).substring(s.end.column,r.start.column);break}if(0===l)return null;s=r}return n=n||this.getLine(r.start.row).substring(s.end.column),-1==i?n.substring(0,t-s.end.column):1==i?n.substring(t-s.end.column):n},this.getFoldLine=function(e,t){var i=this.$foldData,o=0;for(-1==(o=t?i.indexOf(t):o)&&(o=0);o<i.length;o++){var n=i[o];if(n.start.row<=e&&n.end.row>=e)return n;if(n.end.row>e)return null}return null},this.getNextFoldLine=function(e,t){var i=this.$foldData,o=0;for(-1==(o=t?i.indexOf(t):o)&&(o=0);o<i.length;o++){var n=i[o];if(n.end.row>=e)return n}return null},this.getFoldedRowCount=function(e,t){for(var i=this.$foldData,o=t-e+1,n=0;n<i.length;n++){var s=i[n],a=s.end.row,s=s.start.row;if(t<=a){s<t&&(e<=s?o-=t-s:o=0);break}e<=a&&(o-=e<=s?a-s:a-e+1)}return o},this.$addFoldLine=function(e){return this.$foldData.push(e),this.$foldData.sort(function(e,t){return e.start.row-t.start.row}),e},this.addFold=function(e,t){var i,o=this.$foldData,n=!1,s=(e instanceof p?i=e:(i=new p(t,e)).collapseChildren=t.collapseChildren,this.$clipRangeToDocument(i.range),i.start.row),e=i.start.column,a=i.end.row,t=i.end.column,r=this.getFoldAt(s,e,1),l=this.getFoldAt(a,t,-1);if(r&&l==r)return r.addSubFold(i);r&&!r.range.isStart(s,e)&&this.removeFold(r),l&&!l.range.isEnd(a,t)&&this.removeFold(l);e=this.getFoldsInRange(i.range);0<e.length&&(this.removeFolds(e),i.collapseChildren||e.forEach(function(e){i.addSubFold(e)}));for(var c=0;c<o.length;c++){var d=o[c];if(a==d.start.row){d.addFold(i),n=!0;break}if(s==d.end.row){if(d.addFold(i),n=!0,!i.sameRow){var h=o[c+1];if(h&&h.start.row==a){d.merge(h);break}}break}if(a<=d.start.row)break}return n||(d=this.$addFoldLine(new u(this.$foldData,i))),this.$useWrapMode?this.$updateWrapData(d.start.row,d.start.row):this.$updateRowLengthCache(d.start.row,d.start.row),this.$modified=!0,this._signal("changeFold",{data:i,action:"add"}),i},this.addFolds=function(e){e.forEach(function(e){this.addFold(e)},this)},this.removeFold=function(e){var t=e.foldLine,i=t.start.row,o=t.end.row,n=this.$foldData,s=t.folds;1==s.length?n.splice(n.indexOf(t),1):t.range.isEnd(e.end.row,e.end.column)?(s.pop(),t.end.row=s[s.length-1].end.row,t.end.column=s[s.length-1].end.column):t.range.isStart(e.start.row,e.start.column)?(s.shift(),t.start.row=s[0].start.row,t.start.column=s[0].start.column):e.sameRow?s.splice(s.indexOf(e),1):((s=(n=t.split(e.start.row,e.start.column)).folds).shift(),n.start.row=s[0].start.row,n.start.column=s[0].start.column),this.$updating||(this.$useWrapMode?this.$updateWrapData(i,o):this.$updateRowLengthCache(i,o)),this.$modified=!0,this._signal("changeFold",{data:e,action:"remove"})},this.removeFolds=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i]);t.forEach(function(e){this.removeFold(e)},this),this.$modified=!0},this.expandFold=function(t){this.removeFold(t),t.subFolds.forEach(function(e){t.restoreRange(e),this.addFold(e)},this),0<t.collapseChildren&&this.foldAll(t.start.row+1,t.end.row,t.collapseChildren-1),t.subFolds=[]},this.expandFolds=function(e){e.forEach(function(e){this.expandFold(e)},this)},this.unfold=function(e,t){var i;if(null==e)i=new c(0,0,this.getLength(),0),null==t&&(t=!0);else if("number"==typeof e)i=new c(e,0,e,this.getLine(e).length);else if("row"in e)i=c.fromPoints(e,e);else{if(Array.isArray(e))return o=[],e.forEach(function(e){o=o.concat(this.unfold(e))},this),o;i=e}for(var o,e=o=this.getFoldsInRangeList(i);1==o.length&&c.comparePoints(o[0].start,i.start)<0&&0<c.comparePoints(o[0].end,i.end);)this.expandFolds(o),o=this.getFoldsInRangeList(i);if(0!=t?this.removeFolds(o):this.expandFolds(o),e.length)return e},this.isRowFolded=function(e,t){return!!this.getFoldLine(e,t)},this.getRowFoldEnd=function(e,t){t=this.getFoldLine(e,t);return t?t.end.row:e},this.getRowFoldStart=function(e,t){t=this.getFoldLine(e,t);return t?t.start.row:e},this.getFoldDisplayLine=function(e,t,i,n,s){null==n&&(n=e.start.row),null==s&&(s=0),null==t&&(t=e.end.row),null==i&&(i=this.getLine(t).length);var a=this.doc,r="";return e.walk(function(e,t,i,o){if(!(t<n)){if(t==n){if(i<s)return;o=Math.max(s,o)}r+=null!=e?e:a.getLine(t).substring(o,i)}},t,i),r},this.getDisplayLine=function(e,t,i,o){var n=this.getFoldLine(e);return n?this.getFoldDisplayLine(n,e,t,i,o):(n=this.doc.getLine(e)).substring(o||0,t||n.length)},this.$cloneFoldData=function(){var t=[];return t=this.$foldData.map(function(e){e=e.folds.map(function(e){return e.clone()});return new u(t,e)})},this.toggleFold=function(e){var t=this.selection.getRange();if(t.isEmpty()){var i,o=t.start;if(i=this.getFoldAt(o.row,o.column))return void this.expandFold(i);(n=this.findMatchingBracket(o))?1==t.comparePoint(n)?t.end=n:(t.start=n,t.start.column++,t.end.column--):(n=this.findMatchingBracket({row:o.row,column:o.column+1}))?(1==t.comparePoint(n)?t.end=n:t.start=n,t.start.column++):t=this.getCommentFoldRange(o.row,o.column)||t}else{var n=this.getFoldsInRange(t);if(e&&n.length)return void this.expandFolds(n);1==n.length&&(i=n[0])}if((i=i||this.getFoldAt(t.start.row,t.start.column))&&i.range.toString()==t.toString())this.expandFold(i);else{o="...";if(!t.isMultiLine()){if((o=this.getTextRange(t)).length<4)return;o=o.trim().substring(0,2)+".."}this.addFold(o,t)}},this.getCommentFoldRange=function(e,t,i){var o=new d(this,e,t),n=o.getCurrentToken(),s=n&&n.type;if(n&&/^comment|string/.test(s)){"comment"==(s=s.match(/comment|string/)[0])&&(s+="|doc-start");var a=new RegExp(s),s=new c;if(1!=i){for(;(n=o.stepBackward())&&a.test(n.type););o.stepForward()}if(s.start.row=o.getCurrentTokenRow(),s.start.column=o.getCurrentTokenColumn()+2,o=new d(this,e,t),-1!=i){var r=-1;do{if(n=o.stepForward(),-1==r){var l=this.getState(o.$row);a.test(l)||(r=o.$row)}else if(o.$row>r)break}while(n&&a.test(n.type));n=o.stepBackward()}else n=o.getCurrentToken();return s.end.row=o.getCurrentTokenRow(),s.end.column=o.getCurrentTokenColumn()+n.value.length-2,s}},this.foldAll=function(e,t,i,o){null==i&&(i=1e5);var n=this.foldWidgets;if(n){t=t||this.getLength();for(var s,a=e=e||0;a<t;a++)null==n[a]&&(n[a]=this.getFoldWidget(a)),"start"!=n[a]||o&&!o(a)||(s=this.getFoldWidgetRange(a))&&s.isMultiLine()&&s.end.row<=t&&s.start.row>=e&&(a=s.end.row,s.collapseChildren=i,this.addFold("...",s))}},this.foldToLevel=function(e){for(this.foldAll();0<e--;)this.unfold(null,!1)},this.foldAllComments=function(){var n=this;this.foldAll(null,null,null,function(e){for(var t=n.getTokens(e),i=0;i<t.length;i++){var o=t[i];if("text"!=o.type||!/^\s+$/.test(o.value))return!!/comment/.test(o.type)}})},this.$foldStyles={manual:1,markbegin:1,markbeginend:1},this.$foldStyle="markbegin",this.setFoldStyle=function(e){if(!this.$foldStyles[e])throw new Error("invalid fold style: "+e+"["+Object.keys(this.$foldStyles).join(", ")+"]");this.$foldStyle!=e&&("manual"==(this.$foldStyle=e)&&this.unfold(),e=this.$foldMode,this.$setFolding(null),this.$setFolding(e))},this.$setFolding=function(e){this.$foldMode!=e&&(this.$foldMode=e,this.off("change",this.$updateFoldWidgets),this.off("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets),this._signal("changeAnnotation"),e&&"manual"!=this.$foldStyle?(this.foldWidgets=[],this.getFoldWidget=e.getFoldWidget.bind(e,this,this.$foldStyle),this.getFoldWidgetRange=e.getFoldWidgetRange.bind(e,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this),this.on("change",this.$updateFoldWidgets),this.on("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets)):this.foldWidgets=null)},this.getParentFoldRangeData=function(e,t){var i=this.foldWidgets;if(!i||t&&i[e])return{};for(var o=e-1;0<=o;){var n=i[o];if("start"==(n=null==n?i[o]=this.getFoldWidget(o):n)){var s=this.getFoldWidgetRange(o),a=a||s;if(s&&s.end.row>=e)break}o--}return{range:-1!==o&&s,firstRange:a}},this.onFoldWidgetClick=function(e,t){var i={children:(t=t.domEvent).shiftKey,all:t.ctrlKey||t.metaKey,siblings:t.altKey};this.$toggleFoldWidget(e,i)||(e=t.target||t.srcElement)&&/ace_fold-widget/.test(e.className)&&(e.className+=" ace_invalid")},this.$toggleFoldWidget=function(e,t){if(this.getFoldWidget){var i=this.getFoldWidget(e),o=this.getLine(e),i="end"===i?-1:1,o=this.getFoldAt(e,-1==i?0:o.length,i);if(o)return t.children||t.all?this.removeFold(o):this.expandFold(o),o;var n,s,i=this.getFoldWidgetRange(e,!0);return i&&!i.isMultiLine()&&(o=this.getFoldAt(i.start.row,i.start.column,1))&&i.isEqual(o.range)?(this.removeFold(o),o):(t.siblings?((o=this.getParentFoldRangeData(e)).range&&(n=o.range.start.row+1,s=o.range.end.row),this.foldAll(n,s,t.all?1e4:0)):t.children?(s=i?i.end.row:this.getLength(),this.foldAll(e+1,s,t.all?1e4:0)):i&&(t.all&&(i.collapseChildren=1e4),this.addFold("...",i)),i)}},this.toggleFoldWidget=function(e){var t,i=this.selection.getCursor().row;i=this.getRowFoldStart(i),this.$toggleFoldWidget(i,{})||(t=(t=this.getParentFoldRangeData(i,!0)).range||t.firstRange)&&(i=t.start.row,(i=this.getFoldAt(i,this.getLine(i).length,1))?this.removeFold(i):this.addFold("...",t))},this.updateFoldWidgets=function(e){var t=e.start.row,i=e.end.row-t;0==i?this.foldWidgets[t]=null:"remove"==e.action?this.foldWidgets.splice(t,1+i,null):((e=Array(1+i)).unshift(t,1),this.foldWidgets.splice.apply(this.foldWidgets,e))},this.tokenizerUpdateFoldWidgets=function(e){e=e.data;e.first!=e.last&&this.foldWidgets.length>e.first&&this.foldWidgets.splice(e.first,this.foldWidgets.length)}}}),define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"],function(e,t,i){"use strict";var h=e("../token_iterator").TokenIterator,r=e("../range").Range;t.BracketMatch=function(){this.findMatchingBracket=function(e,t){if(0==e.column)return null;t=t||this.getLine(e.row).charAt(e.column-1);if(""==t)return null;t=t.match(/([\(\[\{])|([\)\]\}])/);return t?t[1]?this.$findClosingBracket(t[1],e):this.$findOpeningBracket(t[2],e):null},this.getBracketRange=function(e){var t,i,o=this.getLine(e.row),n=!0,s=o.charAt(e.column-1),a=s&&s.match(/([\(\[\{])|([\)\]\}])/);if(a||(s=o.charAt(e.column),e={row:e.row,column:e.column+1},a=s&&s.match(/([\(\[\{])|([\)\]\}])/),n=!1),!a)return null;if(a[1]){if(!(i=this.$findClosingBracket(a[1],e)))return null;t=r.fromPoints(e,i),n||(t.end.column++,t.start.column--),t.cursor=t.end}else{if(!(i=this.$findOpeningBracket(a[2],e)))return null;t=r.fromPoints(i,e),n||(t.start.column++,t.end.column--),t.cursor=t.start}return t},this.getMatchingBracketRanges=function(e){var t=this.getLine(e.row),i=t.charAt(e.column-1),o=i&&i.match(/([\(\[\{])|([\)\]\}])/);if(o||(i=t.charAt(e.column),e={row:e.row,column:e.column+1},o=i&&i.match(/([\(\[\{])|([\)\]\}])/)),!o)return null;t=new r(e.row,e.column-1,e.row,e.column),i=o[1]?this.$findClosingBracket(o[1],e):this.$findOpeningBracket(o[2],e);return i?[t,new r(i.row,i.column,i.row,i.column+1)]:[t]},this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{","<":">",">":"<"},this.$findOpeningBracket=function(e,t,i){var o=this.$brackets[e],n=1,s=new h(this,t.row,t.column),a=s.getCurrentToken();if(a=a||s.stepForward()){i=i||new RegExp("(\\.?"+a.type.replace(".","\\.").replace("rparen",".paren").replace(/\b(?:end)\b/,"(?:start|begin|end)")+")+");for(var r=t.column-s.getCurrentTokenColumn()-2,l=a.value;;){for(;0<=r;){var c=l.charAt(r);if(c==o){if(0==--n)return{row:s.getCurrentTokenRow(),column:r+s.getCurrentTokenColumn()}}else c==e&&(n+=1);--r}for(;(a=s.stepBackward())&&!i.test(a.type););if(null==a)break;r=(l=a.value).length-1}return null}},this.$findClosingBracket=function(e,t,i){var o=this.$brackets[e],n=1,s=new h(this,t.row,t.column),a=s.getCurrentToken();if(a=a||s.stepForward()){i=i||new RegExp("(\\.?"+a.type.replace(".","\\.").replace("lparen",".paren").replace(/\b(?:start|begin)\b/,"(?:start|begin|end)")+")+");for(var r=t.column-s.getCurrentTokenColumn();;){for(var l=a.value,c=l.length;r<c;){var d=l.charAt(r);if(d==o){if(0==--n)return{row:s.getCurrentTokenRow(),column:r+s.getCurrentTokenColumn()}}else d==e&&(n+=1);r+=1}for(;(a=s.stepForward())&&!i.test(a.type););if(null==a)break;r=0}return null}}}}),define("ace/edit_session",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/bidihandler","ace/config","ace/lib/event_emitter","ace/selection","ace/mode/text","ace/range","ace/document","ace/background_tokenizer","ace/search_highlight","ace/edit_session/folding","ace/edit_session/bracket_match"],function(e,t,i){"use strict";function o(e,t){this.$breakpoints=[],this.$decorations=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$undoSelect=!0,this.$foldData=[],this.id="session"+ ++o.$uid,this.$foldData.toString=function(){return this.join("\n")},this.bgTokenizer=new p((new d).getTokenizer(),this);var i=this;this.bgTokenizer.on("update",function(e){i._signal("tokenizerUpdate",e)}),this.on("changeFold",this.onChangeFold.bind(this)),this.$onChange=this.onChange.bind(this),"object"==typeof e&&e.getLine||(e=new u(e)),this.setDocument(e),this.selection=new r(this),this.$bidiHandler=new a(this),l.resetOptions(this),this.setMode(t),l._signal("session",this),this.destroyed=!1}var n=e("./lib/oop"),s=e("./lib/lang"),a=e("./bidihandler").BidiHandler,l=e("./config"),c=e("./lib/event_emitter").EventEmitter,r=e("./selection").Selection,d=e("./mode/text").Mode,h=e("./range").Range,u=e("./document").Document,p=e("./background_tokenizer").BackgroundTokenizer,g=e("./search_highlight").SearchHighlight;o.$uid=0,function(){function r(e){return!(e<4352)&&(4352<=e&&e<=4447||4515<=e&&e<=4519||4602<=e&&e<=4607||9001<=e&&e<=9002||11904<=e&&e<=11929||11931<=e&&e<=12019||12032<=e&&e<=12245||12272<=e&&e<=12283||12288<=e&&e<=12350||12353<=e&&e<=12438||12441<=e&&e<=12543||12549<=e&&e<=12589||12593<=e&&e<=12686||12688<=e&&e<=12730||12736<=e&&e<=12771||12784<=e&&e<=12830||12832<=e&&e<=12871||12880<=e&&e<=13054||13056<=e&&e<=19903||19968<=e&&e<=42124||42128<=e&&e<=42182||43360<=e&&e<=43388||44032<=e&&e<=55203||55216<=e&&e<=55238||55243<=e&&e<=55291||63744<=e&&e<=64255||65040<=e&&e<=65049||65072<=e&&e<=65106||65108<=e&&e<=65126||65128<=e&&e<=65131||65281<=e&&e<=65376||65504<=e&&e<=65510)}n.implement(this,c),this.setDocument=function(e){this.doc&&this.doc.off("change",this.$onChange),(this.doc=e).on("change",this.$onChange,!0),this.bgTokenizer.setDocument(this.getDocument()),this.resetCaches()},this.getDocument=function(){return this.doc},this.$resetRowCache=function(e){var t;e?(t=this.$docRowCache.length,(e=this.$getRowCacheIndex(this.$docRowCache,e)+1)<t&&(this.$docRowCache.splice(e,t),this.$screenRowCache.splice(e,t))):(this.$docRowCache=[],this.$screenRowCache=[])},this.$getRowCacheIndex=function(e,t){for(var i=0,o=e.length-1;i<=o;){var n=i+o>>1,s=e[n];if(s<t)i=1+n;else{if(!(t<s))return n;o=n-1}}return i-1},this.resetCaches=function(){this.$modified=!0,this.$wrapData=[],this.$rowLengthCache=[],this.$resetRowCache(0),this.destroyed||this.bgTokenizer.start(0)},this.onChangeFold=function(e){e=e.data;this.$resetRowCache(e.start.row)},this.onChange=function(e){this.$modified=!0,this.$bidiHandler.onChange(e),this.$resetRowCache(e.start.row);var t=this.$updateInternalDataOnChange(e);!this.$fromUndo&&this.$undoManager&&(t&&t.length&&(this.$undoManager.add({action:"removeFolds",folds:t},this.mergeUndoDeltas),this.mergeUndoDeltas=!0),this.$undoManager.add(e,this.mergeUndoDeltas),this.mergeUndoDeltas=!0,this.$informUndoManager.schedule()),this.bgTokenizer.$updateOnChange(e),this._signal("change",e)},this.setValue=function(e){this.doc.setValue(e),this.selection.moveTo(0,0),this.$resetRowCache(0),this.setUndoManager(this.$undoManager),this.getUndoManager().reset()},this.getValue=this.toString=function(){return this.doc.getValue()},this.getSelection=function(){return this.selection},this.getState=function(e){return this.bgTokenizer.getState(e)},this.getTokens=function(e){return this.bgTokenizer.getTokens(e)},this.getTokenAt=function(e,t){var i=this.bgTokenizer.getTokens(e),o=0;if(null==t)var n=i.length-1,o=this.getLine(e).length;else for(n=0;n<i.length&&!(t<=(o+=i[n].value.length));n++);return(e=i[n])?(e.index=n,e.start=o-e.value.length,e):null},this.setUndoManager=function(e){var t;this.$undoManager=e,this.$informUndoManager&&this.$informUndoManager.cancel(),e?(e.addSession(t=this),this.$syncInformUndoManager=function(){t.$informUndoManager.cancel(),t.mergeUndoDeltas=!1},this.$informUndoManager=s.delayedCall(this.$syncInformUndoManager)):this.$syncInformUndoManager=function(){}},this.markUndoGroup=function(){this.$syncInformUndoManager&&this.$syncInformUndoManager()},this.$defaultUndoManager={undo:function(){},redo:function(){},hasUndo:function(){},hasRedo:function(){},reset:function(){},add:function(){},addSelection:function(){},startNewGroup:function(){},addSession:function(){}},this.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},this.getTabString=function(){return this.getUseSoftTabs()?s.stringRepeat(" ",this.getTabSize()):"\t"},this.setUseSoftTabs=function(e){this.setOption("useSoftTabs",e)},this.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs},this.setTabSize=function(e){this.setOption("tabSize",e)},this.getTabSize=function(){return this.$tabSize},this.isTabStop=function(e){return this.$useSoftTabs&&e.column%this.$tabSize==0},this.setNavigateWithinSoftTabs=function(e){this.setOption("navigateWithinSoftTabs",e)},this.getNavigateWithinSoftTabs=function(){return this.$navigateWithinSoftTabs},this.$overwrite=!1,this.setOverwrite=function(e){this.setOption("overwrite",e)},this.getOverwrite=function(){return this.$overwrite},this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},this.addGutterDecoration=function(e,t){this.$decorations[e]||(this.$decorations[e]=""),this.$decorations[e]+=" "+t,this._signal("changeBreakpoint",{})},this.removeGutterDecoration=function(e,t){this.$decorations[e]=(this.$decorations[e]||"").replace(" "+t,""),this._signal("changeBreakpoint",{})},this.getBreakpoints=function(){return this.$breakpoints},this.setBreakpoints=function(e){this.$breakpoints=[];for(var t=0;t<e.length;t++)this.$breakpoints[e[t]]="ace_breakpoint";this._signal("changeBreakpoint",{})},this.clearBreakpoints=function(){this.$breakpoints=[],this._signal("changeBreakpoint",{})},this.setBreakpoint=function(e,t){(t=void 0===t?"ace_breakpoint":t)?this.$breakpoints[e]=t:delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.clearBreakpoint=function(e){delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.addMarker=function(e,t,i,o){var n=this.$markerId++,e={range:e,type:i||"line",renderer:"function"==typeof i?i:null,clazz:t,inFront:!!o,id:n};return o?(this.$frontMarkers[n]=e,this._signal("changeFrontMarker")):(this.$backMarkers[n]=e,this._signal("changeBackMarker")),n},this.addDynamicMarker=function(e,t){var i;if(e.update)return i=this.$markerId++,e.id=i,e.inFront=!!t,t?(this.$frontMarkers[i]=e,this._signal("changeFrontMarker")):(this.$backMarkers[i]=e,this._signal("changeBackMarker")),e},this.removeMarker=function(e){var t=this.$frontMarkers[e]||this.$backMarkers[e];t&&(delete(t.inFront?this.$frontMarkers:this.$backMarkers)[e],this._signal(t.inFront?"changeFrontMarker":"changeBackMarker"))},this.getMarkers=function(e){return e?this.$frontMarkers:this.$backMarkers},this.highlight=function(e){var t;this.$searchHighlight||(t=new g(null,"ace_selected-word","text"),this.$searchHighlight=this.addDynamicMarker(t)),this.$searchHighlight.setRegexp(e)},this.highlightLines=function(e,t,i,o){"number"!=typeof t&&(i=t,t=e),i=i||"ace_step";e=new h(e,0,t,1/0);return e.id=this.addMarker(e,i,"fullLine",o),e},this.setAnnotations=function(e){this.$annotations=e,this._signal("changeAnnotation",{})},this.getAnnotations=function(){return this.$annotations||[]},this.clearAnnotations=function(){this.setAnnotations([])},this.$detectNewLine=function(e){e=e.match(/^.*?(\r?\n)/m);this.$autoNewLine=e?e[1]:"\n"},this.getWordRange=function(e,t){var i,o=this.getLine(e),n=!1,s=(i=(n=(n=0<t?!!o.charAt(t-1).match(this.tokenRe):n)||!!o.charAt(t).match(this.tokenRe))?this.tokenRe:/^\s+$/.test(o.slice(t-1,t+1))?/\s/:this.nonTokenRe,t);if(0<s){for(;0<=--s&&o.charAt(s).match(i););s++}for(var a=t;a<o.length&&o.charAt(a).match(i);)a++;return new h(e,s,e,a)},this.getAWordRange=function(e,t){for(var i=this.getWordRange(e,t),o=this.getLine(i.end.row);o.charAt(i.end.column).match(/[ \t]/);)i.end.column+=1;return i},this.setNewLineMode=function(e){this.doc.setNewLineMode(e)},this.getNewLineMode=function(){return this.doc.getNewLineMode()},this.setUseWorker=function(e){this.setOption("useWorker",e)},this.getUseWorker=function(){return this.$useWorker},this.onReloadTokenizer=function(e){var t=e.data;this.bgTokenizer.start(t.first),this._signal("tokenizerUpdate",e)},this.$modes=l.$modes,this.$mode=null,this.$modeId=null,this.setMode=function(e,t){if(e&&"object"==typeof e){if(e.getTokenizer)return this.$onChangeMode(e);var i=e,o=i.path}else o=e||"ace/mode/text";this.$modes["ace/mode/text"]||(this.$modes["ace/mode/text"]=new d),this.$modes[o]&&!i?(this.$onChangeMode(this.$modes[o]),t&&t()):(this.$modeId=o,l.loadModule(["mode",o],function(e){if(this.$modeId!==o)return t&&t();this.$modes[o]&&!i?this.$onChangeMode(this.$modes[o]):e&&e.Mode&&(e=new e.Mode(i),i||((this.$modes[o]=e).$id=o),this.$onChangeMode(e)),t&&t()}.bind(this)),this.$mode||this.$onChangeMode(this.$modes["ace/mode/text"],!0))},this.$onChangeMode=function(e,t){var i,o,n;t||(this.$modeId=e.$id),this.$mode!==e&&(i=this.$mode,this.$mode=e,this.$stopWorker(),this.$useWorker&&this.$startWorker(),void 0!==(o=e.getTokenizer()).on&&(n=this.onReloadTokenizer.bind(this),o.on("update",n)),this.bgTokenizer.setTokenizer(o),this.bgTokenizer.setDocument(this.getDocument()),this.tokenRe=e.tokenRe,this.nonTokenRe=e.nonTokenRe,t||(e.attachToSession&&e.attachToSession(this),this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(e.foldingRules),this.bgTokenizer.start(0),this._emit("changeMode",{oldMode:i,mode:e})))},this.$stopWorker=function(){this.$worker&&(this.$worker.terminate(),this.$worker=null)},this.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(e){l.warn("Could not load worker",e),this.$worker=null}},this.getMode=function(){return this.$mode},this.$scrollTop=0,this.setScrollTop=function(e){this.$scrollTop===e||isNaN(e)||(this.$scrollTop=e,this._signal("changeScrollTop",e))},this.getScrollTop=function(){return this.$scrollTop},this.$scrollLeft=0,this.setScrollLeft=function(e){this.$scrollLeft===e||isNaN(e)||(this.$scrollLeft=e,this._signal("changeScrollLeft",e))},this.getScrollLeft=function(){return this.$scrollLeft},this.getScreenWidth=function(){return this.$computeWidth(),this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),this.screenWidth):this.screenWidth},this.getLineWidgetMaxWidth=function(){if(null!=this.lineWidgetsWidth)return this.lineWidgetsWidth;var t=0;return this.lineWidgets.forEach(function(e){e&&e.screenWidth>t&&(t=e.screenWidth)}),this.lineWidgetWidth=t},this.$computeWidth=function(e){if(this.$modified||e){if(this.$modified=!1,this.$useWrapMode)return this.screenWidth=this.$wrapLimit;for(var t=this.doc.getAllLines(),i=this.$rowLengthCache,o=0,n=0,s=this.$foldData[n],a=s?s.start.row:1/0,r=t.length,l=0;l<r;l++){if(a<l){if(r<=(l=s.end.row+1))break;a=(s=this.$foldData[n++])?s.start.row:1/0}null==i[l]&&(i[l]=this.$getStringScreenWidth(t[l])[0]),i[l]>o&&(o=i[l])}this.screenWidth=o}},this.getLine=function(e){return this.doc.getLine(e)},this.getLines=function(e,t){return this.doc.getLines(e,t)},this.getLength=function(){return this.doc.getLength()},this.getTextRange=function(e){return this.doc.getTextRange(e||this.selection.getRange())},this.insert=function(e,t){return this.doc.insert(e,t)},this.remove=function(e){return this.doc.remove(e)},this.removeFullLines=function(e,t){return this.doc.removeFullLines(e,t)},this.undoChanges=function(e,t){if(e.length){this.$fromUndo=!0;for(var i=e.length-1;-1!=i;i--){var o=e[i];"insert"==o.action||"remove"==o.action?this.doc.revertDelta(o):o.folds&&this.addFolds(o.folds)}!t&&this.$undoSelect&&(e.selectionBefore?this.selection.fromJSON(e.selectionBefore):this.selection.setRange(this.$getUndoSelection(e,!0))),this.$fromUndo=!1}},this.redoChanges=function(e,t){if(e.length){this.$fromUndo=!0;for(var i=0;i<e.length;i++){var o=e[i];"insert"!=o.action&&"remove"!=o.action||this.doc.$safeApplyDelta(o)}!t&&this.$undoSelect&&(e.selectionAfter?this.selection.fromJSON(e.selectionAfter):this.selection.setRange(this.$getUndoSelection(e,!1))),this.$fromUndo=!1}},this.setUndoSelect=function(e){this.$undoSelect=e},this.$getUndoSelection=function(e,t){function i(e){return t?"insert"!==e.action:"insert"===e.action}for(var o,n,s=0;s<e.length;s++){var a=e[s];a.start&&(o?i(a)?(n=a.start,-1==o.compare(n.row,n.column)&&o.setStart(n),n=a.end,1==o.compare(n.row,n.column)&&o.setEnd(n)):(n=a.start,-1==o.compare(n.row,n.column)&&(o=h.fromPoints(a.start,a.start))):o=i(a)?h.fromPoints(a.start,a.end):h.fromPoints(a.start,a.start))}return o},this.replace=function(e,t){return this.doc.replace(e,t)},this.moveText=function(e,t,i){var o,n,s,a=this.getTextRange(e),r=this.getFoldsInRange(e),t=h.fromPoints(t,t);return i||(this.remove(e),n=e.start.row-e.end.row,(s=n?-e.end.column:e.start.column-e.end.column)&&(t.start.row==e.end.row&&t.start.column>e.end.column&&(t.start.column+=s),t.end.row==e.end.row&&t.end.column>e.end.column&&(t.end.column+=s)),n&&t.start.row>=e.end.row&&(t.start.row+=n,t.end.row+=n)),t.end=this.insert(t.start,a),r.length&&(o=e.start,i=t.start,n=i.row-o.row,s=i.column-o.column,this.addFolds(r.map(function(e){return(e=e.clone()).start.row==o.row&&(e.start.column+=s),e.end.row==o.row&&(e.end.column+=s),e.start.row+=n,e.end.row+=n,e}))),t},this.indentRows=function(e,t,i){i=i.replace(/\t/g,this.getTabString());for(var o=e;o<=t;o++)this.doc.insertInLine({row:o,column:0},i)},this.outdentRows=function(e){for(var t=e.collapseRows(),i=new h(0,0,0,0),o=this.getTabSize(),n=t.start.row;n<=t.end.row;++n){var s=this.getLine(n);i.start.row=n,i.end.row=n;for(var a=0;a<o&&" "==s.charAt(a);++a);a<o&&"\t"==s.charAt(a)?(i.start.column=a,i.end.column=a+1):(i.start.column=0,i.end.column=a),this.remove(i)}},this.$moveLines=function(e,t,i){if(e=this.getRowFoldStart(e),t=this.getRowFoldEnd(t),i<0){if((n=this.getRowFoldStart(e+i))<0)return 0;var o=n-e}else if(0<i){if((n=this.getRowFoldEnd(t+i))>this.doc.getLength()-1)return 0;o=n-t}else{e=this.$clipRowToDocument(e);o=(t=this.$clipRowToDocument(t))-e+1}var n=new h(e,0,t,Number.MAX_VALUE),n=this.getFoldsInRange(n).map(function(e){return(e=e.clone()).start.row+=o,e.end.row+=o,e}),i=0==i?this.doc.getLines(e,t):this.doc.removeFullLines(e,t);return this.doc.insertFullLines(e+o,i),n.length&&this.addFolds(n),o},this.moveLinesUp=function(e,t){return this.$moveLines(e,t,-1)},this.moveLinesDown=function(e,t){return this.$moveLines(e,t,1)},this.duplicateLines=function(e,t){return this.$moveLines(e,t,0)},this.$clipRowToDocument=function(e){return Math.max(0,Math.min(e,this.doc.getLength()-1))},this.$clipColumnToRow=function(e,t){return t<0?0:Math.min(this.doc.getLine(e).length,t)},this.$clipPositionToDocument=function(e,t){var i;return t=Math.max(0,t),t=e<0?e=0:(i=this.doc.getLength())<=e?this.doc.getLine(e=i-1).length:Math.min(this.doc.getLine(e).length,t),{row:e,column:t}},this.$clipRangeToDocument=function(e){e.start.row<0?(e.start.row=0,e.start.column=0):e.start.column=this.$clipColumnToRow(e.start.row,e.start.column);var t=this.doc.getLength()-1;return e.end.row>t?(e.end.row=t,e.end.column=this.doc.getLine(t).length):e.end.column=this.$clipColumnToRow(e.end.row,e.end.column),e},this.$wrapLimit=80,this.$useWrapMode=!1,this.$wrapLimitRange={min:null,max:null},this.setUseWrapMode=function(e){e!=this.$useWrapMode&&(this.$useWrapMode=e,this.$modified=!0,this.$resetRowCache(0),e&&(e=this.getLength(),this.$wrapData=Array(e),this.$updateWrapData(0,e-1)),this._signal("changeWrapMode"))},this.getUseWrapMode=function(){return this.$useWrapMode},this.setWrapLimitRange=function(e,t){this.$wrapLimitRange.min===e&&this.$wrapLimitRange.max===t||(this.$wrapLimitRange={min:e,max:t},this.$modified=!0,this.$bidiHandler.markAsDirty(),this.$useWrapMode&&this._signal("changeWrapMode"))},this.adjustWrapLimit=function(e,t){var i=this.$wrapLimitRange,t=(i.max<0&&(i={min:t,max:t}),this.$constrainWrapLimit(e,i.min,i.max));return t!=this.$wrapLimit&&1<t&&(this.$wrapLimit=t,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal("changeWrapLimit")),!0)},this.$constrainWrapLimit=function(e,t,i){return t&&(e=Math.max(t,e)),e=i?Math.min(i,e):e},this.getWrapLimit=function(){return this.$wrapLimit},this.setWrapLimit=function(e){this.setWrapLimitRange(e,e)},this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},this.$updateInternalDataOnChange=function(e){var t=this.$useWrapMode,i=e.action,o=e.start,n=e.end,s=o.row,a=n.row,r=a-s,l=null;if(this.$updating=!0,0!=r)if("remove"===i){this[t?"$wrapData":"$rowLengthCache"].splice(s,r);var c=this.$foldData,l=this.getFoldsInRange(e);this.removeFolds(l);var d=0;for((p=this.getFoldLine(n.row))&&(p.addRemoveChars(n.row,n.column,o.column-n.column),p.shiftRow(-r),(h=this.getFoldLine(s))&&h!==p&&(h.merge(p),p=h),d=c.indexOf(p)+1);d<c.length;d++)(p=c[d]).start.row>=n.row&&p.shiftRow(-r);a=s}else{var h=Array(r),u=(h.unshift(s,0),t?this.$wrapData:this.$rowLengthCache),c=(u.splice.apply(u,h),this.$foldData),d=0;for((p=this.getFoldLine(s))&&(0==(u=p.range.compareInside(o.row,o.column))?(p=p.split(o.row,o.column))&&(p.shiftRow(r),p.addRemoveChars(a,0,n.column-o.column)):-1==u&&(p.addRemoveChars(s,0,n.column-o.column),p.shiftRow(r)),d=c.indexOf(p)+1);d<c.length;d++)(p=c[d]).start.row>=s&&p.shiftRow(r)}else{var p,r=Math.abs(e.start.column-e.end.column);"remove"===i&&(l=this.getFoldsInRange(e),this.removeFolds(l),r=-r),(p=this.getFoldLine(s))&&p.addRemoveChars(s,o.column,r)}return t&&this.$wrapData.length!=this.doc.getLength()&&console.error("doc.getLength() and $wrapData.length have to be the same!"),this.$updating=!1,t?this.$updateWrapData(s,a):this.$updateRowLengthCache(s,a),l},this.$updateRowLengthCache=function(e,t,i){this.$rowLengthCache[e]=null,this.$rowLengthCache[t]=null},this.$updateWrapData=function(e,t){var a,i,r=this.doc.getAllLines(),o=this.getTabSize(),n=this.$wrapData,s=this.$wrapLimit,l=e;for(t=Math.min(t,r.length-1);l<=t;)(i=this.getFoldLine(l,i))?(a=[],i.walk(function(e,t,i,o){var n;if(null!=e){(n=this.$getDisplayTokens(e,a.length))[0]=m;for(var s=1;s<n.length;s++)n[s]=f}else n=this.$getDisplayTokens(r[t].substring(o,i),a.length);a=a.concat(n)}.bind(this),i.end.row,r[i.end.row].length+1),n[i.start.row]=this.$computeWrapSplits(a,s,o),l=i.end.row+1):(a=this.$getDisplayTokens(r[l]),n[l]=this.$computeWrapSplits(a,s,o),l++)};var m=3,f=4;this.$computeWrapSplits=function(n,e,s){function t(e){for(var t=e-r,i=r;i<e;i++){var o=n[i];12!==o&&2!==o||--t}a.length||(u=function(){var e=0;if(0===h)return e;if(d)for(var t=0;t<n.length;t++){var i=n[t];if(10==i)e+=1;else{if(11!=i){if(12==i)continue;break}e+=s}}return c&&!1!==d&&(e+=s),Math.min(e,h)}(),a.indent=u),l+=t,a.push(l),r=e}if(0==n.length)return[];for(var a=[],i=n.length,r=0,l=0,c=this.$wrapAsCode,d=this.$indentedSoftWrap,h=e<=Math.max(2*s,8)||!1===d?0:Math.floor(e/2),u=0;e-u<i-r;){var o=r+e-u;if(10<=n[o-1]&&10<=n[o])t(o);else if(n[o]==m||n[o]==f){for(;o!=r-1&&n[o]!=m;o--);if(r<o);else{for(o=r+e;o<n.length&&n[o]==f;o++);if(o==n.length)break}t(o)}else{for(var p=Math.max(o-(e-(e>>2)),r-1);p<o&&n[o]<m;)o--;if(c){for(;p<o&&n[o]<m;)o--;for(;p<o&&9==n[o];)o--}else for(;p<o&&n[o]<10;)o--;p<o?t(++o):(2==n[o=r+e]&&o--,t(o-u))}}return a},this.$getDisplayTokens=function(e,t){var i,o=[];t=t||0;for(var n=0;n<e.length;n++){var s=e.charCodeAt(n);if(9==s){i=this.getScreenTabSize(o.length+t),o.push(11);for(var a=1;a<i;a++)o.push(12)}else 32==s?o.push(10):39<s&&s<48||57<s&&s<64?o.push(9):4352<=s&&r(s)?o.push(1,2):o.push(1)}return o},this.$getStringScreenWidth=function(e,t,i){if(0==t)return[0,0];var o,n;for(null==t&&(t=1/0),i=i||0,n=0;n<e.length&&(9==(o=e.charCodeAt(n))?i+=this.getScreenTabSize(i):4352<=o&&r(o)?i+=2:i+=1,!(t<i));n++);return[i,n]},this.lineWidgets=null,this.getRowLength=function(e){var t=1;return this.lineWidgets&&(t+=this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0),this.$useWrapMode&&this.$wrapData[e]?this.$wrapData[e].length+t:t},this.getRowLineCount=function(e){return this.$useWrapMode&&this.$wrapData[e]?this.$wrapData[e].length+1:1},this.getRowWrapIndent=function(e){var t;return this.$useWrapMode?(e=this.screenToDocumentPosition(e,Number.MAX_VALUE),(t=this.$wrapData[e.row]).length&&t[0]<e.column?t.indent:0):0},this.getScreenLastRowColumn=function(e){e=this.screenToDocumentPosition(e,Number.MAX_VALUE);return this.documentToScreenColumn(e.row,e.column)},this.getDocumentLastRowColumn=function(e,t){e=this.documentToScreenRow(e,t);return this.getScreenLastRowColumn(e)},this.getDocumentLastRowColumnPosition=function(e,t){e=this.documentToScreenRow(e,t);return this.screenToDocumentPosition(e,Number.MAX_VALUE/10)},this.getRowSplitData=function(e){return this.$useWrapMode?this.$wrapData[e]:void 0},this.getScreenTabSize=function(e){return this.$tabSize-(e%this.$tabSize|0)},this.screenToDocumentRow=function(e,t){return this.screenToDocumentPosition(e,t).row},this.screenToDocumentColumn=function(e,t){return this.screenToDocumentPosition(e,t).column},this.screenToDocumentPosition=function(e,t,i){if(e<0)return{row:0,column:0};for(var o,n,s,a=0,r=0,l=0,c=0,d=this.$screenRowCache,h=this.$getRowCacheIndex(d,e),u=d.length,p=(s=u&&0<=h?(l=d[h],a=this.$docRowCache[h],e>d[u-1]):!u,this.getLength()-1),m=this.getNextFoldLine(a),f=m?m.start.row:1/0;l<=e&&!(e<l+(c=this.getRowLength(a))||p<=a);)l+=c,f<++a&&(a=m.end.row+1,f=(m=this.getNextFoldLine(a,m))?m.start.row:1/0),s&&(this.$docRowCache.push(a),this.$screenRowCache.push(l));if(m&&m.start.row<=a)o=this.getFoldDisplayLine(m),a=m.start.row;else{if(l+c<=e||p<a)return{row:p,column:this.getLine(p).length};o=this.getLine(a),m=null}h=0,d=Math.floor(e-l);return this.$useWrapMode&&(u=this.$wrapData[a])&&(n=u[d],0<d&&u.length&&(h=u.indent,r=u[d-1]||u[u.length-1],o=o.substring(r))),void 0!==i&&this.$bidiHandler.isBidiRow(l+d,a,d)&&(t=this.$bidiHandler.offsetToCol(i)),r+=this.$getStringScreenWidth(o,t-h)[1],this.$useWrapMode&&n<=r&&(r=n-1),m?m.idxToPosition(r):{row:a,column:r}},this.documentToScreenPosition=function(e,t){var i=void 0===t?this.$clipPositionToDocument(e.row,e.column):this.$clipPositionToDocument(e,t),o=(e=i.row,t=i.column,0),i=null;(r=this.getFoldAt(e,t,1))&&(e=r.start.row,t=r.start.column);for(var n,s,a=0,r=this.$docRowCache,l=this.$getRowCacheIndex(r,e),c=r.length,d=(s=c&&0<=l?(a=r[l],o=this.$screenRowCache[l],e>r[c-1]):!c,this.getNextFoldLine(a)),h=d?d.start.row:1/0;a<e;){if(h<=a){if(e<(n=d.end.row+1))break;h=(d=this.getNextFoldLine(n,d))?d.start.row:1/0}else n=a+1;o+=this.getRowLength(a),a=n,s&&(this.$docRowCache.push(a),this.$screenRowCache.push(o))}var u="",i=d&&h<=a?(u=this.getFoldDisplayLine(d,e,t),d.start.row):(u=this.getLine(e).substring(0,t),e),l=0;if(this.$useWrapMode){var p=this.$wrapData[i];if(p){for(var m=0;u.length>=p[m];)o++,m++;u=u.substring(p[m-1]||0,u.length),l=0<m?p.indent:0}}return this.lineWidgets&&this.lineWidgets[a]&&this.lineWidgets[a].rowsAbove&&(o+=this.lineWidgets[a].rowsAbove),{row:o,column:l+this.$getStringScreenWidth(u)[0]}},this.documentToScreenColumn=function(e,t){return this.documentToScreenPosition(e,t).column},this.documentToScreenRow=function(e,t){return this.documentToScreenPosition(e,t).row},this.getScreenLength=function(){var e=0,t=null;if(this.$useWrapMode)for(var i=this.$wrapData.length,o=0,n=0,s=(t=this.$foldData[n++])?t.start.row:1/0;o<i;){var a=this.$wrapData[o];e+=a?a.length+1:1,s<++o&&(o=t.end.row+1,s=(t=this.$foldData[n++])?t.start.row:1/0)}else for(var e=this.getLength(),r=this.$foldData,n=0;n<r.length;n++)e-=(t=r[n]).end.row-t.start.row;return this.lineWidgets&&(e+=this.$getWidgetScreenLength()),e},this.$setFontMetrics=function(s){this.$enableVarChar&&(this.$getStringScreenWidth=function(e,t,i){if(0===t)return[0,0];var o,n;for(t=t||1/0,i=i||0,n=0;n<e.length&&!(t<(i+="\t"===(o=e.charAt(n))?this.getScreenTabSize(i):s.getCharacterWidth(o)));n++);return[i,n]})},this.destroy=function(){this.destroyed||(this.bgTokenizer.setDocument(null),this.bgTokenizer.cleanup(),this.destroyed=!0),this.$stopWorker(),this.removeAllListeners(),this.doc&&this.doc.off("change",this.$onChange),this.selection.detach()},this.isFullWidth=r}.call(o.prototype),e("./edit_session/folding").Folding.call(o.prototype),e("./edit_session/bracket_match").BracketMatch.call(o.prototype),l.defineOptions(o.prototype,"session",{wrap:{set:function(e){e&&"off"!=e?"free"==e?e=!0:"printMargin"==e?e=-1:"string"==typeof e&&(e=parseInt(e,10)||!1):e=!1,this.$wrap!=e&&((this.$wrap=e)?(this.setWrapLimitRange(e="number"==typeof e?e:null,e),this.setUseWrapMode(!0)):this.setUseWrapMode(!1))},get:function(){return this.getUseWrapMode()?-1==this.$wrap?"printMargin":this.getWrapLimitRange().min?this.$wrap:"free":"off"},handlesSet:!0},wrapMethod:{set:function(e){(e="auto"==e?"text"!=this.$mode.type:"text"!=e)!=this.$wrapAsCode&&(this.$wrapAsCode=e,this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0)))},initialValue:"auto"},indentedSoftWrap:{set:function(){this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0))},initialValue:!0},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(e){this.$useWorker=e,this.$stopWorker(),e&&this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(e){0<(e=parseInt(e))&&this.$tabSize!==e&&(this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=e,this._signal("changeTabSize"))},initialValue:4,handlesSet:!0},navigateWithinSoftTabs:{initialValue:!1},foldStyle:{set:function(e){this.setFoldStyle(e)},handlesSet:!0},overwrite:{set:function(e){this._signal("changeOverwrite")},initialValue:!1},newLineMode:{set:function(e){this.doc.setNewLineMode(e)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(e){this.setMode(e)},get:function(){return this.$modeId},handlesSet:!0}}),t.EditSession=o}),define("ace/search",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(e,t,i){"use strict";function o(){this.$options={}}var b=e("./lib/lang"),n=e("./lib/oop"),y=e("./range").Range;(function(){this.set=function(e){return n.mixin(this.$options,e),this},this.getOptions=function(){return b.copyObject(this.$options)},this.setOptions=function(e){this.$options=e},this.find=function(e){var n=this.$options,e=this.$matchIterator(e,n);if(!e)return!1;var s=null;return e.forEach(function(e,t,i,o){return s=new y(e,t,i,o),!(t==o&&n.start&&n.start.start&&0!=n.skipCurrent&&s.isEqual(n.start))||(s=null,!1)}),s},this.findAll=function(e){var t=this.$options;if(!t.needle)return[];this.$assembleRegExp(t);var i=t.range,o=i?e.getLines(i.start.row,i.end.row):e.doc.getAllLines(),n=[],s=t.re;if(t.$isMultiLine){var a,r=s.length,l=o.length-r;e:for(var c=s.offset||0;c<=l;c++){for(var d=0;d<r;d++)if(-1==o[c+d].search(s[d]))continue e;var h=o[c],u=o[c+r-1],h=h.length-h.match(s[0])[0].length,u=u.match(s[r-1])[0].length;a&&a.end.row===c&&a.end.column>h||(n.push(a=new y(c,h,c+r-1,u)),2<r&&(c=c+r-2))}}else for(var p=0;p<o.length;p++)for(var m=b.getMatchOffsets(o[p],s),d=0;d<m.length;d++){var f=m[d];n.push(new y(p,f.offset,p,f.offset+f.length))}if(i){for(var g=i.start.column,_=i.start.column,p=0,d=n.length-1;p<d&&n[p].start.column<g&&n[p].start.row==i.start.row;)p++;for(;p<d&&n[d].end.column>_&&n[d].end.row==i.end.row;)d--;for(n=n.slice(p,d+1),p=0,d=n.length;p<d;p++)n[p].start.row+=i.start.row,n[p].end.row+=i.start.row}return n},this.replace=function(e,t){var i=this.$options,o=this.$assembleRegExp(i);if(i.$isMultiLine)return t;if(o){var n=o.exec(e);if(!n||n[0].length!=e.length)return null;if(t=e.replace(o,t),i.preserveCase){t=t.split("");for(var s=Math.min(e.length,e.length);s--;){var a=e[s];a&&a.toLowerCase()!=a?t[s]=t[s].toUpperCase():t[s]=t[s].toLowerCase()}t=t.join("")}return t}},this.$assembleRegExp=function(e,t){if(e.needle instanceof RegExp)return e.re=e.needle;var i,o=e.needle;if(!e.needle)return e.re=!1;function n(e){return/\w/.test(e)||i.regExp?"\\b":""}e.regExp||(o=b.escapeRegExp(o)),e.wholeWord&&(i=e,o=n((s=o)[0])+s+n(s[s.length-1]));var s=e.caseSensitive?"gm":"gmi";if(e.$isMultiLine=!t&&/[\n\r]/.test(o),e.$isMultiLine)return e.re=this.$assembleMultilineRegExp(o,s);try{var a=new RegExp(o,s)}catch(e){a=!1}return e.re=a},this.$assembleMultilineRegExp=function(e,t){for(var i=e.replace(/\r\n|\r|\n/g,"$\n^").split("\n"),o=[],n=0;n<i.length;n++)try{o.push(new RegExp(i[n],t))}catch(e){return!1}return o},this.$matchIterator=function(d,i){var h=this.$assembleRegExp(i);if(!h)return!1;var r,o,l=1==i.backwards,e=0!=i.skipCurrent,t=i.range,n=i.start,s=((n=n||(t?t[l?"end":"start"]:d.selection.getRange())).start&&(n=n[e!=l?"end":"start"]),t?t.start.row:0),a=t?t.end.row:d.getLength()-1;return o=i.$isMultiLine?(r=h.length,function(e,t,i){var o=l?e-r+1:e;if(!(o<0||o+r>d.getLength())){var n=d.getLine(o),e=n.search(h[0]);if(!(!l&&e<t||-1===e)){for(var s=1;s<r;s++)if(-1==(n=d.getLine(o+s)).search(h[s]))return;var a=n.match(h[r-1])[0].length;if(!(l&&t<a))return!!i(o,e,o+r-1,a)||void 0}}}):l?function(e,t,i){var o,n=d.getLine(e),s=[];for(h.lastIndex=0;o=h.exec(n);){var a=o[0].length,r=o.index;if(!a){if(r>=n.length)break;h.lastIndex=r+=1}if(o.index+a>t)break;s.push(o.index,a)}for(var l=s.length-1;0<=l;l-=2){var c=s[l-1];if(i(e,c,e,c+(a=s[l])))return!0}}:function(e,t,i){var o=d.getLine(e);for(h.lastIndex=t;n=h.exec(o);){var n,s=n[0].length;if(i(e,n=n.index,e,n+s))return!0;if(!s&&(h.lastIndex=n+=1,n>=o.length))return!1}},{forEach:l?function(e){var t=n.row;if(!o(t,n.column,e)){for(t--;s<=t;t--)if(o(t,Number.MAX_VALUE,e))return;if(0!=i.wrap)for(t=a,s=n.row;s<=t;t--)if(o(t,Number.MAX_VALUE,e))return}}:function(e){var t=n.row;if(!o(t,n.column,e)){for(t+=1;t<=a;t++)if(o(t,0,e))return;if(0!=i.wrap)for(t=s,a=n.row;t<=a;t++)if(o(t,0,e))return}}}}}).call(o.prototype),t.Search=o}),define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(e,t,i){"use strict";function o(e,t){this.platform=t||(s.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={},this.addCommands(e),this.$singleCommand=!0}function n(e,t){o.call(this,e,t),this.$singleCommand=!1}var r=e("../lib/keys"),s=e("../lib/useragent"),l=r.KEY_MODS;n.prototype=o.prototype,function(){function a(e){return"object"==typeof e&&e.bindKey&&e.bindKey.position||(e.isDefault?-100:0)}this.addCommand=function(e){this.commands[e.name]&&this.removeCommand(e),(this.commands[e.name]=e).bindKey&&this._buildKeyHash(e)},this.removeCommand=function(e,t){var i,o=e&&("string"==typeof e?e:e.name),n=(e=this.commands[o],t||delete this.commands[o],this.commandKeyBinding);for(i in n){var s,a=n[i];a==e?delete n[i]:Array.isArray(a)&&-1!=(s=a.indexOf(e))&&(a.splice(s,1),1==a.length&&(n[i]=a[0]))}},this.bindKey=function(e,o,n){if("object"==typeof e&&e&&(null==n&&(n=e.position),e=e[this.platform]),e)return"function"==typeof o?this.addCommand({exec:o,bindKey:e,name:o.name||e}):void e.split("|").forEach(function(e){var t="",i=(-1!=e.indexOf(" ")&&(e=(i=e.split(/\s+/)).pop(),i.forEach(function(e){e=this.parseKeys(e),e=l[e.hashId]+e.key;t+=(t?" ":"")+e,this._addCommandToBinding(t,"chainKeys")},this),t+=" "),this.parseKeys(e)),e=l[i.hashId]+i.key;this._addCommandToBinding(t+e,o,n)},this)},this._addCommandToBinding=function(e,t,i){var o=this.commandKeyBinding;if(t)if(!o[e]||this.$singleCommand)o[e]=t;else{Array.isArray(o[e])?-1!=(s=o[e].indexOf(t))&&o[e].splice(s,1):o[e]=[o[e]],"number"!=typeof i&&(i=a(t));for(var n=o[e],s=0;s<n.length;s++)if(i<a(n[s]))break;n.splice(s,0,t)}else delete o[e]},this.addCommands=function(i){i&&Object.keys(i).forEach(function(e){var t=i[e];if(t){if("string"==typeof t)return this.bindKey(t,e);"object"==typeof(t="function"==typeof t?{exec:t}:t)&&(t.name||(t.name=e),this.addCommand(t))}},this)},this.removeCommands=function(t){Object.keys(t).forEach(function(e){this.removeCommand(t[e])},this)},this.bindKeys=function(t){Object.keys(t).forEach(function(e){this.bindKey(e,t[e])},this)},this._buildKeyHash=function(e){this.bindKey(e.bindKey,e)},this.parseKeys=function(e){var t=e.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(e){return e}),i=t.pop(),o=r[i];if(r.FUNCTION_KEYS[o])i=r.FUNCTION_KEYS[o].toLowerCase();else{if(!t.length)return{key:i,hashId:-1};if(1==t.length&&"shift"==t[0])return{key:i.toUpperCase(),hashId:-1}}for(var n=0,s=t.length;s--;){var a=r.KEY_MODS[t[s]];if(null==a)return"undefined"!=typeof console&&console.error("invalid modifier "+t[s]+" in "+e),!1;n|=a}return{key:i,hashId:n}},this.findKeyCommand=function(e,t){e=l[e]+t;return this.commandKeyBinding[e]},this.handleKeyboard=function(e,t,i,o){var n,s;if(!(o<0))return n=l[t]+i,s=this.commandKeyBinding[n],e.$keyChain&&(e.$keyChain+=" "+n,s=this.commandKeyBinding[e.$keyChain]||s),!s||"chainKeys"!=s&&"chainKeys"!=s[s.length-1]?(e.$keyChain&&(t&&4!=t||1!=i.length?(-1==t||0<o)&&(e.$keyChain=""):e.$keyChain=e.$keyChain.slice(0,-n.length-1)),{command:s}):(e.$keyChain=e.$keyChain||n,{command:"null"})},this.getStatusText=function(e,t){return t.$keyChain||""}}.call(o.prototype),t.HashHandler=o,t.MultiHashHandler=n}),define("ace/commands/command_manager",["require","exports","module","ace/lib/oop","ace/keyboard/hash_handler","ace/lib/event_emitter"],function(e,t,i){"use strict";function o(e,t){s.call(this,t,e),this.byName=this.commands,this.setDefaultHandler("exec",function(e){return e.args?e.command.exec(e.editor,e.args,e.event,!1):e.command.exec(e.editor,{},e.event,!0)})}var n=e("../lib/oop"),s=e("../keyboard/hash_handler").MultiHashHandler,a=e("../lib/event_emitter").EventEmitter;n.inherits(o,s),function(){n.implement(this,a),this.exec=function(e,t,i){if(Array.isArray(e)){for(var o=e.length;o--;)if(this.exec(e[o],t,i))return!0;return!1}if(!(e="string"==typeof e?this.commands[e]:e))return!1;if(t&&t.$readOnly&&!e.readOnly)return!1;if(0!=this.$checkCommandState&&e.isAvailable&&!e.isAvailable(t))return!1;var n={editor:t,command:e,args:i};return n.returnValue=this._emit("exec",n),this._signal("afterExec",n),!1!==n.returnValue},this.toggleRecording=function(e){if(!this.$inReplay)return e&&e._emit("changeStatus"),this.recording?(this.macro.pop(),this.off("exec",this.$addCommandToMacro),this.macro.length||(this.macro=this.oldMacro),this.recording=!1):(this.$addCommandToMacro||(this.$addCommandToMacro=function(e){this.macro.push([e.command,e.args])}.bind(this)),this.oldMacro=this.macro,this.macro=[],this.on("exec",this.$addCommandToMacro),this.recording=!0)},this.replay=function(t){if(!this.$inReplay&&this.macro){if(this.recording)return this.toggleRecording(t);try{this.$inReplay=!0,this.macro.forEach(function(e){"string"==typeof e?this.exec(e,t):this.exec(e[0],t,e[1])},this)}finally{this.$inReplay=!1}}},this.trimMacro=function(e){return e.map(function(e){return"string"!=typeof e[0]&&(e[0]=e[0].name),e=e[1]?e:e[0]})}}.call(o.prototype),t.CommandManager=o}),define("ace/commands/default_commands",["require","exports","module","ace/lib/lang","ace/config","ace/range"],function(e,t,i){"use strict";function o(e,t){return{win:e,mac:t}}var l=e("../lib/lang"),n=e("../config"),c=e("../range").Range;t.commands=[{name:"showSettingsMenu",description:"Show settings menu",bindKey:o("Ctrl-,","Command-,"),exec:function(t){n.loadModule("ace/ext/settings_menu",function(e){e.init(t),t.showSettingsMenu()})},readOnly:!0},{name:"goToNextError",description:"Go to next error",bindKey:o("Alt-E","F4"),exec:function(t){n.loadModule("./ext/error_marker",function(e){e.showErrorMarker(t,1)})},scrollIntoView:"animate",readOnly:!0},{name:"goToPreviousError",description:"Go to previous error",bindKey:o("Alt-Shift-E","Shift-F4"),exec:function(t){n.loadModule("./ext/error_marker",function(e){e.showErrorMarker(t,-1)})},scrollIntoView:"animate",readOnly:!0},{name:"selectall",description:"Select all",bindKey:o("Ctrl-A","Command-A"),exec:function(e){e.selectAll()},readOnly:!0},{name:"centerselection",description:"Center selection",bindKey:o(null,"Ctrl-L"),exec:function(e){e.centerSelection()},readOnly:!0},{name:"gotoline",description:"Go to line...",bindKey:o("Ctrl-L","Command-L"),exec:function(e,t){"number"!=typeof t||isNaN(t)||e.gotoLine(t),e.prompt({$type:"gotoLine"})},readOnly:!0},{name:"fold",bindKey:o("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(e){e.session.toggleFold(!1)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"unfold",bindKey:o("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(e){e.session.toggleFold(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleFoldWidget",description:"Toggle fold widget",bindKey:o("F2","F2"),exec:function(e){e.session.toggleFoldWidget()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleParentFoldWidget",description:"Toggle parent fold widget",bindKey:o("Alt-F2","Alt-F2"),exec:function(e){e.session.toggleFoldWidget(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"foldall",description:"Fold all",bindKey:o(null,"Ctrl-Command-Option-0"),exec:function(e){e.session.foldAll()},scrollIntoView:"center",readOnly:!0},{name:"foldAllComments",description:"Fold all comments",bindKey:o(null,"Ctrl-Command-Option-0"),exec:function(e){e.session.foldAllComments()},scrollIntoView:"center",readOnly:!0},{name:"foldOther",description:"Fold other",bindKey:o("Alt-0","Command-Option-0"),exec:function(e){e.session.foldAll(),e.session.unfold(e.selection.getAllRanges())},scrollIntoView:"center",readOnly:!0},{name:"unfoldall",description:"Unfold all",bindKey:o("Alt-Shift-0","Command-Option-Shift-0"),exec:function(e){e.session.unfold()},scrollIntoView:"center",readOnly:!0},{name:"findnext",description:"Find next",bindKey:o("Ctrl-K","Command-G"),exec:function(e){e.findNext()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"findprevious",description:"Find previous",bindKey:o("Ctrl-Shift-K","Command-Shift-G"),exec:function(e){e.findPrevious()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"selectOrFindNext",description:"Select or find next",bindKey:o("Alt-K","Ctrl-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findNext()},readOnly:!0},{name:"selectOrFindPrevious",description:"Select or find previous",bindKey:o("Alt-Shift-K","Ctrl-Shift-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findPrevious()},readOnly:!0},{name:"find",description:"Find",bindKey:o("Ctrl-F","Command-F"),exec:function(t){n.loadModule("ace/ext/searchbox",function(e){e.Search(t)})},readOnly:!0},{name:"overwrite",description:"Overwrite",bindKey:"Insert",exec:function(e){e.toggleOverwrite()},readOnly:!0},{name:"selecttostart",description:"Select to start",bindKey:o("Ctrl-Shift-Home","Command-Shift-Home|Command-Shift-Up"),exec:function(e){e.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",description:"Go to start",bindKey:o("Ctrl-Home","Command-Home|Command-Up"),exec:function(e){e.navigateFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",description:"Select up",bindKey:o("Shift-Up","Shift-Up|Ctrl-Shift-P"),exec:function(e){e.getSelection().selectUp()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golineup",description:"Go line up",bindKey:o("Up","Up|Ctrl-P"),exec:function(e,t){e.navigateUp(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttoend",description:"Select to end",bindKey:o("Ctrl-Shift-End","Command-Shift-End|Command-Shift-Down"),exec:function(e){e.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",description:"Go to end",bindKey:o("Ctrl-End","Command-End|Command-Down"),exec:function(e){e.navigateFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",description:"Select down",bindKey:o("Shift-Down","Shift-Down|Ctrl-Shift-N"),exec:function(e){e.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golinedown",description:"Go line down",bindKey:o("Down","Down|Ctrl-N"),exec:function(e,t){e.navigateDown(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordleft",description:"Select word left",bindKey:o("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(e){e.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordleft",description:"Go to word left",bindKey:o("Ctrl-Left","Option-Left"),exec:function(e){e.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolinestart",description:"Select to line start",bindKey:o("Alt-Shift-Left","Command-Shift-Left|Ctrl-Shift-A"),exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolinestart",description:"Go to line start",bindKey:o("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(e){e.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectleft",description:"Select left",bindKey:o("Shift-Left","Shift-Left|Ctrl-Shift-B"),exec:function(e){e.getSelection().selectLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoleft",description:"Go to left",bindKey:o("Left","Left|Ctrl-B"),exec:function(e,t){e.navigateLeft(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordright",description:"Select word right",bindKey:o("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(e){e.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordright",description:"Go to word right",bindKey:o("Ctrl-Right","Option-Right"),exec:function(e){e.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolineend",description:"Select to line end",bindKey:o("Alt-Shift-Right","Command-Shift-Right|Shift-End|Ctrl-Shift-E"),exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolineend",description:"Go to line end",bindKey:o("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(e){e.navigateLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectright",description:"Select right",bindKey:o("Shift-Right","Shift-Right"),exec:function(e){e.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoright",description:"Go to right",bindKey:o("Right","Right|Ctrl-F"),exec:function(e,t){e.navigateRight(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectpagedown",description:"Select page down",bindKey:"Shift-PageDown",exec:function(e){e.selectPageDown()},readOnly:!0},{name:"pagedown",description:"Page down",bindKey:o(null,"Option-PageDown"),exec:function(e){e.scrollPageDown()},readOnly:!0},{name:"gotopagedown",description:"Go to page down",bindKey:o("PageDown","PageDown|Ctrl-V"),exec:function(e){e.gotoPageDown()},readOnly:!0},{name:"selectpageup",description:"Select page up",bindKey:"Shift-PageUp",exec:function(e){e.selectPageUp()},readOnly:!0},{name:"pageup",description:"Page up",bindKey:o(null,"Option-PageUp"),exec:function(e){e.scrollPageUp()},readOnly:!0},{name:"gotopageup",description:"Go to page up",bindKey:"PageUp",exec:function(e){e.gotoPageUp()},readOnly:!0},{name:"scrollup",description:"Scroll up",bindKey:o("Ctrl-Up",null),exec:function(e){e.renderer.scrollBy(0,-2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"scrolldown",description:"Scroll down",bindKey:o("Ctrl-Down",null),exec:function(e){e.renderer.scrollBy(0,2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"selectlinestart",description:"Select line start",bindKey:"Shift-Home",exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectlineend",description:"Select line end",bindKey:"Shift-End",exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"togglerecording",description:"Toggle recording",bindKey:o("Ctrl-Alt-E","Command-Option-E"),exec:function(e){e.commands.toggleRecording(e)},readOnly:!0},{name:"replaymacro",description:"Replay macro",bindKey:o("Ctrl-Shift-E","Command-Shift-E"),exec:function(e){e.commands.replay(e)},readOnly:!0},{name:"jumptomatching",description:"Jump to matching",bindKey:o("Ctrl-\\|Ctrl-P","Command-\\"),exec:function(e){e.jumpToMatching()},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"selecttomatching",description:"Select to matching",bindKey:o("Ctrl-Shift-\\|Ctrl-Shift-P","Command-Shift-\\"),exec:function(e){e.jumpToMatching(!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"expandToMatching",description:"Expand to matching",bindKey:o("Ctrl-Shift-M","Ctrl-Shift-M"),exec:function(e){e.jumpToMatching(!0,!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"passKeysToBrowser",description:"Pass keys to browser",bindKey:o(null,null),exec:function(){},passEvent:!0,readOnly:!0},{name:"copy",description:"Copy",exec:function(e){},readOnly:!0},{name:"cut",description:"Cut",exec:function(e){var t=e.$copyWithEmptySelection&&e.selection.isEmpty()?e.selection.getLineRange():e.selection.getRange();e._emit("cut",t),t.isEmpty()||e.session.remove(t),e.clearSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"paste",description:"Paste",exec:function(e,t){e.$handlePaste(t)},scrollIntoView:"cursor"},{name:"removeline",description:"Remove line",bindKey:o("Ctrl-D","Command-D"),exec:function(e){e.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",description:"Duplicate selection",bindKey:o("Ctrl-Shift-D","Command-Shift-D"),exec:function(e){e.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",description:"Sort lines",bindKey:o("Ctrl-Alt-S","Command-Alt-S"),exec:function(e){e.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",description:"Toggle comment",bindKey:o("Ctrl-/","Command-/"),exec:function(e){e.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"toggleBlockComment",description:"Toggle block comment",bindKey:o("Ctrl-Shift-/","Command-Shift-/"),exec:function(e){e.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",description:"Modify number up",bindKey:o("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(e){e.modifyNumber(1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"modifyNumberDown",description:"Modify number down",bindKey:o("Ctrl-Shift-Down","Alt-Shift-Down"),exec:function(e){e.modifyNumber(-1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"replace",description:"Replace",bindKey:o("Ctrl-H","Command-Option-F"),exec:function(t){n.loadModule("ace/ext/searchbox",function(e){e.Search(t,!0)})}},{name:"undo",description:"Undo",bindKey:o("Ctrl-Z","Command-Z"),exec:function(e){e.undo()}},{name:"redo",description:"Redo",bindKey:o("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(e){e.redo()}},{name:"copylinesup",description:"Copy lines up",bindKey:o("Alt-Shift-Up","Command-Option-Up"),exec:function(e){e.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",description:"Move lines up",bindKey:o("Alt-Up","Option-Up"),exec:function(e){e.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",description:"Copy lines down",bindKey:o("Alt-Shift-Down","Command-Option-Down"),exec:function(e){e.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",description:"Move lines down",bindKey:o("Alt-Down","Option-Down"),exec:function(e){e.moveLinesDown()},scrollIntoView:"cursor"},{name:"del",description:"Delete",bindKey:o("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(e){e.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",description:"Backspace",bindKey:o("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(e){e.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",description:"Cut or delete",bindKey:o("Shift-Delete",null),exec:function(e){if(!e.selection.isEmpty())return!1;e.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",description:"Remove to line start",bindKey:o("Alt-Backspace","Command-Backspace"),exec:function(e){e.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",description:"Remove to line end",bindKey:o("Alt-Delete","Ctrl-K|Command-Delete"),exec:function(e){e.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestarthard",description:"Remove to line start hard",bindKey:o("Ctrl-Shift-Backspace",null),exec:function(e){var t=e.selection.getRange();t.start.column=0,e.session.remove(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineendhard",description:"Remove to line end hard",bindKey:o("Ctrl-Shift-Delete",null),exec:function(e){var t=e.selection.getRange();t.end.column=Number.MAX_VALUE,e.session.remove(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",description:"Remove word left",bindKey:o("Ctrl-Backspace","Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(e){e.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",description:"Remove word right",bindKey:o("Ctrl-Delete","Alt-Delete"),exec:function(e){e.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",description:"Outdent",bindKey:o("Shift-Tab","Shift-Tab"),exec:function(e){e.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",description:"Indent",bindKey:o("Tab","Tab"),exec:function(e){e.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",description:"Block outdent",bindKey:o("Ctrl-[","Ctrl-["),exec:function(e){e.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",description:"Block indent",bindKey:o("Ctrl-]","Ctrl-]"),exec:function(e){e.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",description:"Insert string",exec:function(e,t){e.insert(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",description:"Insert text",exec:function(e,t){e.insert(l.stringRepeat(t.text||"",t.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",description:"Split line",bindKey:o(null,"Ctrl-O"),exec:function(e){e.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",description:"Transpose letters",bindKey:o("Alt-Shift-X","Ctrl-T"),exec:function(e){e.transposeLetters()},multiSelectAction:function(e){e.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",description:"To uppercase",bindKey:o("Ctrl-U","Ctrl-U"),exec:function(e){e.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",description:"To lowercase",bindKey:o("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(e){e.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"autoindent",description:"Auto Indent",bindKey:o(null,null),exec:function(e){e.autoIndent()},multiSelectAction:"forEachLine",scrollIntoView:"animate"},{name:"expandtoline",description:"Expand to line",bindKey:o("Ctrl-Shift-L","Command-Shift-L"),exec:function(e){var t=e.selection.getRange();t.start.column=t.end.column=0,t.end.row++,e.selection.setRange(t,!1)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"joinlines",description:"Join lines",bindKey:o(null,null),exec:function(e){for(var t=e.selection.isBackwards(),i=t?e.selection.getSelectionLead():e.selection.getSelectionAnchor(),o=t?e.selection.getSelectionAnchor():e.selection.getSelectionLead(),t=e.session.doc.getLine(i.row).length,n=e.session.doc.getTextRange(e.selection.getRange()).replace(/\n\s*/," ").length,s=e.session.doc.getLine(i.row),a=i.row+1;a<=o.row+1;a++){var r=l.stringTrimLeft(l.stringTrimRight(e.session.doc.getLine(a)));s+=r=0!==r.length?" "+r:r}o.row+1<e.session.doc.getLength()-1&&(s+=e.session.doc.getNewLineCharacter()),e.clearSelection(),e.session.doc.replace(new c(i.row,0,o.row+2,0),s),0<n?(e.selection.moveCursorTo(i.row,i.column),e.selection.selectTo(i.row,i.column+n)):(t=e.session.doc.getLine(i.row).length>t?t+1:t,e.selection.moveCursorTo(i.row,t))},multiSelectAction:"forEach",readOnly:!0},{name:"invertSelection",description:"Invert selection",bindKey:o(null,null),exec:function(e){var t=e.session.doc.getLength()-1,i=e.session.doc.getLine(t).length,o=e.selection.rangeList.ranges,n=[];o.length<1&&(o=[e.selection.getRange()]);for(var s=0;s<o.length;s++)s!=o.length-1||o[s].end.row===t&&o[s].end.column===i||n.push(new c(o[s].end.row,o[s].end.column,t,i)),0===s?0===o[s].start.row&&0===o[s].start.column||n.push(new c(0,0,o[s].start.row,o[s].start.column)):n.push(new c(o[s-1].end.row,o[s-1].end.column,o[s].start.row,o[s].start.column));e.exitMultiSelectMode(),e.clearSelection();for(s=0;s<n.length;s++)e.selection.addRange(n[s],!1)},readOnly:!0,scrollIntoView:"none"},{name:"addLineAfter",description:"Add new line after the current line",exec:function(e){e.selection.clearSelection(),e.navigateLineEnd(),e.insert("\n")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"addLineBefore",description:"Add new line before the current line",exec:function(e){e.selection.clearSelection();var t=e.getCursorPosition();e.selection.moveTo(t.row-1,Number.MAX_VALUE),e.insert("\n"),0===t.row&&e.navigateUp()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"openCommandPallete",description:"Open command palette",bindKey:o("F1","F1"),exec:function(e){e.prompt({$type:"commands"})},readOnly:!0},{name:"modeSelect",description:"Change language mode...",bindKey:o(null,null),exec:function(e){e.prompt({$type:"modes"})},readOnly:!0}];for(var s=1;s<9;s++)t.commands.push({name:"foldToLevel"+s,description:"Fold To Level "+s,level:s,exec:function(e){e.session.foldToLevel(this.level)},scrollIntoView:"center",readOnly:!0})}),define("ace/editor",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/keyboard/textinput","ace/mouse/mouse_handler","ace/mouse/fold_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/range","ace/lib/event_emitter","ace/commands/command_manager","ace/commands/default_commands","ace/config","ace/token_iterator","ace/clipboard"],function(e,t,i){"use strict";function n(e,t,i){this.$toDestroy=[];var o=e.getContainerElement();this.container=o,this.renderer=e,this.id="editor"+ ++n.$uid,this.commands=new m(a.isMac?"mac":"win",_),"object"==typeof document&&(this.textInput=new r(e.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.$mouseHandler=new l(this),new c(this)),this.keyBinding=new d(this),this.$search=(new u).set({wrap:!0}),this.$historyTracker=this.$historyTracker.bind(this),this.commands.on("exec",this.$historyTracker),this.$initOperationListeners(),this._$emitInputEvent=f.delayedCall(function(){this._signal("input",{}),this.session&&!this.session.destroyed&&this.session.bgTokenizer.scheduleStart()}.bind(this)),this.on("change",function(e,t){t._$emitInputEvent.schedule(31)}),this.setSession(t||i&&i.session||new h("")),b.resetOptions(this),i&&this.setOptions(i),b._signal("editor",this)}var s=e("./lib/oop"),o=e("./lib/dom"),f=e("./lib/lang"),a=e("./lib/useragent"),r=e("./keyboard/textinput").TextInput,l=e("./mouse/mouse_handler").MouseHandler,c=e("./mouse/fold_handler").FoldHandler,d=e("./keyboard/keybinding").KeyBinding,h=e("./edit_session").EditSession,u=e("./search").Search,g=e("./range").Range,p=e("./lib/event_emitter").EventEmitter,m=e("./commands/command_manager").CommandManager,_=e("./commands/default_commands").commands,b=e("./config"),y=e("./token_iterator").TokenIterator,v=e("./clipboard"),k=(n.$uid=0,function(){s.implement(this,p),this.$initOperationListeners=function(){this.commands.on("exec",this.startOperation.bind(this),!0),this.commands.on("afterExec",this.endOperation.bind(this),!0),this.$opResetTimer=f.delayedCall(this.endOperation.bind(this,!0)),this.on("change",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.docChanged=!0}.bind(this),!0),this.on("changeSelection",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.selectionChanged=!0}.bind(this),!0)},this.curOp=null,this.prevOp={},this.startOperation=function(e){if(this.curOp){if(!e||this.curOp.command)return;this.prevOp=this.curOp}e||(this.previousCommand=null,e={}),this.$opResetTimer.schedule(),this.curOp=this.session.curOp={command:e.command||{},args:e.args,scrollTop:this.renderer.scrollTop},this.curOp.selectionBefore=this.selection.toJSON()},this.endOperation=function(e){if(this.curOp&&this.session){if(e&&!1===e.returnValue||!this.session)return this.curOp=null;if((1!=e||!this.curOp.command||"mouse"!=this.curOp.command.name)&&(this._signal("beforeEndOperation"),this.curOp)){var e=this.curOp.command,t=e&&e.scrollIntoView;if(t){switch(t){case"center-animate":t="animate";case"center":this.renderer.scrollCursorIntoView(null,.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var i=this.selection.getRange(),o=this.renderer.layerConfig;(i.start.row>=o.lastRow||i.end.row<=o.firstRow)&&this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead)}"animate"==t&&this.renderer.animateScrolling(this.curOp.scrollTop)}e=this.selection.toJSON();this.curOp.selectionAfter=e,this.$lastSel=this.selection.toJSON(),this.session.getUndoManager().addSelection(e),this.prevOp=this.curOp,this.curOp=null}}},this.$mergeableCommands=["backspace","del","insertstring"],this.$historyTracker=function(e){var t,i,o,n;this.$mergeUndoDeltas&&(t=this.prevOp,i=this.$mergeableCommands,o=t.command&&e.command.name==t.command.name,"insertstring"==e.command.name?(n=e.args,void 0===this.mergeNextCommand&&(this.mergeNextCommand=!0),o=o&&this.mergeNextCommand&&(!/\s/.test(n)||/\s/.test(t.args)),this.mergeNextCommand=!0):o=o&&-1!==i.indexOf(e.command.name),(o="always"!=this.$mergeUndoDeltas&&2e3<Date.now()-this.sequenceStartTime?!1:o)?this.session.mergeUndoDeltas=!0:-1!==i.indexOf(e.command.name)&&(this.sequenceStartTime=Date.now()))},this.setKeyboardHandler=function(t,i){var o;t&&"string"==typeof t&&"ace"!=t?(this.$keybindingId=t,o=this,b.loadModule(["keybinding",t],function(e){o.$keybindingId==t&&o.keyBinding.setKeyboardHandler(e&&e.handler),i&&i()})):(this.$keybindingId=null,this.keyBinding.setKeyboardHandler(t),i&&i())},this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},this.setSession=function(e){var t,i;this.session!=e&&(this.curOp&&this.endOperation(),this.curOp={},(t=this.session)&&(this.session.off("change",this.$onDocumentChange),this.session.off("changeMode",this.$onChangeMode),this.session.off("tokenizerUpdate",this.$onTokenizerUpdate),this.session.off("changeTabSize",this.$onChangeTabSize),this.session.off("changeWrapLimit",this.$onChangeWrapLimit),this.session.off("changeWrapMode",this.$onChangeWrapMode),this.session.off("changeFold",this.$onChangeFold),this.session.off("changeFrontMarker",this.$onChangeFrontMarker),this.session.off("changeBackMarker",this.$onChangeBackMarker),this.session.off("changeBreakpoint",this.$onChangeBreakpoint),this.session.off("changeAnnotation",this.$onChangeAnnotation),this.session.off("changeOverwrite",this.$onCursorChange),this.session.off("changeScrollTop",this.$onScrollTopChange),this.session.off("changeScrollLeft",this.$onScrollLeftChange),(i=this.session.getSelection()).off("changeCursor",this.$onCursorChange),i.off("changeSelection",this.$onSelectionChange)),(this.session=e)?(this.$onDocumentChange=this.onDocumentChange.bind(this),e.on("change",this.$onDocumentChange),this.renderer.setSession(e),this.$onChangeMode=this.onChangeMode.bind(this),e.on("changeMode",this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),e.on("tokenizerUpdate",this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),e.on("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),e.on("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),e.on("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),e.on("changeFold",this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.on("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.on("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.on("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.on("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.on("changeOverwrite",this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.on("changeScrollTop",this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.on("changeScrollLeft",this.$onScrollLeftChange),this.selection=e.getSelection(),this.selection.on("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on("changeSelection",this.$onSelectionChange),this.onChangeMode(),this.onCursorChange(),this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit(),this.renderer.updateFull()):(this.selection=null,this.renderer.setSession(e)),this._signal("changeSession",{session:e,oldSession:t}),this.curOp=null,t&&t._signal("changeEditor",{oldEditor:this}),e&&e._signal("changeEditor",{editor:this}),e&&!e.destroyed&&e.bgTokenizer.scheduleStart())},this.getSession=function(){return this.session},this.setValue=function(e,t){return this.session.doc.setValue(e),t?1==t?this.navigateFileEnd():-1==t&&this.navigateFileStart():this.selectAll(),e},this.getValue=function(){return this.session.getValue()},this.getSelection=function(){return this.selection},this.resize=function(e){this.renderer.onResize(e)},this.setTheme=function(e,t){this.renderer.setTheme(e,t)},this.getTheme=function(){return this.renderer.getTheme()},this.setStyle=function(e){this.renderer.setStyle(e)},this.unsetStyle=function(e){this.renderer.unsetStyle(e)},this.getFontSize=function(){return this.getOption("fontSize")||o.computedStyle(this.container).fontSize},this.setFontSize=function(e){this.setOption("fontSize",e)},this.$highlightBrackets=function(){var o;this.$highlightPending||((o=this).$highlightPending=!0,setTimeout(function(){o.$highlightPending=!1;var e,t,i=o.session;i&&!i.destroyed&&(i.$bracketHighlight&&(i.$bracketHighlight.markerIds.forEach(function(e){i.removeMarker(e)}),i.$bracketHighlight=null),(e=!(e=i.getMatchingBracketRanges(o.getCursorPosition()))&&i.$mode.getMatching?i.$mode.getMatching(o.session):e)&&(t="ace_bracket",Array.isArray(e)?1==e.length&&(t="ace_error_bracket"):e=[e],2==e.length&&(0==g.comparePoints(e[0].end,e[1].start)?e=[g.fromPoints(e[0].start,e[1].end)]:0==g.comparePoints(e[0].start,e[1].end)&&(e=[g.fromPoints(e[1].start,e[0].end)])),i.$bracketHighlight={ranges:e,markerIds:e.map(function(e){return i.addMarker(e,t,"text")})}),o.getHighlightIndentGuides()&&o.renderer.$textLayer.$highlightIndentGuide())},50))},this.$highlightTags=function(){var u;this.$highlightTagPending||((u=this).$highlightTagPending=!0,setTimeout(function(){u.$highlightTagPending=!1;var e=u.session;if(e&&!e.destroyed){var t=u.getCursorPosition(),i=new y(u.session,t.row,t.column),o=i.getCurrentToken();if(o&&/\b(?:tag-open|tag-name)/.test(o.type)){if(-1===o.type.indexOf("tag-open")||(o=i.stepForward())){var n,s=o.value,a=o.value,r=0,l=i.stepBackward();if("<"===l.value)for(;l=o,(o=i.stepForward())&&(-1!==o.type.indexOf("tag-name")?s===(a=o.value)&&("<"===l.value?r++:"</"===l.value&&r--):s===a&&"/>"===o.value&&r--),o&&0<=r;);else{do{if(o=l,l=i.stepBackward(),o)if(-1!==o.type.indexOf("tag-name"))s===o.value&&("<"===l.value?r++:"</"===l.value&&r--);else if("/>"===o.value){for(var c=0,d=l;d;){if(-1!==d.type.indexOf("tag-name")&&d.value===s){r--;break}if("<"===d.value)break;d=i.stepBackward(),c++}for(var h=0;h<c;h++)i.stepForward()}}while(l&&r<=0);i.stepForward()}o?(t=i.getCurrentTokenRow(),n=i.getCurrentTokenColumn(),t=new g(t,n,t,n+o.value.length),n=e.$backMarkers[e.$tagHighlight],e.$tagHighlight&&null!=n&&0!==t.compareRange(n.range)&&(e.removeMarker(e.$tagHighlight),e.$tagHighlight=null),e.$tagHighlight||(e.$tagHighlight=e.addMarker(t,"ace_bracket","text"))):(e.removeMarker(e.$tagHighlight),e.$tagHighlight=null)}}else e.removeMarker(e.$tagHighlight),e.$tagHighlight=null}},50))},this.focus=function(){this.textInput.focus()},this.isFocused=function(){return this.textInput.isFocused()},this.blur=function(){this.textInput.blur()},this.onFocus=function(e){this.$isFocused||(this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit("focus",e))},this.onBlur=function(e){this.$isFocused&&(this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._emit("blur",e))},this.$cursorChange=function(){this.renderer.updateCursor(),this.$highlightBrackets(),this.$highlightTags(),this.$updateHighlightActiveLine()},this.onDocumentChange=function(e){var t=this.session.$useWrapMode,i=e.start.row==e.end.row?e.end.row:1/0;this.renderer.updateLines(e.start.row,i,t),this._signal("change",e),this.$cursorChange()},this.onTokenizerUpdate=function(e){e=e.data;this.renderer.updateLines(e.first,e.last)},this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())},this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())},this.onCursorChange=function(){this.$cursorChange(),this._signal("changeSelection")},this.$updateHighlightActiveLine=function(){var e,t,i=this.getSession();this.$highlightActiveLine&&("line"==this.$selectionStyle&&this.selection.isMultiLine()||(e=this.getCursorPosition()),this.renderer.theme&&this.renderer.theme.$selectionColorConflict&&!this.selection.isEmpty()&&(e=!1),!this.renderer.$maxLines||1!==this.session.getLength()||1<this.renderer.$minLines||(e=!1)),i.$highlightLineMarker&&!e?(i.removeMarker(i.$highlightLineMarker.id),i.$highlightLineMarker=null):!i.$highlightLineMarker&&e?((t=new g(e.row,e.column,e.row,1/0)).id=i.addMarker(t,"ace_active-line","screenLine"),i.$highlightLineMarker=t):e&&(i.$highlightLineMarker.start.row=e.row,i.$highlightLineMarker.end.row=e.row,i.$highlightLineMarker.start.column=e.column,i._signal("changeBackMarker"))},this.onSelectionChange=function(e){var t,i,o=this.session,o=(o.$selectionMarker&&o.removeMarker(o.$selectionMarker),o.$selectionMarker=null,this.selection.isEmpty()?this.$updateHighlightActiveLine():(t=this.selection.getRange(),i=this.getSelectionStyle(),o.$selectionMarker=o.addMarker(t,"ace_selection",i)),this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp());this.session.highlight(o),this._signal("changeSelection")},this.$getSelectionHighLightRegexp=function(){var e=this.session,t=this.getSelectionRange();if(!t.isEmpty()&&!t.isMultiLine()){var i=t.start.column,o=t.end.column,e=e.getLine(t.start.row),t=e.substring(i,o);if(!(5e3<t.length)&&/[\w\d]/.test(t)){t=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:t}),e=e.substring(i-1,o+1);if(t.test(e))return t}}},this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()},this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},this.onChangeMode=function(e){this.renderer.updateText(),this._emit("changeMode",e)},this.onChangeWrapLimit=function(){this.renderer.updateFull()},this.onChangeWrapMode=function(){this.renderer.onResize(!0)},this.onChangeFold=function(){this.$updateHighlightActiveLine(),this.renderer.updateFull()},this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},this.getCopyText=function(){var e=this.getSelectedText(),t=this.session.doc.getNewLineCharacter(),i=!1;if(!e&&this.$copyWithEmptySelection)for(var i=!0,o=this.selection.getAllRanges(),n=0;n<o.length;n++){var s=o[n];n&&o[n-1].start.row==s.start.row||(e+=this.session.getLine(s.start.row)+t)}var a={text:e};return this._signal("copy",a),v.lineMode=!!i&&a.text,a.text},this.onCopy=function(){this.commands.exec("copy",this)},this.onCut=function(){this.commands.exec("cut",this)},this.onPaste=function(e,t){this.commands.exec("paste",this,{text:e,event:t})},this.$handlePaste=function(e){this._signal("paste",e="string"==typeof e?{text:e}:e);var t=e.text,e=t===v.lineMode,i=this.session;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)e?i.insert({row:this.selection.lead.row,column:0},t):this.insert(t);else if(e)this.selection.rangeList.ranges.forEach(function(e){i.insert({row:e.start.row,column:0},t)});else{var o=t.split(/\r\n|\r|\n/),n=this.selection.rangeList.ranges,e=!(2!=o.length||o[0]&&o[1]);if(o.length!=n.length||e)return this.commands.exec("insertstring",this,t);for(var s=n.length;s--;){var a=n[s];a.isEmpty()||i.remove(a),i.insert(a.start,o[s])}}},this.execCommand=function(e,t){return this.commands.exec(e,this,t)},this.insert=function(e,t){var i,o=this.session,n=o.getMode(),s=this.getCursorPosition(),a=(!this.getBehavioursEnabled()||t||(i=n.transformAction(o.getState(s.row),"insertion",this,o,e))&&(e===i.text||this.inVirtualSelectionMode||(this.session.mergeUndoDeltas=!1,this.mergeNextCommand=!1),e=i.text),"\t"==e&&(e=this.session.getTabString()),this.selection.isEmpty()?this.session.getOverwrite()&&-1==e.indexOf("\n")&&((a=new g.fromPoints(s,s)).end.column+=e.length,this.session.remove(a)):(a=this.getSelectionRange(),s=this.session.remove(a),this.clearSelection()),"\n"!=e&&"\r\n"!=e||(r=o.getLine(s.row),s.column>r.search(/\S|$/)&&(t=r.substr(s.column).search(/\S|$/),o.doc.removeInLine(s.row,s.column,s.column+t))),this.clearSelection(),s.column),t=o.getState(s.row),r=o.getLine(s.row),l=n.checkOutdent(t,r,e);o.insert(s,e),i&&i.selection&&(2==i.selection.length?this.selection.setSelectionRange(new g(s.row,a+i.selection[0],s.row,a+i.selection[1])):this.selection.setSelectionRange(new g(s.row+i.selection[0],i.selection[1],s.row+i.selection[2],i.selection[3]))),this.$enableAutoIndent&&(o.getDocument().isNewLine(e)&&(a=n.getNextLineIndent(t,r.slice(0,s.column),o.getTabString()),o.insert({row:s.row+1,column:0},a)),l&&n.autoOutdent(t,o,s.row))},this.autoIndent=function(){for(var e,t,i,o,n,s=this.session,a=s.getMode(),r=(i=this.selection.isEmpty()?(t=0,s.doc.getLength()-1):(t=(e=this.getSelectionRange()).start.row,e.end.row),""),l="",c=s.getTabString(),d=t;d<=i;d++)0<d&&(r=s.getState(d-1),o=s.getLine(d-1),l=a.getNextLineIndent(r,o,c)),o=s.getLine(d),l!==(n=a.$getIndent(o))&&(0<n.length&&(n=new g(d,0,d,n.length),s.remove(n)),0<l.length&&s.insert({row:d,column:0},l)),a.autoOutdent(r,s,d)},this.onTextInput=function(e,t){if(!t)return this.keyBinding.onTextInput(e);this.startOperation({command:{name:"insertstring"}});e=this.applyComposition.bind(this,e,t);this.selection.rangeCount?this.forEachSelection(e):e(),this.endOperation()},this.applyComposition=function(e,t){var i;(t.extendLeft||t.extendRight)&&((i=this.selection.getRange()).start.column-=t.extendLeft,i.end.column+=t.extendRight,i.start.column<0&&(i.start.row--,i.start.column+=this.session.getLine(i.start.row).length+1),this.selection.setRange(i),e||i.isEmpty()||this.remove()),!e&&this.selection.isEmpty()||this.insert(e,!0),(t.restoreStart||t.restoreEnd)&&((i=this.selection.getRange()).start.column-=t.restoreStart,i.end.column-=t.restoreEnd,this.selection.setRange(i))},this.onCommandKey=function(e,t,i){return this.keyBinding.onCommandKey(e,t,i)},this.setOverwrite=function(e){this.session.setOverwrite(e)},this.getOverwrite=function(){return this.session.getOverwrite()},this.toggleOverwrite=function(){this.session.toggleOverwrite()},this.setScrollSpeed=function(e){this.setOption("scrollSpeed",e)},this.getScrollSpeed=function(){return this.getOption("scrollSpeed")},this.setDragDelay=function(e){this.setOption("dragDelay",e)},this.getDragDelay=function(){return this.getOption("dragDelay")},this.setSelectionStyle=function(e){this.setOption("selectionStyle",e)},this.getSelectionStyle=function(){return this.getOption("selectionStyle")},this.setHighlightActiveLine=function(e){this.setOption("highlightActiveLine",e)},this.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.setHighlightSelectedWord=function(e){this.setOption("highlightSelectedWord",e)},this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},this.setAnimatedScroll=function(e){this.renderer.setAnimatedScroll(e)},this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()},this.setShowInvisibles=function(e){this.renderer.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},this.setDisplayIndentGuides=function(e){this.renderer.setDisplayIndentGuides(e)},this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()},this.setHighlightIndentGuides=function(e){this.renderer.setHighlightIndentGuides(e)},this.getHighlightIndentGuides=function(){return this.renderer.getHighlightIndentGuides()},this.setShowPrintMargin=function(e){this.renderer.setShowPrintMargin(e)},this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},this.setPrintMarginColumn=function(e){this.renderer.setPrintMarginColumn(e)},this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},this.setReadOnly=function(e){this.setOption("readOnly",e)},this.getReadOnly=function(){return this.getOption("readOnly")},this.setBehavioursEnabled=function(e){this.setOption("behavioursEnabled",e)},this.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")},this.setWrapBehavioursEnabled=function(e){this.setOption("wrapBehavioursEnabled",e)},this.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")},this.setShowFoldWidgets=function(e){this.setOption("showFoldWidgets",e)},this.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.remove=function(e){this.selection.isEmpty()&&("left"==e?this.selection.selectLeft():this.selection.selectRight());var t,i,o,e=this.getSelectionRange();this.getBehavioursEnabled()&&(i=(t=this.session).getState(e.start.row),i=t.getMode().transformAction(i,"deletion",this,t,e),0===e.end.column&&"\n"==(o=t.getTextRange(e))[o.length-1]&&(o=t.getLine(e.end.row),/^\s+$/.test(o)&&(e.end.column=o.length)),i&&(e=i)),this.session.remove(e),this.clearSelection()},this.removeWordRight=function(){this.selection.isEmpty()&&this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeWordLeft=function(){this.selection.isEmpty()&&this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineStart=function(){this.selection.isEmpty()&&this.selection.selectLineStart(),this.selection.isEmpty()&&this.selection.selectLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineEnd=function(){this.selection.isEmpty()&&this.selection.selectLineEnd();var e=this.getSelectionRange();e.start.column==e.end.column&&e.start.row==e.end.row&&(e.end.column=0,e.end.row++),this.session.remove(e),this.clearSelection()},this.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var e=this.getCursorPosition();this.insert("\n"),this.moveCursorToPosition(e)},this.transposeLetters=function(){var e,t,i,o;!this.selection.isEmpty()||0!==(t=(e=this.getCursorPosition()).column)&&(o=t<(o=this.session.getLine(e.row)).length?(i=o.charAt(t)+o.charAt(t-1),new g(e.row,t-1,e.row,t+1)):(i=o.charAt(t-1)+o.charAt(t-2),new g(e.row,t-2,e.row,t)),this.session.replace(o,i),this.session.selection.moveToPosition(o.end))},this.toLowerCase=function(){var e=this.getSelectionRange(),t=(this.selection.isEmpty()&&this.selection.selectWord(),this.getSelectionRange()),i=this.session.getTextRange(t);this.session.replace(t,i.toLowerCase()),this.selection.setSelectionRange(e)},this.toUpperCase=function(){var e=this.getSelectionRange(),t=(this.selection.isEmpty()&&this.selection.selectWord(),this.getSelectionRange()),i=this.session.getTextRange(t);this.session.replace(t,i.toUpperCase()),this.selection.setSelectionRange(e)},this.indent=function(){var e=this.session,t=this.getSelectionRange();if(!(t.start.row<t.end.row)){if(t.start.column<t.end.column){var i,o=e.getTextRange(t);if(!/^\s+$/.test(o))return i=this.$getSelectedRows(),void e.indentRows(i.first,i.last,"\t")}var n=e.getLine(t.start.row),o=t.start,s=e.getTabSize(),o=e.documentToScreenColumn(o.row,o.column);if(this.session.getUseSoftTabs())var a=s-o%s,r=f.stringRepeat(" ",a);else{for(a=o%s;" "==n[t.start.column-1]&&a;)t.start.column--,a--;this.selection.setSelectionRange(t),r="\t"}return this.insert(r)}i=this.$getSelectedRows(),e.indentRows(i.first,i.last,"\t")},this.blockIndent=function(){var e=this.$getSelectedRows();this.session.indentRows(e.first,e.last,"\t")},this.blockOutdent=function(){var e=this.session.getSelection();this.session.outdentRows(e.getRange())},this.sortLines=function(){for(var e=this.$getSelectedRows(),t=this.session,i=[],o=e.first;o<=e.last;o++)i.push(t.getLine(o));i.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0});for(var n=new g(0,0,0,0),o=e.first;o<=e.last;o++){var s=t.getLine(o);n.start.row=o,n.end.row=o,n.end.column=s.length,t.replace(n,i[o-e.first])}},this.toggleCommentLines=function(){var e=this.session.getState(this.getCursorPosition().row),t=this.$getSelectedRows();this.session.getMode().toggleCommentLines(e,this.session,t.first,t.last)},this.toggleBlockComment=function(){var e=this.getCursorPosition(),t=this.session.getState(e.row),i=this.getSelectionRange();this.session.getMode().toggleBlockComment(t,this.session,i,e)},this.getNumberAt=function(e,t){for(var i=/[\-]?[0-9]+(?:\.[0-9]+)?/g,o=(i.lastIndex=0,this.session.getLine(e));i.lastIndex<t;){var n=i.exec(o);if(n.index<=t&&n.index+n[0].length>=t)return{value:n[0],start:n.index,end:n.index+n[0].length}}return null},this.modifyNumber=function(e){var t,i,o,n=this.selection.getCursor().row,s=this.selection.getCursor().column,a=new g(n,s-1,n,s),a=this.session.getTextRange(a);!isNaN(parseFloat(a))&&isFinite(a)?(a=this.getNumberAt(n,s))&&(o=0<=a.value.indexOf(".")?a.start+a.value.indexOf(".")+1:a.end,t=a.start+a.value.length-o,i=parseFloat(a.value),i*=Math.pow(10,t),o!==a.end&&s<o?e*=Math.pow(10,a.end-s-1):e*=Math.pow(10,a.end-s),o=(i=(i+=e)/Math.pow(10,t)).toFixed(t),e=new g(n,a.start,n,a.end),this.session.replace(e,o),this.moveCursorTo(n,Math.max(a.start+1,s+o.length-a.value.length))):this.toggleWord()},this.$toggleWordPairs=[["first","last"],["true","false"],["yes","no"],["width","height"],["top","bottom"],["right","left"],["on","off"],["x","y"],["get","set"],["max","min"],["horizontal","vertical"],["show","hide"],["add","remove"],["up","down"],["before","after"],["even","odd"],["in","out"],["inside","outside"],["next","previous"],["increase","decrease"],["attach","detach"],["&&","||"],["==","!="]],this.toggleWord=function(){for(var i,o=this.selection.getCursor().row,e=this.selection.getCursor().column,n=(this.selection.selectWord(),this.getSelectedText()),s=this.selection.getWordRange().start.column,t=n.replace(/([a-z]+|[A-Z]+)(?=[A-Z_]|$)/g,"$1 ").split(/\s/),a=e-s-1,r=(a<0&&(a=0),0),l=this,c=(n.match(/[A-Za-z0-9_]+/)&&t.forEach(function(e,t){i=r+e.length,r<=a&&a<=i&&(n=e,l.selection.clearSelection(),l.moveCursorTo(o,r+s),l.selection.selectTo(o,i+s)),r=i}),this.$toggleWordPairs),d=0;d<c.length;d++)for(var h=c[d],u=0;u<=1;u++){var p=+!u,m=n.match(new RegExp("^\\s?_?("+f.escapeRegExp(h[u])+")\\s?$","i"));m&&n.match(new RegExp("([_]|^|\\s)("+f.escapeRegExp(m[1])+")($|\\s)","g"))&&(m=n.replace(new RegExp(f.escapeRegExp(h[u]),"i"),function(e){var t=h[p];return e.toUpperCase()==e?t=t.toUpperCase():e.charAt(0).toUpperCase()==e.charAt(0)&&(t=t.substr(0,0)+h[p].charAt(0).toUpperCase()+t.substr(1)),t}),this.insert(m))}},this.removeLines=function(){var e=this.$getSelectedRows();this.session.removeFullLines(e.first,e.last),this.clearSelection()},this.duplicateSelection=function(){var e,t=this.selection,i=this.session,o=t.getRange(),n=t.isBackwards();o.isEmpty()?(e=o.start.row,i.duplicateLines(e,e)):(e=n?o.start:o.end,i=i.insert(e,i.getTextRange(o),!1),o.start=e,o.end=i,t.setSelectionRange(o,n))},this.moveLinesDown=function(){this.$moveLines(1,!1)},this.moveLinesUp=function(){this.$moveLines(-1,!1)},this.moveText=function(e,t,i){return this.session.moveText(e,t,i)},this.copyLinesUp=function(){this.$moveLines(-1,!0)},this.copyLinesDown=function(){this.$moveLines(1,!0)},this.$moveLines=function(e,t){var i=this.selection;if(!i.inMultiSelectMode||this.inVirtualSelectionMode){var o=i.toOrientedRange(),n=this.$getSelectedRows(o),s=this.session.$moveLines(n.first,n.last,t?0:e);o.moveBy(s=t&&-1==e?0:s,0),i.fromOrientedRange(o)}else{for(var a=i.rangeList.ranges,r=(i.rangeList.detach(this.session),this.inVirtualSelectionMode=!0,0),l=0,c=a.length,d=0;d<c;d++){for(var h=d,u=(a[d].moveBy(r,0),(n=this.$getSelectedRows(a[d])).first),p=n.last;++d<c;){l&&a[d].moveBy(l,0);var m=this.$getSelectedRows(a[d]);if(t&&m.first!=p)break;if(!t&&m.first>p+1)break;p=m.last}for(d--,r=this.session.$moveLines(u,p,t?0:e),t&&-1==e&&(h=d+1);h<=d;)a[h].moveBy(r,0),h++;l+=r=t?r:0}i.fromOrientedRange(i.ranges[0]),i.rangeList.attach(this.session),this.inVirtualSelectionMode=!1}},this.$getSelectedRows=function(e){return e=(e||this.getSelectionRange()).collapseRows(),{first:this.session.getRowFoldStart(e.start.row),last:this.session.getRowFoldEnd(e.end.row)}},this.onCompositionStart=function(e){this.renderer.showComposition(e)},this.onCompositionUpdate=function(e){this.renderer.setCompositionText(e)},this.onCompositionEnd=function(){this.renderer.hideComposition()},this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},this.isRowVisible=function(e){return e>=this.getFirstVisibleRow()&&e<=this.getLastVisibleRow()},this.isRowFullyVisible=function(e){return e>=this.renderer.getFirstFullyVisibleRow()&&e<=this.renderer.getLastFullyVisibleRow()},this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},this.$moveByPage=function(e,t){var i=this.renderer,o=this.renderer.layerConfig,n=e*Math.floor(o.height/o.lineHeight),e=(!0===t?this.selection.$moveSelection(function(){this.moveCursorBy(n,0)}):!1===t&&(this.selection.moveCursorBy(n,0),this.selection.clearSelection()),i.scrollTop);i.scrollBy(0,n*o.lineHeight),null!=t&&i.scrollCursorIntoView(null,.5),i.animateScrolling(e)},this.selectPageDown=function(){this.$moveByPage(1,!0)},this.selectPageUp=function(){this.$moveByPage(-1,!0)},this.gotoPageDown=function(){this.$moveByPage(1,!1)},this.gotoPageUp=function(){this.$moveByPage(-1,!1)},this.scrollPageDown=function(){this.$moveByPage(1)},this.scrollPageUp=function(){this.$moveByPage(-1)},this.scrollToRow=function(e){this.renderer.scrollToRow(e)},this.scrollToLine=function(e,t,i,o){this.renderer.scrollToLine(e,t,i,o)},this.centerSelection=function(){var e=this.getSelectionRange(),e={row:Math.floor(e.start.row+(e.end.row-e.start.row)/2),column:Math.floor(e.start.column+(e.end.column-e.start.column)/2)};this.renderer.alignCursor(e,.5)},this.getCursorPosition=function(){return this.selection.getCursor()},this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},this.getSelectionRange=function(){return this.selection.getRange()},this.selectAll=function(){this.selection.selectAll()},this.clearSelection=function(){this.selection.clearSelection()},this.moveCursorTo=function(e,t){this.selection.moveCursorTo(e,t)},this.moveCursorToPosition=function(e){this.selection.moveCursorToPosition(e)},this.jumpToMatching=function(e,t){var i=this.getCursorPosition(),o=new y(this.session,i.row,i.column),n=o.getCurrentToken(),s=n||o.stepForward();if(s){var a,r,l,c=!1,d={},h=i.column-s.start,u={")":"(","(":"(","]":"[","[":"[","{":"{","}":"{"};do{if(s.value.match(/[{}()\[\]]/g)){for(;h<s.value.length&&!c;h++)if(u[s.value[h]])switch(r=u[s.value[h]]+"."+s.type.replace("rparen","lparen"),isNaN(d[r])&&(d[r]=0),s.value[h]){case"(":case"[":case"{":d[r]++;break;case")":case"]":case"}":d[r]--,-1===d[r]&&(a="bracket",c=!0)}}else-1!==s.type.indexOf("tag-name")&&(isNaN(d[s.value])&&(d[s.value]=0),"<"===n.value?d[s.value]++:"</"===n.value&&d[s.value]--,-1===d[s.value]&&(a="tag",c=!0))}while(c||(n=s,s=o.stepForward(),h=0),s&&!c);if(a){if("bracket"===a)(p=this.session.getBracketRange(i))||(l=(p=new g(o.getCurrentTokenRow(),o.getCurrentTokenColumn()+h-1,o.getCurrentTokenRow(),o.getCurrentTokenColumn()+h-1)).start,(t||l.row===i.row&&Math.abs(l.column-i.column)<2)&&(p=this.session.getBracketRange(l)));else if("tag"===a){if(!s||-1===s.type.indexOf("tag-name"))return;var p,m=s.value;if(0===(p=new g(o.getCurrentTokenRow(),o.getCurrentTokenColumn()-2,o.getCurrentTokenRow(),o.getCurrentTokenColumn()-2)).compare(i.row,i.column))for(c=!1;s=n,(n=o.stepBackward())&&(-1!==n.type.indexOf("tag-close")&&p.setEnd(o.getCurrentTokenRow(),o.getCurrentTokenColumn()+1),s.value===m&&-1!==s.type.indexOf("tag-name")&&("<"===n.value?d[m]++:"</"===n.value&&d[m]--,0===d[m]&&(c=!0))),n&&!c;);s&&s.type.indexOf("tag-name")&&((l=p.start).row==i.row&&Math.abs(l.column-i.column)<2&&(l=p.end))}(l=p&&p.cursor||l)&&(e?p&&t?this.selection.setRange(p):p&&p.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(l.row,l.column):this.selection.moveTo(l.row,l.column))}}},this.gotoLine=function(e,t,i){this.selection.clearSelection(),this.session.unfold({row:e-1,column:t||0}),this.exitMultiSelectMode&&this.exitMultiSelectMode(),this.moveCursorTo(e-1,t||0),this.isRowFullyVisible(e-1)||this.scrollToLine(e-1,!0,i)},this.navigateTo=function(e,t){this.selection.moveTo(e,t)},this.navigateUp=function(e){var t;if(this.selection.isMultiLine()&&!this.selection.isBackwards())return t=this.selection.anchor.getPosition(),this.moveCursorToPosition(t);this.selection.clearSelection(),this.selection.moveCursorBy(-e||-1,0)},this.navigateDown=function(e){var t;if(this.selection.isMultiLine()&&this.selection.isBackwards())return t=this.selection.anchor.getPosition(),this.moveCursorToPosition(t);this.selection.clearSelection(),this.selection.moveCursorBy(e||1,0)},this.navigateLeft=function(e){if(this.selection.isEmpty())for(e=e||1;e--;)this.selection.moveCursorLeft();else{var t=this.getSelectionRange().start;this.moveCursorToPosition(t)}this.clearSelection()},this.navigateRight=function(e){if(this.selection.isEmpty())for(e=e||1;e--;)this.selection.moveCursorRight();else{var t=this.getSelectionRange().end;this.moveCursorToPosition(t)}this.clearSelection()},this.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},this.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},this.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},this.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},this.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},this.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},this.replace=function(e,t){t&&this.$search.set(t);var t=this.$search.find(this.session),i=0;return t&&(this.$tryReplace(t,e)&&(i=1),this.selection.setSelectionRange(t),this.renderer.scrollSelectionIntoView(t.start,t.end)),i},this.replaceAll=function(e,t){t&&this.$search.set(t);var i=this.$search.findAll(this.session),o=0;if(i.length){t=this.getSelectionRange();this.selection.moveTo(0,0);for(var n=i.length-1;0<=n;--n)this.$tryReplace(i[n],e)&&o++;this.selection.setSelectionRange(t)}return o},this.$tryReplace=function(e,t){var i=this.session.getTextRange(e);return null!==(t=this.$search.replace(i,t))?(e.end=this.session.replace(e,t),e):null},this.getLastSearchOptions=function(){return this.$search.getOptions()},this.find=function(e,t,i){t=t||{},"string"==typeof e||e instanceof RegExp?t.needle=e:"object"==typeof e&&s.mixin(t,e);var o=this.selection.getRange(),e=(null==t.needle&&((e=this.session.getTextRange(o)||this.$search.$options.needle)||(o=this.session.getWordRange(o.start.row,o.start.column),e=this.session.getTextRange(o)),this.$search.set({needle:e})),this.$search.set(t),t.start||this.$search.set({start:o}),this.$search.find(this.session));return t.preventScroll?e:e?(this.revealRange(e,i),e):(t.backwards?o.start=o.end:o.end=o.start,void this.selection.setRange(o))},this.findNext=function(e,t){this.find({skipCurrent:!0,backwards:!1},e,t)},this.findPrevious=function(e,t){this.find(e,{skipCurrent:!0,backwards:!0},t)},this.revealRange=function(e,t){this.session.unfold(e),this.selection.setSelectionRange(e);var i=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(e.start,e.end,.5),!1!==t&&this.renderer.animateScrolling(i)},this.undo=function(){this.session.getUndoManager().undo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.redo=function(){this.session.getUndoManager().redo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.destroy=function(){this.$toDestroy&&(this.$toDestroy.forEach(function(e){e.destroy()}),this.$toDestroy=null),this.$mouseHandler&&this.$mouseHandler.destroy(),this.renderer.destroy(),this._signal("destroy",this),this.session&&this.session.destroy(),this._$emitInputEvent&&this._$emitInputEvent.cancel(),this.removeAllListeners()},this.setAutoScrollEditorIntoView=function(e){var o,n,s,a,t,i,r;e&&(s=!1,(n=this).$scrollAnchor||(this.$scrollAnchor=document.createElement("div")),(a=this.$scrollAnchor).style.cssText="position:absolute",this.container.insertBefore(a,this.container.firstChild),t=this.on("changeSelection",function(){s=!0}),i=this.renderer.on("beforeRender",function(){s&&(o=n.renderer.container.getBoundingClientRect())}),r=this.renderer.on("afterRender",function(){var e,t,i;s&&o&&(n.isFocused()||n.searchBox&&n.searchBox.isFocused())&&(e=(t=n.renderer).$cursorLayer.$pixelPos,t=t.layerConfig,i=e.top-t.offset,null!=(s=0<=e.top&&i+o.top<0||!(e.top<t.height&&e.top+o.top+t.lineHeight>window.innerHeight)&&null)&&(a.style.top=i+"px",a.style.left=e.left+"px",a.style.height=t.lineHeight+"px",a.scrollIntoView(s)),s=o=null)}),this.setAutoScrollEditorIntoView=function(e){e||(delete this.setAutoScrollEditorIntoView,this.off("changeSelection",t),this.renderer.off("afterRender",r),this.renderer.off("beforeRender",i))})},this.$resetCursorStyle=function(){var e=this.$cursorStyle||"ace",t=this.renderer.$cursorLayer;t&&(t.setSmoothBlinking(/smooth/.test(e)),t.isBlinking=!this.$readOnly&&"wide"!=e,o.setCssClass(t.element,"ace_slim-cursors",/slim/.test(e)))},this.prompt=function(t,i,o){var n=this;b.loadModule("./ext/prompt",function(e){e.prompt(n,t,i,o)})}}.call(n.prototype),b.defineOptions(n.prototype,"editor",{selectionStyle:{set:function(e){this.onSelectionChange(),this._signal("changeSelectionStyle",{data:e})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(e){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(e){this.textInput.setReadOnly(e),this.$resetCursorStyle()},initialValue:!1},copyWithEmptySelection:{set:function(e){this.textInput.setCopyWithEmptySelection(e)},initialValue:!1},cursorStyle:{set:function(e){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[!1,!0,"always"],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},enableAutoIndent:{initialValue:!0},autoScrollEditorIntoView:{set:function(e){this.setAutoScrollEditorIntoView(e)}},keyboardHandler:{set:function(e){this.setKeyboardHandler(e)},get:function(){return this.$keybindingId},handlesSet:!0},value:{set:function(e){this.session.setValue(e)},get:function(){return this.getValue()},handlesSet:!0,hidden:!0},session:{set:function(e){this.setSession(e)},get:function(){return this.session},handlesSet:!0,hidden:!0},showLineNumbers:{set:function(e){this.renderer.$gutterLayer.setShowLineNumbers(e),this.renderer.$loop.schedule(this.renderer.CHANGE_GUTTER),e&&this.$relativeLineNumbers?k.attach(this):k.detach(this)},initialValue:!0},relativeLineNumbers:{set:function(e){this.$showLineNumbers&&e?k.attach(this):k.detach(this)}},placeholder:{set:function(e){this.$updatePlaceholder||(this.$updatePlaceholder=function(){var e=this.session&&(this.renderer.$composition||this.getValue());e&&this.renderer.placeholderNode?(this.renderer.off("afterRender",this.$updatePlaceholder),o.removeCssClass(this.container,"ace_hasPlaceholder"),this.renderer.placeholderNode.remove(),this.renderer.placeholderNode=null):e||this.renderer.placeholderNode?!e&&this.renderer.placeholderNode&&(this.renderer.placeholderNode.textContent=this.$placeholder||""):(this.renderer.on("afterRender",this.$updatePlaceholder),o.addCssClass(this.container,"ace_hasPlaceholder"),(e=o.createElement("div")).className="ace_placeholder",e.textContent=this.$placeholder||"",this.renderer.placeholderNode=e,this.renderer.content.appendChild(this.renderer.placeholderNode))}.bind(this),this.on("input",this.$updatePlaceholder)),this.$updatePlaceholder()}},hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",displayIndentGuides:"renderer",highlightIndentGuides:"renderer",showGutter:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",hasCssTransforms:"renderer",maxPixelHeight:"renderer",useTextareaForIME:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimeout:"$mouseHandler",tooltipFollowsMouse:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",navigateWithinSoftTabs:"session",tabSize:"session",wrap:"session",indentedSoftWrap:"session",foldStyle:"session",mode:"session"}),{getText:function(e,t){return(Math.abs(e.selection.lead.row-t)||t+1+(t<9?"":""))+""},getWidth:function(e,t,i){return Math.max(t.toString().length,(i.lastRow+1).toString().length,2)*i.characterWidth},update:function(e,t){t.renderer.$loop.schedule(t.renderer.CHANGE_GUTTER)},attach:function(e){e.renderer.$gutterLayer.$renderer=this,e.on("changeSelection",this.update),this.update(null,e)},detach:function(e){e.renderer.$gutterLayer.$renderer==this&&(e.renderer.$gutterLayer.$renderer=null),e.off("changeSelection",this.update),this.update(null,e)}});t.Editor=n}),define("ace/undomanager",["require","exports","module","ace/range"],function(e,t,i){"use strict";function n(e,t){for(var i=t;i--;){var o=e[i];if(o&&!o[0].ignore){for(;i<t-1;){var n=function(e,t){for(var i=e.length;i--;)for(var o=0;o<t.length;o++)if(!a(e[i],t[o])){for(;i<e.length;){for(;o--;)a(t[o],e[i]);o=t.length,i++}return[e,t]}return e.selectionBefore=t.selectionBefore=e.selectionAfter=t.selectionAfter=null,[t,e]}(e[i],e[i+1]);e[i]=n[0],e[i+1]=n[1],i++}return 1}}}function r(e){return{row:e.row,column:e.column}}function o(e){if(e=e||this,Array.isArray(e))return e.map(o).join("\n");var t="";return e.action?(t="insert"==e.action?"+":"-",t+="["+e.lines+"]"):e.value&&(t=Array.isArray(e.value)?e.value.map(s).join("\n"):s(e.value)),e.start&&(t+=s(e)),(e.id||e.rev)&&(t+="\t("+(e.id||e.rev)+")"),t}function s(e){return e.start.row+":"+e.start.column+"=>"+e.end.row+":"+e.end.column}function a(e,t){var i="insert"==e.action,o="insert"==t.action;if(i&&o)if(0<=m(t.start,e.end))l(t,e,-1);else{if(!(m(t.start,e.start)<=0))return;l(e,t,1)}else if(i&&!o)if(0<=m(t.start,e.end))l(t,e,-1);else{if(!(m(t.end,e.start)<=0))return;l(e,t,-1)}else if(!i&&o)if(0<=m(t.start,e.start))l(t,e,1);else{if(!(m(t.start,e.start)<=0))return;l(e,t,1)}else if(!i&&!o)if(0<=m(t.start,e.start))l(t,e,1);else{if(!(m(t.end,e.start)<=0))return;l(e,t,-1)}return 1}function l(e,t,i){c(e.start,t.start,t.end,i),c(e.end,t.start,t.end,i)}function c(e,t,i,o){e.row==(1==o?t:i).row&&(e.column+=o*(i.column-t.column)),e.row+=o*(i.row-t.row)}function d(e,t){var i=e.lines,o=e.end,n=(e.end=r(t),e.end.row-e.start.row),s=i.splice(n,i.length),n=n?t.column:t.column-e.start.column;return i.push(s[0].substring(0,n)),s[0]=s[0].substr(n),{start:r(t),end:o,lines:s,action:e.action}}function h(e,t){var i;t={start:r((i=t).start),end:r(i.end),action:i.action,lines:i.lines.slice()};for(var o=e.length;o--;){for(var n=e[o],s=0;s<n.length;s++){var a=function(e,t){var i,o,n="insert"==e.action,s="insert"==t.action;if(n&&s)m(e.start,t.start)<0?l(t,e,1):l(e,t,1);else if(n&&!s)0<=m(e.start,t.end)?l(e,t,-1):(m(e.start,t.start)<=0||l(e,p.fromPoints(t.start,e.start),-1),l(t,e,1));else if(!n&&s)0<=m(t.start,e.end)?l(t,e,-1):(m(t.start,e.start)<=0||l(t,p.fromPoints(e.start,t.start),-1),l(e,t,1));else if(!n&&!s)if(0<=m(t.start,e.end))l(t,e,-1);else{if(!(m(t.end,e.start)<=0))return m(e.start,t.start)<0&&(e=d(i=e,t.start)),0<m(e.end,t.end)&&(o=d(e,t.end)),c(t.end,e.start,e.end,-1),o&&!i&&(e.lines=o.lines,e.start=o.start,e.end=o.end,o=e),[t,i,o].filter(Boolean);l(e,t,-1)}return[t,e]}(n[s],t);t=a[0],2!=a.length&&(a[2]?(n.splice(s+1,1,a[1],a[2]),s++):a[1]||(n.splice(s,1),s--))}n.length||e.splice(o,1)}}function u(){this.$maxRev=0,this.$fromUndo=!1,this.$undoDepth=1/0,this.reset()}!function(){this.addSession=function(e){this.$session=e},this.add=function(e,t,i){this.$fromUndo||e!=this.$lastDelta&&(this.$keepRedoStack||(this.$redoStack.length=0),!1!==t&&this.lastDeltas||(this.lastDeltas=[],(t=this.$undoStack.length)>this.$undoDepth-1&&this.$undoStack.splice(0,t-this.$undoDepth+1),this.$undoStack.push(this.lastDeltas),e.id=this.$rev=++this.$maxRev),"remove"!=e.action&&"insert"!=e.action||(this.$lastDelta=e),this.lastDeltas.push(e))},this.addSelection=function(e,t){this.selections.push({value:e,rev:t||this.$rev})},this.startNewGroup=function(){return this.lastDeltas=null,this.$rev},this.markIgnored=function(e,t){null==t&&(t=this.$rev+1);for(var i=this.$undoStack,o=i.length;o--;){var n=i[o][0];if(n.id<=e)break;n.id<t&&(n.ignore=!0)}this.lastDeltas=null},this.getSelection=function(e,t){for(var i=this.selections,o=i.length;o--;){var n=i[o];if(n.rev<e)return n=t?i[o+1]:n}},this.getRevision=function(){return this.$rev},this.getDeltas=function(e,t){null==t&&(t=this.$rev+1);for(var i=this.$undoStack,o=null,n=0,s=i.length;s--;){var a=i[s][0];if(a.id<t&&!o&&(o=s+1),a.id<=e){n=s+1;break}}return i.slice(n,o)},this.getChangedRanges=function(e,t){null==t&&this.$rev},this.getChangedLines=function(e,t){null==t&&this.$rev},this.undo=function(e,t){this.lastDeltas=null;var i,o=this.$undoStack;if(n(o,o.length))return e=e||this.$session,this.$redoStackBaseRev!==this.$rev&&this.$redoStack.length&&(this.$redoStack=[]),this.$fromUndo=!0,o=o.pop(),i=null,o&&(i=e.undoChanges(o,t),this.$redoStack.push(o),this.$syncRev()),this.$fromUndo=!1,i},this.redo=function(e,t){if(this.lastDeltas=null,e=e||this.$session,this.$fromUndo=!0,this.$redoStackBaseRev!=this.$rev){for(var i=this.getDeltas(this.$redoStackBaseRev,this.$rev+1),o=this.$redoStack,n=i,s=0;s<n.length;s++)for(var a=n[s],r=0;r<a.length;r++)h(o,a[r]);this.$redoStackBaseRev=this.$rev,this.$redoStack.forEach(function(e){e[0].id=++this.$maxRev},this)}var i=this.$redoStack.pop(),l=null;return i&&(l=e.redoChanges(i,t),this.$undoStack.push(i),this.$syncRev()),this.$fromUndo=!1,l},this.$syncRev=function(){var e=this.$undoStack,e=e[e.length-1],e=e&&e[0].id||0;this.$redoStackBaseRev=e,this.$rev=e},this.reset=function(){this.lastDeltas=null,this.$lastDelta=null,this.$undoStack=[],this.$redoStack=[],this.$rev=0,this.mark=0,this.$redoStackBaseRev=this.$rev,this.selections=[]},this.canUndo=function(){return 0<this.$undoStack.length},this.canRedo=function(){return 0<this.$redoStack.length},this.bookmark=function(e){null==e&&(e=this.$rev),this.mark=e},this.isAtBookmark=function(){return this.$rev===this.mark},this.toJSON=function(){},this.fromJSON=function(){},this.hasUndo=this.canUndo,this.hasRedo=this.canRedo,this.isClean=this.isAtBookmark,this.markClean=this.bookmark,this.$prettyPrint=function(e){return e?o(e):o(this.$undoStack)+"\n---\n"+o(this.$redoStack)}}.call(u.prototype);var p=e("./range").Range,m=p.comparePoints;p.comparePoints;t.UndoManager=u}),define("ace/layer/lines",["require","exports","module","ace/lib/dom"],function(e,t,i){"use strict";function o(e,t){this.element=e,this.canvasHeight=t||5e5,this.element.style.height=2*this.canvasHeight+"px",this.cells=[],this.cellCache=[],this.$offsetCoefficient=0}var a=e("../lib/dom");(function(){this.moveContainer=function(e){a.translate(this.element,0,-(e.firstRowScreen*e.lineHeight%this.canvasHeight)-e.offset*this.$offsetCoefficient)},this.pageChanged=function(e,t){return Math.floor(e.firstRowScreen*e.lineHeight/this.canvasHeight)!==Math.floor(t.firstRowScreen*t.lineHeight/this.canvasHeight)},this.computeLineTop=function(e,t,i){var o=t.firstRowScreen*t.lineHeight,o=Math.floor(o/this.canvasHeight);return i.documentToScreenRow(e,0)*t.lineHeight-o*this.canvasHeight},this.computeLineHeight=function(e,t,i){return t.lineHeight*i.getRowLineCount(e)},this.getLength=function(){return this.cells.length},this.get=function(e){return this.cells[e]},this.shift=function(){this.$cacheCell(this.cells.shift())},this.pop=function(){this.$cacheCell(this.cells.pop())},this.push=function(e){if(Array.isArray(e)){this.cells.push.apply(this.cells,e);for(var t=a.createFragment(this.element),i=0;i<e.length;i++)t.appendChild(e[i].element);this.element.appendChild(t)}else this.cells.push(e),this.element.appendChild(e.element)},this.unshift=function(e){if(Array.isArray(e)){this.cells.unshift.apply(this.cells,e);for(var t=a.createFragment(this.element),i=0;i<e.length;i++)t.appendChild(e[i].element);this.element.firstChild?this.element.insertBefore(t,this.element.firstChild):this.element.appendChild(t)}else this.cells.unshift(e),this.element.insertAdjacentElement("afterbegin",e.element)},this.last=function(){return this.cells.length?this.cells[this.cells.length-1]:null},this.$cacheCell=function(e){e&&(e.element.remove(),this.cellCache.push(e))},this.createCell=function(e,t,i,o){var n,s=this.cellCache.pop();return s||(n=a.createElement("div"),o&&o(n),this.element.appendChild(n),s={element:n,text:"",row:e}),s.row=e,s}}).call(o.prototype),t.Lines=o}),define("ace/layer/gutter",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/layer/lines"],function(e,t,i){"use strict";function c(e){var t=document.createTextNode(""),t=(e.appendChild(t),g.createElement("span"));return e.appendChild(t),e}function o(e){this.element=g.createElement("div"),this.element.className="ace_layer ace_gutter-layer",e.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$lines=new r(this.element),this.$lines.$offsetCoefficient=1}var g=e("../lib/dom"),n=e("../lib/oop"),s=e("../lib/lang"),a=e("../lib/event_emitter").EventEmitter,r=e("./lines").Lines;(function(){n.implement(this,a),this.setSession=function(e){this.session&&this.session.off("change",this.$updateAnnotations),(this.session=e)&&e.on("change",this.$updateAnnotations)},this.addGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.addGutterDecoration"),this.session.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.removeGutterDecoration"),this.session.removeGutterDecoration(e,t)},this.setAnnotations=function(e){this.$annotations=[];for(var t=0;t<e.length;t++){var i=e[t],o=i.row,n=(n=this.$annotations[o])||(this.$annotations[o]={text:[]}),o=(o=i.text)?s.escapeHTML(o):i.html||"",o=(-1===n.text.indexOf(o)&&n.text.push(o),i.type),i=i.className;i?n.className=i:"error"==o?n.className=" ace_error":"warning"==o&&" ace_error"!=n.className?n.className=" ace_warning":"info"!=o||n.className||(n.className=" ace_info")}},this.$updateAnnotations=function(e){var t,i;this.$annotations.length&&(t=e.start.row,0!=(i=e.end.row-t)&&("remove"==e.action?this.$annotations.splice(t,1+i,null):((e=new Array(1+i)).unshift(t,1),this.$annotations.splice.apply(this.$annotations,e))))},this.update=function(e){this.config=e;for(var t=this.session,i=e.firstRow,o=Math.min(e.lastRow+e.gutterOffset,t.getLength()-1),n=(this.oldLastRow=o,this.config=e,this.$lines.moveContainer(e),this.$updateCursorRow(),t.getNextFoldLine(i)),s=n?n.start.row:1/0,a=null,r=-1,l=i;;){if(s<l&&(l=n.end.row+1,s=(n=t.getNextFoldLine(l,n))?n.start.row:1/0),o<l){for(;this.$lines.getLength()>r+1;)this.$lines.pop();break}(a=this.$lines.get(++r))?a.row=l:(a=this.$lines.createCell(l,e,this.session,c),this.$lines.push(a)),this.$renderCell(a,e,n,l),l++}this._signal("afterRender"),this.$updateGutterWidth(e)},this.$updateGutterWidth=function(e){var t=this.session,i=t.gutterRenderer||this.$renderer,o=t.$firstLineNumber,n=this.$lines.last()?this.$lines.last().text:"",o=((this.$fixedWidth||t.$useWrapMode)&&(n=t.getLength()+o-1),i?i.getWidth(t,n,e):n.toString().length*e.characterWidth),i=this.$padding||this.$computePadding();(o+=i.left+i.right)===this.gutterWidth||isNaN(o)||(this.gutterWidth=o,this.element.parentNode.style.width=this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._signal("changeGutterWidth",o))},this.$updateCursorRow=function(){var e;this.$highlightGutterLine&&(e=this.session.selection.getCursor(),this.$cursorRow!==e.row&&(this.$cursorRow=e.row))},this.updateLineHighlight=function(){if(this.$highlightGutterLine){var e=this.session.selection.cursor.row;if(this.$cursorRow=e,!this.$cursorCell||this.$cursorCell.row!=e){this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ",""));var t=this.$lines.cells;this.$cursorCell=null;for(var i=0;i<t.length;i++){var o=t[i];if(o.row>=this.$cursorRow){if(o.row>this.$cursorRow){var n=this.session.getFoldLine(this.$cursorRow);if(!(0<i&&n&&n.start.row==t[i-1].row))break;o=t[i-1]}o.element.className="ace_gutter-active-line "+o.element.className,this.$cursorCell=o;break}}}}},this.scrollLines=function(e){var t=this.config;if(this.config=e,this.$updateCursorRow(),this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var i=Math.min(e.lastRow+e.gutterOffset,this.session.getLength()-1),o=this.oldLastRow;if(this.oldLastRow=i,!t||o<e.firstRow)return this.update(e);if(i<t.firstRow)return this.update(e);if(t.firstRow<e.firstRow)for(var n=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);0<n;n--)this.$lines.shift();if(i<o)for(n=this.session.getFoldedRowCount(i+1,o);0<n;n--)this.$lines.pop();e.firstRow<t.firstRow&&this.$lines.unshift(this.$renderLines(e,e.firstRow,t.firstRow-1)),o<i&&this.$lines.push(this.$renderLines(e,o+1,i)),this.updateLineHighlight(),this._signal("afterRender"),this.$updateGutterWidth(e)},this.$renderLines=function(e,t,i){for(var o=[],n=t,s=this.session.getNextFoldLine(n),a=s?s.start.row:1/0;a<n&&(n=s.end.row+1,a=(s=this.session.getNextFoldLine(n,s))?s.start.row:1/0),!(i<n);){var r=this.$lines.createCell(n,e,this.session,c);this.$renderCell(r,e,s,n),o.push(r),n++}return o},this.$renderCell=function(e,t,i,o){var n,s=e.element,a=this.session,r=s.childNodes[0],l=s.childNodes[1],c=a.$firstLineNumber,d=a.$breakpoints,h=a.$decorations,u=a.gutterRenderer||this.$renderer,p=this.$showFoldWidgets&&a.foldWidgets,m=i?i.start.row:Number.MAX_VALUE,f="ace_gutter-cell ",h=(this.$highlightGutterLine&&(o==this.$cursorRow||i&&o<this.$cursorRow&&m<=o&&this.$cursorRow<=i.end.row)&&(f+="ace_gutter-active-line ",this.$cursorCell!=e&&(this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ","")),this.$cursorCell=e)),d[o]&&(f+=d[o]),h[o]&&(f+=h[o]),this.$annotations[o]&&(f+=this.$annotations[o].className),s.className!=f&&(s.className=f),!p||null==(n=p[o])&&(n=p[o]=a.getFoldWidget(o)),n?(f="ace_fold-widget ace_"+n,"start"==n&&o==m&&o<i.end.row?f+=" ace_closed":f+=" ace_open",l.className!=f&&(l.className=f),d=t.lineHeight+"px",g.setStyle(l.style,"height",d),g.setStyle(l.style,"display","inline-block")):l&&g.setStyle(l.style,"display","none"),(u?u.getText(a,o):o+c).toString());return h!==r.data&&(r.data=h),g.setStyle(e.element.style,"height",this.$lines.computeLineHeight(o,t,a)+"px"),g.setStyle(e.element.style,"top",this.$lines.computeLineTop(o,t,a)+"px"),e.text=h,e},this.$fixedWidth=!1,this.$highlightGutterLine=!0,this.$renderer="",this.setHighlightGutterLine=function(e){this.$highlightGutterLine=e},this.$showLineNumbers=!0,this.$renderer="",this.setShowLineNumbers=function(e){this.$renderer=!e&&{getWidth:function(){return 0},getText:function(){return""}}},this.getShowLineNumbers=function(){return this.$showLineNumbers},this.$showFoldWidgets=!0,this.setShowFoldWidgets=function(e){e?g.addCssClass(this.element,"ace_folding-enabled"):g.removeCssClass(this.element,"ace_folding-enabled"),this.$showFoldWidgets=e,this.$padding=null},this.getShowFoldWidgets=function(){return this.$showFoldWidgets},this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var e=g.computedStyle(this.element.firstChild);return this.$padding={},this.$padding.left=(parseInt(e.borderLeftWidth)||0)+(parseInt(e.paddingLeft)||0)+1,this.$padding.right=(parseInt(e.borderRightWidth)||0)+(parseInt(e.paddingRight)||0),this.$padding},this.getRegion=function(e){var t=this.$padding||this.$computePadding(),i=this.element.getBoundingClientRect();return e.x<t.left+i.left?"markers":this.$showFoldWidgets&&e.x>i.right-t.right?"foldWidgets":void 0}}).call(o.prototype),t.Gutter=o}),define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"],function(e,t,i){"use strict";function o(e){this.element=n.createElement("div"),this.element.className="ace_layer ace_marker-layer",e.appendChild(this.element)}var p=e("../range").Range,n=e("../lib/dom");(function(){this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setMarkers=function(e){this.markers=e},this.elt=function(e,t){var i=-1!=this.i&&this.element.childNodes[this.i];i?this.i++:(i=document.createElement("div"),this.element.appendChild(i),this.i=-1),i.style.cssText=t,i.className=e},this.update=function(e){if(e){var t,i;for(i in this.config=e,this.i=0,this.markers){var o,n,s,a=this.markers[i];a.range?(s=a.range.clipRows(e.firstRow,e.lastRow)).isEmpty()||(s=s.toScreenRange(this.session),a.renderer?(o=this.$getTop(s.start.row,e),n=this.$padding+s.start.column*e.characterWidth,a.renderer(t,s,n,o,e)):"fullLine"==a.type?this.drawFullLineMarker(t,s,a.clazz,e):"screenLine"==a.type?this.drawScreenLineMarker(t,s,a.clazz,e):s.isMultiLine()?"text"==a.type?this.drawTextMarker(t,s,a.clazz,e):this.drawMultiLineMarker(t,s,a.clazz,e):this.drawSingleLineMarker(t,s,a.clazz+" ace_start ace_br15",e)):a.update(t,this,this.session,e)}if(-1!=this.i)for(;this.i<this.element.childElementCount;)this.element.removeChild(this.element.lastChild)}},this.$getTop=function(e,t){return(e-t.firstRowScreen)*t.lineHeight},this.drawTextMarker=function(e,t,i,o,n){for(var s,a=this.session,r=t.start.row,l=t.end.row,c=r,d=0,h=a.getScreenLastRowColumn(c),u=new p(c,t.start.column,c,d);c<=l;c++)u.start.row=u.end.row=c,u.start.column=c==r?t.start.column:a.getRowWrapIndent(c),u.end.column=h,s=d,d=h,h=c+1<l?a.getScreenLastRowColumn(c+1):c==l?0:t.end.column,this.drawSingleLineMarker(e,u,i+(c==r?" ace_start":"")+" ace_br"+((c==r||c==r+1&&t.start.column?1:0)|(s<d?2:0)|(h<d?4:0)|(c==l?8:0)),o,c==l?0:1,n)},this.drawMultiLineMarker=function(e,t,i,o,n){var s,a=this.$padding,r=o.lineHeight,l=this.$getTop(t.start.row,o),c=a+t.start.column*o.characterWidth;n=n||"",this.session.$bidiHandler.isBidiRow(t.start.row)?((s=t.clone()).end.row=s.start.row,s.end.column=this.session.getLine(s.start.row).length,this.drawBidiSingleLineMarker(e,s,i+" ace_br1 ace_start",o,null,n)):this.elt(i+" ace_br1 ace_start","height:"+r+"px;right:0;top:"+l+"px;left:"+c+"px;"+(n||"")),this.session.$bidiHandler.isBidiRow(t.end.row)?((s=t.clone()).start.row=s.end.row,s.start.column=0,this.drawBidiSingleLineMarker(e,s,i+" ace_br12",o,null,n)):(l=this.$getTop(t.end.row,o),c=t.end.column*o.characterWidth,this.elt(i+" ace_br12","height:"+r+"px;width:"+c+"px;top:"+l+"px;left:"+a+"px;"+(n||""))),(r=(t.end.row-t.start.row-1)*o.lineHeight)<=0||(l=this.$getTop(t.start.row+1,o),e=(t.start.column?1:0)|(t.end.column?0:8),this.elt(i+(e?" ace_br"+e:""),"height:"+r+"px;right:0;top:"+l+"px;left:"+a+"px;"+(n||"")))},this.drawSingleLineMarker=function(e,t,i,o,n,s){if(this.session.$bidiHandler.isBidiRow(t.start.row))return this.drawBidiSingleLineMarker(e,t,i,o,n,s);var e=o.lineHeight,n=(t.end.column+(n||0)-t.start.column)*o.characterWidth,a=this.$getTop(t.start.row,o),t=this.$padding+t.start.column*o.characterWidth;this.elt(i,"height:"+e+"px;width:"+n+"px;top:"+a+"px;left:"+t+"px;"+(s||""))},this.drawBidiSingleLineMarker=function(e,t,i,o,n,s){var a=o.lineHeight,r=this.$getTop(t.start.row,o),l=this.$padding;this.session.$bidiHandler.getSelections(t.start.column,t.end.column).forEach(function(e){this.elt(i,"height:"+a+"px;width:"+e.width+(n||0)+"px;top:"+r+"px;left:"+(l+e.left)+"px;"+(s||""))},this)},this.drawFullLineMarker=function(e,t,i,o,n){var s=this.$getTop(t.start.row,o),a=o.lineHeight;t.start.row!=t.end.row&&(a+=this.$getTop(t.end.row,o)-s),this.elt(i,"height:"+a+"px;top:"+s+"px;left:0;right:0;"+(n||""))},this.drawScreenLineMarker=function(e,t,i,o,n){t=this.$getTop(t.start.row,o),o=o.lineHeight;this.elt(i,"height:"+o+"px;top:"+t+"px;left:0;right:0;"+(n||""))}}).call(o.prototype),t.Marker=o}),define("ace/layer/text",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/layer/lines","ace/lib/event_emitter"],function(e,t,i){"use strict";function o(e){this.dom=c,this.element=this.dom.createElement("div"),this.element.className="ace_layer ace_text-layer",e.appendChild(this.element),this.$updateEolChar=this.$updateEolChar.bind(this),this.$lines=new s(this.element)}var n=e("../lib/oop"),c=e("../lib/dom"),_=e("../lib/lang"),s=e("./lines").Lines,a=e("../lib/event_emitter").EventEmitter;(function(){n.implement(this,a),this.EOF_CHAR="",this.EOL_CHAR_LF="",this.EOL_CHAR_CRLF="",this.EOL_CHAR=this.EOL_CHAR_LF,this.TAB_CHAR="",this.SPACE_CHAR="",this.$padding=0,this.MAX_LINE_LENGTH=1e4,this.$updateEolChar=function(){var e=this.session.doc,e="\n"==e.getNewLineCharacter()&&"windows"!=e.getNewLineMode()?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;if(this.EOL_CHAR!=e)return this.EOL_CHAR=e,!0},this.setPadding=function(e){this.$padding=e,this.element.style.margin="0 "+e+"px"},this.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0},this.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0},this.$setFontMetrics=function(e){this.$fontMetrics=e,this.$fontMetrics.on("changeCharacterSize",function(e){this._signal("changeCharacterSize",e)}.bind(this)),this.$pollSizeChanges()},this.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()},this.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()},this.setSession=function(e){(this.session=e)&&this.$computeTabString()},this.showInvisibles=!1,this.showSpaces=!1,this.showTabs=!1,this.showEOL=!1,this.setShowInvisibles=function(e){return this.showInvisibles!=e&&("string"==typeof(this.showInvisibles=e)?(this.showSpaces=/tab/i.test(e),this.showTabs=/space/i.test(e),this.showEOL=/eol/i.test(e)):this.showSpaces=this.showTabs=this.showEOL=e,this.$computeTabString(),!0)},this.displayIndentGuides=!0,this.setDisplayIndentGuides=function(e){return this.displayIndentGuides!=e&&(this.displayIndentGuides=e,this.$computeTabString(),!0)},this.$highlightIndentGuides=!0,this.setHighlightIndentGuides=function(e){return this.$highlightIndentGuides!==e&&(this.$highlightIndentGuides=e)},this.$tabStrings=[],this.onChangeTabSize=this.$computeTabString=function(){for(var e,t,i,o,n,s,a=this.session.getTabSize(),r=(this.tabSize=a,this.$tabStrings=[0]),l=1;l<a+1;l++)this.showTabs?((s=this.dom.createElement("span")).className="ace_invisible ace_invisible_tab",s.textContent=_.stringRepeat(this.TAB_CHAR,l),r.push(s)):r.push(this.dom.createTextNode(_.stringRepeat(" ",l),this.element));this.displayIndentGuides&&(this.$indentGuideRe=/\s\S| \t|\t |\s$/,e="ace_indent-guide",t=this.showSpaces?" ace_invisible ace_invisible_space":"",i=this.showSpaces?_.stringRepeat(this.SPACE_CHAR,this.tabSize):_.stringRepeat(" ",this.tabSize),o=this.showTabs?" ace_invisible ace_invisible_tab":"",n=this.showTabs?_.stringRepeat(this.TAB_CHAR,this.tabSize):i,(s=this.dom.createElement("span")).className=e+t,s.textContent=i,this.$tabStrings[" "]=s,(s=this.dom.createElement("span")).className=e+o,s.textContent=n,this.$tabStrings["\t"]=s)},this.updateLines=function(e,t,i){if(this.config.lastRow!=e.lastRow||this.config.firstRow!=e.firstRow)return this.update(e);this.config=e;for(var o=Math.max(t,e.firstRow),n=Math.min(i,e.lastRow),s=this.element.childNodes,a=0,r=e.firstRow;r<o;r++){if(l=this.session.getFoldLine(r)){if(l.containsRow(o)){o=l.start.row;break}r=l.end.row}a++}for(var l,c=!1,r=o,d=(l=this.session.getNextFoldLine(r))?l.start.row:1/0;d<r&&(r=l.end.row+1,d=(l=this.session.getNextFoldLine(r,l))?l.start.row:1/0),!(n<r);){var h,u=s[a++];u&&(this.dom.removeChildren(u),this.$renderLine(u,r,r==d&&l),c&&(u.style.top=this.$lines.computeLineTop(r,e,this.session)+"px"),h=e.lineHeight*this.session.getRowLength(r)+"px",u.style.height!=h&&(c=!0,u.style.height=h)),r++}if(c)for(;a<this.$lines.cells.length;){var p=this.$lines.cells[a++];p.element.style.top=this.$lines.computeLineTop(p.row,e,this.session)+"px"}},this.scrollLines=function(e){var t=this.config;if(this.config=e,this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var i=e.lastRow,o=t?t.lastRow:-1;if(!t||o<e.firstRow)return this.update(e);if(i<t.firstRow)return this.update(e);if(!t||t.lastRow<e.firstRow)return this.update(e);if(e.lastRow<t.firstRow)return this.update(e);if(t.firstRow<e.firstRow)for(var n=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);0<n;n--)this.$lines.shift();if(t.lastRow>e.lastRow)for(n=this.session.getFoldedRowCount(e.lastRow+1,t.lastRow);0<n;n--)this.$lines.pop();e.firstRow<t.firstRow&&this.$lines.unshift(this.$renderLinesFragment(e,e.firstRow,t.firstRow-1)),e.lastRow>t.lastRow&&this.$lines.push(this.$renderLinesFragment(e,t.lastRow+1,e.lastRow)),this.$highlightIndentGuide()},this.$renderLinesFragment=function(e,t,i){for(var o=[],n=t,s=this.session.getNextFoldLine(n),a=s?s.start.row:1/0;a<n&&(n=s.end.row+1,a=(s=this.session.getNextFoldLine(n,s))?s.start.row:1/0),!(i<n);){var r=this.$lines.createCell(n,e,this.session),l=r.element;this.dom.removeChildren(l),c.setStyle(l.style,"height",this.$lines.computeLineHeight(n,e,this.session)+"px"),c.setStyle(l.style,"top",this.$lines.computeLineTop(n,e,this.session)+"px"),this.$renderLine(l,n,n==a&&s),this.$useLineGroups()?l.className="ace_line_group":l.className="ace_line",o.push(r),n++}return o},this.update=function(e){this.$lines.moveContainer(e);for(var t=(this.config=e).firstRow,i=e.lastRow,o=this.$lines;o.getLength();)o.pop();o.push(this.$renderLinesFragment(e,t,i))},this.$textToken={text:!0,rparen:!0,lparen:!0},this.$renderToken=function(e,t,i,o){for(var n,s,a=this,r=/(\t)|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\uFEFF\uFFF9-\uFFFC\u2066\u2067\u2068\u202A\u202B\u202D\u202E\u202C\u2069]+)|(\u3000)|([\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3001-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF])/g,l=this.dom.createFragment(this.element),c=0;n=r.exec(o);){var d,h,u=n[1],p=n[2],m=n[3],f=n[4],g=n[5];!a.showSpaces&&p||(d=c!=n.index?o.slice(c,n.index):"",c=n.index+n[0].length,d&&l.appendChild(this.dom.createTextNode(d,this.element)),u?(d=a.session.getScreenTabSize(t+n.index),l.appendChild(a.$tabStrings[d].cloneNode(!0)),t+=d-1):p?a.showSpaces?((h=this.dom.createElement("span")).className="ace_invisible ace_invisible_space",h.textContent=_.stringRepeat(a.SPACE_CHAR,p.length),l.appendChild(h)):l.appendChild(this.com.createTextNode(p,this.element)):m?((h=this.dom.createElement("span")).className="ace_invisible ace_invisible_space ace_invalid",h.textContent=_.stringRepeat(a.SPACE_CHAR,m.length),l.appendChild(h)):f?(t+=1,(h=this.dom.createElement("span")).style.width=2*a.config.characterWidth+"px",h.className=a.showSpaces?"ace_cjk ace_invisible ace_invisible_space":"ace_cjk",h.textContent=a.showSpaces?a.SPACE_CHAR:f,l.appendChild(h)):g&&(t+=1,(h=this.dom.createElement("span")).style.width=2*a.config.characterWidth+"px",h.className="ace_cjk",h.textContent=g,l.appendChild(h)))}return l.appendChild(this.dom.createTextNode(c?o.slice(c):o,this.element)),this.$textToken[i.type]?e.appendChild(l):(s="ace_"+i.type.replace(/\./g," ace_"),h=this.dom.createElement("span"),"fold"==i.type&&(h.style.width=i.value.length*this.config.characterWidth+"px"),h.className=s,h.appendChild(l),e.appendChild(h)),t+o.length},this.renderIndentGuide=function(e,t,i){var o=t.search(this.$indentGuideRe);if(o<=0||i<=o)return t;if(" "==t[0])for(var n=(o-=o%this.tabSize)/this.tabSize,s=0;s<n;s++)e.appendChild(this.$tabStrings[" "].cloneNode(!0));else{if("\t"!=t[0])return this.$highlightIndentGuide(),t;for(s=0;s<o;s++)e.appendChild(this.$tabStrings["\t"].cloneNode(!0))}return this.$highlightIndentGuide(),t.substr(o)},this.$highlightIndentGuide=function(){if(this.$highlightIndentGuides&&this.displayIndentGuides){this.$highlightIndentGuideMarker={indentLevel:void 0,start:void 0,end:void 0,dir:void 0};var e=this.session.doc.$lines,t=this.session.selection.getCursor(),i=/^\s*/.exec(this.session.doc.getLine(t.row))[0].length,o=Math.floor(i/this.tabSize);if(this.$highlightIndentGuideMarker={indentLevel:o,start:t.row},this.session.$bracketHighlight)for(var n=this.session.$bracketHighlight.ranges,s=0;s<n.length;s++)if(t.row!==n[s].start.row){this.$highlightIndentGuideMarker.end=n[s].start.row,t.row>n[s].start.row?this.$highlightIndentGuideMarker.dir=-1:this.$highlightIndentGuideMarker.dir=1;break}if(!this.$highlightIndentGuideMarker.end&&""!==e[t.row]&&t.column===e[t.row].length){this.$highlightIndentGuideMarker.dir=1;for(s=t.row+1;s<e.length;s++){var a=e[s],r=/^\s*/.exec(a)[0].length;if(""!==a&&(this.$highlightIndentGuideMarker.end=s,r<=i))break}}this.$renderHighlightIndentGuide()}},this.$clearActiveIndentGuide=function(){for(var e=this.$lines.cells,t=0;t<e.length;t++){var i=e[t].element.childNodes;if(0<i.length)for(var o=0;o<i.length;o++)if(i[o].classList&&i[o].classList.contains("ace_indent-guide-active")){i[o].classList.remove("ace_indent-guide-active");break}}},this.$setIndentGuideActive=function(e,t){""!==this.session.doc.getLine(e.row)&&(e=e.element.childNodes)&&e[t-1]&&e[t-1].classList&&e[t-1].classList.add("ace_indent-guide-active")},this.$renderHighlightIndentGuide=function(){if(this.$lines){var e=this.$lines.cells,t=(this.$clearActiveIndentGuide(),this.$highlightIndentGuideMarker.indentLevel);if(0!==t)if(1===this.$highlightIndentGuideMarker.dir)for(var i=0;i<e.length;i++){var o=e[i];if(this.$highlightIndentGuideMarker.end&&o.row>=this.$highlightIndentGuideMarker.start+1){if(o.row>=this.$highlightIndentGuideMarker.end)break;this.$setIndentGuideActive(o,t)}}else for(i=e.length-1;0<=i;i--){o=e[i];if(this.$highlightIndentGuideMarker.end&&o.row<this.$highlightIndentGuideMarker.start){if(o.row<=this.$highlightIndentGuideMarker.end)break;this.$setIndentGuideActive(o,t)}}}},this.$createLineElement=function(e){var t=this.dom.createElement("div");return t.className="ace_line",t.style.height=this.config.lineHeight+"px",t},this.$renderWrappedLine=function(e,t,i){var o=0,n=0,s=i[0],a=0,r=this.$createLineElement();e.appendChild(r);for(var l=0;l<t.length;l++){var c=t[l],d=c.value;if(0==l&&this.displayIndentGuides){if(o=d.length,!(d=this.renderIndentGuide(r,d,s)))continue;o-=d.length}if(o+d.length<s)a=this.$renderToken(r,a,c,d),o+=d.length;else{for(;o+d.length>=s;)a=this.$renderToken(r,a,c,d.substring(0,s-o)),d=d.substring(s-o),o=s,r=this.$createLineElement(),e.appendChild(r),r.appendChild(this.dom.createTextNode(_.stringRepeat("",i.indent),this.element)),a=0,s=i[++n]||Number.MAX_VALUE;0!=d.length&&(o+=d.length,a=this.$renderToken(r,a,c,d))}}i[i.length-1]>this.MAX_LINE_LENGTH&&this.$renderOverflowMessage(r,a,null,"",!0)},this.$renderSimpleLine=function(e,t){for(var i=0,o=0;o<t.length;o++){var n=t[o],s=n.value;if(0!=o||!this.displayIndentGuides||(s=this.renderIndentGuide(e,s))){if(i+s.length>this.MAX_LINE_LENGTH)return this.$renderOverflowMessage(e,i,n,s);i=this.$renderToken(e,i,n,s)}}},this.$renderOverflowMessage=function(e,t,i,o,n){i&&this.$renderToken(e,t,i,o.slice(0,this.MAX_LINE_LENGTH-t));i=this.dom.createElement("span");i.className="ace_inline_button ace_keyword ace_toggle_wrap",i.textContent=n?"<hide>":"<click to see more...>",e.appendChild(i)},this.$renderLine=function(e,t,i){var o,n,s=e;(o=(i=i||0==i?i:this.session.getFoldLine(t))?this.$getFoldLineTokens(t,i):this.session.getTokens(t)).length?(n=this.session.getRowSplitData(t))&&n.length?(this.$renderWrappedLine(e,o,n),s=e.lastChild):(s=e,this.$useLineGroups()&&(s=this.$createLineElement(),e.appendChild(s)),this.$renderSimpleLine(s,o)):this.$useLineGroups()&&(s=this.$createLineElement(),e.appendChild(s)),this.showEOL&&s&&(i&&(t=i.end.row),(n=this.dom.createElement("span")).className="ace_invisible ace_invisible_eol",n.textContent=t==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,s.appendChild(n))},this.$getFoldLineTokens=function(e,t){var h=this.session,u=[],p=h.getTokens(e);return t.walk(function(e,t,i,o,n){if(null!=e)u.push({type:"fold",value:e});else if((p=n?h.getTokens(t):p).length){for(var s,a=p,r=o,l=i,c=0,d=0;d+a[c].value.length<r;)if(d+=a[c].value.length,++c==a.length)return;for(d!=r&&((s=a[c].value.substring(r-d)).length>l-r&&(s=s.substring(0,l-r)),u.push({type:a[c].type,value:s}),d=r+s.length,c+=1);d<l&&c<a.length;)(s=a[c].value).length+d>l?u.push({type:a[c].type,value:s.substring(0,l-d)}):u.push(a[c]),d+=s.length,c+=1}},t.end.row,this.session.getLine(t.end.row).length),u},this.$useLineGroups=function(){return this.session.getUseWrapMode()},this.destroy=function(){}}).call(o.prototype),t.Text=o}),define("ace/layer/cursor",["require","exports","module","ace/lib/dom"],function(e,t,i){"use strict";function o(e){this.element=c.createElement("div"),this.element.className="ace_layer ace_cursor-layer",e.appendChild(this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),c.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=this.$updateOpacity.bind(this)}var c=e("../lib/dom");(function(){this.$updateOpacity=function(e){for(var t=this.cursors,i=t.length;i--;)c.setStyle(t[i].style,"opacity",e?"":"0")},this.$startCssAnimation=function(){for(var e=this.cursors,t=e.length;t--;)e[t].style.animationDuration=this.blinkInterval+"ms";this.$isAnimating=!0,setTimeout(function(){this.$isAnimating&&c.addCssClass(this.element,"ace_animate-blinking")}.bind(this))},this.$stopCssAnimation=function(){this.$isAnimating=!1,c.removeCssClass(this.element,"ace_animate-blinking")},this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setBlinking=function(e){e!=this.isBlinking&&(this.isBlinking=e,this.restartTimer())},this.setBlinkInterval=function(e){e!=this.blinkInterval&&(this.blinkInterval=e,this.restartTimer())},this.setSmoothBlinking=function(e){e!=this.smoothBlinking&&(this.smoothBlinking=e,c.setCssClass(this.element,"ace_smooth-blinking",e),this.$updateCursors(!0),this.restartTimer())},this.addCursor=function(){var e=c.createElement("div");return e.className="ace_cursor",this.element.appendChild(e),this.cursors.push(e),e},this.removeCursor=function(){var e;if(1<this.cursors.length)return(e=this.cursors.pop()).parentNode.removeChild(e),e},this.hideCursor=function(){this.isVisible=!1,c.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.showCursor=function(){this.isVisible=!0,c.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.restartTimer=function(){var e,t=this.$updateCursors;clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.$stopCssAnimation(),this.smoothBlinking&&(this.$isSmoothBlinking=!1,c.removeCssClass(this.element,"ace_smooth-blinking")),t(!0),this.isBlinking&&this.blinkInterval&&this.isVisible?(this.smoothBlinking&&(this.$isSmoothBlinking=!0,setTimeout(function(){this.$isSmoothBlinking&&c.addCssClass(this.element,"ace_smooth-blinking")}.bind(this))),c.HAS_CSS_ANIMATION?this.$startCssAnimation():(e=function(){this.timeoutId=setTimeout(function(){t(!1)},.6*this.blinkInterval)}.bind(this),this.intervalId=setInterval(function(){t(!0),e()},this.blinkInterval),e())):this.$stopCssAnimation()},this.getPixelPosition=function(e,t){if(!this.config||!this.session)return{left:0,top:0};e=e||this.session.selection.getCursor();var i=this.session.documentToScreenPosition(e);return{left:this.$padding+(this.session.$bidiHandler.isBidiRow(i.row,e.row)?this.session.$bidiHandler.getPosLeft(i.column):i.column*this.config.characterWidth),top:(i.row-(t?this.config.firstRowScreen:0))*this.config.lineHeight}},this.isCursorInView=function(e,t){return 0<=e.top&&e.top<t.maxHeight},this.update=function(e){this.config=e;for(var t=this.session.$selectionMarkers,i=0,o=0,i=0,n=(t=void 0!==t&&0!==t.length?t:[{cursor:null}]).length;i<n;i++){var s,a,r=this.getPixelPosition(t[i].cursor,!0);(r.top>e.height+e.offset||r.top<0)&&1<i||(a=(s=this.cursors[o++]||this.addCursor()).style,this.drawCursor?this.drawCursor(s,r,e,t[i],this.session):this.isCursorInView(r,e)?(c.setStyle(a,"display","block"),c.translate(s,r.left,r.top),c.setStyle(a,"width",Math.round(e.characterWidth)+"px"),c.setStyle(a,"height",e.lineHeight+"px")):c.setStyle(a,"display","none"))}for(;this.cursors.length>o;)this.removeCursor();var l=this.session.getOverwrite();this.$setOverwrite(l),this.$pixelPos=r,this.restartTimer()},this.drawCursor=null,this.$setOverwrite=function(e){e!=this.overwrite&&((this.overwrite=e)?c.addCssClass(this.element,"ace_overwrite-cursors"):c.removeCssClass(this.element,"ace_overwrite-cursors"))},this.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)}}).call(o.prototype),t.Cursor=o}),define("ace/scrollbar",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],function(e,t,i){"use strict";function o(e){this.element=r.createElement("div"),this.element.className="ace_scrollbar ace_scrollbar"+this.classSuffix,this.inner=r.createElement("div"),this.inner.className="ace_scrollbar-inner",this.inner.textContent="",this.element.appendChild(this.inner),e.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,l.addListener(this.element,"scroll",this.onScroll.bind(this)),l.addListener(this.element,"mousedown",l.preventDefault)}function n(e,t){o.call(this,e),this.scrollTop=0,this.scrollHeight=0,t.$scrollbarWidth=this.width=r.scrollbarWidth(e.ownerDocument),this.inner.style.width=this.element.style.width=(this.width||15)+5+"px",this.$minWidth=0}function s(e,t){o.call(this,e),this.scrollLeft=0,this.height=t.$scrollbarWidth,this.inner.style.height=this.element.style.height=(this.height||15)+5+"px"}var a=e("./lib/oop"),r=e("./lib/dom"),l=e("./lib/event"),c=e("./lib/event_emitter").EventEmitter;!function(){a.implement(this,c),this.setVisible=function(e){this.element.style.display=e?"":"none",this.isVisible=e,this.coeff=1}}.call(o.prototype),a.inherits(n,o),function(){this.classSuffix="-v",this.onScroll=function(){var e;this.skipEvent||(this.scrollTop=this.element.scrollTop,1!=this.coeff&&(e=this.element.clientHeight/this.scrollHeight,this.scrollTop=this.scrollTop*(1-e)/(this.coeff-e)),this._emit("scroll",{data:this.scrollTop})),this.skipEvent=!1},this.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)},this.setHeight=function(e){this.element.style.height=e+"px"},this.setInnerHeight=this.setScrollHeight=function(e){32768<(this.scrollHeight=e)?(this.coeff=32768/e,e=32768):1!=this.coeff&&(this.coeff=1),this.inner.style.height=e+"px"},this.setScrollTop=function(e){this.scrollTop!=e&&(this.skipEvent=!0,this.scrollTop=e,this.element.scrollTop=e*this.coeff)}}.call(n.prototype);a.inherits(s,o),function(){this.classSuffix="-h",this.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit("scroll",{data:this.scrollLeft})),this.skipEvent=!1},this.getHeight=function(){return this.isVisible?this.height:0},this.setWidth=function(e){this.element.style.width=e+"px"},this.setInnerWidth=function(e){this.inner.style.width=e+"px"},this.setScrollWidth=function(e){this.inner.style.width=e+"px"},this.setScrollLeft=function(e){this.scrollLeft!=e&&(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=e)}}.call(s.prototype),t.ScrollBar=n,t.ScrollBarV=n,t.ScrollBarH=s,t.VScrollBar=n,t.HScrollBar=s}),define("ace/renderloop",["require","exports","module","ace/lib/event"],function(e,t,i){"use strict";function o(e,t){this.onRender=e,this.pending=!1,this.changes=0,this.$recursionLimit=2,this.window=t||window;var i=this;this._flush=function(e){i.pending=!1;var t=i.changes;t&&(n.blockIdle(100),i.changes=0,i.onRender(t)),i.changes?i.$recursionLimit--<0||i.schedule():i.$recursionLimit=2}}var n=e("./lib/event");(function(){this.schedule=function(e){this.changes=this.changes|e,this.changes&&!this.pending&&(n.nextFrame(this._flush),this.pending=!0)},this.clear=function(e){var t=this.changes;return this.changes=0,t}}).call(o.prototype),t.RenderLoop=o}),define("ace/layer/font_metrics",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/event","ace/lib/useragent","ace/lib/event_emitter"],function(e,t,i){var o=e("../lib/oop"),n=e("../lib/dom"),s=e("../lib/lang"),a=e("../lib/event"),r=e("../lib/useragent"),l=e("../lib/event_emitter").EventEmitter,c="function"==typeof ResizeObserver,e=t.FontMetrics=function(e){this.el=n.createElement("div"),this.$setMeasureNodeStyles(this.el.style,!0),this.$main=n.createElement("div"),this.$setMeasureNodeStyles(this.$main.style),this.$measureNode=n.createElement("div"),this.$setMeasureNodeStyles(this.$measureNode.style),this.el.appendChild(this.$main),this.el.appendChild(this.$measureNode),e.appendChild(this.el),this.$measureNode.textContent=s.stringRepeat("X",256),this.$characterSize={width:0,height:0},c?this.$addObserver():this.checkForSizeChanges()};!function(){o.implement(this,l),this.$characterSize={width:0,height:0},this.$setMeasureNodeStyles=function(e,t){e.width=e.height="auto",e.left=e.top="0px",e.visibility="hidden",e.position="absolute",e.whiteSpace="pre",r.isIE<8?e["font-family"]="inherit":e.font="inherit",e.overflow=t?"hidden":"visible"},this.checkForSizeChanges=function(e){var t;!(e=void 0===e?this.$measureSizes():e)||this.$characterSize.width===e.width&&this.$characterSize.height===e.height||(this.$measureNode.style.fontWeight="bold",t=this.$measureSizes(),this.$measureNode.style.fontWeight="",this.$characterSize=e,this.charSizes=Object.create(null),this.allowBoldFonts=t&&t.width===e.width&&t.height===e.height,this._emit("changeCharacterSize",{data:e}))},this.$addObserver=function(){var t=this;this.$observer=new window.ResizeObserver(function(e){t.checkForSizeChanges()}),this.$observer.observe(this.$measureNode)},this.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer||this.$observer)return this.$pollSizeChangesTimer;var t=this;return this.$pollSizeChangesTimer=a.onIdle(function e(){t.checkForSizeChanges(),a.onIdle(e,500)},500)},this.setPolling=function(e){e?this.$pollSizeChanges():this.$pollSizeChangesTimer&&(clearInterval(this.$pollSizeChangesTimer),this.$pollSizeChangesTimer=0)},this.$measureSizes=function(e){e={height:(e||this.$measureNode).clientHeight,width:(e||this.$measureNode).clientWidth/256};return 0===e.width||0===e.height?null:e},this.$measureCharWidth=function(e){return this.$main.textContent=s.stringRepeat(e,256),this.$main.getBoundingClientRect().width/256},this.getCharacterWidth=function(e){var t=this.charSizes[e];return t=void 0===t?this.charSizes[e]=this.$measureCharWidth(e)/this.$characterSize.width:t},this.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.$observer&&this.$observer.disconnect(),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)},this.$getZoom=function e(t){return t&&t.parentElement?(window.getComputedStyle(t).zoom||1)*e(t.parentElement):1},this.$initTransformMeasureNodes=function(){function e(e,t){return["div",{style:"position: absolute;top:"+e+"px;left:"+t+"px;"}]}this.els=n.buildDom([e(0,0),e(200,0),e(0,200),e(200,200)],this.el)},this.transformCoordinates=function(e,t){function i(e,t,i){var o=e[1]*t[0]-e[0]*t[1];return[(-t[1]*i[0]+t[0]*i[1])/o,(+e[1]*i[0]-e[0]*i[1])/o]}function o(e,t){return[e[0]-t[0],e[1]-t[1]]}function n(e,t){return[e[0]+t[0],e[1]+t[1]]}function s(e,t){return[e*t[0],e*t[1]]}function a(e){e=e.getBoundingClientRect();return[e.left,e.top]}e=e&&s(1/this.$getZoom(this.el),e),this.els||this.$initTransformMeasureNodes();var r=a(this.els[0]),l=a(this.els[1]),c=a(this.els[2]),d=a(this.els[3]),d=i(o(d,l),o(d,c),o(n(l,c),n(d,r))),l=s(1+d[0],o(l,r)),c=s(1+d[1],o(c,r));if(t)return h=d[0]*t[0]/200+d[1]*t[1]/200+1,t=n(s(t[0],l),s(t[1],c)),n(s(1/h/200,t),r);var h=o(e,r),t=i(o(l,s(d[0],h)),o(c,s(d[1],h)),h);return s(200,t)}}.call(e.prototype)}),define("ace/css/editor.css",["require","exports","module"],function(e,t,i){i.exports='/*\nstyles = []\nfor (var i = 1; i < 16; i++) {\n    styles.push(".ace_br" + i + "{" + (\n        ["top-left", "top-right", "bottom-right", "bottom-left"]\n    ).map(function(x, j) {\n        return i & (1<<j) ? "border-" + x + "-radius: 3px;" : "" \n    }).filter(Boolean).join(" ") + "}")\n}\nstyles.join("\\n")\n*/\n.ace_br1 {border-top-left-radius    : 3px;}\n.ace_br2 {border-top-right-radius   : 3px;}\n.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}\n.ace_br4 {border-bottom-right-radius: 3px;}\n.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}\n.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}\n.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}\n.ace_br8 {border-bottom-left-radius : 3px;}\n.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}\n.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}\n.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}\n.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}\n.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}\n.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}\n.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}\n\n\n.ace_editor {\n    position: relative;\n    overflow: hidden;\n    padding: 0;\n    font: 12px/normal \'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;\n    direction: ltr;\n    text-align: left;\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.ace_scroller {\n    position: absolute;\n    overflow: hidden;\n    top: 0;\n    bottom: 0;\n    background-color: inherit;\n    -ms-user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n    cursor: text;\n}\n\n.ace_content {\n    position: absolute;\n    box-sizing: border-box;\n    min-width: 100%;\n    contain: style size layout;\n    font-variant-ligatures: no-common-ligatures;\n}\n\n.ace_dragging .ace_scroller:before{\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    content: \'\';\n    background: rgba(250, 250, 250, 0.01);\n    z-index: 1000;\n}\n.ace_dragging.ace_dark .ace_scroller:before{\n    background: rgba(0, 0, 0, 0.01);\n}\n\n.ace_gutter {\n    position: absolute;\n    overflow : hidden;\n    width: auto;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    cursor: default;\n    z-index: 4;\n    -ms-user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n    contain: style size layout;\n}\n\n.ace_gutter-active-line {\n    position: absolute;\n    left: 0;\n    right: 0;\n}\n\n.ace_scroller.ace_scroll-left {\n    box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;\n}\n\n.ace_gutter-cell {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    padding-left: 19px;\n    padding-right: 6px;\n    background-repeat: no-repeat;\n}\n\n.ace_gutter-cell.ace_error {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");\n    background-repeat: no-repeat;\n    background-position: 2px center;\n}\n\n.ace_gutter-cell.ace_warning {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");\n    background-position: 2px center;\n}\n\n.ace_gutter-cell.ace_info {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");\n    background-position: 2px center;\n}\n.ace_dark .ace_gutter-cell.ace_info {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");\n}\n\n.ace_scrollbar {\n    contain: strict;\n    position: absolute;\n    right: 0;\n    bottom: 0;\n    z-index: 6;\n}\n\n.ace_scrollbar-inner {\n    position: absolute;\n    cursor: text;\n    left: 0;\n    top: 0;\n}\n\n.ace_scrollbar-v{\n    overflow-x: hidden;\n    overflow-y: scroll;\n    top: 0;\n}\n\n.ace_scrollbar-h {\n    overflow-x: scroll;\n    overflow-y: hidden;\n    left: 0;\n}\n\n.ace_print-margin {\n    position: absolute;\n    height: 100%;\n}\n\n.ace_text-input {\n    position: absolute;\n    z-index: 0;\n    width: 0.5em;\n    height: 1em;\n    opacity: 0;\n    background: transparent;\n    -moz-appearance: none;\n    appearance: none;\n    border: none;\n    resize: none;\n    outline: none;\n    overflow: hidden;\n    font: inherit;\n    padding: 0 1px;\n    margin: 0 -1px;\n    contain: strict;\n    -ms-user-select: text;\n    -moz-user-select: text;\n    -webkit-user-select: text;\n    user-select: text;\n    /*with `pre-line` chrome inserts &nbsp; instead of space*/\n    white-space: pre!important;\n}\n.ace_text-input.ace_composition {\n    background: transparent;\n    color: inherit;\n    z-index: 1000;\n    opacity: 1;\n}\n.ace_composition_placeholder { color: transparent }\n.ace_composition_marker { \n    border-bottom: 1px solid;\n    position: absolute;\n    border-radius: 0;\n    margin-top: 1px;\n}\n\n[ace_nocontext=true] {\n    transform: none!important;\n    filter: none!important;\n    clip-path: none!important;\n    mask : none!important;\n    contain: none!important;\n    perspective: none!important;\n    mix-blend-mode: initial!important;\n    z-index: auto;\n}\n\n.ace_layer {\n    z-index: 1;\n    position: absolute;\n    overflow: hidden;\n    /* workaround for chrome bug https://github.com/ajaxorg/ace/issues/2312*/\n    word-wrap: normal;\n    white-space: pre;\n    height: 100%;\n    width: 100%;\n    box-sizing: border-box;\n    /* setting pointer-events: auto; on node under the mouse, which changes\n        during scroll, will break mouse wheel scrolling in Safari */\n    pointer-events: none;\n}\n\n.ace_gutter-layer {\n    position: relative;\n    width: auto;\n    text-align: right;\n    pointer-events: auto;\n    height: 1000000px;\n    contain: style size layout;\n}\n\n.ace_text-layer {\n    font: inherit !important;\n    position: absolute;\n    height: 1000000px;\n    width: 1000000px;\n    contain: style size layout;\n}\n\n.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {\n    contain: style size layout;\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n}\n\n.ace_hidpi .ace_text-layer,\n.ace_hidpi .ace_gutter-layer,\n.ace_hidpi .ace_content,\n.ace_hidpi .ace_gutter {\n    contain: strict;\n    will-change: transform;\n}\n.ace_hidpi .ace_text-layer > .ace_line, \n.ace_hidpi .ace_text-layer > .ace_line_group {\n    contain: strict;\n}\n\n.ace_cjk {\n    display: inline-block;\n    text-align: center;\n}\n\n.ace_cursor-layer {\n    z-index: 4;\n}\n\n.ace_cursor {\n    z-index: 4;\n    position: absolute;\n    box-sizing: border-box;\n    border-left: 2px solid;\n    /* workaround for smooth cursor repaintng whole screen in chrome */\n    transform: translatez(0);\n}\n\n.ace_multiselect .ace_cursor {\n    border-left-width: 1px;\n}\n\n.ace_slim-cursors .ace_cursor {\n    border-left-width: 1px;\n}\n\n.ace_overwrite-cursors .ace_cursor {\n    border-left-width: 0;\n    border-bottom: 1px solid;\n}\n\n.ace_hidden-cursors .ace_cursor {\n    opacity: 0.2;\n}\n\n.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {\n    opacity: 0;\n}\n\n.ace_smooth-blinking .ace_cursor {\n    transition: opacity 0.18s;\n}\n\n.ace_animate-blinking .ace_cursor {\n    animation-duration: 1000ms;\n    animation-timing-function: step-end;\n    animation-name: blink-ace-animate;\n    animation-iteration-count: infinite;\n}\n\n.ace_animate-blinking.ace_smooth-blinking .ace_cursor {\n    animation-duration: 1000ms;\n    animation-timing-function: ease-in-out;\n    animation-name: blink-ace-animate-smooth;\n}\n    \n@keyframes blink-ace-animate {\n    from, to { opacity: 1; }\n    60% { opacity: 0; }\n}\n\n@keyframes blink-ace-animate-smooth {\n    from, to { opacity: 1; }\n    45% { opacity: 1; }\n    60% { opacity: 0; }\n    85% { opacity: 0; }\n}\n\n.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {\n    position: absolute;\n    z-index: 3;\n}\n\n.ace_marker-layer .ace_selection {\n    position: absolute;\n    z-index: 5;\n}\n\n.ace_marker-layer .ace_bracket {\n    position: absolute;\n    z-index: 6;\n}\n\n.ace_marker-layer .ace_error_bracket {\n    position: absolute;\n    border-bottom: 1px solid #DE5555;\n    border-radius: 0;\n}\n\n.ace_marker-layer .ace_active-line {\n    position: absolute;\n    z-index: 2;\n}\n\n.ace_marker-layer .ace_selected-word {\n    position: absolute;\n    z-index: 4;\n    box-sizing: border-box;\n}\n\n.ace_line .ace_fold {\n    box-sizing: border-box;\n\n    display: inline-block;\n    height: 11px;\n    margin-top: -2px;\n    vertical-align: middle;\n\n    background-image:\n        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),\n        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");\n    background-repeat: no-repeat, repeat-x;\n    background-position: center center, top left;\n    color: transparent;\n\n    border: 1px solid black;\n    border-radius: 2px;\n\n    cursor: pointer;\n    pointer-events: auto;\n}\n\n.ace_dark .ace_fold {\n}\n\n.ace_fold:hover{\n    background-image:\n        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),\n        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");\n}\n\n.ace_tooltip {\n    background-color: #FFF;\n    background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));\n    border: 1px solid gray;\n    border-radius: 1px;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\n    color: black;\n    max-width: 100%;\n    padding: 3px 4px;\n    position: fixed;\n    z-index: 999999;\n    box-sizing: border-box;\n    cursor: default;\n    white-space: pre;\n    word-wrap: break-word;\n    line-height: normal;\n    font-style: normal;\n    font-weight: normal;\n    letter-spacing: normal;\n    pointer-events: none;\n}\n\n.ace_folding-enabled > .ace_gutter-cell {\n    padding-right: 13px;\n}\n\n.ace_fold-widget {\n    box-sizing: border-box;\n\n    margin: 0 -12px 0 1px;\n    display: none;\n    width: 11px;\n    vertical-align: top;\n\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");\n    background-repeat: no-repeat;\n    background-position: center;\n\n    border-radius: 3px;\n    \n    border: 1px solid transparent;\n    cursor: pointer;\n}\n\n.ace_folding-enabled .ace_fold-widget {\n    display: inline-block;   \n}\n\n.ace_fold-widget.ace_end {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");\n}\n\n.ace_fold-widget.ace_closed {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");\n}\n\n.ace_fold-widget:hover {\n    border: 1px solid rgba(0, 0, 0, 0.3);\n    background-color: rgba(255, 255, 255, 0.2);\n    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);\n}\n\n.ace_fold-widget:active {\n    border: 1px solid rgba(0, 0, 0, 0.4);\n    background-color: rgba(0, 0, 0, 0.05);\n    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);\n}\n/**\n * Dark version for fold widgets\n */\n.ace_dark .ace_fold-widget {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");\n}\n.ace_dark .ace_fold-widget.ace_end {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");\n}\n.ace_dark .ace_fold-widget.ace_closed {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");\n}\n.ace_dark .ace_fold-widget:hover {\n    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);\n    background-color: rgba(255, 255, 255, 0.1);\n}\n.ace_dark .ace_fold-widget:active {\n    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);\n}\n\n.ace_inline_button {\n    border: 1px solid lightgray;\n    display: inline-block;\n    margin: -1px 8px;\n    padding: 0 5px;\n    pointer-events: auto;\n    cursor: pointer;\n}\n.ace_inline_button:hover {\n    border-color: gray;\n    background: rgba(200,200,200,0.2);\n    display: inline-block;\n    pointer-events: auto;\n}\n\n.ace_fold-widget.ace_invalid {\n    background-color: #FFB4B4;\n    border-color: #DE5555;\n}\n\n.ace_fade-fold-widgets .ace_fold-widget {\n    transition: opacity 0.4s ease 0.05s;\n    opacity: 0;\n}\n\n.ace_fade-fold-widgets:hover .ace_fold-widget {\n    transition: opacity 0.05s ease 0.05s;\n    opacity:1;\n}\n\n.ace_underline {\n    text-decoration: underline;\n}\n\n.ace_bold {\n    font-weight: bold;\n}\n\n.ace_nobold .ace_bold {\n    font-weight: normal;\n}\n\n.ace_italic {\n    font-style: italic;\n}\n\n\n.ace_error-marker {\n    background-color: rgba(255, 0, 0,0.2);\n    position: absolute;\n    z-index: 9;\n}\n\n.ace_highlight-marker {\n    background-color: rgba(255, 255, 0,0.2);\n    position: absolute;\n    z-index: 8;\n}\n\n.ace_mobile-menu {\n    position: absolute;\n    line-height: 1.5;\n    border-radius: 4px;\n    -ms-user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n    background: white;\n    box-shadow: 1px 3px 2px grey;\n    border: 1px solid #dcdcdc;\n    color: black;\n}\n.ace_dark > .ace_mobile-menu {\n    background: #333;\n    color: #ccc;\n    box-shadow: 1px 3px 2px grey;\n    border: 1px solid #444;\n\n}\n.ace_mobile-button {\n    padding: 2px;\n    cursor: pointer;\n    overflow: hidden;\n}\n.ace_mobile-button:hover {\n    background-color: #eee;\n    opacity:1;\n}\n.ace_mobile-button:active {\n    background-color: #ddd;\n}\n\n.ace_placeholder {\n    font-family: arial;\n    transform: scale(0.9);\n    transform-origin: left;\n    white-space: pre;\n    opacity: 0.7;\n    margin: 0 10px;\n}'}),define("ace/virtual_renderer",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/config","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/scrollbar","ace/renderloop","ace/layer/font_metrics","ace/lib/event_emitter","ace/css/editor.css","ace/lib/useragent"],function(e,t,i){"use strict";function o(e,t){var i=this,e=(this.container=e||r.createElement("div"),r.addCssClass(this.container,"ace_editor"),r.HI_DPI&&r.addCssClass(this.container,"ace_hidpi"),this.setTheme(t),null==s.get("useStrictCSP")&&s.set("useStrictCSP",!1),this.$gutter=r.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.$gutter.setAttribute("aria-hidden",!0),this.scroller=r.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=r.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new a(this.$gutter),this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this)),this.$markerBack=new l(this.content),this.$textLayer=new c(this.content));this.canvas=e.element,this.$markerFront=new l(this.content),this.$cursorLayer=new d(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new u(this.container,this),this.scrollBarH=new h(this.container,this),this.scrollBarV.on("scroll",function(e){i.$scrollAnimation||i.session.setScrollTop(e.data-i.scrollMargin.top)}),this.scrollBarH.on("scroll",function(e){i.$scrollAnimation||i.session.setScrollLeft(e.data-i.scrollMargin.left)}),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new m(this.container),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.on("changeCharacterSize",function(e){i.updateCharacterSize(),i.onResize(!0,i.gutterWidth,i.$size.width,i.$size.height),i._signal("changeCharacterSize",e)}),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.margin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$keepTextAreaAtCursor=!_.isIOS,this.$loop=new p(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),s.resetOptions(this),s._signal("renderer",this)}var n=e("./lib/oop"),r=e("./lib/dom"),s=e("./config"),a=e("./layer/gutter").Gutter,l=e("./layer/marker").Marker,c=e("./layer/text").Text,d=e("./layer/cursor").Cursor,h=e("./scrollbar").HScrollBar,u=e("./scrollbar").VScrollBar,p=e("./renderloop").RenderLoop,m=e("./layer/font_metrics").FontMetrics,f=e("./lib/event_emitter").EventEmitter,g=e("./css/editor.css"),_=e("./lib/useragent"),b=_.isIE;r.importCssString(g,"ace_editor.css",!1);(function(){this.CHANGE_CURSOR=1,this.CHANGE_MARKER=2,this.CHANGE_GUTTER=4,this.CHANGE_SCROLL=8,this.CHANGE_LINES=16,this.CHANGE_TEXT=32,this.CHANGE_SIZE=64,this.CHANGE_MARKER_BACK=128,this.CHANGE_MARKER_FRONT=256,this.CHANGE_FULL=512,this.CHANGE_H_SCROLL=1024,n.implement(this,f),this.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin(),r.setStyle(this.scroller.style,"line-height",this.lineHeight+"px")},this.setSession=function(e){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode),(this.session=e)&&this.scrollMargin.top&&e.getScrollTop()<=0&&e.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(e),this.$markerBack.setSession(e),this.$markerFront.setSession(e),this.$gutterLayer.setSession(e),this.$textLayer.setSession(e),e&&(this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode))},this.updateLines=function(e,t,i){if(void 0===t&&(t=1/0),this.$changedLines?(this.$changedLines.firstRow>e&&(this.$changedLines.firstRow=e),this.$changedLines.lastRow<t&&(this.$changedLines.lastRow=t)):this.$changedLines={firstRow:e,lastRow:t},this.$changedLines.lastRow<this.layerConfig.firstRow){if(!i)return;this.$changedLines.lastRow=this.layerConfig.lastRow}this.$changedLines.firstRow>this.layerConfig.lastRow||this.$loop.schedule(this.CHANGE_LINES)},this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar(),this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)},this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},this.updateFull=function(e){e?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},this.$changes=0,this.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},this.onResize=function(e,t,i,o){if(!(2<this.resizing)){0<this.resizing?this.resizing++:this.resizing=e?1:0;var n=this.container,n=(o=o||n.clientHeight||n.scrollHeight,i=i||n.clientWidth||n.scrollWidth,this.$updateCachedSize(e,t,i,o));if(!this.$size.scrollerHeight||!i&&!o)return this.resizing=0;e&&(this.$gutterLayer.$padding=null),e?this.$renderChanges(n|this.$changes,!0):this.$loop.schedule(n|this.$changes),this.resizing&&(this.resizing=0),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null}},this.$updateCachedSize=function(e,t,i,o){o-=this.$extraHeight||0;var n=0,s=this.$size,a={width:s.width,height:s.height,scrollerHeight:s.scrollerHeight,scrollerWidth:s.scrollerWidth};return o&&(e||s.height!=o)&&(s.height=o,n|=this.CHANGE_SIZE,s.scrollerHeight=s.height,this.$horizScroll&&(s.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",n|=this.CHANGE_SCROLL),i&&(e||s.width!=i)&&(n|=this.CHANGE_SIZE,s.width=i,null==t&&(t=this.$showGutter?this.$gutter.offsetWidth:0),this.gutterWidth=t,r.setStyle(this.scrollBarH.element.style,"left",t+"px"),r.setStyle(this.scroller.style,"left",t+this.margin.left+"px"),s.scrollerWidth=Math.max(0,i-t-this.scrollBarV.getWidth()-this.margin.h),r.setStyle(this.$gutter.style,"left",this.margin.left+"px"),t=this.scrollBarV.getWidth()+"px",r.setStyle(this.scrollBarH.element.style,"right",t),r.setStyle(this.scroller.style,"right",t),r.setStyle(this.scroller.style,"bottom",this.scrollBarH.getHeight()),(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||e)&&(n|=this.CHANGE_FULL)),s.$dirty=!i||!o,n&&this._signal("resize",a),n},this.onGutterResize=function(e){e=this.$showGutter?e:0;e!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,e,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&&this.adjustWrapLimit()||this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):this.$computeLayerConfig()},this.adjustWrapLimit=function(){var e=this.$size.scrollerWidth-2*this.$padding,e=Math.floor(e/this.characterWidth);return this.session.adjustWrapLimit(e,this.$showPrintMargin&&this.$printMarginColumn)},this.setAnimatedScroll=function(e){this.setOption("animatedScroll",e)},this.getAnimatedScroll=function(){return this.$animatedScroll},this.setShowInvisibles=function(e){this.setOption("showInvisibles",e),this.session.$bidiHandler.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.getOption("showInvisibles")},this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")},this.setDisplayIndentGuides=function(e){this.setOption("displayIndentGuides",e)},this.getHighlightIndentGuides=function(){return this.getOption("highlightIndentGuides")},this.setHighlightIndentGuides=function(e){this.setOption("highlightIndentGuides",e)},this.setShowPrintMargin=function(e){this.setOption("showPrintMargin",e)},this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")},this.setPrintMarginColumn=function(e){this.setOption("printMarginColumn",e)},this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")},this.getShowGutter=function(){return this.getOption("showGutter")},this.setShowGutter=function(e){return this.setOption("showGutter",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.$updatePrintMargin=function(){var e;(this.$showPrintMargin||this.$printMarginEl)&&(this.$printMarginEl||((e=r.createElement("div")).className="ace_layer ace_print-margin-layer",this.$printMarginEl=r.createElement("div"),this.$printMarginEl.className="ace_print-margin",e.appendChild(this.$printMarginEl),this.content.insertBefore(e,this.content.firstChild)),(e=this.$printMarginEl.style).left=Math.round(this.characterWidth*this.$printMarginColumn+this.$padding)+"px",e.visibility=this.$showPrintMargin?"visible":"hidden",this.session&&-1==this.session.$wrap&&this.adjustWrapLimit())},this.getContainerElement=function(){return this.container},this.getMouseEventTarget=function(){return this.scroller},this.getTextAreaContainer=function(){return this.container},this.$moveTextAreaToCursor=function(){var e,t,i,o,n,s,a;this.$isMousePressed||(e=this.textarea.style,s=this.$composition,this.$keepTextAreaAtCursor||s?(i=this.$cursorLayer.$pixelPos)&&(s&&s.markerRange&&(i=this.$cursorLayer.getPixelPosition(s.markerRange.start,!0)),a=this.layerConfig,t=i.top,i=i.left,t-=a.offset,o=s&&s.useTextareaForIME?this.lineHeight:b?0:1,t<0||t>a.height-o?r.translate(this.textarea,0,0):(a=1,n=this.$size.height-o,s?s.useTextareaForIME?(s=this.textarea.value,a=this.characterWidth*this.session.$getStringScreenWidth(s)[0]):t+=this.lineHeight+2:t+=this.lineHeight,(i-=this.scrollLeft)>this.$size.scrollerWidth-a&&(i=this.$size.scrollerWidth-a),i+=this.gutterWidth+this.margin.left,r.setStyle(e,"height",o+"px"),r.setStyle(e,"width",a+"px"),r.translate(this.textarea,Math.min(i,this.$size.scrollerWidth-a),Math.min(t,n)))):r.translate(this.textarea,-100,0))},this.getFirstVisibleRow=function(){return this.layerConfig.firstRow},this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(0===this.layerConfig.offset?0:1)},this.getLastFullyVisibleRow=function(){var e=this.layerConfig,t=e.lastRow;return this.session.documentToScreenRow(t,0)*e.lineHeight-this.session.getScrollTop()>e.height-e.lineHeight?t-1:t},this.getLastVisibleRow=function(){return this.layerConfig.lastRow},this.$padding=null,this.setPadding=function(e){this.$padding=e,this.$textLayer.setPadding(e),this.$cursorLayer.setPadding(e),this.$markerFront.setPadding(e),this.$markerBack.setPadding(e),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},this.setScrollMargin=function(e,t,i,o){var n=this.scrollMargin;n.top=0|e,n.bottom=0|t,n.right=0|o,n.left=0|i,n.v=n.top+n.bottom,n.h=n.left+n.right,n.top&&this.scrollTop<=0&&this.session&&this.session.setScrollTop(-n.top),this.updateFull()},this.setMargin=function(e,t,i,o){var n=this.margin;n.top=0|e,n.bottom=0|t,n.right=0|o,n.left=0|i,n.v=n.top+n.bottom,n.h=n.left+n.right,this.$updateCachedSize(!0,this.gutterWidth,this.$size.width,this.$size.height),this.updateFull()},this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},this.setHScrollBarAlwaysVisible=function(e){this.setOption("hScrollBarAlwaysVisible",e)},this.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible},this.setVScrollBarAlwaysVisible=function(e){this.setOption("vScrollBarAlwaysVisible",e)},this.$updateScrollBarV=function(){var e=this.layerConfig.maxHeight,t=this.$size.scrollerHeight;!this.$maxLines&&this.$scrollPastEnd&&(e-=(t-this.lineHeight)*this.$scrollPastEnd,this.scrollTop>e-t&&(e=this.scrollTop+t,this.scrollBarV.scrollTop=null)),this.scrollBarV.setScrollHeight(e+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},this.$frozen=!1,this.freeze=function(){this.$frozen=!0},this.unfreeze=function(){this.$frozen=!1},this.$renderChanges=function(e,t){if(this.$changes&&(e|=this.$changes,this.$changes=0),this.session&&this.container.offsetWidth&&!this.$frozen&&(e||t)){if(this.$size.$dirty)return this.$changes|=e,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal("beforeRender",e),this.session&&this.session.$bidiHandler&&this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);var i,o,t=this.layerConfig;(e&this.CHANGE_FULL||e&this.CHANGE_SIZE||e&this.CHANGE_TEXT||e&this.CHANGE_LINES||e&this.CHANGE_SCROLL||e&this.CHANGE_H_SCROLL)&&(e|=this.$computeLayerConfig()|this.$loop.clear(),t.firstRow!=this.layerConfig.firstRow&&t.firstRowScreen==this.layerConfig.firstRowScreen&&0<(i=this.scrollTop+(t.firstRow-this.layerConfig.firstRow)*this.lineHeight)&&(this.scrollTop=i,e=(e|=this.CHANGE_SCROLL)|(this.$computeLayerConfig()|this.$loop.clear())),t=this.layerConfig,this.$updateScrollBarV(),e&this.CHANGE_H_SCROLL&&this.$updateScrollBarH(),r.translate(this.content,-this.scrollLeft,-t.offset),i=t.width+2*this.$padding+"px",o=t.minHeight+"px",r.setStyle(this.content.style,"width",i),r.setStyle(this.content.style,"height",o)),e&this.CHANGE_H_SCROLL&&(r.translate(this.content,-this.scrollLeft,-t.offset),this.scroller.className=this.scrollLeft<=0?"ace_scroller":"ace_scroller ace_scroll-left"),e&this.CHANGE_FULL?(this.$changedLines=null,this.$textLayer.update(t),this.$showGutter&&this.$gutterLayer.update(t),this.$markerBack.update(t),this.$markerFront.update(t),this.$cursorLayer.update(t),this.$moveTextAreaToCursor()):e&this.CHANGE_SCROLL?(this.$changedLines=null,e&this.CHANGE_TEXT||e&this.CHANGE_LINES?this.$textLayer.update(t):this.$textLayer.scrollLines(t),this.$showGutter&&(e&this.CHANGE_GUTTER||e&this.CHANGE_LINES?this.$gutterLayer.update(t):this.$gutterLayer.scrollLines(t)),this.$markerBack.update(t),this.$markerFront.update(t),this.$cursorLayer.update(t),this.$moveTextAreaToCursor()):(e&this.CHANGE_TEXT?(this.$changedLines=null,this.$textLayer.update(t),this.$showGutter&&this.$gutterLayer.update(t)):e&this.CHANGE_LINES?(this.$updateLines()||e&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(t):e&this.CHANGE_TEXT||e&this.CHANGE_GUTTER?this.$showGutter&&this.$gutterLayer.update(t):e&this.CHANGE_CURSOR&&this.$highlightGutterLine&&this.$gutterLayer.updateLineHighlight(t),e&this.CHANGE_CURSOR&&(this.$cursorLayer.update(t),this.$moveTextAreaToCursor()),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(t),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(t)),this._signal("afterRender",e)}else this.$changes|=e},this.$autosize=function(){var e=this.session.getScreenLength()*this.lineHeight,t=this.$maxLines*this.lineHeight,i=Math.min(t,Math.max((this.$minLines||1)*this.lineHeight,e))+this.scrollMargin.v+(this.$extraHeight||0);this.$horizScroll&&(i+=this.scrollBarH.getHeight());t=!((i=this.$maxPixelHeight&&i>this.$maxPixelHeight?this.$maxPixelHeight:i)<=2*this.lineHeight)&&t<e;i==this.desiredHeight&&this.$size.height==this.desiredHeight&&t==this.$vScroll||(t!=this.$vScroll&&(this.$vScroll=t,this.scrollBarV.setVisible(t)),e=this.container.clientWidth,this.container.style.height=i+"px",this.$updateCachedSize(!0,this.$gutterWidth,e,i),this.desiredHeight=i,this._signal("autosize"))},this.$computeLayerConfig=function(){var e,t=this.session,i=this.$size,o=i.height<=2*this.lineHeight,n=this.session.getScreenLength()*this.lineHeight,s=this.$getLongestLine(),a=!o&&(this.$hScrollBarAlwaysVisible||i.scrollerWidth-s-2*this.$padding<0),r=this.$horizScroll!==a,a=(r&&(this.$horizScroll=a,this.scrollBarH.setVisible(a)),this.$vScroll),l=(this.$maxLines&&1<this.lineHeight&&this.$autosize(),i.scrollerHeight+this.lineHeight),c=!this.$maxLines&&this.$scrollPastEnd?(i.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0,d=(n+=c,this.scrollMargin),o=(this.session.setScrollTop(Math.max(-d.top,Math.min(this.scrollTop,n-i.scrollerHeight+d.bottom))),this.session.setScrollLeft(Math.max(-d.left,Math.min(this.scrollLeft,s+2*this.$padding-i.scrollerWidth+d.right))),!o&&(this.$vScrollBarAlwaysVisible||i.scrollerHeight-n+c<0||this.scrollTop>d.top)),c=a!==o,d=(c&&(this.$vScroll=o,this.scrollBarV.setVisible(o)),this.scrollTop%this.lineHeight),a=Math.ceil(l/this.lineHeight)-1,a=(o=Math.max(0,Math.round((this.scrollTop-d)/this.lineHeight)))+a,h=this.lineHeight,o=t.screenToDocumentRow(o,0),u=t.getFoldLine(o),t=(u&&(o=u.start.row),u=t.documentToScreenRow(o,0),e=t.getRowLength(o)*h,a=Math.min(t.screenToDocumentRow(a,0),t.getLength()-1),l=i.scrollerHeight+t.getRowLength(a)*h+e,d=this.scrollTop-u*h,0);return this.layerConfig.width==s&&!r||(t=this.CHANGE_H_SCROLL),(r||c)&&(t|=this.$updateCachedSize(!0,this.gutterWidth,i.width,i.height),this._signal("scrollbarVisibilityChanged"),c&&(s=this.$getLongestLine())),this.layerConfig={width:s,padding:this.$padding,firstRow:o,firstRowScreen:u,lastRow:a,lineHeight:h,characterWidth:this.characterWidth,minHeight:l,maxHeight:n,offset:d,gutterOffset:h?Math.max(0,Math.ceil((d+i.height-i.scrollerHeight)/h)):0,height:this.$size.scrollerHeight},this.session.$bidiHandler&&this.session.$bidiHandler.setContentWidth(s-this.$padding),t},this.$updateLines=function(){if(this.$changedLines){var e=this.$changedLines.firstRow,t=this.$changedLines.lastRow,i=(this.$changedLines=null,this.layerConfig);if(!(e>i.lastRow+1||t<i.firstRow)){if(t!==1/0)return this.$textLayer.updateLines(i,e,t),!0;this.$showGutter&&this.$gutterLayer.update(i),this.$textLayer.update(i)}}},this.$getLongestLine=function(){var e=this.session.getScreenWidth();return this.showInvisibles&&!this.session.$useWrapMode&&(e+=1),this.$textLayer&&e>this.$textLayer.MAX_LINE_LENGTH&&(e=this.$textLayer.MAX_LINE_LENGTH+30),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(e*this.characterWidth))},this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},this.addGutterDecoration=function(e,t){this.$gutterLayer.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){this.$gutterLayer.removeGutterDecoration(e,t)},this.updateBreakpoints=function(e){this.$loop.schedule(this.CHANGE_GUTTER)},this.setAnnotations=function(e){this.$gutterLayer.setAnnotations(e),this.$loop.schedule(this.CHANGE_GUTTER)},this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},this.hideCursor=function(){this.$cursorLayer.hideCursor()},this.showCursor=function(){this.$cursorLayer.showCursor()},this.scrollSelectionIntoView=function(e,t,i){this.scrollCursorIntoView(e,i),this.scrollCursorIntoView(t,i)},this.scrollCursorIntoView=function(e,t,i){var o,n,s;0!==this.$size.scrollerHeight&&(o=(e=this.$cursorLayer.getPixelPosition(e)).left,e=e.top,s=i&&i.top||0,i=i&&i.bottom||0,e<(n=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop)+s?(t&&n+s>e+this.lineHeight&&(e-=t*this.$size.scrollerHeight),0===e&&(e=-this.scrollMargin.top),this.session.setScrollTop(e)):n+this.$size.scrollerHeight-i<e+this.lineHeight&&(t&&n+this.$size.scrollerHeight-i<e-this.lineHeight&&(e+=t*this.$size.scrollerHeight),this.session.setScrollTop(e+this.lineHeight+i-this.$size.scrollerHeight)),o<(s=this.scrollLeft)?(o<this.$padding+2*this.layerConfig.characterWidth&&(o=-this.scrollMargin.left),this.session.setScrollLeft(o)):s+this.$size.scrollerWidth<o+this.characterWidth?this.session.setScrollLeft(Math.round(o+this.characterWidth-this.$size.scrollerWidth)):s<=this.$padding&&o-s<this.characterWidth&&this.session.setScrollLeft(0))},this.getScrollTop=function(){return this.session.getScrollTop()},this.getScrollLeft=function(){return this.session.getScrollLeft()},this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},this.scrollToRow=function(e){this.session.setScrollTop(e*this.lineHeight)},this.alignCursor=function(e,t){var e=this.$cursorLayer.getPixelPosition(e="number"==typeof e?{row:e,column:0}:e),i=this.$size.scrollerHeight-this.lineHeight,e=e.top-i*(t||0);return this.session.setScrollTop(e),e},this.STEPS=8,this.$calcSteps=function(e,t){for(var i,o,n=0,s=this.STEPS,a=[],n=0;n<s;++n)a.push((i=n/this.STEPS,(t-(o=e))*(Math.pow(i-1,3)+1)+o));return a},this.scrollToLine=function(e,t,i,o){e=this.$cursorLayer.getPixelPosition({row:e,column:0}).top,t&&(e-=this.$size.scrollerHeight/2),t=this.scrollTop;this.session.setScrollTop(e),!1!==i&&this.animateScrolling(t,o)},this.animateScrolling=function(e,t){var i=this.scrollTop;if(this.$animatedScroll){var o=this;if(e!=i){if(this.$scrollAnimation){var n=this.$scrollAnimation.steps;if(n.length&&(e=n[0])==i)return}var s=o.$calcSteps(e,i);this.$scrollAnimation={from:e,to:i,steps:s},clearInterval(this.$timer),o.session.setScrollTop(s.shift()),o.session.$scrollTop=i,this.$timer=setInterval(function(){if(!o.session)return clearInterval(o.$timer);s.length?(o.session.setScrollTop(s.shift()),o.session.$scrollTop=i):null!=i?(o.session.$scrollTop=-1,o.session.setScrollTop(i),i=null):(o.$timer=clearInterval(o.$timer),o.$scrollAnimation=null,t&&t())},10)}}},this.scrollToY=function(e){this.scrollTop!==e&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=e)},this.scrollToX=function(e){this.scrollLeft!==e&&(this.scrollLeft=e),this.$loop.schedule(this.CHANGE_H_SCROLL)},this.scrollTo=function(e,t){this.session.setScrollTop(t),this.session.setScrollLeft(e)},this.scrollBy=function(e,t){t&&this.session.setScrollTop(this.session.getScrollTop()+t),e&&this.session.setScrollLeft(this.session.getScrollLeft()+e)},this.isScrollableBy=function(e,t){return t<0&&this.session.getScrollTop()>=1-this.scrollMargin.top||(0<t&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom||(e<0&&this.session.getScrollLeft()>=1-this.scrollMargin.left||(0<e&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right||void 0)))},this.pixelToScreenCoordinates=function(e,t){this.$hasCssTransforms?(o={top:0,left:0},e=(i=this.$fontMetrics.transformCoordinates([e,t]))[1]-this.gutterWidth-this.margin.left,t=i[0]):o=this.scroller.getBoundingClientRect();var i=e+this.scrollLeft-o.left-this.$padding,e=i/this.characterWidth,t=Math.floor((t+this.scrollTop-o.top)/this.lineHeight),o=this.$blockCursor?Math.floor(e):Math.round(e);return{row:t,column:o,side:0<e-o?1:-1,offsetX:i}},this.screenToTextCoordinates=function(e,t){this.$hasCssTransforms?(i={top:0,left:0},e=(o=this.$fontMetrics.transformCoordinates([e,t]))[1]-this.gutterWidth-this.margin.left,t=o[0]):i=this.scroller.getBoundingClientRect();var i,o=e+this.scrollLeft-i.left-this.$padding,e=o/this.characterWidth,e=this.$blockCursor?Math.floor(e):Math.round(e),t=Math.floor((t+this.scrollTop-i.top)/this.lineHeight);return this.session.screenToDocumentPosition(t,Math.max(e,0),o)},this.textToScreenCoordinates=function(e,t){var i=this.scroller.getBoundingClientRect(),t=this.session.documentToScreenPosition(e,t),e=this.$padding+(this.session.$bidiHandler.isBidiRow(t.row,e)?this.session.$bidiHandler.getPosLeft(t.column):Math.round(t.column*this.characterWidth)),t=t.row*this.lineHeight;return{pageX:i.left+e-this.scrollLeft,pageY:i.top+t-this.scrollTop}},this.visualizeFocus=function(){r.addCssClass(this.container,"ace_focus")},this.visualizeBlur=function(){r.removeCssClass(this.container,"ace_focus")},this.showComposition=function(e){(this.$composition=e).cssText||(e.cssText=this.textarea.style.cssText),null==e.useTextareaForIME&&(e.useTextareaForIME=this.$useTextareaForIME),this.$useTextareaForIME?(r.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor(),this.$cursorLayer.element.style.display="none"):e.markerId=this.session.addMarker(e.markerRange,"ace_composition_marker","text")},this.setCompositionText=function(e){var t=this.session.selection.cursor;this.addToken(e,"composition_placeholder",t.row,t.column),this.$moveTextAreaToCursor()},this.hideComposition=function(){var e;this.$composition&&(this.$composition.markerId&&this.session.removeMarker(this.$composition.markerId),r.removeCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText=this.$composition.cssText,e=this.session.selection.cursor,this.removeExtraToken(e.row,e.column),this.$composition=null,this.$cursorLayer.element.style.display="")},this.addToken=function(e,t,i,o){var n=this.session,s=(n.bgTokenizer.lines[i]=null,{type:t,value:e}),a=n.getTokens(i);if(null==o)a.push(s);else for(var r=0,l=0;l<a.length;l++){var c=a[l];if(o<=(r+=c.value.length)){var d=c.value.length-(r-o),h=c.value.slice(0,d),d=c.value.slice(d);a.splice(l,1,{type:c.type,value:h},s,{type:c.type,value:d});break}}this.updateLines(i,i)},this.removeExtraToken=function(e,t){this.updateLines(e,e)},this.setTheme=function(i,o){function e(e){if(n.$themeId!=i)return o&&o();if(!e||!e.cssClass)throw new Error("couldn't load module "+i+" or it didn't call define");e.$id&&(n.$themeId=e.$id),r.importCssString(e.cssText,e.cssClass,n.container),n.theme&&r.removeCssClass(n.container,n.theme.cssClass);var t="padding"in e?e.padding:"padding"in(n.theme||{})?4:n.$padding;n.$padding&&t!=n.$padding&&n.setPadding(t),n.$theme=e.cssClass,n.theme=e,r.addCssClass(n.container,e.cssClass),r.setCssClass(n.container,"ace_dark",e.isDark),n.$size&&(n.$size.width=0,n.$updateSizeAsync()),n._dispatchEvent("themeLoaded",{theme:e}),o&&o()}var t,n=this;this.$themeId=i,n._dispatchEvent("themeChange",{theme:i}),i&&"string"!=typeof i?e(i):(t=i||this.$options.theme.initialValue,s.loadModule(["theme",t],e))},this.getTheme=function(){return this.$themeId},this.setStyle=function(e,t){r.setCssClass(this.container,e,!1!==t)},this.unsetStyle=function(e){r.removeCssClass(this.container,e)},this.setCursorStyle=function(e){r.setStyle(this.scroller.style,"cursor",e)},this.setMouseCursor=function(e){r.setStyle(this.scroller.style,"cursor",e)},this.attachToShadowRoot=function(){r.importCssString(g,"ace_editor.css",this.container)},this.destroy=function(){this.freeze(),this.$fontMetrics.destroy(),this.$cursorLayer.destroy(),this.removeAllListeners(),this.container.textContent=""}}).call(o.prototype),s.defineOptions(o.prototype,"renderer",{animatedScroll:{initialValue:!1},showInvisibles:{set:function(e){this.$textLayer.setShowInvisibles(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(e){"number"==typeof e&&(this.$printMarginColumn=e),this.$showPrintMargin=!!e,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(e){this.$gutter.style.display=e?"block":"none",this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},fadeFoldWidgets:{set:function(e){r.setCssClass(this.$gutter,"ace_fade-fold-widgets",e)},initialValue:!1},showFoldWidgets:{set:function(e){this.$gutterLayer.setShowFoldWidgets(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(e){this.$textLayer.setDisplayIndentGuides(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightIndentGuides:{set:function(e){1==this.$textLayer.setHighlightIndentGuides(e)?this.$textLayer.$highlightIndentGuide():this.$textLayer.$clearActiveIndentGuide(this.$textLayer.$lines.cells)},initialValue:!0},highlightGutterLine:{set:function(e){this.$gutterLayer.setHighlightGutterLine(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},hScrollBarAlwaysVisible:{set:function(e){this.$hScrollBarAlwaysVisible&&this.$horizScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(e){this.$vScrollBarAlwaysVisible&&this.$vScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(e){"number"==typeof e&&(e+="px"),this.container.style.fontSize=e,this.updateFontSize()},initialValue:12},fontFamily:{set:function(e){this.container.style.fontFamily=e,this.updateFontSize()}},maxLines:{set:function(e){this.updateFull()}},minLines:{set:function(e){this.$minLines<562949953421311||(this.$minLines=0),this.updateFull()}},maxPixelHeight:{set:function(e){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(e){this.$scrollPastEnd!=(e=+e||0)&&(this.$scrollPastEnd=e,this.$loop.schedule(this.CHANGE_SCROLL))},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(e){this.$gutterLayer.$fixedWidth=!!e,this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(e){this.setTheme(e)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0},hasCssTransforms:{},useTextareaForIME:{initialValue:!_.isMobile&&!_.isIE}}),t.VirtualRenderer=o}),define("ace/worker/worker_client",["require","exports","module","ace/lib/oop","ace/lib/net","ace/lib/event_emitter","ace/config"],function(r,e,t){"use strict";function l(e){return"undefined"==typeof Worker?{postMessage:function(){},terminate:function(){}}:h.get("loadWorkerFromBlob")?(t=function(t){t="importScripts('"+o.qualifyURL(t)+"');";try{return new Blob([t],{type:"application/javascript"})}catch(e){var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);return i.append(t),i.getBlob("application/javascript")}}(e),t=(window.URL||window.webkitURL).createObjectURL(t),new Worker(t)):new Worker(e);var t}function c(e){e.postMessage||(e=this.$createWorkerFromOldConfig.apply(this,arguments)),this.$worker=e,this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.onMessage=this.onMessage.bind(this),this.callbackId=1,this.callbacks={},this.$worker.onmessage=this.onMessage}var i=r("../lib/oop"),o=r("../lib/net"),d=r("../lib/event_emitter").EventEmitter,h=r("../config");(function(){i.implement(this,d),this.$createWorkerFromOldConfig=function(e,t,i,o,n){var s,a;return r.nameToUrl&&!r.toUrl&&(r.toUrl=r.nameToUrl),h.get("packaged")||!r.toUrl?o=o||h.moduleUrl(t,"worker"):(s=this.$normalizePath,o=o||s(r.toUrl("ace/worker/worker.js",null,"_")),a={},e.forEach(function(e){a[e]=s(r.toUrl(e,null,"_").replace(/(\.js)?(\?.*)?$/,""))})),this.$worker=l(o),n&&this.send("importScripts",n),this.$worker.postMessage({init:!0,tlns:a,module:t,classname:i}),this.$worker},this.onMessage=function(e){var t=e.data;switch(t.type){case"event":this._signal(t.name,{data:t.data});break;case"call":var i=this.callbacks[t.id];i&&(i(t.data),delete this.callbacks[t.id]);break;case"error":this.reportError(t.data);break;case"log":window.console&&console.log&&console.log.apply(console,t.data)}},this.reportError=function(e){window.console&&console.error&&console.error(e)},this.$normalizePath=function(e){return o.qualifyURL(e)},this.terminate=function(){this._signal("terminate",{}),this.deltaQueue=null,this.$worker.terminate(),this.$worker=null,this.$doc&&this.$doc.off("change",this.changeListener),this.$doc=null},this.send=function(e,t){this.$worker.postMessage({command:e,args:t})},this.call=function(e,t,i){var o;i&&(o=this.callbackId++,this.callbacks[o]=i,t.push(o)),this.send(e,t)},this.emit=function(e,t){try{t.data&&t.data.err&&(t.data.err={message:t.data.err.message,stack:t.data.err.stack,code:t.data.err.code}),this.$worker&&this.$worker.postMessage({event:e,data:{data:t.data}})}catch(e){console.error(e.stack)}},this.attachToDocument=function(e){this.$doc&&this.terminate(),this.$doc=e,this.call("setValue",[e.getValue()]),e.on("change",this.changeListener,!0)},this.changeListener=function(e){this.deltaQueue||(this.deltaQueue=[],setTimeout(this.$sendDeltaQueue,0)),"insert"==e.action?this.deltaQueue.push(e.start,e.lines):this.deltaQueue.push(e.start,e.end)},this.$sendDeltaQueue=function(){var e=this.deltaQueue;e&&(this.deltaQueue=null,50<e.length&&e.length>this.$doc.getLength()>>1?this.call("setValue",[this.$doc.getValue()]):this.emit("change",{data:e}))}}).call(c.prototype);e.UIWorkerClient=function(e,t,i){var o=null,n=!1,s=Object.create(d),a=[],r=new c({messageBuffer:a,terminate:function(){},postMessage:function(e){a.push(e),o&&(n?setTimeout(l):l())}}),l=(r.setEmitSync=function(e){n=e},function(){var e=a.shift();e.command?o[e.command].apply(o,e.args):e.event&&s._signal(e.event,e.data)});return s.postMessage=function(e){r.onMessage({data:e})},s.callback=function(e,t){this.postMessage({type:"call",id:t,data:e})},s.emit=function(e,t){this.postMessage({type:"event",name:e,data:t})},h.loadModule(["worker",t],function(e){for(o=new e[i](s);a.length;)l()}),r},e.WorkerClient=c,e.createWorker=l}),define("ace/placeholder",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/oop"],function(e,t,i){"use strict";function o(e,t,i,o,n,s){var a=this,t=(this.length=t,this.session=e,this.doc=e.getDocument(),this.mainClass=n,this.othersClass=s,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate,!0),this.$others=o,this.$onCursorChange=function(){setTimeout(function(){a.onCursorChange()})},this.$pos=i,e.getUndoManager().$undoStack||e.getUndoManager().$undostack||{length:-1});this.$undoStackDepth=t.length,this.setup(),e.selection.on("changeCursor",this.$onCursorChange)}var l=e("./range").Range,n=e("./lib/event_emitter").EventEmitter,s=e("./lib/oop");(function(){s.implement(this,n),this.setup=function(){var t=this,i=this.doc,e=this.session,o=(this.selectionBefore=e.selection.toJSON(),e.selection.inMultiSelectMode&&e.selection.toSingleRange(),this.pos=i.createAnchor(this.$pos.row,this.$pos.column),this.pos);o.$insertRight=!0,o.detach(),o.markerId=e.addMarker(new l(o.row,o.column,o.row,o.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach(function(e){e=i.createAnchor(e.row,e.column);e.$insertRight=!0,e.detach(),t.others.push(e)}),e.setUndoSelect(!1)},this.showOtherMarkers=function(){var t,i;this.othersActive||(t=this.session,(i=this).othersActive=!0,this.others.forEach(function(e){e.markerId=t.addMarker(new l(e.row,e.column,e.row,e.column+i.length),i.othersClass,null,!1)}))},this.hideOtherMarkers=function(){if(this.othersActive){this.othersActive=!1;for(var e=0;e<this.others.length;e++)this.session.removeMarker(this.others[e].markerId)}},this.onUpdate=function(e){if(this.$updating)return this.updateAnchors(e);var t=e;if(t.start.row===t.end.row&&t.start.row===this.pos.row){this.$updating=!0;var i="insert"===e.action?t.end.column-t.start.column:t.start.column-t.end.column,o=t.start.column>=this.pos.column&&t.start.column<=this.pos.column+this.length+1,n=t.start.column-this.pos.column;if(this.updateAnchors(e),o&&(this.length+=i),o&&!this.session.$fromUndo)if("insert"===e.action)for(var s=this.others.length-1;0<=s;s--){var a={row:(r=this.others[s]).row,column:r.column+n};this.doc.insertMergedLines(a,e.lines)}else if("remove"===e.action)for(s=this.others.length-1;0<=s;s--){var r,a={row:(r=this.others[s]).row,column:r.column+n};this.doc.remove(new l(a.row,a.column,a.row,a.column-i))}this.$updating=!1,this.updateMarkers()}},this.updateAnchors=function(e){this.pos.onChange(e);for(var t=this.others.length;t--;)this.others[t].onChange(e);this.updateMarkers()},this.updateMarkers=function(){if(!this.$updating){var i=this,o=this.session,e=function(e,t){o.removeMarker(e.markerId),e.markerId=o.addMarker(new l(e.row,e.column,e.row,e.column+i.length),t,null,!1)};e(this.pos,this.mainClass);for(var t=this.others.length;t--;)e(this.others[t],this.othersClass)}},this.onCursorChange=function(e){var t;!this.$updating&&this.session&&((t=this.session.selection.getCursor()).row===this.pos.row&&t.column>=this.pos.column&&t.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",e)):(this.hideOtherMarkers(),this._emit("cursorLeave",e)))},this.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId),this.hideOtherMarkers(),this.doc.off("change",this.$onUpdate),this.session.selection.off("changeCursor",this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},this.cancel=function(){if(-1!==this.$undoStackDepth){for(var e=this.session.getUndoManager(),t=(e.$undoStack||e.$undostack).length-this.$undoStackDepth,i=0;i<t;i++)e.undo(this.session,!0);this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}}}).call(o.prototype),t.PlaceHolder=o}),define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(e,t,i){function x(e,t){return e.row==t.row&&e.column==t.column}var C=e("../lib/event"),D=e("../lib/useragent");t.onMouseDown=function(e){var t=e.domEvent,i=t.altKey,o=t.shiftKey,n=t.ctrlKey,s=e.getAccelKey(),a=e.getButton();if(n&&D.isMac&&(a=t.button),e.editor.inMultiSelectMode&&2==a)e.editor.textInput.onContextMenu(e.domEvent);else if(n||i||s){if(0===a){var r,l,c,d,h,u,p,m,f=e.editor,g=f.selection,_=f.inMultiSelectMode,b=e.getDocumentPosition(),y=g.getCursor(),y=e.inSelection()||g.isEmpty()&&x(b,y),v=e.x,k=e.y,w=f.session,T=f.renderer.pixelToScreenCoordinates(v,k),S=T;if(f.$mouseHandler.$enableJumpToDef)n&&i||s&&i?r=o?"block":"add":i&&f.$blockSelectEnabled&&(r="block");else if(s&&!i){if(r="add",!_&&o)return}else i&&f.$blockSelectEnabled&&(r="block");if(r&&D.isMac&&t.ctrlKey&&f.$mouseHandler.cancelContextMenu(),"add"==r)!_&&y||(_||(l=g.toOrientedRange(),f.addSelectionMarker(l)),c=g.rangeList.rangeAtPoint(b),f.inVirtualSelectionMode=!0,o&&(c=null,l=g.ranges[0]||l,f.removeSelectionMarker(l)),f.once("mouseup",function(){var e=g.toOrientedRange();c&&e.isEmpty()&&x(c.cursor,e.cursor)?g.substractPoint(e.cursor):(o?g.substractPoint(l.cursor):l&&(f.removeSelectionMarker(l),g.addRange(l)),g.addRange(e)),f.inVirtualSelectionMode=!1}));else if("block"==r)return e.stop(),f.inVirtualSelectionMode=!0,h=[],u=function(){var e=f.renderer.pixelToScreenCoordinates(v,k),t=w.screenToDocumentPosition(e.row,e.column,e.offsetX);x(S,e)&&x(t,g.lead)||(S=e,f.selection.moveToPosition(t),f.renderer.scrollCursorIntoView(),f.removeSelectionMarkers(h),h=g.rectangularRangeBlock(S,T),f.$mouseHandler.$clickSelection&&1==h.length&&h[0].isEmpty()&&(h[0]=f.$mouseHandler.$clickSelection.clone()),h.forEach(f.addSelectionMarker,f),f.updateSelectionMarkers())},_&&!s?g.toSingleRange():!_&&s&&(d=g.toOrientedRange(),f.addSelectionMarker(d)),o?T=w.documentToScreenPosition(g.lead):g.moveToPosition(b),S={row:-1,column:-1},p=u,C.capture(f.container,function(e){v=e.clientX,k=e.clientY},function(e){u(),clearInterval(m),f.removeSelectionMarkers(h),h.length||(h=[g.toOrientedRange()]),d&&(f.removeSelectionMarker(d),g.toSingleRange(d));for(var t=0;t<h.length;t++)g.addRange(h[t]);f.inVirtualSelectionMode=!1,f.$mouseHandler.$clickSelection=null}),m=setInterval(function(){p()},20),e.preventDefault()}}else 0===a&&e.editor.inMultiSelectMode&&e.editor.exitMultiSelectMode()}}),define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"],function(e,t,i){t.defaultCommands=[{name:"addCursorAbove",description:"Add cursor above",exec:function(e){e.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelow",description:"Add cursor below",exec:function(e){e.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorAboveSkipCurrent",description:"Add cursor above (skip current)",exec:function(e){e.selectMoreLines(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelowSkipCurrent",description:"Add cursor below (skip current)",exec:function(e){e.selectMoreLines(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreBefore",description:"Select more before",exec:function(e){e.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",mac:"Ctrl-Alt-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreAfter",description:"Select more after",exec:function(e){e.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextBefore",description:"Select next before",exec:function(e){e.selectMore(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextAfter",description:"Select next after",exec:function(e){e.selectMore(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"toggleSplitSelectionIntoLines",description:"Split into lines",exec:function(e){1<e.multiSelect.rangeCount?e.multiSelect.joinSelections():e.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readOnly:!0},{name:"splitSelectionIntoLines",description:"Split into lines",exec:function(e){e.multiSelect.splitIntoLines()},readOnly:!0},{name:"alignCursors",description:"Align cursors",exec:function(e){e.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"},scrollIntoView:"cursor"},{name:"findAll",description:"Find all",exec:function(e){e.findAll()},bindKey:{win:"Ctrl-Alt-K",mac:"Ctrl-Alt-G"},scrollIntoView:"cursor",readOnly:!0}],t.multiSelectCommands=[{name:"singleSelection",description:"Single selection",bindKey:"esc",exec:function(e){e.exitMultiSelectMode()},scrollIntoView:"cursor",readOnly:!0,isAvailable:function(e){return e&&e.inMultiSelectMode}}];e=e("../keyboard/hash_handler").HashHandler;t.keyboardHandler=new e(t.multiSelectCommands)}),define("ace/multi_select",["require","exports","module","ace/range_list","ace/range","ace/selection","ace/mouse/multi_select_handler","ace/lib/event","ace/lib/lang","ace/commands/multi_select_commands","ace/search","ace/edit_session","ace/editor","ace/config"],function(e,n,t){function i(e){var t,i;function o(e){i&&(t.renderer.setMouseCursor(""),i=!1)}e.$multiselectOnSessionChange||(e.$onAddRange=e.$onAddRange.bind(e),e.$onRemoveRange=e.$onRemoveRange.bind(e),e.$onMultiSelect=e.$onMultiSelect.bind(e),e.$onSingleSelect=e.$onSingleSelect.bind(e),e.$multiselectOnSessionChange=n.onSessionChange.bind(e),e.$checkMultiselectChange=e.$checkMultiselectChange.bind(e),e.$multiselectOnSessionChange(e),e.on("changeSession",e.$multiselectOnSessionChange),e.on("mousedown",s),e.commands.addCommands(r.defaultCommands),(t=e).textInput&&(e=t.textInput.getElement(),i=!1,a.addListener(e,"keydown",function(e){e=18==e.keyCode&&!(e.ctrlKey||e.shiftKey||e.metaKey);t.$blockSelectEnabled&&e?i||(t.renderer.setMouseCursor("crosshair"),i=!0):i&&o()},t),a.addListener(e,"keyup",o,t),a.addListener(e,"blur",o,t)))}var o=e("./range_list").RangeList,v=e("./range").Range,u=e("./selection").Selection,s=e("./mouse/multi_select_handler").onMouseDown,a=e("./lib/event"),p=e("./lib/lang"),r=e("./commands/multi_select_commands");n.commands=r.defaultCommands.concat(r.multiSelectCommands);var l=new(e("./search").Search),c=e("./edit_session").EditSession,c=(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}.call(c.prototype),function(){this.ranges=null,this.rangeList=null,this.addRange=function(e,t){if(e){if(!this.inMultiSelectMode&&0===this.rangeCount){var i=this.toOrientedRange();if(this.rangeList.add(i),this.rangeList.add(e),2!=this.rangeList.ranges.length)return this.rangeList.removeAll(),t||this.fromOrientedRange(e);this.rangeList.removeAll(),this.rangeList.add(i),this.$onAddRange(i)}e.cursor||(e.cursor=e.end);i=this.rangeList.add(e);return this.$onAddRange(e),i.length&&this.$onRemoveRange(i),1<this.rangeCount&&!this.inMultiSelectMode&&(this._signal("multiSelect"),this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session)),t||this.fromOrientedRange(e)}},this.toSingleRange=function(e){e=e||this.ranges[0];var t=this.rangeList.removeAll();t.length&&this.$onRemoveRange(t),e&&this.fromOrientedRange(e)},this.substractPoint=function(e){e=this.rangeList.substractPoint(e);if(e)return this.$onRemoveRange(e),e[0]},this.mergeOverlappingRanges=function(){var e=this.rangeList.merge();e.length&&this.$onRemoveRange(e)},this.$onAddRange=function(e){this.rangeCount=this.rangeList.ranges.length,this.ranges.unshift(e),this._signal("addRange",{range:e})},this.$onRemoveRange=function(e){var t;this.rangeCount=this.rangeList.ranges.length,1==this.rangeCount&&this.inMultiSelectMode&&(t=this.rangeList.ranges.pop(),e.push(t),this.rangeCount=0);for(var i=e.length;i--;){var o=this.ranges.indexOf(e[i]);this.ranges.splice(o,1)}this._signal("removeRange",{ranges:e}),0===this.rangeCount&&this.inMultiSelectMode&&(this.inMultiSelectMode=!1,this._signal("singleSelect"),this.session.$undoSelect=!0,this.rangeList.detach(this.session)),(t=t||this.ranges[0])&&!t.isEqual(this.getRange())&&this.fromOrientedRange(t)},this.$initRangeList=function(){this.rangeList||(this.rangeList=new o,this.ranges=[],this.rangeCount=0)},this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]},this.splitIntoLines=function(){for(var e=this.ranges.length?this.ranges:[this.getRange()],t=[],i=0;i<e.length;i++){var o=e[i],n=o.start.row,s=o.end.row;if(n===s)t.push(o.clone());else{for(t.push(new v(n,o.start.column,n,this.session.getLine(n).length));++n<s;)t.push(this.getLineRange(n,!0));t.push(new v(s,0,s,o.end.column))}0!=i||this.isBackwards()||(t=t.reverse())}this.toSingleRange();for(i=t.length;i--;)this.addRange(t[i])},this.joinSelections=function(){var e=this.rangeList.ranges,t=e[e.length-1],e=v.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(e,t.cursor==t.start)},this.toggleBlockSelection=function(){var e,t;1<this.rangeCount?(t=(e=this.rangeList.ranges)[e.length-1],e=v.fromPoints(e[0].start,t.end),this.toSingleRange(),this.setSelectionRange(e,t.cursor==t.start)):(e=this.session.documentToScreenPosition(this.cursor),t=this.session.documentToScreenPosition(this.anchor),this.rectangularRangeBlock(e,t).forEach(this.addRange,this))},this.rectangularRangeBlock=function(e,t,i){var o,n,s,a,r,l,c,d=[],h=e.column<t.column,u=(a=h?(o=e.column,n=t.column,s=e.offsetX,t.offsetX):(o=t.column,n=e.column,s=t.offsetX,e.offsetX),e.row<t.row);l=u?(r=e.row,t.row):(r=t.row,e.row),o<0&&(o=0),(r=r<0?0:r)==l&&(i=!0);for(var p,m,f=r;f<=l;f++){var g=v.fromPoints(this.session.screenToDocumentPosition(f,o,s),this.session.screenToDocumentPosition(f,n,a));if(g.isEmpty()){if(c&&(p=g.end,m=c,p.row==m.row&&p.column==m.column))break;c=g.end}g.cursor=h?g.start:g.end,d.push(g)}if(u&&d.reverse(),!i){for(var _=d.length-1;d[_].isEmpty()&&0<_;)_--;if(0<_)for(var b=0;d[b].isEmpty();)b++;for(var y=_;b<=y;y--)d[y].isEmpty()&&d.splice(y,1)}return d}}.call(u.prototype),e("./editor").Editor);(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.addSelectionMarker=function(e){e.cursor||(e.cursor=e.end);var t=this.getSelectionStyle();return e.marker=this.session.addMarker(e,"ace_selection",t),this.session.$selectionMarkers.push(e),this.session.selectionMarkerCount=this.session.$selectionMarkers.length,e},this.removeSelectionMarker=function(e){e.marker&&(this.session.removeMarker(e.marker),-1!=(e=this.session.$selectionMarkers.indexOf(e))&&this.session.$selectionMarkers.splice(e,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length)},this.removeSelectionMarkers=function(e){for(var t=this.session.$selectionMarkers,i=e.length;i--;){var o=e[i];o.marker&&(this.session.removeMarker(o.marker),-1!=(o=t.indexOf(o))&&t.splice(o,1))}this.session.selectionMarkerCount=t.length},this.$onAddRange=function(e){this.addSelectionMarker(e.range),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onRemoveRange=function(e){this.removeSelectionMarkers(e.ranges),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onMultiSelect=function(e){this.inMultiSelectMode||(this.inMultiSelectMode=!0,this.setStyle("ace_multiselect"),this.keyBinding.addKeyboardHandler(r.keyboardHandler),this.commands.setDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers())},this.$onSingleSelect=function(e){this.session.multiSelect.inVirtualMode||(this.inMultiSelectMode=!1,this.unsetStyle("ace_multiselect"),this.keyBinding.removeKeyboardHandler(r.keyboardHandler),this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit("changeSelection"))},this.$onMultiSelectExec=function(e){var t,i=e.command,o=e.editor;if(o.multiSelect)return i.multiSelectAction?t="forEach"==i.multiSelectAction?o.forEachSelection(i,e.args):"forEachLine"==i.multiSelectAction?o.forEachSelection(i,e.args,!0):"single"==i.multiSelectAction?(o.exitMultiSelectMode(),i.exec(o,e.args||{})):i.multiSelectAction(o,e.args||{}):(t=i.exec(o,e.args||{}),o.multiSelect.addRange(o.multiSelect.toOrientedRange()),o.multiSelect.mergeOverlappingRanges()),t},this.forEachSelection=function(e,t,i){if(!this.inVirtualSelectionMode){var o,n=i&&i.keepOrder,s=1==i||i&&i.$byLines,a=this.session,i=this.selection,r=i.rangeList,l=(n?i:r).ranges;if(!l.length)return e.exec?e.exec(this,t||{}):e(this,t||{});var n=i._eventRegistry,c=(i._eventRegistry={},new u(a));this.inVirtualSelectionMode=!0;for(var d=l.length;d--;){if(s)for(;0<d&&l[d].start.row==l[d-1].end.row;)d--;c.fromOrientedRange(l[d]),c.index=d,this.selection=a.selection=c;var h=e.exec?e.exec(this,t||{}):e(this,t||{});o||void 0===h||(o=h),c.toOrientedRange(l[d])}c.detach(),this.selection=a.selection=i,this.inVirtualSelectionMode=!1,i._eventRegistry=n,i.mergeOverlappingRanges(),i.ranges[0]&&i.fromOrientedRange(i.ranges[0]);r=this.renderer.$scrollAnimation;return this.onCursorChange(),this.onSelectionChange(),r&&r.from==r.to&&this.renderer.animateScrolling(r.from),o}},this.exitMultiSelectMode=function(){this.inMultiSelectMode&&!this.inVirtualSelectionMode&&this.multiSelect.toSingleRange()},this.getSelectedText=function(){var e="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){for(var t=this.multiSelect.rangeList.ranges,i=[],o=0;o<t.length;o++)i.push(this.session.getTextRange(t[o]));var n=this.session.getDocument().getNewLineCharacter();(e=i.join(n)).length==(i.length-1)*n.length&&(e="")}else this.selection.isEmpty()||(e=this.session.getTextRange(this.getSelectionRange()));return e},this.$checkMultiselectChange=function(e,t){var i;this.inMultiSelectMode&&!this.inVirtualSelectionMode&&(i=this.multiSelect.ranges[0],this.multiSelect.isEmpty()&&t==this.multiSelect.anchor||((i=t==this.multiSelect.anchor?i.cursor==i.start?i.end:i.start:i.cursor).row!=t.row||this.session.$clipPositionToDocument(i.row,i.column).column!=t.column?this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange()):this.multiSelect.mergeOverlappingRanges()))},this.findAll=function(e,t,i){(t=t||{}).needle=e||t.needle,null==t.needle&&(o=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange(),t.needle=this.session.getTextRange(o)),this.$search.set(t);var o,n=this.$search.findAll(this.session);if(!n.length)return 0;var s=this.multiSelect;i||s.toSingleRange(n[0]);for(var a=n.length;a--;)s.addRange(n[a],!0);return o&&s.rangeList.rangeAtPoint(o.start)&&s.addRange(o,!0),n.length},this.selectMoreLines=function(e,t){var i,o,n,s=this.selection.toOrientedRange(),a=s.cursor==s.end,r=this.session.documentToScreenPosition(s.cursor),l=(this.selection.$desiredColumn&&(r.column=this.selection.$desiredColumn),this.session.screenToDocumentPosition(r.row+e,r.column));e=s.isEmpty()?l:(i=this.session.documentToScreenPosition(a?s.end:s.start),this.session.screenToDocumentPosition(i.row+e,i.column)),a?(o=v.fromPoints(l,e)).cursor=o.start:(o=v.fromPoints(e,l)).cursor=o.end,o.desiredColumn=r.column,this.selection.inMultiSelectMode?t&&(n=s.cursor):this.selection.addRange(s),this.selection.addRange(o),n&&this.selection.substractPoint(n)},this.transposeSelections=function(e){for(var t=this.session,i=t.multiSelect,o=i.ranges,n=o.length;n--;)(a=o[n]).isEmpty()&&(r=t.getWordRange(a.start.row,a.start.column),a.start.row=r.start.row,a.start.column=r.start.column,a.end.row=r.end.row,a.end.column=r.end.column);i.mergeOverlappingRanges();for(var s=[],n=o.length;n--;){var a=o[n];s.unshift(t.getTextRange(a))}e<0?s.unshift(s.pop()):s.push(s.shift());for(n=o.length;n--;){var r=(a=o[n]).clone();t.replace(a,s[n]),a.start.row=r.start.row,a.start.column=r.start.column}i.fromOrientedRange(i.ranges[0])},this.selectMore=function(e,t,i){var o,n=this.session,s=n.multiSelect.toOrientedRange();s.isEmpty()&&((s=n.getWordRange(s.start.row,s.start.column)).cursor=-1==e?s.start:s.end,this.multiSelect.addRange(s),i)||(i=n.getTextRange(s),n=n,i=i,o=e,l.$options.wrap=!0,l.$options.needle=i,l.$options.backwards=-1==o,(i=l.find(n))&&(i.cursor=-1==e?i.start:i.end,this.session.unfold(i),this.multiSelect.addRange(i),this.renderer.scrollCursorIntoView(null,.5)),t&&this.multiSelect.substractPoint(s.cursor))},this.alignCursors=function(){var n=this.session,t=n.multiSelect,e=t.ranges,i=-1,o=e.filter(function(e){if(e.cursor.row==i)return!0;i=e.cursor.row});if(e.length&&o.length!=e.length-1){o.forEach(function(e){t.substractPoint(e.cursor)});var s=0,a=1/0,r=e.map(function(e){var e=e.cursor,t=n.getLine(e.row).substr(e.column).search(/\S/g);return e.column>s&&(s=e.column),(t=-1==t?0:t)<a&&(a=t),t});e.forEach(function(e,t){var i=e.cursor,o=s-i.column,t=r[t]-a;t<o?n.insert(i,p.stringRepeat(" ",o-t)):n.remove(new v(i.row,i.column,i.row,i.column-o+t)),e.start.column=e.end.column=s,e.start.row=e.end.row=i.row,e.cursor=e.end}),t.fromOrientedRange(e[0]),this.renderer.updateCursor(),this.renderer.updateBackMarkers()}else{var o=this.selection.getRange(),l=o.start.row,c=o.end.row,e=l==c;if(e){for(var d,h=this.session.getLength();d=this.session.getLine(c),/[=:]/.test(d)&&++c<h;);for(;d=this.session.getLine(l),/[=:]/.test(d)&&0<--l;);l<0&&(l=0),h<=c&&(c=h-1)}var u=this.session.removeFullLines(l,c),u=this.$reAlignText(u,e);this.session.insert({row:l,column:0},u.join("\n")+"\n"),e||(o.start.column=0,o.end.column=u[u.length-1].length),this.selection.setRange(o)}},this.$reAlignText=function(e,t){function i(e){return p.stringRepeat(" ",e)}function o(e){return e[2]?i(n)+e[2]+i(s-e[2].length+a)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}var n,s,a,r=!0,l=!0;return e.map(function(e){var t=e.match(/(\s*)(.*?)(\s*)([=:].*)/);return t?(null==n?(n=t[1].length,s=t[2].length,a=t[3].length):(n+s+a!=t[1].length+t[2].length+t[3].length&&(l=!1),n!=t[1].length&&(r=!1),n>t[1].length&&(n=t[1].length),s<t[2].length&&(s=t[2].length),a>t[3].length&&(a=t[3].length)),t):[e]}).map(t?o:r?l?function(e){return e[2]?i(n+s-e[2].length)+e[2]+i(a)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}:o:function(e){return e[2]?i(n)+e[2]+i(a)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]})}}).call(c.prototype),n.onSessionChange=function(e){var t=e.session,e=(t&&!t.multiSelect&&(t.$selectionMarkers=[],t.selection.$initRangeList(),t.multiSelect=t.selection),this.multiSelect=t&&t.multiSelect,e.oldSession);e&&(e.multiSelect.off("addRange",this.$onAddRange),e.multiSelect.off("removeRange",this.$onRemoveRange),e.multiSelect.off("multiSelect",this.$onMultiSelect),e.multiSelect.off("singleSelect",this.$onSingleSelect),e.multiSelect.lead.off("change",this.$checkMultiselectChange),e.multiSelect.anchor.off("change",this.$checkMultiselectChange)),t&&(t.multiSelect.on("addRange",this.$onAddRange),t.multiSelect.on("removeRange",this.$onRemoveRange),t.multiSelect.on("multiSelect",this.$onMultiSelect),t.multiSelect.on("singleSelect",this.$onSingleSelect),t.multiSelect.lead.on("change",this.$checkMultiselectChange),t.multiSelect.anchor.on("change",this.$checkMultiselectChange)),t&&this.inMultiSelectMode!=t.selection.inMultiSelectMode&&(t.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())},n.MultiSelect=i,e("./config").defineOptions(c.prototype,"editor",{enableMultiselect:{set:function(e){i(this),e?(this.on("changeSession",this.$multiselectOnSessionChange),this.on("mousedown",s)):(this.off("changeSession",this.$multiselectOnSessionChange),this.off("mousedown",s))},value:!0},enableBlockSelect:{set:function(e){this.$blockSelectEnabled=e},value:!0}})}),define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"],function(e,t,i){"use strict";var d=e("../../range").Range,e=t.FoldMode=function(){};!function(){this.foldingStartMarker=null,this.foldingStopMarker=null,this.getFoldWidget=function(e,t,i){e=e.getLine(i);return this.foldingStartMarker.test(e)?"start":"markbeginend"==t&&this.foldingStopMarker&&this.foldingStopMarker.test(e)?"end":""},this.getFoldWidgetRange=function(e,t,i){return null},this.indentationBlock=function(e,t,i){var o=/\S/,n=e.getLine(t),s=n.search(o);if(-1!=s){for(var a,i=i||n.length,r=e.getLength(),n=t,l=t;++t<r;){var c=e.getLine(t).search(o);if(-1!=c){if(c<=s){c=e.getTokenAt(t,0);if(!c||"string"!==c.type)break}l=t}}return n<l?(a=e.getLine(l).length,new d(n,i,l,a)):void 0}},this.openingBracketBlock=function(e,t,i,o,n){i={row:i,column:o+1},o=e.$findClosingBracket(t,i,n);if(o)return t=e.foldWidgets[o.row],"start"==(t=null==t?e.getFoldWidget(o.row):t)&&o.row>i.row&&(o.row--,o.column=e.getLine(o.row).length),d.fromPoints(i,o)},this.closingBracketBlock=function(e,t,i,o,n){i={row:i,column:o},o=e.$findOpeningBracket(t,i);if(o)return o.column++,i.column--,d.fromPoints(o,i)}}.call(e.prototype)}),define("ace/line_widgets",["require","exports","module","ace/lib/dom"],function(e,t,i){"use strict";function o(e){this.session=e,(this.session.widgetManager=this).session.getRowLength=this.getRowLength,this.session.$getWidgetScreenLength=this.$getWidgetScreenLength,this.updateOnChange=this.updateOnChange.bind(this),this.renderWidgets=this.renderWidgets.bind(this),this.measureWidgets=this.measureWidgets.bind(this),this.session._changedWidgets=[],this.$onChangeEditor=this.$onChangeEditor.bind(this),this.session.on("change",this.updateOnChange),this.session.on("changeFold",this.updateOnFold),this.session.on("changeEditor",this.$onChangeEditor)}var n=e("./lib/dom");(function(){this.getRowLength=function(e){var t=this.lineWidgets&&this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0;return this.$useWrapMode&&this.$wrapData[e]?this.$wrapData[e].length+1+t:1+t},this.$getWidgetScreenLength=function(){var t=0;return this.lineWidgets.forEach(function(e){e&&e.rowCount&&!e.hidden&&(t+=e.rowCount)}),t},this.$onChangeEditor=function(e){this.attach(e.editor)},this.attach=function(e){e&&e.widgetManager&&e.widgetManager!=this&&e.widgetManager.detach(),this.editor!=e&&(this.detach(),(this.editor=e)&&(e.widgetManager=this,e.renderer.on("beforeRender",this.measureWidgets),e.renderer.on("afterRender",this.renderWidgets)))},this.detach=function(e){var t=this.editor;t&&(this.editor=null,t.widgetManager=null,t.renderer.off("beforeRender",this.measureWidgets),t.renderer.off("afterRender",this.renderWidgets),(t=this.session.lineWidgets)&&t.forEach(function(e){e&&e.el&&e.el.parentNode&&(e._inDocument=!1,e.el.parentNode.removeChild(e.el))}))},this.updateOnFold=function(e,t){var i=t.lineWidgets;if(i&&e.action){for(var t=e.data,o=t.start.row,n=t.end.row,s="add"==e.action,a=o+1;a<n;a++)i[a]&&(i[a].hidden=s);i[n]&&(s?i[o]?i[n].hidden=s:i[o]=i[n]:(i[o]==i[n]&&(i[o]=void 0),i[n].hidden=s))}},this.updateOnChange=function(e){var t,i,o,n=this.session.lineWidgets;n&&(t=e.start.row,0!=(i=e.end.row-t)&&("remove"==e.action?(o=n.splice(t+1,i),!n[t]&&o[o.length-1]&&(n[t]=o.pop()),o.forEach(function(e){e&&this.removeLineWidget(e)},this)):(o=new Array(i),n[t]&&null!=n[t].column&&e.start.column>n[t].column&&t++,o.unshift(t,0),n.splice.apply(n,o)),this.$updateRows()))},this.$updateRows=function(){var i,e=this.session.lineWidgets;e&&(i=!0,e.forEach(function(e,t){if(e)for(i=!1,e.row=t;e.$oldWidget;)e.$oldWidget.row=t,e=e.$oldWidget}),i&&(this.session.lineWidgets=null))},this.$registerLineWidget=function(e){this.session.lineWidgets||(this.session.lineWidgets=new Array(this.session.getLength()));var t=this.session.lineWidgets[e.row];return t&&((e.$oldWidget=t).el&&t.el.parentNode&&(t.el.parentNode.removeChild(t.el),t._inDocument=!1)),this.session.lineWidgets[e.row]=e},this.addLineWidget=function(e){var t,i,o;return this.$registerLineWidget(e),e.session=this.session,this.editor&&(t=this.editor.renderer,e.html&&!e.el&&(e.el=n.createElement("div"),e.el.innerHTML=e.html),e.el&&(n.addCssClass(e.el,"ace_lineWidgetContainer"),e.el.style.position="absolute",e.el.style.zIndex=5,t.container.appendChild(e.el),e._inDocument=!0,e.coverGutter||(e.el.style.zIndex=3),null==e.pixelHeight&&(e.pixelHeight=e.el.offsetHeight)),null==e.rowCount&&(e.rowCount=e.pixelHeight/t.layerConfig.lineHeight),i=this.session.getFoldAt(e.row,0),(e.$fold=i)&&(o=this.session.lineWidgets,e.row!=i.end.row||o[i.start.row]?e.hidden=!0:o[i.start.row]=e),this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows(),this.renderWidgets(null,t),this.onWidgetChanged(e)),e},this.removeLineWidget=function(e){if(e._inDocument=!1,e.session=null,e.el&&e.el.parentNode&&e.el.parentNode.removeChild(e.el),e.editor&&e.editor.destroy)try{e.editor.destroy()}catch(e){}if(this.session.lineWidgets){var t=this.session.lineWidgets[e.row];if(t==e)this.session.lineWidgets[e.row]=e.$oldWidget,e.$oldWidget&&this.onWidgetChanged(e.$oldWidget);else for(;t;){if(t.$oldWidget==e){t.$oldWidget=e.$oldWidget;break}t=t.$oldWidget}}this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows()},this.getWidgetsAtRow=function(e){for(var t=this.session.lineWidgets,i=t&&t[e],o=[];i;)o.push(i),i=i.$oldWidget;return o},this.onWidgetChanged=function(e){this.session._changedWidgets.push(e),this.editor&&this.editor.renderer.updateFull()},this.measureWidgets=function(e,t){var i=this.session._changedWidgets,o=t.layerConfig;if(i&&i.length){for(var n=1/0,s=0;s<i.length;s++){var a=i[s];if(a&&a.el&&a.session==this.session){if(!a._inDocument){if(this.session.lineWidgets[a.row]!=a)continue;a._inDocument=!0,t.container.appendChild(a.el)}a.h=a.el.offsetHeight,a.fixedWidth||(a.w=a.el.offsetWidth,a.screenWidth=Math.ceil(a.w/o.characterWidth));var r=a.h/o.lineHeight;a.coverLine&&((r-=this.session.getRowLineCount(a.row))<0&&(r=0)),a.rowCount!=r&&(a.rowCount=r,a.row<n&&(n=a.row))}}n!=1/0&&(this.session._emit("changeFold",{data:{start:{row:n}}}),this.session.lineWidgetWidth=null),this.session._changedWidgets=[]}},this.renderWidgets=function(e,t){var i=t.layerConfig,o=this.session.lineWidgets;if(o){for(var n=Math.min(this.firstRow,i.firstRow),s=Math.max(this.lastRow,i.lastRow,o.length);0<n&&!o[n];)n--;this.firstRow=i.firstRow,this.lastRow=i.lastRow,t.$cursorLayer.config=i;for(var a=n;a<=s;a++){var r,l=o[a];l&&l.el&&(l.hidden?l.el.style.top=-100-(l.pixelHeight||0)+"px":(l._inDocument||(l._inDocument=!0,t.container.appendChild(l.el)),r=t.$cursorLayer.getPixelPosition({row:a,column:0},!0).top,l.coverLine||(r+=i.lineHeight*this.session.getRowLineCount(l.row)),l.el.style.top=r-i.offset+"px",r=l.coverGutter?0:t.gutterWidth,l.fixedWidth||(r-=t.scrollLeft),l.el.style.left=r+"px",l.fullWidth&&l.screenWidth&&(l.el.style.minWidth=i.width+2*i.padding+"px"),l.fixedWidth?l.el.style.right=t.scrollBar.getWidth()+"px":l.el.style.right=""))}}}}).call(o.prototype),t.LineWidgets=o}),define("ace/ext/error_marker",["require","exports","module","ace/line_widgets","ace/lib/dom","ace/range"],function(e,t,i){"use strict";function c(e,t,i){var o=e.getAnnotations().sort(r.comparePoints);if(o.length){var n=function(e,t,i){for(var o=0,n=e.length-1;o<=n;){var s=o+n>>1,a=i(t,e[s]);if(0<a)o=1+s;else{if(!(a<0))return s;n=s-1}}return-(o+1)}(o,{row:t,column:-1},r.comparePoints),s=((n=n<0?-n-1:n)>=o.length?n=0<i?0:o.length-1:0===n&&i<0&&(n=o.length-1),o[n]);if(s&&i){if(s.row===t){for(;(s=o[n+=i])&&s.row===t;);if(!s)return o.slice()}var a=[];for(t=s.row;a[i<0?"unshift":"push"](s),(s=o[n+=i])&&s.row==t;);return a.length&&a}}}var d=e("../line_widgets").LineWidgets,h=e("../lib/dom"),r=e("../range").Range;t.showErrorMarker=function(e,t){var i,o=e.session,n=(o.widgetManager||(o.widgetManager=new d(o),o.widgetManager.attach(e)),e.getCursorPosition()),s=n.row,a=o.widgetManager.getWidgetsAtRow(s).filter(function(e){return"errorMarker"==e.type})[0],s=(a?a.destroy():s-=t,c(o,s,t));if(s){t=s[0];n.column=(t.pos&&"number"!=typeof t.column?t.pos.sc:t.column)||0,n.row=t.row,i=e.renderer.$gutterLayer.$annotations[n.row]}else{if(a)return;i={text:["Looks good!"],className:"ace_ok"}}e.session.unfold(n.row),e.selection.moveToPosition(n);function r(e,t,i){if(0===t&&("esc"===i||"return"===i))return l.destroy(),{command:"null"}}var l={row:n.row,fixedWidth:!0,coverGutter:!0,el:h.createElement("div"),type:"errorMarker"},s=l.el.appendChild(h.createElement("div")),t=l.el.appendChild(h.createElement("div")),a=(t.className="error_widget_arrow "+i.className,e.renderer.$cursorLayer.getPixelPosition(n).left);t.style.left=a+e.renderer.gutterWidth-5+"px",l.el.className="error_widget_wrapper",s.className="error_widget "+i.className,s.innerHTML=i.text.join("<br>"),s.appendChild(h.createElement("div"));l.destroy=function(){e.$mouseHandler.isMousePressed||(e.keyBinding.removeKeyboardHandler(r),o.widgetManager.removeLineWidget(l),e.off("changeSelection",l.destroy),e.off("changeSession",l.destroy),e.off("mouseup",l.destroy),e.off("change",l.destroy))},e.keyBinding.addKeyboardHandler(r),e.on("changeSelection",l.destroy),e.on("changeSession",l.destroy),e.on("mouseup",l.destroy),e.on("change",l.destroy),e.session.widgetManager.addLineWidget(l),l.el.onmousedown=e.focus.bind(e),e.renderer.scrollCursorIntoView(null,.5,{bottom:l.el.offsetHeight})},h.importCssString("\n    .error_widget_wrapper {\n        background: inherit;\n        color: inherit;\n        border:none\n    }\n    .error_widget {\n        border-top: solid 2px;\n        border-bottom: solid 2px;\n        margin: 5px 0;\n        padding: 10px 40px;\n        white-space: pre-wrap;\n    }\n    .error_widget.ace_error, .error_widget_arrow.ace_error{\n        border-color: #ff5a5a\n    }\n    .error_widget.ace_warning, .error_widget_arrow.ace_warning{\n        border-color: #F1D817\n    }\n    .error_widget.ace_info, .error_widget_arrow.ace_info{\n        border-color: #5a5a5a\n    }\n    .error_widget.ace_ok, .error_widget_arrow.ace_ok{\n        border-color: #5aaa5a\n    }\n    .error_widget_arrow {\n        position: absolute;\n        border: solid 5px;\n        border-top-color: transparent!important;\n        border-right-color: transparent!important;\n        border-left-color: transparent!important;\n        top: -5px;\n    }\n","error_marker.css",!1)}),define("ace/ace",["require","exports","module","ace/lib/dom","ace/lib/event","ace/range","ace/editor","ace/edit_session","ace/undomanager","ace/virtual_renderer","ace/worker/worker_client","ace/keyboard/hash_handler","ace/placeholder","ace/multi_select","ace/mode/folding/fold_mode","ace/theme/textmate","ace/ext/error_marker","ace/config","ace/loader_build"],function(e,s,t){"use strict";e("./loader_build")(s);var a=e("./lib/dom"),r=e("./lib/event"),i=e("./range").Range,l=e("./editor").Editor,o=e("./edit_session").EditSession,n=e("./undomanager").UndoManager,c=e("./virtual_renderer").VirtualRenderer;e("./worker/worker_client"),e("./keyboard/hash_handler"),e("./placeholder"),e("./multi_select"),e("./mode/folding/fold_mode"),e("./theme/textmate"),e("./ext/error_marker"),s.config=e("./config"),s.edit=function(e,t){if("string"==typeof e){var i=e;if(!(e=document.getElementById(i)))throw new Error("ace.edit can't find div #"+i)}if(e&&e.env&&e.env.editor instanceof l)return e.env.editor;var o,i="",i=(e&&/input|textarea/i.test(e.tagName)?(i=(o=e).value,e=a.createElement("pre"),o.parentNode.replaceChild(e,o)):e&&(i=e.textContent,e.innerHTML=""),s.createEditSession(i)),e=new l(new c(e),i,t),n={document:i,editor:e,onResize:e.resize.bind(e,null)};return o&&(n.textarea=o),r.addListener(window,"resize",n.onResize),e.on("destroy",function(){r.removeListener(window,"resize",n.onResize),n.editor.container.env=null}),e.container.env=e.env=n,e},s.createEditSession=function(e,t){e=new o(e,t);return e.setUndoManager(new n),e},s.Range=i,s.Editor=l,s.EditSession=o,s.UndoManager=n,s.VirtualRenderer=c,s.version=s.config.version}),window.require(["ace/ace"],function(e){for(var t in e&&(e.config.init(!0),e.define=window.define),window.ace||(window.ace=e),e)e.hasOwnProperty(t)&&(window.ace[t]=e[t]);window.ace.default=window.ace,"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=window.ace)}),define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(e,t,i){"use strict";function o(){var e=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":"abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|bin|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|apply|delattr|help|next|setattr|set|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern|ascii|breakpoint|bytes","variable.language":"self|cls","constant.language":"True|False|None|NotImplemented|Ellipsis|__debug__",keyword:"and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield|async|await|nonlocal"},"identifier"),t="[uU]?",i="(?:[rR][fF]|[fF][rR])",o="(?:(?:(?:[1-9]\\d*)|(?:0))|(?:0[oO]?[0-7]+)|(?:0[xX][\\dA-Fa-f]+)|(?:0[bB][01]+))",n="(?:(?:(?:(?:(?:(?:\\d+)?(?:\\.\\d+))|(?:(?:\\d+)\\.))|(?:\\d+))(?:[eE][+-]?\\d+))|"+(n="(?:(?:"+(n="(?:\\d+)")+"?(?:\\.\\d+))|(?:"+n+"\\.))")+")",s="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:t+'"{3}',next:"qqstring3"},{token:"string",regex:t+'"(?=.)',next:"qqstring"},{token:"string",regex:t+"'{3}",next:"qstring3"},{token:"string",regex:t+"'(?=.)",next:"qstring"},{token:"string",regex:'[rR]"{3}',next:"rawqqstring3"},{token:"string",regex:'[rR]"(?=.)',next:"rawqqstring"},{token:"string",regex:"[rR]'{3}",next:"rawqstring3"},{token:"string",regex:"[rR]'(?=.)",next:"rawqstring"},{token:"string",regex:'[fF]"{3}',next:"fqqstring3"},{token:"string",regex:'[fF]"(?=.)',next:"fqqstring"},{token:"string",regex:"[fF]'{3}",next:"fqstring3"},{token:"string",regex:"[fF]'(?=.)",next:"fqstring"},{token:"string",regex:i+'"{3}',next:"rfqqstring3"},{token:"string",regex:i+'"(?=.)',next:"rfqqstring"},{token:"string",regex:i+"'{3}",next:"rfqstring3"},{token:"string",regex:i+"'(?=.)",next:"rfqstring"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|@|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"punctuation",regex:",|:|;|\\->|\\+=|\\-=|\\*=|\\/=|\\/\\/=|%=|@=|&=|\\|=|^=|>>=|<<=|\\*\\*="},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:["keyword","text","entity.name.function"],regex:"(def|class)(\\s+)([\\u00BF-\\u1FFF\\u2C00-\\uD7FF\\w]+)"},{token:"text",regex:"\\s+"},{include:"constants"}],qqstring3:[{token:"constant.language.escape",regex:s},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:s},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:s},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:s},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}],rawqqstring3:[{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],rawqstring3:[{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],rawqqstring:[{token:"string",regex:"\\\\$",next:"rawqqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],rawqstring:[{token:"string",regex:"\\\\$",next:"rawqstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}],fqqstring3:[{token:"constant.language.escape",regex:s},{token:"string",regex:'"{3}',next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],fqstring3:[{token:"constant.language.escape",regex:s},{token:"string",regex:"'{3}",next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],fqqstring:[{token:"constant.language.escape",regex:s},{token:"string",regex:"\\\\$",next:"fqqstring"},{token:"string",regex:'"|$',next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],fqstring:[{token:"constant.language.escape",regex:s},{token:"string",regex:"'|$",next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],rfqqstring3:[{token:"string",regex:'"{3}',next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],rfqstring3:[{token:"string",regex:"'{3}",next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],rfqqstring:[{token:"string",regex:"\\\\$",next:"rfqqstring"},{token:"string",regex:'"|$',next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],rfqstring:[{token:"string",regex:"'|$",next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],fqstringParRules:[{token:"paren.lparen",regex:"[\\[\\(]"},{token:"paren.rparen",regex:"[\\]\\)]"},{token:"string",regex:"\\s+"},{token:"string",regex:"'[^']*'"},{token:"string",regex:'"[^"]*"'},{token:"function.support",regex:"(!s|!r|!a)"},{include:"constants"},{token:"paren.rparen",regex:"}",next:"pop"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"}],constants:[{token:"constant.numeric",regex:"(?:"+n+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:n},{token:"constant.numeric",regex:o+"[lL]\\b"},{token:"constant.numeric",regex:o+"\\b"},{token:["punctuation","function.support"],regex:"(\\.)([a-zA-Z_]+)\\b"},{token:e,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"}]},this.normalizeRules()}var n=e("../lib/oop"),e=e("./text_highlight_rules").TextHighlightRules;n.inherits(o,e),t.PythonHighlightRules=o}),define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(e,t,i){"use strict";var o=e("../../lib/oop"),e=e("./fold_mode").FoldMode,t=t.FoldMode=function(e){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+e+")(?:\\s*)(?:#.*)?$")};o.inherits(t,e),function(){this.getFoldWidgetRange=function(e,t,i){var o=e.getLine(i).match(this.foldingStartMarker);if(o)return o[1]?this.openingBracketBlock(e,o[1],i,o.index):o[2]?this.indentationBlock(e,i,o.index+o[2].length):this.indentationBlock(e,i)}}.call(t.prototype)}),define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(e,t,i){"use strict";function o(){this.HighlightRules=a,this.foldingRules=new r("\\:"),this.$behaviour=this.$defaultBehaviour}var n=e("../lib/oop"),s=e("./text").Mode,a=e("./python_highlight_rules").PythonHighlightRules,r=e("./folding/pythonic").FoldMode,l=e("../range").Range;n.inherits(o,s),function(){this.lineCommentStart="#",this.getNextLineIndent=function(e,t,i){var o=this.$getIndent(t),n=this.getTokenizer().getLineTokens(t,e).tokens;return n.length&&"comment"==n[n.length-1].type||"start"==e&&t.match(/^.*[\{\(\[:]\s*$/)&&(o+=i),o};var s={pass:1,return:1,raise:1,break:1,continue:1};this.checkOutdent=function(e,t,i){if("\r\n"!==i&&"\r"!==i&&"\n"!==i)return!1;var o=this.getTokenizer().getLineTokens(t.trim(),e).tokens;if(!o)return!1;do{var n=o.pop()}while(n&&("comment"==n.type||"text"==n.type&&n.value.match(/^\s+$/)));return!!n&&("keyword"==n.type&&s[n.value])},this.autoOutdent=function(e,t,i){var o=this.$getIndent(t.getLine(i+=1)),n=t.getTabString();o.slice(-n.length)==n&&t.remove(new l(i,o.length-n.length,i,o.length))},this.$id="ace/mode/python",this.snippetFileId="ace/snippets/python"}.call(o.prototype),t.Mode=o}),window.require(["ace/mode/python"],function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)}),define("ace/theme/chrome.css",["require","exports","module"],function(e,t,i){i.exports='.ace-chrome .ace_gutter {\n  background: #ebebeb;\n  color: #333;\n  overflow : hidden;\n}\n\n.ace-chrome .ace_print-margin {\n  width: 1px;\n  background: #e8e8e8;\n}\n\n.ace-chrome {\n  background-color: #FFFFFF;\n  color: black;\n}\n\n.ace-chrome .ace_cursor {\n  color: black;\n}\n\n.ace-chrome .ace_invisible {\n  color: rgb(191, 191, 191);\n}\n\n.ace-chrome .ace_constant.ace_buildin {\n  color: rgb(88, 72, 246);\n}\n\n.ace-chrome .ace_constant.ace_language {\n  color: rgb(88, 92, 246);\n}\n\n.ace-chrome .ace_constant.ace_library {\n  color: rgb(6, 150, 14);\n}\n\n.ace-chrome .ace_invalid {\n  background-color: rgb(153, 0, 0);\n  color: white;\n}\n\n.ace-chrome .ace_fold {\n}\n\n.ace-chrome .ace_support.ace_function {\n  color: rgb(60, 76, 114);\n}\n\n.ace-chrome .ace_support.ace_constant {\n  color: rgb(6, 150, 14);\n}\n\n.ace-chrome .ace_support.ace_type,\n.ace-chrome .ace_support.ace_class\n.ace-chrome .ace_support.ace_other {\n  color: rgb(109, 121, 222);\n}\n\n.ace-chrome .ace_variable.ace_parameter {\n  font-style:italic;\n  color:#FD971F;\n}\n.ace-chrome .ace_keyword.ace_operator {\n  color: rgb(104, 118, 135);\n}\n\n.ace-chrome .ace_comment {\n  color: #236e24;\n}\n\n.ace-chrome .ace_comment.ace_doc {\n  color: #236e24;\n}\n\n.ace-chrome .ace_comment.ace_doc.ace_tag {\n  color: #236e24;\n}\n\n.ace-chrome .ace_constant.ace_numeric {\n  color: rgb(0, 0, 205);\n}\n\n.ace-chrome .ace_variable {\n  color: rgb(49, 132, 149);\n}\n\n.ace-chrome .ace_xml-pe {\n  color: rgb(104, 104, 91);\n}\n\n.ace-chrome .ace_entity.ace_name.ace_function {\n  color: #0000A2;\n}\n\n\n.ace-chrome .ace_heading {\n  color: rgb(12, 7, 255);\n}\n\n.ace-chrome .ace_list {\n  color:rgb(185, 6, 144);\n}\n\n.ace-chrome .ace_marker-layer .ace_selection {\n  background: rgb(181, 213, 255);\n}\n\n.ace-chrome .ace_marker-layer .ace_step {\n  background: rgb(252, 255, 0);\n}\n\n.ace-chrome .ace_marker-layer .ace_stack {\n  background: rgb(164, 229, 101);\n}\n\n.ace-chrome .ace_marker-layer .ace_bracket {\n  margin: -1px 0 0 -1px;\n  border: 1px solid rgb(192, 192, 192);\n}\n\n.ace-chrome .ace_marker-layer .ace_active-line {\n  background: rgba(0, 0, 0, 0.07);\n}\n\n.ace-chrome .ace_gutter-active-line {\n    background-color : #dcdcdc;\n}\n\n.ace-chrome .ace_marker-layer .ace_selected-word {\n  background: rgb(250, 250, 255);\n  border: 1px solid rgb(200, 200, 250);\n}\n\n.ace-chrome .ace_storage,\n.ace-chrome .ace_keyword,\n.ace-chrome .ace_meta.ace_tag {\n  color: rgb(147, 15, 128);\n}\n\n.ace-chrome .ace_string.ace_regex {\n  color: rgb(255, 0, 0)\n}\n\n.ace-chrome .ace_string {\n  color: #1A1AA6;\n}\n\n.ace-chrome .ace_entity.ace_other.ace_attribute-name {\n  color: #994409;\n}\n\n.ace-chrome .ace_indent-guide {\n  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;\n}\n  \n.ace-chrome .ace_indent-guide-active {\n  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAAZSURBVHjaYvj///9/hivKyv8BAAAA//8DACLqBhbvk+/eAAAAAElFTkSuQmCC") right repeat-y;\n}\n'}),define("ace/theme/chrome",["require","exports","module","ace/theme/chrome.css","ace/lib/dom"],function(e,t,i){t.isDark=!1,t.cssClass="ace-chrome",t.cssText=e("./chrome.css"),e("../lib/dom").importCssString(t.cssText,t.cssClass,!1)}),window.require(["ace/theme/chrome"],function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)}),!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(e.document)return t(e);throw new Error("jQuery requires a window with a document")}:t(e)}("undefined"!=typeof window?window:this,function(w,O){"use strict";function b(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item}function f(e){return null!=e&&e===e.window}var t=[],N=Object.getPrototypeOf,r=t.slice,F=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},B=t.push,$=t.indexOf,W={},H=W.toString,z=W.hasOwnProperty,U=z.toString,V=U.call(Object),g={},T=w.document,q={type:!0,src:!0,nonce:!0,noModule:!0};function G(e,t,i){var o,n,s=(i=i||T).createElement("script");if(s.text=e,t)for(o in q)(n=t[o]||t.getAttribute&&t.getAttribute(o))&&s.setAttribute(o,n);i.head.appendChild(s).parentNode.removeChild(s)}function m(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?W[H.call(e)]||"object":typeof e}var S=function(e,t){return new S.fn.init(e,t)};function K(e){var t=!!e&&"length"in e&&e.length,i=m(e);return!b(e)&&!f(e)&&("array"===i||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:"3.6.0",constructor:S,length:0,toArray:function(){return r.call(this)},get:function(e){return null==e?r.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){e=S.merge(this.constructor(),e);return e.prevObject=this,e},each:function(e){return S.each(this,e)},map:function(i){return this.pushStack(S.map(this,function(e,t){return i.call(e,t,e)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,e=+e+(e<0?t:0);return this.pushStack(0<=e&&e<t?[this[e]]:[])},end:function(){return this.prevObject||this.constructor()},push:B,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,i,o,n,s=arguments[0]||{},a=1,r=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[a]||{},a++),"object"==typeof s||b(s)||(s={}),a===r&&(s=this,a--);a<r;a++)if(null!=(e=arguments[a]))for(t in e)i=e[t],"__proto__"!==t&&s!==i&&(l&&i&&(S.isPlainObject(i)||(o=Array.isArray(i)))?(n=s[t],n=o&&!Array.isArray(n)?[]:o||S.isPlainObject(n)?n:{},o=!1,s[t]=S.extend(l,n,i)):void 0!==i&&(s[t]=i));return s},S.extend({expando:"jQuery"+("3.6.0"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){return!(!e||"[object Object]"!==H.call(e)||(e=N(e))&&("function"!=typeof(e=z.call(e,"constructor")&&e.constructor)||U.call(e)!==V))},isEmptyObject:function(e){for(var t in e)return!1;return!0},globalEval:function(e,t,i){G(e,{nonce:t&&t.nonce},i)},each:function(e,t){var i,o=0;if(K(e))for(i=e.length;o<i&&!1!==t.call(e[o],o,e[o]);o++);else for(o in e)if(!1===t.call(e[o],o,e[o]))break;return e},makeArray:function(e,t){t=t||[];return null!=e&&(K(Object(e))?S.merge(t,"string"==typeof e?[e]:e):B.call(t,e)),t},inArray:function(e,t,i){return null==t?-1:$.call(t,e,i)},merge:function(e,t){for(var i=+t.length,o=0,n=e.length;o<i;o++)e[n++]=t[o];return e.length=n,e},grep:function(e,t,i){for(var o=[],n=0,s=e.length,a=!i;n<s;n++)!t(e[n],n)!=a&&o.push(e[n]);return o},map:function(e,t,i){var o,n,s=0,a=[];if(K(e))for(o=e.length;s<o;s++)null!=(n=t(e[s],s,i))&&a.push(n);else for(s in e)null!=(n=t(e[s],s,i))&&a.push(n);return F(a)},guid:1,support:g}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){W["[object "+t+"]"]=t.toLowerCase()});function o(e,t,i){for(var o=[],n=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&S(e).is(i))break;o.push(e)}return o}function X(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}var e=function(O){function h(e,t){return e="0x"+e.slice(1)-65536,t||(e<0?String.fromCharCode(65536+e):String.fromCharCode(e>>10|55296,1023&e|56320))}function N(e,t){return t?"\0"===e?"":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}function F(){w()}var e,u,v,s,B,p,$,W,k,l,c,w,T,i,S,m,o,n,f,x="sizzle"+ +new Date,d=O.document,C=0,H=0,z=R(),U=R(),V=R(),g=R(),q=function(e,t){return e===t&&(c=!0),0},G={}.hasOwnProperty,t=[],K=t.pop,X=t.push,D=t.push,Y=t.slice,b=function(e,t){for(var i=0,o=e.length;i<o;i++)if(e[i]===t)return i;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",a="[\\x20\\t\\r\\n\\f]",r="(?:\\\\[\\da-fA-F]{1,6}"+a+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Z="\\["+a+"*("+r+")(?:"+a+"*([*^$|!~]?=)"+a+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+r+"))|)"+a+"*\\]",Q=":("+r+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+Z+")*)|.*)\\)|)",ee=new RegExp(a+"+","g"),_=new RegExp("^"+a+"+|((?:^|[^\\\\])(?:\\\\.)*)"+a+"+$","g"),te=new RegExp("^"+a+"*,"+a+"*"),ie=new RegExp("^"+a+"*([>+~]|"+a+")"+a+"*"),oe=new RegExp(a+"|>"),ne=new RegExp(Q),se=new RegExp("^"+r+"$"),y={ID:new RegExp("^#("+r+")"),CLASS:new RegExp("^\\.("+r+")"),TAG:new RegExp("^("+r+"|[*])"),ATTR:new RegExp("^"+Z),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+a+"*(even|odd|(([+-]|)(\\d*)n|)"+a+"*(?:([+-]|)"+a+"*(\\d+)|))"+a+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+a+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+a+"*((?:-\\d)?\\d*)"+a+"*\\)|)(?=[^-]|$)","i")},ae=/HTML$/i,re=/^(?:input|select|textarea|button)$/i,le=/^h\d$/i,L=/^[^{]+\{\s*\[native \w/,ce=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,de=/[+~]/,A=new RegExp("\\\\[\\da-fA-F]{1,6}"+a+"?|\\\\([^\\r\\n\\f])","g"),he=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ue=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{D.apply(t=Y.call(d.childNodes),d.childNodes),t[d.childNodes.length].nodeType}catch(e){D={apply:t.length?function(e,t){X.apply(e,Y.call(t))}:function(e,t){for(var i=e.length,o=0;e[i++]=t[o++];);e.length=i-1}}}function I(e,t,i,o){var n,s,a,r,l,c,d=t&&t.ownerDocument,h=t?t.nodeType:9;if(i=i||[],"string"!=typeof e||!e||1!==h&&9!==h&&11!==h)return i;if(!o&&(w(t),t=t||T,S)){if(11!==h&&(r=ce.exec(e)))if(n=r[1]){if(9===h){if(!(c=t.getElementById(n)))return i;if(c.id===n)return i.push(c),i}else if(d&&(c=d.getElementById(n))&&f(t,c)&&c.id===n)return i.push(c),i}else{if(r[2])return D.apply(i,t.getElementsByTagName(e)),i;if((n=r[3])&&u.getElementsByClassName&&t.getElementsByClassName)return D.apply(i,t.getElementsByClassName(n)),i}if(u.qsa&&!g[e+" "]&&(!m||!m.test(e))&&(1!==h||"object"!==t.nodeName.toLowerCase())){if(c=e,d=t,1===h&&(oe.test(e)||ie.test(e))){for((d=de.test(e)&&ge(t.parentNode)||t)===t&&u.scope||((a=t.getAttribute("id"))?a=a.replace(he,N):t.setAttribute("id",a=x)),s=(l=p(e)).length;s--;)l[s]=(a?"#"+a:":scope")+" "+j(l[s]);c=l.join(",")}try{return D.apply(i,d.querySelectorAll(c)),i}catch(t){g(e,!0)}finally{a===x&&t.removeAttribute("id")}}}return W(e.replace(_,"$1"),t,i,o)}function R(){var o=[];return function e(t,i){return o.push(t+" ")>v.cacheLength&&delete e[o.shift()],e[t+" "]=i}}function E(e){return e[x]=!0,e}function P(e){var t=T.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t)}}function pe(e,t){for(var i=e.split("|"),o=i.length;o--;)v.attrHandle[i[o]]=t}function me(e,t){var i=t&&e,o=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(o)return o;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function fe(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ue(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function M(a){return E(function(s){return s=+s,E(function(e,t){for(var i,o=a([],e.length,s),n=o.length;n--;)e[i=o[n]]&&(e[i]=!(t[i]=e[i]))})})}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(e in u=I.support={},B=I.isXML=function(e){var t=e&&e.namespaceURI,e=e&&(e.ownerDocument||e).documentElement;return!ae.test(t||e&&e.nodeName||"HTML")},w=I.setDocument=function(e){var e=e?e.ownerDocument||e:d;return e!=T&&9===e.nodeType&&e.documentElement&&(i=(T=e).documentElement,S=!B(T),d!=T&&(e=T.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",F,!1):e.attachEvent&&e.attachEvent("onunload",F)),u.scope=P(function(e){return i.appendChild(e).appendChild(T.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),u.attributes=P(function(e){return e.className="i",!e.getAttribute("className")}),u.getElementsByTagName=P(function(e){return e.appendChild(T.createComment("")),!e.getElementsByTagName("*").length}),u.getElementsByClassName=L.test(T.getElementsByClassName),u.getById=P(function(e){return i.appendChild(e).id=x,!T.getElementsByName||!T.getElementsByName(x).length}),u.getById?(v.filter.ID=function(e){var t=e.replace(A,h);return function(e){return e.getAttribute("id")===t}},v.find.ID=function(e,t){if(void 0!==t.getElementById&&S)return(t=t.getElementById(e))?[t]:[]}):(v.filter.ID=function(e){var t=e.replace(A,h);return function(e){e=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return e&&e.value===t}},v.find.ID=function(e,t){if(void 0!==t.getElementById&&S){var i,o,n,s=t.getElementById(e);if(s){if((i=s.getAttributeNode("id"))&&i.value===e)return[s];for(n=t.getElementsByName(e),o=0;s=n[o++];)if((i=s.getAttributeNode("id"))&&i.value===e)return[s]}return[]}}),v.find.TAG=u.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):u.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,o=[],n=0,s=t.getElementsByTagName(e);if("*"!==e)return s;for(;i=s[n++];)1===i.nodeType&&o.push(i);return o},v.find.CLASS=u.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&S)return t.getElementsByClassName(e)},o=[],m=[],(u.qsa=L.test(T.querySelectorAll))&&(P(function(e){var t;i.appendChild(e).innerHTML="<a id='"+x+"'></a><select id='"+x+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+a+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+a+"*(?:value|"+J+")"),e.querySelectorAll("[id~="+x+"-]").length||m.push("~="),(t=T.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\["+a+"*name"+a+"*="+a+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+x+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")}),P(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=T.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+a+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),i.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(u.matchesSelector=L.test(n=i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.oMatchesSelector||i.msMatchesSelector))&&P(function(e){u.disconnectedMatch=n.call(e,"*"),n.call(e,"[s!='']:x"),o.push("!=",Q)}),m=m.length&&new RegExp(m.join("|")),o=o.length&&new RegExp(o.join("|")),e=L.test(i.compareDocumentPosition),f=e||L.test(i.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,t=t&&t.parentNode;return e===t||!(!t||1!==t.nodeType||!(i.contains?i.contains(t):e.compareDocumentPosition&&16&e.compareDocumentPosition(t)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},q=e?function(e,t){return e===t?(c=!0,0):!e.compareDocumentPosition-!t.compareDocumentPosition||(1&(i=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!u.sortDetached&&t.compareDocumentPosition(e)===i?e==T||e.ownerDocument==d&&f(d,e)?-1:t==T||t.ownerDocument==d&&f(d,t)?1:l?b(l,e)-b(l,t):0:4&i?-1:1);var i}:function(e,t){if(e===t)return c=!0,0;var i,o=0,n=e.parentNode,s=t.parentNode,a=[e],r=[t];if(!n||!s)return e==T?-1:t==T?1:n?-1:s?1:l?b(l,e)-b(l,t):0;if(n===s)return me(e,t);for(i=e;i=i.parentNode;)a.unshift(i);for(i=t;i=i.parentNode;)r.unshift(i);for(;a[o]===r[o];)o++;return o?me(a[o],r[o]):a[o]==d?-1:r[o]==d?1:0}),T},I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){if(w(e),u.matchesSelector&&S&&!g[t+" "]&&(!o||!o.test(t))&&(!m||!m.test(t)))try{var i=n.call(e,t);if(i||u.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(e){g(t,!0)}return 0<I(t,T,null,[e]).length},I.contains=function(e,t){return(e.ownerDocument||e)!=T&&w(e),f(e,t)},I.attr=function(e,t){(e.ownerDocument||e)!=T&&w(e);var i=v.attrHandle[t.toLowerCase()],i=i&&G.call(v.attrHandle,t.toLowerCase())?i(e,t,!S):void 0;return void 0!==i?i:u.attributes||!S?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},I.escape=function(e){return(e+"").replace(he,N)},I.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},I.uniqueSort=function(e){var t,i=[],o=0,n=0;if(c=!u.detectDuplicates,l=!u.sortStable&&e.slice(0),e.sort(q),c){for(;t=e[n++];)t===e[n]&&(o=i.push(n));for(;o--;)e.splice(i[o],1)}return l=null,e},s=I.getText=function(e){var t,i="",o=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=s(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[o++];)i+=s(t);return i},(v=I.selectors={cacheLength:50,createPseudo:E,match:y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(A,h),e[3]=(e[3]||e[4]||e[5]||"").replace(A,h),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||I.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&I.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return y.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&ne.test(i)&&(t=p(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(A,h).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=z[e+" "];return t||(t=new RegExp("(^|"+a+")"+e+"("+a+"|$)"))&&z(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(t,i,o){return function(e){e=I.attr(e,t);return null==e?"!="===i:!i||(e+="","="===i?e===o:"!="===i?e!==o:"^="===i?o&&0===e.indexOf(o):"*="===i?o&&-1<e.indexOf(o):"$="===i?o&&e.slice(-o.length)===o:"~="===i?-1<(" "+e.replace(ee," ")+" ").indexOf(o):"|="===i&&(e===o||e.slice(0,o.length+1)===o+"-"))}},CHILD:function(m,e,t,f,g){var _="nth"!==m.slice(0,3),b="last"!==m.slice(-4),y="of-type"===e;return 1===f&&0===g?function(e){return!!e.parentNode}:function(e,t,i){var o,n,s,a,r,l,c=_!=b?"nextSibling":"previousSibling",d=e.parentNode,h=y&&e.nodeName.toLowerCase(),u=!i&&!y,p=!1;if(d){if(_){for(;c;){for(a=e;a=a[c];)if(y?a.nodeName.toLowerCase()===h:1===a.nodeType)return!1;l=c="only"===m&&!l&&"nextSibling"}return!0}if(l=[b?d.firstChild:d.lastChild],b&&u){for(p=(r=(o=(n=(s=(a=d)[x]||(a[x]={}))[a.uniqueID]||(s[a.uniqueID]={}))[m]||[])[0]===C&&o[1])&&o[2],a=r&&d.childNodes[r];a=++r&&a&&a[c]||(p=r=0)||l.pop();)if(1===a.nodeType&&++p&&a===e){n[m]=[C,r,p];break}}else if(!1===(p=u?r=(o=(n=(s=(a=e)[x]||(a[x]={}))[a.uniqueID]||(s[a.uniqueID]={}))[m]||[])[0]===C&&o[1]:p))for(;(a=++r&&a&&a[c]||(p=r=0)||l.pop())&&((y?a.nodeName.toLowerCase()!==h:1!==a.nodeType)||!++p||(u&&((n=(s=a[x]||(a[x]={}))[a.uniqueID]||(s[a.uniqueID]={}))[m]=[C,p]),a!==e)););return(p-=g)===f||p%f==0&&0<=p/f}}},PSEUDO:function(e,s){var t,a=v.pseudos[e]||v.setFilters[e.toLowerCase()]||I.error("unsupported pseudo: "+e);return a[x]?a(s):1<a.length?(t=[e,e,"",s],v.setFilters.hasOwnProperty(e.toLowerCase())?E(function(e,t){for(var i,o=a(e,s),n=o.length;n--;)e[i=b(e,o[n])]=!(t[i]=o[n])}):function(e){return a(e,0,t)}):a}},pseudos:{not:E(function(e){var o=[],n=[],r=$(e.replace(_,"$1"));return r[x]?E(function(e,t,i,o){for(var n,s=r(e,null,o,[]),a=e.length;a--;)(n=s[a])&&(e[a]=!(t[a]=n))}):function(e,t,i){return o[0]=e,r(o,null,i,n),o[0]=null,!n.pop()}}),has:E(function(t){return function(e){return 0<I(t,e).length}}),contains:E(function(t){return t=t.replace(A,h),function(e){return-1<(e.textContent||s(e)).indexOf(t)}}),lang:E(function(i){return se.test(i||"")||I.error("unsupported lang: "+i),i=i.replace(A,h).toLowerCase(),function(e){var t;do{if(t=S?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===i||0===t.indexOf(i+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=O.location&&O.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===i},focus:function(e){return e===T.activeElement&&(!T.hasFocus||T.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:fe(!1),disabled:fe(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!v.pseudos.empty(e)},header:function(e){return le.test(e.nodeName)},input:function(e){return re.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(e=e.getAttribute("type"))||"text"===e.toLowerCase())},first:M(function(){return[0]}),last:M(function(e,t){return[t-1]}),eq:M(function(e,t,i){return[i<0?i+t:i]}),even:M(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:M(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:M(function(e,t,i){for(var o=i<0?i+t:t<i?t:i;0<=--o;)e.push(o);return e}),gt:M(function(e,t,i){for(var o=i<0?i+t:i;++o<t;)e.push(o);return e})}}).pseudos.nth=v.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})v.pseudos[e]=function(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}(e);for(e in{submit:!0,reset:!0})v.pseudos[e]=function(i){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===i}}(e);function _e(){}function j(e){for(var t=0,i=e.length,o="";t<i;t++)o+=e[t].value;return o}function be(a,e,t){var r=e.dir,l=e.next,c=l||r,d=t&&"parentNode"===c,h=H++;return e.first?function(e,t,i){for(;e=e[r];)if(1===e.nodeType||d)return a(e,t,i);return!1}:function(e,t,i){var o,n,s=[C,h];if(i){for(;e=e[r];)if((1===e.nodeType||d)&&a(e,t,i))return!0}else for(;e=e[r];)if(1===e.nodeType||d)if(n=(n=e[x]||(e[x]={}))[e.uniqueID]||(n[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[r]||e;else{if((o=n[c])&&o[0]===C&&o[1]===h)return s[2]=o[2];if((n[c]=s)[2]=a(e,t,i))return!0}return!1}}function ye(n){return 1<n.length?function(e,t,i){for(var o=n.length;o--;)if(!n[o](e,t,i))return!1;return!0}:n[0]}function ve(e,t,i,o,n){for(var s,a=[],r=0,l=e.length,c=null!=t;r<l;r++)!(s=e[r])||i&&!i(s,o,n)||(a.push(s),c&&t.push(r));return a}function ke(e){for(var o,t,i,n=e.length,s=v.relative[e[0].type],a=s||v.relative[" "],r=s?1:0,l=be(function(e){return e===o},a,!0),c=be(function(e){return-1<b(o,e)},a,!0),d=[function(e,t,i){e=!s&&(i||t!==k)||((o=t).nodeType?l:c)(e,t,i);return o=null,e}];r<n;r++)if(t=v.relative[e[r].type])d=[be(ye(d),t)];else{if((t=v.filter[e[r].type].apply(null,e[r].matches))[x]){for(i=++r;i<n&&!v.relative[e[i].type];i++);return function e(p,m,f,g,_,t){return g&&!g[x]&&(g=e(g)),_&&!_[x]&&(_=e(_,t)),E(function(e,t,i,o){var n,s,a,r=[],l=[],c=t.length,d=e||function(e,t,i){for(var o=0,n=t.length;o<n;o++)I(e,t[o],i);return i}(m||"*",i.nodeType?[i]:i,[]),h=!p||!e&&m?d:ve(d,r,p,i,o),u=f?_||(e?p:c||g)?[]:t:h;if(f&&f(h,u,i,o),g)for(n=ve(u,l),g(n,[],i,o),s=n.length;s--;)(a=n[s])&&(u[l[s]]=!(h[l[s]]=a));if(e){if(_||p){if(_){for(n=[],s=u.length;s--;)(a=u[s])&&n.push(h[s]=a);_(null,u=[],n,o)}for(s=u.length;s--;)(a=u[s])&&-1<(n=_?b(e,a):r[s])&&(e[n]=!(t[n]=a))}}else u=ve(u===t?u.splice(c,u.length):u),_?_(null,t,u,o):D.apply(t,u)})}(1<r&&ye(d),1<r&&j(e.slice(0,r-1).concat({value:" "===e[r-2].type?"*":""})).replace(_,"$1"),t,r<i&&ke(e.slice(r,i)),i<n&&ke(e=e.slice(i)),i<n&&j(e))}d.push(t)}return ye(d)}return _e.prototype=v.filters=v.pseudos,v.setFilters=new _e,p=I.tokenize=function(e,t){var i,o,n,s,a,r,l,c=U[e+" "];if(c)return t?0:c.slice(0);for(a=e,r=[],l=v.preFilter;a;){for(s in i&&!(o=te.exec(a))||(o&&(a=a.slice(o[0].length)||a),r.push(n=[])),i=!1,(o=ie.exec(a))&&(i=o.shift(),n.push({value:i,type:o[0].replace(_," ")}),a=a.slice(i.length)),v.filter)!(o=y[s].exec(a))||l[s]&&!(o=l[s](o))||(i=o.shift(),n.push({value:i,type:s,matches:o}),a=a.slice(i.length));if(!i)break}return t?a.length:a?I.error(e):U(e,r).slice(0)},$=I.compile=function(e,t){var i,g,_,b,y,o,n=[],s=[],a=V[e+" "];if(!a){for(i=(t=t||p(e)).length;i--;)((a=ke(t[i]))[x]?n:s).push(a);(a=V(e,(b=0<(_=n).length,y=0<(g=s).length,o=function(e,t,i,o,n){var s,a,r,l=0,c="0",d=e&&[],h=[],u=k,p=e||y&&v.find.TAG("*",n),m=C+=null==u?1:Math.random()||.1,f=p.length;for(n&&(k=t==T||t||n);c!==f&&null!=(s=p[c]);c++){if(y&&s){for(a=0,t||s.ownerDocument==T||(w(s),i=!S);r=g[a++];)if(r(s,t||T,i)){o.push(s);break}n&&(C=m)}b&&((s=!r&&s)&&l--,e&&d.push(s))}if(l+=c,b&&c!==l){for(a=0;r=_[a++];)r(d,h,t,i);if(e){if(0<l)for(;c--;)d[c]||h[c]||(h[c]=K.call(o));h=ve(h)}D.apply(o,h),n&&!e&&0<h.length&&1<l+_.length&&I.uniqueSort(o)}return n&&(C=m,k=u),d},b?E(o):o))).selector=e}return a},W=I.select=function(e,t,i,o){var n,s,a,r,l,c="function"==typeof e&&e,d=!o&&p(e=c.selector||e);if(i=i||[],1===d.length){if(2<(s=d[0]=d[0].slice(0)).length&&"ID"===(a=s[0]).type&&9===t.nodeType&&S&&v.relative[s[1].type]){if(!(t=(v.find.ID(a.matches[0].replace(A,h),t)||[])[0]))return i;c&&(t=t.parentNode),e=e.slice(s.shift().value.length)}for(n=y.needsContext.test(e)?0:s.length;n--&&(a=s[n],!v.relative[r=a.type]);)if((l=v.find[r])&&(o=l(a.matches[0].replace(A,h),de.test(s[0].type)&&ge(t.parentNode)||t))){if(s.splice(n,1),e=o.length&&j(s))break;return D.apply(i,o),i}}return(c||$(e,d))(o,t,!S,i,!t||de.test(e)&&ge(t.parentNode)||t),i},u.sortStable=x.split("").sort(q).join("")===x,u.detectDuplicates=!!c,w(),u.sortDetached=P(function(e){return 1&e.compareDocumentPosition(T.createElement("fieldset"))}),P(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||pe("type|href|height|width",function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),u.attributes&&P(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||pe("value",function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),P(function(e){return null==e.getAttribute("disabled")})||pe(J,function(e,t,i){if(!i)return!0===e[t]?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),I}(w),Y=(S.find=e,S.expr=e.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=e.uniqueSort,S.text=e.getText,S.isXMLDoc=e.isXML,S.contains=e.contains,S.escapeSelector=e.escape,S.expr.match.needsContext);function l(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var J=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Z(e,i,o){return b(i)?S.grep(e,function(e,t){return!!i.call(e,t,e)!==o}):i.nodeType?S.grep(e,function(e){return e===i!==o}):"string"!=typeof i?S.grep(e,function(e){return-1<$.call(i,e)!==o}):S.filter(i,e,o)}S.filter=function(e,t,i){var o=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===o.nodeType?S.find.matchesSelector(o,e)?[o]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,i,o=this.length,n=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<o;t++)if(S.contains(n[t],this))return!0}));for(i=this.pushStack([]),t=0;t<o;t++)S.find(e,n[t],i);return 1<o?S.uniqueSort(i):i},filter:function(e){return this.pushStack(Z(this,e||[],!1))},not:function(e){return this.pushStack(Z(this,e||[],!0))},is:function(e){return!!Z(this,"string"==typeof e&&Y.test(e)?S(e):e||[],!1).length}});var Q,ee=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,te=((S.fn.init=function(e,t,i){if(e){if(i=i||Q,"string"!=typeof e)return e.nodeType?(this[0]=e,this.length=1,this):b(e)?void 0!==i.ready?i.ready(e):e(S):S.makeArray(e,this);if(!(o="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:ee.exec(e))||!o[1]&&t)return(!t||t.jquery?t||i:this.constructor(t)).find(e);if(o[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(o[1],t&&t.nodeType?t.ownerDocument||t:T,!0)),J.test(o[1])&&S.isPlainObject(t))for(var o in t)b(this[o])?this[o](t[o]):this.attr(o,t[o])}else(i=T.getElementById(o[2]))&&(this[0]=i,this.length=1)}return this}).prototype=S.fn,Q=S(T),/^(?:parents|prev(?:Until|All))/),ie={children:!0,contents:!0,next:!0,prev:!0};function oe(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}S.fn.extend({has:function(e){var t=S(e,this),i=t.length;return this.filter(function(){for(var e=0;e<i;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var i,o=0,n=this.length,s=[],a="string"!=typeof e&&S(e);if(!Y.test(e))for(;o<n;o++)for(i=this[o];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(a?-1<a.index(i):1===i.nodeType&&S.find.matchesSelector(i,e))){s.push(i);break}return this.pushStack(1<s.length?S.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?$.call(S(e),this[0]):$.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){e=e.parentNode;return e&&11!==e.nodeType?e:null},parents:function(e){return o(e,"parentNode")},parentsUntil:function(e,t,i){return o(e,"parentNode",i)},next:function(e){return oe(e,"nextSibling")},prev:function(e){return oe(e,"previousSibling")},nextAll:function(e){return o(e,"nextSibling")},prevAll:function(e){return o(e,"previousSibling")},nextUntil:function(e,t,i){return o(e,"nextSibling",i)},prevUntil:function(e,t,i){return o(e,"previousSibling",i)},siblings:function(e){return X((e.parentNode||{}).firstChild,e)},children:function(e){return X(e.firstChild)},contents:function(e){return null!=e.contentDocument&&N(e.contentDocument)?e.contentDocument:(l(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(o,n){S.fn[o]=function(e,t){var i=S.map(this,n,e);return(t="Until"!==o.slice(-5)?e:t)&&"string"==typeof t&&(i=S.filter(t,i)),1<this.length&&(ie[o]||S.uniqueSort(i),te.test(o)&&i.reverse()),this.pushStack(i)}});var x=/[^\x20\t\r\n\f]+/g;function d(e){return e}function ne(e){throw e}function se(e,t,i,o){var n;try{e&&b(n=e.promise)?n.call(e).done(t).fail(i):e&&b(n=e.then)?n.call(e,t,i):t.apply(void 0,[e].slice(o))}catch(e){i.apply(void 0,[e])}}S.Callbacks=function(o){var e,i;o="string"==typeof o?(e=o,i={},S.each(e.match(x)||[],function(e,t){i[t]=!0}),i):S.extend({},o);function n(){for(r=r||o.once,a=s=!0;c.length;d=-1)for(t=c.shift();++d<l.length;)!1===l[d].apply(t[0],t[1])&&o.stopOnFalse&&(d=l.length,t=!1);o.memory||(t=!1),s=!1,r&&(l=t?[]:"")}var s,t,a,r,l=[],c=[],d=-1,h={add:function(){return l&&(t&&!s&&(d=l.length-1,c.push(t)),function i(e){S.each(e,function(e,t){b(t)?o.unique&&h.has(t)||l.push(t):t&&t.length&&"string"!==m(t)&&i(t)})}(arguments),t&&!s&&n()),this},remove:function(){return S.each(arguments,function(e,t){for(var i;-1<(i=S.inArray(t,l,i));)l.splice(i,1),i<=d&&d--}),this},has:function(e){return e?-1<S.inArray(e,l):0<l.length},empty:function(){return l=l&&[],this},disable:function(){return r=c=[],l=t="",this},disabled:function(){return!l},lock:function(){return r=c=[],t||s||(l=t=""),this},locked:function(){return!!r},fireWith:function(e,t){return r||(t=[e,(t=t||[]).slice?t.slice():t],c.push(t),s||n()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!a}};return h},S.extend({Deferred:function(e){var s=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],n="pending",a={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var n=arguments;return S.Deferred(function(o){S.each(s,function(e,t){var i=b(n[t[4]])&&n[t[4]];r[t[1]](function(){var e=i&&i.apply(this,arguments);e&&b(e.promise)?e.promise().progress(o.notify).done(o.resolve).fail(o.reject):o[t[0]+"With"](this,i?[e]:arguments)})}),n=null}).promise()},then:function(t,i,o){var l=0;function c(n,s,a,r){return function(){function e(){var e,t;if(!(n<l)){if((e=a.apply(i,o))===s.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,b(t)?r?t.call(e,c(l,s,d,r),c(l,s,ne,r)):(l++,t.call(e,c(l,s,d,r),c(l,s,ne,r),c(l,s,d,s.notifyWith))):(a!==d&&(i=void 0,o=[e]),(r||s.resolveWith)(i,o))}}var i=this,o=arguments,t=r?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),l<=n+1&&(a!==ne&&(i=void 0,o=[e]),s.rejectWith(i,o))}};n?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),w.setTimeout(t))}}return S.Deferred(function(e){s[0][3].add(c(0,e,b(o)?o:d,e.notifyWith)),s[1][3].add(c(0,e,b(t)?t:d)),s[2][3].add(c(0,e,b(i)?i:ne))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},r={};return S.each(s,function(e,t){var i=t[2],o=t[5];a[t[1]]=i.add,o&&i.add(function(){n=o},s[3-e][2].disable,s[3-e][3].disable,s[0][2].lock,s[0][3].lock),i.add(t[3].fire),r[t[0]]=function(){return r[t[0]+"With"](this===r?void 0:this,arguments),this},r[t[0]+"With"]=i.fireWith}),a.promise(r),e&&e.call(r,r),r},when:function(e){function t(t){return function(e){n[t]=this,s[t]=1<arguments.length?r.call(arguments):e,--i||a.resolveWith(n,s)}}var i=arguments.length,o=i,n=Array(o),s=r.call(arguments),a=S.Deferred();if(i<=1&&(se(e,a.done(t(o)).resolve,a.reject,!i),"pending"===a.state()||b(s[o]&&s[o].then)))return a.then();for(;o--;)se(s[o],t(o),a.reject);return a.promise()}});var ae=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/,re=(S.Deferred.exceptionHook=function(e,t){w.console&&w.console.warn&&e&&ae.test(e.name)&&w.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){w.setTimeout(function(){throw e})},S.Deferred());function le(){T.removeEventListener("DOMContentLoaded",le),w.removeEventListener("load",le),S.ready()}S.fn.ready=function(e){return re.then(e).catch(function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||re.resolveWith(T,[S])}}),S.ready.then=re.then,"complete"===T.readyState||"loading"!==T.readyState&&!T.documentElement.doScroll?w.setTimeout(S.ready):(T.addEventListener("DOMContentLoaded",le),w.addEventListener("load",le));function h(e,t,i,o,n,s,a){var r=0,l=e.length,c=null==i;if("object"===m(i))for(r in n=!0,i)h(e,t,r,i[r],!0,s,a);else if(void 0!==o&&(n=!0,b(o)||(a=!0),t=c?a?(t.call(e,o),null):(c=t,function(e,t,i){return c.call(S(e),i)}):t))for(;r<l;r++)t(e[r],i,a?o:o.call(e[r],r,t(e[r],i)));return n?e:c?t.call(e):l?t(e[0],i):s}var ce=/^-ms-/,de=/-([a-z])/g;function he(e,t){return t.toUpperCase()}function y(e){return e.replace(ce,"ms-").replace(de,he)}function _(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function ue(){this.expando=S.expando+ue.uid++}ue.uid=1,ue.prototype={cache:function(e){var t=e[this.expando];return t||(t={},_(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var o,n=this.cache(e);if("string"==typeof t)n[y(t)]=i;else for(o in t)n[y(o)]=t[o];return n},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][y(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,o=e[this.expando];if(void 0!==o){if(void 0!==t){i=(t=Array.isArray(t)?t.map(y):(t=y(t))in o?[t]:t.match(x)||[]).length;for(;i--;)delete o[t[i]]}void 0!==t&&!S.isEmptyObject(o)||(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){e=e[this.expando];return void 0!==e&&!S.isEmptyObject(e)}};var v=new ue,c=new ue,pe=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,me=/[A-Z]/g;function fe(e,t,i){var o,n;if(void 0===i&&1===e.nodeType)if(o="data-"+t.replace(me,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(o))){try{i="true"===(n=i)||"false"!==n&&("null"===n?null:n===+n+""?+n:pe.test(n)?JSON.parse(n):n)}catch(e){}c.set(e,t,i)}else i=void 0;return i}S.extend({hasData:function(e){return c.hasData(e)||v.hasData(e)},data:function(e,t,i){return c.access(e,t,i)},removeData:function(e,t){c.remove(e,t)},_data:function(e,t,i){return v.access(e,t,i)},_removeData:function(e,t){v.remove(e,t)}}),S.fn.extend({data:function(i,e){var t,o,n,s=this[0],a=s&&s.attributes;if(void 0!==i)return"object"==typeof i?this.each(function(){c.set(this,i)}):h(this,function(e){var t;if(s&&void 0===e)return void 0!==(t=c.get(s,i))||void 0!==(t=fe(s,i))?t:void 0;this.each(function(){c.set(this,i,e)})},null,e,1<arguments.length,null,!0);if(this.length&&(n=c.get(s),1===s.nodeType&&!v.get(s,"hasDataAttrs"))){for(t=a.length;t--;)a[t]&&0===(o=a[t].name).indexOf("data-")&&(o=y(o.slice(5)),fe(s,o,n[o]));v.set(s,"hasDataAttrs",!0)}return n},removeData:function(e){return this.each(function(){c.remove(this,e)})}}),S.extend({queue:function(e,t,i){var o;if(e)return o=v.get(e,t=(t||"fx")+"queue"),i&&(!o||Array.isArray(i)?o=v.access(e,t,S.makeArray(i)):o.push(i)),o||[]},dequeue:function(e,t){t=t||"fx";var i=S.queue(e,t),o=i.length,n=i.shift(),s=S._queueHooks(e,t);"inprogress"===n&&(n=i.shift(),o--),n&&("fx"===t&&i.unshift("inprogress"),delete s.stop,n.call(e,function(){S.dequeue(e,t)},s)),!o&&s&&s.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return v.get(e,i)||v.access(e,i,{empty:S.Callbacks("once memory").add(function(){v.remove(e,[t+"queue",i])})})}}),S.fn.extend({queue:function(t,i){var e=2;return"string"!=typeof t&&(i=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===i?this:this.each(function(){var e=S.queue(this,t,i);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function i(){--n||s.resolveWith(a,[a])}var o,n=1,s=S.Deferred(),a=this,r=this.length;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";r--;)(o=v.get(a[r],e+"queueHooks"))&&o.empty&&(n++,o.empty.add(i));return i(),s.promise(t)}});function ge(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&C(e)&&"none"===S.css(e,"display")}var e=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,_e=new RegExp("^(?:([+-])=|)("+e+")([a-z%]*)$","i"),u=["Top","Right","Bottom","Left"],k=T.documentElement,C=function(e){return S.contains(e.ownerDocument,e)},be={composed:!0};k.getRootNode&&(C=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(be)===e.ownerDocument});function ye(e,t,i,o){var n,s,a=20,r=o?function(){return o.cur()}:function(){return S.css(e,t,"")},l=r(),c=i&&i[3]||(S.cssNumber[t]?"":"px"),d=e.nodeType&&(S.cssNumber[t]||"px"!==c&&+l)&&_e.exec(S.css(e,t));if(d&&d[3]!==c){for(c=c||d[3],d=+(l/=2)||1;a--;)S.style(e,t,d+c),(1-s)*(1-(s=r()/l||.5))<=0&&(a=0),d/=s;S.style(e,t,(d*=2)+c),i=i||[]}return i&&(d=+d||+l||0,n=i[1]?d+(i[1]+1)*i[2]:+i[2],o&&(o.unit=c,o.start=d,o.end=n)),n}var ve={};function D(e,t){for(var i,o,n,s,a,r,l=[],c=0,d=e.length;c<d;c++)(o=e[c]).style&&(i=o.style.display,t?("none"===i&&(l[c]=v.get(o,"display")||null,l[c]||(o.style.display="")),""===o.style.display&&ge(o)&&(l[c]=(r=s=n=void 0,s=o.ownerDocument,a=o.nodeName,(r=ve[a])||(n=s.body.appendChild(s.createElement(a)),r=S.css(n,"display"),n.parentNode.removeChild(n),ve[a]=r="none"===r?"block":r)))):"none"!==i&&(l[c]="none",v.set(o,"display",i)));for(c=0;c<d;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return D(this,!0)},hide:function(){return D(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ge(this)?S(this).show():S(this).hide()})}});var ke=/^(?:checkbox|radio)$/i,we=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Te=/^$|^module$|\/(?:java|ecma)script/i,i=T.createDocumentFragment().appendChild(T.createElement("div")),L=((E=T.createElement("input")).setAttribute("type","radio"),E.setAttribute("checked","checked"),E.setAttribute("name","t"),i.appendChild(E),g.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,i.innerHTML="<textarea>x</textarea>",g.noCloneChecked=!!i.cloneNode(!0).lastChild.defaultValue,i.innerHTML="<option></option>",g.option=!!i.lastChild,{thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]});function A(e,t){var i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&l(e,t)?S.merge([e],i):i}function Se(e,t){for(var i=0,o=e.length;i<o;i++)v.set(e[i],"globalEval",!t||v.get(t[i],"globalEval"))}L.tbody=L.tfoot=L.colgroup=L.caption=L.thead,L.th=L.td,g.option||(L.optgroup=L.option=[1,"<select multiple='multiple'>","</select>"]);var xe=/<|&#?\w+;/;function Ce(e,t,i,o,n){for(var s,a,r,l,c,d=t.createDocumentFragment(),h=[],u=0,p=e.length;u<p;u++)if((s=e[u])||0===s)if("object"===m(s))S.merge(h,s.nodeType?[s]:s);else if(xe.test(s)){for(a=a||d.appendChild(t.createElement("div")),r=(we.exec(s)||["",""])[1].toLowerCase(),r=L[r]||L._default,a.innerHTML=r[1]+S.htmlPrefilter(s)+r[2],c=r[0];c--;)a=a.lastChild;S.merge(h,a.childNodes),(a=d.firstChild).textContent=""}else h.push(t.createTextNode(s));for(d.textContent="",u=0;s=h[u++];)if(o&&-1<S.inArray(s,o))n&&n.push(s);else if(l=C(s),a=A(d.appendChild(s),"script"),l&&Se(a),i)for(c=0;s=a[c++];)Te.test(s.type||"")&&i.push(s);return d}var De=/^([^.]*)(?:\.(.+)|)/;function a(){return!0}function p(){return!1}function Le(e,t){return e===function(){try{return T.activeElement}catch(e){}}()==("focus"===t)}function Ae(e,t,i,o,n,s){var a,r;if("object"==typeof t){for(r in"string"!=typeof i&&(o=o||i,i=void 0),t)Ae(e,r,i,o,t[r],s);return e}if(null==o&&null==n?(n=i,o=i=void 0):null==n&&("string"==typeof i?(n=o,o=void 0):(n=o,o=i,i=void 0)),!1===n)n=p;else if(!n)return e;return 1===s&&(a=n,(n=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,n,o,i)})}function Ie(e,n,s){s?(v.set(e,n,!1),S.event.add(e,n,{namespace:!1,handler:function(e){var t,i,o=v.get(this,n);if(1&e.isTrigger&&this[n]){if(o.length)(S.event.special[n]||{}).delegateType&&e.stopPropagation();else if(o=r.call(arguments),v.set(this,n,o),t=s(this,n),this[n](),o!==(i=v.get(this,n))||t?v.set(this,n,!1):i={},o!==i)return e.stopImmediatePropagation(),e.preventDefault(),i&&i.value}else o.length&&(v.set(this,n,{value:S.event.trigger(S.extend(o[0],S.Event.prototype),o.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===v.get(e,n)&&S.event.add(e,n,a)}S.event={global:{},add:function(t,e,i,o,n){var s,a,r,l,c,d,h,u,p,m=v.get(t);if(_(t))for(i.handler&&(i=(s=i).handler,n=s.selector),n&&S.find.matchesSelector(k,n),i.guid||(i.guid=S.guid++),(r=m.events)||(r=m.events=Object.create(null)),(a=m.handle)||(a=m.handle=function(e){return void 0!==S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(x)||[""]).length;l--;)h=p=(u=De.exec(e[l])||[])[1],u=(u[2]||"").split(".").sort(),h&&(c=S.event.special[h]||{},h=(n?c.delegateType:c.bindType)||h,c=S.event.special[h]||{},p=S.extend({type:h,origType:p,data:o,handler:i,guid:i.guid,selector:n,needsContext:n&&S.expr.match.needsContext.test(n),namespace:u.join(".")},s),(d=r[h])||((d=r[h]=[]).delegateCount=0,c.setup&&!1!==c.setup.call(t,o,u,a)||t.addEventListener&&t.addEventListener(h,a)),c.add&&(c.add.call(t,p),p.handler.guid||(p.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,p):d.push(p),S.event.global[h]=!0)},remove:function(e,t,i,o,n){var s,a,r,l,c,d,h,u,p,m,f,g=v.hasData(e)&&v.get(e);if(g&&(l=g.events)){for(c=(t=(t||"").match(x)||[""]).length;c--;)if(p=f=(r=De.exec(t[c])||[])[1],m=(r[2]||"").split(".").sort(),p){for(h=S.event.special[p]||{},u=l[p=(o?h.delegateType:h.bindType)||p]||[],r=r[2]&&new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=u.length;s--;)d=u[s],!n&&f!==d.origType||i&&i.guid!==d.guid||r&&!r.test(d.namespace)||o&&o!==d.selector&&("**"!==o||!d.selector)||(u.splice(s,1),d.selector&&u.delegateCount--,h.remove&&h.remove.call(e,d));a&&!u.length&&(h.teardown&&!1!==h.teardown.call(e,m,g.handle)||S.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)S.event.remove(e,p+t[c],i,o,!0);S.isEmptyObject(l)&&v.remove(e,"handle events")}},dispatch:function(e){var t,i,o,n,s,a=new Array(arguments.length),r=S.event.fix(e),e=(v.get(this,"events")||Object.create(null))[r.type]||[],l=S.event.special[r.type]||{};for(a[0]=r,t=1;t<arguments.length;t++)a[t]=arguments[t];if(r.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,r)){for(s=S.event.handlers.call(this,r,e),t=0;(o=s[t++])&&!r.isPropagationStopped();)for(r.currentTarget=o.elem,i=0;(n=o.handlers[i++])&&!r.isImmediatePropagationStopped();)r.rnamespace&&!1!==n.namespace&&!r.rnamespace.test(n.namespace)||(r.handleObj=n,r.data=n.data,void 0!==(n=((S.event.special[n.origType]||{}).handle||n.handler).apply(o.elem,a))&&!1===(r.result=n)&&(r.preventDefault(),r.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,r),r.result}},handlers:function(e,t){var i,o,n,s,a,r=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&1<=e.button))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(s=[],a={},i=0;i<l;i++)void 0===a[n=(o=t[i]).selector+" "]&&(a[n]=o.needsContext?-1<S(n,this).index(c):S.find(n,this,null,[c]).length),a[n]&&s.push(o);s.length&&r.push({elem:c,handlers:s})}return c=this,l<t.length&&r.push({elem:c,handlers:t.slice(l)}),r},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:b(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){e=this||e;return ke.test(e.type)&&e.click&&l(e,"input")&&Ie(e,"click",a),!1},trigger:function(e){e=this||e;return ke.test(e.type)&&e.click&&l(e,"input")&&Ie(e,"click"),!0},_default:function(e){e=e.target;return ke.test(e.type)&&e.click&&l(e,"input")&&v.get(e,"click")||l(e,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?a:p,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=a,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=a,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=a,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Ie(this,e,Le),!1},trigger:function(){return Ie(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,n){S.event.special[e]={delegateType:n,bindType:n,handle:function(e){var t,i=e.relatedTarget,o=e.handleObj;return i&&(i===this||S.contains(this,i))||(e.type=o.origType,t=o.handler.apply(this,arguments),e.type=n),t}}}),S.fn.extend({on:function(e,t,i,o){return Ae(this,e,t,i,o)},one:function(e,t,i,o){return Ae(this,e,t,i,o,1)},off:function(e,t,i){var o,n;if(e&&e.preventDefault&&e.handleObj)o=e.handleObj,S(e.delegateTarget).off(o.namespace?o.origType+"."+o.namespace:o.origType,o.selector,o.handler);else{if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(i=t,t=void 0),!1===i&&(i=p),this.each(function(){S.event.remove(this,e,i,t)});for(n in e)this.off(n,t,e[n])}return this}});var Re=/<script|<style|<link/i,Ee=/checked\s*(?:[^=]|=\s*.checked.)/i,Pe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Me(e,t){return l(e,"table")&&l(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function je(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Oe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ne(e,t){var i,o,n,s;if(1===t.nodeType){if(v.hasData(e)&&(s=v.get(e).events))for(n in v.remove(t,"handle events"),s)for(i=0,o=s[n].length;i<o;i++)S.event.add(t,n,s[n][i]);c.hasData(e)&&(e=c.access(e),e=S.extend({},e),c.set(t,e))}}function I(i,o,n,s){o=F(o);var e,t,a,r,l,c,d=0,h=i.length,u=h-1,p=o[0],m=b(p);if(m||1<h&&"string"==typeof p&&!g.checkClone&&Ee.test(p))return i.each(function(e){var t=i.eq(e);m&&(o[0]=p.call(this,e,t.html())),I(t,o,n,s)});if(h&&(t=(e=Ce(o,i[0].ownerDocument,!1,i,s)).firstChild,1===e.childNodes.length&&(e=t),t||s)){for(r=(a=S.map(A(e,"script"),je)).length;d<h;d++)l=e,d!==u&&(l=S.clone(l,!0,!0),r&&S.merge(a,A(l,"script"))),n.call(i[d],l,d);if(r)for(c=a[a.length-1].ownerDocument,S.map(a,Oe),d=0;d<r;d++)l=a[d],Te.test(l.type||"")&&!v.access(l,"globalEval")&&S.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?S._evalUrl&&!l.noModule&&S._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},c):G(l.textContent.replace(Pe,""),l,c))}return i}function Fe(e,t,i){for(var o,n=t?S.filter(t,e):e,s=0;null!=(o=n[s]);s++)i||1!==o.nodeType||S.cleanData(A(o)),o.parentNode&&(i&&C(o)&&Se(A(o,"script")),o.parentNode.removeChild(o));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,i){var o,n,s,a,r,l,c,d=e.cloneNode(!0),h=C(e);if(!(g.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=A(d),o=0,n=(s=A(e)).length;o<n;o++)r=s[o],"input"===(c=(l=a[o]).nodeName.toLowerCase())&&ke.test(r.type)?l.checked=r.checked:"input"!==c&&"textarea"!==c||(l.defaultValue=r.defaultValue);if(t)if(i)for(s=s||A(e),a=a||A(d),o=0,n=s.length;o<n;o++)Ne(s[o],a[o]);else Ne(e,d);return 0<(a=A(d,"script")).length&&Se(a,!h&&A(e,"script")),d},cleanData:function(e){for(var t,i,o,n=S.event.special,s=0;void 0!==(i=e[s]);s++)if(_(i)){if(t=i[v.expando]){if(t.events)for(o in t.events)n[o]?S.event.remove(i,o):S.removeEvent(i,o,t.handle);i[v.expando]=void 0}i[c.expando]&&(i[c.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Fe(this,e,!0)},remove:function(e){return Fe(this,e)},text:function(e){return h(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return I(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Me(this,e).appendChild(e)})},prepend:function(){return I(this,arguments,function(e){var t;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(t=Me(this,e)).insertBefore(e,t.firstChild)})},before:function(){return I(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return I(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(A(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return h(this,function(e){var t=this[0]||{},i=0,o=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Re.test(e)&&!L[(we.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;i<o;i++)1===(t=this[i]||{}).nodeType&&(S.cleanData(A(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var i=[];return I(this,arguments,function(e){var t=this.parentNode;S.inArray(this,i)<0&&(S.cleanData(A(this)),t&&t.replaceChild(e,this))},i)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,i=[],o=S(e),n=o.length-1,s=0;s<=n;s++)t=s===n?this:this.clone(!0),S(o[s])[a](t),B.apply(i,t.get());return this.pushStack(i)}});function Be(e){var t=e.ownerDocument.defaultView;return(t=t&&t.opener?t:w).getComputedStyle(e)}function $e(e,t,i){var o,n={};for(o in t)n[o]=e.style[o],e.style[o]=t[o];for(o in i=i.call(e),t)e.style[o]=n[o];return i}var We,He,ze,Ue,Ve,qe,Ge,n,Ke=new RegExp("^("+e+")(?!px)[a-z%]+$","i"),Xe=new RegExp(u.join("|"),"i");function Ye(e,t,i){var o,n,s=e.style;return(i=i||Be(e))&&(""!==(n=i.getPropertyValue(t)||i[t])||C(e)||(n=S.style(e,t)),!g.pixelBoxStyles()&&Ke.test(n)&&Xe.test(t)&&(e=s.width,t=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=n,n=i.width,s.width=e,s.minWidth=t,s.maxWidth=o)),void 0!==n?n+"":n}function Je(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}function Ze(){var e;n&&(Ge.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",n.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",k.appendChild(Ge).appendChild(n),e=w.getComputedStyle(n),We="1%"!==e.top,qe=12===Qe(e.marginLeft),n.style.right="60%",Ue=36===Qe(e.right),He=36===Qe(e.width),n.style.position="absolute",ze=12===Qe(n.offsetWidth/3),k.removeChild(Ge),n=null)}function Qe(e){return Math.round(parseFloat(e))}Ge=T.createElement("div"),(n=T.createElement("div")).style&&(n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",g.clearCloneStyle="content-box"===n.style.backgroundClip,S.extend(g,{boxSizingReliable:function(){return Ze(),He},pixelBoxStyles:function(){return Ze(),Ue},pixelPosition:function(){return Ze(),We},reliableMarginLeft:function(){return Ze(),qe},scrollboxSize:function(){return Ze(),ze},reliableTrDimensions:function(){var e,t,i;return null==Ve&&(e=T.createElement("table"),t=T.createElement("tr"),i=T.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",i.style.height="9px",i.style.display="block",k.appendChild(e).appendChild(t).appendChild(i),i=w.getComputedStyle(t),Ve=parseInt(i.height,10)+parseInt(i.borderTopWidth,10)+parseInt(i.borderBottomWidth,10)===t.offsetHeight,k.removeChild(e)),Ve}}));var et=["Webkit","Moz","ms"],tt=T.createElement("div").style,it={};function ot(e){return S.cssProps[e]||it[e]||(e in tt?e:it[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),i=et.length;i--;)if((e=et[i]+t)in tt)return e}(e)||e)}var nt=/^(none|table(?!-c[ea]).+)/,st=/^--/,at={position:"absolute",visibility:"hidden",display:"block"},rt={letterSpacing:"0",fontWeight:"400"};function lt(e,t,i){var o=_e.exec(t);return o?Math.max(0,o[2]-(i||0))+(o[3]||"px"):t}function ct(e,t,i,o,n,s){var a="width"===t?1:0,r=0,l=0;if(i===(o?"border":"content"))return 0;for(;a<4;a+=2)"margin"===i&&(l+=S.css(e,i+u[a],!0,n)),o?("content"===i&&(l-=S.css(e,"padding"+u[a],!0,n)),"margin"!==i&&(l-=S.css(e,"border"+u[a]+"Width",!0,n))):(l+=S.css(e,"padding"+u[a],!0,n),"padding"!==i?l+=S.css(e,"border"+u[a]+"Width",!0,n):r+=S.css(e,"border"+u[a]+"Width",!0,n));return!o&&0<=s&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-s-l-r-.5))||0),l}function dt(e,t,i){var o=Be(e),n=(!g.boxSizingReliable()||i)&&"border-box"===S.css(e,"boxSizing",!1,o),s=n,a=Ye(e,t,o),r="offset"+t[0].toUpperCase()+t.slice(1);if(Ke.test(a)){if(!i)return a;a="auto"}return(!g.boxSizingReliable()&&n||!g.reliableTrDimensions()&&l(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,o))&&e.getClientRects().length&&(n="border-box"===S.css(e,"boxSizing",!1,o),(s=r in e)&&(a=e[r])),(a=parseFloat(a)||0)+ct(e,t,i||(n?"border":"content"),s,o,a)+"px"}function s(e,t,i,o,n){return new s.prototype.init(e,t,i,o,n)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t)return""===(t=Ye(e,"opacity"))?"1":t}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,i,o){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,s,a,r=y(t),l=st.test(t),c=e.style;if(l||(t=ot(r)),a=S.cssHooks[t]||S.cssHooks[r],void 0===i)return a&&"get"in a&&void 0!==(n=a.get(e,!1,o))?n:c[t];"string"==(s=typeof i)&&(n=_e.exec(i))&&n[1]&&(i=ye(e,t,n),s="number"),null!=i&&i==i&&("number"!==s||l||(i+=n&&n[3]||(S.cssNumber[r]?"":"px")),g.clearCloneStyle||""!==i||0!==t.indexOf("background")||(c[t]="inherit"),a&&"set"in a&&void 0===(i=a.set(e,i,o))||(l?c.setProperty(t,i):c[t]=i))}},css:function(e,t,i,o){var n,s=y(t);return st.test(t)||(t=ot(s)),"normal"===(n=void 0===(n=(s=S.cssHooks[t]||S.cssHooks[s])&&"get"in s?s.get(e,!0,i):n)?Ye(e,t,o):n)&&t in rt&&(n=rt[t]),""===i||i?(s=parseFloat(n),!0===i||isFinite(s)?s||0:n):n}}),S.each(["height","width"],function(e,a){S.cssHooks[a]={get:function(e,t,i){if(t)return!nt.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?dt(e,a,i):$e(e,at,function(){return dt(e,a,i)})},set:function(e,t,i){var o=Be(e),n=!g.scrollboxSize()&&"absolute"===o.position,s=(n||i)&&"border-box"===S.css(e,"boxSizing",!1,o),i=i?ct(e,a,i,s,o):0;return s&&n&&(i-=Math.ceil(e["offset"+a[0].toUpperCase()+a.slice(1)]-parseFloat(o[a])-ct(e,a,"border",!1,o)-.5)),i&&(s=_e.exec(t))&&"px"!==(s[3]||"px")&&(e.style[a]=t,t=S.css(e,a)),lt(0,t,i)}}}),S.cssHooks.marginLeft=Je(g.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ye(e,"marginLeft"))||e.getBoundingClientRect().left-$e(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(n,s){S.cssHooks[n+s]={expand:function(e){for(var t=0,i={},o="string"==typeof e?e.split(" "):[e];t<4;t++)i[n+u[t]+s]=o[t]||o[t-2]||o[0];return i}},"margin"!==n&&(S.cssHooks[n+s].set=lt)}),S.fn.extend({css:function(e,t){return h(this,function(e,t,i){var o,n,s={},a=0;if(Array.isArray(t)){for(o=Be(e),n=t.length;a<n;a++)s[t[a]]=S.css(e,t[a],!1,o);return s}return void 0!==i?S.style(e,t,i):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=s).prototype={constructor:s,init:function(e,t,i,o,n,s){this.elem=e,this.prop=i,this.easing=n||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=o,this.unit=s||(S.cssNumber[i]?"":"px")},cur:function(){var e=s.propHooks[this.prop];return(e&&e.get?e:s.propHooks._default).get(this)},run:function(e){var t,i=s.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(i&&i.set?i:s.propHooks._default).set(this),this}}).init.prototype=s.prototype,(s.propHooks={_default:{get:function(e){return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(e=S.css(e.elem,e.prop,""))&&"auto"!==e?e:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ot(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=s.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=s.prototype.init,S.fx.step={};var R,ht,E,ut=/^(?:toggle|show|hide)$/,pt=/queueHooks$/;function mt(){ht&&(!1===T.hidden&&w.requestAnimationFrame?w.requestAnimationFrame(mt):w.setTimeout(mt,S.fx.interval),S.fx.tick())}function ft(){return w.setTimeout(function(){R=void 0}),R=Date.now()}function gt(e,t){var i,o=0,n={height:e};for(t=t?1:0;o<4;o+=2-t)n["margin"+(i=u[o])]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function _t(e,t,i){for(var o,n=(P.tweeners[t]||[]).concat(P.tweeners["*"]),s=0,a=n.length;s<a;s++)if(o=n[s].call(i,t,e))return o}function P(n,e,t){var i,s,o,a,r,l,c,d=0,h=P.prefilters.length,u=S.Deferred().always(function(){delete p.elem}),p=function(){if(s)return!1;for(var e=R||ft(),e=Math.max(0,m.startTime+m.duration-e),t=1-(e/m.duration||0),i=0,o=m.tweens.length;i<o;i++)m.tweens[i].run(t);return u.notifyWith(n,[m,t,e]),t<1&&o?e:(o||u.notifyWith(n,[m,1,0]),u.resolveWith(n,[m]),!1)},m=u.promise({elem:n,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:R||ft(),duration:t.duration,tweens:[],createTween:function(e,t){t=S.Tween(n,m.opts,e,t,m.opts.specialEasing[e]||m.opts.easing);return m.tweens.push(t),t},stop:function(e){var t=0,i=e?m.tweens.length:0;if(!s){for(s=!0;t<i;t++)m.tweens[t].run(1);e?(u.notifyWith(n,[m,1,0]),u.resolveWith(n,[m,e])):u.rejectWith(n,[m,e])}return this}}),f=m.props,g=f,_=m.opts.specialEasing;for(o in g)if(r=_[a=y(o)],l=g[o],Array.isArray(l)&&(r=l[1],l=g[o]=l[0]),o!==a&&(g[a]=l,delete g[o]),(c=S.cssHooks[a])&&"expand"in c)for(o in l=c.expand(l),delete g[a],l)o in g||(g[o]=l[o],_[o]=r);else _[a]=r;for(;d<h;d++)if(i=P.prefilters[d].call(m,n,f,m.opts))return b(i.stop)&&(S._queueHooks(m.elem,m.opts.queue).stop=i.stop.bind(i)),i;return S.map(f,_t,m),b(m.opts.start)&&m.opts.start.call(n,m),m.progress(m.opts.progress).done(m.opts.done,m.opts.complete).fail(m.opts.fail).always(m.opts.always),S.fx.timer(S.extend(p,{elem:n,anim:m,queue:m.opts.queue})),m}S.Animation=S.extend(P,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return ye(i.elem,e,_e.exec(t),i),i}]},tweener:function(e,t){for(var i,o=0,n=(e=b(e)?(t=e,["*"]):e.match(x)).length;o<n;o++)i=e[o],P.tweeners[i]=P.tweeners[i]||[],P.tweeners[i].unshift(t)},prefilters:[function(e,t,i){var o,n,s,a,r,l,c,d="width"in t||"height"in t,h=this,u={},p=e.style,m=e.nodeType&&ge(e),f=v.get(e,"fxshow");for(o in i.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,r=a.empty.fire,a.empty.fire=function(){a.unqueued||r()}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(n=t[o],ut.test(n)){if(delete t[o],s=s||"toggle"===n,n===(m?"hide":"show")){if("show"!==n||!f||void 0===f[o])continue;m=!0}u[o]=f&&f[o]||S.style(e,o)}if((l=!S.isEmptyObject(t))||!S.isEmptyObject(u))for(o in d&&1===e.nodeType&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],null==(c=f&&f.display)&&(c=v.get(e,"display")),"none"===(d=S.css(e,"display"))&&(c?d=c:(D([e],!0),c=e.style.display||c,d=S.css(e,"display"),D([e]))),("inline"===d||"inline-block"===d&&null!=c)&&"none"===S.css(e,"float")&&(l||(h.done(function(){p.display=c}),null==c&&(d=p.display,c="none"===d?"":d)),p.display="inline-block")),i.overflow&&(p.overflow="hidden",h.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]})),l=!1,u)l||(f?"hidden"in f&&(m=f.hidden):f=v.access(e,"fxshow",{display:c}),s&&(f.hidden=!m),m&&D([e],!0),h.done(function(){for(o in m||D([e]),v.remove(e,"fxshow"),u)S.style(e,o,u[o])})),l=_t(m?f[o]:0,o,h),o in f||(f[o]=l.start,m&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?P.prefilters.unshift(e):P.prefilters.push(e)}}),S.speed=function(e,t,i){var o=e&&"object"==typeof e?S.extend({},e):{complete:i||!i&&t||b(e)&&e,duration:e,easing:i&&t||t&&!b(t)&&t};return S.fx.off?o.duration=0:"number"!=typeof o.duration&&(o.duration in S.fx.speeds?o.duration=S.fx.speeds[o.duration]:o.duration=S.fx.speeds._default),null!=o.queue&&!0!==o.queue||(o.queue="fx"),o.old=o.complete,o.complete=function(){b(o.old)&&o.old.call(this),o.queue&&S.dequeue(this,o.queue)},o},S.fn.extend({fadeTo:function(e,t,i,o){return this.filter(ge).css("opacity",0).show().end().animate({opacity:t},e,i,o)},animate:function(t,e,i,o){function n(){var e=P(this,S.extend({},t),a);(s||v.get(this,"finish"))&&e.stop(!0)}var s=S.isEmptyObject(t),a=S.speed(e,i,o);return n.finish=n,s||!1===a.queue?this.each(n):this.queue(a.queue,n)},stop:function(n,e,s){function a(e){var t=e.stop;delete e.stop,t(s)}return"string"!=typeof n&&(s=e,e=n,n=void 0),e&&this.queue(n||"fx",[]),this.each(function(){var e=!0,t=null!=n&&n+"queueHooks",i=S.timers,o=v.get(this);if(t)o[t]&&o[t].stop&&a(o[t]);else for(t in o)o[t]&&o[t].stop&&pt.test(t)&&a(o[t]);for(t=i.length;t--;)i[t].elem!==this||null!=n&&i[t].queue!==n||(i[t].anim.stop(s),e=!1,i.splice(t,1));!e&&s||S.dequeue(this,n)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=v.get(this),i=t[a+"queue"],o=t[a+"queueHooks"],n=S.timers,s=i?i.length:0;for(t.finish=!0,S.queue(this,a,[]),o&&o.stop&&o.stop.call(this,!0),e=n.length;e--;)n[e].elem===this&&n[e].queue===a&&(n[e].anim.stop(!0),n.splice(e,1));for(e=0;e<s;e++)i[e]&&i[e].finish&&i[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,o){var n=S.fn[o];S.fn[o]=function(e,t,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(gt(o,!0),e,t,i)}}),S.each({slideDown:gt("show"),slideUp:gt("hide"),slideToggle:gt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,o){S.fn[e]=function(e,t,i){return this.animate(o,e,t,i)}}),S.timers=[],S.fx.tick=function(){var e,t=0,i=S.timers;for(R=Date.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||S.fx.stop(),R=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){ht||(ht=!0,mt())},S.fx.stop=function(){ht=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(o,e){return o=S.fx&&S.fx.speeds[o]||o,this.queue(e=e||"fx",function(e,t){var i=w.setTimeout(e,o);t.stop=function(){w.clearTimeout(i)}})},E=T.createElement("input"),i=T.createElement("select").appendChild(T.createElement("option")),E.type="checkbox",g.checkOn=""!==E.value,g.optSelected=i.selected,(E=T.createElement("input")).value="t",E.type="radio",g.radioValue="t"===E.value;var bt,yt=S.expr.attrHandle,vt=(S.fn.extend({attr:function(e,t){return h(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,i){var o,n,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===e.getAttribute?S.prop(e,t,i):(1===s&&S.isXMLDoc(e)||(n=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?bt:void 0)),void 0!==i?null===i?void S.removeAttr(e,t):n&&"set"in n&&void 0!==(o=n.set(e,i,t))?o:(e.setAttribute(t,i+""),i):!(n&&"get"in n&&null!==(o=n.get(e,t)))&&null==(o=S.find.attr(e,t))?void 0:o)},attrHooks:{type:{set:function(e,t){var i;if(!g.radioValue&&"radio"===t&&l(e,"input"))return i=e.value,e.setAttribute("type",t),i&&(e.value=i),t}}},removeAttr:function(e,t){var i,o=0,n=t&&t.match(x);if(n&&1===e.nodeType)for(;i=n[o++];)e.removeAttribute(i)}}),bt={set:function(e,t,i){return!1===t?S.removeAttr(e,i):e.setAttribute(i,i),i}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=yt[t]||S.find.attr;yt[t]=function(e,t,i){var o,n,s=t.toLowerCase();return i||(n=yt[s],yt[s]=o,o=null!=a(e,t,i)?s:null,yt[s]=n),o}}),/^(?:input|select|textarea|button)$/i),kt=/^(?:a|area)$/i;function M(e){return(e.match(x)||[]).join(" ")}function j(e){return e.getAttribute&&e.getAttribute("class")||""}function wt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(x)||[]}S.fn.extend({prop:function(e,t){return h(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,i){var o,n,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&S.isXMLDoc(e)||(t=S.propFix[t]||t,n=S.propHooks[t]),void 0!==i?n&&"set"in n&&void 0!==(o=n.set(e,i,t))?o:e[t]=i:n&&"get"in n&&null!==(o=n.get(e,t))?o:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):vt.test(e.nodeName)||kt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),g.optSelected||(S.propHooks.selected={get:function(e){e=e.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(e){e=e.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,i,o,n,s,a,r=0;if(b(t))return this.each(function(e){S(this).addClass(t.call(this,e,j(this)))});if((e=wt(t)).length)for(;i=this[r++];)if(a=j(i),o=1===i.nodeType&&" "+M(a)+" "){for(s=0;n=e[s++];)o.indexOf(" "+n+" ")<0&&(o+=n+" ");a!==(a=M(o))&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,o,n,s,a,r=0;if(b(t))return this.each(function(e){S(this).removeClass(t.call(this,e,j(this)))});if(!arguments.length)return this.attr("class","");if((e=wt(t)).length)for(;i=this[r++];)if(a=j(i),o=1===i.nodeType&&" "+M(a)+" "){for(s=0;n=e[s++];)for(;-1<o.indexOf(" "+n+" ");)o=o.replace(" "+n+" "," ");a!==(a=M(o))&&i.setAttribute("class",a)}return this},toggleClass:function(n,t){var s=typeof n,a="string"==s||Array.isArray(n);return"boolean"==typeof t&&a?t?this.addClass(n):this.removeClass(n):b(n)?this.each(function(e){S(this).toggleClass(n.call(this,e,j(this),t),t)}):this.each(function(){var e,t,i,o;if(a)for(t=0,i=S(this),o=wt(n);e=o[t++];)i.hasClass(e)?i.removeClass(e):i.addClass(e);else void 0!==n&&"boolean"!=s||((e=j(this))&&v.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",!e&&!1!==n&&v.get(this,"__className__")||""))})},hasClass:function(e){for(var t,i=0,o=" "+e+" ";t=this[i++];)if(1===t.nodeType&&-1<(" "+M(j(t))+" ").indexOf(o))return!0;return!1}});function Tt(e){e.stopPropagation()}var St=/\r/g,xt=(S.fn.extend({val:function(t){var i,e,o,n=this[0];return arguments.length?(o=b(t),this.each(function(e){1===this.nodeType&&(null==(e=o?t.call(this,e,S(this).val()):t)?e="":"number"==typeof e?e+="":Array.isArray(e)&&(e=S.map(e,function(e){return null==e?"":e+""})),(i=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in i&&void 0!==i.set(this,e,"value")||(this.value=e))})):n?(i=S.valHooks[n.type]||S.valHooks[n.nodeName.toLowerCase()])&&"get"in i&&void 0!==(e=i.get(n,"value"))?e:"string"==typeof(e=n.value)?e.replace(St,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:M(S.text(e))}},select:{get:function(e){for(var t,i=e.options,o=e.selectedIndex,n="select-one"===e.type,s=n?null:[],a=n?o+1:i.length,r=o<0?a:n?o:0;r<a;r++)if(((t=i[r]).selected||r===o)&&!t.disabled&&(!t.parentNode.disabled||!l(t.parentNode,"optgroup"))){if(t=S(t).val(),n)return t;s.push(t)}return s},set:function(e,t){for(var i,o,n=e.options,s=S.makeArray(t),a=n.length;a--;)((o=n[a]).selected=-1<S.inArray(S.valHooks.option.get(o),s))&&(i=!0);return i||(e.selectedIndex=-1),s}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},g.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),g.focusin="onfocusin"in w,/^(?:focusinfocus|focusoutblur)$/),Ct=(S.extend(S.event,{trigger:function(e,t,i,o){var n,s,a,r,l,c,d,h=[i||T],u=z.call(e,"type")?e.type:e,p=z.call(e,"namespace")?e.namespace.split("."):[],m=d=s=i=i||T;if(3!==i.nodeType&&8!==i.nodeType&&!xt.test(u+S.event.triggered)&&(-1<u.indexOf(".")&&(u=(p=u.split(".")).shift(),p.sort()),r=u.indexOf(":")<0&&"on"+u,(e=e[S.expando]?e:new S.Event(u,"object"==typeof e&&e)).isTrigger=o?2:3,e.namespace=p.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=i),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[u]||{},o||!c.trigger||!1!==c.trigger.apply(i,t))){if(!o&&!c.noBubble&&!f(i)){for(a=c.delegateType||u,xt.test(a+u)||(m=m.parentNode);m;m=m.parentNode)h.push(m),s=m;s===(i.ownerDocument||T)&&h.push(s.defaultView||s.parentWindow||w)}for(n=0;(m=h[n++])&&!e.isPropagationStopped();)d=m,e.type=1<n?a:c.bindType||u,(l=(v.get(m,"events")||Object.create(null))[e.type]&&v.get(m,"handle"))&&l.apply(m,t),(l=r&&m[r])&&l.apply&&_(m)&&(e.result=l.apply(m,t),!1===e.result&&e.preventDefault());return e.type=u,o||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(h.pop(),t)||!_(i)||r&&b(i[u])&&!f(i)&&((s=i[r])&&(i[r]=null),S.event.triggered=u,e.isPropagationStopped()&&d.addEventListener(u,Tt),i[u](),e.isPropagationStopped()&&d.removeEventListener(u,Tt),S.event.triggered=void 0,s&&(i[r]=s)),e.result}},simulate:function(e,t,i){i=S.extend(new S.Event,i,{type:e,isSimulated:!0});S.event.trigger(i,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return S.event.trigger(e,t,i,!0)}}),g.focusin||S.each({focus:"focusin",blur:"focusout"},function(i,o){function n(e){S.event.simulate(o,e.target,S.event.fix(e))}S.event.special[o]={setup:function(){var e=this.ownerDocument||this.document||this,t=v.access(e,o);t||e.addEventListener(i,n,!0),v.access(e,o,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=v.access(e,o)-1;t?v.access(e,o,t):(e.removeEventListener(i,n,!0),v.remove(e,o))}}}),w.location),Dt={guid:Date.now()},Lt=/\?/,At=(S.parseXML=function(e){var t,i;if(!e||"string"!=typeof e)return null;try{t=(new w.DOMParser).parseFromString(e,"text/xml")}catch(e){}return i=t&&t.getElementsByTagName("parsererror")[0],t&&!i||S.error("Invalid XML: "+(i?S.map(i.childNodes,function(e){return e.textContent}).join("\n"):e)),t},/\[\]$/),It=/\r?\n/g,Rt=/^(?:submit|button|image|reset|file)$/i,Et=/^(?:input|select|textarea|keygen)/i;S.param=function(e,t){function i(e,t){t=b(t)?t():t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==t?"":t)}var o,n=[];if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(o in e)!function i(o,e,n,s){if(Array.isArray(e))S.each(e,function(e,t){n||At.test(o)?s(o,t):i(o+"["+("object"==typeof t&&null!=t?e:"")+"]",t,n,s)});else if(n||"object"!==m(e))s(o,e);else for(var t in e)i(o+"["+t+"]",e[t],n,s)}(o,e[o],t,i);return n.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&Et.test(this.nodeName)&&!Rt.test(e)&&(this.checked||!ke.test(e))}).map(function(e,t){var i=S(this).val();return null==i?null:Array.isArray(i)?S.map(i,function(e){return{name:t.name,value:e.replace(It,"\r\n")}}):{name:t.name,value:i.replace(It,"\r\n")}}).get()}});var Pt=/%20/g,Mt=/#.*$/,jt=/([?&])_=[^&]*/,Ot=/^(.*?):[ \t]*([^\r\n]*)$/gm,Nt=/^(?:GET|HEAD)$/,Ft=/^\/\//,Bt={},$t={},Wt="*/".concat("*"),Ht=T.createElement("a");function zt(s){return function(e,t){"string"!=typeof e&&(t=e,e="*");var i,o=0,n=e.toLowerCase().match(x)||[];if(b(t))for(;i=n[o++];)"+"===i[0]?(i=i.slice(1)||"*",(s[i]=s[i]||[]).unshift(t)):(s[i]=s[i]||[]).push(t)}}function Ut(t,o,n,s){var a={},r=t===$t;function l(e){var i;return a[e]=!0,S.each(t[e]||[],function(e,t){t=t(o,n,s);return"string"!=typeof t||r||a[t]?r?!(i=t):void 0:(o.dataTypes.unshift(t),l(t),!1)}),i}return l(o.dataTypes[0])||!a["*"]&&l("*")}function Vt(e,t){var i,o,n=S.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((n[i]?e:o=o||{})[i]=t[i]);return o&&S.extend(!0,e,o),e}Ht.href=Ct.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Wt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Vt(Vt(e,S.ajaxSettings),t):Vt(S.ajaxSettings,e)},ajaxPrefilter:zt(Bt),ajaxTransport:zt($t),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0);var l,c,d,i,h,u,p,o,n,m=S.ajaxSetup({},t=t||{}),f=m.context||m,g=m.context&&(f.nodeType||f.jquery)?S(f):S.event,_=S.Deferred(),b=S.Callbacks("once memory"),y=m.statusCode||{},s={},a={},r="canceled",v={readyState:0,getResponseHeader:function(e){var t;if(u){if(!i)for(i={};t=Ot.exec(d);)i[t[1].toLowerCase()+" "]=(i[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=i[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return u?d:null},setRequestHeader:function(e,t){return null==u&&(e=a[e.toLowerCase()]=a[e.toLowerCase()]||e,s[e]=t),this},overrideMimeType:function(e){return null==u&&(m.mimeType=e),this},statusCode:function(e){if(e)if(u)v.always(e[v.status]);else for(var t in e)y[t]=[y[t],e[t]];return this},abort:function(e){e=e||r;return l&&l.abort(e),k(0,e),this}};if(_.promise(v),m.url=((e||m.url||Ct.href)+"").replace(Ft,Ct.protocol+"//"),m.type=t.method||t.type||m.method||m.type,m.dataTypes=(m.dataType||"*").toLowerCase().match(x)||[""],null==m.crossDomain){n=T.createElement("a");try{n.href=m.url,n.href=n.href,m.crossDomain=Ht.protocol+"//"+Ht.host!=n.protocol+"//"+n.host}catch(e){m.crossDomain=!0}}if(m.data&&m.processData&&"string"!=typeof m.data&&(m.data=S.param(m.data,m.traditional)),Ut(Bt,m,t,v),!u){for(o in(p=S.event&&m.global)&&0==S.active++&&S.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!Nt.test(m.type),c=m.url.replace(Mt,""),m.hasContent?m.data&&m.processData&&0===(m.contentType||"").indexOf("application/x-www-form-urlencoded")&&(m.data=m.data.replace(Pt,"+")):(n=m.url.slice(c.length),m.data&&(m.processData||"string"==typeof m.data)&&(c+=(Lt.test(c)?"&":"?")+m.data,delete m.data),!1===m.cache&&(c=c.replace(jt,"$1"),n=(Lt.test(c)?"&":"?")+"_="+Dt.guid+++n),m.url=c+n),m.ifModified&&(S.lastModified[c]&&v.setRequestHeader("If-Modified-Since",S.lastModified[c]),S.etag[c]&&v.setRequestHeader("If-None-Match",S.etag[c])),(m.data&&m.hasContent&&!1!==m.contentType||t.contentType)&&v.setRequestHeader("Content-Type",m.contentType),v.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+Wt+"; q=0.01":""):m.accepts["*"]),m.headers)v.setRequestHeader(o,m.headers[o]);if(m.beforeSend&&(!1===m.beforeSend.call(f,v,m)||u))return v.abort();if(r="abort",b.add(m.complete),v.done(m.success),v.fail(m.error),l=Ut($t,m,t,v)){if(v.readyState=1,p&&g.trigger("ajaxSend",[v,m]),u)return v;m.async&&0<m.timeout&&(h=w.setTimeout(function(){v.abort("timeout")},m.timeout));try{u=!1,l.send(s,k)}catch(e){if(u)throw e;k(-1,e)}}else k(-1,"No Transport")}return v;function k(e,t,i,o){var n,s,a,r=t;u||(u=!0,h&&w.clearTimeout(h),l=void 0,d=o||"",v.readyState=0<e?4:0,o=200<=e&&e<300||304===e,i&&(a=function(e,t,i){for(var o,n,s,a,r=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===o&&(o=e.mimeType||t.getResponseHeader("Content-Type"));if(o)for(n in r)if(r[n]&&r[n].test(o)){l.unshift(n);break}if(l[0]in i)s=l[0];else{for(n in i){if(!l[0]||e.converters[n+" "+l[0]]){s=n;break}a=a||n}s=s||a}if(s)return s!==l[0]&&l.unshift(s),i[s]}(m,v,i)),!o&&-1<S.inArray("script",m.dataTypes)&&S.inArray("json",m.dataTypes)<0&&(m.converters["text script"]=function(){}),a=function(e,t,i,o){var n,s,a,r,l,c={},d=e.dataTypes.slice();if(d[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];for(s=d.shift();s;)if(e.responseFields[s]&&(i[e.responseFields[s]]=t),!l&&o&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=s,s=d.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(a=c[l+" "+s]||c["* "+s]))for(n in c)if((r=n.split(" "))[1]===s&&(a=c[l+" "+r[0]]||c["* "+r[0]])){!0===a?a=c[n]:!0!==c[n]&&(s=r[0],d.unshift(r[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+s}}}return{state:"success",data:t}}(m,a,v,o),o?(m.ifModified&&((i=v.getResponseHeader("Last-Modified"))&&(S.lastModified[c]=i),(i=v.getResponseHeader("etag"))&&(S.etag[c]=i)),204===e||"HEAD"===m.type?r="nocontent":304===e?r="notmodified":(r=a.state,n=a.data,o=!(s=a.error))):(s=r,!e&&r||(r="error",e<0&&(e=0))),v.status=e,v.statusText=(t||r)+"",o?_.resolveWith(f,[n,r,v]):_.rejectWith(f,[v,r,s]),v.statusCode(y),y=void 0,p&&g.trigger(o?"ajaxSuccess":"ajaxError",[v,m,o?n:s]),b.fireWith(f,[v,r]),p&&(g.trigger("ajaxComplete",[v,m]),--S.active||S.event.trigger("ajaxStop")))}},getJSON:function(e,t,i){return S.get(e,t,i,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,n){S[n]=function(e,t,i,o){return b(t)&&(o=o||i,i=t,t=void 0),S.ajax(S.extend({url:e,type:n,dataType:o,data:t,success:i},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){for(var t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,i){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,i)}})},S.fn.extend({wrapAll:function(e){return this[0]&&(b(e)&&(e=e.call(this[0])),e=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(i){return b(i)?this.each(function(e){S(this).wrapInner(i.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(i):e.append(i)})},wrap:function(t){var i=b(t);return this.each(function(e){S(this).wrapAll(i?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new w.XMLHttpRequest}catch(e){}};var qt={0:200,1223:204},Gt=S.ajaxSettings.xhr();g.cors=!!Gt&&"withCredentials"in Gt,g.ajax=Gt=!!Gt,S.ajaxTransport(function(n){var s,a;if(g.cors||Gt&&!n.crossDomain)return{send:function(e,t){var i,o=n.xhr();if(o.open(n.type,n.url,n.async,n.username,n.password),n.xhrFields)for(i in n.xhrFields)o[i]=n.xhrFields[i];for(i in n.mimeType&&o.overrideMimeType&&o.overrideMimeType(n.mimeType),n.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)o.setRequestHeader(i,e[i]);s=function(e){return function(){s&&(s=a=o.onload=o.onerror=o.onabort=o.ontimeout=o.onreadystatechange=null,"abort"===e?o.abort():"error"===e?"number"!=typeof o.status?t(0,"error"):t(o.status,o.statusText):t(qt[o.status]||o.status,o.statusText,"text"!==(o.responseType||"text")||"string"!=typeof o.responseText?{binary:o.response}:{text:o.responseText},o.getAllResponseHeaders()))}},o.onload=s(),a=o.onerror=o.ontimeout=s("error"),void 0!==o.onabort?o.onabort=a:o.onreadystatechange=function(){4===o.readyState&&w.setTimeout(function(){s&&a()})},s=s("abort");try{o.send(n.hasContent&&n.data||null)}catch(e){if(s)throw e}},abort:function(){s&&s()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(i){var o,n;if(i.crossDomain||i.scriptAttrs)return{send:function(e,t){o=S("<script>").attr(i.scriptAttrs||{}).prop({charset:i.scriptCharset,src:i.url}).on("load error",n=function(e){o.remove(),n=null,e&&t("error"===e.type?404:200,e.type)}),T.head.appendChild(o[0])},abort:function(){n&&n()}}});var Kt=[],Xt=/(=)\?(?=&|$)|\?\?/,Yt=(S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Kt.pop()||S.expando+"_"+Dt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,i){var o,n,s,a=!1!==e.jsonp&&(Xt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Xt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return o=e.jsonpCallback=b(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Xt,"$1"+o):!1!==e.jsonp&&(e.url+=(Lt.test(e.url)?"&":"?")+e.jsonp+"="+o),e.converters["script json"]=function(){return s||S.error(o+" was not called"),s[0]},e.dataTypes[0]="json",n=w[o],w[o]=function(){s=arguments},i.always(function(){void 0===n?S(w).removeProp(o):w[o]=n,e[o]&&(e.jsonpCallback=t.jsonpCallback,Kt.push(o)),s&&b(n)&&n(s[0]),s=n=void 0}),"script"}),g.createHTMLDocument=((e=T.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===e.childNodes.length),S.parseHTML=function(e,t,i){return"string"!=typeof e?[]:("boolean"==typeof t&&(i=t,t=!1),t||(g.createHTMLDocument?((o=(t=T.implementation.createHTMLDocument("")).createElement("base")).href=T.location.href,t.head.appendChild(o)):t=T),o=!i&&[],(i=J.exec(e))?[t.createElement(i[1])]:(i=Ce([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var o},S.fn.load=function(e,t,i){var o,n,s,a=this,r=e.indexOf(" ");return-1<r&&(o=M(e.slice(r)),e=e.slice(0,r)),b(t)?(i=t,t=void 0):t&&"object"==typeof t&&(n="POST"),0<a.length&&S.ajax({url:e,type:n||"GET",dataType:"html",data:t}).done(function(e){s=arguments,a.html(o?S("<div>").append(S.parseHTML(e)).find(o):e)}).always(i&&function(e,t){a.each(function(){i.apply(this,s||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,i){var o,n,s,a,r=S.css(e,"position"),l=S(e),c={};"static"===r&&(e.style.position="relative"),s=l.offset(),o=S.css(e,"top"),a=S.css(e,"left"),r=("absolute"===r||"fixed"===r)&&-1<(o+a).indexOf("auto")?(n=(r=l.position()).top,r.left):(n=parseFloat(o)||0,parseFloat(a)||0),null!=(t=b(t)?t.call(e,i,S.extend({},s)):t).top&&(c.top=t.top-s.top+n),null!=t.left&&(c.left=t.left-s.left+r),"using"in t?t.using.call(e,c):l.css(c)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,i=this[0];return i?i.getClientRects().length?(e=i.getBoundingClientRect(),i=i.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,i,o=this[0],n={top:0,left:0};if("fixed"===S.css(o,"position"))t=o.getBoundingClientRect();else{for(t=this.offset(),i=o.ownerDocument,e=o.offsetParent||i.documentElement;e&&(e===i.body||e===i.documentElement)&&"static"===S.css(e,"position");)e=e.parentNode;e&&e!==o&&1===e.nodeType&&((n=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),n.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-n.top-S.css(o,"marginTop",!0),left:t.left-n.left-S.css(o,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===S.css(e,"position");)e=e.offsetParent;return e||k})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var s="pageYOffset"===n;S.fn[t]=function(e){return h(this,function(e,t,i){var o;if(f(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===i)return o?o[n]:e[t];o?o.scrollTo(s?o.pageXOffset:i,s?i:o.pageYOffset):e[t]=i},t,e,arguments.length)}}),S.each(["top","left"],function(e,i){S.cssHooks[i]=Je(g.pixelPosition,function(e,t){if(t)return t=Ye(e,i),Ke.test(t)?S(e).position()[i]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,r){S.each({padding:"inner"+a,content:r,"":"outer"+a},function(o,s){S.fn[s]=function(e,t){var i=arguments.length&&(o||"boolean"!=typeof e),n=o||(!0===e||!0===t?"margin":"border");return h(this,function(e,t,i){var o;return f(e)?0===s.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(o=e.documentElement,Math.max(e.body["scroll"+a],o["scroll"+a],e.body["offset"+a],o["offset"+a],o["client"+a])):void 0===i?S.css(e,t,n):S.style(e,t,i,n)},r,i?e:void 0,i)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,o){return this.on(t,e,i,o)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,i){S.fn[i]=function(e,t){return 0<arguments.length?this.on(i,null,e,t):this.trigger(i)}}),/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g),Jt=(S.proxy=function(e,t){var i,o;if("string"==typeof t&&(o=e[t],t=e,e=o),b(e))return i=r.call(arguments,2),(o=function(){return e.apply(t||this,i.concat(r.call(arguments)))}).guid=e.guid=e.guid||S.guid++,o},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=l,S.isFunction=b,S.isWindow=f,S.camelCase=y,S.type=m,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Yt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S}),w.jQuery),Zt=w.$;return S.noConflict=function(e){return w.$===S&&(w.$=Zt),e&&w.jQuery===S&&(w.jQuery=Jt),S},void 0===O&&(w.jQuery=w.$=S),S}),!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(G){"use strict";G.ui=G.ui||{},G.ui.version="1.13.1";var n,o,w,T,s,a,r,l,c,i,e,t,d,j=0,O=Array.prototype.hasOwnProperty,N=Array.prototype.slice;function F(e,t,i){return[parseFloat(e[0])*(c.test(e[0])?t/100:1),parseFloat(e[1])*(c.test(e[1])?i/100:1)]}function S(e,t){return parseInt(G.css(e,t),10)||0}function B(e){return null!=e&&e===e.window}G.cleanData=(n=G.cleanData,function(e){for(var t,i,o=0;null!=(i=e[o]);o++)(t=G._data(i,"events"))&&t.remove&&G(i).triggerHandler("remove");n(e)}),G.widget=function(e,i,t){var o,n,s,a={},r=e.split(".")[0],l=r+"-"+(e=e.split(".")[1]);return t||(t=i,i=G.Widget),Array.isArray(t)&&(t=G.extend.apply(null,[{}].concat(t))),G.expr.pseudos[l.toLowerCase()]=function(e){return!!G.data(e,l)},G[r]=G[r]||{},o=G[r][e],n=G[r][e]=function(e,t){if(!this||!this._createWidget)return new n(e,t);arguments.length&&this._createWidget(e,t)},G.extend(n,o,{version:t.version,_proto:G.extend({},t),_childConstructors:[]}),(s=new i).options=G.widget.extend({},s.options),G.each(t,function(t,o){function n(){return i.prototype[t].apply(this,arguments)}function s(e){return i.prototype[t].apply(this,e)}a[t]="function"==typeof o?function(){var e,t=this._super,i=this._superApply;return this._super=n,this._superApply=s,e=o.apply(this,arguments),this._super=t,this._superApply=i,e}:o}),n.prototype=G.widget.extend(s,{widgetEventPrefix:o&&s.widgetEventPrefix||e},a,{constructor:n,namespace:r,widgetName:e,widgetFullName:l}),o?(G.each(o._childConstructors,function(e,t){var i=t.prototype;G.widget(i.namespace+"."+i.widgetName,n,t._proto)}),delete o._childConstructors):i._childConstructors.push(n),G.widget.bridge(e,n),n},G.widget.extend=function(e){for(var t,i,o=N.call(arguments,1),n=0,s=o.length;n<s;n++)for(t in o[n])i=o[n][t],O.call(o[n],t)&&void 0!==i&&(G.isPlainObject(i)?e[t]=G.isPlainObject(e[t])?G.widget.extend({},e[t],i):G.widget.extend({},i):e[t]=i);return e},G.widget.bridge=function(s,t){var a=t.prototype.widgetFullName||s;G.fn[s]=function(i){var e="string"==typeof i,o=N.call(arguments,1),n=this;return e?this.length||"instance"!==i?this.each(function(){var e,t=G.data(this,a);return"instance"===i?(n=t,!1):t?"function"!=typeof t[i]||"_"===i.charAt(0)?G.error("no such method '"+i+"' for "+s+" widget instance"):(e=t[i].apply(t,o))!==t&&void 0!==e?(n=e&&e.jquery?n.pushStack(e.get()):e,!1):void 0:G.error("cannot call methods on "+s+" prior to initialization; attempted to call method '"+i+"'")}):n=void 0:(o.length&&(i=G.widget.extend.apply(null,[i].concat(o))),this.each(function(){var e=G.data(this,a);e?(e.option(i||{}),e._init&&e._init()):G.data(this,a,new t(i,this))})),n}},G.Widget=function(){},G.Widget._childConstructors=[],G.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,t){t=G(t||this.defaultElement||this)[0],this.element=G(t),this.uuid=j++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=G(),this.hoverable=G(),this.focusable=G(),this.classesElementLookup={},t!==this&&(G.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=G(t.style?t.ownerDocument:t.document||t),this.window=G(this.document[0].defaultView||this.document[0].parentWindow)),this.options=G.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:G.noop,_create:G.noop,_init:G.noop,destroy:function(){var i=this;this._destroy(),G.each(this.classesElementLookup,function(e,t){i._removeClass(t,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:G.noop,widget:function(){return this.element},option:function(e,t){var i,o,n,s=e;if(0===arguments.length)return G.widget.extend({},this.options);if("string"==typeof e)if(s={},e=(i=e.split(".")).shift(),i.length){for(o=s[e]=G.widget.extend({},this.options[e]),n=0;n<i.length-1;n++)o[i[n]]=o[i[n]]||{},o=o[i[n]];if(e=i.pop(),1===arguments.length)return void 0===o[e]?null:o[e];o[e]=t}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];s[e]=t}return this._setOptions(s),this},_setOptions:function(e){for(var t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(e){var t,i,o;for(t in e)o=this.classesElementLookup[t],e[t]!==this.options.classes[t]&&o&&o.length&&(i=G(o.get()),this._removeClass(o,t),i.addClass(this._classes({element:i,keys:t,classes:e,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(n){var s=[],a=this;function e(e,t){for(var i,o=0;o<e.length;o++)i=a.classesElementLookup[e[o]]||G(),i=n.add?(function(){var i=[];n.element.each(function(e,t){G.map(a.classesElementLookup,function(e){return e}).some(function(e){return e.is(t)})||i.push(t)}),a._on(G(i),{remove:"_untrackClassesElement"})}(),G(G.uniqueSort(i.get().concat(n.element.get())))):G(i.not(n.element).get()),a.classesElementLookup[e[o]]=i,s.push(e[o]),t&&n.classes[e[o]]&&s.push(n.classes[e[o]])}return(n=G.extend({element:this.element,classes:this.options.classes||{}},n)).keys&&e(n.keys.match(/\S+/g)||[],!0),n.extra&&e(n.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(i){var o=this;G.each(o.classesElementLookup,function(e,t){-1!==G.inArray(i.target,t)&&(o.classesElementLookup[e]=G(t.not(i.target).get()))}),this._off(G(i.target))},_removeClass:function(e,t,i){return this._toggleClass(e,t,i,!1)},_addClass:function(e,t,i){return this._toggleClass(e,t,i,!0)},_toggleClass:function(e,t,i,o){var n="string"==typeof e||null===e;return(i={extra:n?t:i,keys:n?e:t,element:n?this.element:e,add:o="boolean"==typeof o?o:i}).element.toggleClass(this._classes(i),o),this},_on:function(n,s,e){var a,r=this;"boolean"!=typeof n&&(e=s,s=n,n=!1),e?(s=a=G(s),this.bindings=this.bindings.add(s)):(e=s,s=this.element,a=this.widget()),G.each(e,function(e,t){function i(){if(n||!0!==r.options.disabled&&!G(this).hasClass("ui-state-disabled"))return("string"==typeof t?r[t]:t).apply(r,arguments)}"string"!=typeof t&&(i.guid=t.guid=t.guid||i.guid||G.guid++);var o=e.match(/^([\w:-]*)\s*(.*)$/),e=o[1]+r.eventNamespace;(o=o[2])?a.on(e,o,i):s.on(e,i)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(t),this.bindings=G(this.bindings.not(e).get()),this.focusable=G(this.focusable.not(e).get()),this.hoverable=G(this.hoverable.not(e).get())},_delay:function(e,t){var i=this;return setTimeout(function(){return("string"==typeof e?i[e]:e).apply(i,arguments)},t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(G(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(G(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(G(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(G(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,t,i){var o,n,s=this.options[e];if(i=i||{},(t=G.Event(t)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],n=t.originalEvent)for(o in n)o in t||(t[o]=n[o]);return this.element.trigger(t,i),!("function"==typeof s&&!1===s.apply(this.element[0],[t].concat(i))||t.isDefaultPrevented())}},G.each({show:"fadeIn",hide:"fadeOut"},function(s,a){G.Widget.prototype["_"+s]=function(t,e,i){var o,n=(e="string"==typeof e?{effect:e}:e)?!0!==e&&"number"!=typeof e&&e.effect||a:s;"number"==typeof(e=e||{})?e={duration:e}:!0===e&&(e={}),o=!G.isEmptyObject(e),e.complete=i,e.delay&&t.delay(e.delay),o&&G.effects&&G.effects.effect[n]?t[s](e):n!==s&&t[n]?t[n](e.duration,e.easing,i):t.queue(function(e){G(this)[s](),i&&i.call(t[0]),e()})}}),G.widget,w=Math.max,T=Math.abs,s=/left|center|right/,a=/top|center|bottom/,r=/[\+\-]\d+(\.[\d]+)?%?/,l=/^\w+/,c=/%$/,i=G.fn.position,G.position={scrollbarWidth:function(){if(void 0!==o)return o;var e,t=G("<div style='display:block;position:absolute;width:200px;height:200px;overflow:hidden;'><div style='height:300px;width:auto;'></div></div>"),i=t.children()[0];return G("body").append(t),e=i.offsetWidth,t.css("overflow","scroll"),e===(i=i.offsetWidth)&&(i=t[0].clientWidth),t.remove(),o=e-i},getScrollInfo:function(e){var t=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),i=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),t="scroll"===t||"auto"===t&&e.width<e.element[0].scrollWidth;return{width:"scroll"===i||"auto"===i&&e.height<e.element[0].scrollHeight?G.position.scrollbarWidth():0,height:t?G.position.scrollbarWidth():0}},getWithinInfo:function(e){var t=G(e||window),i=B(t[0]),o=!!t[0]&&9===t[0].nodeType;return{element:t,isWindow:i,isDocument:o,offset:i||o?{left:0,top:0}:G(e).offset(),scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop(),width:t.outerWidth(),height:t.outerHeight()}}},G.fn.position=function(h){if(!h||!h.of)return i.apply(this,arguments);var u,p,m,f,g,e,_="string"==typeof(h=G.extend({},h)).of?G(document).find(h.of):G(h.of),b=G.position.getWithinInfo(h.within),y=G.position.getScrollInfo(b),v=(h.collision||"flip").split(" "),k={},t=9===(e=(t=_)[0]).nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:B(e)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:e.preventDefault?{width:0,height:0,offset:{top:e.pageY,left:e.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()};return _[0].preventDefault&&(h.at="left top"),p=t.width,m=t.height,g=G.extend({},f=t.offset),G.each(["my","at"],function(){var e,t,i=(h[this]||"").split(" ");(i=1===i.length?s.test(i[0])?i.concat(["center"]):a.test(i[0])?["center"].concat(i):["center","center"]:i)[0]=s.test(i[0])?i[0]:"center",i[1]=a.test(i[1])?i[1]:"center",e=r.exec(i[0]),t=r.exec(i[1]),k[this]=[e?e[0]:0,t?t[0]:0],h[this]=[l.exec(i[0])[0],l.exec(i[1])[0]]}),1===v.length&&(v[1]=v[0]),"right"===h.at[0]?g.left+=p:"center"===h.at[0]&&(g.left+=p/2),"bottom"===h.at[1]?g.top+=m:"center"===h.at[1]&&(g.top+=m/2),u=F(k.at,p,m),g.left+=u[0],g.top+=u[1],this.each(function(){var i,e,a=G(this),r=a.outerWidth(),l=a.outerHeight(),t=S(this,"marginLeft"),o=S(this,"marginTop"),n=r+t+S(this,"marginRight")+y.width,s=l+o+S(this,"marginBottom")+y.height,c=G.extend({},g),d=F(k.my,a.outerWidth(),a.outerHeight());"right"===h.my[0]?c.left-=r:"center"===h.my[0]&&(c.left-=r/2),"bottom"===h.my[1]?c.top-=l:"center"===h.my[1]&&(c.top-=l/2),c.left+=d[0],c.top+=d[1],i={marginLeft:t,marginTop:o},G.each(["left","top"],function(e,t){G.ui.position[v[e]]&&G.ui.position[v[e]][t](c,{targetWidth:p,targetHeight:m,elemWidth:r,elemHeight:l,collisionPosition:i,collisionWidth:n,collisionHeight:s,offset:[u[0]+d[0],u[1]+d[1]],my:h.my,at:h.at,within:b,elem:a})}),h.using&&(e=function(e){var t=f.left-c.left,i=t+p-r,o=f.top-c.top,n=o+m-l,s={target:{element:_,left:f.left,top:f.top,width:p,height:m},element:{element:a,left:c.left,top:c.top,width:r,height:l},horizontal:i<0?"left":0<t?"right":"center",vertical:n<0?"top":0<o?"bottom":"middle"};p<r&&T(t+i)<p&&(s.horizontal="center"),m<l&&T(o+n)<m&&(s.vertical="middle"),w(T(t),T(i))>w(T(o),T(n))?s.important="horizontal":s.important="vertical",h.using.call(this,e,s)}),a.offset(G.extend(c,{using:e}))})},G.ui.position={fit:{left:function(e,t){var i=t.within,o=i.isWindow?i.scrollLeft:i.offset.left,n=i.width,s=e.left-t.collisionPosition.marginLeft,a=o-s,r=s+t.collisionWidth-n-o;t.collisionWidth>n?0<a&&r<=0?(i=e.left+a+t.collisionWidth-n-o,e.left+=a-i):e.left=!(0<r&&a<=0)&&r<a?o+n-t.collisionWidth:o:0<a?e.left+=a:0<r?e.left-=r:e.left=w(e.left-s,e.left)},top:function(e,t){var i=t.within,o=i.isWindow?i.scrollTop:i.offset.top,n=t.within.height,s=e.top-t.collisionPosition.marginTop,a=o-s,r=s+t.collisionHeight-n-o;t.collisionHeight>n?0<a&&r<=0?(i=e.top+a+t.collisionHeight-n-o,e.top+=a-i):e.top=!(0<r&&a<=0)&&r<a?o+n-t.collisionHeight:o:0<a?e.top+=a:0<r?e.top-=r:e.top=w(e.top-s,e.top)}},flip:{left:function(e,t){var i=(l=t.within).offset.left+l.scrollLeft,o=l.width,n=l.isWindow?l.scrollLeft:l.offset.left,s=(c=e.left-t.collisionPosition.marginLeft)-n,a=c+t.collisionWidth-o-n,r="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,l="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,c=-2*t.offset[0];s<0?((i=e.left+r+l+c+t.collisionWidth-o-i)<0||i<T(s))&&(e.left+=r+l+c):0<a&&(0<(n=e.left-t.collisionPosition.marginLeft+r+l+c-n)||T(n)<a)&&(e.left+=r+l+c)},top:function(e,t){var i=(l=t.within).offset.top+l.scrollTop,o=l.height,n=l.isWindow?l.scrollTop:l.offset.top,s=(c=e.top-t.collisionPosition.marginTop)-n,a=c+t.collisionHeight-o-n,r="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,l="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,c=-2*t.offset[1];s<0?((i=e.top+r+l+c+t.collisionHeight-o-i)<0||i<T(s))&&(e.top+=r+l+c):0<a&&(0<(n=e.top-t.collisionPosition.marginTop+r+l+c-n)||T(n)<a)&&(e.top+=r+l+c)}},flipfit:{left:function(){G.ui.position.flip.left.apply(this,arguments),G.ui.position.fit.left.apply(this,arguments)},top:function(){G.ui.position.flip.top.apply(this,arguments),G.ui.position.fit.top.apply(this,arguments)}}},G.ui.position,G.extend(G.expr.pseudos,{data:G.expr.createPseudo?G.expr.createPseudo(function(t){return function(e){return!!G.data(e,t)}}):function(e,t,i){return!!G.data(e,i[3])}}),G.fn.extend({disableSelection:(e="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(e+".ui-disableSelection",function(e){e.preventDefault()})}),enableSelection:function(){return this.off(".ui-disableSelection")}}),G.ui.focusable=function(e,t){var i,o,n,s=e.nodeName.toLowerCase();return"area"===s?(i=(n=e.parentNode).name,!(!e.href||!i||"map"!==n.nodeName.toLowerCase())&&0<(i=G("img[usemap='#"+i+"']")).length&&i.is(":visible")):(/^(input|select|textarea|button|object)$/.test(s)?(o=!e.disabled)&&(n=G(e).closest("fieldset")[0])&&(o=!n.disabled):o="a"===s&&e.href||t,o&&G(e).is(":visible")&&function(e){for(var t=e.css("visibility");"inherit"===t;)t=(e=e.parent()).css("visibility");return"visible"===t}(G(e)))},G.extend(G.expr.pseudos,{focusable:function(e){return G.ui.focusable(e,null!=G.attr(e,"tabindex"))}}),G.ui.focusable,G.fn._form=function(){return"string"==typeof this[0].form?this.closest("form"):G(this[0].form)},G.ui.formResetMixin={_formResetHandler:function(){var t=G(this);setTimeout(function(){var e=t.data("ui-form-reset-instances");G.each(e,function(){this.refresh()})})},_bindFormResetHandler:function(){var e;this.form=this.element._form(),this.form.length&&((e=this.form.data("ui-form-reset-instances")||[]).length||this.form.on("reset.ui-form-reset",this._formResetHandler),e.push(this),this.form.data("ui-form-reset-instances",e))},_unbindFormResetHandler:function(){var e;this.form.length&&((e=this.form.data("ui-form-reset-instances")).splice(G.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset"))}},G.expr.pseudos||(G.expr.pseudos=G.expr[":"]),G.uniqueSort||(G.uniqueSort=G.unique),G.escapeSelector||(t=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g,d=function(e,t){return t?"\0"===e?"":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},G.escapeSelector=function(e){return(e+"").replace(t,d)}),G.fn.even&&G.fn.odd||G.fn.extend({even:function(){return this.filter(function(e){return e%2==0})},odd:function(){return this.filter(function(e){return e%2==1})}}),G.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},G.fn.labels=function(){var e,t,i;return this.length?this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(t=this.eq(0).parents("label"),(e=this.attr("id"))&&(i=(i=this.eq(0).parents().last()).add((i.length?i:this).siblings()),e="label[for='"+G.escapeSelector(e)+"']",t=t.add(i.find(e).addBack(e))),this.pushStack(t)):this.pushStack([])},G.fn.scrollParent=function(e){var t=this.css("position"),i="absolute"===t,o=e?/(auto|scroll|hidden)/:/(auto|scroll)/,e=this.parents().filter(function(){var e=G(this);return(!i||"static"!==e.css("position"))&&o.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==t&&e.length?e:G(this[0].ownerDocument||document)},G.extend(G.expr.pseudos,{tabbable:function(e){var t=G.attr(e,"tabindex"),i=null!=t;return(!i||0<=t)&&G.ui.focusable(e,i)}}),G.fn.extend({uniqueId:($=0,function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++$)})}),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&G(this).removeAttr("id")})}}),G.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var $,h=!1;function W(e,t,i){return t<=e&&e<t+i}G(document).on("mouseup",function(){h=!1}),G.widget("ui.mouse",{version:"1.13.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.on("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).on("click."+this.widgetName,function(e){if(!0===G.data(e.target,t.widgetName+".preventClickEvent"))return G.removeData(e.target,t.widgetName+".preventClickEvent"),e.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){var t,i,o;if(!h)return this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),i=1===(this._mouseDownEvent=e).which,o=!("string"!=typeof(t=this).options.cancel||!e.target.nodeName)&&G(e.target).closest(this.options.cancel).length,!(i&&!o&&this._mouseCapture(e))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){t.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?(e.preventDefault(),!0):(!0===G.data(e.target,this.widgetName+".preventClickEvent")&&G.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return t._mouseMove(e)},this._mouseUpDelegate=function(e){return t._mouseUp(e)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),h=!0))},_mouseMove:function(e){if(this._mouseMoved){if(G.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&G.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,h=!1,e.preventDefault()},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),G.ui.plugin={add:function(e,t,i){var o,n=G.ui[e].prototype;for(o in i)n.plugins[o]=n.plugins[o]||[],n.plugins[o].push([t,i[o]])},call:function(e,t,i,o){var n,s=e.plugins[t];if(s&&(o||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;n<s.length;n++)e.options[s[n][0]]&&s[n][1].apply(e.element,i)}},G.ui.safeActiveElement=function(t){var i;try{i=t.activeElement}catch(e){i=t.body}return(i=i||t.body).nodeName?i:t.body},G.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&G(e).trigger("blur")},G.widget("ui.draggable",G.ui.mouse,{version:"1.13.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){(this.helper||this.element).is(".ui-draggable-dragging")?this.destroyOnClear=!0:(this._removeHandleClassName(),this._mouseDestroy())},_mouseCapture:function(e){var t=this.options;return!(this.helper||t.disabled||0<G(e.target).closest(".ui-resizable-handle").length||(this.handle=this._getHandle(e),!this.handle||(this._blurActiveElement(e),this._blockFrames(!0===t.iframeFix?"iframe":t.iframeFix),0)))},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=G(this);return G("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var t=G.ui.safeActiveElement(this.document[0]);G(e.target).closest(t).length||G.ui.safeBlur(t)},_mouseStart:function(e){var t=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),G.ui.ddmanager&&(G.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=0<this.helper.parents().filter(function(){return"fixed"===G(this).css("position")}).length,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,t.cursorAt&&this._adjustOffsetFromHelper(t.cursorAt),this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),G.ui.ddmanager&&!t.dropBehaviour&&G.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),G.ui.ddmanager&&G.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(e,t){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!t){if(t=this._uiHash(),!1===this._trigger("drag",e,t))return this._mouseUp(new G.Event("mouseup",e)),!1;this.position=t.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",G.ui.ddmanager&&G.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var t=this,i=!1;return G.ui.ddmanager&&!this.options.dropBehaviour&&(i=G.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||!0===this.options.revert||"function"==typeof this.options.revert&&this.options.revert.call(this.element,i)?G(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==t._trigger("stop",e)&&t._clear()}):!1!==this._trigger("stop",e)&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),G.ui.ddmanager&&G.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),G.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new G.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!G(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var t=this.options,i="function"==typeof t.helper;return(e=i?G(t.helper.apply(this.element[0],[e])):"clone"===t.helper?this.element.clone().removeAttr("id"):this.element).parents("body").length||e.appendTo("parent"===t.appendTo?this.element[0].parentNode:t.appendTo),i&&e[0]===this.element[0]&&this._setPositionRelative(),e[0]===this.element[0]||/(fixed|absolute)/.test(e.css("position"))||e.css("position","absolute"),e},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),"left"in(e=Array.isArray(e)?{left:+e[0],top:+e[1]||0}:e)&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),t=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==t&&G.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),{top:(e=this._isRootNode(this.offsetParent[0])?{top:0,left:0}:e).top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,i,o=this.options,n=this.document[0];this.relativeContainer=null,o.containment?"window"!==o.containment?"document"!==o.containment?o.containment.constructor!==Array?("parent"===o.containment&&(o.containment=this.helper[0].parentNode),(i=(t=G(o.containment))[0])&&(e=/(scroll|auto)/.test(t.css("overflow")),this.containment=[(parseInt(t.css("borderLeftWidth"),10)||0)+(parseInt(t.css("paddingLeft"),10)||0),(parseInt(t.css("borderTopWidth"),10)||0)+(parseInt(t.css("paddingTop"),10)||0),(e?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(t.css("borderRightWidth"),10)||0)-(parseInt(t.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(t.css("borderBottomWidth"),10)||0)-(parseInt(t.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=t)):this.containment=o.containment:this.containment=[0,0,G(n).width()-this.helperProportions.width-this.margins.left,(G(n).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[G(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,G(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,G(window).scrollLeft()+G(window).width()-this.helperProportions.width-this.margins.left,G(window).scrollTop()+(G(window).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(e,t){t=t||this.position;var i="absolute"===e?1:-1,e=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:e?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:e?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,o=this.options,n=this._isRootNode(this.scrollParent[0]),s=e.pageX,a=e.pageY;return n&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(i=this.relativeContainer?(i=this.relativeContainer.offset(),[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):this.containment,e.pageX-this.offset.click.left<i[0]&&(s=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(a=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(s=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(a=i[3]+this.offset.click.top)),o.grid&&(e=o.grid[1]?this.originalPageY+Math.round((a-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,a=!i||e-this.offset.click.top>=i[1]||e-this.offset.click.top>i[3]?e:e-this.offset.click.top>=i[1]?e-o.grid[1]:e+o.grid[1],e=o.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,s=!i||e-this.offset.click.left>=i[0]||e-this.offset.click.left>i[2]?e:e-this.offset.click.left>=i[0]?e-o.grid[0]:e+o.grid[0]),"y"===o.axis&&(s=this.originalPageX),"x"===o.axis&&(a=this.originalPageY)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:n?0:this.offset.scroll.top),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:n?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,t,i){return i=i||this._uiHash(),G.ui.plugin.call(this,e,[t,i,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),i.offset=this.positionAbs),G.Widget.prototype._trigger.call(this,e,t,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),G.ui.plugin.add("draggable","connectToSortable",{start:function(t,e,i){var o=G.extend({},e,{item:i.element});i.sortables=[],G(i.options.connectToSortable).each(function(){var e=G(this).sortable("instance");e&&!e.options.disabled&&(i.sortables.push(e),e.refreshPositions(),e._trigger("activate",t,o))})},stop:function(t,e,i){var o=G.extend({},e,{item:i.element});i.cancelHelperRemoval=!1,G.each(i.sortables,function(){var e=this;e.isOver?(e.isOver=0,i.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,o))})},drag:function(i,o,n){G.each(n.sortables,function(){var e=!1,t=this;t.positionAbs=n.positionAbs,t.helperProportions=n.helperProportions,t.offset.click=n.offset.click,t._intersectsWith(t.containerCache)&&(e=!0,G.each(n.sortables,function(){return this.positionAbs=n.positionAbs,this.helperProportions=n.helperProportions,this.offset.click=n.offset.click,e=(this===t||!this._intersectsWith(this.containerCache)||!G.contains(t.element[0],this.element[0]))&&e})),e?(t.isOver||(t.isOver=1,n._parent=o.helper.parent(),t.currentItem=o.helper.appendTo(t.element).data("ui-sortable-item",!0),t.options._helper=t.options.helper,t.options.helper=function(){return o.helper[0]},i.target=t.currentItem[0],t._mouseCapture(i,!0),t._mouseStart(i,!0,!0),t.offset.click.top=n.offset.click.top,t.offset.click.left=n.offset.click.left,t.offset.parent.left-=n.offset.parent.left-t.offset.parent.left,t.offset.parent.top-=n.offset.parent.top-t.offset.parent.top,n._trigger("toSortable",i),n.dropped=t.element,G.each(n.sortables,function(){this.refreshPositions()}),n.currentItem=n.element,t.fromOutside=n),t.currentItem&&(t._mouseDrag(i),o.position=t.position)):t.isOver&&(t.isOver=0,t.cancelHelperRemoval=!0,t.options._revert=t.options.revert,t.options.revert=!1,t._trigger("out",i,t._uiHash(t)),t._mouseStop(i,!0),t.options.revert=t.options._revert,t.options.helper=t.options._helper,t.placeholder&&t.placeholder.remove(),o.helper.appendTo(n._parent),n._refreshOffsets(i),o.position=n._generatePosition(i,!0),n._trigger("fromSortable",i),n.dropped=!1,G.each(n.sortables,function(){this.refreshPositions()}))})}}),G.ui.plugin.add("draggable","cursor",{start:function(e,t,i){var o=G("body"),i=i.options;o.css("cursor")&&(i._cursor=o.css("cursor")),o.css("cursor",i.cursor)},stop:function(e,t,i){(i=i.options)._cursor&&G("body").css("cursor",i._cursor)}}),G.ui.plugin.add("draggable","opacity",{start:function(e,t,i){t=G(t.helper),i=i.options,t.css("opacity")&&(i._opacity=t.css("opacity")),t.css("opacity",i.opacity)},stop:function(e,t,i){(i=i.options)._opacity&&G(t.helper).css("opacity",i._opacity)}}),G.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,t,i){var o=i.options,n=!1,s=i.scrollParentNotHidden[0],a=i.document[0];s!==a&&"HTML"!==s.tagName?(o.axis&&"x"===o.axis||(i.overflowOffset.top+s.offsetHeight-e.pageY<o.scrollSensitivity?s.scrollTop=n=s.scrollTop+o.scrollSpeed:e.pageY-i.overflowOffset.top<o.scrollSensitivity&&(s.scrollTop=n=s.scrollTop-o.scrollSpeed)),o.axis&&"y"===o.axis||(i.overflowOffset.left+s.offsetWidth-e.pageX<o.scrollSensitivity?s.scrollLeft=n=s.scrollLeft+o.scrollSpeed:e.pageX-i.overflowOffset.left<o.scrollSensitivity&&(s.scrollLeft=n=s.scrollLeft-o.scrollSpeed))):(o.axis&&"x"===o.axis||(e.pageY-G(a).scrollTop()<o.scrollSensitivity?n=G(a).scrollTop(G(a).scrollTop()-o.scrollSpeed):G(window).height()-(e.pageY-G(a).scrollTop())<o.scrollSensitivity&&(n=G(a).scrollTop(G(a).scrollTop()+o.scrollSpeed))),o.axis&&"y"===o.axis||(e.pageX-G(a).scrollLeft()<o.scrollSensitivity?n=G(a).scrollLeft(G(a).scrollLeft()-o.scrollSpeed):G(window).width()-(e.pageX-G(a).scrollLeft())<o.scrollSensitivity&&(n=G(a).scrollLeft(G(a).scrollLeft()+o.scrollSpeed)))),!1!==n&&G.ui.ddmanager&&!o.dropBehaviour&&G.ui.ddmanager.prepareOffsets(i,e)}}),G.ui.plugin.add("draggable","snap",{start:function(e,t,i){var o=i.options;i.snapElements=[],G(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var e=G(this),t=e.offset();this!==i.element[0]&&i.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:t.top,left:t.left})})},drag:function(e,t,i){for(var o,n,s,a,r,l,c,d,h,u=i.options,p=u.snapTolerance,m=t.offset.left,f=m+i.helperProportions.width,g=t.offset.top,_=g+i.helperProportions.height,b=i.snapElements.length-1;0<=b;b--)l=(r=i.snapElements[b].left-i.margins.left)+i.snapElements[b].width,d=(c=i.snapElements[b].top-i.margins.top)+i.snapElements[b].height,f<r-p||l+p<m||_<c-p||d+p<g||!G.contains(i.snapElements[b].item.ownerDocument,i.snapElements[b].item)?(i.snapElements[b].snapping&&i.options.snap.release&&i.options.snap.release.call(i.element,e,G.extend(i._uiHash(),{snapItem:i.snapElements[b].item})),i.snapElements[b].snapping=!1):("inner"!==u.snapMode&&(o=Math.abs(c-_)<=p,n=Math.abs(d-g)<=p,s=Math.abs(r-f)<=p,a=Math.abs(l-m)<=p,o&&(t.position.top=i._convertPositionTo("relative",{top:c-i.helperProportions.height,left:0}).top),n&&(t.position.top=i._convertPositionTo("relative",{top:d,left:0}).top),s&&(t.position.left=i._convertPositionTo("relative",{top:0,left:r-i.helperProportions.width}).left),a&&(t.position.left=i._convertPositionTo("relative",{top:0,left:l}).left)),h=o||n||s||a,"outer"!==u.snapMode&&(o=Math.abs(c-g)<=p,n=Math.abs(d-_)<=p,s=Math.abs(r-m)<=p,a=Math.abs(l-f)<=p,o&&(t.position.top=i._convertPositionTo("relative",{top:c,left:0}).top),n&&(t.position.top=i._convertPositionTo("relative",{top:d-i.helperProportions.height,left:0}).top),s&&(t.position.left=i._convertPositionTo("relative",{top:0,left:r}).left),a&&(t.position.left=i._convertPositionTo("relative",{top:0,left:l-i.helperProportions.width}).left)),!i.snapElements[b].snapping&&(o||n||s||a||h)&&i.options.snap.snap&&i.options.snap.snap.call(i.element,e,G.extend(i._uiHash(),{snapItem:i.snapElements[b].item})),i.snapElements[b].snapping=o||n||s||a||h)}}),G.ui.plugin.add("draggable","stack",{start:function(e,t,i){var o,i=i.options;(i=G.makeArray(G(i.stack)).sort(function(e,t){return(parseInt(G(e).css("zIndex"),10)||0)-(parseInt(G(t).css("zIndex"),10)||0)})).length&&(o=parseInt(G(i[0]).css("zIndex"),10)||0,G(i).each(function(e){G(this).css("zIndex",o+e)}),this.css("zIndex",o+i.length))}}),G.ui.plugin.add("draggable","zIndex",{start:function(e,t,i){t=G(t.helper),i=i.options,t.css("zIndex")&&(i._zIndex=t.css("zIndex")),t.css("zIndex",i.zIndex)},stop:function(e,t,i){(i=i.options)._zIndex&&G(t.helper).css("zIndex",i._zIndex)}}),G.ui.draggable,G.widget("ui.droppable",{version:"1.13.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,t=this.options,i=t.accept;this.isover=!1,this.isout=!0,this.accept="function"==typeof i?i:function(e){return e.is(i)},this.proportions=function(){if(!arguments.length)return e=e||{width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};e=arguments[0]},this._addToManager(t.scope),t.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){G.ui.ddmanager.droppables[e]=G.ui.ddmanager.droppables[e]||[],G.ui.ddmanager.droppables[e].push(this)},_splice:function(e){for(var t=0;t<e.length;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var e=G.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,t){var i;"accept"===e?this.accept="function"==typeof t?t:function(e){return e.is(t)}:"scope"===e&&(i=G.ui.ddmanager.droppables[this.options.scope],this._splice(i),this._addToManager(t)),this._super(e,t)},_activate:function(e){var t=G.ui.ddmanager.current;this._addActiveClass(),t&&this._trigger("activate",e,this.ui(t))},_deactivate:function(e){var t=G.ui.ddmanager.current;this._removeActiveClass(),t&&this._trigger("deactivate",e,this.ui(t))},_over:function(e){var t=G.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(t)))},_out:function(e){var t=G.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(t)))},_drop:function(t,e){var i=e||G.ui.ddmanager.current,o=!1;return!(!i||(i.currentItem||i.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=G(this).droppable("instance");if(e.options.greedy&&!e.options.disabled&&e.options.scope===i.options.scope&&e.accept.call(e.element[0],i.currentItem||i.element)&&G.ui.intersect(i,G.extend(e,{offset:e.element.offset()}),e.options.tolerance,t))return!(o=!0)}),!o&&!!this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",t,this.ui(i)),this.element))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}}),G.ui.intersect=function(e,t,i,o){if(!t.offset)return!1;var n=(e.positionAbs||e.position.absolute).left+e.margins.left,s=(e.positionAbs||e.position.absolute).top+e.margins.top,a=n+e.helperProportions.width,r=s+e.helperProportions.height,l=t.offset.left,c=t.offset.top,d=l+t.proportions().width,h=c+t.proportions().height;switch(i){case"fit":return l<=n&&a<=d&&c<=s&&r<=h;case"intersect":return l<n+e.helperProportions.width/2&&a-e.helperProportions.width/2<d&&c<s+e.helperProportions.height/2&&r-e.helperProportions.height/2<h;case"pointer":return W(o.pageY,c,t.proportions().height)&&W(o.pageX,l,t.proportions().width);case"touch":return(c<=s&&s<=h||c<=r&&r<=h||s<c&&h<r)&&(l<=n&&n<=d||l<=a&&a<=d||n<l&&d<a);default:return!1}},!(G.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,t){var i,o,n=G.ui.ddmanager.droppables[e.options.scope]||[],s=t?t.type:null,a=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();e:for(i=0;i<n.length;i++)if(!(n[i].options.disabled||e&&!n[i].accept.call(n[i].element[0],e.currentItem||e.element))){for(o=0;o<a.length;o++)if(a[o]===n[i].element[0]){n[i].proportions().height=0;continue e}n[i].visible="none"!==n[i].element.css("display"),n[i].visible&&("mousedown"===s&&n[i]._activate.call(n[i],t),n[i].offset=n[i].element.offset(),n[i].proportions({width:n[i].element[0].offsetWidth,height:n[i].element[0].offsetHeight}))}},drop:function(e,t){var i=!1;return G.each((G.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&G.ui.intersect(e,this,this.options.tolerance,t)&&(i=this._drop.call(this,t)||i),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,t)))}),i},dragStart:function(e,t){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||G.ui.ddmanager.prepareOffsets(e,t)})},drag:function(n,s){n.options.refreshPositions&&G.ui.ddmanager.prepareOffsets(n,s),G.each(G.ui.ddmanager.droppables[n.options.scope]||[],function(){var e,t,i,o;this.options.disabled||this.greedyChild||!this.visible||(o=!(i=G.ui.intersect(n,this,this.options.tolerance,s))&&this.isover?"isout":i&&!this.isover?"isover":null)&&(this.options.greedy&&(t=this.options.scope,(i=this.element.parents(":data(ui-droppable)").filter(function(){return G(this).droppable("instance").options.scope===t})).length&&((e=G(i[0]).droppable("instance")).greedyChild="isover"===o)),e&&"isover"===o&&(e.isover=!1,e.isout=!0,e._out.call(e,s)),this[o]=!0,this["isout"===o?"isover":"isout"]=!1,this["isover"===o?"_over":"_out"].call(this,s),e&&"isout"===o&&(e.isout=!1,e.isover=!0,e._over.call(e,s)))})},dragStop:function(e,t){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||G.ui.ddmanager.prepareOffsets(e,t)}})!==G.uiBackCompat&&G.widget("ui.droppable",G.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),G.ui.droppable,G.widget("ui.resizable",G.ui.mouse,{version:"1.13.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseFloat(e)||0},_isNumber:function(e){return!isNaN(parseFloat(e))},_hasScroll:function(e,t){if("hidden"===G(e).css("overflow"))return!1;var i=t&&"left"===t?"scrollLeft":"scrollTop",t=!1;if(0<e[i])return!0;try{e[i]=1,t=0<e[i],e[i]=0}catch(e){}return t},_create:function(){var e,t=this.options,i=this;this._addClass("ui-resizable"),G.extend(this,{_aspectRatio:!!t.aspectRatio,aspectRatio:t.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:t.helper||t.ghost||t.animate?t.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(G("<div class='ui-wrapper'></div>").css({overflow:"hidden",position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),t.autoHide&&G(this.element).on("mouseenter",function(){t.disabled||(i._removeClass("ui-resizable-autohide"),i._handles.show())}).on("mouseleave",function(){t.disabled||i.resizing||(i._addClass("ui-resizable-autohide"),i._handles.hide())}),this._mouseInit()},_destroy:function(){function e(e){G(e).removeData("resizable").removeData("ui-resizable").off(".resizable")}var t;return this._mouseDestroy(),this._addedHandles.remove(),this.elementIsWrapper&&(e(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),e(this.originalElement),this},_setOption:function(e,t){switch(this._super(e,t),e){case"handles":this._removeHandles(),this._setupHandles();break;case"aspectRatio":this._aspectRatio=!!t}},_setupHandles:function(){var e,t,i,o,n,s=this.options,a=this;if(this.handles=s.handles||(G(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=G(),this._addedHandles=G(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),i=this.handles.split(","),this.handles={},t=0;t<i.length;t++)o="ui-resizable-"+(e=String.prototype.trim.call(i[t])),n=G("<div>"),this._addClass(n,"ui-resizable-handle "+o),n.css({zIndex:s.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.children(this.handles[e]).length||(this.element.append(n),this._addedHandles=this._addedHandles.add(n));this._renderAxis=function(e){var t,i,o;for(t in e=e||this.element,this.handles)this.handles[t].constructor===String?this.handles[t]=this.element.children(this.handles[t]).first().show():(this.handles[t].jquery||this.handles[t].nodeType)&&(this.handles[t]=G(this.handles[t]),this._on(this.handles[t],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(i=G(this.handles[t],this.element),o=/sw|ne|nw|se|n|s/.test(t)?i.outerHeight():i.outerWidth(),i=["padding",/ne|nw|n/.test(t)?"Top":/se|sw|s/.test(t)?"Bottom":/^e$/.test(t)?"Right":"Left"].join(""),e.css(i,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[t])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){a.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=n&&n[1]?n[1]:"se")}),s.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._addedHandles.remove()},_mouseCapture:function(e){var t,i,o=!1;for(t in this.handles)(i=G(this.handles[t])[0])!==e.target&&!G.contains(i,e.target)||(o=!0);return!this.options.disabled&&o},_mouseStart:function(e){var t,i,o=this.options,n=this.element;return this.resizing=!0,this._renderProxy(),t=this._num(this.helper.css("left")),i=this._num(this.helper.css("top")),o.containment&&(t+=G(o.containment).scrollLeft()||0,i+=G(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:t,top:i},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:n.width(),height:n.height()},this.originalSize=this._helper?{width:n.outerWidth(),height:n.outerHeight()}:{width:n.width(),height:n.height()},this.sizeDiff={width:n.outerWidth()-n.width(),height:n.outerHeight()-n.height()},this.originalPosition={left:t,top:i},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=G(".ui-resizable-"+this.axis).css("cursor"),G("body").css("cursor","auto"===o?this.axis+"-resize":o),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var t=this.originalMousePosition,i=this.axis,o=e.pageX-t.left||0,t=e.pageY-t.top||0,i=this._change[i];return this._updatePrevProperties(),i&&(t=i.apply(this,[e,o,t]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(t=this._updateRatio(t,e)),t=this._respectSize(t,e),this._updateCache(t),this._propagate("resize",e),t=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),G.isEmptyObject(t)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges())),!1},_mouseStop:function(e){this.resizing=!1;var t,i,o,n=this.options,s=this;return this._helper&&(o=(t=(i=this._proportionallyResizeElements).length&&/textarea/i.test(i[0].nodeName))&&this._hasScroll(i[0],"left")?0:s.sizeDiff.height,i=t?0:s.sizeDiff.width,t={width:s.helper.width()-i,height:s.helper.height()-o},i=parseFloat(s.element.css("left"))+(s.position.left-s.originalPosition.left)||null,o=parseFloat(s.element.css("top"))+(s.position.top-s.originalPosition.top)||null,n.animate||this.element.css(G.extend(t,{top:o,left:i})),s.helper.height(s.size.height),s.helper.width(s.size.width),this._helper&&!n.animate&&this._proportionallyResize()),G("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,o=this.options,n={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0};(this._aspectRatio||e)&&(t=n.minHeight*this.aspectRatio,i=n.minWidth/this.aspectRatio,o=n.maxHeight*this.aspectRatio,e=n.maxWidth/this.aspectRatio,t>n.minWidth&&(n.minWidth=t),i>n.minHeight&&(n.minHeight=i),o<n.maxWidth&&(n.maxWidth=o),e<n.maxHeight&&(n.maxHeight=e)),this._vBoundaries=n},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,o=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===o&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===o&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,o=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,a=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,c=/sw|nw|w/.test(i),i=/nw|ne|n/.test(i);return s&&(e.width=t.minWidth),a&&(e.height=t.minHeight),o&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),s&&c&&(e.left=r-t.minWidth),o&&c&&(e.left=r-t.maxWidth),a&&i&&(e.top=l-t.minHeight),n&&i&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],o=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];t<4;t++)i[t]=parseFloat(o[t])||0,i[t]+=parseFloat(n[t])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;t<this._proportionallyResizeElements.length;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,t=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||G("<div></div>").css({overflow:"hidden"}),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++t.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize;return{left:this.originalPosition.left+t,width:i.width-t}},n:function(e,t,i){var o=this.originalSize;return{top:this.originalPosition.top+i,height:o.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(e,t,i){return G.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,t,i]))},sw:function(e,t,i){return G.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,t,i]))},ne:function(e,t,i){return G.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,t,i]))},nw:function(e,t,i){return G.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,t,i]))}},_propagate:function(e,t){G.ui.plugin.call(this,e,[t,this.ui()]),"resize"!==e&&this._trigger(e,t,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),G.ui.plugin.add("resizable","animate",{stop:function(t){var i=G(this).resizable("instance"),e=i.options,o=i._proportionallyResizeElements,n=(a=o.length&&/textarea/i.test(o[0].nodeName))&&i._hasScroll(o[0],"left")?0:i.sizeDiff.height,s=a?0:i.sizeDiff.width,a={width:i.size.width-s,height:i.size.height-n},s=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,n=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(G.extend(a,n&&s?{top:n,left:s}:{}),{duration:e.animateDuration,easing:e.animateEasing,step:function(){var e={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};o&&o.length&&G(o[0]).css({width:e.width,height:e.height}),i._updateCache(e),i._propagate("resize",t)}})}}),G.ui.plugin.add("resizable","containment",{start:function(){var i,o,n=G(this).resizable("instance"),e=n.options,t=n.element,s=e.containment,a=s instanceof G?s.get(0):/parent/.test(s)?t.parent().get(0):s;a&&(n.containerElement=G(a),/document/.test(s)||s===document?(n.containerOffset={left:0,top:0},n.containerPosition={left:0,top:0},n.parentData={element:G(document),left:0,top:0,width:G(document).width(),height:G(document).height()||document.body.parentNode.scrollHeight}):(i=G(a),o=[],G(["Top","Right","Left","Bottom"]).each(function(e,t){o[e]=n._num(i.css("padding"+t))}),n.containerOffset=i.offset(),n.containerPosition=i.position(),n.containerSize={height:i.innerHeight()-o[3],width:i.innerWidth()-o[1]},e=n.containerOffset,t=n.containerSize.height,s=n.containerSize.width,s=n._hasScroll(a,"left")?a.scrollWidth:s,t=n._hasScroll(a)?a.scrollHeight:t,n.parentData={element:a,left:e.left,top:e.top,width:s,height:t}))},resize:function(e){var t=G(this).resizable("instance"),i=t.options,o=t.containerOffset,n=t.position,s=t._aspectRatio||e.shiftKey,a={top:0,left:0},r=t.containerElement,e=!0;r[0]!==document&&/static/.test(r.css("position"))&&(a=o),n.left<(t._helper?o.left:0)&&(t.size.width=t.size.width+(t._helper?t.position.left-o.left:t.position.left-a.left),s&&(t.size.height=t.size.width/t.aspectRatio,e=!1),t.position.left=i.helper?o.left:0),n.top<(t._helper?o.top:0)&&(t.size.height=t.size.height+(t._helper?t.position.top-o.top:t.position.top),s&&(t.size.width=t.size.height*t.aspectRatio,e=!1),t.position.top=t._helper?o.top:0),i=t.containerElement.get(0)===t.element.parent().get(0),n=/relative|absolute/.test(t.containerElement.css("position")),i&&n?(t.offset.left=t.parentData.left+t.position.left,t.offset.top=t.parentData.top+t.position.top):(t.offset.left=t.element.offset().left,t.offset.top=t.element.offset().top),n=Math.abs(t.sizeDiff.width+(t._helper?t.offset.left-a.left:t.offset.left-o.left)),o=Math.abs(t.sizeDiff.height+(t._helper?t.offset.top-a.top:t.offset.top-o.top)),n+t.size.width>=t.parentData.width&&(t.size.width=t.parentData.width-n,s&&(t.size.height=t.size.width/t.aspectRatio,e=!1)),o+t.size.height>=t.parentData.height&&(t.size.height=t.parentData.height-o,s&&(t.size.width=t.size.height*t.aspectRatio,e=!1)),e||(t.position.left=t.prevPosition.left,t.position.top=t.prevPosition.top,t.size.width=t.prevSize.width,t.size.height=t.prevSize.height)},stop:function(){var e=G(this).resizable("instance"),t=e.options,i=e.containerOffset,o=e.containerPosition,n=e.containerElement,s=(r=G(e.helper)).offset(),a=r.outerWidth()-e.sizeDiff.width,r=r.outerHeight()-e.sizeDiff.height;e._helper&&!t.animate&&/relative/.test(n.css("position"))&&G(this).css({left:s.left-o.left-i.left,width:a,height:r}),e._helper&&!t.animate&&/static/.test(n.css("position"))&&G(this).css({left:s.left-o.left-i.left,width:a,height:r})}}),G.ui.plugin.add("resizable","alsoResize",{start:function(){var e=G(this).resizable("instance").options;G(e.alsoResize).each(function(){var e=G(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var t=G(this).resizable("instance"),o=t.options,n=t.originalSize,s=t.originalPosition,a={height:t.size.height-n.height||0,width:t.size.width-n.width||0,top:t.position.top-s.top||0,left:t.position.left-s.left||0};G(o.alsoResize).each(function(){var e=G(this),o=G(this).data("ui-resizable-alsoresize"),n={},t=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];G.each(t,function(e,t){var i=(o[t]||0)+(a[t]||0);i&&0<=i&&(n[t]=i||null)}),e.css(n)})},stop:function(){G(this).removeData("ui-resizable-alsoresize")}}),G.ui.plugin.add("resizable","ghost",{start:function(){var e=G(this).resizable("instance"),t=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:t.height,width:t.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),!1!==G.uiBackCompat&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=G(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=G(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),G.ui.plugin.add("resizable","grid",{resize:function(){var e,t=G(this).resizable("instance"),i=t.options,o=t.size,n=t.originalSize,s=t.originalPosition,a=t.axis,r="number"==typeof i.grid?[i.grid,i.grid]:i.grid,l=r[0]||1,c=r[1]||1,d=Math.round((o.width-n.width)/l)*l,h=Math.round((o.height-n.height)/c)*c,u=n.width+d,p=n.height+h,m=i.maxWidth&&i.maxWidth<u,f=i.maxHeight&&i.maxHeight<p,g=i.minWidth&&i.minWidth>u,o=i.minHeight&&i.minHeight>p;i.grid=r,g&&(u+=l),o&&(p+=c),m&&(u-=l),f&&(p-=c),/^(se|s|e)$/.test(a)?(t.size.width=u,t.size.height=p):/^(ne)$/.test(a)?(t.size.width=u,t.size.height=p,t.position.top=s.top-h):/^(sw)$/.test(a)?(t.size.width=u,t.size.height=p,t.position.left=s.left-d):((p-c<=0||u-l<=0)&&(e=t._getPaddingPlusBorderDimensions(this)),0<p-c?(t.size.height=p,t.position.top=s.top-h):(p=c-e.height,t.size.height=p,t.position.top=s.top+n.height-p),0<u-l?(t.size.width=u,t.position.left=s.left-d):(u=l-e.width,t.size.width=u,t.position.left=s.left+n.width-u))}}),G.ui.resizable,G.widget("ui.selectable",G.ui.mouse,{version:"1.13.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var i=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){i.elementPos=G(i.element[0]).offset(),i.selectees=G(i.options.filter,i.element[0]),i._addClass(i.selectees,"ui-selectee"),i.selectees.each(function(){var e=G(this),t={left:(t=e.offset()).left-i.elementPos.left,top:t.top-i.elementPos.top};G.data(this,"selectable-item",{element:this,$element:e,left:t.left,top:t.top,right:t.left+e.outerWidth(),bottom:t.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=G("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(i){var o=this,e=this.options;this.opos=[i.pageX,i.pageY],this.elementPos=G(this.element[0]).offset(),this.options.disabled||(this.selectees=G(e.filter,this.element[0]),this._trigger("start",i),G(e.appendTo).append(this.helper),this.helper.css({left:i.pageX,top:i.pageY,width:0,height:0}),e.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var e=G.data(this,"selectable-item");e.startselected=!0,i.metaKey||i.ctrlKey||(o._removeClass(e.$element,"ui-selected"),e.selected=!1,o._addClass(e.$element,"ui-unselecting"),e.unselecting=!0,o._trigger("unselecting",i,{unselecting:e.element}))}),G(i.target).parents().addBack().each(function(){var e,t=G.data(this,"selectable-item");if(t)return e=!i.metaKey&&!i.ctrlKey||!t.$element.hasClass("ui-selected"),o._removeClass(t.$element,e?"ui-unselecting":"ui-selected")._addClass(t.$element,e?"ui-selecting":"ui-unselecting"),t.unselecting=!e,t.selecting=e,(t.selected=e)?o._trigger("selecting",i,{selecting:t.element}):o._trigger("unselecting",i,{unselecting:t.element}),!1}))},_mouseDrag:function(o){var e,n,s,a,r,l,c;if(this.dragged=!0,!this.options.disabled)return s=(n=this).options,a=this.opos[0],r=this.opos[1],l=o.pageX,c=o.pageY,l<a&&(e=l,l=a,a=e),c<r&&(e=c,c=r,r=e),this.helper.css({left:a,top:r,width:l-a,height:c-r}),this.selectees.each(function(){var e=G.data(this,"selectable-item"),t=!1,i={};e&&e.element!==n.element[0]&&(i.left=e.left+n.elementPos.left,i.right=e.right+n.elementPos.left,i.top=e.top+n.elementPos.top,i.bottom=e.bottom+n.elementPos.top,"touch"===s.tolerance?t=!(i.left>l||i.right<a||i.top>c||i.bottom<r):"fit"===s.tolerance&&(t=i.left>a&&i.right<l&&i.top>r&&i.bottom<c),t?(e.selected&&(n._removeClass(e.$element,"ui-selected"),e.selected=!1),e.unselecting&&(n._removeClass(e.$element,"ui-unselecting"),e.unselecting=!1),e.selecting||(n._addClass(e.$element,"ui-selecting"),e.selecting=!0,n._trigger("selecting",o,{selecting:e.element}))):(e.selecting&&((o.metaKey||o.ctrlKey)&&e.startselected?(n._removeClass(e.$element,"ui-selecting"),e.selecting=!1,n._addClass(e.$element,"ui-selected"),e.selected=!0):(n._removeClass(e.$element,"ui-selecting"),e.selecting=!1,e.startselected&&(n._addClass(e.$element,"ui-unselecting"),e.unselecting=!0),n._trigger("unselecting",o,{unselecting:e.element}))),!e.selected||o.metaKey||o.ctrlKey||e.startselected||(n._removeClass(e.$element,"ui-selected"),e.selected=!1,n._addClass(e.$element,"ui-unselecting"),e.unselecting=!0,n._trigger("unselecting",o,{unselecting:e.element}))))}),!1},_mouseStop:function(t){var i=this;return this.dragged=!1,G(".ui-unselecting",this.element[0]).each(function(){var e=G.data(this,"selectable-item");i._removeClass(e.$element,"ui-unselecting"),e.unselecting=!1,e.startselected=!1,i._trigger("unselected",t,{unselected:e.element})}),G(".ui-selecting",this.element[0]).each(function(){var e=G.data(this,"selectable-item");i._removeClass(e.$element,"ui-selecting")._addClass(e.$element,"ui-selected"),e.selecting=!1,e.selected=!0,e.startselected=!0,i._trigger("selected",t,{selected:e.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),G.widget("ui.sortable",G.ui.mouse,{version:"1.13.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return t<=e&&e<t+i},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),G.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var e=this.items.length-1;0<=e;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,t){var i=null,o=!1,n=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(e),G(e.target).parents().each(function(){if(G.data(this,n.widgetName+"-item")===n)return i=G(this),!1}),!(i=G.data(e.target,n.widgetName+"-item")===n?G(e.target):i)||this.options.handle&&!t&&(G(this.options.handle,i).find("*").addBack().each(function(){this===e.target&&(o=!0)}),!o)||(this.currentItem=i,this._removeCurrentsFromItems(),0)))},_mouseStart:function(e,t,i){var o,n,s=this.options;if((this.currentContainer=this).refreshPositions(),this.appendTo=G("parent"!==s.appendTo?s.appendTo:this.currentItem.parent()),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},G.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),this.scrollParent=this.placeholder.scrollParent(),G.extend(this.offset,{parent:this._getParentOffset()}),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",s.cursor),this.storedStylesheet=G("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(n)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(o=this.containers.length-1;0<=o;o--)this.containers[o]._trigger("activate",e,this._uiHash(this));return G.ui.ddmanager&&(G.ui.ddmanager.current=this),G.ui.ddmanager&&!s.dropBehaviour&&G.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this.helper.parent().is(this.appendTo)||(this.helper.detach().appendTo(this.appendTo),this.offset.parent=this._getParentOffset()),this.position=this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,this.lastPositionAbs=this.positionAbs=this._convertPositionTo("absolute"),this._mouseDrag(e),!0},_scroll:function(e){var t=this.options,i=!1;return this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<t.scrollSensitivity?this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop+t.scrollSpeed:e.pageY-this.overflowOffset.top<t.scrollSensitivity&&(this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop-t.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<t.scrollSensitivity?this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft+t.scrollSpeed:e.pageX-this.overflowOffset.left<t.scrollSensitivity&&(this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft-t.scrollSpeed)):(e.pageY-this.document.scrollTop()<t.scrollSensitivity?i=this.document.scrollTop(this.document.scrollTop()-t.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<t.scrollSensitivity&&(i=this.document.scrollTop(this.document.scrollTop()+t.scrollSpeed)),e.pageX-this.document.scrollLeft()<t.scrollSensitivity?i=this.document.scrollLeft(this.document.scrollLeft()-t.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<t.scrollSensitivity&&(i=this.document.scrollLeft(this.document.scrollLeft()+t.scrollSpeed))),i},_mouseDrag:function(e){var t,i,o,n,s=this.options;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),s.scroll&&!1!==this._scroll(e)&&(this._refreshItemPositions(!0),G.ui.ddmanager&&!s.dropBehaviour&&G.ui.ddmanager.prepareOffsets(this,e)),this.dragDirection={vertical:this._getDragVerticalDirection(),horizontal:this._getDragHorizontalDirection()},t=this.items.length-1;0<=t;t--)if(o=(i=this.items[t]).item[0],(n=this._intersectsWithPointer(i))&&i.instance===this.currentContainer&&!(o===this.currentItem[0]||this.placeholder[1===n?"next":"prev"]()[0]===o||G.contains(this.placeholder[0],o)||"semi-dynamic"===this.options.type&&G.contains(this.element[0],o))){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(i))break;this._rearrange(e,i),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),G.ui.ddmanager&&G.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,t){var i,o,n,s;if(e)return G.ui.ddmanager&&!this.options.dropBehaviour&&G.ui.ddmanager.drop(this,e),this.options.revert?(o=(i=this).placeholder.offset(),s={},(n=this.options.axis)&&"x"!==n||(s.left=o.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(s.top=o.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,G(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){i._clear(e)})):this._clear(e,t),!1},cancel:function(){if(this.dragging){this._mouseUp(new G.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;0<=e;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),G.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?G(this.domPosition.prev).after(this.currentItem):G(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var e=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},G(e).each(function(){var e=(G(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);e&&i.push((t.key||e[1]+"[]")+"="+(t.key&&t.expression?e[1]:e[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(e){var t=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},t.each(function(){i.push(G(e.item||this).attr(e.attribute||"id")||"")}),i},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,o=this.positionAbs.top,n=o+this.helperProportions.height,s=e.left,a=s+e.width,r=e.top,l=r+e.height,c=this.offset.click.top,d=this.offset.click.left,c="x"===this.options.axis||r<o+c&&o+c<l,d="y"===this.options.axis||s<t+d&&t+d<a;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c&&d:s<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<a&&r<o+this.helperProportions.height/2&&n-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),e="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width);return!(!t||!e)&&(t=this.dragDirection.vertical,e=this.dragDirection.horizontal,this.floating?"right"===e||"down"===t?2:1:t&&("down"===t?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),o=this.dragDirection.vertical,e=this.dragDirection.horizontal;return this.floating&&e?"right"===e&&i||"left"===e&&!i:o&&("down"===o&&t||"up"===o&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(0<e?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(0<e?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(e){var t,i,o,n,s=[],a=[],r=this._connectWith();if(r&&e)for(t=r.length-1;0<=t;t--)for(i=(o=G(r[t],this.document[0])).length-1;0<=i;i--)(n=G.data(o[i],this.widgetFullName))&&n!==this&&!n.options.disabled&&a.push(["function"==typeof n.options.items?n.options.items.call(n.element):G(n.options.items,n.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),n]);function l(){s.push(this)}for(a.push(["function"==typeof this.options.items?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):G(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),t=a.length-1;0<=t;t--)a[t][0].each(l);return G(s)},_removeCurrentsFromItems:function(){var i=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=G.grep(this.items,function(e){for(var t=0;t<i.length;t++)if(i[t]===e.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var t,i,o,n,s,a,r,l,c=this.items,d=[["function"==typeof this.options.items?this.options.items.call(this.element[0],e,{item:this.currentItem}):G(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(t=h.length-1;0<=t;t--)for(i=(o=G(h[t],this.document[0])).length-1;0<=i;i--)(n=G.data(o[i],this.widgetFullName))&&n!==this&&!n.options.disabled&&(d.push(["function"==typeof n.options.items?n.options.items.call(n.element[0],e,{item:this.currentItem}):G(n.options.items,n.element),n]),this.containers.push(n));for(t=d.length-1;0<=t;t--)for(s=d[t][1],l=(a=d[t][i=0]).length;i<l;i++)(r=G(a[i])).data(this.widgetName+"-item",s),c.push({item:r,instance:s,width:0,height:0,left:0,top:0})},_refreshItemPositions:function(e){for(var t,i,o=this.items.length-1;0<=o;o--)t=this.items[o],this.currentContainer&&t.instance!==this.currentContainer&&t.item[0]!==this.currentItem[0]||(i=this.options.toleranceElement?G(this.options.toleranceElement,t.item):t.item,e||(t.width=i.outerWidth(),t.height=i.outerHeight()),i=i.offset(),t.left=i.left,t.top=i.top)},refreshPositions:function(e){var t,i;if(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),this._refreshItemPositions(e),this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(t=this.containers.length-1;0<=t;t--)i=this.containers[t].element.offset(),this.containers[t].containerCache.left=i.left,this.containers[t].containerCache.top=i.top,this.containers[t].containerCache.width=this.containers[t].element.outerWidth(),this.containers[t].containerCache.height=this.containers[t].element.outerHeight();return this},_createPlaceholder:function(i){var o,n,s=(i=i||this).options;s.placeholder&&s.placeholder.constructor!==String||(o=s.placeholder,n=i.currentItem[0].nodeName.toLowerCase(),s.placeholder={element:function(){var e=G("<"+n+">",i.document[0]);return i._addClass(e,"ui-sortable-placeholder",o||i.currentItem[0].className)._removeClass(e,"ui-sortable-helper"),"tbody"===n?i._createTrPlaceholder(i.currentItem.find("tr").eq(0),G("<tr>",i.document[0]).appendTo(e)):"tr"===n?i._createTrPlaceholder(i.currentItem,e):"img"===n&&e.attr("src",i.currentItem.attr("src")),o||e.css("visibility","hidden"),e},update:function(e,t){o&&!s.forcePlaceholderSize||(t.height()&&(!s.forcePlaceholderSize||"tbody"!==n&&"tr"!==n)||t.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10)),t.width()||t.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10)))}}),i.placeholder=G(s.placeholder.element.call(i.element,i.currentItem)),i.currentItem.after(i.placeholder),s.placeholder.update(i,i.placeholder)},_createTrPlaceholder:function(e,t){var i=this;e.children().each(function(){G("<td>&#160;</td>",i.document[0]).attr("colspan",G(this).attr("colspan")||1).appendTo(t)})},_contactContainers:function(e){for(var t,i,o,n,s,a,r,l,c,d=null,h=null,u=this.containers.length-1;0<=u;u--)G.contains(this.currentItem[0],this.containers[u].element[0])||(this._intersectsWith(this.containers[u].containerCache)?d&&G.contains(this.containers[u].element[0],d.element[0])||(d=this.containers[u],h=u):this.containers[u].containerCache.over&&(this.containers[u]._trigger("out",e,this._uiHash(this)),this.containers[u].containerCache.over=0));if(d)if(1===this.containers.length)this.containers[h].containerCache.over||(this.containers[h]._trigger("over",e,this._uiHash(this)),this.containers[h].containerCache.over=1);else{for(i=1e4,o=null,n=(l=d.floating||this._isFloating(this.currentItem))?"left":"top",s=l?"width":"height",c=l?"pageX":"pageY",t=this.items.length-1;0<=t;t--)G.contains(this.containers[h].element[0],this.items[t].item[0])&&this.items[t].item[0]!==this.currentItem[0]&&(a=this.items[t].item.offset()[n],r=!1,e[c]-a>this.items[t][s]/2&&(r=!0),Math.abs(e[c]-a)<i&&(i=Math.abs(e[c]-a),o=this.items[t],this.direction=r?"up":"down"));(o||this.options.dropOnEmpty)&&(this.currentContainer!==this.containers[h]?(o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[h].element,!0),this._trigger("change",e,this._uiHash()),this.containers[h]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[h],this.options.placeholder.update(this.currentContainer,this.placeholder),this.scrollParent=this.placeholder.scrollParent(),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this.containers[h]._trigger("over",e,this._uiHash(this)),this.containers[h].containerCache.over=1):this.currentContainer.containerCache.over||(this.containers[h]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1))}},_createHelper:function(e){var t=this.options;return(e="function"==typeof t.helper?G(t.helper.apply(this.element[0],[e,this.currentItem])):"clone"===t.helper?this.currentItem.clone():this.currentItem).parents("body").length||this.appendTo[0].appendChild(e[0]),e[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),e[0].style.width&&!t.forceHelperSize||e.width(this.currentItem.width()),e[0].style.height&&!t.forceHelperSize||e.height(this.currentItem.height()),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),"left"in(e=Array.isArray(e)?{left:+e[0],top:+e[1]||0}:e)&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&G.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),{top:(e=this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&G.ui.ie?{top:0,left:0}:e).top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,i=this.options;"parent"===i.containment&&(i.containment=this.helper[0].parentNode),"document"!==i.containment&&"window"!==i.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===i.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===i.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||(e=G(i.containment)[0],t=G(i.containment).offset(),i="hidden"!==G(e).css("overflow"),this.containment=[t.left+(parseInt(G(e).css("borderLeftWidth"),10)||0)+(parseInt(G(e).css("paddingLeft"),10)||0)-this.margins.left,t.top+(parseInt(G(e).css("borderTopWidth"),10)||0)+(parseInt(G(e).css("paddingTop"),10)||0)-this.margins.top,t.left+(i?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(G(e).css("borderLeftWidth"),10)||0)-(parseInt(G(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,t.top+(i?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(G(e).css("borderTopWidth"),10)||0)-(parseInt(G(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,t){t=t||this.position;var i="absolute"===e?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&G.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,e=/(html|body)/i.test(o[0].tagName);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():e?0:o.scrollTop())*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():e?0:o.scrollLeft())*i}},_generatePosition:function(e){var t=this.options,i=e.pageX,o=e.pageY,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&G.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(i=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(i=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),t.grid&&(e=this.originalPageY+Math.round((o-this.originalPageY)/t.grid[1])*t.grid[1],o=!this.containment||e-this.offset.click.top>=this.containment[1]&&e-this.offset.click.top<=this.containment[3]?e:e-this.offset.click.top>=this.containment[1]?e-t.grid[1]:e+t.grid[1],e=this.originalPageX+Math.round((i-this.originalPageX)/t.grid[0])*t.grid[0],i=!this.containment||e-this.offset.click.left>=this.containment[0]&&e-this.offset.click.left<=this.containment[2]?e:e-this.offset.click.left>=this.containment[0]?e-t.grid[0]:e+t.grid[0])),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop()),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())}},_rearrange:function(e,t,i,o){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!o)})},_clear:function(e,t){this.reverting=!1;var i,o=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();function n(t,i,o){return function(e){o._trigger(t,e,i._uiHash(i))}}for(this.fromOutside&&!t&&o.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||o.push(function(e){this._trigger("update",e,this._uiHash())}),this===this.currentContainer||t||(o.push(function(e){this._trigger("remove",e,this._uiHash())}),o.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),o.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer))),i=this.containers.length-1;0<=i;i--)t||o.push(n("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(o.push(n("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(i=0;i<o.length;i++)o[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===G.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var t=e||this;return{helper:t.helper,placeholder:t.placeholder||G([]),position:t.position,originalPosition:t.originalPosition,offset:t.positionAbs,item:t.currentItem,sender:e?e.element:null}}}),G.widget("ui.accordion",{version:"1.13.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:function(e){return e.find("> li > :first-child").add(e.find("> :not(li)").even())},heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=G(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||!1!==e.active&&null!=e.active||(e.active=0),this._processPanels(),e.active<0&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():G()}},_createIcons:function(){var e,t=this.options.icons;t&&(e=G("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+t.header),e.prependTo(this.headers),e=this.active.children(".ui-accordion-header-icon"),this._removeClass(e,t.header)._addClass(e,null,t.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){"active"!==e?("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||!1!==this.options.active||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons())):this._activate(t)},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",e),this._toggleClass(null,"ui-state-disabled",!!e),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!e)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var t=G.ui.keyCode,i=this.headers.length,o=this.headers.index(e.target),n=!1;switch(e.keyCode){case t.RIGHT:case t.DOWN:n=this.headers[(o+1)%i];break;case t.LEFT:case t.UP:n=this.headers[(o-1+i)%i];break;case t.SPACE:case t.ENTER:this._eventHandler(e);break;case t.HOME:n=this.headers[0];break;case t.END:n=this.headers[i-1]}n&&(G(e.target).attr("tabIndex",-1),G(n).attr("tabIndex",0),G(n).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===G.ui.keyCode.UP&&e.ctrlKey&&G(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),!1===e.active&&!0===e.collapsible||!this.headers.length?(e.active=!1,this.active=G()):!1===e.active?this._activate(0):this.active.length&&!G.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=G()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;"function"==typeof this.options.header?this.headers=this.options.header(this.element):this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var i,e=this.options,t=e.heightStyle,o=this.element.parent();this.active=this._findActive(e.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=G(this),t=e.uniqueId().attr("id"),i=e.next(),o=i.uniqueId().attr("id");e.attr("aria-controls",o),i.attr("aria-labelledby",t)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(e.event),"fill"===t?(i=o.height(),this.element.siblings(":visible").each(function(){var e=G(this),t=e.css("position");"absolute"!==t&&"fixed"!==t&&(i-=e.outerHeight(!0))}),this.headers.each(function(){i-=G(this).outerHeight(!0)}),this.headers.next().each(function(){G(this).height(Math.max(0,i-G(this).innerHeight()+G(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.headers.next().each(function(){var e=G(this).is(":visible");e||G(this).show(),i=Math.max(i,G(this).css("height","").height()),e||G(this).hide()}).height(i))},_activate:function(e){(e=this._findActive(e)[0])!==this.active[0]&&(e=e||this.active[0],this._eventHandler({target:e,currentTarget:e,preventDefault:G.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):G()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&G.each(e.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var t=this.options,i=this.active,o=G(e.currentTarget),n=o[0]===i[0],s=n&&t.collapsible,a=s?G():o.next(),r=i.next(),a={oldHeader:i,oldPanel:r,newHeader:s?G():o,newPanel:a};e.preventDefault(),n&&!t.collapsible||!1===this._trigger("beforeActivate",e,a)||(t.active=!s&&this.headers.index(o),this.active=n?G():o,this._toggle(a),this._removeClass(i,"ui-accordion-header-active","ui-state-active"),t.icons&&(i=i.children(".ui-accordion-header-icon"),this._removeClass(i,null,t.icons.activeHeader)._addClass(i,null,t.icons.header)),n||(this._removeClass(o,"ui-accordion-header-collapsed")._addClass(o,"ui-accordion-header-active","ui-state-active"),t.icons&&(n=o.children(".ui-accordion-header-icon"),this._removeClass(n,null,t.icons.header)._addClass(n,null,t.icons.activeHeader)),this._addClass(o.next(),"ui-accordion-content-active")))},_toggle:function(e){var t=e.newPanel,i=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=t,this.prevHide=i,this.options.animate?this._animate(t,i,e):(i.hide(),t.show(),this._toggleComplete(e)),i.attr({"aria-hidden":"true"}),i.prev().attr({"aria-selected":"false","aria-expanded":"false"}),t.length&&i.length?i.prev().attr({tabIndex:-1,"aria-expanded":"false"}):t.length&&this.headers.filter(function(){return 0===parseInt(G(this).attr("tabIndex"),10)}).attr("tabIndex",-1),t.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(e,i,t){var o,n=this,s=0,a=e.css("box-sizing"),r=e.length&&(!i.length||e.index()<i.index()),l=this.options.animate||{},c=r&&l.down||l,r=function(){n._toggleComplete(t)},d=(d="string"==typeof c?c:d)||c.easing||l.easing,h=(h="number"==typeof c?c:h)||c.duration||l.duration;return i.length?e.length?(o=e.show().outerHeight(),i.animate(this.hideProps,{duration:h,easing:d,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(this.showProps,{duration:h,easing:d,complete:r,step:function(e,t){t.now=Math.round(e),"height"!==t.prop?"content-box"===a&&(s+=t.now):"content"!==n.options.heightStyle&&(t.now=Math.round(o-i.outerHeight()-s),s=0)}})):i.animate(this.hideProps,h,d,r):e.animate(this.showProps,h,d,r)},_toggleComplete:function(e){var t=e.oldPanel,i=t.prev();this._removeClass(t,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),G.widget("ui.menu",{version:"1.13.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.lastMousePosition={x:null,y:null},this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault(),this._activateItem(e)},"click .ui-menu-item":function(e){var t=G(e.target),i=G(G.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&t.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),t.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&i.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":"_activateItem","mousemove .ui-menu-item":"_activateItem",mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this._menuItems().first();t||this.focus(e,i)},blur:function(e){this._delay(function(){G.contains(this.element[0],G.ui.safeActiveElement(this.document[0]))||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e,!0),this.mouseHandled=!1}})},_activateItem:function(e){var t,i;this.previousFilter||e.clientX===this.lastMousePosition.x&&e.clientY===this.lastMousePosition.y||(this.lastMousePosition={x:e.clientX,y:e.clientY},t=G(e.target).closest(".ui-menu-item"),i=G(e.currentTarget),t[0]!==i[0]||i.is(".ui-state-active")||(this._removeClass(i.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,i)))},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),e.children().each(function(){var e=G(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var t,i,o,n=!0;switch(e.keyCode){case G.ui.keyCode.PAGE_UP:this.previousPage(e);break;case G.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case G.ui.keyCode.HOME:this._move("first","first",e);break;case G.ui.keyCode.END:this._move("last","last",e);break;case G.ui.keyCode.UP:this.previous(e);break;case G.ui.keyCode.DOWN:this.next(e);break;case G.ui.keyCode.LEFT:this.collapse(e);break;case G.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case G.ui.keyCode.ENTER:case G.ui.keyCode.SPACE:this._activate(e);break;case G.ui.keyCode.ESCAPE:this.collapse(e);break;default:t=this.previousFilter||"",o=n=!1,i=96<=e.keyCode&&e.keyCode<=105?(e.keyCode-96).toString():String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),i===t?o=!0:i=t+i,t=this._filterMenuItems(i),(t=o&&-1!==t.index(this.active.next())?this.active.nextAll(".ui-menu-item"):t).length||(i=String.fromCharCode(e.keyCode),t=this._filterMenuItems(i)),t.length?(this.focus(e,t),this.previousFilter=i,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}n&&e.preventDefault()},_activate:function(e){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var e,t,o=this,n=this.options.icons.submenu,i=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),t=i.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=G(this),t=e.prev(),i=G("<span>").data("ui-menu-submenu-caret",!0);o._addClass(i,"ui-menu-icon","ui-icon "+n),t.attr("aria-haspopup","true").prepend(i),e.attr("aria-labelledby",t.attr("id"))}),this._addClass(t,"ui-menu","ui-widget ui-widget-content ui-front"),(e=i.add(this.element).find(this.options.items)).not(".ui-menu-item").each(function(){var e=G(this);o._isDivider(e)&&o._addClass(e,"ui-menu-divider","ui-widget-content")}),i=(t=e.not(".ui-menu-item, .ui-menu-divider")).children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(t,"ui-menu-item")._addClass(i,"ui-menu-item-wrapper"),e.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!G.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){var i;"icons"===e&&(i=this.element.find(".ui-menu-icon"),this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,t.submenu)),this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",String(e)),this._toggleClass(null,"ui-state-disabled",!!e)},focus:function(e,t){var i;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),i=this.active.children(".ui-menu-item-wrapper"),this._addClass(i,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",i.attr("id")),i=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(i,null,"ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=t.children(".ui-menu")).length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(e){var t,i,o;this._hasScroll()&&(i=parseFloat(G.css(this.activeMenu[0],"borderTopWidth"))||0,o=parseFloat(G.css(this.activeMenu[0],"paddingTop"))||0,t=e.offset().top-this.activeMenu.offset().top-i-o,i=this.activeMenu.scrollTop(),o=this.activeMenu.height(),e=e.outerHeight(),t<0?this.activeMenu.scrollTop(i+t):o<t+e&&this.activeMenu.scrollTop(i+t-o+e))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",e,{item:this.active}),this.active=null)},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(e){var t=G.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(t)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var e=i?this.element:G(t&&t.target).closest(this.element.find(".ui-menu"));e.length||(e=this.element),this._close(e),this.blur(t),this._removeClass(e.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=e},i?0:this.delay)},_close:function(e){(e=e||(this.active?this.active.parent():this.element)).find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!G(e.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this._menuItems(this.active.children(".ui-menu")).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_menuItems:function(e){return(e||this.element).find(this.options.items).filter(".ui-menu-item")},_move:function(e,t,i){var o;(o=this.active?"first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").last():this.active[e+"All"](".ui-menu-item").first():o)&&o.length&&this.active||(o=this._menuItems(this.activeMenu)[t]()),this.focus(i,o)},nextPage:function(e){var t,i,o;this.active?this.isLastItem()||(this._hasScroll()?(i=this.active.offset().top,o=this.element.innerHeight(),0===G.fn.jquery.indexOf("3.2.")&&(o+=this.element[0].offsetHeight-this.element.outerHeight()),this.active.nextAll(".ui-menu-item").each(function(){return(t=G(this)).offset().top-i-o<0}),this.focus(e,t)):this.focus(e,this._menuItems(this.activeMenu)[this.active?"last":"first"]())):this.next(e)},previousPage:function(e){var t,i,o;this.active?this.isFirstItem()||(this._hasScroll()?(i=this.active.offset().top,o=this.element.innerHeight(),0===G.fn.jquery.indexOf("3.2.")&&(o+=this.element[0].offsetHeight-this.element.outerHeight()),this.active.prevAll(".ui-menu-item").each(function(){return 0<(t=G(this)).offset().top-i+o}),this.focus(e,t)):this.focus(e,this._menuItems(this.activeMenu).first())):this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||G(e.target).closest(".ui-menu-item");var t={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,t)},_filterMenuItems:function(e){var e=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),t=new RegExp("^"+e,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return t.test(String.prototype.trim.call(G(this).children(".ui-menu-item-wrapper").text()))})}}),G.widget("ui.autocomplete",{version:"1.13.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,liveRegionTimer:null,_create:function(){var i,o,n,e="textarea"===(t=this.element[0].nodeName.toLowerCase()),t="input"===t;this.isMultiLine=e||!t&&this._isContentEditable(this.element),this.valueMethod=this.element[e||t?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(e){if(this.element.prop("readOnly"))o=n=i=!0;else{o=n=i=!1;var t=G.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:i=!0,this._move("previousPage",e);break;case t.PAGE_DOWN:i=!0,this._move("nextPage",e);break;case t.UP:i=!0,this._keyEvent("previous",e);break;case t.DOWN:i=!0,this._keyEvent("next",e);break;case t.ENTER:this.menu.active&&(i=!0,e.preventDefault(),this.menu.select(e));break;case t.TAB:this.menu.active&&this.menu.select(e);break;case t.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(e),e.preventDefault());break;default:o=!0,this._searchTimeout(e)}}},keypress:function(e){if(i)i=!1,this.isMultiLine&&!this.menu.element.is(":visible")||e.preventDefault();else if(!o){var t=G.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:this._move("previousPage",e);break;case t.PAGE_DOWN:this._move("nextPage",e);break;case t.UP:this._keyEvent("previous",e);break;case t.DOWN:this._keyEvent("next",e)}}},input:function(e){n?(n=!1,e.preventDefault()):this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){clearTimeout(this.searching),this.close(e),this._change(e)}}),this._initSource(),this.menu=G("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().attr({unselectable:"on"}).menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault()},menufocus:function(e,t){var i,o;this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){G(e.target).trigger(e.originalEvent)})):(o=t.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:o})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(o.value),(i=t.item.attr("aria-label")||o.value)&&String.prototype.trim.call(i).length&&(clearTimeout(this.liveRegionTimer),this.liveRegionTimer=this._delay(function(){this.liveRegion.html(G("<div>").text(i))},100)))},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),o=this.previous;this.element[0]!==G.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=o,this._delay(function(){this.previous=o,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=G("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var t=this.menu.element[0];return e.target===this.element[0]||e.target===t||G.contains(t,e.target)},_closeOnClickOutside:function(e){this._isEventTargetInWidget(e)||this.close()},_appendTo:function(){var e=this.options.appendTo;return(e=(e=e&&(e.jquery||e.nodeType?G(e):this.document.find(e).eq(0)))&&e[0]?e:this.element.closest(".ui-front, dialog")).length?e:this.document[0].body},_initSource:function(){var i,o,n=this;Array.isArray(this.options.source)?(i=this.options.source,this.source=function(e,t){t(G.ui.autocomplete.filter(i,e.term))}):"string"==typeof this.options.source?(o=this.options.source,this.source=function(e,t){n.xhr&&n.xhr.abort(),n.xhr=G.ajax({url:o,data:e,dataType:"json",success:function(e){t(e)},error:function(){t([])}})}):this.source=this.options.source},_searchTimeout:function(o){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),t=this.menu.element.is(":visible"),i=o.altKey||o.ctrlKey||o.metaKey||o.shiftKey;e&&(t||i)||(this.selectedItem=null,this.search(null,o))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")}.bind(this)},__response:function(e){e=e&&this._normalize(e),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:G.map(e,function(e){return"string"==typeof e?{label:e,value:e}:G.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var t=this.menu.element.empty();this._renderMenu(t,e),this.isNewMenu=!0,this.menu.refresh(),t.show(),this._resizeMenu(),t.position(G.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(i,e){var o=this;G.each(e,function(e,t){o._renderItemData(i,t)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(e,t){return G("<li>").append(G("<div>").text(t.label)).appendTo(e)},_move:function(e,t){if(this.menu.element.is(":visible"))return this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[e](t);this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())},_isContentEditable:function(e){if(!e.length)return!1;var t=e.prop("contentEditable");return"inherit"===t?this._isContentEditable(e.parent()):"true"===t}}),G.extend(G.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,t){var i=new RegExp(G.ui.autocomplete.escapeRegex(t),"i");return G.grep(e,function(e){return i.test(e.label||e.value||e)})}}),G.widget("ui.autocomplete",G.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(1<e?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,clearTimeout(this.liveRegionTimer),this.liveRegionTimer=this._delay(function(){this.liveRegion.html(G("<div>").text(t))},100))}}),G.ui.autocomplete;var H,u,p,z=/ui-corner-([a-z]){2,6}/g;function U(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:"",selectMonthLabel:"Select month",selectYearLabel:"Select year"},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,onUpdateDatepicker:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},G.extend(this._defaults,this.regional[""]),this.regional.en=G.extend(!0,{},this.regional[""]),this.regional["en-US"]=G.extend(!0,{},this.regional.en),this.dpDiv=V(G("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function V(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",t,function(){G(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&G(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&G(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",t,q)}function q(){G.datepicker._isDisabledDatepicker((u.inline?u.dpDiv.parent():u.input)[0])||(G(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),G(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&G(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&G(this).addClass("ui-datepicker-next-hover"))}function m(e,t){for(var i in G.extend(e,t),t)null==t[i]&&(e[i]=t[i])}function f(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}G.widget("ui.controlgroup",{version:"1.13.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var s=this,a=[];G.each(this.options.items,function(o,e){var t,n;if(e)return"controlgroupLabel"===o?((t=s.element.find(e)).each(function(){var e=G(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),s._addClass(t,null,"ui-widget ui-widget-content ui-state-default"),void(a=a.concat(t.get()))):void(G.fn[o]&&(n=s["_"+o+"Options"]?s["_"+o+"Options"]("middle"):{classes:{}},s.element.find(e).each(function(){var e=G(this),t=e[o]("instance"),i=G.widget.extend({},n);"button"===o&&e.parent(".ui-spinner").length||((t=t||e[o]()[o]("instance"))&&(i.classes=s._resolveClassesValues(i.classes,t)),e[o](i),i=e[o]("widget"),G.data(i[0],"ui-controlgroup-data",t||e[o]("instance")),a.push(i[0]))})))}),this.childWidgets=G(G.uniqueSort(a)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(t){this.childWidgets.each(function(){var e=G(this).data("ui-controlgroup-data");e&&e[t]&&e[t]()})},_updateCornerClass:function(e,t){t=this._buildSimpleOptions(t,"label").classes.label,this._removeClass(e,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(e,null,t)},_buildSimpleOptions:function(e,t){var i="vertical"===this.options.direction,o={classes:{}};return o.classes[t]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[e],o},_spinnerOptions:function(e){return(e=this._buildSimpleOptions(e,"ui-spinner")).classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(e){return this._buildSimpleOptions(e,"ui-button")},_checkboxradioOptions:function(e){return this._buildSimpleOptions(e,"ui-checkboxradio-label")},_selectmenuOptions:function(e){var t="vertical"===this.options.direction;return{width:t&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(t?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(t?"top":"left")},last:{"ui-selectmenu-button-open":t?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(t?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[e]}},_resolveClassesValues:function(i,o){var n={};return G.each(i,function(e){var t=o.options.classes[e]||"",t=String.prototype.trim.call(t.replace(z,""));n[e]=(t+" "+i[e]).replace(/\s+/g," ")}),n},_setOption:function(e,t){"direction"===e&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(e,t),"disabled"!==e?this.refresh():this._callChildMethod(t?"disable":"enable")},refresh:function(){var n,s=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),n=this.childWidgets,(n=this.options.onlyVisible?n.filter(":visible"):n).length&&(G.each(["first","last"],function(e,t){var i,o=n[t]().data("ui-controlgroup-data");o&&s["_"+o.widgetName+"Options"]?((i=s["_"+o.widgetName+"Options"](1===n.length?"only":t)).classes=s._resolveClassesValues(i.classes,o),o.element[o.widgetName](i)):s._updateCornerClass(n[t](),t)}),this._callChildMethod("refresh"))}}),G.widget("ui.checkboxradio",[G.ui.formResetMixin,{version:"1.13.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,t=this,i=this._super()||{};return this._readType(),e=this.element.labels(),this.label=G(e[e.length-1]),this.label.length||G.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){t.originalLabel+=3===this.nodeType?G(this).text():this.outerHTML}),this.originalLabel&&(i.label=this.originalLabel),null!=(e=this.element[0].disabled)&&(i.disabled=e),i},_create:function(){var e=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),e&&this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||G.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e=this.element[0].name,t="input[name='"+G.escapeSelector(e)+"']";return e?(this.form.length?G(this.form[0].elements).filter(t):G(t).filter(function(){return 0===G(this)._form().length})).not(this.element):G([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=G(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(e,t){"label"===e&&!t||(this._super(e,t),"disabled"===e?(this._toggleClass(this.label,null,"ui-state-disabled",t),this.element[0].disabled=t):this.refresh())},_updateIcon:function(e){var t="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=G("<span>"),this.iconSpace=G("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(t+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):t+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",t),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var e=this.label.contents().not(this.element[0]);this.icon&&(e=e.not(this.icon[0])),(e=this.iconSpace?e.not(this.iconSpace[0]):e).remove(),this.label.append(this.options.label)},refresh:function(){var e=this.element[0].checked,t=this.element[0].disabled;this._updateIcon(e),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),null!==this.options.label&&this._updateLabel(),t!==this.options.disabled&&this._setOptions({disabled:t})}}]),G.ui.checkboxradio,G.widget("ui.button",{version:"1.13.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var e,t=this._super()||{};return this.isInput=this.element.is("input"),null!=(e=this.element[0].disabled)&&(t.disabled=e),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(t.label=this.originalLabel),t},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===G.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,t){var i="iconPosition"!==e,o=i?this.options.iconPosition:t,e="top"===o||"bottom"===o;this.icon?i&&this._removeClass(this.icon,null,this.options.icon):(this.icon=G("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),i&&this._addClass(this.icon,null,t),this._attachIcon(o),e?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=G("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(o))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(e){this.icon[/^(?:end|bottom)/.test(e)?"before":"after"](this.iconSpace)},_attachIcon:function(e){this.element[/^(?:end|bottom)/.test(e)?"append":"prepend"](this.icon)},_setOptions:function(e){var t=(void 0===e.showLabel?this.options:e).showLabel,i=(void 0===e.icon?this.options:e).icon;t||i||(e.showLabel=!0),this._super(e)},_setOption:function(e,t){"icon"===e&&(t?this._updateIcon(e,t):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===e&&this._updateIcon(e,t),"showLabel"===e&&(this._toggleClass("ui-button-icon-only",null,!t),this._updateTooltip()),"label"===e&&(this.isInput?this.element.val(t):(this.element.html(t),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(e,t),"disabled"===e&&(this._toggleClass(null,"ui-state-disabled",t),(this.element[0].disabled=t)&&this.element.trigger("blur"))},refresh:function(){var e=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOptions({disabled:e}),this._updateTooltip()}}),!1!==G.uiBackCompat&&(G.widget("ui.button",G.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(e,t){"text"!==e?("showLabel"===e&&(this.options.text=t),"icon"===e&&(this.options.icons.primary=t),"icons"===e&&(t.primary?(this._super("icon",t.primary),this._super("iconPosition","beginning")):t.secondary&&(this._super("icon",t.secondary),this._super("iconPosition","end"))),this._superApply(arguments)):this._super("showLabel",t)}}),G.fn.button=(H=G.fn.button,function(i){var e="string"==typeof i,o=Array.prototype.slice.call(arguments,1),n=this;return e?this.length||"instance"!==i?this.each(function(){var e=G(this).attr("type"),t=G.data(this,"ui-"+("checkbox"!==e&&"radio"!==e?"button":"checkboxradio"));return"instance"===i?(n=t,!1):t?"function"!=typeof t[i]||"_"===i.charAt(0)?G.error("no such method '"+i+"' for button widget instance"):(e=t[i].apply(t,o))!==t&&void 0!==e?(n=e&&e.jquery?n.pushStack(e.get()):e,!1):void 0:G.error("cannot call methods on button prior to initialization; attempted to call method '"+i+"'")}):n=void 0:(o.length&&(i=G.widget.extend.apply(null,[i].concat(o))),this.each(function(){var e=G(this).attr("type"),t="checkbox"!==e&&"radio"!==e?"button":"checkboxradio";(e=G.data(this,"ui-"+t))?(e.option(i||{}),e._init&&e._init()):"button"!=t?G(this).checkboxradio(G.extend({icon:!1},i)):H.call(G(this),i)})),n}),G.fn.buttonset=function(){return G.ui.controlgroup||G.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),G.ui.button,G.extend(G.ui,{datepicker:{version:"1.13.1"}}),G.extend(U.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return m(this._defaults,e||{}),this},_attachDatepicker:function(e,t){var i,o=e.nodeName.toLowerCase(),n="div"===o||"span"===o;e.id||(this.uuid+=1,e.id="dp"+this.uuid),(i=this._newInst(G(e),n)).settings=G.extend({},t||{}),"input"===o?this._connectDatepicker(e,i):n&&this._inlineDatepicker(e,i)},_newInst:function(e,t){return{id:e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?V(G("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,t){var i=G(e);t.append=G([]),t.trigger=G([]),i.hasClass(this.markerClassName)||(this._attachments(i,t),i.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(t),G.data(e,"datepicker",t),t.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,t){var i,o=this._get(t,"appendText"),n=this._get(t,"isRTL");t.append&&t.append.remove(),o&&(t.append=G("<span>").addClass(this._appendClass).text(o),e[n?"before":"after"](t.append)),e.off("focus",this._showDatepicker),t.trigger&&t.trigger.remove(),"focus"!==(i=this._get(t,"showOn"))&&"both"!==i||e.on("focus",this._showDatepicker),"button"!==i&&"both"!==i||(o=this._get(t,"buttonText"),i=this._get(t,"buttonImage"),this._get(t,"buttonImageOnly")?t.trigger=G("<img>").addClass(this._triggerClass).attr({src:i,alt:o,title:o}):(t.trigger=G("<button type='button'>").addClass(this._triggerClass),i?t.trigger.html(G("<img>").attr({src:i,alt:o,title:o})):t.trigger.text(o)),e[n?"before":"after"](t.trigger),t.trigger.on("click",function(){return G.datepicker._datepickerShowing&&G.datepicker._lastInput===e[0]?G.datepicker._hideDatepicker():(G.datepicker._datepickerShowing&&G.datepicker._lastInput!==e[0]&&G.datepicker._hideDatepicker(),G.datepicker._showDatepicker(e[0])),!1}))},_autoSize:function(e){var t,i,o,n,s,a;this._get(e,"autoSize")&&!e.inline&&(s=new Date(2009,11,20),(a=this._get(e,"dateFormat")).match(/[DM]/)&&(s.setMonth((t=function(e){for(n=o=i=0;n<e.length;n++)e[n].length>i&&(i=e[n].length,o=n);return o})(this._get(e,a.match(/MM/)?"monthNames":"monthNamesShort"))),s.setDate(t(this._get(e,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-s.getDay())),e.input.attr("size",this._formatDate(e,s).length))},_inlineDatepicker:function(e,t){var i=G(e);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(t.dpDiv),G.data(e,"datepicker",t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.settings.disabled&&this._disableDatepicker(e),t.dpDiv.css("display","block"))},_dialogDatepicker:function(e,t,i,o,n){var s,a=this._dialogInst;return a||(this.uuid+=1,s="dp"+this.uuid,this._dialogInput=G("<input type='text' id='"+s+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),G("body").append(this._dialogInput),(a=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},G.data(this._dialogInput[0],"datepicker",a)),m(a.settings,o||{}),t=t&&t.constructor===Date?this._formatDate(a,t):t,this._dialogInput.val(t),this._pos=n?n.length?n:[n.pageX,n.pageY]:null,this._pos||(s=document.documentElement.clientWidth,o=document.documentElement.clientHeight,t=document.documentElement.scrollLeft||document.body.scrollLeft,n=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[s/2-100+t,o/2-150+n]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),a.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),G.blockUI&&G.blockUI(this.dpDiv),G.data(this._dialogInput[0],"datepicker",a),this},_destroyDatepicker:function(e){var t,i=G(e),o=G.data(e,"datepicker");i.hasClass(this.markerClassName)&&(t=e.nodeName.toLowerCase(),G.removeData(e,"datepicker"),"input"===t?(o.append.remove(),o.trigger.remove(),i.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):"div"!==t&&"span"!==t||i.removeClass(this.markerClassName).empty(),u===o&&(u=null,this._curInst=null))},_enableDatepicker:function(t){var e,i=G(t),o=G.data(t,"datepicker");i.hasClass(this.markerClassName)&&("input"===(e=t.nodeName.toLowerCase())?(t.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==e&&"span"!==e||((i=i.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=G.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var e,i=G(t),o=G.data(t,"datepicker");i.hasClass(this.markerClassName)&&("input"===(e=t.nodeName.toLowerCase())?(t.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==e&&"span"!==e||((i=i.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=G.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(e)for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(e){try{return G.data(e,"datepicker")}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,i){var o,n,s=this._getInst(e);if(2===arguments.length&&"string"==typeof t)return"defaults"===t?G.extend({},G.datepicker._defaults):s?"all"===t?G.extend({},s.settings):this._get(s,t):null;o=t||{},"string"==typeof t&&((o={})[t]=i),s&&(this._curInst===s&&this._hideDatepicker(),n=this._getDateDatepicker(e,!0),t=this._getMinMaxDate(s,"min"),i=this._getMinMaxDate(s,"max"),m(s.settings,o),null!==t&&void 0!==o.dateFormat&&void 0===o.minDate&&(s.settings.minDate=this._formatDate(s,t)),null!==i&&void 0!==o.dateFormat&&void 0===o.maxDate&&(s.settings.maxDate=this._formatDate(s,i)),"disabled"in o&&(o.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(G(e),s),this._autoSize(s),this._setDate(s,n),this._updateAlternate(s),this._updateDatepicker(s))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){(e=this._getInst(e))&&this._updateDatepicker(e)},_setDateDatepicker:function(e,t){(e=this._getInst(e))&&(this._setDate(e,t),this._updateDatepicker(e),this._updateAlternate(e))},_getDateDatepicker:function(e,t){return(e=this._getInst(e))&&!e.inline&&this._setDateFromField(e,t),e?this._getDate(e):null},_doKeyDown:function(e){var t,i,o=G.datepicker._getInst(e.target),n=!0,s=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,G.datepicker._datepickerShowing)switch(e.keyCode){case 9:G.datepicker._hideDatepicker(),n=!1;break;case 13:return(i=G("td."+G.datepicker._dayOverClass+":not(."+G.datepicker._currentClass+")",o.dpDiv))[0]&&G.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,i[0]),(t=G.datepicker._get(o,"onSelect"))?(i=G.datepicker._formatDate(o),t.apply(o.input?o.input[0]:null,[i,o])):G.datepicker._hideDatepicker(),!1;case 27:G.datepicker._hideDatepicker();break;case 33:G.datepicker._adjustDate(e.target,e.ctrlKey?-G.datepicker._get(o,"stepBigMonths"):-G.datepicker._get(o,"stepMonths"),"M");break;case 34:G.datepicker._adjustDate(e.target,e.ctrlKey?+G.datepicker._get(o,"stepBigMonths"):+G.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&G.datepicker._clearDate(e.target),n=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&G.datepicker._gotoToday(e.target),n=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&G.datepicker._adjustDate(e.target,s?1:-1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&G.datepicker._adjustDate(e.target,e.ctrlKey?-G.datepicker._get(o,"stepBigMonths"):-G.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&G.datepicker._adjustDate(e.target,-7,"D"),n=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&G.datepicker._adjustDate(e.target,s?-1:1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&G.datepicker._adjustDate(e.target,e.ctrlKey?+G.datepicker._get(o,"stepBigMonths"):+G.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&G.datepicker._adjustDate(e.target,7,"D"),n=e.ctrlKey||e.metaKey;break;default:n=!1}else 36===e.keyCode&&e.ctrlKey?G.datepicker._showDatepicker(this):n=!1;n&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t,i=G.datepicker._getInst(e.target);if(G.datepicker._get(i,"constrainInput"))return t=G.datepicker._possibleChars(G.datepicker._get(i,"dateFormat")),i=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||i<" "||!t||-1<t.indexOf(i)},_doKeyUp:function(e){if((e=G.datepicker._getInst(e.target)).input.val()!==e.lastVal)try{G.datepicker.parseDate(G.datepicker._get(e,"dateFormat"),e.input?e.input.val():null,G.datepicker._getFormatConfig(e))&&(G.datepicker._setDateFromField(e),G.datepicker._updateAlternate(e),G.datepicker._updateDatepicker(e))}catch(e){}return!0},_showDatepicker:function(e){var t,i,o,n;"input"!==(e=e.target||e).nodeName.toLowerCase()&&(e=G("input",e.parentNode)[0]),G.datepicker._isDisabledDatepicker(e)||G.datepicker._lastInput===e||(n=G.datepicker._getInst(e),G.datepicker._curInst&&G.datepicker._curInst!==n&&(G.datepicker._curInst.dpDiv.stop(!0,!0),n&&G.datepicker._datepickerShowing&&G.datepicker._hideDatepicker(G.datepicker._curInst.input[0])),!1!==(i=(o=G.datepicker._get(n,"beforeShow"))?o.apply(e,[e,n]):{})&&(m(n.settings,i),n.lastVal=null,G.datepicker._lastInput=e,G.datepicker._setDateFromField(n),G.datepicker._inDialog&&(e.value=""),G.datepicker._pos||(G.datepicker._pos=G.datepicker._findPos(e),G.datepicker._pos[1]+=e.offsetHeight),t=!1,G(e).parents().each(function(){return!(t|="fixed"===G(this).css("position"))}),o={left:G.datepicker._pos[0],top:G.datepicker._pos[1]},G.datepicker._pos=null,n.dpDiv.empty(),n.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),G.datepicker._updateDatepicker(n),o=G.datepicker._checkOffset(n,o,t),n.dpDiv.css({position:G.datepicker._inDialog&&G.blockUI?"static":t?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),n.inline||(i=G.datepicker._get(n,"showAnim"),o=G.datepicker._get(n,"duration"),n.dpDiv.css("z-index",function(e){for(var t;e.length&&e[0]!==document;){if(("absolute"===(t=e.css("position"))||"relative"===t||"fixed"===t)&&(t=parseInt(e.css("zIndex"),10),!isNaN(t)&&0!==t))return t;e=e.parent()}return 0}(G(e))+1),G.datepicker._datepickerShowing=!0,G.effects&&G.effects.effect[i]?n.dpDiv.show(i,G.datepicker._get(n,"showOptions"),o):n.dpDiv[i||"show"](i?o:null),G.datepicker._shouldFocusInput(n)&&n.input.trigger("focus"),G.datepicker._curInst=n)))},_updateDatepicker:function(e){this.maxRows=4,(u=e).dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var t,i=this._getNumberOfMonths(e),o=i[1],n=e.dpDiv.find("."+this._dayOverClass+" a"),s=G.datepicker._get(e,"onUpdateDatepicker");0<n.length&&q.apply(n.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),1<o&&e.dpDiv.addClass("ui-datepicker-multi-"+o).css("width",17*o+"em"),e.dpDiv[(1!==i[0]||1!==i[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===G.datepicker._curInst&&G.datepicker._datepickerShowing&&G.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(t=e.yearshtml,setTimeout(function(){t===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year").first().replaceWith(e.yearshtml),t=e.yearshtml=null},0)),s&&s.apply(e.input?e.input[0]:null,[e])},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(e,t,i){var o=e.dpDiv.outerWidth(),n=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,a=e.input?e.input.outerHeight():0,r=document.documentElement.clientWidth+(i?0:G(document).scrollLeft()),l=document.documentElement.clientHeight+(i?0:G(document).scrollTop());return t.left-=this._get(e,"isRTL")?o-s:0,t.left-=i&&t.left===e.input.offset().left?G(document).scrollLeft():0,t.top-=i&&t.top===e.input.offset().top+a?G(document).scrollTop():0,t.left-=Math.min(t.left,t.left+o>r&&o<r?Math.abs(t.left+o-r):0),t.top-=Math.min(t.top,t.top+n>l&&n<l?Math.abs(n+a):0),t},_findPos:function(e){for(var t=this._getInst(e),i=this._get(t,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||G.expr.pseudos.hidden(e));)e=e[i?"previousSibling":"nextSibling"];return[(t=G(e).offset()).left,t.top]},_hideDatepicker:function(e){var t,i,o=this._curInst;!o||e&&o!==G.data(e,"datepicker")||this._datepickerShowing&&(t=this._get(o,"showAnim"),i=this._get(o,"duration"),e=function(){G.datepicker._tidyDialog(o)},G.effects&&(G.effects.effect[t]||G.effects[t])?o.dpDiv.hide(t,G.datepicker._get(o,"showOptions"),i,e):o.dpDiv["slideDown"===t?"slideUp":"fadeIn"===t?"fadeOut":"hide"](t?i:null,e),t||e(),this._datepickerShowing=!1,(e=this._get(o,"onClose"))&&e.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),G.blockUI&&(G.unblockUI(),G("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){var t;G.datepicker._curInst&&(t=G(e.target),e=G.datepicker._getInst(t[0]),(!(t[0].id===G.datepicker._mainDivId||0!==t.parents("#"+G.datepicker._mainDivId).length||t.hasClass(G.datepicker.markerClassName)||t.closest("."+G.datepicker._triggerClass).length||!G.datepicker._datepickerShowing||G.datepicker._inDialog&&G.blockUI)||t.hasClass(G.datepicker.markerClassName)&&G.datepicker._curInst!==e)&&G.datepicker._hideDatepicker())},_adjustDate:function(e,t,i){var o=G(e),e=this._getInst(o[0]);this._isDisabledDatepicker(o[0])||(this._adjustInstDate(e,t,i),this._updateDatepicker(e))},_gotoToday:function(e){var t=G(e),i=this._getInst(t[0]);this._get(i,"gotoCurrent")&&i.currentDay?(i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear):(e=new Date,i.selectedDay=e.getDate(),i.drawMonth=i.selectedMonth=e.getMonth(),i.drawYear=i.selectedYear=e.getFullYear()),this._notifyChange(i),this._adjustDate(t)},_selectMonthYear:function(e,t,i){var o=G(e);(e=this._getInst(o[0]))["selected"+("M"===i?"Month":"Year")]=e["draw"+("M"===i?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(e),this._adjustDate(o)},_selectDay:function(e,t,i,o){var n=G(e);G(o).hasClass(this._unselectableClass)||this._isDisabledDatepicker(n[0])||((n=this._getInst(n[0])).selectedDay=n.currentDay=parseInt(G("a",o).attr("data-date")),n.selectedMonth=n.currentMonth=t,n.selectedYear=n.currentYear=i,this._selectDate(e,this._formatDate(n,n.currentDay,n.currentMonth,n.currentYear)))},_clearDate:function(e){e=G(e),this._selectDate(e,"")},_selectDate:function(e,t){var i=G(e),e=this._getInst(i[0]);t=null!=t?t:this._formatDate(e),e.input&&e.input.val(t),this._updateAlternate(e),(i=this._get(e,"onSelect"))?i.apply(e.input?e.input[0]:null,[t,e]):e.input&&e.input.trigger("change"),e.inline?this._updateDatepicker(e):(this._hideDatepicker(),this._lastInput=e.input[0],"object"!=typeof e.input[0]&&e.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var t,i,o=this._get(e,"altField");o&&(t=this._get(e,"altFormat")||this._get(e,"dateFormat"),i=this._getDate(e),e=this.formatDate(t,i,this._getFormatConfig(e)),G(document).find(o).val(e))},noWeekends:function(e){return[0<(e=e.getDay())&&e<6,""]},iso8601Week:function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()+4-(t.getDay()||7)),e=t.getTime(),t.setMonth(0),t.setDate(1),Math.floor(Math.round((e-t)/864e5)/7)+1},parseDate:function(t,n,e){if(null==t||null==n)throw"Invalid arguments";if(""===(n="object"==typeof n?n.toString():n+""))return null;for(var i,o,s=0,a="string"!=typeof(a=(e?e.shortYearCutoff:null)||this._defaults.shortYearCutoff)?a:(new Date).getFullYear()%100+parseInt(a,10),r=(e?e.dayNamesShort:null)||this._defaults.dayNamesShort,l=(e?e.dayNames:null)||this._defaults.dayNames,c=(e?e.monthNamesShort:null)||this._defaults.monthNamesShort,d=(e?e.monthNames:null)||this._defaults.monthNames,h=-1,u=-1,p=-1,m=-1,f=!1,g=function(e){return(e=v+1<t.length&&t.charAt(v+1)===e)&&v++,e},_=function(e){var t=g(e),t="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,t=new RegExp("^\\d{"+("y"===e?t:1)+","+t+"}");if(t=n.substring(s).match(t))return s+=t[0].length,parseInt(t[0],10);throw"Missing number at position "+s},b=function(e,t,i){var o=-1,t=G.map(g(e)?i:t,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(G.each(t,function(e,t){var i=t[1];if(n.substr(s,i.length).toLowerCase()===i.toLowerCase())return o=t[0],s+=i.length,!1}),-1!==o)return o+1;throw"Unknown name at position "+s},y=function(){if(n.charAt(s)!==t.charAt(v))throw"Unexpected literal at position "+s;s++},v=0;v<t.length;v++)if(f)"'"!==t.charAt(v)||g("'")?y():f=!1;else switch(t.charAt(v)){case"d":p=_("d");break;case"D":b("D",r,l);break;case"o":m=_("o");break;case"m":u=_("m");break;case"M":u=b("M",c,d);break;case"y":h=_("y");break;case"@":h=(o=new Date(_("@"))).getFullYear(),u=o.getMonth()+1,p=o.getDate();break;case"!":h=(o=new Date((_("!")-this._ticksTo1970)/1e4)).getFullYear(),u=o.getMonth()+1,p=o.getDate();break;case"'":g("'")?y():f=!0;break;default:y()}if(s<n.length&&(e=n.substr(s),!/^\s+/.test(e)))throw"Extra/unparsed characters found in date: "+e;if(-1===h?h=(new Date).getFullYear():h<100&&(h+=(new Date).getFullYear()-(new Date).getFullYear()%100+(h<=a?0:-100)),-1<m)for(u=1,p=m;!(p<=(i=this._getDaysInMonth(h,u-1)));)u++,p-=i;if((o=this._daylightSavingAdjust(new Date(h,u-1,p))).getFullYear()!==h||o.getMonth()+1!==u||o.getDate()!==p)throw"Invalid date";return o},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(t,e,i){if(!e)return"";function o(e,t,i){var o=""+t;if(d(e))for(;o.length<i;)o="0"+o;return o}function n(e,t,i,o){return(d(e)?o:i)[t]}var s,a=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,r=(i?i.dayNames:null)||this._defaults.dayNames,l=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,c=(i?i.monthNames:null)||this._defaults.monthNames,d=function(e){return(e=s+1<t.length&&t.charAt(s+1)===e)&&s++,e},h="",u=!1;if(e)for(s=0;s<t.length;s++)if(u)"'"!==t.charAt(s)||d("'")?h+=t.charAt(s):u=!1;else switch(t.charAt(s)){case"d":h+=o("d",e.getDate(),2);break;case"D":h+=n("D",e.getDay(),a,r);break;case"o":h+=o("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":h+=o("m",e.getMonth()+1,2);break;case"M":h+=n("M",e.getMonth(),l,c);break;case"y":h+=d("y")?e.getFullYear():(e.getFullYear()%100<10?"0":"")+e.getFullYear()%100;break;case"@":h+=e.getTime();break;case"!":h+=1e4*e.getTime()+this._ticksTo1970;break;case"'":d("'")?h+="'":u=!0;break;default:h+=t.charAt(s)}return h},_possibleChars:function(t){for(var e="",i=!1,o=function(e){return(e=n+1<t.length&&t.charAt(n+1)===e)&&n++,e},n=0;n<t.length;n++)if(i)"'"!==t.charAt(n)||o("'")?e+=t.charAt(n):i=!1;else switch(t.charAt(n)){case"d":case"m":case"y":case"@":e+="0123456789";break;case"D":case"M":return null;case"'":o("'")?e+="'":i=!0;break;default:e+=t.charAt(n)}return e},_get:function(e,t){return(void 0!==e.settings[t]?e.settings:this._defaults)[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),o=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),s=n,a=this._getFormatConfig(e);try{s=this.parseDate(i,o,a)||n}catch(e){o=t?"":o}e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),e.currentDay=o?s.getDate():0,e.currentMonth=o?s.getMonth():0,e.currentYear=o?s.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(r,e,t){var i,o;return(e=(e=null==e||""===e?t:"string"==typeof e?function(e){try{return G.datepicker.parseDate(G.datepicker._get(r,"dateFormat"),e,G.datepicker._getFormatConfig(r))}catch(e){}for(var t=(e.toLowerCase().match(/^c/)?G.datepicker._getDate(r):null)||new Date,i=t.getFullYear(),o=t.getMonth(),n=t.getDate(),s=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,a=s.exec(e);a;){switch(a[2]||"d"){case"d":case"D":n+=parseInt(a[1],10);break;case"w":case"W":n+=7*parseInt(a[1],10);break;case"m":case"M":o+=parseInt(a[1],10),n=Math.min(n,G.datepicker._getDaysInMonth(i,o));break;case"y":case"Y":i+=parseInt(a[1],10),n=Math.min(n,G.datepicker._getDaysInMonth(i,o))}a=s.exec(e)}return new Date(i,o,n)}(e):"number"==typeof e?isNaN(e)?t:(i=e,(o=new Date).setDate(o.getDate()+i),o):new Date(e.getTime()))&&"Invalid Date"===e.toString()?t:e)&&(e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0)),this._daylightSavingAdjust(e)},_daylightSavingAdjust:function(e){return e?(e.setHours(12<e.getHours()?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var o=!t,n=e.selectedMonth,s=e.selectedYear,t=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=t.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=t.getMonth(),e.drawYear=e.selectedYear=e.currentYear=t.getFullYear(),n===e.selectedMonth&&s===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(o?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(e){var t=this._get(e,"stepMonths"),i="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){G.datepicker._adjustDate(i,-t,"M")},next:function(){G.datepicker._adjustDate(i,+t,"M")},hide:function(){G.datepicker._hideDatepicker()},today:function(){G.datepicker._gotoToday(i)},selectDay:function(){return G.datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return G.datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return G.datepicker._selectMonthYear(i,this,"Y"),!1}};G(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,o,n,s,O,N,F,B,a,r,$,l,c,d,h,u,p,m,f,g,_,W,b,y,v,k,H,z,w,T,S,x=new Date,U=this._daylightSavingAdjust(new Date(x.getFullYear(),x.getMonth(),x.getDate())),C=this._get(e,"isRTL"),V=this._get(e,"showButtonPanel"),D=this._get(e,"hideIfNoPrevNext"),L=this._get(e,"navigationAsDateFormat"),A=this._getNumberOfMonths(e),I=this._get(e,"showCurrentAtPos"),x=this._get(e,"stepMonths"),q=1!==A[0]||1!==A[1],R=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),E=this._getMinMaxDate(e,"min"),P=this._getMinMaxDate(e,"max"),M=e.drawMonth-I,j=e.drawYear;if(M<0&&(M+=12,j--),P)for(t=this._daylightSavingAdjust(new Date(P.getFullYear(),P.getMonth()-A[0]*A[1]+1,P.getDate())),t=E&&t<E?E:t;this._daylightSavingAdjust(new Date(j,M,1))>t;)--M<0&&(M=11,j--);for(e.drawMonth=M,e.drawYear=j,I=this._get(e,"prevText"),I=L?this.formatDate(I,this._daylightSavingAdjust(new Date(j,M-x,1)),this._getFormatConfig(e)):I,i=this._canAdjustMonth(e,-1,j,M)?G("<a>").attr({class:"ui-datepicker-prev ui-corner-all","data-handler":"prev","data-event":"click",title:I}).append(G("<span>").addClass("ui-icon ui-icon-circle-triangle-"+(C?"e":"w")).text(I))[0].outerHTML:D?"":G("<a>").attr({class:"ui-datepicker-prev ui-corner-all ui-state-disabled",title:I}).append(G("<span>").addClass("ui-icon ui-icon-circle-triangle-"+(C?"e":"w")).text(I))[0].outerHTML,I=this._get(e,"nextText"),I=L?this.formatDate(I,this._daylightSavingAdjust(new Date(j,M+x,1)),this._getFormatConfig(e)):I,o=this._canAdjustMonth(e,1,j,M)?G("<a>").attr({class:"ui-datepicker-next ui-corner-all","data-handler":"next","data-event":"click",title:I}).append(G("<span>").addClass("ui-icon ui-icon-circle-triangle-"+(C?"w":"e")).text(I))[0].outerHTML:D?"":G("<a>").attr({class:"ui-datepicker-next ui-corner-all ui-state-disabled",title:I}).append(G("<span>").attr("class","ui-icon ui-icon-circle-triangle-"+(C?"w":"e")).text(I))[0].outerHTML,x=this._get(e,"currentText"),D=this._get(e,"gotoCurrent")&&e.currentDay?R:U,x=L?this.formatDate(x,D,this._getFormatConfig(e)):x,I="",e.inline||(I=G("<button>").attr({type:"button",class:"ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all","data-handler":"hide","data-event":"click"}).text(this._get(e,"closeText"))[0].outerHTML),L="",V&&(L=G("<div class='ui-datepicker-buttonpane ui-widget-content'>").append(C?I:"").append(this._isInRange(e,D)?G("<button>").attr({type:"button",class:"ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all","data-handler":"today","data-event":"click"}).text(x):"").append(C?"":I)[0].outerHTML),n=parseInt(this._get(e,"firstDay"),10),n=isNaN(n)?0:n,s=this._get(e,"showWeek"),O=this._get(e,"dayNames"),N=this._get(e,"dayNamesMin"),F=this._get(e,"monthNames"),B=this._get(e,"monthNamesShort"),a=this._get(e,"beforeShowDay"),r=this._get(e,"showOtherMonths"),$=this._get(e,"selectOtherMonths"),l=this._getDefaultDate(e),c="",h=0;h<A[0];h++){for(u="",this.maxRows=4,p=0;p<A[1];p++){if(m=this._daylightSavingAdjust(new Date(j,M,e.selectedDay)),f=" ui-corner-all",g="",q){if(g+="<div class='ui-datepicker-group",1<A[1])switch(p){case 0:g+=" ui-datepicker-group-first",f=" ui-corner-"+(C?"right":"left");break;case A[1]-1:g+=" ui-datepicker-group-last",f=" ui-corner-"+(C?"left":"right");break;default:g+=" ui-datepicker-group-middle",f=""}g+="'>"}for(g+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+f+"'>"+(/all|left/.test(f)&&0===h?C?o:i:"")+(/all|right/.test(f)&&0===h?C?i:o:"")+this._generateMonthYearHeader(e,M,j,E,P,0<h||0<p,F,B)+"</div><table class='ui-datepicker-calendar'><thead><tr>",_=s?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",d=0;d<7;d++)_+="<th scope='col'"+(5<=(d+n+6)%7?" class='ui-datepicker-week-end'":"")+"><span title='"+O[W=(d+n)%7]+"'>"+N[W]+"</span></th>";for(g+=_+"</tr></thead><tbody>",y=this._getDaysInMonth(j,M),j===e.selectedYear&&M===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,y)),b=(this._getFirstDayOfMonth(j,M)-n+7)%7,y=Math.ceil((b+y)/7),v=q&&this.maxRows>y?this.maxRows:y,this.maxRows=v,k=this._daylightSavingAdjust(new Date(j,M,1-b)),H=0;H<v;H++){for(g+="<tr>",z=s?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(k)+"</td>":"",d=0;d<7;d++)w=a?a.apply(e.input?e.input[0]:null,[k]):[!0,""],S=(T=k.getMonth()!==M)&&!$||!w[0]||E&&k<E||P&&P<k,z+="<td class='"+(5<=(d+n+6)%7?" ui-datepicker-week-end":"")+(T?" ui-datepicker-other-month":"")+(k.getTime()===m.getTime()&&M===e.selectedMonth&&e._keyEvent||l.getTime()===k.getTime()&&l.getTime()===m.getTime()?" "+this._dayOverClass:"")+(S?" "+this._unselectableClass+" ui-state-disabled":"")+(T&&!r?"":" "+w[1]+(k.getTime()===R.getTime()?" "+this._currentClass:"")+(k.getTime()===U.getTime()?" ui-datepicker-today":""))+"'"+(T&&!r||!w[2]?"":" title='"+w[2].replace(/'/g,"&#39;")+"'")+(S?"":" data-handler='selectDay' data-event='click' data-month='"+k.getMonth()+"' data-year='"+k.getFullYear()+"'")+">"+(T&&!r?"&#xa0;":S?"<span class='ui-state-default'>"+k.getDate()+"</span>":"<a class='ui-state-default"+(k.getTime()===U.getTime()?" ui-state-highlight":"")+(k.getTime()===R.getTime()?" ui-state-active":"")+(T?" ui-priority-secondary":"")+"' href='#' aria-current='"+(k.getTime()===R.getTime()?"true":"false")+"' data-date='"+k.getDate()+"'>"+k.getDate()+"</a>")+"</td>",k.setDate(k.getDate()+1),k=this._daylightSavingAdjust(k);g+=z+"</tr>"}11<++M&&(M=0,j++),u+=g+="</tbody></table>"+(q?"</div>"+(0<A[0]&&p===A[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}c+=u}return c+=L,e._keyEvent=!1,c},_generateMonthYearHeader:function(e,t,i,o,n,s,a,r){var l,c,d,h,u,p,m=this._get(e,"changeMonth"),f=this._get(e,"changeYear"),g=this._get(e,"showMonthAfterYear"),_=this._get(e,"selectMonthLabel"),b=this._get(e,"selectYearLabel"),y="<div class='ui-datepicker-title'>",v="";if(s||!m)v+="<span class='ui-datepicker-month'>"+a[t]+"</span>";else{for(l=o&&o.getFullYear()===i,c=n&&n.getFullYear()===i,v+="<select class='ui-datepicker-month' aria-label='"+_+"' data-handler='selectMonth' data-event='change'>",d=0;d<12;d++)(!l||d>=o.getMonth())&&(!c||d<=n.getMonth())&&(v+="<option value='"+d+"'"+(d===t?" selected='selected'":"")+">"+r[d]+"</option>");v+="</select>"}if(g||(y+=v+(!s&&m&&f?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",s||!f)y+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(a=this._get(e,"yearRange").split(":"),h=(new Date).getFullYear(),u=(_=function(e){return e=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?h+parseInt(e,10):parseInt(e,10),isNaN(e)?h:e})(a[0]),p=Math.max(u,_(a[1]||"")),u=o?Math.max(u,o.getFullYear()):u,p=n?Math.min(p,n.getFullYear()):p,e.yearshtml+="<select class='ui-datepicker-year' aria-label='"+b+"' data-handler='selectYear' data-event='change'>";u<=p;u++)e.yearshtml+="<option value='"+u+"'"+(u===i?" selected='selected'":"")+">"+u+"</option>";e.yearshtml+="</select>",y+=e.yearshtml,e.yearshtml=null}return y+=this._get(e,"yearSuffix"),g&&(y+=(!s&&m&&f?"":"&#xa0;")+v),y+"</div>"},_adjustInstDate:function(e,t,i){var o=e.selectedYear+("Y"===i?t:0),n=e.selectedMonth+("M"===i?t:0),t=Math.min(e.selectedDay,this._getDaysInMonth(o,n))+("D"===i?t:0),t=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(o,n,t)));e.selectedDay=t.getDate(),e.drawMonth=e.selectedMonth=t.getMonth(),e.drawYear=e.selectedYear=t.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),t=i&&t<i?i:t;return(e=this._getMinMaxDate(e,"max"))&&e<t?e:t},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){return null==(e=this._get(e,"numberOfMonths"))?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,o){var n=this._getNumberOfMonths(e),n=this._daylightSavingAdjust(new Date(i,o+(t<0?t:n[0]*n[1]),1));return t<0&&n.setDate(this._getDaysInMonth(n.getFullYear(),n.getMonth())),this._isInRange(e,n)},_isInRange:function(e,t){var i=this._getMinMaxDate(e,"min"),o=this._getMinMaxDate(e,"max"),n=null,s=null,a=this._get(e,"yearRange");return a&&(e=a.split(":"),a=(new Date).getFullYear(),n=parseInt(e[0],10),s=parseInt(e[1],10),e[0].match(/[+\-].*/)&&(n+=a),e[1].match(/[+\-].*/)&&(s+=a)),(!i||t.getTime()>=i.getTime())&&(!o||t.getTime()<=o.getTime())&&(!n||t.getFullYear()>=n)&&(!s||t.getFullYear()<=s)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,o){return t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear),t=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(o,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay)),this.formatDate(this._get(e,"dateFormat"),t,this._getFormatConfig(e))}}),G.fn.datepicker=function(e){if(!this.length)return this;G.datepicker.initialized||(G(document).on("mousedown",G.datepicker._checkExternalClick),G.datepicker.initialized=!0),0===G("#"+G.datepicker._mainDivId).length&&G("body").append(G.datepicker.dpDiv);var t=Array.prototype.slice.call(arguments,1);return"string"==typeof e&&("isDisabled"===e||"getDate"===e||"widget"===e)||"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?G.datepicker["_"+e+"Datepicker"].apply(G.datepicker,[this[0]].concat(t)):this.each(function(){"string"==typeof e?G.datepicker["_"+e+"Datepicker"].apply(G.datepicker,[this].concat(t)):G.datepicker._attachDatepicker(this,e)})},G.datepicker=new U,G.datepicker.initialized=!1,G.datepicker.uuid=(new Date).getTime(),G.datepicker.version="1.13.1",G.datepicker,G.widget("ui.dialog",{version:"1.13.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var t=G(this).css(e).offset().top;t<0&&G(this).css("top",e.top-t)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&G.fn.draggable&&this._makeDraggable(),this.options.resizable&&G.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?G(e):this.document.find(e||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:G.noop,enable:G.noop,close:function(e){var t=this;this._isOpen&&!1!==this._trigger("beforeClose",e)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||G.ui.safeBlur(G.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){t._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var i=!1,o=this.uiDialog.siblings(".ui-front:visible").map(function(){return+G(this).css("z-index")}).get();return(o=Math.max.apply(null,o))>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),i=!0),i&&!t&&this._trigger("focus",e),i},open:function(){var e=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=G(G.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"))},_focusTabbable:function(){var e=this._focusedElement;(e=(e=(e=(e=(e=e||this.element.find("[autofocus]")).length?e:this.element.find(":tabbable")).length?e:this.uiDialogButtonPane.find(":tabbable")).length?e:this.uiDialogTitlebarClose.filter(":tabbable")).length?e:this.uiDialog).eq(0).trigger("focus")},_restoreTabbableFocus:function(){var e=G.ui.safeActiveElement(this.document[0]);this.uiDialog[0]===e||G.contains(this.uiDialog[0],e)||this._focusTabbable()},_keepFocus:function(e){e.preventDefault(),this._restoreTabbableFocus(),this._delay(this._restoreTabbableFocus)},_createWrapper:function(){this.uiDialog=G("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){var t,i,o;this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===G.ui.keyCode.ESCAPE?(e.preventDefault(),this.close(e)):e.keyCode!==G.ui.keyCode.TAB||e.isDefaultPrevented()||(t=this.uiDialog.find(":tabbable"),i=t.first(),o=t.last(),e.target!==o[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==i[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){o.trigger("focus")}),e.preventDefault()):(this._delay(function(){i.trigger("focus")}),e.preventDefault()))},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=G("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){G(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=G("<button type='button'></button>").button({label:G("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),e=G("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(e){this.options.title?e.text(this.options.title):e.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=G("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=G("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var o=this,e=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),G.isEmptyObject(e)||Array.isArray(e)&&!e.length?this._removeClass(this.uiDialog,"ui-dialog-buttons"):(G.each(e,function(e,t){var i;t=G.extend({type:"button"},t="function"==typeof t?{click:t,text:e}:t),i=t.click,e={icon:t.icon,iconPosition:t.iconPosition,showLabel:t.showLabel,icons:t.icons,text:t.text},delete t.click,delete t.icon,delete t.iconPosition,delete t.showLabel,delete t.icons,"boolean"==typeof t.text&&delete t.text,G("<button></button>",t).button(e).appendTo(o.uiButtonSet).on("click",function(){i.apply(o.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){var n=this,s=this.options;function a(e){return{position:e.position,offset:e.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(e,t){n._addClass(G(this),"ui-dialog-dragging"),n._blockFrames(),n._trigger("dragStart",e,a(t))},drag:function(e,t){n._trigger("drag",e,a(t))},stop:function(e,t){var i=t.offset.left-n.document.scrollLeft(),o=t.offset.top-n.document.scrollTop();s.position={my:"left top",at:"left"+(0<=i?"+":"")+i+" top"+(0<=o?"+":"")+o,of:n.window},n._removeClass(G(this),"ui-dialog-dragging"),n._unblockFrames(),n._trigger("dragStop",e,a(t))}})},_makeResizable:function(){var n=this,s=this.options,e=s.resizable,t=this.uiDialog.css("position"),e="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";function a(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:e,start:function(e,t){n._addClass(G(this),"ui-dialog-resizing"),n._blockFrames(),n._trigger("resizeStart",e,a(t))},resize:function(e,t){n._trigger("resize",e,a(t))},stop:function(e,t){var i=(o=n.uiDialog.offset()).left-n.document.scrollLeft(),o=o.top-n.document.scrollTop();s.height=n.uiDialog.height(),s.width=n.uiDialog.width(),s.position={my:"left top",at:"left"+(0<=i?"+":"")+i+" top"+(0<=o?"+":"")+o,of:n.window},n._removeClass(G(this),"ui-dialog-resizing"),n._unblockFrames(),n._trigger("resizeStop",e,a(t))}}).css("position",t)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=G(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),t=G.inArray(this,e);-1!==t&&e.splice(t,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||this.document.data("ui-dialog-instances",e=[]),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(e){var i=this,o=!1,n={};G.each(e,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(o=!0),e in i.resizableRelatedOptions&&(n[e]=t)}),o&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,o=this.uiDialog;"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:G("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&((i=o.is(":data(ui-draggable)"))&&!t&&o.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((i=o.is(":data(ui-resizable)"))&&!t&&o.resizable("destroy"),i&&"string"==typeof t&&o.resizable("option","handles",t),i||!1===t||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,o=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),o.minWidth>o.width&&(o.width=o.minWidth),e=this.uiDialog.css({height:"auto",width:o.width}).outerHeight(),t=Math.max(0,o.minHeight-e),i="number"==typeof o.maxHeight?Math.max(0,o.maxHeight-e):"none","auto"===o.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,o.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=G(this);return G("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!G(e.target).closest(".ui-dialog").length||!!G(e.target).closest(".ui-datepicker").length},_createOverlay:function(){var i,o;this.options.modal&&(i=G.fn.jquery.substring(0,4),o=!0,this._delay(function(){o=!1}),this.document.data("ui-dialog-overlays")||this.document.on("focusin.ui-dialog",function(e){var t;o||(t=this._trackingInstances()[0])._allowInteraction(e)||(e.preventDefault(),t._focusTabbable(),"3.4."!==i&&"3.5."!==i||t._delay(t._restoreTabbableFocus))}.bind(this)),this.overlay=G("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1))},_destroyOverlay:function(){var e;this.options.modal&&this.overlay&&((e=this.document.data("ui-dialog-overlays")-1)?this.document.data("ui-dialog-overlays",e):(this.document.off("focusin.ui-dialog"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null)}}),!1!==G.uiBackCompat&&G.widget("ui.dialog",G.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(e,t){"dialogClass"===e&&this.uiDialog.removeClass(this.options.dialogClass).addClass(t),this._superApply(arguments)}}),G.ui.dialog,G.widget("ui.progressbar",{version:"1.13.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=G("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(e){if(void 0===e)return this.options.value;this.options.value=this._constrainedValue(e),this._refreshValue()},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=!1===e,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",e),this._toggleClass(null,"ui-state-disabled",!!e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,t=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(t.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=G("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),G.widget("ui.selectmenu",[G.ui.formResetMixin,{version:"1.13.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=G()},_drawButton:function(){var e,t=this,i=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(e){this.button.trigger("focus"),e.preventDefault()}}),this.element.hide(),this.button=G("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=G("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(i).appendTo(this.button),!1!==this.options.width&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){t._rendered||t._refreshMenu()})},_drawMenu:function(){var i=this;this.menu=G("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=G("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(e,t){e.preventDefault(),i._setSelection(),i._select(t.item.data("ui-selectmenu-item"),e)},focus:function(e,t){t=t.item.data("ui-selectmenu-item"),null!=i.focusIndex&&t.index!==i.focusIndex&&(i._trigger("focus",e,{item:t}),i.isOpen||i._select(t,e)),i.focusIndex=t.index,i.button.attr("aria-activedescendant",i.menuItems.eq(t.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e)))},_position:function(){this.menuWrap.position(G.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var t=G("<span>");return this._setText(t,e.label),this._addClass(t,"ui-selectmenu-text"),t},_renderMenu:function(o,e){var n=this,s="";G.each(e,function(e,t){var i;t.optgroup!==s&&(i=G("<li>",{text:t.optgroup}),n._addClass(i,"ui-selectmenu-optgroup","ui-menu-divider"+(t.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),i.appendTo(o),s=t.optgroup),n._renderItemData(o,t)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(e,t){var i=G("<li>"),o=G("<div>",{title:t.element.attr("title")});return t.disabled&&this._addClass(i,null,"ui-state-disabled"),this._setText(o,t.label),i.append(o).appendTo(e)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,o=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),o+=":not(.ui-state-disabled)"),(o="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](o).eq(-1):i[e+"All"](o).eq(0)).length&&this.menuInstance.focus(t,o)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?((e=window.getSelection()).removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){!this.isOpen||G(e.target).closest(".ui-selectmenu-menu, #"+G.escapeSelector(this.ids.button)).length||this.close(e)}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection()).rangeCount&&(this.range=e.getRangeAt(0)):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(e){var t=!0;switch(e.keyCode){case G.ui.keyCode.TAB:case G.ui.keyCode.ESCAPE:this.close(e),t=!1;break;case G.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case G.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case G.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case G.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case G.ui.keyCode.LEFT:this._move("prev",e);break;case G.ui.keyCode.RIGHT:this._move("next",e);break;case G.ui.keyCode.HOME:case G.ui.keyCode.PAGE_UP:this._move("first",e);break;case G.ui.keyCode.END:case G.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),t=!1}t&&e.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex).parent("li");t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(e)),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){e=this.menuItems.eq(e.index).attr("id"),this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(e,t){var i;"icons"===e&&(i=this.button.find("span.ui-icon"),this._removeClass(i,null,this.options.icons.button)._addClass(i,null,t.button)),this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"width"===e&&this._resizeButton()},_setOptionDisabled:function(e){this._super(e),this.menuInstance.option("disabled",e),this.button.attr("aria-disabled",e),this._toggleClass(this.button,null,"ui-state-disabled",e),this.element.prop("disabled",e),e?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return(e=(e=e&&(e.jquery||e.nodeType?G(e):this.document.find(e).eq(0)))&&e[0]?e:this.element.closest(".ui-front, dialog")).length?e:this.document[0].body},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;!1!==e?(null===e&&(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e)):this.button.css("width","")},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var e=this._super();return e.disabled=this.element.prop("disabled"),e},_parseOptions:function(e){var i=this,o=[];e.each(function(e,t){t.hidden||o.push(i._parseOption(G(t),e))}),this.items=o},_parseOption:function(e,t){var i=e.parent("optgroup");return{element:e,index:t,value:e.val(),label:e.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||e.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),G.widget("ui.slider",G.ui.mouse,{version:"1.13.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,t=this.options,i=this.element.find(".ui-slider-handle"),o=[],n=t.values&&t.values.length||1;for(i.length>n&&(i.slice(n).remove(),i=i.slice(0,n)),e=i.length;e<n;e++)o.push("<span tabindex='0'></span>");this.handles=i.add(G(o.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){G(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(!0===e.range&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:Array.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=G("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),"min"!==e.range&&"max"!==e.range||this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,o,n,s,t,a,r=this,l=this.options;return!l.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),a={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(a),o=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var t=Math.abs(i-r.values(e));(t<o||o===t&&(e===r._lastChangedValue||r.values(e)===l.min))&&(o=t,n=G(this),s=e)}),!1!==this._start(e,s)&&(this._mouseSliding=!0,this._handleIndex=s,this._addClass(n,null,"ui-state-active"),n.trigger("focus"),t=n.offset(),a=!G(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=a?{left:0,top:0}:{left:e.pageX-t.left-n.width()/2,top:e.pageY-t.top-n.height()/2-(parseInt(n.css("borderTopWidth"),10)||0)-(parseInt(n.css("borderBottomWidth"),10)||0)+(parseInt(n.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,s,i),this._animateOff=!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},t=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,t),!1},_mouseStop:function(e){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t;return(e=1<(e=(e="horizontal"===this.orientation?(t=this.elementSize.width,e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)))/t)?1:e)<0&&(e=0),"vertical"===this.orientation&&(e=1-e),t=this._valueMax()-this._valueMin(),t=this._valueMin()+e*t,this._trimAlignValue(t)},_uiHash:function(e,t,i){var o={handle:this.handles[e],handleIndex:e,value:void 0!==t?t:this.value()};return this._hasMultipleValues()&&(o.value=void 0!==t?t:this.values(e),o.values=i||this.values()),o},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(e,t){return this._trigger("start",e,this._uiHash(t))},_slide:function(e,t,i){var o,n=this.value(),s=this.values();this._hasMultipleValues()&&(o=this.values(t?0:1),n=this.values(t),2===this.options.values.length&&!0===this.options.range&&(i=0===t?Math.min(o,i):Math.max(o,i)),s[t]=i),i!==n&&!1!==this._trigger("slide",e,this._uiHash(t,i,s))&&(this._hasMultipleValues()?this.values(t,i):this.value(i))},_stop:function(e,t){this._trigger("stop",e,this._uiHash(t))},_change:function(e,t){this._keySliding||this._mouseSliding||(this._lastChangedValue=t,this._trigger("change",e,this._uiHash(t)))},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,t){var i,o,n;if(1<arguments.length)this.options.values[e]=this._trimAlignValue(t),this._refreshValue(),this._change(null,e);else{if(!arguments.length)return this._values();if(!Array.isArray(e))return this._hasMultipleValues()?this._values(e):this.value();for(i=this.options.values,o=e,n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(o[n]),this._change(null,n);this._refreshValue()}},_setOption:function(e,t){var i,o=0;switch("range"===e&&!0===this.options.range&&("min"===t?(this.options.value=this._values(0),this.options.values=null):"max"===t&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),Array.isArray(this.options.values)&&(o=this.options.values.length),this._super(e,t),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(t),this.handles.css("horizontal"===t?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),i=o-1;0<=i;i--)this._change(null,i);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(e){this._super(e),this._toggleClass(null,"ui-state-disabled",!!e)},_value:function(){var e=this.options.value;return this._trimAlignValue(e)},_values:function(e){var t,i;if(arguments.length)return e=this.options.values[e],this._trimAlignValue(e);if(this._hasMultipleValues()){for(t=this.options.values.slice(),i=0;i<t.length;i+=1)t[i]=this._trimAlignValue(t[i]);return t}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=0<this.options.step?this.options.step:1,i=(e-this._valueMin())%t,e=e-i;return 2*Math.abs(i)>=t&&(e+=0<i?t:-t),parseFloat(e.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step;(e=Math.round((e-t)/i)*i+t)>this.options.max&&(e-=i),this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min?Math.max(e,this._precisionOf(this.options.min)):e},_precisionOf:function(e){var t=e.toString();return-1===(e=t.indexOf("."))?0:t.length-e-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(e){"vertical"===e&&this.range.css({width:"",left:""}),"horizontal"===e&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var t,i,e,o,n,s=this.options.range,a=this.options,r=this,l=!this._animateOff&&a.animate,c={};this._hasMultipleValues()?this.handles.each(function(e){i=(r.values(e)-r._valueMin())/(r._valueMax()-r._valueMin())*100,c["horizontal"===r.orientation?"left":"bottom"]=i+"%",G(this).stop(1,1)[l?"animate":"css"](c,a.animate),!0===r.options.range&&("horizontal"===r.orientation?(0===e&&r.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},a.animate),1===e&&r.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:a.animate})):(0===e&&r.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},a.animate),1===e&&r.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:a.animate}))),t=i}):(e=this.value(),o=this._valueMin(),n=this._valueMax(),i=n!==o?(e-o)/(n-o)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:100-i+"%"},a.animate),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:100-i+"%"},a.animate))},_handleEvents:{keydown:function(e){var t,i,o,n=G(e.target).data("ui-slider-handle-index");switch(e.keyCode){case G.ui.keyCode.HOME:case G.ui.keyCode.END:case G.ui.keyCode.PAGE_UP:case G.ui.keyCode.PAGE_DOWN:case G.ui.keyCode.UP:case G.ui.keyCode.RIGHT:case G.ui.keyCode.DOWN:case G.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(G(e.target),null,"ui-state-active"),!1===this._start(e,n)))return}switch(o=this.options.step,t=i=this._hasMultipleValues()?this.values(n):this.value(),e.keyCode){case G.ui.keyCode.HOME:i=this._valueMin();break;case G.ui.keyCode.END:i=this._valueMax();break;case G.ui.keyCode.PAGE_UP:i=this._trimAlignValue(t+(this._valueMax()-this._valueMin())/this.numPages);break;case G.ui.keyCode.PAGE_DOWN:i=this._trimAlignValue(t-(this._valueMax()-this._valueMin())/this.numPages);break;case G.ui.keyCode.UP:case G.ui.keyCode.RIGHT:if(t===this._valueMax())return;i=this._trimAlignValue(t+o);break;case G.ui.keyCode.DOWN:case G.ui.keyCode.LEFT:if(t===this._valueMin())return;i=this._trimAlignValue(t-o)}this._slide(e,n,i)},keyup:function(e){var t=G(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,t),this._change(e,t),this._removeClass(G(e.target),null,"ui-state-active"))}}}),G.widget("ui.spinner",{version:"1.13.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var o=this._super(),n=this.element;return G.each(["min","max","step"],function(e,t){var i=n.attr(t);null!=i&&i.length&&(o[t]=i)}),o},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e))},mousewheel:function(e,t){var i=G.ui.safeActiveElement(this.document[0]);if(this.element[0]===i&&t){if(!this.spinning&&!this._start(e))return!1;this._spin((0<t?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(e){var t;function i(){this.element[0]!==G.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=t,this._delay(function(){this.previous=t}))}t=this.element[0]===G.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),!1!==this._start(e)&&this._repeat(null,G(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){if(G(e.currentTarget).hasClass("ui-state-active"))return!1!==this._start(e)&&void this._repeat(null,G(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&0<this.uiSpinner.height()&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var t=this.options,i=G.ui.keyCode;switch(e.keyCode){case i.UP:return this._repeat(null,1,e),!0;case i.DOWN:return this._repeat(null,-1,e),!0;case i.PAGE_UP:return this._repeat(null,t.page,e),!0;case i.PAGE_DOWN:return this._repeat(null,-t.page,e),!0}return!1},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e))&&(this.counter||(this.counter=1),this.spinning=!0)},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(e){var t=this.options.incremental;return t?"function"==typeof t?t(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min?Math.max(e,this._precisionOf(this.options.min)):e},_precisionOf:function(e){var t=e.toString();return-1===(e=t.indexOf("."))?0:t.length-e-1},_adjustValue:function(e){var t=this.options,i=null!==t.min?t.min:0;return e=i+Math.round((e-i)/t.step)*t.step,e=parseFloat(e.toFixed(this._precision())),null!==t.max&&e>t.max?t.max:null!==t.min&&e<t.min?t.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){var i;"culture"===e||"numberFormat"===e?(i=this._parse(this.element.val()),this.options[e]=t,this.element.val(this._format(i))):("max"!==e&&"min"!==e&&"step"!==e||"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(i=this.buttons.first().find(".ui-icon"),this._removeClass(i,null,this.options.icons.up),this._addClass(i,null,t.up),i=this.buttons.last().find(".ui-icon"),this._removeClass(i,null,this.options.icons.down),this._addClass(i,null,t.down)),this._super(e,t))},_setOptionDisabled:function(e){this._super(e),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!e),this.element.prop("disabled",!!e),this.buttons.button(e?"disable":"enable")},_setOptions:f(function(e){this._super(e)}),_parse:function(e){return""===(e="string"==typeof e&&""!==e?window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e:e)||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null!==e&&e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i)),this.element.val(e),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:f(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:f(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:f(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:f(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){if(!arguments.length)return this._parse(this.element.val());f(this._value).call(this,e)},widget:function(){return this.uiSpinner}}),!1!==G.uiBackCompat&&G.widget("ui.spinner",G.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),G.ui.spinner,G.widget("ui.tabs",{version:"1.13.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:(p=/#.*$/,function(e){var t=e.href.replace(p,""),i=location.href.replace(p,"");try{t=decodeURIComponent(t)}catch(e){}try{i=decodeURIComponent(i)}catch(e){}return 1<e.hash.length&&t===i}),_create:function(){var t=this,e=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,e.collapsible),this._processTabs(),e.active=this._initialActive(),Array.isArray(e.disabled)&&(e.disabled=G.uniqueSort(e.disabled.concat(G.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),!1!==this.options.active&&this.anchors.length?this.active=this._findActive(e.active):this.active=G(),this._refresh(),this.active.length&&this.load(e.active)},_initialActive:function(){var i=this.options.active,e=this.options.collapsible,o=location.hash.substring(1);return null===i&&(o&&this.tabs.each(function(e,t){if(G(t).attr("aria-controls")===o)return i=e,!1}),null!==(i=null===i?this.tabs.index(this.tabs.filter(".ui-tabs-active")):i)&&-1!==i||(i=!!this.tabs.length&&0)),!1!==i&&-1===(i=this.tabs.index(this.tabs.eq(i)))&&(i=!e&&0),i=!e&&!1===i&&this.anchors.length?0:i},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):G()}},_tabKeydown:function(e){var t=G(G.ui.safeActiveElement(this.document[0])).closest("li"),i=this.tabs.index(t),o=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case G.ui.keyCode.RIGHT:case G.ui.keyCode.DOWN:i++;break;case G.ui.keyCode.UP:case G.ui.keyCode.LEFT:o=!1,i--;break;case G.ui.keyCode.END:i=this.anchors.length-1;break;case G.ui.keyCode.HOME:i=0;break;case G.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(i);case G.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(i!==this.options.active&&i);default:return}e.preventDefault(),clearTimeout(this.activating),i=this._focusNextTab(i,o),e.ctrlKey||e.metaKey||(t.attr("aria-selected","false"),this.tabs.eq(i).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",i)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===G.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===G.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===G.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,t){for(var i=this.tabs.length-1;-1!==G.inArray(e=(e=i<e?0:e)<0?i:e,this.options.disabled);)e=t?e+1:e-1;return e},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).trigger("focus"),e},_setOption:function(e,t){"active"!==e?(this._super(e,t),"collapsible"===e&&(this._toggleClass("ui-tabs-collapsible",null,t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t)):this._activate(t)},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,t=this.tablist.children(":has(a[href])");e.disabled=G.map(t.filter(".ui-state-disabled"),function(e){return t.index(e)}),this._processTabs(),!1!==e.active&&this.anchors.length?this.active.length&&!G.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=G()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=G()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var l=this,e=this.tabs,t=this.anchors,i=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){G(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){G(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return G("a",this)[0]}).attr({tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=G(),this.anchors.each(function(e,t){var i,o,n,s=G(t).uniqueId().attr("id"),a=G(t).closest("li"),r=a.attr("aria-controls");l._isLocal(t)?(n=(i=t.hash).substring(1),o=l.element.find(l._sanitizeSelector(i))):(n=a.attr("aria-controls")||G({}).uniqueId()[0].id,(o=l.element.find(i="#"+n)).length||(o=l._createPanel(n)).insertAfter(l.panels[e-1]||l.tablist),o.attr("aria-live","polite")),o.length&&(l.panels=l.panels.add(o)),r&&a.data("ui-tabs-aria-controls",r),a.attr({"aria-controls":n,"aria-labelledby":s}),o.attr("aria-labelledby",s)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),e&&(this._off(e.not(this.tabs)),this._off(t.not(this.anchors)),this._off(i.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return G("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var t,i;for(Array.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),i=0;t=this.tabs[i];i++)t=G(t),!0===e||-1!==G.inArray(i,e)?(t.attr("aria-disabled","true"),this._addClass(t,null,"ui-state-disabled")):(t.removeAttr("aria-disabled"),this._removeClass(t,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===e)},_setupEvents:function(e){var i={};e&&G.each(e.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,t=this.element.parent();"fill"===e?(i=t.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=G(this),t=e.css("position");"absolute"!==t&&"fixed"!==t&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=G(this).outerHeight(!0)}),this.panels.each(function(){G(this).height(Math.max(0,i-G(this).innerHeight()+G(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,G(this).height("").height())}).height(i))},_eventHandler:function(e){var t=this.options,i=this.active,o=G(e.currentTarget).closest("li"),n=o[0]===i[0],s=n&&t.collapsible,a=s?G():this._getPanelForTab(o),r=i.length?this._getPanelForTab(i):G(),i={oldTab:i,oldPanel:r,newTab:s?G():o,newPanel:a};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||n&&!t.collapsible||!1===this._trigger("beforeActivate",e,i)||(t.active=!s&&this.tabs.index(o),this.active=n?G():o,this.xhr&&this.xhr.abort(),r.length||a.length||G.error("jQuery UI Tabs: Mismatching fragment identifier."),a.length&&this.load(this.tabs.index(o),e),this._toggle(e,i))},_toggle:function(e,t){var i=this,o=t.newPanel,n=t.oldPanel;function s(){i.running=!1,i._trigger("activate",e,t)}function a(){i._addClass(t.newTab.closest("li"),"ui-tabs-active","ui-state-active"),o.length&&i.options.show?i._show(o,i.options.show,s):(o.show(),s())}this.running=!0,n.length&&this.options.hide?this._hide(n,this.options.hide,function(){i._removeClass(t.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),a()}):(this._removeClass(t.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n.hide(),a()),n.attr("aria-hidden","true"),t.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),o.length&&n.length?t.oldTab.attr("tabIndex",-1):o.length&&this.tabs.filter(function(){return 0===G(this).attr("tabIndex")}).attr("tabIndex",-1),o.attr("aria-hidden","false"),t.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){(e=this._findActive(e))[0]!==this.active[0]&&(e=(e=e.length?e:this.active).find(".ui-tabs-anchor")[0],this._eventHandler({target:e,currentTarget:e,preventDefault:G.noop}))},_findActive:function(e){return!1===e?G():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e?this.anchors.index(this.anchors.filter("[href$='"+G.escapeSelector(e)+"']")):e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){G.data(this,"ui-tabs-destroy")?G(this).remove():G(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=G(this),t=e.data("ui-tabs-aria-controls");t?e.attr("aria-controls",t).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(i){var e=this.options.disabled;!1!==e&&(e=void 0!==i&&(i=this._getIndex(i),Array.isArray(e)?G.map(e,function(e){return e!==i?e:null}):G.map(this.tabs,function(e,t){return t!==i?t:null})),this._setOptionDisabled(e))},disable:function(e){var t=this.options.disabled;if(!0!==t){if(void 0===e)t=!0;else{if(e=this._getIndex(e),-1!==G.inArray(e,t))return;t=Array.isArray(t)?G.merge([e],t).sort():[e]}this._setOptionDisabled(t)}},load:function(e,o){function n(e,t){"abort"===t&&s.panels.stop(!1,!0),s._removeClass(i,"ui-tabs-loading"),a.removeAttr("aria-busy"),e===s.xhr&&delete s.xhr}e=this._getIndex(e);var s=this,i=this.tabs.eq(e),e=i.find(".ui-tabs-anchor"),a=this._getPanelForTab(i),r={tab:i,panel:a};this._isLocal(e[0])||(this.xhr=G.ajax(this._ajaxSettings(e,o,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(i,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(e,t,i){setTimeout(function(){a.html(e),s._trigger("load",o,r),n(i,t)},1)}).fail(function(e,t){setTimeout(function(){n(e,t)},1)})))},_ajaxSettings:function(e,i,o){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,t){return n._trigger("beforeLoad",i,G.extend({jqXHR:e,ajaxSettings:t},o))}}},_getPanelForTab:function(e){return e=G(e).attr("aria-controls"),this.element.find(this._sanitizeSelector("#"+e))}}),!1!==G.uiBackCompat&&G.widget("ui.tabs",G.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),G.ui.tabs,G.widget("ui.tooltip",{version:"1.13.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=G(this).attr("title");return G("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,t){var i=(e.attr("aria-describedby")||"").split(/\s+/);i.push(t),e.data("ui-tooltip-id",t).attr("aria-describedby",String.prototype.trim.call(i.join(" ")))},_removeDescribedBy:function(e){var t=e.data("ui-tooltip-id"),i=(e.attr("aria-describedby")||"").split(/\s+/);-1!==(t=G.inArray(t,i))&&i.splice(t,1),e.removeData("ui-tooltip-id"),(i=String.prototype.trim.call(i.join(" ")))?e.attr("aria-describedby",i):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=G("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=G([])},_setOption:function(e,t){var i=this;this._super(e,t),"content"===e&&G.each(this.tooltips,function(e,t){i._updateContent(t.element)})},_setOptionDisabled:function(e){this[e?"_disable":"_enable"]()},_disable:function(){var o=this;G.each(this.tooltips,function(e,t){var i=G.Event("blur");i.target=i.currentTarget=t.element[0],o.close(i,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=G(this);if(e.is("[title]"))return e.data("ui-tooltip-title",e.attr("title")).removeAttr("title")}))},_enable:function(){this.disabledTitles.each(function(){var e=G(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=G([])},open:function(e){var i=this,t=G(e?e.target:this.element).closest(this.options.items);t.length&&!t.data("ui-tooltip-id")&&(t.attr("title")&&t.data("ui-tooltip-title",t.attr("title")),t.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&t.parents().each(function(){var e,t=G(this);t.data("ui-tooltip-open")&&((e=G.Event("blur")).target=e.currentTarget=this,i.close(e,!0)),t.attr("title")&&(t.uniqueId(),i.parents[this.id]={element:this,title:t.attr("title")},t.attr("title",""))}),this._registerCloseHandlers(e,t),this._updateContent(t,e))},_updateContent:function(t,i){var e=this.options.content,o=this,n=i?i.type:null;if("string"==typeof e||e.nodeType||e.jquery)return this._open(i,t,e);(e=e.call(t[0],function(e){o._delay(function(){t.data("ui-tooltip-open")&&(i&&(i.type=n),this._open(i,t,e))})}))&&this._open(i,t,e)},_open:function(e,t,i){var o,n,s,a=G.extend({},this.options.position);function r(e){a.of=e,n.is(":hidden")||n.position(a)}i&&((o=this._find(t))?o.tooltip.find(".ui-tooltip-content").html(i):(t.is("[title]")&&(e&&"mouseover"===e.type?t.attr("title",""):t.removeAttr("title")),o=this._tooltip(t),n=o.tooltip,this._addDescribedBy(t,n.attr("id")),n.find(".ui-tooltip-content").html(i),this.liveRegion.children().hide(),(i=G("<div>").html(n.find(".ui-tooltip-content").html())).removeAttr("name").find("[name]").removeAttr("name"),i.removeAttr("id").find("[id]").removeAttr("id"),i.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:r}),r(e)):n.position(G.extend({of:t},this.options.position)),n.hide(),this._show(n,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(s=this.delayedShow=setInterval(function(){n.is(":visible")&&(r(a.of),clearInterval(s))},13)),this._trigger("open",e,{tooltip:n})))},_registerCloseHandlers:function(e,t){var i={keyup:function(e){e.keyCode===G.ui.keyCode.ESCAPE&&((e=G.Event(e)).currentTarget=t[0],this.close(e,!0))}};t[0]!==this.element[0]&&(i.remove=function(){var e=this._find(t);e&&this._removeTooltip(e.tooltip)}),e&&"mouseover"!==e.type||(i.mouseleave="close"),e&&"focusin"!==e.type||(i.focusout="close"),this._on(!0,t,i)},close:function(e){var t,i=this,o=G(e?e.currentTarget:this.element),n=this._find(o);n?(t=n.tooltip,n.closing||(clearInterval(this.delayedShow),o.data("ui-tooltip-title")&&!o.attr("title")&&o.attr("title",o.data("ui-tooltip-title")),this._removeDescribedBy(o),n.hiding=!0,t.stop(!0),this._hide(t,this.options.hide,function(){i._removeTooltip(G(this))}),o.removeData("ui-tooltip-open"),this._off(o,"mouseleave focusout keyup"),o[0]!==this.element[0]&&this._off(o,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&G.each(this.parents,function(e,t){G(t.element).attr("title",t.title),delete i.parents[e]}),n.closing=!0,this._trigger("close",e,{tooltip:t}),n.hiding||(n.closing=!1))):o.removeData("ui-tooltip-open")},_tooltip:function(e){var t=G("<div>").attr("role","tooltip"),i=G("<div>").appendTo(t),o=t.uniqueId().attr("id");return this._addClass(i,"ui-tooltip-content"),this._addClass(t,"ui-tooltip","ui-widget ui-widget-content"),t.appendTo(this._appendTo(e)),this.tooltips[o]={element:e,tooltip:t}},_find:function(e){return(e=e.data("ui-tooltip-id"))?this.tooltips[e]:null},_removeTooltip:function(e){clearInterval(this.delayedShow),e.remove(),delete this.tooltips[e.attr("id")]},_appendTo:function(e){return(e=e.closest(".ui-front, dialog")).length?e:this.document[0].body},_destroy:function(){var o=this;G.each(this.tooltips,function(e,t){var i=G.Event("blur"),t=t.element;i.target=i.currentTarget=t[0],o.close(i,!0),G("#"+e).remove(),t.data("ui-tooltip-title")&&(t.attr("title")||t.attr("title",t.data("ui-tooltip-title")),t.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),!1!==G.uiBackCompat&&G.widget("ui.tooltip",G.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var e=this._superApply(arguments);return this.options.tooltipClass&&e.tooltip.addClass(this.options.tooltipClass),e}}),G.ui.tooltip;var g=G,_={},K=_.toString,X=/^([\-+])=\s*(\d+\.?\d*)/,Y=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),e[4]?(parseInt(e[4],16)/255).toFixed(2):1]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),e[4]?(parseInt(e[4]+e[4],16)/255).toFixed(2):1]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],b=g.Color=function(e,t,i,o){return new g.Color.fn.parse(e,t,i,o)},y={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},J={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},Z=b.support={},v=g("<p>")[0],k=g.each;function x(e){return null==e?e+"":"object"==typeof e?_[K.call(e)]||"object":typeof e}function C(e,t,i){var o=J[t.type]||{};return null==e?i||!t.def?null:t.def:(e=o.floor?~~e:parseFloat(e),isNaN(e)?t.def:o.mod?(e+o.mod)%o.mod:Math.min(o.max,Math.max(0,e)))}function Q(o){var n=b(),s=n._rgba=[];return o=o.toLowerCase(),k(Y,function(e,t){var i=(i=t.re.exec(o))&&t.parse(i),t=t.space||"rgba";if(i)return i=n[t](i),n[y[t].cache]=i[y[t].cache],s=n._rgba=i._rgba,!1}),s.length?("0,0,0,0"===s.join()&&g.extend(s,A.transparent),n):A[o]}function D(e,t,i){return 6*(i=(i+1)%1)<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}v.style.cssText="background-color:rgba(1,1,1,.5)",Z.rgba=-1<v.style.backgroundColor.indexOf("rgba"),k(y,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),g.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){_["[object "+t+"]"]=t.toLowerCase()}),(b.fn=g.extend(b.prototype,{parse:function(n,e,t,i){if(void 0===n)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=g(n).css(e),e=void 0);var s=this,o=x(n),a=this._rgba=[];return void 0!==e&&(n=[n,e,t,i],o="array"),"string"===o?this.parse(Q(n)||A._default):"array"===o?(k(y.rgba.props,function(e,t){a[t.idx]=C(n[t.idx],t)}),this):"object"===o?(k(y,n instanceof b?function(e,t){n[t.cache]&&(s[t.cache]=n[t.cache].slice())}:function(e,i){var o=i.cache;k(i.props,function(e,t){if(!s[o]&&i.to){if("alpha"===e||null==n[e])return;s[o]=i.to(s._rgba)}s[o][t.idx]=C(n[e],t,!0)}),s[o]&&g.inArray(null,s[o].slice(0,3))<0&&(null==s[o][3]&&(s[o][3]=1),i.from&&(s._rgba=i.from(s[o])))}),this):void 0},is:function(e){var n=b(e),s=!0,a=this;return k(y,function(e,t){var i,o=n[t.cache];return o&&(i=a[t.cache]||t.to&&t.to(a._rgba)||[],k(t.props,function(e,t){if(null!=o[t.idx])return s=o[t.idx]===i[t.idx]})),s}),s},_space:function(){var i=[],o=this;return k(y,function(e,t){o[t.cache]&&i.push(e)}),i.pop()},transition:function(e,a){var t=(c=b(e))._space(),i=y[t],r=(e=0===this.alpha()?b("transparent"):this)[i.cache]||i.to(e._rgba),l=r.slice(),c=c[i.cache];return k(i.props,function(e,t){var i=t.idx,o=r[i],n=c[i],s=J[t.type]||{};null!==n&&(null===o?l[i]=n:(s.mod&&(n-o>s.mod/2?o+=s.mod:o-n>s.mod/2&&(o-=s.mod)),l[i]=C((n-o)*a+o,t)))}),this[t](l)},blend:function(e){if(1===this._rgba[3])return this;var t=this._rgba.slice(),i=t.pop(),o=b(e)._rgba;return b(g.map(t,function(e,t){return(1-i)*o[t]+i*e}))},toRgbaString:function(){var e="rgba(",t=g.map(this._rgba,function(e,t){return null!=e?e:2<t?1:0});return 1===t[3]&&(t.pop(),e="rgb("),e+t.join()+")"},toHslaString:function(){var e="hsla(",t=g.map(this.hsla(),function(e,t){return null==e&&(e=2<t?1:0),t&&t<3?Math.round(100*e)+"%":e});return 1===t[3]&&(t.pop(),e="hsl("),e+t.join()+")"},toHexString:function(e){var t=this._rgba.slice(),i=t.pop();return e&&t.push(~~(255*i)),"#"+g.map(t,function(e){return 1===(e=(e||0).toString(16)).length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}})).parse.prototype=b.fn,y.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/255,i=e[1]/255,o=e[2]/255,n=e[3],s=Math.max(t,i,o),a=Math.min(t,i,o),r=s-a,e=.5*(l=s+a),i=a===s?0:t===s?60*(i-o)/r+360:i===s?60*(o-t)/r+120:60*(t-i)/r+240,l=0==r?0:e<=.5?r/l:r/(2-l);return[Math.round(i)%360,l,e,null==n?1:n]},y.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],o=e[2],e=e[3],o=2*o-(i=o<=.5?o*(1+i):o+i-o*i);return[Math.round(255*D(o,i,t+1/3)),Math.round(255*D(o,i,t)),Math.round(255*D(o,i,t-1/3)),e]},k(y,function(r,e){var t=e.props,s=e.cache,a=e.to,l=e.from;b.fn[r]=function(e){if(a&&!this[s]&&(this[s]=a(this._rgba)),void 0===e)return this[s].slice();var i=x(e),o="array"===i||"object"===i?e:arguments,n=this[s].slice();return k(t,function(e,t){null==(e=o["object"===i?e:t.idx])&&(e=n[t.idx]),n[t.idx]=C(e,t)}),l?((e=b(l(n)))[s]=n,e):b(n)},k(t,function(s,a){b.fn[s]||(b.fn[s]=function(e){var t=x(e),i="alpha"===s?this._hsla?"hsla":"rgba":r,o=this[i](),n=o[a.idx];return"undefined"===t?n:("function"===t&&(t=x(e=e.call(this,n))),null==e&&a.empty?this:("string"===t&&(t=X.exec(e))&&(e=n+parseFloat(t[2])*("+"===t[1]?1:-1)),o[a.idx]=e,this[i](o)))})})}),(b.hook=function(e){e=e.split(" "),k(e,function(e,s){g.cssHooks[s]={set:function(e,t){var i,o,n="";if("transparent"!==t&&("string"!==x(t)||(i=Q(t)))){if(t=b(i||t),!Z.rgba&&1!==t._rgba[3]){for(o="backgroundColor"===s?e.parentNode:e;(""===n||"transparent"===n)&&o&&o.style;)try{n=g.css(o,"backgroundColor"),o=o.parentNode}catch(e){}t=t.blend(n&&"transparent"!==n?n:"_default")}t=t.toRgbaString()}try{e.style[s]=t}catch(e){}}},g.fx.step[s]=function(e){e.colorInit||(e.start=b(e.elem,s),e.end=b(e.end),e.colorInit=!0),g.cssHooks[s].set(e.elem,e.start.transition(e.end,e.pos))}})})("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),g.cssHooks.borderColor={expand:function(i){var o={};return k(["Top","Right","Bottom","Left"],function(e,t){o["border"+t+"Color"]=i}),o}};var ee,te,ie,oe,ne,se,ae,re,le,L,A=g.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"},I="ui-effects-",R="ui-effects-style",E="ui-effects-animated";function ce(e){var t,i,o=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,n={};if(o&&o.length&&o[0]&&o[o[0]])for(i=o.length;i--;)"string"==typeof o[t=o[i]]&&(n[t.replace(/-([\da-z])/gi,function(e,t){return t.toUpperCase()})]=o[t]);else for(t in o)"string"==typeof o[t]&&(n[t]=o[t]);return n}function P(e,t,i,o){return e={effect:e=G.isPlainObject(e)?(t=e).effect:e},"function"==typeof(t=null==t?{}:t)&&(o=t,i=null,t={}),"number"!=typeof t&&!G.fx.speeds[t]||(o=i,i=t,t={}),"function"==typeof i&&(o=i,i=null),t&&G.extend(e,t),i=i||t.duration,e.duration=G.fx.off?0:"number"==typeof i?i:i in G.fx.speeds?G.fx.speeds[i]:G.fx.speeds._default,e.complete=o||t.complete,e}function M(e){return!e||"number"==typeof e||G.fx.speeds[e]||"string"==typeof e&&!G.effects.effect[e]||"function"==typeof e||"object"==typeof e&&!e.effect}function de(e,t){var i=t.outerWidth(),t=t.outerHeight(),e=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/.exec(e)||["",0,i,t,0];return{top:parseFloat(e[1])||0,right:"auto"===e[2]?i:parseFloat(e[2]),bottom:"auto"===e[3]?t:parseFloat(e[3]),left:parseFloat(e[4])||0}}G.effects={effect:{}},oe=["add","remove","toggle"],ne={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1},G.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,t){G.fx.step[t]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(g.style(e.elem,t,e.end),e.setAttr=!0)}}),G.fn.addBack||(G.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),G.effects.animateClass=function(n,e,t,i){var s=G.speed(e,t,i);return this.queue(function(){function e(){G.each(oe,function(e,t){n[t]&&i[t+"Class"](n[t])})}var i=G(this),t=i.attr("class")||"",o=(o=s.children?i.find("*").addBack():i).map(function(){return{el:G(this),start:ce(this)}});e(),o=o.map(function(){return this.end=ce(this.el[0]),this.diff=function(e,t){var i,o,n={};for(i in t)o=t[i],e[i]===o||ne[i]||!G.fx.step[i]&&isNaN(parseFloat(o))||(n[i]=o);return n}(this.start,this.end),this}),i.attr("class",t),o=o.map(function(){var e=this,t=G.Deferred(),i=G.extend({},s,{queue:!1,complete:function(){t.resolve(e)}});return this.el.animate(this.diff,i),t.promise()}),G.when.apply(G,o.get()).done(function(){e(),G.each(arguments,function(){var t=this.el;G.each(this.diff,function(e){t.css(e,"")})}),s.complete.call(i[0])})})},G.fn.extend({addClass:(ie=G.fn.addClass,function(e,t,i,o){return t?G.effects.animateClass.call(this,{add:e},t,i,o):ie.apply(this,arguments)}),removeClass:(te=G.fn.removeClass,function(e,t,i,o){return 1<arguments.length?G.effects.animateClass.call(this,{remove:e},t,i,o):te.apply(this,arguments)}),toggleClass:(ee=G.fn.toggleClass,function(e,t,i,o,n){return"boolean"==typeof t||void 0===t?i?G.effects.animateClass.call(this,t?{add:e}:{remove:e},i,o,n):ee.apply(this,arguments):G.effects.animateClass.call(this,{toggle:e},t,i,o)}),switchClass:function(e,t,i,o,n){return G.effects.animateClass.call(this,{add:t,remove:e},i,o,n)}}),G.expr&&G.expr.pseudos&&G.expr.pseudos.animated&&(G.expr.pseudos.animated=(se=G.expr.pseudos.animated,function(e){return!!G(e).data(E)||se(e)})),!1!==G.uiBackCompat&&G.extend(G.effects,{save:function(e,t){for(var i=0,o=t.length;i<o;i++)null!==t[i]&&e.data(I+t[i],e[0].style[t[i]])},restore:function(e,t){for(var i,o=0,n=t.length;o<n;o++)null!==t[o]&&(i=e.data(I+t[o]),e.css(t[o],i))},setMode:function(e,t){return"toggle"===t?e.is(":hidden")?"show":"hide":t},createWrapper:function(i){if(i.parent().is(".ui-effects-wrapper"))return i.parent();var o={width:i.outerWidth(!0),height:i.outerHeight(!0),float:i.css("float")},e=G("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),t={width:i.width(),height:i.height()},n=document.activeElement;try{n.id}catch(e){n=document.body}return i.wrap(e),i[0]!==n&&!G.contains(i[0],n)||G(n).trigger("focus"),e=i.parent(),"static"===i.css("position")?(e.css({position:"relative"}),i.css({position:"relative"})):(G.extend(o,{position:i.css("position"),zIndex:i.css("z-index")}),G.each(["top","left","bottom","right"],function(e,t){o[t]=i.css(t),isNaN(parseInt(o[t],10))&&(o[t]="auto")}),i.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),i.css(t),e.css(o).show()},removeWrapper:function(e){var t=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),e[0]!==t&&!G.contains(e[0],t)||G(t).trigger("focus")),e}}),G.extend(G.effects,{version:"1.13.1",define:function(e,t,i){return i||(i=t,t="effect"),G.effects.effect[e]=i,G.effects.effect[e].mode=t,i},scaledDimensions:function(e,t,i){if(0===t)return{height:0,width:0,outerHeight:0,outerWidth:0};var o="horizontal"!==i?(t||100)/100:1,t="vertical"!==i?(t||100)/100:1;return{height:e.height()*t,width:e.width()*o,outerHeight:e.outerHeight()*t,outerWidth:e.outerWidth()*o}},clipToBox:function(e){return{width:e.clip.right-e.clip.left,height:e.clip.bottom-e.clip.top,left:e.clip.left,top:e.clip.top}},unshift:function(e,t,i){var o=e.queue();1<t&&o.splice.apply(o,[1,0].concat(o.splice(t,i))),e.dequeue()},saveStyle:function(e){e.data(R,e[0].style.cssText)},restoreStyle:function(e){e[0].style.cssText=e.data(R)||"",e.removeData(R)},mode:function(e,t){return e=e.is(":hidden"),"toggle"===t&&(t=e?"show":"hide"),(e?"hide"===t:"show"===t)?"none":t},getBaseline:function(e,t){var i,o;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":o=0;break;case"center":o=.5;break;case"right":o=1;break;default:o=e[1]/t.width}return{x:o,y:i}},createPlaceholder:function(e){var t,i=e.css("position"),o=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(i)&&(i="absolute",t=G("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),float:e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(I+"placeholder",t)),e.css({position:i,left:o.left,top:o.top}),t},removePlaceholder:function(e){var t=I+"placeholder",i=e.data(t);i&&(i.remove(),e.removeData(t))},cleanUp:function(e){G.effects.restoreStyle(e),G.effects.removePlaceholder(e)},setTransition:function(o,e,n,s){return s=s||{},G.each(e,function(e,t){var i=o.cssUnit(t);0<i[0]&&(s[t]=i[0]*n+i[1])}),s}}),G.fn.extend({effect:function(){function e(e){var t=G(this),i=G.effects.mode(t,r)||s;t.data(E,!0),l.push(i),s&&("show"===i||i===s&&"hide"===i)&&t.show(),s&&"none"===i||G.effects.saveStyle(t),"function"==typeof e&&e()}var o=P.apply(this,arguments),n=G.effects.effect[o.effect],s=n.mode,t=o.queue,i=t||"fx",a=o.complete,r=o.mode,l=[];return G.fx.off||!n?r?this[r](o.duration,a):this.each(function(){a&&a.call(this)}):!1===t?this.each(e).each(c):this.queue(i,e).queue(i,c);function c(e){var t=G(this);function i(){"function"==typeof a&&a.call(t[0]),"function"==typeof e&&e()}o.mode=l.shift(),!1===G.uiBackCompat||s?"none"===o.mode?(t[r](),i()):n.call(t[0],o,function(){t.removeData(E),G.effects.cleanUp(t),"hide"===o.mode&&t.hide(),i()}):(t.is(":hidden")?"hide"===r:"show"===r)?(t[r](),i()):n.call(t[0],o,i)}},show:(le=G.fn.show,function(e){return M(e)?le.apply(this,arguments):((e=P.apply(this,arguments)).mode="show",this.effect.call(this,e))}),hide:(re=G.fn.hide,function(e){return M(e)?re.apply(this,arguments):((e=P.apply(this,arguments)).mode="hide",this.effect.call(this,e))}),toggle:(ae=G.fn.toggle,function(e){return M(e)||"boolean"==typeof e?ae.apply(this,arguments):((e=P.apply(this,arguments)).mode="toggle",this.effect.call(this,e))}),cssUnit:function(e){var i=this.css(e),o=[];return G.each(["em","px","%","pt"],function(e,t){0<i.indexOf(t)&&(o=[parseFloat(i),t])}),o},cssClip:function(e){return e?this.css("clip","rect("+e.top+"px "+e.right+"px "+e.bottom+"px "+e.left+"px)"):de(this.css("clip"),this)},transfer:function(e,t){var i=G(this),o="fixed"===(r=G(e.to)).css("position"),n=G("body"),s=o?n.scrollTop():0,a=o?n.scrollLeft():0,n={top:(n=r.offset()).top-s,left:n.left-a,height:r.innerHeight(),width:r.innerWidth()},r=i.offset(),l=G("<div class='ui-effects-transfer'></div>");l.appendTo("body").addClass(e.className).css({top:r.top-s,left:r.left-a,height:i.innerHeight(),width:i.innerWidth(),position:o?"fixed":"absolute"}).animate(n,e.duration,e.easing,function(){l.remove(),"function"==typeof t&&t()})}}),G.fx.step.clip=function(e){e.clipInit||(e.start=G(e.elem).cssClip(),"string"==typeof e.end&&(e.end=de(e.end,e.elem)),e.clipInit=!0),G(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})},L={},G.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,e){L[e]=function(e){return Math.pow(e,t+2)}}),G.extend(L,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),G.each(L,function(e,t){G.easing["easeIn"+e]=t,G.easing["easeOut"+e]=function(e){return 1-t(1-e)},G.easing["easeInOut"+e]=function(e){return e<.5?t(2*e)/2:1-t(-2*e+2)/2}}),v=G.effects,G.effects.define("blind","hide",function(e,t){var i={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},o=G(this),n=e.direction||"up",s=o.cssClip(),a={clip:G.extend({},s)},r=G.effects.createPlaceholder(o);a.clip[i[n][0]]=a.clip[i[n][1]],"show"===e.mode&&(o.cssClip(a.clip),r&&r.css(G.effects.clipToBox(a)),a.clip=s),r&&r.animate(G.effects.clipToBox(a),e.duration,e.easing),o.animate(a,{queue:!1,duration:e.duration,easing:e.easing,complete:t})}),G.effects.define("bounce",function(e,t){var i,o,n=G(this),s=e.mode,a="hide"===s,r="show"===s,l=e.direction||"up",c=e.distance,d=e.times||5,h=e.duration/(s=2*d+(r||a?1:0)),u=e.easing,p="up"===l||"down"===l?"top":"left",m="up"===l||"left"===l,f=0,e=n.queue().length;for(G.effects.createPlaceholder(n),l=n.css(p),c=c||n["top"==p?"outerHeight":"outerWidth"]()/3,r&&((o={opacity:1})[p]=l,n.css("opacity",0).css(p,m?2*-c:2*c).animate(o,h,u)),a&&(c/=Math.pow(2,d-1)),(o={})[p]=l;f<d;f++)(i={})[p]=(m?"-=":"+=")+c,n.animate(i,h,u).animate(o,h,u),c=a?2*c:c/2;a&&((i={opacity:0})[p]=(m?"-=":"+=")+c,n.animate(i,h,u)),n.queue(t),G.effects.unshift(n,e,1+s)}),G.effects.define("clip","hide",function(e,t){var i={},o=G(this),n=(s="both"===(a=e.direction||"vertical"))||"horizontal"===a,s=s||"vertical"===a,a=o.cssClip();i.clip={top:s?(a.bottom-a.top)/2:a.top,right:n?(a.right-a.left)/2:a.right,bottom:s?(a.bottom-a.top)/2:a.bottom,left:n?(a.right-a.left)/2:a.left},G.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(i.clip),i.clip=a),o.animate(i,{queue:!1,duration:e.duration,easing:e.easing,complete:t})}),G.effects.define("drop","hide",function(e,t){var i=G(this),o="show"===e.mode,n=e.direction||"left",s="up"===n||"down"===n?"top":"left",a="up"===n||"left"===n?"-=":"+=",r="+="==a?"-=":"+=",l={opacity:0};G.effects.createPlaceholder(i),n=e.distance||i["top"==s?"outerHeight":"outerWidth"](!0)/2,l[s]=a+n,o&&(i.css(l),l[s]=r+n,l.opacity=1),i.animate(l,{queue:!1,duration:e.duration,easing:e.easing,complete:t})}),G.effects.define("explode","hide",function(e,t){var i,o,n,s,a,r,l=e.pieces?Math.round(Math.sqrt(e.pieces)):3,c=l,d=G(this),h="show"===e.mode,u=d.show().css("visibility","hidden").offset(),p=Math.ceil(d.outerWidth()/c),m=Math.ceil(d.outerHeight()/l),f=[];function g(){f.push(this),f.length===l*c&&(d.css({visibility:"visible"}),G(f).remove(),t())}for(i=0;i<l;i++)for(s=u.top+i*m,r=i-(l-1)/2,o=0;o<c;o++)n=u.left+o*p,a=o-(c-1)/2,d.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*p,top:-i*m}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:p,height:m,left:n+(h?a*p:0),top:s+(h?r*m:0),opacity:h?0:1}).animate({left:n+(h?0:a*p),top:s+(h?0:r*m),opacity:h?1:0},e.duration||500,e.easing,g)}),G.effects.define("fade","toggle",function(e,t){var i="show"===e.mode;G(this).css("opacity",i?0:1).animate({opacity:i?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:t})}),G.effects.define("fold","hide",function(t,e){var i=G(this),o="show"===(m=t.mode),n="hide"===m,s=t.size||15,a=/([0-9]+)%/.exec(s),r=t.horizFirst?["right","bottom"]:["bottom","right"],l=t.duration/2,c=G.effects.createPlaceholder(i),d=i.cssClip(),h={clip:G.extend({},d)},u={clip:G.extend({},d)},p=[d[r[0]],d[r[1]]],m=i.queue().length;a&&(s=parseInt(a[1],10)/100*p[n?0:1]),h.clip[r[0]]=s,u.clip[r[0]]=s,u.clip[r[1]]=0,o&&(i.cssClip(u.clip),c&&c.css(G.effects.clipToBox(u)),u.clip=d),i.queue(function(e){c&&c.animate(G.effects.clipToBox(h),l,t.easing).animate(G.effects.clipToBox(u),l,t.easing),e()}).animate(h,l,t.easing).animate(u,l,t.easing).queue(e),G.effects.unshift(i,m,4)}),G.effects.define("highlight","show",function(e,t){var i=G(this),o={backgroundColor:i.css("backgroundColor")};"hide"===e.mode&&(o.opacity=0),G.effects.saveStyle(i),i.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(o,{queue:!1,duration:e.duration,easing:e.easing,complete:t})}),G.effects.define("size",function(o,t){var n,i=G(this),e=["fontSize"],s=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],a=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],r=o.mode,l="effect"!==r,c=o.scale||"both",d=o.origin||["middle","center"],h=i.css("position"),u=i.position(),p=G.effects.scaledDimensions(i),m=o.from||p,f=o.to||G.effects.scaledDimensions(i,0);G.effects.createPlaceholder(i),"show"===r&&(r=m,m=f,f=r),n={from:{y:m.height/p.height,x:m.width/p.width},to:{y:f.height/p.height,x:f.width/p.width}},"box"!==c&&"both"!==c||(n.from.y!==n.to.y&&(m=G.effects.setTransition(i,s,n.from.y,m),f=G.effects.setTransition(i,s,n.to.y,f)),n.from.x!==n.to.x&&(m=G.effects.setTransition(i,a,n.from.x,m),f=G.effects.setTransition(i,a,n.to.x,f))),"content"!==c&&"both"!==c||n.from.y!==n.to.y&&(m=G.effects.setTransition(i,e,n.from.y,m),f=G.effects.setTransition(i,e,n.to.y,f)),d&&(d=G.effects.getBaseline(d,p),m.top=(p.outerHeight-m.outerHeight)*d.y+u.top,m.left=(p.outerWidth-m.outerWidth)*d.x+u.left,f.top=(p.outerHeight-f.outerHeight)*d.y+u.top,f.left=(p.outerWidth-f.outerWidth)*d.x+u.left),delete m.outerHeight,delete m.outerWidth,i.css(m),"content"!==c&&"both"!==c||(s=s.concat(["marginTop","marginBottom"]).concat(e),a=a.concat(["marginLeft","marginRight"]),i.find("*[width]").each(function(){var e=G(this),t={height:(i=G.effects.scaledDimensions(e)).height*n.from.y,width:i.width*n.from.x,outerHeight:i.outerHeight*n.from.y,outerWidth:i.outerWidth*n.from.x},i={height:i.height*n.to.y,width:i.width*n.to.x,outerHeight:i.height*n.to.y,outerWidth:i.width*n.to.x};n.from.y!==n.to.y&&(t=G.effects.setTransition(e,s,n.from.y,t),i=G.effects.setTransition(e,s,n.to.y,i)),n.from.x!==n.to.x&&(t=G.effects.setTransition(e,a,n.from.x,t),i=G.effects.setTransition(e,a,n.to.x,i)),l&&G.effects.saveStyle(e),e.css(t),e.animate(i,o.duration,o.easing,function(){l&&G.effects.restoreStyle(e)})})),i.animate(f,{queue:!1,duration:o.duration,easing:o.easing,complete:function(){var e=i.offset();0===f.opacity&&i.css("opacity",m.opacity),l||(i.css("position","static"===h?"relative":h).offset(e),G.effects.saveStyle(i)),t()}})}),G.effects.define("scale",function(e,t){var i=G(this),o=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)||"effect"!==o?0:100),o=G.extend(!0,{from:G.effects.scaledDimensions(i),to:G.effects.scaledDimensions(i,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(o.from.opacity=1,o.to.opacity=0),G.effects.effect.size.call(this,o,t)}),G.effects.define("puff","hide",function(e,t){e=G.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150}),G.effects.effect.scale.call(this,e,t)}),G.effects.define("pulsate","show",function(e,t){var i=G(this),o="show"===(l=e.mode),n=2*(e.times||5)+(o||"hide"===l?1:0),s=e.duration/n,a=0,r=1,l=i.queue().length;for(!o&&i.is(":visible")||(i.css("opacity",0).show(),a=1);r<n;r++)i.animate({opacity:a},s,e.easing),a=1-a;i.animate({opacity:a},s,e.easing),i.queue(t),G.effects.unshift(i,l,1+n)}),G.effects.define("shake",function(e,t){var i=1,o=G(this),n=e.direction||"left",s=e.distance||20,a=e.times||3,r=2*a+1,l=Math.round(e.duration/r),c="up"===n||"down"===n?"top":"left",d="up"===n||"left"===n,h={},u={},p={},n=o.queue().length;for(G.effects.createPlaceholder(o),h[c]=(d?"-=":"+=")+s,u[c]=(d?"+=":"-=")+2*s,p[c]=(d?"-=":"+=")+2*s,o.animate(h,l,e.easing);i<a;i++)o.animate(u,l,e.easing).animate(p,l,e.easing);o.animate(u,l,e.easing).animate(h,l/2,e.easing).queue(t),G.effects.unshift(o,n,1+r)}),G.effects.define("slide","show",function(e,t){var i,o,n=G(this),s={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},a=e.mode,r=e.direction||"left",l="up"===r||"down"===r?"top":"left",c="up"===r||"left"===r,d=e.distance||n["top"==l?"outerHeight":"outerWidth"](!0),h={};G.effects.createPlaceholder(n),i=n.cssClip(),o=n.position()[l],h[l]=(c?-1:1)*d+o,h.clip=n.cssClip(),h.clip[s[r][1]]=h.clip[s[r][0]],"show"===a&&(n.cssClip(h.clip),n.css(l,h[l]),h.clip=i,h[l]=o),n.animate(h,{queue:!1,duration:e.duration,easing:e.easing,complete:t})}),!1!==G.uiBackCompat&&G.effects.define("transfer",function(e,t){G(this).transfer(e,t)})}),!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(_){return function(D){"use strict";var L=D.tablesorter={version:"2.27.8",parsers:[],widgets:[],defaults:{theme:"default",widthFixed:!1,showProcessing:!1,headerTemplate:"{content}",onRenderTemplate:null,onRenderHeader:null,cancelSelection:!0,tabIndex:!0,dateFormat:"mmddyyyy",sortMultiSortKey:"shiftKey",sortResetKey:"ctrlKey",usNumberFormat:!0,delayInit:!1,serverSideSorting:!1,resort:!0,headers:{},ignoreCase:!0,sortForce:null,sortList:[],sortAppend:null,sortStable:!1,sortInitialOrder:"asc",sortLocaleCompare:!1,sortReset:!1,sortRestart:!1,emptyTo:"bottom",stringTo:"max",duplicateSpan:!0,textExtraction:"basic",textAttribute:"data-text",textSorter:null,numberSorter:null,initWidgets:!0,widgetClass:"widget-{name}",widgets:[],widgetOptions:{zebra:["even","odd"]},initialized:null,tableClass:"",cssAsc:"",cssDesc:"",cssNone:"",cssHeader:"",cssHeaderRow:"",cssProcessing:"",cssChildRow:"tablesorter-childRow",cssInfoBlock:"tablesorter-infoOnly",cssNoSort:"tablesorter-noSort",cssIgnoreRow:"tablesorter-ignoreRow",cssIcon:"tablesorter-icon",cssIconNone:"",cssIconAsc:"",cssIconDesc:"",pointerClick:"click",pointerDown:"mousedown",pointerUp:"mouseup",selectorHeaders:"> thead th, > thead td",selectorSort:"th, td",selectorRemove:".remove-me",debug:!1,headerList:[],empties:{},strings:{},parsers:[]},css:{table:"tablesorter",cssHasChild:"tablesorter-hasChildRow",childRow:"tablesorter-childRow",colgroup:"tablesorter-colgroup",header:"tablesorter-header",headerRow:"tablesorter-headerRow",headerIn:"tablesorter-header-inner",icon:"tablesorter-icon",processing:"tablesorter-processing",sortAsc:"tablesorter-headerAsc",sortDesc:"tablesorter-headerDesc",sortNone:"tablesorter-headerUnSorted"},language:{sortAsc:"Ascending sort applied, ",sortDesc:"Descending sort applied, ",sortNone:"No sort applied, ",sortDisabled:"sorting is disabled",nextAsc:"activate to apply an ascending sort",nextDesc:"activate to apply a descending sort",nextNone:"activate to remove the sort"},regex:{templateContent:/\{content\}/g,templateIcon:/\{icon\}/g,templateName:/\{name\}/i,spaces:/\s+/g,nonWord:/\W/g,formElements:/(input|select|button|textarea)/i,chunk:/(^([+\-]?(?:\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,chunks:/(^\\0|\\0$)/,hex:/^0x[0-9a-f]+$/i,comma:/,/g,digitNonUS:/[\s|\.]/g,digitNegativeTest:/^\s*\([.\d]+\)/,digitNegativeReplace:/^\s*\(([.\d]+)\)/,digitTest:/^[\-+(]?\d+[)]?$/,digitReplace:/[,.'"\s]/g},string:{max:1,min:-1,emptymin:1,emptymax:-1,zero:0,none:0,null:0,top:!0,bottom:!1},keyCodes:{enter:13},dates:{},instanceMethods:{},setup:function(t,i){var e,o,n,s;t&&t.tHead&&0!==t.tBodies.length&&!0!==t.hasInitialized?(e="",o=D(t),n=D.metadata,t.hasInitialized=!1,t.isProcessing=!0,t.config=i,D.data(t,"tablesorter",i),i.debug&&(console[console.group?"group":"log"]("Initializing tablesorter v"+L.version),D.data(t,"startoveralltimer",new Date)),i.supportsDataObject=((s=D.fn.jquery.split("."))[0]=parseInt(s[0],10),1<s[0]||1===s[0]&&4<=parseInt(s[1],10)),i.emptyTo=i.emptyTo.toLowerCase(),i.stringTo=i.stringTo.toLowerCase(),i.last={sortList:[],clickedIndex:-1},/tablesorter\-/.test(o.attr("class"))||(e=""!==i.theme?" tablesorter-"+i.theme:""),i.table=t,i.$table=o.addClass(L.css.table+" "+i.tableClass+e).attr("role","grid"),i.$headers=o.find(i.selectorHeaders),i.namespace?i.namespace="."+i.namespace.replace(L.regex.nonWord,""):i.namespace=".tablesorter"+Math.random().toString(16).slice(2),i.$table.children().children("tr").attr("role","row"),i.$tbodies=o.children("tbody:not(."+i.cssInfoBlock+")").attr({"aria-live":"polite","aria-relevant":"all"}),i.$table.children("caption").length&&((e=i.$table.children("caption")[0]).id||(e.id=i.namespace.slice(1)+"caption"),i.$table.attr("aria-labelledby",e.id)),i.widgetInit={},i.textExtraction=i.$table.attr("data-text-extraction")||i.textExtraction||"basic",L.buildHeaders(i),L.fixColumnWidth(t),L.addWidgetFromClass(t),L.applyWidgetOptions(t),L.setupParsers(i),i.totalRows=0,i.delayInit||L.buildCache(i),L.bindEvents(t,i.$headers,!0),L.bindMethods(i),i.supportsDataObject&&void 0!==o.data().sortlist?i.sortList=o.data().sortlist:n&&o.metadata()&&o.metadata().sortlist&&(i.sortList=o.metadata().sortlist),L.applyWidget(t,!0),0<i.sortList.length?L.sortOn(i,i.sortList,{},!i.initWidgets):(L.setHeadersCss(i),i.initWidgets&&L.applyWidget(t,!1)),i.showProcessing&&o.unbind("sortBegin"+i.namespace+" sortEnd"+i.namespace).bind("sortBegin"+i.namespace+" sortEnd"+i.namespace,function(e){clearTimeout(i.timerProcessing),L.isProcessing(t),"sortBegin"===e.type&&(i.timerProcessing=setTimeout(function(){L.isProcessing(t,!0)},500))}),t.hasInitialized=!0,t.isProcessing=!1,i.debug&&(console.log("Overall initialization time:"+L.benchmark(D.data(t,"startoveralltimer"))),i.debug&&console.groupEnd&&console.groupEnd()),o.triggerHandler("tablesorter-initialized",t),"function"==typeof i.initialized&&i.initialized(t)):i.debug&&(t.hasInitialized?console.warn("Stopping initialization. Tablesorter has already been initialized"):console.error("Stopping initialization! No table, thead or tbody",t))},bindMethods:function(t){var e=t.$table,i=t.namespace,o="sortReset update updateRows updateAll updateHeaders addRows updateCell updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave ".split(" ").join(i+" ");e.unbind(o.replace(L.regex.spaces," ")).bind("sortReset"+i,function(e,t){e.stopPropagation(),L.sortReset(this.config,t)}).bind("updateAll"+i,function(e,t,i){e.stopPropagation(),L.updateAll(this.config,t,i)}).bind("update"+i+" updateRows"+i,function(e,t,i){e.stopPropagation(),L.update(this.config,t,i)}).bind("updateHeaders"+i,function(e,t){e.stopPropagation(),L.updateHeaders(this.config,t)}).bind("updateCell"+i,function(e,t,i,o){e.stopPropagation(),L.updateCell(this.config,t,i,o)}).bind("addRows"+i,function(e,t,i,o){e.stopPropagation(),L.addRows(this.config,t,i,o)}).bind("updateComplete"+i,function(){this.isUpdating=!1}).bind("sorton"+i,function(e,t,i,o){e.stopPropagation(),L.sortOn(this.config,t,i,o)}).bind("appendCache"+i,function(e,t,i){e.stopPropagation(),L.appendCache(this.config,i),D.isFunction(t)&&t(this)}).bind("updateCache"+i,function(e,t,i){e.stopPropagation(),L.updateCache(this.config,t,i)}).bind("applyWidgetId"+i,function(e,t){e.stopPropagation(),L.applyWidgetId(this,t)}).bind("applyWidgets"+i,function(e,t){e.stopPropagation(),L.applyWidget(this,t)}).bind("refreshWidgets"+i,function(e,t,i){e.stopPropagation(),L.refreshWidgets(this,t,i)}).bind("removeWidget"+i,function(e,t,i){e.stopPropagation(),L.removeWidget(this,t,i)}).bind("destroy"+i,function(e,t,i){e.stopPropagation(),L.destroy(this,t,i)}).bind("resetToLoadState"+i,function(e){e.stopPropagation(),L.removeWidget(this,!0,!1),t=D.extend(!0,L.defaults,t.originalSettings),this.hasInitialized=!1,L.setup(this,t)})},bindEvents:function(e,s,t){var i,a=(e=D(e)[0]).config,o=a.namespace,r=null;!0!==t&&(s.addClass(o.slice(1)+"_extra_headers"),(i=(D.fn.closest?s.closest("table"):s.parents("table"))[0])&&"TABLE"===i.nodeName&&i!==e&&D(i).addClass(o.slice(1)+"_extra_table")),i=(a.pointerDown+" "+a.pointerUp+" "+a.pointerClick+" sort keyup ").replace(L.regex.spaces," ").split(" ").join(o+" "),s.find(a.selectorSort).add(s.filter(a.selectorSort)).unbind(i).bind(i,function(e,t){var i,o=D(e.target),n=" "+e.type+" ";if(!(1!==(e.which||e.button)&&!n.match(" "+a.pointerClick+" | sort | keyup ")||" keyup "===n&&e.which!==L.keyCodes.enter||n.match(" "+a.pointerClick+" ")&&void 0!==e.which||n.match(" "+a.pointerUp+" ")&&r!==e.target&&!0!==t))if(n.match(" "+a.pointerDown+" "))r=e.target,"1"===(i=o.jquery.split("."))[0]&&i[1]<4&&e.preventDefault();else{if(r=null,L.regex.formElements.test(e.target.nodeName)||o.hasClass(a.cssNoSort)||0<o.parents("."+a.cssNoSort).length||0<o.parents("button").length)return!a.cancelSelection;a.delayInit&&L.isEmptyObject(a.cache)&&L.buildCache(a),t=D.fn.closest?D(this).closest("th, td"):/TH|TD/.test(this.nodeName)?D(this):D(this).parents("th, td"),i=s.index(t),a.last.clickedIndex=i<0?t.attr("data-column"):i,(n=a.$headers[a.last.clickedIndex])&&!n.sortDisabled&&L.initSort(a,n,e)}}),a.cancelSelection&&s.attr("unselectable","on").bind("selectstart",!1).css({"user-select":"none",MozUserSelect:"none"})},buildHeaders:function(a){var e,r,t,i;for(a.headerList=[],a.headerContent=[],a.sortVars=[],a.debug&&(t=new Date),a.columns=L.computeColumnIndex(a.$table.children("thead, tfoot").children("tr")),r=a.cssIcon?'<i class="'+(a.cssIcon===L.css.icon?L.css.icon:a.cssIcon+" "+L.css.icon)+'"></i>':"",a.$headers=D(D.map(a.$table.find(a.selectorHeaders),function(e,t){var i,o,n,s=D(e);if(!s.parent().hasClass(a.cssIgnoreRow))return i=L.getColumnData(a.table,a.headers,t,!0),a.headerContent[t]=s.html(),""===a.headerTemplate||s.find("."+L.css.headerIn).length||(n=a.headerTemplate.replace(L.regex.templateContent,s.html()).replace(L.regex.templateIcon,s.find("."+L.css.icon).length?"":r),a.onRenderTemplate&&(o=a.onRenderTemplate.apply(s,[t,n]))&&"string"==typeof o&&(n=o),s.html('<div class="'+L.css.headerIn+'">'+n+"</div>")),a.onRenderHeader&&a.onRenderHeader.apply(s,[t,a,a.$table]),o=parseInt(s.attr("data-column"),10),e.column=o,n=L.getOrder(L.getData(s,i,"sortInitialOrder")||a.sortInitialOrder),a.sortVars[o]={count:-1,order:n?a.sortReset?[1,0,2]:[1,0]:a.sortReset?[0,1,2]:[0,1],lockedOrder:!1},void 0!==(n=L.getData(s,i,"lockedOrder")||!1)&&!1!==n&&(a.sortVars[o].lockedOrder=!0,a.sortVars[o].order=L.getOrder(n)?[1,1]:[0,0]),a.headerList[t]=e,s.addClass(L.css.header+" "+a.cssHeader).parent().addClass(L.css.headerRow+" "+a.cssHeaderRow).attr("role","row"),a.tabIndex&&s.attr("tabindex",0),e})),a.$headerIndexed=[],i=0;i<a.columns;i++)L.isEmptyObject(a.sortVars[i])&&(a.sortVars[i]={}),e=a.$headers.filter('[data-column="'+i+'"]'),a.$headerIndexed[i]=e.length?(e.not(".sorter-false").length?e.not(".sorter-false"):e).filter(":last"):D();a.$table.find(a.selectorHeaders).attr({scope:"col",role:"columnheader"}),L.updateHeader(a),a.debug&&(console.log("Built headers:"+L.benchmark(t)),console.log(a.$headers))},addInstanceMethods:function(e){D.extend(L.instanceMethods,e)},setupParsers:function(e,t){var i,o,n,s,a,r,l,c,d,h,u,p,m,f,g=e.table,_=0,b={};if(e.$tbodies=e.$table.children("tbody:not(."+e.cssInfoBlock+")"),0===(f=(m=void 0===t?e.$tbodies:t).length))return e.debug?console.warn("Warning: *Empty table!* Not building a parser cache"):"";for(e.debug&&(p=new Date,console[console.group?"group":"log"]("Detecting parsers for each column")),o={extractors:[],parsers:[]};_<f;){if((i=m[_].rows).length)for(s=e.columns,r=a=0;r<s;r++){if((l=e.$headerIndexed[a])&&l.length&&(c=L.getColumnData(g,e.headers,a),u=L.getParserById(L.getData(l,c,"extractor")),h=L.getParserById(L.getData(l,c,"sorter")),d="false"===L.getData(l,c,"parser"),e.empties[a]=(L.getData(l,c,"empty")||e.emptyTo||(e.emptyToBottom?"bottom":"top")).toLowerCase(),e.strings[a]=(L.getData(l,c,"string")||e.stringTo||"max").toLowerCase(),u=u||!1,h=(h=d?L.getParserById("no-parser"):h)||L.detectParserForColumn(e,i,-1,a),e.debug&&(b["("+a+") "+l.text()]={parser:h.id,extractor:u?u.id:"none",string:e.strings[a],empty:e.empties[a]}),o.parsers[a]=h,o.extractors[a]=u,0<(n=l[0].colSpan-1)))for(a+=n,s+=n;0<n+1;)o.parsers[a-n]=h,o.extractors[a-n]=u,n--;a++}_+=o.parsers.length?f:1}e.debug&&(L.isEmptyObject(b)?console.warn("  No parsers detected!"):console[console.table?"table":"log"](b),console.log("Completed detecting parsers"+L.benchmark(p)),console.groupEnd&&console.groupEnd()),e.parsers=o.parsers,e.extractors=o.extractors},addParser:function(e){for(var t=L.parsers.length,i=!0,o=0;o<t;o++)L.parsers[o].id.toLowerCase()===e.id.toLowerCase()&&(i=!1);i&&(L.parsers[L.parsers.length]=e)},getParserById:function(e){if("false"!=e)for(var t=L.parsers.length,i=0;i<t;i++)if(L.parsers[i].id.toLowerCase()===e.toString().toLowerCase())return L.parsers[i];return!1},detectParserForColumn:function(e,t,i,o){for(var n,s,a,r=L.parsers.length,l=!1,c="",d=!0;""===c&&d;)(a=t[++i])&&i<50?a.className.indexOf(L.cssIgnoreRow)<0&&(l=t[i].cells[o],c=L.getElementText(e,l,o),s=D(l),e.debug&&console.log("Checking if value was empty on row "+i+", column: "+o+': "'+c+'"')):d=!1;for(;0<=--r;)if((n=L.parsers[r])&&"text"!==n.id&&n.is&&n.is(c,e.table,l,s))return n;return L.getParserById("text")},getElementText:function(e,t,i){if(!t)return"";var o,n=e.textExtraction||"",s=t.jquery?t:D(t);return"string"==typeof n?"basic"===n&&void 0!==(o=s.attr(e.textAttribute))?D.trim(o):D.trim(t.textContent||s.text()):"function"==typeof n?D.trim(n(s[0],e.table,i)):"function"==typeof(o=L.getColumnData(e.table,n,i))?D.trim(o(s[0],e.table,i)):D.trim(s[0].textContent||s.text())},getParsedText:function(e,t,i,o){var n=""+(o=void 0===o?L.getElementText(e,t,i):o),s=e.parsers[i],a=e.extractors[i];return s&&(a&&"function"==typeof a.format&&(o=a.format(o,e.table,t,i)),n="no-parser"===s.id?"":s.format(""+o,e.table,t,i),e.ignoreCase&&"string"==typeof n&&(n=n.toLowerCase())),n},buildCache:function(e,t,i){var o,n,s,a,r,l,c,d,h,u,p,m,f,g,_,b,y,v,k,w,T,S,x=e.table,C=e.parsers;if(e.$tbodies=e.$table.children("tbody:not(."+e.cssInfoBlock+")"),c=void 0===i?e.$tbodies:i,e.cache={},e.totalRows=0,!C)return e.debug?console.warn("Warning: *Empty table!* Not building a cache"):"";for(e.debug&&(m=new Date),e.showProcessing&&L.isProcessing(x,!0),l=0;l<c.length;l++){for(b=[],o=e.cache[l]={normalized:[]},f=c[l]&&c[l].rows.length||0,a=0;a<f;++a)if(g={child:[],raw:[]},h=[],!(d=D(c[l].rows[a])).hasClass(e.selectorRemove.slice(1)))if(d.hasClass(e.cssChildRow)&&0!==a)for(T=o.normalized.length-1,(_=o.normalized[T][e.columns]).$row=_.$row.add(d),d.prev().hasClass(e.cssChildRow)||d.prev().addClass(L.css.cssHasChild),u=d.children("th, td"),T=_.child.length,_.child[T]=[],w=e.columns,r=v=0;r<w;r++)(p=u[r])&&(_.child[T][r]=L.getParsedText(e,p,r),0<(y=u[r].colSpan-1)&&(v+=y,w+=y)),v++;else{for(g.$row=d,g.order=a,w=e.columns,r=v=0;r<w;++r){if((p=d[0].cells[r])&&v<e.columns&&(!(k=void 0!==C[v])&&e.debug&&console.warn("No parser found for row: "+a+", column: "+r+'; cell containing: "'+D(p).text()+'"; does it have a header?'),n=L.getElementText(e,p,v),g.raw[v]=n,s=L.getParsedText(e,p,v,n),h[v]=s,k&&"numeric"===(C[v].type||"").toLowerCase()&&(b[v]=Math.max(Math.abs(s)||0,b[v]||0)),0<(y=p.colSpan-1))){for(S=0;S<=y;)s=e.duplicateSpan||0===S?n:"string"!=typeof e.textExtraction&&L.getElementText(e,p,v+S)||"",g.raw[v+S]=s,h[v+S]=s,S++;v+=y,w+=y}v++}h[e.columns]=g,o.normalized[o.normalized.length]=h}o.colMax=b,e.totalRows+=o.normalized.length}if(e.showProcessing&&L.isProcessing(x),e.debug){for(T=Math.min(5,e.cache[0].normalized.length),console[console.group?"group":"log"]("Building cache for "+e.totalRows+" rows (showing "+T+" rows in log) and "+e.columns+" columns"+L.benchmark(m)),n={},r=0;r<e.columns;r++)for(v=0;v<T;v++)n["row: "+v]||(n["row: "+v]={}),n["row: "+v][e.$headerIndexed[r].text()]=e.cache[0].normalized[v][r];console[console.table?"table":"log"](n),console.groupEnd&&console.groupEnd()}D.isFunction(t)&&t(x)},getColumnText:function(e,t,i,o){var n,s,a,r,l,c,d,h,u,p,m="function"==typeof i,f="all"===t,g={raw:[],parsed:[],$cell:[]},_=(e=D(e)[0]).config;if(!L.isEmptyObject(_)){for(l=_.$tbodies.length,n=0;n<l;n++)for(c=(a=_.cache[n].normalized).length,s=0;s<c;s++)r=a[s],o&&!r[_.columns].$row.is(o)||(p=!0,h=f?r.slice(0,_.columns):r[t],r=r[_.columns],d=f?r.raw:r.raw[t],u=f?r.$row.children():r.$row.children().eq(t),!1!==(p=m?i({tbodyIndex:n,rowIndex:s,parsed:h,raw:d,$row:r.$row,$cell:u}):p)&&(g.parsed[g.parsed.length]=h,g.raw[g.raw.length]=d,g.$cell[g.$cell.length]=u));return g}_.debug&&console.warn("No cache found - aborting getColumnText function!")},setHeadersCss:function(s){var e,t,i,o=s.sortList,n=o.length,a=L.css.sortNone+" "+s.cssNone,r=[L.css.sortAsc+" "+s.cssAsc,L.css.sortDesc+" "+s.cssDesc],l=[s.cssIconAsc,s.cssIconDesc,s.cssIconNone],c=["ascending","descending"],d=s.$table.find("tfoot tr").children("td, th").add(D(s.namespace+"_extra_headers")).removeClass(r.join(" "));for(s.$headers.removeClass(r.join(" ")).addClass(a).attr("aria-sort","none").find("."+L.css.icon).removeClass(l.join(" ")).addClass(l[2]),t=0;t<n;t++)if(2!==o[t][1]&&(e=(e=s.$headers.filter(function(e){for(var t=!0,i=s.$headers.eq(e),o=parseInt(i.attr("data-column"),10),n=o+s.$headers[e].colSpan;o<n;o++)t=t||!1;return t})).not(".sorter-false").filter('[data-column="'+o[t][0]+'"]'+(1===n?":last":""))).length){for(i=0;i<e.length;i++)e[i].sortDisabled||e.eq(i).removeClass(a).addClass(r[o[t][1]]).attr("aria-sort",c[o[t][1]]).find("."+L.css.icon).removeClass(l[2]).addClass(l[o[t][1]]);d.length&&d.filter('[data-column="'+o[t][0]+'"]').removeClass(a).addClass(r[o[t][1]])}for(n=s.$headers.length,t=0;t<n;t++)L.setColumnAriaLabel(s,s.$headers.eq(t))},setColumnAriaLabel:function(e,t,i){var o,n;t.length&&(o=parseInt(t.attr("data-column"),10),e=e.sortVars[o],o=t.hasClass(L.css.sortAsc)?"sortAsc":t.hasClass(L.css.sortDesc)?"sortDesc":"sortNone",n=D.trim(t.text())+": "+L.language[o],t.hasClass("sorter-false")||!1===i?n+=L.language.sortDisabled:(o=(e.count+1)%e.order.length,i=e.order[o],n+=L.language[0===i?"nextAsc":1===i?"nextDesc":"nextNone"]),t.attr("aria-label",n))},updateHeader:function(e){for(var t,i,o=e.table,n=e.$headers.length,s=0;s<n;s++)t=e.$headers.eq(s),i=L.getColumnData(o,e.headers,s,!0),i="false"===L.getData(t,i,"sorter")||"false"===L.getData(t,i,"parser"),L.setColumnSort(e,t,i)},setColumnSort:function(e,t,i){var o=e.table.id;t[0].sortDisabled=i,t[i?"addClass":"removeClass"]("sorter-false").attr("aria-disabled",""+i),e.tabIndex&&(i?t.removeAttr("tabindex"):t.attr("tabindex","0")),o&&(i?t.removeAttr("aria-controls"):t.attr("aria-controls",o))},updateHeaderSortCount:function(e,t){var i,o,n,s,a,r,l,c=t||e.sortList,d=c.length;for(e.sortList=[],n=0;n<d;n++)if(r=c[n],(i=parseInt(r[0],10))<e.columns){switch(e.sortVars[i].order||(l=L.getOrder(e.sortInitialOrder)?e.sortReset?[1,0,2]:[1,0]:e.sortReset?[0,1,2]:[0,1],e.sortVars[i].order=l,e.sortVars[i].count=0),l=e.sortVars[i].order,o=(o=(""+r[1]).match(/^(1|d|s|o|n)/))?o[0]:""){case"1":case"d":o=1;break;case"s":o=s||0;break;case"o":o=0===(a=l[(s||0)%l.length])?1:1===a?0:2;break;case"n":o=l[++e.sortVars[i].count%l.length];break;default:o=0}s=0===n?o:s,r=[i,parseInt(o,10)||0],e.sortList[e.sortList.length]=r,o=D.inArray(r[1],l),e.sortVars[i].count=0<=o?o:r[1]%l.length}},updateAll:function(e,t,i){var o=e.table;o.isUpdating=!0,L.refreshWidgets(o,!0,!0),L.buildHeaders(e),L.bindEvents(o,e.$headers,!0),L.bindMethods(e),L.commonUpdate(e,t,i)},update:function(e,t,i){e.table.isUpdating=!0,L.updateHeader(e),L.commonUpdate(e,t,i)},updateHeaders:function(e,t){e.table.isUpdating=!0,L.buildHeaders(e),L.bindEvents(e.table,e.$headers,!0),L.resortComplete(e,t)},updateCell:function(e,t,i,o){if(L.isEmptyObject(e.cache))L.updateHeader(e),L.commonUpdate(e,i,o);else{e.table.isUpdating=!0,e.$table.find(e.selectorRemove).remove();var n,s,a,r,l=e.$tbodies,c=D(t),d=l.index(D.fn.closest?c.closest("tbody"):c.parents("tbody").filter(":first")),h=e.cache[d],u=D.fn.closest?c.closest("tr"):c.parents("tr").filter(":first");if(t=c[0],l.length&&0<=d){if(l=l.eq(d).find("tr").index(u),d=h.normalized[l],(r=u[0].cells.length)!==e.columns)for(n=!1,s=a=0;s<r;s++)n||u[0].cells[s]===t?n=!0:a+=u[0].cells[s].colSpan;else a=c.index();n=L.getElementText(e,t,a),d[e.columns].raw[a]=n,n=L.getParsedText(e,t,a,n),d[a]=n,d[e.columns].$row=u,"numeric"===(e.parsers[a].type||"").toLowerCase()&&(h.colMax[a]=Math.max(Math.abs(n)||0,h.colMax[a]||0)),!1!==(n="undefined"!==i?i:e.resort)?L.checkResort(e,n,o):L.resortComplete(e,o)}else e.debug&&console.error("updateCell aborted, tbody missing or not within the indicated table"),e.table.isUpdating=!1}},addRows:function(e,t,i,o){var n,s,a,r,l,c,d,h,u,p,m,f="string"==typeof t&&1===e.$tbodies.length&&/<tr/.test(t||""),g=e.table;if(f)t=D(t),e.$tbodies.append(t);else if(!(t&&t instanceof _&&(D.fn.closest?t.closest("table"):t.parents("table"))[0]===e.table))return e.debug&&console.error("addRows method requires (1) a jQuery selector reference to rows that have already been added to the table, or (2) row HTML string to be added to a table with only one tbody"),!1;if(g.isUpdating=!0,L.isEmptyObject(e.cache))L.updateHeader(e),L.commonUpdate(e,i,o);else{for(a=t.filter("tr").attr("role","row").length,n=e.$tbodies.index(t.parents("tbody").filter(":first")),e.parsers&&e.parsers.length||L.setupParsers(e),s=0;s<a;s++){for(d=0,l=t[s].cells.length,c=e.cache[n].normalized.length,u=[],h={child:[],raw:[],$row:t.eq(s),order:c},r=0;r<l;r++)p=t[s].cells[r],m=L.getElementText(e,p,d),h.raw[d]=m,m=L.getParsedText(e,p,d,m),u[d]=m,"numeric"===(e.parsers[d].type||"").toLowerCase()&&(e.cache[n].colMax[d]=Math.max(Math.abs(m)||0,e.cache[n].colMax[d]||0)),0<(m=p.colSpan-1)&&(d+=m),d++;u[e.columns]=h,e.cache[n].normalized[c]=u}L.checkResort(e,i,o)}},updateCache:function(e,t,i){e.parsers&&e.parsers.length||L.setupParsers(e,i),L.buildCache(e,t,i)},appendCache:function(e,t){var i,o,n,s,a,r,l,c=e.table,d=e.widgetOptions,h=e.$tbodies,u=[],p=e.cache;if(L.isEmptyObject(p))return e.appender?e.appender(c,u):c.isUpdating?e.$table.triggerHandler("updateComplete",c):"";for(e.debug&&(l=new Date),r=0;r<h.length;r++)if((n=h.eq(r)).length){for(s=L.processTbody(c,n,!0),o=(i=p[r].normalized).length,a=0;a<o;a++)u[u.length]=i[a][e.columns].$row,e.appender&&(!e.pager||e.pager.removeRows&&d.pager_removeRows||e.pager.ajax)||s.append(i[a][e.columns].$row);L.processTbody(c,s,!1)}e.appender&&e.appender(c,u),e.debug&&console.log("Rebuilt table"+L.benchmark(l)),t||e.appender||L.applyWidget(c),c.isUpdating&&e.$table.triggerHandler("updateComplete",c)},commonUpdate:function(e,t,i){e.$table.find(e.selectorRemove).remove(),L.setupParsers(e),L.buildCache(e),L.checkResort(e,t,i)},initSort:function(e,t,i){if(e.table.isUpdating)return setTimeout(function(){L.initSort(e,t,i)},50);var o,n,s,a,r,l,c,d=!i[e.sortMultiSortKey],h=e.table,u=e.$headers.length,p=parseInt(D(t).attr("data-column"),10),m=e.sortVars[p].order;if(e.$table.triggerHandler("sortStart",h),l=(e.sortVars[p].count+1)%m.length,e.sortVars[p].count=i[e.sortResetKey]?2:l,e.sortRestart)for(s=0;s<u;s++)c=e.$headers.eq(s),p!==(l=parseInt(c.attr("data-column"),10))&&(d||c.hasClass(L.css.sortNone))&&(e.sortVars[l].count=-1);if(d){if(e.sortList=[],e.last.sortList=[],null!==e.sortForce)for(o=e.sortForce,n=0;n<o.length;n++)o[n][0]!==p&&(e.sortList[e.sortList.length]=o[n]);if((a=m[e.sortVars[p].count])<2&&(e.sortList[e.sortList.length]=[p,a],1<t.colSpan))for(n=1;n<t.colSpan;n++)e.sortList[e.sortList.length]=[p+n,a],e.sortVars[p+n].count=D.inArray(a,m)}else if(e.sortList=D.extend([],e.last.sortList),0<=L.isValueInArray(p,e.sortList))for(n=0;n<e.sortList.length;n++)(l=e.sortList[n])[0]===p&&(l[1]=m[e.sortVars[p].count],2===l[1]&&(e.sortList.splice(n,1),e.sortVars[p].count=-1));else if((a=m[e.sortVars[p].count])<2&&(e.sortList[e.sortList.length]=[p,a],1<t.colSpan))for(n=1;n<t.colSpan;n++)e.sortList[e.sortList.length]=[p+n,a],e.sortVars[p+n].count=D.inArray(a,m);if(e.last.sortList=D.extend([],e.sortList),e.sortList.length&&e.sortAppend&&(o=D.isArray(e.sortAppend)?e.sortAppend:e.sortAppend[e.sortList[0][0]],!L.isEmptyObject(o)))for(n=0;n<o.length;n++)if(o[n][0]!==p&&L.isValueInArray(o[n][0],e.sortList)<0){if(r=(""+(a=o[n][1])).match(/^(a|d|s|o|n)/))switch(l=e.sortList[0][1],r[0]){case"d":a=1;break;case"s":a=l;break;case"o":a=0===l?1:0;break;case"n":a=(l+1)%m.length;break;default:a=0}e.sortList[e.sortList.length]=[o[n][0],a]}e.$table.triggerHandler("sortBegin",h),setTimeout(function(){L.setHeadersCss(e),L.multisort(e),L.appendCache(e),e.$table.triggerHandler("sortBeforeEnd",h),e.$table.triggerHandler("sortEnd",h)},1)},multisort:function(a){var e,t,r,i,l=a.table,c=[],d=0,h=a.textSorter||"",u=a.sortList,p=u.length,o=a.$tbodies.length;if(!a.serverSideSorting&&!L.isEmptyObject(a.cache)){if(a.debug&&(t=new Date),"object"==typeof h)for(r=a.columns;r--;)"function"==typeof(i=L.getColumnData(l,h,r))&&(c[r]=i);for(e=0;e<o;e++)r=a.cache[e].colMax,a.cache[e].normalized.sort(function(e,t){for(var i,o,n,s=0;s<p;s++){if(i=u[s][0],o=u[s][1],d=0===o,a.sortStable&&e[i]===t[i]&&1===p)return e[a.columns].order-t[a.columns].order;if(o=(o=/n/i.test(L.getSortType(a.parsers,i)))&&a.strings[i]?(o="boolean"==typeof L.string[a.strings[i]]?(d?1:-1)*(L.string[a.strings[i]]?-1:1):a.strings[i]&&L.string[a.strings[i]]||0,a.numberSorter?a.numberSorter(e[i],t[i],d,r[i],l):L["sortNumeric"+(d?"Asc":"Desc")](e[i],t[i],o,r[i],i,a)):(o=d?e:t,n=d?t:e,"function"==typeof h?h(o[i],n[i],d,i,l):"function"==typeof c[i]?c[i](o[i],n[i],d,i,l):L["sortNatural"+(d?"Asc":"Desc")](e[i],t[i],i,a)))return o}return e[a.columns].order-t[a.columns].order});a.debug&&console.log("Applying sort "+u.toString()+L.benchmark(t))}},resortComplete:function(e,t){e.table.isUpdating&&e.$table.triggerHandler("updateComplete",e.table),D.isFunction(t)&&t(e.table)},checkResort:function(e,t,i){var o=D.isArray(t)?t:e.sortList;!1===(void 0===t?e.resort:t)||e.serverSideSorting||e.table.isProcessing?(L.resortComplete(e,i),L.applyWidget(e.table,!1)):o.length?L.sortOn(e,o,function(){L.resortComplete(e,i)},!0):L.sortReset(e,function(){L.resortComplete(e,i),L.applyWidget(e.table,!1)})},sortOn:function(e,t,i,o){var n=e.table;e.$table.triggerHandler("sortStart",n),L.updateHeaderSortCount(e,t),L.setHeadersCss(e),e.delayInit&&L.isEmptyObject(e.cache)&&L.buildCache(e),e.$table.triggerHandler("sortBegin",n),L.multisort(e),L.appendCache(e,o),e.$table.triggerHandler("sortBeforeEnd",n),e.$table.triggerHandler("sortEnd",n),L.applyWidget(n),D.isFunction(i)&&i(n)},sortReset:function(e,t){e.sortList=[],L.setHeadersCss(e),L.multisort(e),L.appendCache(e),D.isFunction(t)&&t(e.table)},getSortType:function(e,t){return e&&e[t]&&e[t].type||""},getOrder:function(e){return/^d/i.test(e)||1===e},sortNatural:function(e,t){if(e!==t){var i,o,n,s,a,r,l=L.regex;if(l.hex.test(t)){if((i=parseInt((e||"").match(l.hex),16))<(o=parseInt((t||"").match(l.hex),16)))return-1;if(o<i)return 1}for(i=(e||"").replace(l.chunk,"\\0$1\\0").replace(l.chunks,"").split("\\0"),o=(t||"").replace(l.chunk,"\\0$1\\0").replace(l.chunks,"").split("\\0"),r=Math.max(i.length,o.length),a=0;a<r;a++){if(n=isNaN(i[a])?i[a]||0:parseFloat(i[a])||0,s=isNaN(o[a])?o[a]||0:parseFloat(o[a])||0,isNaN(n)!==isNaN(s))return isNaN(n)?1:-1;if(typeof n!=typeof s&&(n+="",s+=""),n<s)return-1;if(s<n)return 1}}return 0},sortNaturalAsc:function(e,t,i,o){if(e===t)return 0;i=L.string[o.empties[i]||o.emptyTo];return""===e&&0!==i?"boolean"==typeof i?i?-1:1:-i||-1:""===t&&0!==i?"boolean"==typeof i?i?1:-1:i||1:L.sortNatural(e,t)},sortNaturalDesc:function(e,t,i,o){if(e===t)return 0;i=L.string[o.empties[i]||o.emptyTo];return""===e&&0!==i?"boolean"==typeof i?i?-1:1:i||1:""===t&&0!==i?"boolean"==typeof i?i?1:-1:-i||-1:L.sortNatural(t,e)},sortText:function(e,t){return t<e?1:e<t?-1:0},getTextValue:function(e,t,i){if(i){for(var o=e?e.length:0,n=i+t,s=0;s<o;s++)n+=e.charCodeAt(s);return t*n}return 0},sortNumericAsc:function(e,t,i,o,n,s){if(e===t)return 0;n=L.string[s.empties[n]||s.emptyTo];return""===e&&0!==n?"boolean"==typeof n?n?-1:1:-n||-1:""===t&&0!==n?"boolean"==typeof n?n?1:-1:n||1:(e=isNaN(e)?L.getTextValue(e,i,o):e)-(t=isNaN(t)?L.getTextValue(t,i,o):t)},sortNumericDesc:function(e,t,i,o,n,s){if(e===t)return 0;n=L.string[s.empties[n]||s.emptyTo];return""===e&&0!==n?"boolean"==typeof n?n?-1:1:n||1:""===t&&0!==n?"boolean"==typeof n?n?1:-1:-n||-1:(isNaN(e)&&(e=L.getTextValue(e,i,o)),(t=isNaN(t)?L.getTextValue(t,i,o):t)-e)},sortNumeric:function(e,t){return e-t},addWidget:function(e){e.id&&!L.isEmptyObject(L.getWidgetById(e.id))&&console.warn('"'+e.id+'" widget was loaded more than once!'),L.widgets[L.widgets.length]=e},hasWidget:function(e,t){return(e=D(e)).length&&e[0].config&&e[0].config.widgetInit[t]||!1},getWidgetById:function(e){for(var t,i=L.widgets.length,o=0;o<i;o++)if((t=L.widgets[o])&&t.id&&t.id.toLowerCase()===e.toLowerCase())return t},applyWidgetOptions:function(e){var t,i,o=e.config,n=o.widgets.length;if(n)for(t=0;t<n;t++)(i=L.getWidgetById(o.widgets[t]))&&i.options&&(o.widgetOptions=D.extend(!0,{},i.options,o.widgetOptions))},addWidgetFromClass:function(e){var t,i,o=e.config,n="^"+o.widgetClass.replace(L.regex.templateName,"(\\S+)+")+"$",s=new RegExp(n,"g"),a=(e.className||"").split(L.regex.spaces);if(a.length)for(t=a.length,i=0;i<t;i++)a[i].match(s)&&(o.widgets[o.widgets.length]=a[i].replace(s,"$1"))},applyWidgetId:function(e,t,i){var o,n,s,a=(e=D(e)[0]).config,r=a.widgetOptions,t=L.getWidgetById(t);t&&(s=t.id,o=!1,D.inArray(s,a.widgets)<0&&(a.widgets[a.widgets.length]=s),a.debug&&(n=new Date),!i&&a.widgetInit[s]||(a.widgetInit[s]=!0,e.hasInitialized&&L.applyWidgetOptions(e),"function"==typeof t.init&&(o=!0,a.debug&&console[console.group?"group":"log"]("Initializing "+s+" widget"),t.init(e,t,a,r))),i||"function"!=typeof t.format||(o=!0,a.debug&&console[console.group?"group":"log"]("Updating "+s+" widget"),t.format(e,a,r,!1)),a.debug&&o&&(console.log("Completed "+(i?"initializing ":"applying ")+s+" widget"+L.benchmark(n)),console.groupEnd&&console.groupEnd()))},applyWidget:function(e,t,i){var o,n,s,a,r,l=(e=D(e)[0]).config,c=[];if(!1===t||!e.hasInitialized||!e.isApplyingWidgets&&!e.isUpdating){if(l.debug&&(r=new Date),L.addWidgetFromClass(e),clearTimeout(l.timerReady),l.widgets.length){for(e.isApplyingWidgets=!0,l.widgets=D.grep(l.widgets,function(e,t){return D.inArray(e,l.widgets)===t}),n=(s=l.widgets||[]).length,o=0;o<n;o++)(a=L.getWidgetById(s[o]))&&a.id?(a.priority||(a.priority=10),c[o]=a):l.debug&&console.warn('"'+s[o]+'" widget code does not exist!');for(c.sort(function(e,t){return e.priority<t.priority?-1:e.priority===t.priority?0:1}),n=c.length,l.debug&&console[console.group?"group":"log"]("Start "+(t?"initializing":"applying")+" widgets"),o=0;o<n;o++)(a=c[o])&&a.id&&L.applyWidgetId(e,a.id,t);l.debug&&console.groupEnd&&console.groupEnd(),t||"function"!=typeof i||i(e)}l.timerReady=setTimeout(function(){e.isApplyingWidgets=!1,D.data(e,"lastWidgetApplication",new Date),l.$table.triggerHandler("tablesorter-ready")},10),l.debug&&(a=l.widgets.length,console.log("Completed "+(!0===t?"initializing ":"applying ")+a+" widget"+(1!==a?"s":"")+L.benchmark(r)))}},removeWidget:function(e,t,i){var o,n,s,a,r=(e=D(e)[0]).config;if(!0===t)for(t=[],a=L.widgets.length,s=0;s<a;s++)(n=L.widgets[s])&&n.id&&(t[t.length]=n.id);else t=(D.isArray(t)?t.join(","):t||"").toLowerCase().split(/[\s,]+/);for(a=t.length,o=0;o<a;o++)n=L.getWidgetById(t[o]),0<=(s=D.inArray(t[o],r.widgets))&&!0!==i&&r.widgets.splice(s,1),n&&n.remove&&(r.debug&&console.log((i?"Refreshing":"Removing")+' "'+t[o]+'" widget'),n.remove(e,r,r.widgetOptions,i),r.widgetInit[t[o]]=!1)},refreshWidgets:function(e,t,i){for(var o,n=(e=D(e)[0]).config.widgets,s=L.widgets,a=s.length,r=[],l=function(e){D(e).triggerHandler("refreshComplete")},c=0;c<a;c++)(o=s[c])&&o.id&&(t||D.inArray(o.id,n)<0)&&(r[r.length]=o.id);L.removeWidget(e,r.join(","),!0),!0!==i?(L.applyWidget(e,t||!1,l),t&&L.applyWidget(e,!1,l)):l(e)},benchmark:function(e){return" ("+((new Date).getTime()-e.getTime())+" ms)"},log:function(){console.log(arguments)},isEmptyObject:function(e){for(var t in e)return!1;return!0},isValueInArray:function(e,t){for(var i=t&&t.length||0,o=0;o<i;o++)if(t[o][0]===e)return o;return-1},formatFloat:function(e,t){return"string"!=typeof e||""===e?e:(e=(t&&t.config?!1!==t.config.usNumberFormat:void 0===t||t)?e.replace(L.regex.comma,""):e.replace(L.regex.digitNonUS,"").replace(L.regex.comma,"."),L.regex.digitNegativeTest.test(e)&&(e=e.replace(L.regex.digitNegativeReplace,"-$1")),t=parseFloat(e),isNaN(t)?D.trim(e):t)},isDigit:function(e){return isNaN(e)?L.regex.digitTest.test(e.toString().replace(L.regex.digitReplace,"")):""!==e},computeColumnIndex:function(e,t){for(var i,o,n,s,a,r,l,c,d,h=t&&t.columns||0,u=[],p=new Array(h),m=0;m<e.length;m++)for(a=e[m].cells,i=0;i<a.length;i++){for(r=(s=a[i]).parentNode.rowIndex,l=s.rowSpan||1,c=s.colSpan||1,void 0===u[r]&&(u[r]=[]),o=0;o<u[r].length+1;o++)if(void 0===u[r][o]){d=o;break}for(h&&s.cellIndex===d||(s.setAttribute?s.setAttribute("data-column",d):D(s).attr("data-column",d)),o=r;o<r+l;o++)for(void 0===u[o]&&(u[o]=[]),p=u[o],n=d;n<d+c;n++)p[n]="x"}return p.length},fixColumnWidth:function(e){var t,i,o,n,s,e=(e=D(e)[0]).config,a=e.$table.children("colgroup");if(a.length&&a.hasClass(L.css.colgroup)&&a.remove(),e.widthFixed&&0===e.$table.children("colgroup").length){for(a=D('<colgroup class="'+L.css.colgroup+'">'),t=e.$table.width(),n=(o=e.$tbodies.find("tr:first").children(":visible")).length,s=0;s<n;s++)i=parseInt(o.eq(s).width()/t*1e3,10)/10+"%",a.append(D("<col>").css("width",i));e.$table.prepend(a)}},getData:function(e,t,i){var o,n,s="",e=D(e);return e.length?(o=!!D.metadata&&e.metadata(),n=" "+(e.attr("class")||""),void 0!==e.data(i)||void 0!==e.data(i.toLowerCase())?s+=e.data(i)||e.data(i.toLowerCase()):o&&void 0!==o[i]?s+=o[i]:t&&void 0!==t[i]?s+=t[i]:" "!==n&&n.match(" "+i+"-")&&(s=n.match(new RegExp("\\s"+i+"-([\\w-]+)"))[1]||""),D.trim(s)):""},getColumnData:function(e,t,i,o,n){if(null!=t){var s,e=(e=D(e)[0]).config,n=n||e.$headers,a=e.$headerIndexed&&e.$headerIndexed[i]||n.filter('[data-column="'+i+'"]:last');if(void 0!==t[i])return o?t[i]:t[n.index(a)];for(s in t)if("string"==typeof s&&a.filter(s).add(a.find(s)).length)return t[s]}},isProcessing:function(e,t,i){var o=(e=D(e))[0].config,n=i||e.find("."+L.css.header);t?(void 0!==i&&0<o.sortList.length&&(n=n.filter(function(){return!this.sortDisabled&&0<=L.isValueInArray(parseFloat(D(this).attr("data-column")),o.sortList)})),e.add(n).addClass(L.css.processing+" "+o.cssProcessing)):e.add(n).removeClass(L.css.processing+" "+o.cssProcessing)},processTbody:function(e,t,i){if(e=D(e)[0],i)return e.isProcessing=!0,t.before('<colgroup class="tablesorter-savemyplace"/>'),D.fn.detach?t.detach():t.remove();i=D(e).find("colgroup.tablesorter-savemyplace");t.insertAfter(i),i.remove(),e.isProcessing=!1},clearTableBody:function(e){D(e)[0].config.$tbodies.children().detach()},characterEquivalents:{a:"",A:"",c:"",C:"",e:"",E:"",i:"",I:"",o:"",O:"",ss:"",SS:"",u:"",U:""},replaceAccents:function(e){var t,i="[",o=L.characterEquivalents;if(!L.characterRegex){for(t in L.characterRegexArray={},o)"string"==typeof t&&(i+=o[t],L.characterRegexArray[t]=new RegExp("["+o[t]+"]","g"));L.characterRegex=new RegExp(i+"]")}if(L.characterRegex.test(e))for(t in o)"string"==typeof t&&(e=e.replace(L.characterRegexArray[t],t));return e},restoreHeaders:function(e){for(var t,i=D(e)[0].config,o=i.$table.find(i.selectorHeaders),n=o.length,s=0;s<n;s++)(t=o.eq(s)).find("."+L.css.headerIn).length&&t.html(i.headerContent[s])},destroy:function(e,t,i){var o,n,s,a,r,l;(e=D(e)[0]).hasInitialized&&(L.removeWidget(e,!0,!1),o=D(e),s=(n=e.config).debug,r=(a=o.find("thead:first")).find("tr."+L.css.headerRow).removeClass(L.css.headerRow+" "+n.cssHeaderRow),l=o.find("tfoot:first > tr").children("th, td"),!1===t&&0<=D.inArray("uitheme",n.widgets)&&(o.triggerHandler("applyWidgetId",["uitheme"]),o.triggerHandler("applyWidgetId",["zebra"])),a.find("tr").not(r).remove(),a="sortReset update updateRows updateAll updateHeaders updateCell addRows updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets removeWidget destroy mouseup mouseleave "+"keypress sortBegin sortEnd resetToLoadState ".split(" ").join(n.namespace+" "),o.removeData("tablesorter").unbind(a.replace(L.regex.spaces," ")),n.$headers.add(l).removeClass([L.css.header,n.cssHeader,n.cssAsc,n.cssDesc,L.css.sortAsc,L.css.sortDesc,L.css.sortNone].join(" ")).removeAttr("data-column").removeAttr("aria-label").attr("aria-disabled","true"),r.find(n.selectorSort).unbind("mousedown mouseup keypress ".split(" ").join(n.namespace+" ").replace(L.regex.spaces," ")),L.restoreHeaders(e),o.toggleClass(L.css.table+" "+n.tableClass+" tablesorter-"+n.theme,!1===t),e.hasInitialized=!1,delete e.config.cache,"function"==typeof i&&i(e),s&&console.log("tablesorter has been removed"))}};D.fn.tablesorter=function(t){return this.each(function(){var e=D.extend(!0,{},L.defaults,t,L.instanceMethods);e.originalSettings=t,!this.hasInitialized&&L.buildTable&&"TABLE"!==this.nodeName?L.buildTable(this,e):L.setup(this,e)})},window.console&&window.console.log||(L.logs=[],(console={}).log=console.warn=console.error=console.table=function(){var e=1<arguments.length?arguments:arguments[0];L.logs[L.logs.length]={date:Date.now(),log:e}}),L.addParser({id:"no-parser",is:function(){return!1},format:function(){return""},type:"text"}),L.addParser({id:"text",is:function(){return!0},format:function(e,t){t=t.config;return e&&(e=D.trim(t.ignoreCase?e.toLocaleLowerCase():e),e=t.sortLocaleCompare?L.replaceAccents(e):e),e},type:"text"}),L.regex.nondigit=/[^\w,. \-()]/g,L.addParser({id:"digit",is:function(e){return L.isDigit(e)},format:function(e,t){var i=L.formatFloat((e||"").replace(L.regex.nondigit,""),t);return e&&"number"==typeof i?i:e&&D.trim(e&&t.config.ignoreCase?e.toLocaleLowerCase():e)},type:"numeric"}),L.regex.currencyReplace=/[+\-,. ]/g,L.regex.currencyTest=/^\(?\d+[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]|[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]\d+\)?$/,L.addParser({id:"currency",is:function(e){return e=(e||"").replace(L.regex.currencyReplace,""),L.regex.currencyTest.test(e)},format:function(e,t){var i=L.formatFloat((e||"").replace(L.regex.nondigit,""),t);return e&&"number"==typeof i?i:e&&D.trim(e&&t.config.ignoreCase?e.toLocaleLowerCase():e)},type:"numeric"}),L.regex.urlProtocolTest=/^(https?|ftp|file):\/\//,L.regex.urlProtocolReplace=/(https?|ftp|file):\/\/(www\.)?/,L.addParser({id:"url",is:function(e){return L.regex.urlProtocolTest.test(e)},format:function(e){return e&&D.trim(e.replace(L.regex.urlProtocolReplace,""))},type:"text"}),L.regex.dash=/-/g,L.regex.isoDate=/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/,L.addParser({id:"isoDate",is:function(e){return L.regex.isoDate.test(e)},format:function(e,t){var i=e&&new Date(e.replace(L.regex.dash,"/"));return i instanceof Date&&isFinite(i)?i.getTime():e},type:"numeric"}),L.regex.percent=/%/g,L.regex.percentTest=/(\d\s*?%|%\s*?\d)/,L.addParser({id:"percent",is:function(e){return L.regex.percentTest.test(e)&&e.length<15},format:function(e,t){return e&&L.formatFloat(e.replace(L.regex.percent,""),t)},type:"numeric"}),L.addParser({id:"image",is:function(e,t,i,o){return 0<o.find("img").length},format:function(e,t,i){return D(i).find("img").attr(t.config.imgAttr||"alt")||e},parsed:!0,type:"text"}),L.regex.dateReplace=/(\S)([AP]M)$/i,L.regex.usLongDateTest1=/^[A-Z]{3,10}\.?\s+\d{1,2},?\s+(\d{4})(\s+\d{1,2}:\d{2}(:\d{2})?(\s+[AP]M)?)?$/i,L.regex.usLongDateTest2=/^\d{1,2}\s+[A-Z]{3,10}\s+\d{4}/i,L.addParser({id:"usLongDate",is:function(e){return L.regex.usLongDateTest1.test(e)||L.regex.usLongDateTest2.test(e)},format:function(e,t){var i=e&&new Date(e.replace(L.regex.dateReplace,"$1 $2"));return i instanceof Date&&isFinite(i)?i.getTime():e},type:"numeric"}),L.regex.shortDateTest=/(^\d{1,2}[\/\s]\d{1,2}[\/\s]\d{4})|(^\d{4}[\/\s]\d{1,2}[\/\s]\d{1,2})/,L.regex.shortDateReplace=/[\-.,]/g,L.regex.shortDateXXY=/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,L.regex.shortDateYMD=/(\d{4})[\/\s](\d{1,2})[\/\s](\d{1,2})/,L.convertFormat=function(e,t){e=(e||"").replace(L.regex.spaces," ").replace(L.regex.shortDateReplace,"/"),"mmddyyyy"===t?e=e.replace(L.regex.shortDateXXY,"$3/$1/$2"):"ddmmyyyy"===t?e=e.replace(L.regex.shortDateXXY,"$3/$2/$1"):"yyyymmdd"===t&&(e=e.replace(L.regex.shortDateYMD,"$1/$2/$3"));t=new Date(e);return t instanceof Date&&isFinite(t)?t.getTime():""},L.addParser({id:"shortDate",is:function(e){return e=(e||"").replace(L.regex.spaces," ").replace(L.regex.shortDateReplace,"/"),L.regex.shortDateTest.test(e)},format:function(e,t,i,o){var n,s;return e&&(t=(s=(n=t.config).$headerIndexed[o]).length&&s.data("dateFormat")||L.getData(s,L.getColumnData(t,n.headers,o),"dateFormat")||n.dateFormat,s.length&&s.data("dateFormat",t),L.convertFormat(e,t)||e)},type:"numeric"}),L.regex.timeTest=/^(0?[1-9]|1[0-2]):([0-5]\d)(\s[AP]M)$|^((?:[01]\d|[2][0-4]):[0-5]\d)$/i,L.regex.timeMatch=/(0?[1-9]|1[0-2]):([0-5]\d)(\s[AP]M)|((?:[01]\d|[2][0-4]):[0-5]\d)/i,L.addParser({id:"time",is:function(e){return L.regex.timeTest.test(e)},format:function(e,t){var i=(e||"").match(L.regex.timeMatch),o=new Date(e),i=e&&(null!==i?i[0]:"00:00 AM"),i=i&&new Date("2000/01/01 "+i.replace(L.regex.dateReplace,"$1 $2"));return i instanceof Date&&isFinite(i)?(o instanceof Date&&isFinite(o)?o.getTime():0)?parseFloat(i.getTime()+"."+o.getTime()):i.getTime():e},type:"numeric"}),L.addParser({id:"metadata",is:function(){return!1},format:function(e,t,i){t=t.config,t=t.parserMetadataName||"sortValue";return D(i).metadata()[t]},type:"numeric"}),L.addWidget({id:"zebra",priority:90,format:function(e,t,i){for(var o,n,s,a,r,l=new RegExp(t.cssChildRow,"i"),c=t.$tbodies.add(D(t.namespace+"_extra_table").children("tbody:not(."+t.cssInfoBlock+")")),d=0;d<c.length;d++)for(n=0,r=(o=c.eq(d).children("tr:visible").not(t.selectorRemove)).length,a=0;a<r;a++)s=o.eq(a),l.test(s[0].className)||n++,s.removeClass(i.zebra[(s=n%2==0)?1:0]).addClass(i.zebra[s?0:1])},remove:function(e,t,i,o){if(!o)for(var n,s=t.$tbodies,a=(i.zebra||["even","odd"]).join(" "),r=0;r<s.length;r++)(n=L.processTbody(e,s.eq(r),!0)).children().removeClass(a),L.processTbody(e,n,!1)}})}(_),_.tablesorter});var _jsrview_uri="",__rvapi_local_service=is_rvapi_local_service();function is_rvapi_local_service(){return"ls_RVAPIAppButtonClicked"in window.parent&&"?local_service"==window.location.search?1:0}function makeUglyMolHtml(e,t,i,o,n){var s='<!doctype html>\n<html lang="en">\n<base target="_parent">\n<head>\n  <meta charset="utf-8">\n  <meta name="viewport" content="width=device-width, user-scalable=no">\n  <meta name="theme-color" content="#333333">\n  <link rel="stylesheet" type="text/css" href="'+_jsrview_uri+'uglymol/uglymol.css"/>\n  <script src="'+_jsrview_uri+'uglymol/uglymol.js"><\/script>\n  <script src="'+_jsrview_uri+'uglymol/mtz.js"><\/script>\n</head>\n<body style="overflow:hidden;font-size:16px;">\n  <div id="viewer" style="position:absolute; left:0px; top:0px; overflow:hidden;"></div>\n  <header id="hud" onmousedown="event.stopPropagation();"\n                   onmousemove="event.stopPropagation();"\n                   ondblclick="event.stopPropagation();">\n             This is uglymol not coot.\n           <a href="#" onclick="V.toggle_help(); return false;">\n             H shows help.\n           </a>\n  </header>\n  <footer id="help"></footer>\n  <div id="inset"></div>\n  <script>\n    V = new UM.Viewer({viewer:"viewer",hud:"hud",help:"help"});\n';if(0<e.length&&(s+='    V.load_pdb("'+e+'");\n'),0<i.length&&0<o.length)s+='    V.load_ccp4_maps("'+i+'","'+o+'");\n';else if(0<i.length)s+='    V.load_map("'+i+'",{diff_map: false, format: "ccp4"});\n';else if(0<o.length)s+='    V.load_map("'+o+'",{diff_map: true, format: "ccp4"});\n';else if(0<t.length){var a='"';if(n){for(var r=n.split(","),a='", [',l=0;l<r.length;l++)a+='"'+r[l]+'",';a=a.slice(0,-1)+"]"}s+='    GemmiMtz().then(function(Module) {\n      UM.load_maps_from_mtz ( Module, V, "'+t+a+" );\n    });\n"}return s+="  <\/script>\n</body>\n</html>\n"}function calcViewerSize(e,t){var i=window.parent.innerWidth,o=i-40,n=window.parent.innerHeight-56;return window.parent.__any_mobile_device||(n-=8,void 0!==window.parent.__touch_device&&window.parent.__touch_device||(0<e&&(o=e*Math.min(i,n)),0<t&&(n=t*Math.min(i,n)))),[o,n]}function startUglyMol(e,t,i,o,n,s){var a,r,l,c;function d(e){return e&&encodeURI(e)}2==is_rvapi_local_service()?new MessageBox("Operation cannot be performed","Structure visualisation cannot be started<br>at this moment"):(c=window.parent.document,a=window.parent.$,a||(c=window.document,a=window.$),r=c.createElement("div"),a(r).css({"box-shadow":"8px 8px 16px 16px rgba(0,0,0,0.2)",overflow:"hidden"}),c.body.appendChild(r),l=c.createElement("iframe"),a(l).css({border:"none",overflow:"hidden"}),c=window.parent.__any_mobile_device?calcViewerSize(1,1):window.parent.__user_settings&&window.parent.__user_settings.viewers_size?calcViewerSize(window.parent.__user_settings.viewers_size[0],window.parent.__user_settings.viewers_size[1]):calcViewerSize(1.25,.85),a(l).width(c[0]),a(l).height(c[1]),r.appendChild(l),c={resizable:!0,height:"auto",width:"auto",modal:!1,title:e,effect:"fade",headerVisible:!1,create:function(){l.contentWindow.focus()},focus:function(){l.contentWindow.focus()},open:function(){l.contentWindow.focus()},dragStop:function(){l.contentWindow.focus()},resizeStop:function(){l.contentWindow.focus()},buttons:{}},window.parent.__any_mobile_device&&(c.position={my:"left top",at:"left top"},c.resizable=!1,c.modal=!0),a(r).dialog(c),e=makeUglyMolHtml(d(t),d(i),d(o),d(n),s),l.contentWindow.document.write(e),l.contentWindow.document.close(),a(r).on("dialogresize",function(e,t){var i=a(r).width(),o=a(r).height();a(l).width(i),a(l).height(o)}),a(r).on("dialogclose",function(e,t){window.setTimeout(function(){a(r).dialog("destroy"),r.parentNode&&r.parentNode.removeChild(r)},10)}),a(r).click(function(){l.contentWindow.focus()}))}function _startUglyMol(e,t){var i=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")+1);function o(e){return e.length<=0||e.endsWith("/")?"":e.startsWith(i)?e:normalize_path(i+e)}var n="",s="",a="",r="",l="",c=e.split(">>>"),d=[];c.length<=1?n=0<(d=e.split("*")).length?d[0].split(/[\\/]/).pop():"No title":(n=c[0],d=c[1].split("*")),0<d.length&&(s=o(i+d[0]),1<d.length&&((r=o(i+d[1])).toLowerCase().endsWith(".mtz")?(a=r,r="",2<d.length&&(r=o(i+d[2]),3<d.length&&(l=o(i+d[3])))):2<d.length&&(l=o(i+d[2])))),startUglyMol(n,s,a,r,l,t)}function makeViewHKLHtml(e,t){return'<!DOCTYPE html>\n<html>\n  <head>\n    <meta http-equiv="content-type" content="text/html; charset=UTF-8">\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, user-scalable=no">\n    <meta name="theme-color" content="#333333">\n    <meta http-equiv="pragma"  content="no-cache">\n    <meta http-equiv="expires" content="0">\n    <title>ViewHKL '+e+'</title>\n  </head>\n  <link rel="stylesheet" type="text/css" href="'+_jsrview_uri+'jquery-ui/css/jquery-ui.css"/>\n  <link rel="stylesheet" type="text/css" href="'+_jsrview_uri+'viewhkl/css/gui/gui.widgets.css"/>\n  <link rel="stylesheet" type="text/css" href="'+_jsrview_uri+'viewhkl/css/gui/gui.tables.css"/>\n  <link rel="stylesheet" type="text/css" href="'+_jsrview_uri+'viewhkl/css/gui/gui.tabs.css"/>\n  <script src="'+_jsrview_uri+'jquery-ui/js/jquery.js"><\/script>\n  <script src="'+_jsrview_uri+'jquery-ui/js/jquery-ui.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/gui/gui.widgets.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/gui/gui.tables.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/gui/gui.tabs.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/gui/gui.menu.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/gui/gui.canvas.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/mtz.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/viewhkl.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/viewhkl_tab1.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/viewhkl_tab2.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/viewhkl_tab3.js"><\/script>\n  <script src="'+_jsrview_uri+'viewhkl/viewhkl_tab4.js"><\/script>\n<body style="font-size:16px;">\n  <div id="scene"></div>\n   <script>\n      $(document).ready(function()  {\n          $(function() {\n            $( document ).tooltip();\n          });\n          var viewhkl = new ViewHKL ( "scene",true );\n          viewhkl.Load ( "'+t+'" );\n        });\n      <\/script>\n</body>\n</html>'}function startViewHKL(e,t,i){var e=(e=e)||t.split(/[\\/]/).pop(),o=window.parent.document,n=window.parent.$,s=(n||(o=window.document,n=window.$),o.createElement("div")),a=($(s).css({"box-shadow":"8px 8px 16px 16px rgba(0,0,0,0.2)",overflow:"hidden"}),o.body.appendChild(s),o.createElement("iframe")),o=(n(a).css({border:"none",overflow:"hidden"}),o=window.parent.__any_mobile_device?calcViewerSize(1,1):window.parent.__user_settings&&window.parent.__user_settings.viewers_size?calcViewerSize(window.parent.__user_settings.viewers_size[0],window.parent.__user_settings.viewers_size[1]):calcViewerSize(1.25,.85),n(a).width(o[0]),n(a).height(o[1]),s.appendChild(a),n(s).dialog({resizable:!0,height:"auto",width:"auto",modal:!1,title:"ViewHKL ["+e+"]",effect:"fade",create:function(){a.contentWindow.focus()},focus:function(){a.contentWindow.focus()},open:function(){a.contentWindow.focus()},dragStop:function(){a.contentWindow.focus()},resizeStop:function(){a.contentWindow.focus()},buttons:{}}),makeViewHKLHtml(e,t));a.contentWindow.document.write(o),a.contentWindow.document.close(),n(s).on("dialogresize",function(e,t){var i=n(s).width(),o=n(s).height();n(a).width(i),n(a).height(o)}),n(s).on("dialogclose",function(e,t){window.setTimeout(function(){n(s).dialog("destroy"),s.parentNode&&s.parentNode.removeChild(s)},10)}),n(s).click(function(){a.contentWindow.focus()})}function makeRSViewerHtml(e,t){return'<!doctype html>\n<html lang="en">\n<head>\n  <meta charset="utf-8">\n  <meta name="viewport" content="width=device-width, user-scalable=no">\n  <meta name="theme-color" content="#333333">\n  <link rel="stylesheet" type="text/css" href="'+_jsrview_uri+'uglymol/uglymol.css"/>\n  <script src="'+_jsrview_uri+'uglymol/uglymol.js"><\/script>\n</head>\n<body style="background-color:black;font-size:16px;">\n  <div id="viewer"></div>\n  <header id="hud" onmousedown="event.stopPropagation();"\n                   ondblclick="event.stopPropagation();"\n             >This is reciprocal UM. <a href="#"\n                         onclick="V.toggle_help(); return false;"\n                         >H shows help.</a></header>\n  <footer id="help"></footer>\n  <div id="inset"></div>\n  <script>\n    V = new UM.ReciprocalViewer({viewer: "viewer", hud: "hud", help: "help"});\n    V.load_data ( "'+e+'",{\n      callback : function(){\n        var oReq = new XMLHttpRequest();\n        oReq.open ( "POST", "'+t+'", true );\n        oReq.responseType = "arraybuffer";\n        oReq.timeout      = 9999999;\n        oReq.onreadystatechange = function(oEvent) {\n          if (oReq.readyState === 4) {\n            // chrome --allow-file-access-from-files gives status 0\n            if (oReq.status === 200 || (oReq.status   === 0 &&\n                                        oReq.response !== null &&\n                                        oReq.response !== "")) {\n              try {\n                var arrayBuffer = oReq.response;\n                if (arrayBuffer) {\n                  V.load_map_from_ab ( arrayBuffer )\n                } else {\n                  alert ( "null buffer received as map file" );\n                }\n              } catch (e) {\n                alert ( "Error: " + e.message + "\\nin '+t+'", "ERR");\n              }\n            } else {\n              alert ( "Failed to fetch '+t+'", "ERR");\n            }\n          }\n        }\n        oReq.onerror = function()  {\n          alert ( "errors at loading map file" );\n        }\n        oReq.send(null);\n      }\n    });\n  <\/script>\n</body>\n</html>\n'}function startRSViewer(e,t,i){var n,s,a,o;2==is_rvapi_local_service()?new MessageBox("Operation cannot be performed","Reciprocal Space Viewer cannot be launched<br>at this moment"):(o=window.parent.document,n=window.parent.$,s=o.createElement("div"),n(s).css({"box-shadow":"8px 8px 16px 16px rgba(0,0,0,0.2)",overflow:"hidden"}),o.body.appendChild(s),a=o.createElement("iframe"),n(a).css({border:"none",overflow:"hidden"}),o=window.parent.__any_mobile_device?calcViewerSize(1,1):window.parent.__user_settings&&window.parent.__user_settings.viewers_size?calcViewerSize(window.parent.__user_settings.viewers_size[0],window.parent.__user_settings.viewers_size[1]):calcViewerSize(1.25,.85),n(a).width(o[0]),n(a).height(o[1]),s.appendChild(a),n(s).dialog({resizable:!0,height:"auto",width:"auto",modal:!1,title:e,effect:"fade",create:function(){a.contentWindow.focus()},focus:function(){a.contentWindow.focus()},open:function(){a.contentWindow.focus()},dragStop:function(){a.contentWindow.focus()},resizeStop:function(){a.contentWindow.focus()},buttons:{}}),o=makeRSViewerHtml(t,i),a.contentWindow.document.write(o),a.contentWindow.document.close(),n(s).on("dialogresize",function(e,t){var i=n(s).width(),o=n(s).height();n(a).width(i),n(a).height(o)}),n(s).on("dialogclose",function(e,t){window.setTimeout(function(){n(s).dialog("destroy"),s.parentNode&&s.parentNode.removeChild(s)},10)}),n(s).click(function(){a.contentWindow.focus()}))}!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(R,E){"use strict";if(!R.jstree){var n,s,a=0,r=!1,l=!1,c=!1,i=[],e=R("script:last").attr("src"),b=window.document,d=window.setImmediate,o=window.Promise,h=(!d&&o&&(d=function(e,t){o.resolve(t).then(e)}),R.jstree={version:"3.3.12",defaults:{plugins:[]},plugins:{},path:e&&-1!==e.indexOf("/")?e.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},R.jstree.create=function(e,i){var o=new R.jstree.core(++a),t=i;return i=R.extend(!0,{},R.jstree.defaults,i),t&&t.plugins&&(i.plugins=t.plugins),R.each(i.plugins,function(e,t){"core"!==e&&(o=o.plugin(t,i[t]))}),R(e).data("jstree",o),o.init(e,i),o},R.jstree.destroy=function(){R(".jstree:jstree").jstree("destroy"),R(b).off(".jstree")},R.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},R.jstree.reference=function(t){var i=null,e=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!e||!e.length)try{e=R(t)}catch(e){}if(!e||!e.length)try{e=R("#"+t.replace(R.jstree.idregex,"\\$&"))}catch(e){}return e&&e.length&&(e=e.closest(".jstree")).length&&(e=e.data("jstree"))?i=e:R(".jstree").each(function(){var e=R(this).data("jstree");return e&&e._model.data[t]?(i=e,!1):void 0}),i},R.fn.jstree=function(i){var o="string"==typeof i,n=Array.prototype.slice.call(arguments,1),s=null;return!(!0===i&&!this.length)&&(this.each(function(){var e=R.jstree.reference(this),t=o&&e?e[i]:null;return s=o&&t?t.apply(e,n):null,e||o||i!==E&&!R.isPlainObject(i)||R.jstree.create(this,i),(null===(s=e&&!o||!0===i?e||!1:s)||s===E)&&void 0}),null!==s&&s!==E?s:this)},R.expr.pseudos.jstree=R.expr.createPseudo(function(e){return function(e){return R(e).hasClass("jstree")&&R(e).data("jstree")!==E}}),R.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:R.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0,loaded_state:!1,restore_focus:!0,compute_elements_positions:!1,keyboard:{"ctrl-space":function(e){e.type="click",R(e.currentTarget).trigger(e)},enter:function(e){e.type="click",R(e.currentTarget).trigger(e)},left:function(e){e.preventDefault(),this.is_open(e.currentTarget)?this.close_node(e.currentTarget):(e=this.get_parent(e.currentTarget))&&e.id!==R.jstree.root&&this.get_node(e,!0).children(".jstree-anchor").trigger("focus")},up:function(e){e.preventDefault();e=this.get_prev_dom(e.currentTarget);e&&e.length&&e.children(".jstree-anchor").trigger("focus")},right:function(e){e.preventDefault(),this.is_closed(e.currentTarget)?this.open_node(e.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").trigger("focus")}):this.is_open(e.currentTarget)&&(e=this.get_node(e.currentTarget,!0).children(".jstree-children")[0])&&R(this._firstChild(e)).children(".jstree-anchor").trigger("focus")},down:function(e){e.preventDefault();e=this.get_next_dom(e.currentTarget);e&&e.length&&e.children(".jstree-anchor").trigger("focus")},"*":function(e){this.open_all()},home:function(e){e.preventDefault();e=this._firstChild(this.get_container_ul()[0]);e&&R(e).children(".jstree-anchor").filter(":visible").trigger("focus")},end:function(e){e.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().trigger("focus")},f2:function(e){e.preventDefault(),this.edit(e.currentTarget)}}},R.jstree.core.prototype={plugin:function(e,t){var i=R.jstree.plugins[e];return i?(this._data[e]={},i.prototype=this,new i(t,this)):this},init:function(e,t){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[R.jstree.root]={id:R.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=R(e).addClass("jstree jstree-"+this._id),this.settings=t,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().outerHeight()||24,this._data.core.node=this._create_prototype_node(),this.trigger("loading"),this.load_node(R.jstree.root)},destroy:function(e){if(this.trigger("destroy"),this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},_create_prototype_node:function(){var e,t,i=b.createElement("LI");return i.setAttribute("role","none"),(e=b.createElement("I")).className="jstree-icon jstree-ocl",e.setAttribute("role","presentation"),i.appendChild(e),(e=b.createElement("A")).className="jstree-anchor",e.setAttribute("href","#"),e.setAttribute("tabindex","-1"),e.setAttribute("role","treeitem"),(t=b.createElement("I")).className="jstree-icon jstree-themeicon",t.setAttribute("role","presentation"),e.appendChild(t),i.appendChild(e),e=t=null,i},_kbevent_to_func:function(e){var t=[];if(e.ctrlKey&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&t.push("shift"),t.push({8:"Backspace",9:"Tab",13:"Enter",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock",16:"Shift",17:"Ctrl",18:"Alt",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*",173:"-"}[e.which]||e.which),"shift-shift"!==(t=t.sort().join("-").toLowerCase())&&"ctrl-ctrl"!==t&&"alt-alt"!==t){var i,o,n=this.settings.core.keyboard;for(i in n)if(n.hasOwnProperty(i)&&(o=i,"-"!==o&&"+"!==o&&(o=o.replace("--","-MINUS").replace("+-","-MINUS").replace("++","-PLUS").replace("-+","-PLUS"),o=o.split(/-|\+/).sort().join("-").replace("MINUS","-").replace("PLUS","+").toLowerCase()),o===t))return n[i]}return null},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var n="",s=null,t=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(b.selection&&b.selection.empty)b.selection.empty();else if(window.getSelection){e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(e){}}}).on("mousedown.jstree",function(e){e.target===this.element[0]&&(e.preventDefault(),t=+new Date)}.bind(this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",function(e){this.toggle_node(e.target)}.bind(this)).on("dblclick.jstree",".jstree-anchor",function(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))}.bind(this)).on("click.jstree",".jstree-anchor",function(e){e.preventDefault(),e.currentTarget!==b.activeElement&&R(e.currentTarget).trigger("focus"),this.activate_node(e.currentTarget,e)}.bind(this)).on("keydown.jstree",".jstree-anchor",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;this._data.core.rtl&&(37===e.which?e.which=39:39===e.which&&(e.which=37));var t=this._kbevent_to_func(e);if(t){t=t.call(this,e);if(!1===t||!0===t)return t}}.bind(this)).on("load_node.jstree",function(e,t){t.status&&(t.node.id!==R.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){for(var e=[],t=0,i=this._data.core.selected.length;t<i;t++)e=e.concat(this._model.data[this._data.core.selected[t]].parents);for(t=0,i=(e=R.vakata.array_unique(e)).length;t<i;t++)this.open_node(e[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}}.bind(this),0))}.bind(this)).on("keypress.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;s&&clearTimeout(s),s=setTimeout(function(){n=""},500);var i=String.fromCharCode(e.which).toLowerCase(),e=this.element.find(".jstree-anchor").filter(":visible"),t=e.index(b.activeElement)||0,o=!1;if(1<(n+=i).length){if(e.slice(t).each(function(e,t){return 0===R(t).text().toLowerCase().indexOf(n)?(R(t).trigger("focus"),!(o=!0)):void 0}.bind(this)),o)return;if(e.slice(0,t).each(function(e,t){return 0===R(t).text().toLowerCase().indexOf(n)?(R(t).trigger("focus"),!(o=!0)):void 0}.bind(this)),o)return}new RegExp("^"+i.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(n)&&(e.slice(t+1).each(function(e,t){return R(t).text().toLowerCase().charAt(0)===i?(R(t).trigger("focus"),!(o=!0)):void 0}.bind(this)),o||e.slice(0,t+1).each(function(e,t){return R(t).text().toLowerCase().charAt(0)===i?(R(t).trigger("focus"),!(o=!0)):void 0}.bind(this)))}.bind(this)).on("init.jstree",function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this._data.core.themes.ellipsis=e.ellipsis,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)}.bind(this)).on("loading.jstree",function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"](),this[this._data.core.themes.ellipsis?"show_ellipsis":"hide_ellipsis"]()}.bind(this)).on("blur.jstree",".jstree-anchor",function(e){this._data.core.focused=null,R(e.currentTarget).filter(".jstree-hovered").trigger("mouseleave"),this.element.attr("tabindex","0")}.bind(this)).on("focus.jstree",".jstree-anchor",function(e){var t=this.get_node(e.currentTarget);t&&t.id&&(this._data.core.focused=t.id),this.element.find(".jstree-hovered").not(e.currentTarget).trigger("mouseleave"),R(e.currentTarget).trigger("mouseenter"),this.element.attr("tabindex","-1")}.bind(this)).on("focus.jstree",function(){var e;500<+new Date-t&&!this._data.core.focused&&this.settings.core.restore_focus&&(t=0,(e=this.get_node(this.element.attr("aria-activedescendant"),!0))&&e.find("> .jstree-anchor").trigger("focus"))}.bind(this)).on("mouseenter.jstree",".jstree-anchor",function(e){this.hover_node(e.currentTarget)}.bind(this)).on("mouseleave.jstree",".jstree-anchor",function(e){this.dehover_node(e.currentTarget)}.bind(this))},unbind:function(){this.element.off(".jstree"),R(b).off(".jstree-"+this._id)},trigger:function(e,t){((t=t||{}).instance=this).element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(e){var t=this.settings.core.strings;return R.vakata.is_function(t)?t.call(this,e):t&&t[e]?t[e]:e},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(e,t){var i;(e=e&&e.id?e.id:e)instanceof R&&e.length&&e[0].id&&(e=e[0].id);try{if(this._model.data[e])e=this._model.data[e];else if("string"==typeof e&&this._model.data[e.replace(/^#/,"")])e=this._model.data[e.replace(/^#/,"")];else if("string"==typeof e&&(i=R("#"+e.replace(R.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[i.closest(".jstree-node").attr("id")])e=this._model.data[i.closest(".jstree-node").attr("id")];else if((i=this.element.find(e)).length&&this._model.data[i.closest(".jstree-node").attr("id")])e=this._model.data[i.closest(".jstree-node").attr("id")];else{if(!(i=this.element.find(e)).length||!i.hasClass("jstree"))return!1;e=this._model.data[R.jstree.root]}return e=t?e.id===R.jstree.root?this.element:R("#"+e.id.replace(R.jstree.idregex,"\\$&"),this.element):e}catch(e){return!1}},get_path:function(e,t,i){if(!(e=e.parents?e:this.get_node(e))||e.id===R.jstree.root||!e.parents)return!1;var o,n,s=[];for(s.push(i?e.id:e.text),o=0,n=e.parents.length;o<n;o++)s.push(i?e.parents[o]:this.get_text(e.parents[o]));return s=s.reverse().slice(1),t?s.join(t):s},get_next_dom:function(e,t){var i;if((e=this.get_node(e,!0))[0]===this.element[0]){for(i=this._firstChild(this.get_container_ul()[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);return!!i&&R(i)}if(!e||!e.length)return!1;if(t){for(i=e[0];(i=this._nextSibling(i))&&0===i.offsetHeight;);return!!i&&R(i)}if(e.hasClass("jstree-open")){for(i=this._firstChild(e.children(".jstree-children")[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);if(null!==i)return R(i)}for(i=e[0];(i=this._nextSibling(i))&&0===i.offsetHeight;);return null!==i?R(i):e.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(e,t){var i;if((e=this.get_node(e,!0))[0]===this.element[0]){for(i=this.get_container_ul()[0].lastChild;i&&0===i.offsetHeight;)i=this._previousSibling(i);return!!i&&R(i)}if(!e||!e.length)return!1;if(t){for(i=e[0];(i=this._previousSibling(i))&&0===i.offsetHeight;);return!!i&&R(i)}for(i=e[0];(i=this._previousSibling(i))&&0===i.offsetHeight;);if(null===i)return!(!(i=e[0].parentNode.parentNode)||!i.className||-1===i.className.indexOf("jstree-node"))&&R(i);for(e=R(i);e.hasClass("jstree-open");)e=e.children(".jstree-children").first().children(".jstree-node:visible:last");return e},get_parent:function(e){return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&e.parent},get_children_dom:function(e){return(e=this.get_node(e,!0))[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||0<e.children.length)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(a,r){var e,t,i,o,n;if(R.vakata.is_array(a))this._load_nodes(a.slice(),r);else{if(!(a=this.get_node(a)))return r&&r.call(this,a,!1),!1;if(a.state.loaded){for(a.state.loaded=!1,i=0,o=a.parents.length;i<o;i++)this._model.data[a.parents[i]].children_d=R.vakata.array_filter(this._model.data[a.parents[i]].children_d,function(e){return-1===R.inArray(e,a.children_d)});for(e=0,t=a.children_d.length;e<t;e++)this._model.data[a.children_d[e]].state.selected&&(n=!0),delete this._model.data[a.children_d[e]];n&&(this._data.core.selected=R.vakata.array_filter(this._data.core.selected,function(e){return-1===R.inArray(e,a.children_d)})),a.children=[],a.children_d=[],n&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}a.state.failed=!1,a.state.loading=!0,this.get_node(a,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(a,function(e){(a=this._model.data[a.id]).state.loading=!1,a.state.loaded=e,a.state.failed=!a.state.loaded;for(var t=this.get_node(a,!0),i=0,o=this._model.data,n=!1,i=0,s=a.children.length;i<s;i++)if(o[a.children[i]]&&!o[a.children[i]].state.hidden){n=!0;break}a.state.loaded&&t&&t.length&&(t.removeClass("jstree-closed jstree-open jstree-leaf"),n?"#"!==a.id&&t.addClass(a.state.opened?"jstree-open":"jstree-closed"):t.addClass("jstree-leaf")),t.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:a,status:e}),r&&r.call(this,a,e)}.bind(this))}return!0},_load_nodes:function(e,t,i,o){for(var n=!0,s=function(){this._load_nodes(e,t,!0)},a=this._model.data,r=[],l=0,c=e.length;l<c;l++)a[e[l]]&&(!a[e[l]].state.loaded&&!a[e[l]].state.failed||!i&&o)&&(this.is_loading(e[l])||this.load_node(e[l],s),n=!1);if(n){for(l=0,c=e.length;l<c;l++)a[e[l]]&&a[e[l]].state.loaded&&r.push(e[l]);t&&!t.done&&(t.call(this,r),t.done=!0)}},load_all:function(e,t){if(e=e||R.jstree.root,!(e=this.get_node(e)))return!1;var i,o,n=[],s=this._model.data,a=s[e.id].children_d;for(e.state&&!e.state.loaded&&n.push(e.id),i=0,o=a.length;i<o;i++)s[a[i]]&&s[a[i]].state&&!s[a[i]].state.loaded&&n.push(a[i]);n.length?this._load_nodes(n,function(){this.load_all(e,t)}):(t&&t.call(this,e),this.trigger("load_all",{node:e}))},_load_node:function(n,s){function a(){return 3!==this.nodeType&&8!==this.nodeType}var e,t=this.settings.core.data;return t?R.vakata.is_function(t)?t.call(this,n,function(e){!1===e?s.call(this,!1):this["string"==typeof e?"_append_html_data":"_append_json_data"](n,"string"==typeof e?R(R.parseHTML(e)).filter(a):e,function(e){s.call(this,e)})}.bind(this)):"object"==typeof t?t.url?(t=R.extend(!0,{},t),R.vakata.is_function(t.url)&&(t.url=t.url.call(this,n)),R.vakata.is_function(t.data)&&(t.data=t.data.call(this,n)),R.ajax(t).done(function(e,t,i){var o=i.getResponseHeader("Content-Type");return o&&-1!==o.indexOf("json")||"object"==typeof e?this._append_json_data(n,e,function(e){s.call(this,e)}):o&&-1!==o.indexOf("html")||"string"==typeof e?this._append_html_data(n,R(R.parseHTML(e)).filter(a),function(e){s.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:n.id,xhr:i})},this.settings.core.error.call(this,this._data.core.last_error),s.call(this,!1))}.bind(this)).fail(function(e){this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:n.id,xhr:e})},s.call(this,!1),this.settings.core.error.call(this,this._data.core.last_error)}.bind(this))):(e=R.vakata.is_array(t)?R.extend(!0,[],t):R.isPlainObject(t)?R.extend(!0,{},t):t,n.id===R.jstree.root?this._append_json_data(n,e,function(e){s.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:n.id})},this.settings.core.error.call(this,this._data.core.last_error),s.call(this,!1))):"string"==typeof t?n.id===R.jstree.root?this._append_html_data(n,R(R.parseHTML(t)).filter(a),function(e){s.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:n.id})},this.settings.core.error.call(this,this._data.core.last_error),s.call(this,!1)):s.call(this,!1):n.id===R.jstree.root?this._append_html_data(n,this._data.core.original_container_html.clone(!0),function(e){s.call(this,e)}):s.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&-1===R.inArray(e.id,this._model.changed)&&this._model.changed.push(e.id)},_append_html_data:function(e,t,i){(e=this.get_node(e)).children=[],e.children_d=[];var o,n,s,t=t.is("ul")?t.children():t,a=e.id,r=[],l=[],c=this._model.data,d=c[a],e=this._data.core.selected.length;for(t.each(function(e,t){(o=this._parse_model_from_html(R(t),a,d.parents.concat()))&&(r.push(o),l.push(o),c[o].children_d.length&&(l=l.concat(c[o].children_d)))}.bind(this)),d.children=r,d.children_d=l,n=0,s=d.parents.length;n<s;n++)c[d.parents[n]].children_d=c[d.parents[n]].children_d.concat(l);this.trigger("model",{nodes:l,parent:a}),a!==R.jstree.root?(this._node_changed(a),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==e&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)},_append_json_data:function(e,t,l,i){if(null!==this.element){(e=this.get_node(e)).children=[],e.children_d=[],t.d&&("string"==typeof(t=t.d)&&(t=JSON.parse(t))),R.vakata.is_array(t)||(t=[t]);var o=null,n={df:this._model.default_state,dat:t,par:e.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},_=this,s=function(e,c){function d(e,t,i){i=i?i.concat():[],t&&i.unshift(t);var o,n,s,a,r=e.id.toString(),l={id:r,text:e.text||"",icon:e.icon===c||e.icon,parent:t,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in p)p.hasOwnProperty(o)&&(l.state[o]=p[o]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==c&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(o in e.data.jstree)e.data.jstree.hasOwnProperty(o)&&(l.state[o]=e.data.jstree[o]);if(e&&"object"==typeof e.state)for(o in e.state)e.state.hasOwnProperty(o)&&(l.state[o]=e.state[o]);if(e&&"object"==typeof e.li_attr)for(o in e.li_attr)e.li_attr.hasOwnProperty(o)&&(l.li_attr[o]=e.li_attr[o]);if(l.li_attr.id||(l.li_attr.id=r),e&&"object"==typeof e.a_attr)for(o in e.a_attr)e.a_attr.hasOwnProperty(o)&&(l.a_attr[o]=e.a_attr[o]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),o=0,n=(g[l.id]=l).children.length;o<n;o++)s=d(g[l.children[o]],l.id,i),a=g[s],l.children_d.push(s),a.children_d.length&&(l.children_d=l.children_d.concat(a.children_d));return delete e.data,delete e.children,g[l.id].original=e,l.state.selected&&u.push(l.id),l.id}function h(e,t,i){i=i?i.concat():[],t&&i.unshift(t);for(var o,n,s,a,r,l=!1;l="j"+m+"_"+ ++f,g[l];);for(o in r={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===c||e.icon,parent:t,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},p)p.hasOwnProperty(o)&&(r.state[o]=p[o]);if(e&&e.id&&(r.id=e.id.toString()),e&&e.text&&(r.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(r.icon=e.data.jstree.icon),r.icon!==c&&null!==r.icon&&""!==r.icon||(r.icon=!0),e&&e.data&&(r.data=e.data,e.data.jstree))for(o in e.data.jstree)e.data.jstree.hasOwnProperty(o)&&(r.state[o]=e.data.jstree[o]);if(e&&"object"==typeof e.state)for(o in e.state)e.state.hasOwnProperty(o)&&(r.state[o]=e.state[o]);if(e&&"object"==typeof e.li_attr)for(o in e.li_attr)e.li_attr.hasOwnProperty(o)&&(r.li_attr[o]=e.li_attr[o]);if(r.li_attr.id&&!r.id&&(r.id=r.li_attr.id.toString()),r.id||(r.id=l),r.li_attr.id||(r.li_attr.id=r.id),e&&"object"==typeof e.a_attr)for(o in e.a_attr)e.a_attr.hasOwnProperty(o)&&(r.a_attr[o]=e.a_attr[o]);if(e&&e.children&&e.children.length){for(o=0,n=e.children.length;o<n;o++)s=h(e.children[o],r.id,i),a=g[s],r.children.push(s),a.children_d.length&&(r.children_d=r.children_d.concat(a.children_d));r.children_d=r.children_d.concat(r.children)}return e&&e.children&&!0===e.children&&(r.state.loaded=!1,r.children=[],r.children_d=[]),delete e.data,delete e.children,r.original=e,(g[r.id]=r).state.selected&&u.push(r.id),r.id}var t,i,o,n=(e=e.data?e.data:e).dat,s=e.par,a=[],r=[],u=[],p=e.df,m=e.t_id,f=e.t_cnt,g=e.m,l=g[s],e=e.sel;if(n.length&&n[0].id!==c&&n[0].parent!==c){for(i=0,o=n.length;i<o;i++)n[i].children||(n[i].children=[]),n[i].state||(n[i].state={}),g[n[i].id.toString()]=n[i];for(i=0,o=n.length;i<o;i++)g[n[i].parent.toString()]?(g[n[i].parent.toString()].children.push(n[i].id.toString()),l.children_d.push(n[i].id.toString())):void 0!==_&&(_._data.core.last_error={error:"parse",plugin:"core",id:"core_07",reason:"Node with invalid parent",data:JSON.stringify({id:n[i].id.toString(),parent:n[i].parent.toString()})},_.settings.core.error.call(_,_._data.core.last_error));for(i=0,o=l.children.length;i<o;i++)t=d(g[l.children[i]],s,l.parents.concat()),r.push(t),g[t].children_d.length&&(r=r.concat(g[t].children_d));for(i=0,o=l.parents.length;i<o;i++)g[l.parents[i]].children_d=g[l.parents[i]].children_d.concat(r)}else{for(i=0,o=n.length;i<o;i++)(t=h(n[i],s,l.parents.concat()))&&(a.push(t),r.push(t),g[t].children_d.length&&(r=r.concat(g[t].children_d)));for(l.children=a,l.children_d=r,i=0,o=l.parents.length;i<o;i++)g[l.parents[i]].children_d=g[l.parents[i]].children_d.concat(r)}return e={cnt:f,mod:g,sel:e,par:s,dpc:r,add:u},"undefined"!=typeof window&&void 0!==window.document?e:void postMessage(e)},a=function(e,t){if(null!==this.element){for(var i in this._cnt=e.cnt,r=this._model.data)r.hasOwnProperty(i)&&r[i].state&&r[i].state.loading&&e.mod[i]&&(e.mod[i].state.loading=!0);if(this._model.data=e.mod,t){var o,n=e.add,s=e.sel,a=this._data.core.selected.slice(),r=this._model.data;if(s.length!==a.length||R.vakata.array_unique(s.concat(a)).length!==s.length){for(i=0,o=s.length;i<o;i++)-1===R.inArray(s[i],n)&&-1===R.inArray(s[i],a)&&(r[s[i]].state.selected=!1);for(i=0,o=a.length;i<o;i++)-1===R.inArray(a[i],s)&&(r[a[i]].state.selected=!0)}}e.add.length&&(this._data.core.selected=this._data.core.selected.concat(e.add)),this.trigger("model",{nodes:e.dpc,parent:e.par}),e.par!==R.jstree.root?(this._node_changed(e.par),this.redraw()):this.redraw(!0),e.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),!t&&d?d(function(){l.call(_,!0)}):l.call(_,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+s.toString()],{type:"text/javascript"}))),!this._data.core.working||i?(this._data.core.working=!0,(o=new window.Worker(this._wrk)).onmessage=function(e){a.call(this,e.data,!0);try{o.terminate(),o=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),n.par?o.postMessage(n):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([e,t,l,!0])}catch(e){a.call(this,s(n),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else a.call(this,s(n),!1)}},_parse_model_from_html:function(e,t,i){i=i?[].concat(i):[],t&&i.unshift(t);var o,n,s,a,r=this._model.data,l={id:!1,text:!1,icon:!0,parent:t,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in this._model.default_state)this._model.default_state.hasOwnProperty(s)&&(l.state[s]=this._model.default_state[s]);if(t=R.vakata.attributes(e,!0),R.each(t,function(e,t){return!(t=R.vakata.trim(t)).length||(l.li_attr[e]=t,void("id"===e&&(l.id=t.toString())))}),(t=e.children("a").first()).length&&(t=R.vakata.attributes(t,!0),R.each(t,function(e,t){(t=R.vakata.trim(t)).length&&(l.a_attr[e]=t)})),(t=(e.children("a").first().length?e.children("a").first():e).clone()).children("ins, i, ul").remove(),t=t.html(),t=R("<div></div>").html(t),l.text=this.settings.core.force_text?t.text():t.html(),t=e.data(),l.data=t?R.extend(!0,{},t):null,l.state.opened=e.hasClass("jstree-open"),l.state.selected=e.children("a").hasClass("jstree-clicked"),l.state.disabled=e.children("a").hasClass("jstree-disabled"),l.data&&l.data.jstree)for(s in l.data.jstree)l.data.jstree.hasOwnProperty(s)&&(l.state[s]=l.data.jstree[s]);for((t=e.children("a").children(".jstree-themeicon")).length&&(l.icon=!t.hasClass("jstree-themeicon-hidden")&&t.attr("rel")),l.state.icon!==E&&(l.icon=l.state.icon),l.icon!==E&&null!==l.icon&&""!==l.icon||(l.icon=!0),t=e.children("ul").children("li");r[a="j"+this._id+"_"+ ++this._cnt];);return l.id=l.li_attr.id?l.li_attr.id.toString():a,t.length?(t.each(function(e,t){o=this._parse_model_from_html(R(t),l.id,i),n=this._model.data[o],l.children.push(o),n.children_d.length&&(l.children_d=l.children_d.concat(n.children_d))}.bind(this)),l.children_d=l.children_d.concat(l.children)):e.hasClass("jstree-closed")&&(l.state.loaded=!1),l.li_attr.class&&(l.li_attr.class=l.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),l.a_attr.class&&(l.a_attr.class=l.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),(r[l.id]=l).state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_flat_json:function(e,t,i){i=i?i.concat():[],t&&i.unshift(t);var o,n,s,a,r=e.id.toString(),l=this._model.data,c=this._model.default_state,d={id:r,text:e.text||"",icon:e.icon===E||e.icon,parent:t,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in c)c.hasOwnProperty(o)&&(d.state[o]=c[o]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==E&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(o in e.data.jstree)e.data.jstree.hasOwnProperty(o)&&(d.state[o]=e.data.jstree[o]);if(e&&"object"==typeof e.state)for(o in e.state)e.state.hasOwnProperty(o)&&(d.state[o]=e.state[o]);if(e&&"object"==typeof e.li_attr)for(o in e.li_attr)e.li_attr.hasOwnProperty(o)&&(d.li_attr[o]=e.li_attr[o]);if(d.li_attr.id||(d.li_attr.id=r),e&&"object"==typeof e.a_attr)for(o in e.a_attr)e.a_attr.hasOwnProperty(o)&&(d.a_attr[o]=e.a_attr[o]);for(e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),o=0,n=(l[d.id]=d).children.length;o<n;o++)a=l[s=this._parse_model_from_flat_json(l[d.children[o]],d.id,i)],d.children_d.push(s),a.children_d.length&&(d.children_d=d.children_d.concat(a.children_d));return delete e.data,delete e.children,l[d.id].original=e,d.state.selected&&this._data.core.selected.push(d.id),d.id},_parse_model_from_json:function(e,t,i){i=i?i.concat():[],t&&i.unshift(t);for(var o,n,s,a,r,l=!1,c=this._model.data,d=this._model.default_state;c[l="j"+this._id+"_"+ ++this._cnt];);for(o in r={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===E||e.icon,parent:t,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},d)d.hasOwnProperty(o)&&(r.state[o]=d[o]);if(e&&e.id&&(r.id=e.id.toString()),e&&e.text&&(r.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(r.icon=e.data.jstree.icon),r.icon!==E&&null!==r.icon&&""!==r.icon||(r.icon=!0),e&&e.data&&(r.data=e.data,e.data.jstree))for(o in e.data.jstree)e.data.jstree.hasOwnProperty(o)&&(r.state[o]=e.data.jstree[o]);if(e&&"object"==typeof e.state)for(o in e.state)e.state.hasOwnProperty(o)&&(r.state[o]=e.state[o]);if(e&&"object"==typeof e.li_attr)for(o in e.li_attr)e.li_attr.hasOwnProperty(o)&&(r.li_attr[o]=e.li_attr[o]);if(r.li_attr.id&&!r.id&&(r.id=r.li_attr.id.toString()),r.id||(r.id=l),r.li_attr.id||(r.li_attr.id=r.id),e&&"object"==typeof e.a_attr)for(o in e.a_attr)e.a_attr.hasOwnProperty(o)&&(r.a_attr[o]=e.a_attr[o]);if(e&&e.children&&e.children.length){for(o=0,n=e.children.length;o<n;o++)a=c[s=this._parse_model_from_json(e.children[o],r.id,i)],r.children.push(s),a.children_d.length&&(r.children_d=r.children_d.concat(a.children_d));r.children_d=r.children.concat(r.children_d)}return e&&e.children&&!0===e.children&&(r.state.loaded=!1,r.children=[],r.children_d=[]),delete e.data,delete e.children,r.original=e,(c[r.id]=r).state.selected&&this._data.core.selected.push(r.id),r.id},_redraw:function(){for(var e,t=(this._model.force_full_redraw?this._model.data[R.jstree.root].children:this._model.changed).concat([]),i=b.createElement("UL"),o=this._data.core.focused,n=0,s=t.length;n<s;n++)(e=this.redraw_node(t[n],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&i.appendChild(e);this._model.force_full_redraw&&(i.className=this.get_container_ul()[0].className,i.setAttribute("role","group"),this.element.empty().append(i)),null!==o&&this.settings.core.restore_focus&&((e=this.get_node(o,!0))&&e.length&&e.children(".jstree-anchor")[0]!==b.activeElement?e.children(".jstree-anchor").trigger("focus"):this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:t})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(e){var t,i=this.get_node(e),o=!1,n=!1,s=b;if(!i)return!1;if(i.id===R.jstree.root)return this.redraw(!0);if(!(e=this.get_node(e,!0))||!e.length)return!1;if(e.children(".jstree-children").remove(),e=e[0],i.children.length&&i.state.loaded){for((n=s.createElement("UL")).setAttribute("role","group"),n.className="jstree-children",o=0,t=i.children.length;o<t;o++)n.appendChild(this.redraw_node(i.children[o],!0,!0));e.appendChild(n)}},redraw_node:function(e,t,i,o){var n=this.get_node(e),s=!1,a=!1,r=!1,l=!1,c=!1,d=!1,h="",u=b,p=this._model.data,m=!1,f=null,g=!1,_=!1;if(!n)return!1;if(n.id===R.jstree.root)return this.redraw(!0);if(t=t||0===n.children.length,e=b.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(R.jstree.idregex,"\\$&"):n.id.replace(R.jstree.idregex,"\\$&"))):b.getElementById(n.id))e=R(e),i||((s=e.parent().parent()[0])===this.element[0]&&(s=null),a=e.index()),(t=t||!n.children.length||e.children(".jstree-children").length?t:!0)||(r=e.children(".jstree-children")[0]),m=e.children(".jstree-anchor")[0]===b.activeElement,e.remove();else if(t=!0,!i){if(!(null===(s=n.parent!==R.jstree.root?R("#"+n.parent.replace(R.jstree.idregex,"\\$&"),this.element)[0]:null)||s&&p[n.parent].state.opened))return!1;a=R.inArray(n.id,(null===s?p[R.jstree.root]:p[n.parent]).children)}for(l in e=this._data.core.node.cloneNode(!0),h="jstree-node ",n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?e.setAttribute(l,n.li_attr[l]):h+=n.li_attr[l]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),e.childNodes[1].setAttribute("aria-selected",!!n.state.selected),e.childNodes[1].setAttribute("aria-level",n.parents.length),this.settings.core.compute_elements_positions&&(e.childNodes[1].setAttribute("aria-setsize",p[n.parent].children.length),e.childNodes[1].setAttribute("aria-posinset",p[n.parent].children.indexOf(n.id)+1)),n.state.disabled&&e.childNodes[1].setAttribute("aria-disabled",!0),l=0,c=n.children.length;l<c;l++)if(!p[n.children[l]].state.hidden){g=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(l=R.inArray(n.id,p[n.parent].children),_=n.id,-1!==l))for(l++,c=p[n.parent].children.length;l<c&&(_=p[p[n.parent].children[l]].state.hidden?_:p[n.parent].children[l])===n.id;l++);for(c in n.state.hidden&&(h+=" jstree-hidden"),n.state.loading&&(h+=" jstree-loading"),n.state.loaded&&!g?h+=" jstree-leaf":(h+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",e.childNodes[1].setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),_===n.id&&(h+=" jstree-last"),e.id=n.id,e.className=h,h=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":""),n.a_attr)if(n.a_attr.hasOwnProperty(c)){if("href"===c&&"#"===n.a_attr[c])continue;"class"!==c?e.childNodes[1].setAttribute(c,n.a_attr[c]):h+=" "+n.a_attr[c]}if(h.length&&(e.childNodes[1].className="jstree-anchor "+h),(n.icon&&!0!==n.icon||!1===n.icon)&&(!1===n.icon?e.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?e.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(e.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',e.childNodes[1].childNodes[0].style.backgroundPosition="center center",e.childNodes[1].childNodes[0].style.backgroundSize="auto",e.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?e.childNodes[1].appendChild(u.createTextNode(n.text)):e.childNodes[1].innerHTML+=n.text,t&&n.children.length&&(n.state.opened||o)&&n.state.loaded){for((d=u.createElement("UL")).setAttribute("role","group"),d.className="jstree-children",l=0,c=n.children.length;l<c;l++)d.appendChild(this.redraw_node(n.children[l],t,!0));e.appendChild(d)}if(r&&e.appendChild(r),!i){for(l=0,c=(s=s||this.element[0]).childNodes.length;l<c;l++)if(s.childNodes[l]&&s.childNodes[l].className&&-1!==s.childNodes[l].className.indexOf("jstree-children")){f=s.childNodes[l];break}f||((f=u.createElement("UL")).setAttribute("role","group"),f.className="jstree-children",s.appendChild(f)),a<(s=f).childNodes.length?s.insertBefore(e,s.childNodes[a]):s.appendChild(e),m&&(o=this.element[0].scrollTop,r=this.element[0].scrollLeft,e.childNodes[1].focus(),this.element[0].scrollTop=o,this.element[0].scrollLeft=r)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(function(){this.open_node(n.id,!1,0)}.bind(this),0)),e},open_node:function(e,i,o){var t,n,s,a;if(R.vakata.is_array(e)){for(t=0,n=(e=e.slice()).length;t<n;t++)this.open_node(e[t],i,o);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(o=o===E?this.settings.core.animation:o,this.is_closed(e)?this.is_loaded(e)?(s=this.get_node(e,!0),a=this,s.length&&(o&&s.children(".jstree-children").length&&s.children(".jstree-children").stop(!0,!0),e.children.length&&!this._firstChild(s.children(".jstree-children")[0])&&this.draw_children(e),o?(this.trigger("before_open",{node:e}),s.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").children(".jstree-anchor").attr("aria-expanded",!0).end().children(".jstree-children").stop(!0,!0).slideDown(o,function(){this.style.display="",a.element&&a.trigger("after_open",{node:e})})):(this.trigger("before_open",{node:e}),s[0].className=s[0].className.replace("jstree-closed","jstree-open"),s[0].childNodes[1].setAttribute("aria-expanded",!0))),e.state.opened=!0,i&&i.call(this,e,!0),s.length||this.trigger("before_open",{node:e}),this.trigger("open_node",{node:e}),o&&s.length||this.trigger("after_open",{node:e}),!0):this.is_loading(e)?setTimeout(function(){this.open_node(e,i,o)}.bind(this),500):void this.load_node(e,function(e,t){return t?this.open_node(e,i,o):!!i&&i.call(this,e,!1)}):(i&&i.call(this,e,!1),!1))},_open_to:function(e){if(!(e=this.get_node(e))||e.id===R.jstree.root)return!1;for(var t=e.parents,i=0,o=t.length;i<o;i+=1)i!==R.jstree.root&&this.open_node(t[i],!1,0);return R("#"+e.id.replace(R.jstree.idregex,"\\$&"),this.element)},close_node:function(e,t){var i,o,n,s;if(R.vakata.is_array(e)){for(i=0,o=(e=e.slice()).length;i<o;i++)this.close_node(e[i],t);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(!this.is_closed(e)&&(t=t===E?this.settings.core.animation:t,s=(n=this).get_node(e,!0),e.state.opened=!1,this.trigger("close_node",{node:e}),void(s.length?t?s.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").children(".jstree-anchor").attr("aria-expanded",!1).end().children(".jstree-children").stop(!0,!0).slideUp(t,function(){this.style.display="",s.children(".jstree-children").remove(),n.element&&n.trigger("after_close",{node:e})}):(s[0].className=s[0].className.replace("jstree-open","jstree-closed"),s.children(".jstree-anchor").attr("aria-expanded",!1),s.children(".jstree-children").remove(),this.trigger("after_close",{node:e})):this.trigger("after_close",{node:e}))))},toggle_node:function(e){var t,i;if(R.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.toggle_node(e[t]);return!0}return this.is_closed(e)?this.open_node(e):this.is_open(e)?this.close_node(e):void 0},open_all:function(e,i,o){if(e=e||R.jstree.root,!(e=this.get_node(e)))return!1;var t,n,s,a=e.id===R.jstree.root?this.get_container_ul():this.get_node(e,!0);if(!a.length){for(t=0,n=e.children_d.length;t<n;t++)this.is_closed(this._model.data[e.children_d[t]])&&(this._model.data[e.children_d[t]].state.opened=!0);return this.trigger("open_all",{node:e})}o=o||a,(a=(s=this).is_closed(e)?a.find(".jstree-closed").addBack():a.find(".jstree-closed")).each(function(){s.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,o)},i||0)}),0===o.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(o)})},close_all:function(e,t){if(e=e||R.jstree.root,!(e=this.get_node(e)))return!1;var i,o,n=e.id===R.jstree.root?this.get_container_ul():this.get_node(e,!0),s=this;for(n.length&&(n=this.is_open(e)?n.find(".jstree-open").addBack():n.find(".jstree-open"),R(n.get().reverse()).each(function(){s.close_node(this,t||0)})),i=0,o=e.children_d.length;i<o;i++)this._model.data[e.children_d[i]].state.opened=!1;this.trigger("close_all",{node:e})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(e){var t,i;if(R.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.enable_node(e[t]);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(e.state.disabled=!1,this.get_node(e,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:e}))},disable_node:function(e){var t,i;if(R.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.disable_node(e[t]);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(e.state.disabled=!0,this.get_node(e,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:e}))},is_hidden:function(e){return!0===(e=this.get_node(e)).state.hidden},hide_node:function(e,t){var i,o;if(R.vakata.is_array(e)){for(i=0,o=(e=e.slice()).length;i<o;i++)this.hide_node(e[i],!0);return t||this.redraw(),!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&void(e.state.hidden||(e.state.hidden=!0,this._node_changed(e.parent),t||this.redraw(),this.trigger("hide_node",{node:e})))},show_node:function(e,t){var i,o;if(R.vakata.is_array(e)){for(i=0,o=(e=e.slice()).length;i<o;i++)this.show_node(e[i],!0);return t||this.redraw(),!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&void(e.state.hidden&&(e.state.hidden=!1,this._node_changed(e.parent),t||this.redraw(),this.trigger("show_node",{node:e})))},hide_all:function(e){var t,i=this._model.data,o=[];for(t in i)i.hasOwnProperty(t)&&t!==R.jstree.root&&!i[t].state.hidden&&(i[t].state.hidden=!0,o.push(t));return this._model.force_full_redraw=!0,e||this.redraw(),this.trigger("hide_all",{nodes:o}),o},show_all:function(e){var t,i=this._model.data,o=[];for(t in i)i.hasOwnProperty(t)&&t!==R.jstree.root&&i[t].state.hidden&&(i[t].state.hidden=!1,o.push(t));return this._model.force_full_redraw=!0,e||this.redraw(),this.trigger("show_all",{nodes:o}),o},activate_node:function(e,t){if(this.is_disabled(e))return!1;if(t&&"object"==typeof t||(t={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==E?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(t.metaKey||t.ctrlKey||t.shiftKey)&&(!t.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(t.shiftKey){for(var i=this.get_node(e).id,o=this._data.core.last_clicked.id,n=this.get_node(this._data.core.last_clicked.parent).children,s=!1,a=0,r=n.length;a<r;a+=1)n[a]===i&&(s=!s),n[a]===o&&(s=!s),this.is_disabled(n[a])||!s&&n[a]!==i&&n[a]!==o?this.deselect_node(n[a],!0,t):this.is_hidden(n[a])||this.select_node(n[a],!0,!1,t);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:t})}else this.is_selected(e)?this.deselect_node(e,!1,t):this.select_node(e,!1,!1,t);else!this.settings.core.multiple&&(t.metaKey||t.ctrlKey||t.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,t):(this.deselect_all(!0),this.select_node(e,!1,!1,t),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:t})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(e,t,i,o){var n,s,a;if(R.vakata.is_array(e)){for(s=0,a=(e=e.slice()).length;s<a;s++)this.select_node(e[s],t,i,o);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(n=this.get_node(e,!0),void(e.state.selected||(e.state.selected=!0,this._data.core.selected.push(e.id),(n=i?n:this._open_to(e))&&n.length&&n.children(".jstree-anchor").addClass("jstree-clicked").attr("aria-selected",!0),this.trigger("select_node",{node:e,selected:this._data.core.selected,event:o}),t||this.trigger("changed",{action:"select_node",node:e,selected:this._data.core.selected,event:o}))))},deselect_node:function(e,t,i){var o,n,s;if(R.vakata.is_array(e)){for(o=0,n=(e=e.slice()).length;o<n;o++)this.deselect_node(e[o],t,i);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(s=this.get_node(e,!0),void(e.state.selected&&(e.state.selected=!1,this._data.core.selected=R.vakata.array_remove_item(this._data.core.selected,e.id),s.length&&s.children(".jstree-anchor").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_node",{node:e,selected:this._data.core.selected,event:i}),t||this.trigger("changed",{action:"deselect_node",node:e,selected:this._data.core.selected,event:i}))))},select_all:function(e){var t,i,o=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[R.jstree.root].children_d.concat(),t=0,i=this._data.core.selected.length;t<i;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),e||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:o})},deselect_all:function(e){for(var t=this._data.core.selected.concat([]),i=0,o=this._data.core.selected.length;i<o;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:t}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:t})},is_selected:function(e){return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&e.state.selected},get_selected:function(e){return e?R.map(this._data.core.selected,function(e){return this.get_node(e)}.bind(this)):this._data.core.selected.slice()},get_top_selected:function(e){for(var t,i,o=this.get_selected(!0),n={},s=0,a=o.length;s<a;s++)n[o[s].id]=o[s];for(s=0,a=o.length;s<a;s++)for(t=0,i=o[s].children_d.length;t<i;t++)n[o[s].children_d[t]]&&delete n[o[s].children_d[t]];for(s in o=[],n)n.hasOwnProperty(s)&&o.push(s);return e?R.map(o,function(e){return this.get_node(e)}.bind(this)):o},get_bottom_selected:function(e){for(var t=this.get_selected(!0),i=[],o=0,n=t.length;o<n;o++)t[o].children.length||i.push(t[o].id);return e?R.map(i,function(e){return this.get_node(e)}.bind(this)):i},get_state:function(){var e,t={core:{open:[],loaded:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(e in this._model.data)this._model.data.hasOwnProperty(e)&&e!==R.jstree.root&&(this._model.data[e].state.loaded&&this.settings.core.loaded_state&&t.core.loaded.push(e),this._model.data[e].state.opened&&t.core.open.push(e),this._model.data[e].state.selected&&t.core.selected.push(e));return t},set_state:function(t,i){if(t){if(t.core&&t.core.selected&&t.core.initial_selection===E&&(t.core.initial_selection=this._data.core.selected.concat([]).sort().join(",")),t.core){var o,e;if(t.core.loaded)return this.settings.core.loaded_state&&R.vakata.is_array(t.core.loaded)&&t.core.loaded.length?this._load_nodes(t.core.loaded,function(e){delete t.core.loaded,this.set_state(t,i)}):(delete t.core.loaded,this.set_state(t,i)),!1;if(t.core.open)return R.vakata.is_array(t.core.open)&&t.core.open.length?this._load_nodes(t.core.open,function(e){this.open_node(e,!1,0),delete t.core.open,this.set_state(t,i)}):(delete t.core.open,this.set_state(t,i)),!1;if(t.core.scroll)return t.core.scroll&&t.core.scroll.left!==E&&this.element.scrollLeft(t.core.scroll.left),t.core.scroll&&t.core.scroll.top!==E&&this.element.scrollTop(t.core.scroll.top),delete t.core.scroll,this.set_state(t,i),!1;if(t.core.selected)return o=this,t.core.initial_selection!==E&&t.core.initial_selection!==this._data.core.selected.concat([]).sort().join(",")||(this.deselect_all(),R.each(t.core.selected,function(e,t){o.select_node(t,!1,!0)})),delete t.core.initial_selection,delete t.core.selected,this.set_state(t,i),!1;for(e in t)t.hasOwnProperty(e)&&"core"!==e&&-1===R.inArray(e,this.settings.plugins)&&delete t[e];if(R.isEmptyObject(t.core))return delete t.core,this.set_state(t,i),!1}return!R.isEmptyObject(t)||(t=null,i&&i.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(e,t){this._data.core.state=!0===t?{}:this.get_state(),t&&R.vakata.is_function(t)&&(this._data.core.state=t.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[R.jstree.root]={id:R.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var i=this.get_container_ul()[0].className;e||(this.element.html("<ul class='"+i+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(R.jstree.root,function(e,t){t&&(this.get_container_ul()[0].className=i,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(R.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===R.jstree.root)return!1;var i=[],e=[],o=this._data.core.selected.concat([]);e.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){e.push(this.id),i.push(this.id)}),this._load_nodes(e,function(e){this.open_node(i,!1,0),this.select_node(o),this.trigger("refresh_node",{node:t,nodes:e})}.bind(this),!1,!0)},set_id:function(e,t){if(!(e=this.get_node(e))||e.id===R.jstree.root)return!1;var i,o,n=this._model.data,s=e.id;for(t=t.toString(),n[e.parent].children[R.inArray(e.id,n[e.parent].children)]=t,i=0,o=e.parents.length;i<o;i++)n[e.parents[i]].children_d[R.inArray(e.id,n[e.parents[i]].children_d)]=t;for(i=0,o=e.children.length;i<o;i++)n[e.children[i]].parent=t;for(i=0,o=e.children_d.length;i<o;i++)n[e.children_d[i]].parents[R.inArray(e.id,n[e.children_d[i]].parents)]=t;return-1!==(i=R.inArray(e.id,this._data.core.selected))&&(this._data.core.selected[i]=t),(i=this.get_node(e.id,!0))&&(i.attr("id",t),this.element.attr("aria-activedescendant")===e.id&&this.element.attr("aria-activedescendant",t)),delete n[e.id],e.id=t,n[e.li_attr.id=t]=e,this.trigger("set_id",{node:e,new:e.id,old:s}),!0},get_text:function(e){return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&e.text},set_text:function(e,t){var i,o;if(R.vakata.is_array(e)){for(i=0,o=(e=e.slice()).length;i<o;i++)this.set_text(e[i],t);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(e.text=t,this.get_node(e,!0).length&&this.redraw_node(e.id),this.trigger("set_text",{obj:e,text:t}),!0)},get_json:function(e,t,i){if(!(e=this.get_node(e||R.jstree.root)))return!1;t&&t.flat&&!i&&(i=[]);var o,n,s={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:R.extend(!0,{},e.li_attr),a_attr:R.extend(!0,{},e.a_attr),state:{},data:(!t||!t.no_data)&&R.extend(!0,R.vakata.is_array(e.data)?[]:{},e.data)};if(t&&t.flat?s.parent=e.parent:s.children=[],t&&t.no_state)delete s.state;else for(o in e.state)e.state.hasOwnProperty(o)&&(s.state[o]=e.state[o]);if(t&&t.no_li_attr&&delete s.li_attr,t&&t.no_a_attr&&delete s.a_attr,t&&t.no_id&&(delete s.id,s.li_attr&&s.li_attr.id&&delete s.li_attr.id,s.a_attr&&s.a_attr.id&&delete s.a_attr.id),t&&t.flat&&e.id!==R.jstree.root&&i.push(s),!t||!t.no_children)for(o=0,n=e.children.length;o<n;o++)t&&t.flat?this.get_json(e.children[o],t,i):s.children.push(this.get_json(e.children[o],t));return t&&t.flat?i:e.id===R.jstree.root?s.children:s},create_node:function(e,t,i,o,n){if(null===e&&(e=R.jstree.root),!(e=this.get_node(e)))return!1;if(!(i=i===E?"last":i).toString().match(/^(before|after)$/)&&!n&&!this.is_loaded(e))return this.load_node(e,function(){this.create_node(e,t,i,o,!0)});var s,a,r,l;switch((t="string"==typeof(t=t||{text:this.get_string("New node")})?{text:t}:R.extend(!0,{},t)).text===E&&(t.text=this.get_string("New node")),e.id===R.jstree.root&&("after"===(i="before"===i?"first":i)&&(i="last")),i){case"before":s=this.get_node(e.parent),i=R.inArray(e.id,s.children),e=s;break;case"after":s=this.get_node(e.parent),i=R.inArray(e.id,s.children)+1,e=s;break;case"inside":case"first":i=0;break;case"last":i=e.children.length;break;default:i=i||0}if(i>e.children.length&&(i=e.children.length),t.id||(t.id=!0),!this.check("create_node",t,e,i))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===t.id&&delete t.id,!(t=this._parse_model_from_json(t,e.id,e.parents.concat())))return!1;for(s=this.get_node(t),(a=[]).push(t),a=a.concat(s.children_d),this.trigger("model",{nodes:a,parent:e.id}),e.children_d=e.children_d.concat(a),r=0,l=e.parents.length;r<l;r++)this._model.data[e.parents[r]].children_d=this._model.data[e.parents[r]].children_d.concat(a);for(t=s,s=[],r=0,l=e.children.length;r<l;r++)s[i<=r?r+1:r]=e.children[r];return s[i]=t.id,e.children=s,this.redraw_node(e,!0),this.trigger("create_node",{node:this.get_node(t),parent:e.id,position:i}),o&&o.call(this,this.get_node(t)),t.id},rename_node:function(e,t){var i,o,n;if(R.vakata.is_array(e)){for(i=0,o=(e=e.slice()).length;i<o;i++)this.rename_node(e[i],t);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(n=e.text,this.check("rename_node",e,this.get_parent(e),t)?(this.set_text(e,t),this.trigger("rename_node",{node:e,text:t,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(e){var t,i,o,n,s,a,r,l,c,d,h;if(R.vakata.is_array(e))for(t=0,i=(e=e.slice()).length;t<i;t++)this.delete_node(e[t]);else{if(!(e=this.get_node(e))||e.id===R.jstree.root)return!1;if(o=this.get_node(e.parent),d=R.inArray(e.id,o.children),c=!1,!this.check("delete_node",e,o,d))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==d&&(o.children=R.vakata.array_remove(o.children,d)),(n=e.children_d.concat([])).push(e.id),s=0,a=e.parents.length;s<a;s++)this._model.data[e.parents[s]].children_d=R.vakata.array_filter(this._model.data[e.parents[s]].children_d,function(e){return-1===R.inArray(e,n)});for(r=0,l=n.length;r<l;r++)if(this._model.data[n[r]].state.selected){c=!0;break}for(c&&(this._data.core.selected=R.vakata.array_filter(this._data.core.selected,function(e){return-1===R.inArray(e,n)})),this.trigger("delete_node",{node:e,parent:o.id}),c&&this.trigger("changed",{action:"delete_node",node:e,selected:this._data.core.selected,parent:o.id}),r=0,l=n.length;r<l;r++)delete this._model.data[n[r]];-1!==R.inArray(this._data.core.focused,n)&&(this._data.core.focused=null,d=this.element[0].scrollTop,h=this.element[0].scrollLeft,o.id===R.jstree.root?this._model.data[R.jstree.root].children[0]&&this.get_node(this._model.data[R.jstree.root].children[0],!0).children(".jstree-anchor").triger("focus"):this.get_node(o,!0).children(".jstree-anchor").trigger("focus"),this.element[0].scrollTop=d,this.element[0].scrollLeft=h),this.redraw_node(o,!0)}return!0},check:function(e,t,i,o,n){t=t&&t.id?t:this.get_node(t),i=i&&i.id?i:this.get_node(i);var s=e.match(/^move_node|copy_node|create_node$/i)?i:t,a=this.settings.core.check_callback;if("move_node"===e||"copy_node"===e){if(!(n&&n.is_multi||"move_node"!==e||R.inArray(t.id,i.children)!==o))return!(this._data.core.last_error={error:"check",plugin:"core",id:"core_08",reason:"Moving node to its current position",data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})});if(!(n&&n.is_multi||t.id!==i.id&&("move_node"!==e||R.inArray(t.id,i.children)!==o)&&-1===R.inArray(i.id,t.children_d)))return!(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})})}return(s=s&&s.data?s.data:s)&&s.functions&&(!1===s.functions[e]||!0===s.functions[e])?(!1===s.functions[e]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+e,data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),s.functions[e]):!(!1===a||R.vakata.is_function(a)&&!1===a.call(this,e,t,i,o,n)||a&&!1===a[e])||!(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+e,data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})})},last_error:function(){return this._data.core.last_error},move_node:function(e,t,i,o,n,s,a){var r,l,c,d,h,u,p,m,f,g,_,b,y,v;if(t=this.get_node(t),i=i===E?0:i,!t)return!1;if(!i.toString().match(/^(before|after)$/)&&!n&&!this.is_loaded(t))return this.load_node(t,function(){this.move_node(e,t,i,o,!0,!1,a)});if(R.vakata.is_array(e)){if(1!==e.length){for(r=0,l=e.length;r<l;r++)(f=this.move_node(e[r],t,i,o,n,!1,a))&&(t=f,i="after");return this.redraw(),!0}e=e[0]}if(!(e=e&&e.id?e:this.get_node(e))||e.id===R.jstree.root)return!1;if(c=(e.parent||R.jstree.root).toString(),h=i.toString().match(/^(before|after)$/)&&t.id!==R.jstree.root?this.get_node(t.parent):t,p=!(u=a||(this._model.data[e.id]?this:R.jstree.reference(e.id)))||!u._id||this._id!==u._id,d=u&&u._id&&c&&u._model.data[c]&&u._model.data[c].children?R.inArray(e.id,u._model.data[c].children):-1,u&&u._id&&(e=u._model.data[e.id]),p)return!!(f=this.copy_node(e,t,i,o,n,!1,a))&&(u&&u.delete_node(e),f);switch(t.id===R.jstree.root&&("after"===(i="before"===i?"first":i)&&(i="last")),i){case"before":i=R.inArray(t.id,h.children);break;case"after":i=R.inArray(t.id,h.children)+1;break;case"inside":case"first":i=0;break;case"last":i=h.children.length;break;default:i=i||0}if(i>h.children.length&&(i=h.children.length),!this.check("move_node",e,h,i,{core:!0,origin:a,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(e.parent===h.id){for(m=h.children.concat(),-1!==(f=R.inArray(e.id,m))&&(m=R.vakata.array_remove(m,f),f<i&&i--),f=[],g=0,_=m.length;g<_;g++)f[i<=g?g+1:g]=m[g];f[i]=e.id,h.children=f,this._node_changed(h.id),this.redraw(h.id===R.jstree.root)}else{for((f=e.children_d.concat()).push(e.id),g=0,_=e.parents.length;g<_;g++){for(m=[],b=0,y=(v=u._model.data[e.parents[g]].children_d).length;b<y;b++)-1===R.inArray(v[b],f)&&m.push(v[b]);u._model.data[e.parents[g]].children_d=m}for(u._model.data[c].children=R.vakata.array_remove_item(u._model.data[c].children,e.id),g=0,_=h.parents.length;g<_;g++)this._model.data[h.parents[g]].children_d=this._model.data[h.parents[g]].children_d.concat(f);for(m=[],g=0,_=h.children.length;g<_;g++)m[i<=g?g+1:g]=h.children[g];for(m[i]=e.id,h.children=m,h.children_d.push(e.id),h.children_d=h.children_d.concat(e.children_d),e.parent=h.id,(f=h.parents.concat()).unshift(h.id),v=e.parents.length,f=(e.parents=f).concat(),g=0,_=e.children_d.length;g<_;g++)this._model.data[e.children_d[g]].parents=this._model.data[e.children_d[g]].parents.slice(0,-1*v),Array.prototype.push.apply(this._model.data[e.children_d[g]].parents,f);c!==R.jstree.root&&h.id!==R.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(c),this._node_changed(h.id)),s||this.redraw()}return o&&o.call(this,e,h,i),this.trigger("move_node",{node:e,parent:h.id,position:i,old_parent:c,old_position:d,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id,old_instance:u,new_instance:this}),e.id},copy_node:function(e,t,i,o,n,s,a){var r,l,c,d,h,u,p,m,f,g;if(t=this.get_node(t),i=i===E?0:i,!t)return!1;if(!i.toString().match(/^(before|after)$/)&&!n&&!this.is_loaded(t))return this.load_node(t,function(){this.copy_node(e,t,i,o,!0,!1,a)});if(R.vakata.is_array(e)){if(1!==e.length){for(r=0,l=e.length;r<l;r++)(d=this.copy_node(e[r],t,i,o,n,!0,a))&&(t=d,i="after");return this.redraw(),!0}e=e[0]}if(!(e=e&&e.id?e:this.get_node(e))||e.id===R.jstree.root)return!1;switch(m=(e.parent||R.jstree.root).toString(),f=i.toString().match(/^(before|after)$/)&&t.id!==R.jstree.root?this.get_node(t.parent):t,(g=a||(this._model.data[e.id]?this:R.jstree.reference(e.id)))&&g._id&&(this._id,g._id),g&&g._id&&(e=g._model.data[e.id]),t.id===R.jstree.root&&("after"===(i="before"===i?"first":i)&&(i="last")),i){case"before":i=R.inArray(t.id,f.children);break;case"after":i=R.inArray(t.id,f.children)+1;break;case"inside":case"first":i=0;break;case"last":i=f.children.length;break;default:i=i||0}if(i>f.children.length&&(i=f.children.length),!this.check("copy_node",e,f,i,{core:!0,origin:a,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(p=g?g.get_json(e,{no_id:!0,no_data:!0,no_state:!0}):e))return!1;if(!0===p.id&&delete p.id,!(p=this._parse_model_from_json(p,f.id,f.parents.concat())))return!1;for(d=this.get_node(p),e&&e.state&&!1===e.state.loaded&&(d.state.loaded=!1),(c=[]).push(p),c=c.concat(d.children_d),this.trigger("model",{nodes:c,parent:f.id}),h=0,u=f.parents.length;h<u;h++)this._model.data[f.parents[h]].children_d=this._model.data[f.parents[h]].children_d.concat(c);for(c=[],h=0,u=f.children.length;h<u;h++)c[i<=h?h+1:h]=f.children[h];return c[i]=d.id,f.children=c,f.children_d.push(d.id),f.children_d=f.children_d.concat(d.children_d),f.id===R.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(f.id),s||this.redraw(f.id===R.jstree.root),o&&o.call(this,d,f,i),this.trigger("copy_node",{node:d,original:e,parent:f.id,position:i,old_parent:m,old_position:g&&g._id&&m&&g._model.data[m]&&g._model.data[m].children?R.inArray(e.id,g._model.data[m].children):-1,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),d.id},cut:function(e){if(e=e||this._data.core.selected.concat(),!(e=R.vakata.is_array(e)?e:[e]).length)return!1;for(var t,i=[],o=0,n=e.length;o<n;o++)(t=this.get_node(e[o]))&&t.id&&t.id!==R.jstree.root&&i.push(t);return!!i.length&&(r=i,l="move_node",void(c=this).trigger("cut",{node:e}))},copy:function(e){if(e=e||this._data.core.selected.concat(),!(e=R.vakata.is_array(e)?e:[e]).length)return!1;for(var t,i=[],o=0,n=e.length;o<n;o++)(t=this.get_node(e[o]))&&t.id&&t.id!==R.jstree.root&&i.push(t);return!!i.length&&(r=i,l="copy_node",void(c=this).trigger("copy",{node:e}))},get_buffer:function(){return{mode:l,node:r,inst:c}},can_paste:function(){return!1!==l&&!1!==r},paste:function(e,t){return!!((e=this.get_node(e))&&l&&l.match(/^(copy_node|move_node)$/)&&r)&&(this[l](r,e,t,!1,!1,!1,c)&&this.trigger("paste",{parent:e.id,node:r,mode:l}),void(c=l=r=!1))},clear_buffer:function(){c=l=r=!1,this.trigger("clear_buffer")},edit:function(i,e,o){var t,n,s,a,r,l,c,d,h=!1;return!!(i=this.get_node(i))&&(this.check("edit",i,this.get_parent(i))?(d=i,e="string"==typeof e?e:i.text,this.set_text(i,""),i=this._open_to(i),d.text=e,t=this._data.core.rtl,n=this.element.width(),this._data.core.focused=d.id,s=i.children(".jstree-anchor").trigger("focus"),a=R("<span></span>"),r=e,l=R("<div></div>",{css:{position:"absolute",top:"-200px",left:t?"0px":"-1000px",visibility:"hidden"}}).appendTo(b.body),c=R("<input />",{value:r,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:function(e){e.stopImmediatePropagation(),e.preventDefault();var e=a.children(".jstree-rename-input").val(),t=this.settings.core.force_text;""===e&&(e=r),l.remove(),a.replaceWith(s),a.remove(),r=t?r:R("<div></div>").append(R.parseHTML(r)).html(),i=this.get_node(i),this.set_text(i,r),(t=!!this.rename_node(i,t?R("<div></div>").text(e).text():R("<div></div>").append(R.parseHTML(e)).html()))||this.set_text(i,r),this._data.core.focused=d.id,setTimeout(function(){var e=this.get_node(d.id,!0);e.length&&(this._data.core.focused=d.id,e.children(".jstree-anchor").trigger("focus"))}.bind(this),0),o&&o.call(this,d,t,h,e),c=null}.bind(this),keydown:function(e){var t=e.which;27===t&&(h=!0,this.value=r),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){c.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){return 13!==e.which&&void 0}}),e={fontFamily:s.css("fontFamily")||"",fontSize:s.css("fontSize")||"",fontWeight:s.css("fontWeight")||"",fontStyle:s.css("fontStyle")||"",fontStretch:s.css("fontStretch")||"",fontVariant:s.css("fontVariant")||"",letterSpacing:s.css("letterSpacing")||"",wordSpacing:s.css("wordSpacing")||""},a.attr("class",s.attr("class")).append(s.contents().clone()).append(c),s.replaceWith(a),l.css(e),c.css(e).width(Math.min(l.text("pW"+c[0].value).width(),n))[0].select(),void R(b).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(e){c&&e.target!==c&&R(c).trigger("blur")})):(this.settings.core.error.call(this,this._data.core.last_error),!1))},set_theme:function(e,t){if(!e)return!1;(t=!0===t?(this.settings.core.themes.dir||R.jstree.path+"/themes")+"/"+e+"/style.css":t)&&-1===R.inArray(t,i)&&(R("head").append('<link rel="stylesheet" href="'+t+'" type="text/css" />'),i.push(t)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=e,this.element.addClass("jstree-"+e),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+e+"-responsive"),this.trigger("set_theme",{theme:e})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),(this._data.core.themes.variant=e)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped"),this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped"),this.trigger("hide_stripes")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots"),this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots"),this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons"),this.trigger("show_icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons"),this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0,this.get_container_ul().addClass("jstree-ellipsis"),this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=!1,this.get_container_ul().removeClass("jstree-ellipsis"),this.trigger("hide_ellipsis")},toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(e,t){var i,o,n,s;if(R.vakata.is_array(e)){for(i=0,o=(e=e.slice()).length;i<o;i++)this.set_icon(e[i],t);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(s=e.icon,e.icon=!0===t||null===t||t===E||""===t||t,n=this.get_node(e,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===t?(n.removeClass("jstree-themeicon-custom "+s).css("background","").removeAttr("rel"),this.hide_icon(e)):(!0===t||null===t||t===E||""===t?n.removeClass("jstree-themeicon-custom "+s).css("background","").removeAttr("rel"):-1===t.indexOf("/")&&-1===t.indexOf(".")?(n.removeClass(s).css("background",""),n.addClass(t+" jstree-themeicon-custom").attr("rel",t)):(n.removeClass(s).css("background",""),n.addClass("jstree-themeicon-custom").css("background","url('"+t+"') center center no-repeat").attr("rel",t)),!1===s&&this.show_icon(e)),!0)},get_icon:function(e){return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&e.icon},hide_icon:function(e){var t,i;if(R.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.hide_icon(e[t]);return!0}return!(!(e=this.get_node(e))||e===R.jstree.root)&&(e.icon=!1,this.get_node(e,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(e){var t,i,o;if(R.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.show_icon(e[t]);return!0}return!(!(e=this.get_node(e))||e===R.jstree.root)&&(o=this.get_node(e,!0),e.icon=!o.length||o.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),e.icon||(e.icon=!0),o.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},R.vakata={},R.vakata.attributes=function(e,i){e=R(e)[0];var o=i?{}:[];return e&&e.attributes&&R.each(e.attributes,function(e,t){-1===R.inArray(t.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==t.value&&""!==R.vakata.trim(t.value)&&(i?o[t.name]=t.value:o.push(t.name))}),o},R.vakata.array_unique=function(e){for(var t=[],i={},o=0,n=e.length;o<n;o++)i[e[o]]===E&&(t.push(e[o]),i[e[o]]=!0);return t},R.vakata.array_remove=function(e,t){return e.splice(t,1),e},R.vakata.array_remove_item=function(e,t){t=R.inArray(t,e);return-1!==t?R.vakata.array_remove(e,t):e},R.vakata.array_filter=function(e,t,i,o,n){if(e.filter)return e.filter(t,i);for(n in o=[],e)~~n+""==n+""&&0<=n&&t.call(i,e[n],+n,e)&&o.push(e[n]);return o},R.vakata.trim=function(e){return String.prototype.trim?String.prototype.trim.call(e.toString()):e.toString().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},R.vakata.is_function=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},R.vakata.is_array=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Function.prototype.bind||(Function.prototype.bind=function(){var t=this,i=arguments[0],o=Array.prototype.slice.call(arguments,1);if("function"!=typeof t)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return function(){var e=o.concat(Array.prototype.slice.call(arguments));return t.apply(i,e)}}),R.jstree.plugins.changed=function(e,s){var a=[];this.trigger=function(e,t){if(t=t||{},"changed"===e.replace(".jstree","")){t.changed={selected:[],deselected:[]};for(var i={},o=0,n=a.length;o<n;o++)i[a[o]]=1;for(o=0,n=t.selected.length;o<n;o++)i[t.selected[o]]?i[t.selected[o]]=2:t.changed.selected.push(t.selected[o]);for(o=0,n=a.length;o<n;o++)1===i[a[o]]&&t.changed.deselected.push(a[o]);a=t.selected.slice()}s.trigger.call(this,e,t)},this.refresh=function(e,t){return a=[],s.refresh.apply(this,arguments)}},b.createElement("I")),u=(h.className="jstree-icon jstree-checkbox",h.setAttribute("role","presentation"),R.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0},R.jstree.plugins.checkbox=function(e,l){this.bind=function(){l.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")}.bind(this)).on("loading.jstree",function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)}.bind(this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",function(e,t){for(var i=this._model.data,o=(i[t.parent],t.nodes),n=0,s=o.length;n<s;n++)i[o[n]].state.checked=i[o[n]].state.checked||i[o[n]].original&&i[o[n]].original.state&&i[o[n]].original.state.checked,i[o[n]].state.checked&&this._data.checkbox.selected.push(o[n])}.bind(this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",function(e,t){var i,o,n,s,a,r,l=this._model.data,c=l[t.parent],d=t.nodes,h=[],t=this.settings.checkbox.cascade,u=this.settings.checkbox.tie_selection;if(-1!==t.indexOf("down"))if(c.state[u?"selected":"checked"]){for(o=0,n=d.length;o<n;o++)l[d[o]].state[u?"selected":"checked"]=!0;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(d)}else for(o=0,n=d.length;o<n;o++)if(l[d[o]].state[u?"selected":"checked"]){for(s=0,a=l[d[o]].children_d.length;s<a;s++)l[l[d[o]].children_d[s]].state[u?"selected":"checked"]=!0;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(l[d[o]].children_d)}if(-1!==t.indexOf("up")){for(o=0,n=c.children_d.length;o<n;o++)l[c.children_d[o]].children.length||h.push(l[c.children_d[o]].parent);for(s=0,a=(h=R.vakata.array_unique(h)).length;s<a;s++)for(c=l[h[s]];c&&c.id!==R.jstree.root;){for(o=i=0,n=c.children.length;o<n;o++)i+=l[c.children[o]].state[u?"selected":"checked"];if(i!==n)break;c.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(c.id),(r=this.get_node(c,!0))&&r.length&&r.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[u?"core":"checkbox"].selected=R.vakata.array_unique(this._data[u?"core":"checkbox"].selected)}.bind(this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",function(e,t){var i,o,t=t.node,n=this._model.data,s=this.get_node(t.parent),a=this.settings.checkbox.cascade,r=this.settings.checkbox.tie_selection,l={},c=this._data[r?"core":"checkbox"].selected;for(u=0,p=c.length;u<p;u++)l[c[u]]=!0;if(-1!==a.indexOf("down"))for(var d=this._cascade_new_checked_state(t.id,!0),h=t.children_d.concat(t.id),u=0,p=h.length;u<p;u++)-1<d.indexOf(h[u])?l[h[u]]=!0:delete l[h[u]];if(-1!==a.indexOf("up"))for(;s&&s.id!==R.jstree.root;){for(u=i=0,p=s.children.length;u<p;u++)i+=n[s.children[u]].state[r?"selected":"checked"];if(i!==p)break;s.state[r?"selected":"checked"]=!0,l[s.id]=!0,(o=this.get_node(s,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(r?"jstree-clicked":"jstree-checked"),s=this.get_node(s.parent)}for(u in c=[],l)l.hasOwnProperty(u)&&c.push(u);this._data[r?"core":"checkbox"].selected=c}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",function(e,t){for(var i,o=this.get_node(R.jstree.root),n=this._model.data,s=0,a=o.children_d.length;s<a;s++)(i=n[o.children_d[s]])&&i.original&&i.original.state&&i.original.state.undetermined&&(i.original.state.undetermined=!1)}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",function(e,t){var i,o,n,s,a=t.node,t=(this.get_node(a,!0),this.settings.checkbox.cascade),r=this.settings.checkbox.tie_selection,l=this._data[r?"core":"checkbox"].selected,c=a.children_d.concat(a.id);if(-1!==t.indexOf("down")&&(s=this._cascade_new_checked_state(a.id,!1),l=R.vakata.array_filter(l,function(e){return-1===c.indexOf(e)||-1<s.indexOf(e)})),-1!==t.indexOf("up")&&-1===l.indexOf(a.id)){for(i=0,o=a.parents.length;i<o;i++)(n=this._model.data[a.parents[i]]).state[r?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),(n=this.get_node(a.parents[i],!0))&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(r?"jstree-clicked":"jstree-checked");l=R.vakata.array_filter(l,function(e){return-1===a.parents.indexOf(e)})}this._data[r?"core":"checkbox"].selected=l}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",function(e,t){for(var i,o,n,s,a=this.get_node(t.parent),r=this._model.data,l=this.settings.checkbox.tie_selection;a&&a.id!==R.jstree.root&&!a.state[l?"selected":"checked"];){for(i=n=0,o=a.children.length;i<o;i++)n+=r[a.children[i]].state[l?"selected":"checked"];if(!(0<o&&n===o))break;a.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(a.id),(s=this.get_node(a,!0))&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),a=this.get_node(a.parent)}}.bind(this)).on("move_node.jstree",function(e,t){var i,o,n,s,a,r=t.is_multi,l=t.old_parent,t=this.get_node(t.parent),c=this._model.data,d=this.settings.checkbox.tie_selection;if(!r)for(i=this.get_node(l);i&&i.id!==R.jstree.root&&!i.state[d?"selected":"checked"];){for(n=o=0,s=i.children.length;n<s;n++)o+=c[i.children[n]].state[d?"selected":"checked"];if(!(0<s&&o===s))break;i.state[d?"selected":"checked"]=!0,this._data[d?"core":"checkbox"].selected.push(i.id),(a=this.get_node(i,!0))&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(d?"jstree-clicked":"jstree-checked"),i=this.get_node(i.parent)}for(i=t;i&&i.id!==R.jstree.root;){for(n=o=0,s=i.children.length;n<s;n++)o+=c[i.children[n]].state[d?"selected":"checked"];if(o===s)i.state[d?"selected":"checked"]||(i.state[d?"selected":"checked"]=!0,this._data[d?"core":"checkbox"].selected.push(i.id),(a=this.get_node(i,!0))&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(d?"jstree-clicked":"jstree-checked"));else{if(!i.state[d?"selected":"checked"])break;i.state[d?"selected":"checked"]=!1,this._data[d?"core":"checkbox"].selected=R.vakata.array_remove_item(this._data[d?"core":"checkbox"].selected,i.id),(a=this.get_node(i,!0))&&a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked")}i=this.get_node(i.parent)}}.bind(this))},this.get_undetermined=function(e){if(-1===this.settings.checkbox.cascade.indexOf("undetermined"))return[];for(var i,o,n={},s=this._model.data,t=this.settings.checkbox.tie_selection,a=this._data[t?"core":"checkbox"].selected,r=[],l=this,c=[],d=0,h=a.length;d<h;d++)if(s[a[d]]&&s[a[d]].parents)for(i=0,o=s[a[d]].parents.length;i<o&&n[s[a[d]].parents[i]]===E;i++)s[a[d]].parents[i]!==R.jstree.root&&(n[s[a[d]].parents[i]]=!0,r.push(s[a[d]].parents[i]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e,t=l.get_node(this);if(t)if(t.state.loaded){for(d=0,h=t.children_d.length;d<h;d++)if(!(e=s[t.children_d[d]]).state.loaded&&e.original&&e.original.state&&e.original.state.undetermined&&!0===e.original.state.undetermined)for(n[e.id]===E&&e.id!==R.jstree.root&&(n[e.id]=!0,r.push(e.id)),i=0,o=e.parents.length;i<o;i++)n[e.parents[i]]===E&&e.parents[i]!==R.jstree.root&&(n[e.parents[i]]=!0,r.push(e.parents[i]))}else if(t.original&&t.original.state&&t.original.state.undetermined&&!0===t.original.state.undetermined)for(n[t.id]===E&&t.id!==R.jstree.root&&(n[t.id]=!0,r.push(t.id)),i=0,o=t.parents.length;i<o;i++)n[t.parents[i]]===E&&t.parents[i]!==R.jstree.root&&(n[t.parents[i]]=!0,r.push(t.parents[i]))}),d=0,h=r.length;d<h;d++)s[r[d]].state[t?"selected":"checked"]||c.push(e?s[r[d]]:r[d]);return c},this._undetermined=function(){if(null!==this.element){var e,t,i,o=this.get_undetermined(!1);for(this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),e=0,t=o.length;e<t;e++)(i=this.get_node(o[e],!0))&&i.length&&i.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(e,t,i,o){if(e=l.redraw_node.apply(this,arguments)){for(var n=null,s=null,a=0,r=e.childNodes.length;a<r;a++)if(e.childNodes[a]&&e.childNodes[a].className&&-1!==e.childNodes[a].className.indexOf("jstree-anchor")){n=e.childNodes[a];break}n&&(!this.settings.checkbox.tie_selection&&this._model.data[e.id].state.checked&&(n.className+=" jstree-checked"),s=h.cloneNode(!1),this._model.data[e.id].state.checkbox_disabled&&(s.className+=" jstree-checkbox-disabled"),n.insertBefore(s,n.childNodes[0]))}return i||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)),e},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(e){e=this.get_node(e);var t,i,o=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,s=this._data[n?"core":"checkbox"].selected,a=this._model.data;if(e&&!0!==e.state[n?"selected":"checked"]&&-1!==o.indexOf("undetermined")&&(-1!==o.indexOf("down")||-1!==o.indexOf("up"))){if(!e.state.loaded&&!0===e.original.state.undetermined)return!0;for(t=0,i=e.children_d.length;t<i;t++)if(-1!==R.inArray(e.children_d[t],s)||!a[e.children_d[t]].state.loaded&&a[e.children_d[t]].original.state.undetermined)return!0}return!1},this.disable_checkbox=function(e){var t,i,o;if(R.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.disable_checkbox(e[t]);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(o=this.get_node(e,!0),void(e.state.checkbox_disabled||(e.state.checkbox_disabled=!0,o&&o.length&&o.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:e}))))},this.enable_checkbox=function(e){var t,i,o;if(R.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.enable_checkbox(e[t]);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(o=this.get_node(e,!0),void(e.state.checkbox_disabled&&(e.state.checkbox_disabled=!1,o&&o.length&&o.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:e}))))},this.activate_node=function(e,t){return!R(t.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||R(t.target).hasClass("jstree-checkbox"))&&(t.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!R(t.target).hasClass("jstree-checkbox")?l.activate_node.call(this,e,t):!this.is_disabled(e)&&(this.is_checked(e)?this.uncheck_node(e,t):this.check_node(e,t),void this.trigger("activate_node",{node:this.get_node(e)})))},this._cascade_new_checked_state=function(e,t){var i,o,n=this.settings.checkbox.tie_selection,s=this._model.data[e],a=[],r=[];if(!this.settings.checkbox.cascade_to_disabled&&s.state.disabled||!this.settings.checkbox.cascade_to_hidden&&s.state.hidden)c=this.get_checked_descendants(e),s.state[n?"selected":"checked"]&&c.push(s.id),a=a.concat(c);else{if(s.children)for(i=0,o=s.children.length;i<o;i++){var l=s.children[i],c=this._cascade_new_checked_state(l,t),a=a.concat(c);-1<c.indexOf(l)&&r.push(l)}var e=this.get_node(s,!0),d=0<r.length&&r.length<s.children.length;s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=d),!d&&t&&r.length===s.children.length?(s.state[n?"selected":"checked"]=t,a.push(s.id),e.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked")):(s.state[n?"selected":"checked"]=!1,e.attr("aria-selected",!1).children(".jstree-anchor").removeClass(n?"jstree-clicked":"jstree-checked"))}return a},this.get_checked_descendants=function(e){var t=this,i=t.settings.checkbox.tie_selection,e=t._model.data[e];return R.vakata.array_filter(e.children_d,function(e){return t._model.data[e].state[i?"selected":"checked"]})},this.check_node=function(e,t){if(this.settings.checkbox.tie_selection)return this.select_node(e,!1,!0,t);var i,o,n;if(R.vakata.is_array(e)){for(o=0,n=(e=e.slice()).length;o<n;o++)this.check_node(e[o],t);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(i=this.get_node(e,!0),void(e.state.checked||(e.state.checked=!0,this._data.checkbox.selected.push(e.id),i&&i.length&&i.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:e,selected:this._data.checkbox.selected,event:t}))))},this.uncheck_node=function(e,t){if(this.settings.checkbox.tie_selection)return this.deselect_node(e,!1,t);var i,o,n;if(R.vakata.is_array(e)){for(i=0,o=(e=e.slice()).length;i<o;i++)this.uncheck_node(e[i],t);return!0}return!(!(e=this.get_node(e))||e.id===R.jstree.root)&&(n=this.get_node(e,!0),void(e.state.checked&&(e.state.checked=!1,this._data.checkbox.selected=R.vakata.array_remove_item(this._data.checkbox.selected,e.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:e,selected:this._data.checkbox.selected,event:t}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var e,t;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[R.jstree.root].children_d.concat(),e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();for(var e=this._data.checkbox.selected.concat([]),t=0,i=this._data.checkbox.selected.length;t<i;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:e})},this.is_checked=function(e){return this.settings.checkbox.tie_selection?this.is_selected(e):!(!(e=this.get_node(e))||e.id===R.jstree.root)&&e.state.checked},this.get_checked=function(e){return this.settings.checkbox.tie_selection?this.get_selected(e):e?R.map(this._data.checkbox.selected,function(e){return this.get_node(e)}.bind(this)):this._data.checkbox.selected.slice()},this.get_top_checked=function(e){if(this.settings.checkbox.tie_selection)return this.get_top_selected(e);for(var t,i,o=this.get_checked(!0),n={},s=0,a=o.length;s<a;s++)n[o[s].id]=o[s];for(s=0,a=o.length;s<a;s++)for(t=0,i=o[s].children_d.length;t<i;t++)n[o[s].children_d[t]]&&delete n[o[s].children_d[t]];for(s in o=[],n)n.hasOwnProperty(s)&&o.push(s);return e?R.map(o,function(e){return this.get_node(e)}.bind(this)):o},this.get_bottom_checked=function(e){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(e);for(var t=this.get_checked(!0),i=[],o=0,n=t.length;o<n;o++)t[o].children.length||i.push(t[o].id);return e?R.map(i,function(e){return this.get_node(e)}.bind(this)):i},this.load_node=function(e,t){var i,o,n;if(!R.vakata.is_array(e)&&!this.settings.checkbox.tie_selection&&((n=this.get_node(e))&&n.state.loaded))for(i=0,o=n.children_d.length;i<o;i++)this._model.data[n.children_d[i]].state.checked&&(this._data.checkbox.selected=R.vakata.array_remove_item(this._data.checkbox.selected,n.children_d[i]));return l.load_node.apply(this,arguments)},this.get_state=function(){var e=l.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection||(e.checkbox=this._data.checkbox.selected.slice()),e},this.set_state=function(e,t){var i,o=l.set_state.apply(this,arguments);return o&&e.checkbox?(this.settings.checkbox.tie_selection||(this.uncheck_all(),i=this,R.each(e.checkbox,function(e,t){i.check_node(t)})),delete e.checkbox,this.set_state(e,t),!1):o},this.refresh=function(e,t){return this.settings.checkbox.tie_selection&&(this._data.checkbox.selected=[]),l.refresh.apply(this,arguments)}},R.jstree.defaults.conditionalselect=function(){return!0},R.jstree.plugins.conditionalselect=function(e,i){this.activate_node=function(e,t){return this.settings.conditionalselect.call(this,this.get_node(e),t)?i.activate_node.call(this,e,t):void 0}},R.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(e,t){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(e){var i=R.jstree.reference(e.reference),e=i.get_node(e.reference);i.create_node(e,{},"last",function(t){try{i.edit(t)}catch(e){setTimeout(function(){i.edit(t)},0)}})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(e){var t=R.jstree.reference(e.reference),e=t.get_node(e.reference);t.edit(e)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(e){var t=R.jstree.reference(e.reference),e=t.get_node(e.reference);t.is_selected(e)?t.delete_node(t.get_selected()):t.delete_node(e)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(e){var t=R.jstree.reference(e.reference),e=t.get_node(e.reference);t.is_selected(e)?t.cut(t.get_top_selected()):t.cut(e)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(e){var t=R.jstree.reference(e.reference),e=t.get_node(e.reference);t.is_selected(e)?t.copy(t.get_top_selected()):t.copy(e)}},paste:{separator_before:!1,icon:!1,_disabled:function(e){return!R.jstree.reference(e.reference).can_paste()},separator_after:!1,label:"Paste",action:function(e){var t=R.jstree.reference(e.reference),e=t.get_node(e.reference);t.paste(e)}}}}}}},R.jstree.plugins.contextmenu=function(e,s){this.bind=function(){s.bind.call(this);var t,i,o=0,n=null;this.element.on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-contextmenu")}.bind(this)).on("contextmenu.jstree",".jstree-anchor",function(e,t){"input"!==e.target.tagName.toLowerCase()&&(e.preventDefault(),o=e.ctrlKey?+new Date:0,(t||n)&&(o=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e))}.bind(this)).on("click.jstree",".jstree-anchor",function(e){this._data.contextmenu.visible&&(!o||250<+new Date-o)&&R.vakata.context.hide(),o=0}.bind(this)).on("touchstart.jstree",".jstree-anchor",function(e){e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(t=e.originalEvent.changedTouches[0].clientX,i=e.originalEvent.changedTouches[0].clientY,n=setTimeout(function(){R(e.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(10<Math.abs(t-e.originalEvent.changedTouches[0].clientX)||10<Math.abs(i-e.originalEvent.changedTouches[0].clientY))&&(clearTimeout(n),R.vakata.context.hide())}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),R(b).on("context_hide.vakata.jstree",function(e,t){this._data.contextmenu.visible=!1,R(t.reference).removeClass("jstree-context")}.bind(this))},this.teardown=function(){this._data.contextmenu.visible&&R.vakata.context.hide(),R(b).off("context_hide.vakata.jstree"),s.teardown.call(this)},this.show_contextmenu=function(t,i,o,e){if(!(t=this.get_node(t))||t.id===R.jstree.root)return!1;var n=this.settings.contextmenu,s=this.get_node(t,!0).children(".jstree-anchor"),a=!1;!n.show_at_node&&i!==E&&o!==E||(s=s.offset(),i=s.left,o=s.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(t)&&this.activate_node(t,e),a=n.items,R.vakata.is_function(a)&&(a=a.call(this,t,function(e){this._show_contextmenu(t,i,o,e)}.bind(this))),R.isPlainObject(a)&&this._show_contextmenu(t,i,o,a)},this._show_contextmenu=function(e,t,i,o){var n=this.get_node(e,!0).children(".jstree-anchor");R(b).one("context_show.vakata.jstree",function(e,t){var i="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";R(t.element).addClass(i),n.addClass("jstree-context")}.bind(this)),this._data.contextmenu.visible=!0,R.vakata.context.show(n,{x:t,y:i},o),this.trigger("show_contextmenu",{node:e,x:t,y:i})}},v={element:y=!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1},(_=R).vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(e){_(b).triggerHandler("context_"+e+".vakata",{reference:v.reference,element:v.element,position:{x:v.position_x,y:v.position_y}})},_execute:function(e){return!(!(e=v.items[e])||e._disabled&&(!_.vakata.is_function(e._disabled)||e._disabled({item:e,reference:v.reference,element:v.element}))||!e.action)&&e.action.call(null,{item:e,reference:v.reference,element:v.element,position:{x:v.position_x,y:v.position_y}})},_parse:function(e,t){if(!e)return!1;t||(v.html="",v.items=[]);var i,o="",n=!1;return t&&(o+="<ul>"),_.each(e,function(e,t){return!t||(v.items.push(t),!n&&t.separator_before&&(o+="<li class='vakata-context-separator'><a href='#' "+(_.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>"),n=!1,o=(o+="<li class='"+(t._class||"")+(!0===t._disabled||_.vakata.is_function(t._disabled)&&t._disabled({item:t,reference:v.reference,element:v.element})?" vakata-contextmenu-disabled ":"")+"' "+(t.shortcut?" data-shortcut='"+t.shortcut+"' ":"")+">")+("<a href='#' rel='"+(v.items.length-1)+"' "+(t.title?"title='"+t.title+"'":"")+">"),_.vakata.context.settings.icons&&(o+="<i ",t.icon&&(o+=-1!==t.icon.indexOf("/")||-1!==t.icon.indexOf(".")?" style='background:url(\""+t.icon+"\") center center no-repeat' ":" class='"+t.icon+"' "),o+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),o+=(_.vakata.is_function(t.label)?t.label({item:e,reference:v.reference,element:v.element}):t.label)+(t.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+t.shortcut+'">'+(t.shortcut_label||"")+"</span>":"")+"</a>",t.submenu&&((i=_.vakata.context._parse(t.submenu,!0))&&(o+=i)),o+="</li>",void(t.separator_after&&(o+="<li class='vakata-context-separator'><a href='#' "+(_.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>",n=!0)))}),o=o.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),t&&(o+="</ul>"),t||(v.html=o,_.vakata.context._trigger("parse")),10<o.length&&o},_show_submenu:function(e){var t,i,o,n,s,a,r,l;(e=_(e)).length&&e.children("ul").length&&(t=e.children("ul"),o=(i=e.offset().left)+e.outerWidth(),n=e.offset().top,s=t.width(),a=t.height(),r=_(window).width()+_(window).scrollLeft(),l=_(window).height()+_(window).scrollTop(),y?e[o-(s+10+e.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):e[r<o+s&&r-o<i?"addClass":"removeClass"]("vakata-context-right"),l<n+a+10&&t.css("bottom","-1px"),e.hasClass("vakata-context-right")?i<s&&t.css("margin-right",i-s):r-o<s&&t.css("margin-left",r-o-s),t.show())},show:function(e,t,i){var o,n,s,a,r,l,c;switch(v.element&&v.element.length&&v.element.width(""),!0){case!t&&!e:return!1;case!!t&&!!e:v.reference=e,v.position_x=t.x,v.position_y=t.y;break;case!t&&!!e:o=(v.reference=e).offset(),v.position_x=o.left+e.outerHeight(),v.position_y=o.top;break;case!!t&&!e:v.position_x=t.x,v.position_y=t.y}e&&!i&&_(e).data("vakata_contextmenu")&&(i=_(e).data("vakata_contextmenu")),_.vakata.context._parse(i)&&v.element.html(v.html),v.items.length&&(v.element.appendTo(b.body),i=v.element,n=v.position_x,s=v.position_y,a=i.width(),r=i.height(),l=_(window).width()+_(window).scrollLeft(),c=_(window).height()+_(window).scrollTop(),y&&(n-=i.outerWidth()-_(e).outerWidth())<_(window).scrollLeft()+20&&(n=_(window).scrollLeft()+20),v.element.css({left:n=l<n+a+20?l-(a+20):n,top:s=c<s+r+20?c-(r+20):s}).show().find("a").first().trigger("focus").parent().addClass("vakata-context-hover"),v.is_visible=!0,_.vakata.context._trigger("show"))},hide:function(){v.is_visible&&(v.element.hide().find("ul").hide().end().find(":focus").trigger("blur").end().detach(),v.is_visible=!1,_.vakata.context._trigger("hide"))}},_(function(){y="rtl"===_(b.body).css("direction");var t=!1;v.element=_("<ul class='vakata-context'></ul>"),v.element.on("mouseenter","li",function(e){e.stopImmediatePropagation(),_.contains(this,e.relatedTarget)||(t&&clearTimeout(t),v.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),_(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),_.vakata.context._show_submenu(this))}).on("mouseleave","li",function(e){_.contains(this,e.relatedTarget)||_(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(e){_(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),_.vakata.context.settings.hide_onmouseleave&&(t=setTimeout(function(){_.vakata.context.hide()},_.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(e){e.preventDefault(),_(this).trigger("blur").parent().hasClass("vakata-context-disabled")||!1===_.vakata.context._execute(_(this).attr("rel"))||_.vakata.context.hide()}).on("keydown","a",function(e){var t=null;switch(e.which){case 13:case 32:e.type="click",e.preventDefault(),_(e.currentTarget).trigger(e);break;case 37:v.is_visible&&(v.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 38:v.is_visible&&((t=(t=v.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first()).length?t:v.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()).addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 39:v.is_visible&&(v.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 40:v.is_visible&&((t=(t=v.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first()).length?t:v.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()).addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 27:_.vakata.context.hide(),e.preventDefault()}}).on("keydown",function(e){e.preventDefault();e=v.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();e.parent().not(".vakata-context-disabled")&&e.trigger("click")}),_(b).on("mousedown.vakata.jstree",function(e){v.is_visible&&v.element[0]!==e.target&&!_.contains(v.element[0],e.target)&&_.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,t){v.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),y&&v.element.addClass("vakata-context-rtl").css("direction","rtl"),v.element.find("ul").hide().end()})}),R.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1},R.jstree.plugins.dnd=function(e,r){this.init=function(e,t){r.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in b.createElement("span")},this.bind=function(){r.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",function(e){if(this.settings.dnd.large_drag_target&&R(e.target).closest(".jstree-node")[0]!==e.currentTarget)return!0;if("touchstart"===e.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!R(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var t=this.get_node(e.target),i=this.is_selected(t)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,o=1<i?i+" "+this.get_string("nodes"):this.get_text(e.currentTarget);if(this.settings.core.force_text&&(o=R.vakata.html.escape(o)),t&&t.id&&t.id!==R.jstree.root&&(1===e.which||"touchstart"===e.type||"dragstart"===e.type)&&(!0===this.settings.dnd.is_draggable||R.vakata.is_function(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<i?this.get_top_selected(!0):[t],e))){if(n={jstree:!0,origin:this,obj:this.get_node(t,!0),nodes:1<i?this.get_top_selected():[t.id]},s=e.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),R.vakata.dnd.start(e,n,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+o+'<ins class="jstree-copy">+</ins></div>');R.vakata.dnd._trigger("start",e,{helper:R(),element:s,data:n})}}.bind(this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(e){return e.preventDefault(),R.vakata.dnd._trigger("move",e,{helper:R(),element:s,data:n}),!1}).on("drop.jstree",function(e){return e.preventDefault(),R.vakata.dnd._trigger("stop",e,{helper:R(),element:s,data:n}),!1}.bind(this))},this.redraw_node=function(e,t,i,o){if((e=r.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{for(var n=null,s=0,a=e.childNodes.length;s<a;s++)if(e.childNodes[s]&&e.childNodes[s].className&&-1!==e.childNodes[s].className.indexOf("jstree-anchor")){n=e.childNodes[s];break}n&&n.setAttribute("draggable",!0)}return e}},R(function(){var C=!1,D=!1,L=!1,A=!1,I=R('<div id="jstree-marker">&#160;</div>').hide();R(b).on("dragover.vakata.jstree",function(e){s&&R.vakata.dnd._trigger("move",e,{helper:R(),element:s,data:n})}).on("drop.vakata.jstree",function(e){s&&(R.vakata.dnd._trigger("stop",e,{helper:R(),element:s,data:n}),n=s=null)}).on("dnd_start.vakata.jstree",function(e,t){L=C=!1,t&&t.data&&t.data.jstree&&I.appendTo(b.body)}).on("dnd_move.vakata.jstree",function(e,n){var s=n.event.target!==L.target;if(!A||n.event&&"dragover"===n.event.type&&!s||clearTimeout(A),n&&n.data&&n.data.jstree&&(!n.event.target.id||"jstree-marker"!==n.event.target.id)){L=n.event;var a,t,r,l,c,d,h,u,p,m,f,g,_,b,y,v,k,w,T,S=R.jstree.reference(n.event.target),x=!1;if(S&&S._data&&S._data.dnd)if(I.attr("class","jstree-"+S.get_theme()+(S.settings.core.themes.responsive?" jstree-dnd-responsive":"")),k=n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey)),n.helper.children().attr("class","jstree-"+S.get_theme()+" jstree-"+S.get_theme()+"-"+S.get_theme_variant()+" "+(S.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[k?"show":"hide"](),n.event.target!==S.element[0]&&n.event.target!==S.get_container_ul()[0]||0!==S.get_container_ul().children().length){if((x=S.settings.dnd.large_drop_target?R(n.event.target).closest(".jstree-node").children(".jstree-anchor"):R(n.event.target).closest(".jstree-anchor"))&&x.length&&x.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(a=x.offset(),t=(n.event.pageY!==E?n.event:n.event.originalEvent).pageY-a.top,c=x.outerHeight(),u=t<c/3?["b","i","a"]:c-c/3<t?["a","i","b"]:c/2<t?["i","a","b"]:["i","b","a"],R.each(u,function(e,t){switch(t){case"b":r=a.left-6,l=a.top,d=S.get_parent(x),h=x.parent().index(),T="jstree-below";break;case"i":y=S.settings.dnd.inside_pos,v=S.get_node(x.parent()),r=a.left-2,l=a.top+c/2+1,d=v.id,h="first"===y?0:"last"===y?v.children.length:Math.min(y,v.children.length),T="jstree-inside";break;case"a":r=a.left-6,l=a.top+c,d=S.get_parent(x),h=x.parent().index()+1,T="jstree-above"}for(p=!0,m=0,f=n.data.nodes.length;m<f;m++)if(g=n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"copy_node":"move_node",_=h,"move_node"==g&&"a"===t&&n.data.origin&&n.data.origin===S&&d===S.get_parent(n.data.nodes[m])&&(b=S.get_node(d),_>R.inArray(n.data.nodes[m],b.children)&&--_),!(p=p&&(S&&S.settings&&S.settings.dnd&&!1===S.settings.dnd.check_while_dragging||S.check(g,n.data.origin&&n.data.origin!==S?n.data.origin.get_node(n.data.nodes[m]):n.data.nodes[m],d,_,{dnd:!0,ref:S.get_node(x.parent()),pos:t,origin:n.data.origin,is_multi:n.data.origin&&n.data.origin!==S,is_foreign:!n.data.origin})))){S&&S.last_error&&(D=S.last_error());break}return"i"===t&&x.parent().is(".jstree-closed")&&S.settings.dnd.open_timeout&&(!n.event||"dragover"!==n.event.type||s)&&(A&&clearTimeout(A),A=setTimeout((o=x,function(){i.open_node(o)}),(i=S).settings.dnd.open_timeout)),p?((w=S.get_node(d,!0)).hasClass(".jstree-dnd-parent")||(R(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),w.addClass("jstree-dnd-parent")),C={ins:S,par:d,pos:"i"!==t||"last"!==y||0!==h||S.is_loaded(v)?h:"last"},I.css({left:r+"px",top:l+"px"}).show(),I.removeClass("jstree-above jstree-inside jstree-below").addClass(T),n.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),n.event.originalEvent&&n.event.originalEvent.dataTransfer&&(n.event.originalEvent.dataTransfer.dropEffect=k?"copy":"move"),D={},!(u=!0)):void 0;var i,o}),!0===u))return}else{for(p=!0,m=0,f=n.data.nodes.length;m<f&&(p=p&&S.check(n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"copy_node":"move_node",n.data.origin&&n.data.origin!==S?n.data.origin.get_node(n.data.nodes[m]):n.data.nodes[m],R.jstree.root,"last",{dnd:!0,ref:S.get_node(R.jstree.root),pos:"i",origin:n.data.origin,is_multi:n.data.origin&&n.data.origin!==S,is_foreign:!n.data.origin}));m++);if(p)return C={ins:S,par:R.jstree.root,pos:"last"},I.hide(),n.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(n.event.originalEvent&&n.event.originalEvent.dataTransfer&&(n.event.originalEvent.dataTransfer.dropEffect=k?"copy":"move"))}R(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),C=!1,n.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),n.event.originalEvent&&n.event.originalEvent.dataTransfer,I.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(I.hide(),L=C=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(e,t){if(R(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),A&&clearTimeout(A),t&&t.data&&t.data.jstree){I.hide().detach();var i,o,n=[];if(C){for(i=0,o=t.data.nodes.length;i<o;i++)n[i]=t.data.origin?t.data.origin.get_node(t.data.nodes[i]):t.data.nodes[i];C.ins[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(t.event.metaKey||t.event.ctrlKey))?"copy_node":"move_node"](n,C.par,C.pos,!1,!1,!1,t.data.origin)}else(i=R(t.event.target).closest(".jstree")).length&&D&&D.error&&"check"===D.error&&((i=i.jstree(!0))&&i.settings.core.error.call(this,D));C=L=!1}}).on("keyup.jstree keydown.jstree",function(e,t){(t=R.vakata.dnd._get())&&t.data&&t.data.jstree&&("keyup"===e.type&&27===e.which?(A&&clearTimeout(A),A=L=D=C=!1,I.hide().detach(),R.vakata.dnd._clean()):(t.helper.find(".jstree-copy").first()[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(e.metaKey||e.ctrlKey))?"show":"hide"](),L&&(L.metaKey=e.metaKey,L.ctrlKey=e.ctrlKey,R.vakata.dnd._trigger("move",L))))})}),g={element:!((f=R).vakata.html={div:f("<div></div>"),escape:function(e){return f.vakata.html.div.text(e).html()},strip:function(e){return f.vakata.html.div.empty().append(f.parseHTML(e)).text()}}),target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},f.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:10},_trigger:function(e,t,i){(i=i===E?f.vakata.dnd._get():i).event=t,f(b).triggerHandler("dnd_"+e+".vakata",i)},_get:function(){return{data:g.data,element:g.element,helper:g.helper}},_clean:function(){g.helper&&g.helper.remove(),g.scroll_i&&(clearInterval(g.scroll_i),g.scroll_i=!1),g={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},s=null,f(b).off("mousemove.vakata.jstree touchmove.vakata.jstree",f.vakata.dnd.drag),f(b).off("mouseup.vakata.jstree touchend.vakata.jstree",f.vakata.dnd.stop)},_scroll:function(e){if(!g.scroll_e||!g.scroll_l&&!g.scroll_t)return g.scroll_i&&(clearInterval(g.scroll_i),g.scroll_i=!1),!1;if(!g.scroll_i)return g.scroll_i=setInterval(f.vakata.dnd._scroll,100),!1;if(!0===e)return!1;var e=g.scroll_e.scrollTop(),t=g.scroll_e.scrollLeft();g.scroll_e.scrollTop(e+g.scroll_t*f.vakata.dnd.settings.scroll_speed),g.scroll_e.scrollLeft(t+g.scroll_l*f.vakata.dnd.settings.scroll_speed),e===g.scroll_e.scrollTop()&&t===g.scroll_e.scrollLeft()||f.vakata.dnd._trigger("scroll",g.scroll_e)},start:function(e,t,i){"touchstart"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=b.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),g.is_drag&&f.vakata.dnd.stop({});try{e.currentTarget.unselectable="on",e.currentTarget.onselectstart=function(){return!1},e.currentTarget.style&&(e.currentTarget.style.touchAction="none",e.currentTarget.style.msTouchAction="none",e.currentTarget.style.MozUserSelect="none")}catch(e){}return g.init_x=e.pageX,g.init_y=e.pageY,g.data=t,g.is_down=!0,g.element=e.currentTarget,g.target=e.target,g.is_touch="touchstart"===e.type,!1!==i&&(g.helper=f("<div id='vakata-dnd'></div>").html(i).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),f(b).on("mousemove.vakata.jstree touchmove.vakata.jstree",f.vakata.dnd.drag),f(b).on("mouseup.vakata.jstree touchend.vakata.jstree",f.vakata.dnd.stop),!1},drag:function(i){if("touchmove"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=b.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),g.is_down){if(!g.is_drag){if(!(Math.abs(i.pageX-g.init_x)>(g.is_touch?f.vakata.dnd.settings.threshold_touch:f.vakata.dnd.settings.threshold)||Math.abs(i.pageY-g.init_y)>(g.is_touch?f.vakata.dnd.settings.threshold_touch:f.vakata.dnd.settings.threshold)))return;g.helper&&(g.helper.appendTo(b.body),g.helper_w=g.helper.outerWidth()),g.is_drag=!0,f(g.target).one("click.vakata",!1),f.vakata.dnd._trigger("start",i)}var e,t,o,n=!1,s=!1,a=!1,r=!1,l=!1,c=!1;return g.scroll_t=0,g.scroll_l=0,g.scroll_e=!1,f(f(i.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(f(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var e=f(this),t=e.offset();return this.scrollHeight>this.offsetHeight&&(t.top+e.height()-i.pageY<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_t=1),i.pageY-t.top<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(t.left+e.width()-i.pageX<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_l=1),i.pageX-t.left<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_l=-1)),g.scroll_t||g.scroll_l?(g.scroll_e=f(this),!1):void 0}),g.scroll_e||(n=f(b),s=f(window),a=n.height(),e=s.height(),r=n.width(),s=s.width(),t=n.scrollTop(),o=n.scrollLeft(),e<a&&i.pageY-t<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_t=-1),e<a&&e-(i.pageY-t)<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_t=1),s<r&&i.pageX-o<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_l=-1),s<r&&s-(i.pageX-o)<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_l=1),(g.scroll_t||g.scroll_l)&&(g.scroll_e=n)),g.scroll_e&&f.vakata.dnd._scroll(!0),g.helper&&(l=parseInt(i.pageY+f.vakata.dnd.settings.helper_top,10),c=parseInt(i.pageX+f.vakata.dnd.settings.helper_left,10),r&&c+g.helper_w>r&&(c=r-(g.helper_w+2)),g.helper.css({left:c+"px",top:(l=a&&a<l+25?a-50:l)+"px"})),f.vakata.dnd._trigger("move",i),!1}},stop:function(e){var t;return"touchend"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=b.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),g.is_drag?(e.target!==g.target&&f(g.target).off("click.vakata"),f.vakata.dnd._trigger("stop",e)):"touchend"===e.type&&e.target===g.target&&(t=setTimeout(function(){f(e.target).trigger("click")},100),f(e.target).one("click",function(){t&&clearTimeout(t)})),f.vakata.dnd._clean(),!1}},R.jstree.defaults.massload=null,R.jstree.plugins.massload=function(e,d){this.init=function(e,t){this._data.massload={},d.init.call(this,e,t)},this._load_nodes=function(s,a,r,l){var e,t,c,i=this.settings.massload,o=[],n=this._model.data;if(!r){for(e=0,t=s.length;e<t;e++)n[s[e]]&&(n[s[e]].state.loaded||n[s[e]].state.failed)&&!l||(o.push(s[e]),(c=this.get_node(s[e],!0))&&c.length&&c.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},o.length){if(R.vakata.is_function(i))return i.call(this,o,function(e){var t,i;if(e)for(t in e)e.hasOwnProperty(t)&&(this._data.massload[t]=e[t]);for(t=0,i=s.length;t<i;t++)(c=this.get_node(s[t],!0))&&c.length&&c.removeClass("jstree-loading").attr("aria-busy",!1);d._load_nodes.call(this,s,a,r,l)}.bind(this));if("object"==typeof i&&i&&i.url)return i=R.extend(!0,{},i),R.vakata.is_function(i.url)&&(i.url=i.url.call(this,o)),R.vakata.is_function(i.data)&&(i.data=i.data.call(this,o)),R.ajax(i).done(function(e,t,i){var o,n;if(e)for(o in e)e.hasOwnProperty(o)&&(this._data.massload[o]=e[o]);for(o=0,n=s.length;o<n;o++)(c=this.get_node(s[o],!0))&&c.length&&c.removeClass("jstree-loading").attr("aria-busy",!1);d._load_nodes.call(this,s,a,r,l)}.bind(this)).fail(function(e){d._load_nodes.call(this,s,a,r,l)}.bind(this))}}return d._load_nodes.call(this,s,a,r,l)},this._load_node=function(e,t){var i,o=this._data.massload[e.id];return o?(o=this["string"==typeof o?"_append_html_data":"_append_json_data"](e,"string"==typeof o?R(R.parseHTML(o)).filter(function(){return 3!==this.nodeType}):o,function(e){t.call(this,e)}),(i=this.get_node(e.id,!0))&&i.length&&i.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[e.id],o):d._load_node.call(this,e,t)}},R.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},R.jstree.plugins.search=function(e,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=R(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",function(e,t){if(this._data.search.som&&t.res.length){for(var i,o,n=this._model.data,s=[],a=0,r=t.res.length;a<r;a++)if(n[t.res[a]]&&!n[t.res[a]].state.hidden&&(s.push(t.res[a]),s=s.concat(n[t.res[a]].parents),this._data.search.smc))for(i=0,o=n[t.res[a]].children_d.length;i<o;i++)n[n[t.res[a]].children_d[i]]&&!n[n[t.res[a]].children_d[i]].state.hidden&&s.push(n[t.res[a]].children_d[i]);s=R.vakata.array_remove_item(R.vakata.array_unique(s),R.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(s,!0),this.redraw(!0)}}.bind(this)).on("clear_search.jstree",function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))}.bind(this))},this.search=function(o,e,t,i,n,s){if(!1===o||""===R.vakata.trim(o.toString()))return this.clear_search();i=(i=this.get_node(i))&&i.id?i.id:null,o=o.toString();var a,r,l=this.settings.search,c=l.ajax||!1,d=this._model.data,h=null,u=[],p=[];if(this._data.search.res.length&&!n&&this.clear_search(),t===E&&(t=l.show_only_matches),s===E&&(s=l.show_only_matches_children),!e&&!1!==c)return R.vakata.is_function(c)?c.call(this,o,function(e){e&&e.d&&(e=e.d),this._load_nodes(R.vakata.is_array(e)?R.vakata.array_unique(e):[],function(){this.search(o,!0,t,i,n,s)})}.bind(this),i):((c=R.extend({},c)).data||(c.data={}),c.data.str=o,i&&(c.data.inside=i),this._data.search.lastRequest&&this._data.search.lastRequest.abort(),this._data.search.lastRequest=R.ajax(c).fail(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(c)},this.settings.core.error.call(this,this._data.core.last_error)}.bind(this)).done(function(e){e&&e.d&&(e=e.d),this._load_nodes(R.vakata.is_array(e)?R.vakata.array_unique(e):[],function(){this.search(o,!0,t,i,n,s)})}.bind(this)),this._data.search.lastRequest);if(n||(this._data.search.str=o,this._data.search.dom=R(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=t,this._data.search.smc=s),h=new R.vakata.search(o,!0,{caseSensitive:l.case_sensitive,fuzzy:l.fuzzy}),R.each(d[i||R.jstree.root].children_d,function(e,t){var i=d[t];i.text&&!i.state.hidden&&(!l.search_leaves_only||i.state.loaded&&0===i.children.length)&&(l.search_callback&&l.search_callback.call(this,o,i)||!l.search_callback&&h.search(i.text).isMatch)&&(u.push(t),p=p.concat(i.parents))}),u.length){for(a=0,r=(p=R.vakata.array_unique(p)).length;a<r;a++)p[a]!==R.jstree.root&&d[p[a]]&&!0===this.open_node(p[a],null,0)&&this._data.search.opn.push(p[a]);n?(this._data.search.dom=this._data.search.dom.add(R(this.element[0].querySelectorAll("#"+R.map(u,function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace(R.jstree.idregex,"\\$&"):e.replace(R.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=R.vakata.array_unique(this._data.search.res.concat(u))):(this._data.search.dom=R(this.element[0].querySelectorAll("#"+R.map(u,function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace(R.jstree.idregex,"\\$&"):e.replace(R.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=u),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:o,res:this._data.search.res,show_only_matches:t})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=R(this.element[0].querySelectorAll("#"+R.map(this._data.search.res,function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace(R.jstree.idregex,"\\$&"):e.replace(R.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=R()},this.redraw_node=function(e,t,i,o){if((e=r.redraw_node.apply(this,arguments))&&-1!==R.inArray(e.id,this._data.search.res)){for(var n=null,s=0,a=e.childNodes.length;s<a;s++)if(e.childNodes[s]&&e.childNodes[s].className&&-1!==e.childNodes[s].className.indexOf("jstree-anchor")){n=e.childNodes[s];break}n&&(n.className+=" jstree-search")}return e}},(m=R).vakata.search=function(g,e,_){_=_||{},!1!==(_=m.extend({},m.vakata.search.defaults,_)).fuzzy&&(_.fuzzy=!0),g=_.caseSensitive?g:g.toLowerCase();var b,y,v,t,k=_.location,i=_.distance,w=_.threshold,T=g.length;return 32<T&&(_.fuzzy=!1),_.fuzzy&&(b=1<<T-1,y=function(){for(var e={},t=0,t=0;t<T;t++)e[g.charAt(t)]=0;for(t=0;t<T;t++)e[g.charAt(t)]|=1<<T-t-1;return e}(),v=function(e,t){e/=T,t=Math.abs(k-t);return i?e+t/i:t?1:e}),t=function(e){if(e=_.caseSensitive?e:e.toLowerCase(),g===e||-1!==e.indexOf(g))return{isMatch:!0,score:0};if(!_.fuzzy)return{isMatch:!1,score:1};var t,i,o,n,s,a,r,l,c,d=e.length,h=w,u=e.indexOf(g,k),p=T+d,m=1,f=[];for(-1!==u&&(h=Math.min(v(0,u),h),-1!==(u=e.lastIndexOf(g,k+T))&&(h=Math.min(v(0,u),h))),u=-1,t=0;t<T;t++){for(o=0,n=p;o<n;)v(t,k+n)<=h?o=n:p=n,n=Math.floor((p-o)/2+o);for(p=n,a=Math.max(1,k-n+1),r=Math.min(k+n,d)+T,(l=new Array(r+2))[r+1]=(1<<t)-1,i=r;a<=i;i--)if(c=y[e.charAt(i-1)],l[i]=0===t?(l[i+1]<<1|1)&c:(l[i+1]<<1|1)&c|(s[i+1]|s[i])<<1|1|s[i+1],l[i]&b&&(m=v(t,i-1))<=h){if(h=m,f.push(u=i-1),!(k<u))break;a=Math.max(1,2*k-u)}if(v(t+1,k)>h)break;s=l}return{isMatch:0<=u,score:m}},!0===e?{search:t}:t(e)},m.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1},R.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},!(R.jstree.plugins.sort=function(e,t){this.bind=function(){t.bind.call(this),this.element.on("model.jstree",function(e,t){this.sort(t.parent,!0)}.bind(this)).on("rename_node.jstree create_node.jstree",function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)}.bind(this)).on("move_node.jstree copy_node.jstree",function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)}.bind(this))},this.sort=function(e,t){var i,o;if((e=this.get_node(e))&&e.children&&e.children.length&&(e.children.sort(this.settings.sort.bind(this)),t))for(i=0,o=e.children_d.length;i<o;i++)this.sort(e.children_d[i],!1)}})),p=(R.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1},R.jstree.plugins.state=function(e,t){this.bind=function(){t.bind.call(this);var i=function(){this.element.on(this.settings.state.events,function(){u&&clearTimeout(u),u=setTimeout(function(){this.save_state()}.bind(this),100)}.bind(this)),this.trigger("state_ready")}.bind(this);this.element.on("ready.jstree",function(e,t){this.element.one("restore_state.jstree",i),this.restore_state()||i()}.bind(this))},this.save_state=function(){var e=this.get_state(),e=(this.settings.state.preserve_loaded||delete e.core.loaded,{state:e,ttl:this.settings.state.ttl,sec:+new Date});R.vakata.storage.set(this.settings.state.key,JSON.stringify(e))},this.restore_state=function(){var i=R.vakata.storage.get(this.settings.state.key);if(i)try{i=JSON.parse(i)}catch(e){return!1}return!(i&&i.ttl&&i.sec&&+new Date-i.sec>i.ttl)&&(!!(i=(i=i&&i.state?i.state:i)&&R.vakata.is_function(this.settings.state.filter)?this.settings.state.filter.call(this,i):i)&&(this.settings.state.preserve_loaded||delete i.core.loaded,this.element.one("set_state.jstree",function(e,t){t.instance.trigger("restore_state",{state:R.extend(!0,{},i)})}),this.set_state(i),!0))},this.clear_state=function(){return R.vakata.storage.del(this.settings.state.key)}},R.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}},R.jstree.defaults.types={default:{}},R.jstree.defaults.types[R.jstree.root]={},R.jstree.plugins.types=function(e,d){this.init=function(e,t){var i,o;if(t&&t.types&&t.types.default)for(i in t.types)if("default"!==i&&i!==R.jstree.root&&t.types.hasOwnProperty(i))for(o in t.types.default)t.types.default.hasOwnProperty(o)&&t.types[i][o]===E&&(t.types[i][o]=t.types.default[o]);d.init.call(this,e,t),this._model.data[R.jstree.root].type=R.jstree.root},this.refresh=function(e,t){d.refresh.call(this,e,t),this._model.data[R.jstree.root].type=R.jstree.root},this.bind=function(){this.element.on("model.jstree",function(e,t){for(var i,o=this._model.data,n=t.nodes,s=this.settings.types,a="default",r=0,l=n.length;r<l;r++){if(a="default",o[n[r]].original&&o[n[r]].original.type&&s[o[n[r]].original.type]&&(a=o[n[r]].original.type),o[n[r]].data&&o[n[r]].data.jstree&&o[n[r]].data.jstree.type&&s[o[n[r]].data.jstree.type]&&(a=o[n[r]].data.jstree.type),o[n[r]].type=a,!0===o[n[r]].icon&&s[a].icon!==E&&(o[n[r]].icon=s[a].icon),s[a].li_attr!==E&&"object"==typeof s[a].li_attr)for(i in s[a].li_attr)if(s[a].li_attr.hasOwnProperty(i)){if("id"===i)continue;o[n[r]].li_attr[i]===E?o[n[r]].li_attr[i]=s[a].li_attr[i]:"class"===i&&(o[n[r]].li_attr.class=s[a].li_attr.class+" "+o[n[r]].li_attr.class)}if(s[a].a_attr!==E&&"object"==typeof s[a].a_attr)for(i in s[a].a_attr)if(s[a].a_attr.hasOwnProperty(i)){if("id"===i)continue;o[n[r]].a_attr[i]===E?o[n[r]].a_attr[i]=s[a].a_attr[i]:"href"===i&&"#"===o[n[r]].a_attr[i]?o[n[r]].a_attr.href=s[a].a_attr.href:"class"===i&&(o[n[r]].a_attr.class=s[a].a_attr.class+" "+o[n[r]].a_attr.class)}}o[R.jstree.root].type=R.jstree.root}.bind(this)),d.bind.call(this)},this.get_json=function(e,t,i){var o,n,s=this._model.data,a=t?R.extend(!0,{},t,{no_id:!1}):{},r=d.get_json.call(this,e,a,i);if(!1===r)return!1;if(R.vakata.is_array(r))for(o=0,n=r.length;o<n;o++)r[o].type=r[o].id&&s[r[o].id]&&s[r[o].id].type?s[r[o].id].type:"default",t&&t.no_id&&(delete r[o].id,r[o].li_attr&&r[o].li_attr.id&&delete r[o].li_attr.id,r[o].a_attr&&r[o].a_attr.id&&delete r[o].a_attr.id);else r.type=r.id&&s[r.id]&&s[r.id].type?s[r.id].type:"default",t&&t.no_id&&(r=this._delete_ids(r));return r},this._delete_ids=function(e){if(R.vakata.is_array(e))for(var t=0,i=e.length;t<i;t++)e[t]=this._delete_ids(e[t]);else delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id,e.children&&R.vakata.is_array(e.children)&&(e.children=this._delete_ids(e.children));return e},this.check=function(e,t,i,o,n){if(!1===d.check.call(this,e,t,i,o,n))return!1;t=t&&t.id?t:this.get_node(t),i=i&&i.id?i:this.get_node(i);var s,a,r,l,c=(c=t&&t.id?n&&n.origin?n.origin:R.jstree.reference(t.id):null)&&c._model&&c._model.data?c._model.data:null;switch(e){case"create_node":case"move_node":case"copy_node":if("move_node"!==e||-1===R.inArray(t.id,i.children)){if((s=this.get_rules(i)).max_children!==E&&-1!==s.max_children&&s.max_children===i.children.length)return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+e,data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})});if(s.valid_children!==E&&-1!==s.valid_children&&-1===R.inArray(t.type||"default",s.valid_children))return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+e,data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})});if(c&&t.children_d&&t.parents){for(r=a=0,l=t.children_d.length;r<l;r++)a=Math.max(a,c[t.children_d[r]].parents.length);a=a-t.parents.length+1}(a<=0||a===E)&&(a=1);do{if(s.max_depth!==E&&-1!==s.max_depth&&s.max_depth<a)return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+e,data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})})}while(i=this.get_node(i.parent),s=this.get_rules(i),a++,i)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;e=this.get_type(e,!0);return e.max_depth===E&&(e.max_depth=-1),e.max_children===E&&(e.max_children=-1),e.valid_children===E&&(e.valid_children=-1),e},this.get_type=function(e,t){return!!(e=this.get_node(e))&&(t?R.extend({type:e.type},this.settings.types[e.type]):e.type)},this.set_type=function(e,t){var i,o,n,s,a,r,l,c,d=this._model.data;if(R.vakata.is_array(e))for(o=0,n=(e=e.slice()).length;o<n;o++)this.set_type(e[o],t);else{if(i=this.settings.types,e=this.get_node(e),!i[t]||!e)return!1;if((l=this.get_node(e,!0))&&l.length&&(c=l.children(".jstree-anchor")),s=e.type,a=this.get_icon(e),e.type=t,!0!==a&&i[s]&&(i[s].icon===E||a!==i[s].icon)||this.set_icon(e,i[t].icon===E||i[t].icon),i[s]&&i[s].li_attr!==E&&"object"==typeof i[s].li_attr)for(r in i[s].li_attr)if(i[s].li_attr.hasOwnProperty(r)){if("id"===r)continue;"class"===r?(d[e.id].li_attr.class=(d[e.id].li_attr.class||"").replace(i[s].li_attr[r],""),l&&l.removeClass(i[s].li_attr[r])):d[e.id].li_attr[r]===i[s].li_attr[r]&&(d[e.id].li_attr[r]=null,l&&l.removeAttr(r))}if(i[s]&&i[s].a_attr!==E&&"object"==typeof i[s].a_attr)for(r in i[s].a_attr)if(i[s].a_attr.hasOwnProperty(r)){if("id"===r)continue;"class"===r?(d[e.id].a_attr.class=(d[e.id].a_attr.class||"").replace(i[s].a_attr[r],""),c&&c.removeClass(i[s].a_attr[r])):d[e.id].a_attr[r]===i[s].a_attr[r]&&("href"===r?(d[e.id].a_attr[r]="#",c&&c.attr("href","#")):(delete d[e.id].a_attr[r],c&&c.removeAttr(r)))}if(i[t].li_attr!==E&&"object"==typeof i[t].li_attr)for(r in i[t].li_attr)if(i[t].li_attr.hasOwnProperty(r)){if("id"===r)continue;d[e.id].li_attr[r]===E?(d[e.id].li_attr[r]=i[t].li_attr[r],l&&("class"===r?l.addClass(i[t].li_attr[r]):l.attr(r,i[t].li_attr[r]))):"class"===r&&(d[e.id].li_attr.class=i[t].li_attr[r]+" "+d[e.id].li_attr.class,l&&l.addClass(i[t].li_attr[r]))}if(i[t].a_attr!==E&&"object"==typeof i[t].a_attr)for(r in i[t].a_attr)if(i[t].a_attr.hasOwnProperty(r)){if("id"===r)continue;d[e.id].a_attr[r]===E?(d[e.id].a_attr[r]=i[t].a_attr[r],c&&("class"===r?c.addClass(i[t].a_attr[r]):c.attr(r,i[t].a_attr[r]))):"href"===r&&"#"===d[e.id].a_attr[r]?(d[e.id].a_attr.href=i[t].a_attr.href,c&&c.attr("href",i[t].a_attr.href)):"class"===r&&(d[e.id].a_attr.class=i[t].a_attr.class+" "+d[e.id].a_attr.class,c&&c.addClass(i[t].a_attr[r]))}}return!0}},R.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(e,t){return e+" ("+t+")"}},R.jstree.plugins.unique=function(e,f){this.check=function(e,t,i,o,n){if(!1===f.check.call(this,e,t,i,o,n))return!1;if(t=t&&t.id?t:this.get_node(t),(i=i&&i.id?i:this.get_node(i))&&i.children){for(var s,a="rename_node"===e?o:t.text,r=[],l=this.settings.unique.case_sensitive,c=this.settings.unique.trim_whitespace,d=this._model.data,h=0,u=i.children.length;h<u;h++)s=d[i.children[h]].text,l||(s=s.toLowerCase()),c&&(s=s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),r.push(s);switch(l||(a=a.toLowerCase()),c&&(a=a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),e){case"delete_node":return!0;case"rename_node":return s=t.text||"",l||(s=s.toLowerCase()),c&&(s=s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),(h=-1===R.inArray(a,r)||t.text&&s===a)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+a+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),h;case"create_node":return(h=-1===R.inArray(a,r))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+a+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),h;case"copy_node":return(h=-1===R.inArray(a,r))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+a+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),h;case"move_node":return(h=t.parent===i.id&&(!n||!n.is_multi)||-1===R.inArray(a,r))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+a+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:o,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),h}}return!0},this.create_node=function(e,t,i,o,n){if(!t||t.text===E){if(null===e&&(e=R.jstree.root),!(e=this.get_node(e)))return f.create_node.call(this,e,t,i,o,n);if(!(i=i===E?"last":i).toString().match(/^(before|after)$/)&&!n&&!this.is_loaded(e))return f.create_node.call(this,e,t,i,o,n);t=t||{};for(var s,a,r=this._model.data,l=this.settings.unique.case_sensitive,c=this.settings.unique.trim_whitespace,d=this.settings.unique.duplicate,h=s=this.get_string("New node"),u=[],p=0,m=e.children.length;p<m;p++)a=r[e.children[p]].text,l||(a=a.toLowerCase()),c&&(a=a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),u.push(a);for(p=1,a=h,l||(a=a.toLowerCase()),c&&(a=a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));-1!==R.inArray(a,u);)a=h=d.call(this,s,++p).toString(),l||(a=a.toLowerCase()),c&&(a=a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));t.text=h}return f.create_node.call(this,e,t,i,o,n)}},b.createElement("DIV"));if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",R.jstree.plugins.wholerow=function(e,s){this.bind=function(){s.bind.call(this),this.element.on("ready.jstree set_state.jstree",function(){this.hide_dots()}.bind(this)).on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-wholerow-ul")}.bind(this)).on("deselect_all.jstree",function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")}.bind(this)).on("changed.jstree",function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");for(var i=!1,o=0,n=t.selected.length;o<n;o++)(i=this.get_node(t.selected[o],!0))&&i.length&&i.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("open_node.jstree",function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("hover_node.jstree dehover_node.jstree",function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")}.bind(this)).on("contextmenu.jstree",".jstree-wholerow",function(e){var t;this._data.contextmenu&&(e.preventDefault(),t=R.Event("contextmenu",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY}),R(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t))}.bind(this)).on("click.jstree",".jstree-wholerow",function(e){e.stopImmediatePropagation();var t=R.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});R(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).trigger("focus")}).on("dblclick.jstree",".jstree-wholerow",function(e){e.stopImmediatePropagation();var t=R.Event("dblclick",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});R(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).trigger("focus")}).on("click.jstree",".jstree-leaf > .jstree-ocl",function(e){e.stopImmediatePropagation();var t=R.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});R(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).trigger("focus")}.bind(this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1}.bind(this)).on("mouseleave.jstree",".jstree-node",function(e){this.dehover_node(e.currentTarget)}.bind(this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),s.teardown.call(this)},this.redraw_node=function(e,t,i,o){var n;return(e=s.redraw_node.apply(this,arguments))&&(n=p.cloneNode(!0),-1!==R.inArray(e.id,this._data.core.selected)&&(n.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===e.id&&(n.className+=" jstree-wholerow-hovered"),e.insertBefore(n,e.childNodes[0])),e}},window.customElements&&Object&&Object.create){e=Object.create(HTMLElement.prototype);e.createdCallback=function(){var e,t={core:{},plugins:[]};for(e in R.jstree.plugins)R.jstree.plugins.hasOwnProperty(e)&&this.attributes[e]&&(t.plugins.push(e),this.getAttribute(e)&&JSON.parse(this.getAttribute(e))&&(t[e]=JSON.parse(this.getAttribute(e))));for(e in R.jstree.defaults.core)R.jstree.defaults.core.hasOwnProperty(e)&&this.attributes[e]&&(t.core[e]=JSON.parse(this.getAttribute(e))||this.getAttribute(e));R(this).jstree(t)};try{window.customElements.define("vakata-jstree",function(){},{prototype:e})}catch(e){}}}var m,f,g,_,y,v});"use strict";var licence_code={academic:"academic",commercial:"commercial"},feedback_code={agree1:"accepted (1)",agree2:"accepted (2)",decline:"declined"},userdata_action={none:"none",chpwd:"chpwd",revise:"revise"},role_code={user:"user",admin:"admin",developer:"developer"},on_login={all_projects:"all_projects",my_projects:"my_projects",last_folder:"last_folder",last_project:"last_project"},__local_user_id="localuser";function UserData(){this._type="UserData",this.name="",this.email="",this.login="",this.licence="",this.feedback="",this.pwd="",this.cloudrun_id="",this.knownSince="",this.lastSeen="",this.role=role_code.user,this.dormant=0,this.volume="***",this.helpTopics=[],this.authorisation={},this.settings={onlogin:on_login.all_projects,viewers_size:[1.4,.97],jobdlg_size:[1.25,.85],project_prefix:!1,guided_import:!0,notifications:{end_of_job:{send:!0,lapse:24}}},this.action=userdata_action.none,this.onlogin_message=""}function getRandomToken(){return Math.random().toString(36).substring(2,6)+"-"+Math.random().toString(36).substring(2,6)+"-"+Math.random().toString(36).substring(2,6)+"-"+Math.random().toString(36).substring(2,6)}function checkUserData(e){var t="";return e.hasOwnProperty("action")||(e.action=userdata_action.revise),e.hasOwnProperty("feedback")||(e.feedback=""),e.feedback.length<=0&&(e.action=userdata_action.revise,t="<li>choose suitable <b>feedback agreement</b></li>"),e.action!=userdata_action.none&&t.length<=0&&(t=e.action==userdata_action.chpwd?"<li>change your <b>password</b></li>":"<li>confirm your account details</li>"),e.hasOwnProperty("authorisation")||(e.authorisation={}),e.hasOwnProperty("cloudrun_id")&&e.cloudrun_id||(e.cloudrun_id=getRandomToken()),e.hasOwnProperty("settings")||(e.settings={project_prefix:!1}),e.settings.hasOwnProperty("onlogin")?Object.values(on_login).includes(e.settings.onlogin)||(e.settings.onlogin=on_login.all_projects):(e.settings.onlogin=on_login.all_projects,e.settings.viewers_size=[1.4,.97],e.settings.jobdlg_size=[1.25,.85]),e.settings.hasOwnProperty("notifications")||(e.settings.notifications={end_of_job:{send:!0,lapse:24}}),e.settings.hasOwnProperty("guided_import")||(e.settings.guided_import=!0),e.hasOwnProperty("volume")||(e.volume="***"),e.hasOwnProperty("dormant")||(e.dormant=0),e.hasOwnProperty("onlogin_message")||(e.onlogin_message=""),e.hasOwnProperty("admin")&&(e.hasOwnProperty("role")||(e.admin?e.role=role_code.admin:e.role=role_code.user),delete e.admin),t}"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.licence_code=licence_code,module.exports.feedback_code=feedback_code,module.exports.userdata_action=userdata_action,module.exports.role_code=role_code,module.exports.__local_user_id=__local_user_id,module.exports.UserData=UserData,module.exports.checkUserData=checkUserData);var __conf=null;function __isArchive(){return __conf?__conf.isArchive():__is_archive}"undefined"!=typeof module&&void 0!==module.exports&&(__conf=require("../js-server/server.configuration"));var start_mode={auto:"auto",standard:"standard",expert:"expert",migrate:"migrate"},tasklist_mode={basic:"basic",full:"full"},folder_type={user:"user",common:"common",shared:"shared",joined:"joined",all_projects:"all_projects",list:"list",custom_list:"custom_list",archived:"archived",cloud_archive:"cloud_archive",tutorials:"tutorials"},folder_path={shared:"Projects shared by me",joined:"Projects joined by me",all_projects:"All projects",archived:"Projects archived by me",cloud_archive:"CCP4 Cloud Archive",tutorials:"Tutorials"},folder_name={shared:"Projects shared by me",joined:"Projects joined by me",all_projects:"All projects",archived:"Projects archived by me",cloud_archive:"CCP4 Cloud Archive",tutorials:"Tutorials"};function ProjectDesc(){this._type="ProjectDesc",this.name="",this.title="",this.owner={login:"",name:"",email:"",labels:{}},this.share={},this.folderPath="",this.archive=null,this.jobCount=0,this.timestamp=0,this.autorun=!1,this.startmode=start_mode.standard,this.tasklistmode=tasklist_mode.full,this.disk_space=0,this.cpu_time=0,this.njobs=0,this.dateCreated="",this.dateLastUsed="",this.metrics={}}function isProjectAccessible(e,t){return!("owner"in t)||(!("login"in t.owner)||(!t.owner.login||(t.owner.login==e||("localuser"==t.owner.login||(!(!t.archive||!t.archive.in_archive)||e in t.share)))))}function isProjectJoined(e,t){return t.owner.login!=e&&0<Object.keys(t.share).length}function isProjectShared(e,t){return(t.owner.login==e||!e)&&0<Object.keys(t.share).length}function getProjectAuthor(e){var t=e.owner.login;return t="author"in e.owner&&e.owner.author?e.owner.author:t}function inArchive(e){return e.archive&&e.archive.in_archive}function addProjectLabel(e,t,i){e==t.owner.login?t.owner.labels[i]=1:e in t.share&&(t.share[e].labels[i]=1)}function removeProjectLabel(e,t,i){e==t.owner.login?delete t.owner.labels[i]:e in t.share&&delete t.share[e].labels[i]}function renameProjectLabel(e,t,i,o){e==t.owner.login&&i in t.owner.labels?(delete t.owner.labels[i],t.owner.labels[o]=1):e in t.share&&i in t.share[e].labels&&(delete t.share[e].labels[i],t.share[e].labels[o]=1)}function checkProjectLabel(e,t,i){return e==t.owner.login?i in t.owner.labels:e in t.share&&i in t.share[e].labels}function compareProjectLabels(e,t,i){var o={},n={},s=(t.owner.login==e?o=t.owner.labels:e in t.share&&(o=t.share[e].labels),i.owner.login==e?n=i.owner.labels:e in i.share&&(n=i.share[e].labels),Object.keys(o)),a=s.length==Object.keys(n).length;if(a)for(var r=0;r<s.length&&a;r++)a=s[r]in n;return a}function ProjectList(e){this._type="ProjectList",this.projects=[],this.current="",this.startmode=start_mode.auto,this.sortList=null,this.seedFolders(e)}function folderPathTitle(e,t,i){var o=e.path,t=t+"'s ";if(o.startsWith(t))o=o.replace(t,"My ");else switch(e.type){case folder_type.shared:o=folder_name.shared;break;case folder_type.joined:o=folder_name.joined;break;case folder_type.all_projects:o=folder_name.all_projects;break;case folder_type.archived:o=folder_name.archived;break;case folder_type.cloud_archive:o=folder_name.cloud_archive;break;case folder_type.tutorials:o=folder_name.tutorials}return o=0<i&&o.length>i?"&hellip; "+o.substr(o.length-i+3):o}function _print_folder(e){console.log(" - "+e.path+"("+e.nprojects+")");for(var t=0;t<e.folders.length;t++)_print_folder(e.folders[t])}function printFolders(e){console.log(" ======================================================== "),console.log(" Project Folders");for(var t=0;t<e.folders.length;t++)console.log("\n Folder #"+t),_print_folder(e.folders[t]);console.log("\n Current folder: "+e.currentFolder.path+"\n "),console.log(" ======================================================== ")}function _find_project_folder(e,t){for(var i=null,o=0;o<e.length&&!i;o++)i=e[o].path==t?e[o]:_find_project_folder(e[o].folders,t);return i}function findProjectFolder(e,t){return _find_project_folder(e.folders,t)}function ProjectData(){this._type="ProjectData",this.desc=new ProjectDesc,this.tree=[],this.settings={},this.settings.prefix_key=0,this.settings.prefix=""}function __find_project_node(e,t){if(e.dataId==t)return e;for(var i=null,o=0;o<e.children.length&&!i;o++)i=__find_project_node(e.children[o],t);return i}function getProjectNode(e,t){for(var i=null,o=0;o<e.tree.length&&!i;o++)i=__find_project_node(e.tree[o],t);return i}function __delete_project_node(e,t){for(var i=[],o=0;o<e.length;o++)if(e[o].dataId!=t)e[o].children=__delete_project_node(e[o].children,t),i.push(e[o]);else for(var n=0;n<e[o].children.length;n++)i.push(e[o].children[n]);return i}function deleteProjectNode(e,t){e.tree=__delete_project_node(e.tree,t)}function __find_project_node_branch(e,t){if(e.dataId==t)return[e];for(var i=[],o=0;o<e.children.length&&i.length<=0;o++)i=__find_project_node_branch(e.children[o],t);return 0<i.length&&i.push(e),i}function getProjectNodeBranch(e,t){var i=[];try{for(var o=0;o<e.tree.length&&i.length<=0;o++)i=__find_project_node_branch(e.tree[o],t)}catch(e){console.log(" +++++ exception in common.data_project.js:getProjectNodeBranch()")}return i}function __print_project_tree(e,t){console.log(t+"["+e.dataId+"] "+e.text);for(var i=0;i<e.children.length;i++)__print_project_tree(e.children[i],"--"+t)}function printProjectTree(e,t){console.log(" \n"+e+"\njobCount="+t.desc.jobCount);for(var i=0;i<t.tree.length;i++)__print_project_tree(t.tree[i],"--");console.log(" ")}function ProjectShare(){this._type="ProjectShare",this.shared_projects=[]}function DockData(){this._type="DockData",this.opened=!1,this.tasks=[]}ProjectDesc.prototype.init=function(e,t,i,o){this.name=e,this.title=t,this.dateCreated=o,this.dateLastUsed=o,this.startmode=i,this.startmode==start_mode.standard||this.startmode==start_mode.expert?this.tasklistmode=tasklist_mode.full:this.tasklistmode=tasklist_mode.basic},ProjectList.prototype.seedFolders=function(e){e+="'s Projects";this.folders=[{name:e,path:e,nprojects:0,type:folder_type.user,folders:[]},{name:folder_name.shared,path:folder_path.shared,nprojects:0,type:folder_type.shared,folders:[]},{name:folder_name.joined,path:folder_path.joined,nprojects:0,type:folder_type.joined,folders:[]},{name:folder_name.all_projects,path:folder_path.all_projects,nprojects:0,type:folder_type.all_projects,folders:[]}],__isArchive()&&(this.folders.push({name:folder_name.archived,path:folder_path.archived,nprojects:0,type:folder_type.archived,folders:[]}),this.folders.push({name:folder_name.cloud_archive,path:folder_path.cloud_archive,nprojects:0,type:folder_type.cloud_archive,folders:[]})),this.setCurrentFolder(this.folders[0])},ProjectList.prototype.getRootFolderName=function(e,t){var i="???";if(e<this.folders.length)switch(i=this.folders[e].name,this.folders[e].type){case folder_type.user:this.folders[e].path.startsWith(t+"'s ")&&(i="My Projects");break;case folder_type.tutorials:i="<i>Tutorials</i>";break;case folder_type.common:break;default:i="<i>"+i+"</i>"}return i},ProjectList.prototype._add_folder_path=function(e,t,i,o,n){if(t<e.length){for(var s=-1,a=0;a<i.length&&s<0;a++)e[t]==i[a].name&&(s=a);if(s<0){for(var s=i.length,r=e[0],a=1;a<=t;a++)r+="/"+e[a];var l=folder_type.common,l=(n?l=folder_type.custom_list:0==t&&(l=folder_type.tutorials,r!=folder_path.tutorials&&r!=folder_type.custom_list&&(l=folder_type.user)),{name:e[t],path:r,type:l,nprojects:0,folders:[]});i.push(l)}t==e.length-1&&(i[s].nprojects=o),this._add_folder_path(e,t+1,i[s].folders,o,n)}},ProjectList.prototype.addFolderPath=function(e,t,i){this._add_folder_path(e.split("/"),0,this.folders,t,i)},ProjectList.prototype._reset_folders=function(e){for(var t=0;t<e.length;t++)e[t].nprojects=0,this._reset_folders(e[t].folders)},ProjectList.prototype._get_folder_list=function(e){for(var t=[],i=4,o=i=__isArchive()?6:i;o<this.folders.length;o++)this.folders[o].type==e&&t.push(this.folders[o]);for(var n,o=0;o<t.length;o++)for(var s=o+1;s<t.length;s++)t[s].name<t[o].name&&(n=t[o],t[o]=t[s],t[s]=n);return t},ProjectList.prototype._set_folder_paths=function(e){for(var t=0;t<e.folders.length;t++)e.folders[t].path=e.path+"/"+e.folders[t].name,this._set_folder_paths(e.folders[t])},ProjectList.prototype.setFolderPaths=function(){for(var e=0;e<this.folders.length;e++)this._set_folder_paths(this.folders[e])},ProjectList.prototype.sortFolders=function(){var e=this._get_folder_list(folder_type.custom_list),t=this._get_folder_list(folder_type.tutorials),i=this._get_folder_list(folder_type.user),o=4;__isArchive()&&(o=6);for(var n=0;n<e.length;n++)this.folders[o++]=e[n];for(n=0;n<t.length;n++)this.folders[o++]=t[n];for(n=0;n<i.length;n++)this.folders[o++]=i[n]},ProjectList.prototype.resetFolders=function(e){var t=4,i=(__isArchive()&&(t=6),(!("folders"in this)||this.folders.length<t||!this.folders[0].name.startsWith(e+"'s ")||this.folders[0].type!=folder_type.user||this.folders[1].type!=folder_type.shared||this.folders[2].type!=folder_type.joined||this.folders[3].type!=folder_type.all_projects||6==t&&(this.folders[4].type!=folder_type.archived||this.folders[5].type!=folder_type.cloud_archive)||6!=t&&6<=this.folders.length&&this.folders[4].type==folder_type.archived&&this.folders[5].type==folder_type.cloud_archive)&&this.seedFolders(e),this.folders);this.folders=this.folders.slice(0,t);for(var o=t;o<i.length;o++)i[o].type==folder_type.custom_list&&this.folders.push(i[o]);this._reset_folders(this.folders);for(var n,s={},a={},r=0,l=0,c=0,d=0,h=0,o=0;o<this.projects.length;o++){var u=this.projects[o];if(u.archive&&u.archive.in_archive)e==u.owner.login?d++:h++;else{c++;var p,m=u.folderPath,m=(m in s?s[m]++:s[m]=1,isProjectJoined(e,u)&&l++,isProjectShared(e,u)&&r++,{});for(p in u.owner.login==e?m=u.owner.labels:e in u.share&&(m=u.share[e].labels),m)p in a?a[p]++:a[p]=1}}for(n in this.folders[1].nprojects=r,this.folders[2].nprojects=l,this.folders[3].nprojects=c,4<t&&(this.folders[4].nprojects=d,this.folders[5].nprojects=h),s)this.addFolderPath(n,s[n],!1);for(n in a)this.addFolderPath(n,a[n],!0);this.setFolderPaths(),this.sortFolders(),"currentFolder"in this&&this.currentFolder?this.setCurrentFolder(this.findFolder(this.currentFolder.path)):this.setCurrentFolder(this.folders[0])},ProjectList.prototype.setCurrentFolder=function(e){return e?(this.currentFolder={name:e.name,path:e.path,type:e.type,nprojects:e.nprojects},!0):!(this.currentFolder={name:this.folders[0].name,path:this.folders[0].path,type:this.folders[0].type,nprojects:this.folders[0].nprojects})},ProjectList.prototype._rename_folders=function(e,t,i){for(var o=0;o<e.length;o++)e[o].path.startsWith(t)&&(e[o].path=e[o].path.replace(t,i)),this._rename_folders(e[o].folders,t,i)},ProjectList.prototype.renameFolders=function(e,t){this._rename_folders(this.folders,e,t)},ProjectList.prototype.renameProjectPaths=function(e,t,i){for(var o=0;o<this.projects.length;o++)this.projects[o].folderPath.startsWith(t)&&(this.projects[o].folderPath=this.projects[o].folderPath.replace(t,i))},ProjectList.prototype.findFolder=function(e){return findProjectFolder(this,e)},ProjectList.prototype.isProject=function(e){for(var t=!1,i=0;i<this.projects.length&&!t;i++)t=this.projects[i].name==e;return t},ProjectList.prototype.getProjectNo=function(e){for(var t=-1,i=0;i<this.projects.length&&t<0;i++)this.projects[i].name==e&&(t=i);return t},ProjectList.prototype.getProject=function(e){for(var t=null,i=0;i<this.projects.length&&!t;i++)this.projects[i].name==e&&(t=this.projects[i]);return t},ProjectList.prototype.addProject=function(e,t,i,o){var n;return!this.isProject(e)&&((n=new ProjectDesc).init(e,t,i,o),n.folderPath=this.currentFolder.path,0<=[folder_path.all_projects,folder_path.shared,folder_path.joined].indexOf(n.folderPath)&&(n.folderPath=__login_id+"'s Projects"),this.projects.unshift(n),this.current=e,this.startmode=i,!(this.sortList=null))},ProjectList.prototype.renameProject=function(e,t,i){e=this.getProject(e);return e?(e.title=t,e.dateLastUsed=i,e):null},ProjectList.prototype.deleteProject=function(e){var t=[];this.current=e;for(var i=0;i<this.projects.length;i++)this.current||(this.current=this.projects[i].name),this.projects[i].name!=e?t.push(this.projects[i]):this.current="";!this.current&&0<t.length&&(this.current=t.length-1),this.projects=t},ProjectList.prototype.removeProjectLabels=function(e,t){for(var i=0;i<this.projects.length;i++)removeProjectLabel(e,this.projects[i],t)},ProjectList.prototype.renameProjectLabels=function(e,t,i){for(var o=0;o<this.projects.length;o++)renameProjectLabel(e,this.projects[o],t,i)},ProjectShare.prototype.removeShare=function(e){var t=this.shared_projects;this.shared_projects=[];for(var i=0;i<t.length;i++)e.name==t[i].name&&e.owner.login==t[i].owner.login||this.shared_projects.push(t[i]);return t.length-this.shared_projects.length},ProjectShare.prototype.addShare=function(e){for(var t=!1,i=0;i<this.shared_projects.length&&!t;i++)t=e.name==this.shared_projects[i].name&&e.owner.login==this.shared_projects[i].owner.login;return t||this.shared_projects.push(e),!t},"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.start_mode=start_mode,module.exports.tasklist_mode=tasklist_mode,module.exports.folder_type=folder_type,module.exports.folder_path=folder_path,module.exports.ProjectDesc=ProjectDesc,module.exports.ProjectList=ProjectList,module.exports.ProjectData=ProjectData,module.exports.getProjectNode=getProjectNode,module.exports.deleteProjectNode=deleteProjectNode,module.exports.printProjectTree=printProjectTree,module.exports.getProjectNodeBranch=getProjectNodeBranch,module.exports.ProjectShare=ProjectShare,module.exports.DockData=DockData,module.exports.isProjectAccessible=isProjectAccessible,module.exports.isProjectJoined=isProjectJoined,module.exports.isProjectShared=isProjectShared,module.exports.getProjectAuthor=getProjectAuthor,module.exports.compareProjectLabels=compareProjectLabels,module.exports.inArchive=inArchive);var facility_names={icat:"icat"},cmd;function FacilityFile(){this._type="FacilityFile",this.id="",this.name="",this.size="",this.date=""}function FacilityDir(){this._type="FacilityDir",this.name="",this.size="",this.dirs=[],this.files=[]}function FacilityDataset(){this._type="FacilityDataset",this.id="",this.path="",this.dirs=[],this.files=[]}function FacilityVisit(e,t,i){this._type="FacilityVisit",this.name=e,this.id=t,this.date=i,this.datasets=[]}function FacilityUser(e){this._type="FacilityUser",this.id=e,this.visits=[]}function Facility(){this._type="Facility",this.name="",this.title="",this.icon="",this.users=[]}function FacilityList(){this._type="FacilityList",this.facilities=[]}function StorageList(){this._type="StorageList",this.path="",this.name="",this.size=0,this.dirs=[],this.files=[],this.sectors=[]}function appName(){return"CCP4 Cloud"}FacilityFile.prototype.from_Object=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},FacilityDir.prototype.addFile=function(e,t,i){if(e==t.length-1){var o=new FacilityFile;o.id=i.id,o.name=t[e],o.size=i.size,o.date=i.date,this.files.push(o)}else{for(var n=null,s=0;s<this.dirs.length&&!n;s++)this.dirs[s].name==t[e]&&(n=this.dirs[s]);n||((n=new FacilityDir).name=t[e],this.dirs.push(n)),n.addFile(e+1,t,i)}},FacilityDir.prototype.from_Object=function(e){this.dirs=[];for(var t=e.dirs,i=0;i<t.length;i++){var o=new FacilityDir;o.from_Object(t[i]),this.dirs.push(o)}this.files=[];for(var n,s=e.files,i=0;i<s.length;i++){var a=new FacilityFile;a.from_Object(s[i]),this.files.push(a)}for(n in e)e.hasOwnProperty(n)&&"files"!=n&&"dirs"!=n&&(this[n]=e[n])},FacilityDataset.prototype.addFiles=function(e){var t=this.path.split("/");this.dirs=[],this.files=[];for(var i=0;i<e.length;i++){var o,n=e[i].name,s=n.split("/");if(1<s.length){var a=0;if(t.length<s.length)for(var r=0;r<t.length&&t[r]==s[r];r++)a++;if(a==s.length-1)n=s[a];else{for(var l=null,r=0;r<this.dirs.length&&!l;r++)this.dirs[r].name==s[a]&&(l=this.dirs[r]);l||((l=new FacilityDir).name=s[a],this.dirs.push(l)),l.addFile(a+1,s,e[i]),n=null}}n&&((o=new FacilityFile).id=e[i].id,o.name=n,o.size=e[i].size,o.date=e[i].date,this.files.push(o))}},FacilityDataset.prototype.from_Object=function(e){this.dirs=[];for(var t=e.dirs,i=0;i<t.length;i++){var o=new FacilityDir;o.from_Object(t[i]),this.dirs.push(o)}this.files=[];for(var n,s=e.files,i=0;i<s.length;i++){var a=new FacilityFile;a.from_Object(s[i]),this.files.push(a)}for(n in e)e.hasOwnProperty(n)&&"files"!=n&&"dirs"!=n&&(this[n]=e[n])},FacilityVisit.prototype.addDatasets=function(e){this.datasets=[];for(var t,i=0;i<e.length;i++)0<e[i].files.length&&((t=new FacilityDataset).id=e[i].id,t.path=e[i].path,t.addFiles(e[i].files),this.datasets.push(t))},FacilityVisit.prototype.from_Object=function(e){this.datasets=[];for(var t,i=e.datasets,o=0;o<i.length;o++){var n=new FacilityDataset;n.from_Object(i[o]),this.datasets.push(n)}for(t in e)e.hasOwnProperty(t)&&"datasets"!=t&&(this[t]=e[t])},FacilityUser.prototype.getVisit=function(e){for(var t=null,i=0;i<this.visits.length&&!t;i++)this.visits[i].id==e&&(t=this.visits[i]);return t},FacilityUser.prototype.addVisits=function(e,t,i){var o=[];if(e)for(var n=0;n<e.length;n++){var s=(s=this.getVisit(t[n]))||new FacilityVisit(e[n],t[n],i[n]);o.push(s)}this.visits=o},FacilityUser.prototype.from_Object=function(e){this.visits=[];for(var t,i=e.visits,o=0;o<i.length;o++){var n=new FacilityVisit("","","");n.from_Object(i[o]),this.visits.push(n)}for(t in e)e.hasOwnProperty(t)&&"visits"!=t&&(this[t]=e[t])},Facility.prototype.getUser=function(e){for(var t=null,i=0;i<this.users.length&&!t;i++)this.users[i].id==e&&(t=this.users[i]);return t},Facility.prototype.addVisits=function(e,t,i,o){var n=this.getUser(e);n||(n=new FacilityUser(e),this.users.push(n)),n.addVisits(t,i,o)},Facility.prototype.from_Object=function(e){this.users=[];for(var t,i=e.users,o=0;o<i.length;o++){var n=new FacilityUser("");n.from_Object(i[o]),this.users.push(n)}for(t in e)e.hasOwnProperty(t)&&"users"!=t&&(this[t]=e[t])},FacilityList.prototype.getFacility=function(e){for(var t=null,i=0;i<this.facilities.length&&!t;i++)this.facilities[i].name==e&&(t=this.facilities[i]);return t},"undefined"!=typeof module&&void 0!==module.exports?(cmd=require("./common.commands"),FacilityList.prototype.addFacility=function(e,t){var i;return!this.getFacility(e)&&((i=new Facility).name=e,i.title=t,e==facility_names.icat&&(i.icon=cmd.image_path("facility_icat")),this.facilities.push(i),!0)}):FacilityList.prototype.addFacility=function(e,t){var i;return!this.getFacility(e)&&((i=new Facility).name=e,i.title=t,e==facility_names.icat&&(i.icon=image_path("facility_icat")),this.facilities.push(i),!0)},FacilityList.prototype.addVisits=function(e,t,i,o,n){e=this.getFacility(e);e&&e.addVisits(t,i,o,n)},FacilityList.prototype.addDatasets=function(e,t,i,o){var e=this.getFacility(e);e&&(e=e.getUser(t))&&(t=e.getVisit(i))&&t.addDatasets(o)},FacilityList.prototype.to_JSON=function(){return JSON.stringify(this)},FacilityList.prototype.from_JSON=function(e){this.facilities=[];for(var t,i=JSON.parse(e),o=i.facilities,n=0;n<o.length;n++){var s=new Facility;s.from_Object(o[n]),this.facilities.push(s)}for(t in i)i.hasOwnProperty(t)&&"facilities"!=t&&(this[t]=i[t])},"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.facility_names=facility_names,module.exports.FacilityFile=FacilityFile,module.exports.FacilityDir=FacilityDir,module.exports.FacilityDataset=FacilityDataset,module.exports.FacilityVisit=FacilityVisit,module.exports.FacilityUser=FacilityUser,module.exports.Facility=Facility,module.exports.FacilityList=FacilityList,module.exports.StorageList=StorageList);var jsCoFE_version="1.7.011 [22.02.2023]";function appVersion(){return jsCoFE_version}function splitVersion(e){var t,e=e.replace("[",".").replace("]","").split(".").map(function(e){return parseInt(e)});return 6==e.length&&(t=e[5],e[5]=e[3],e[3]=t),e}function compareVersions(e,t){var i=splitVersion(e),o=splitVersion(t);return function e(t){return t>=i.length||t>=o.length?0:i[t]<o[t]?-1:i[t]>o[t]?1:e(t+1)}(0)}var localhost_name="localhost",projectFileExt=".ccp4cloud",endJobFName="__end_job",endJobFName1="stop_file",fe_command={cofe:"cofe",ignore:"ignore",stop:"stop",whoareyou:"whoareyou",status:"status",getInfo:"=getinfo",getClientInfo:"=getclientinfo",register:"=register",login:"=login",recoverLogin:"=recover_login",request:"=request",upload:"=upload",jobFinished:"=job_finished",cloudRun:"=cloud_run",checkSession:"=check_session",authResponse:"=auth_response",getFEProxyInfo:"=getfeproxyinfo",checkAnnouncement:"=checkannouncement",control:"=control"},fe_reqtype={logout:"-logout",getUserData:"-getUserData",saveHelpTopics:"-saveHelpTopics",updateUserData:"-updateUserData",updateUData_admin:"-updateUData_admin",deleteUser:"-deleteUser",deleteUser_admin:"-deleteUser_admin",retireUser_admin:"-retireUser_admin",resetUser_admin:"-resetUser_admin",updateAndRestart:"-updateAndRestart",getUserRation:"-getUserRation",getProjectList:"-getProjectList",getDockData:"-getDockData",getSharedPrjList:"-getSharedPrjList",deleteProject:"-deleteProject",saveProjectList:"-saveProjectList",saveDockData:"-saveDockData",getProjectData:"-getProjectData",saveProjectData:"-saveProjectData",preparePrjExport:"-preparePrjExport",checkPrjExport:"-checkPrjExport",finishPrjExport:"-finishPrjExport",startDemoImport:"-startDemoImport",startSharedImport:"-startSharedImport",archiveProject:"-archiveProject",accessArchivedPrj:"-accessArchivedPrj",checkPrjImport:"-checkPrjImport",finishPrjImport:"-finishPrjImport",prepareJobExport:"-prepareJobExport",checkJobExport:"-checkJobExport",finishJobExport:"-finishJobExport",prepareFJobExport:"-prepareFJobExport",checkFJobExport:"-checkFJobExport",finishFJobExport:"-finishFJobExport",renameProject:"-renameProject",cloneProject:"-cloneProject",checkCloneProject:"-checkCloneProject",importProject:"-importProject",shareProject:"-shareProject",saveJobData:"-saveJobData",saveJobFile:"-saveJobFile",runJob:"-runJob",replayJob:"-replayJob",stopJob:"-stopJob",webappEndJob:"-webappEndJob",checkJobs:"-checkJobs",wakeZombieJobs:"-wakeZombieJobs",getJobFile:"-getJobFile",getAdminData:"-getAdminData",getAnalytics:"-getAnalytics",sendAnnouncement:"-sendAnnouncement",manageDormancy:"-manageDormancy",getUserKnowledge:"-getUserKnowledge",getCloudFileTree:"-getCloudFileTree",updateFacility:"-updateFacility",checkFclUpdate:"-checkFclUpdate"},fe_retcode={ok:"ok",largeData:"largeData",noProjectData:"noProjectData",writeError:"writeError",mkDirError:"mkDirError",readError:"readError",jobballError:"jobballError",existingLogin:"existingLogin",corruptDO:"corruptDO",userNotFound:"userNotFound",userNotDeleted:"userNotDeleted",corruptJobMeta:"corruptJobMeta",wrongLogin:"wrongLogin",suspendedLogin:"suspendedLogin",unconfigured:"unconfigured",wrongPassword:"wrongPassword",notLoggedIn:"notLoggedIn",wrongRequest:"wrongRequest",wrongSession:"wrongSession",uploadErrors:"uploadErrors",unpackErrors:"unpackErrors",noUploadDir:"noUploadDir",noTempDir:"noTempDir",noJobDir:"noJobDir",noJobRunning:"noJobRunning",fileNotFound:"fileNotFound",inProgress:"inProgress",askPassword:"askPassword",regFailed:"regFailed",wrongJobToken:"wrongJobToken",proxyError:"proxyError",projectAccess:"projectAccess",serverInactive:"serverInactive",errors:"errors"},nc_command={stop:"stop",countBrowser:"-countBrowser",runJob:"-runJob",stopJob:"-stopJob",wakeZombieJobs:"-wakeZombieJobs",selectDir:"-selectDir",selectFile:"-selectFile",selectImageDir:"-selectImageDir",runRVAPIApp:"-runRVAPIApp",runClientJob:"-runClientJob",getNCInfo:"-getNCInfo"},nc_retcode={ok:"ok",unkCommand:"unkCommand",mkDirError:"mkDirError",selDirError:"selDirError",uploadErrors:"uploadErrors",downloadErrors:"downloadErrors",fileErrors:"fileErrors",unpackErrors:"unpackErrors",wrongRequest:"wrongRequest",jobNotFound:"jobNotFound",pidNotFound:"pidNotFound"};function image_path(e){return"./images_png/"+e+".png"}function activityIcon(){return"./images_com/activity.gif"}var __special_url_tag="xxJsCoFExx",__special_fjsafe_tag="xxFJSafexx",__special_client_tag="xxClientxx";function Response(e,t,i){this._type="Response",this.version=appVersion(),this.status=e,this.message=t,this.data=i}function sendResponse(e,t,i,o){new Response(t,i,o).send(e)}function sendResponseMessage(e,t,i){e.writeHead(200,{"Content-Type":i,"Access-Control-Allow-Origin":"*"}),e.end(t)}function Request(e,t,i){this._type="Request",this.version=appVersion(),this.request=e,this.token=t,this.data=i}Response.prototype.send=function(e){e.writeHead(200,{"Content-Type":"text/plain","Access-Control-Allow-Origin":"*"}),e.end(JSON.stringify(this))},"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.appName=appName,module.exports.appVersion=appVersion,module.exports.localhost_name=localhost_name,module.exports.image_path=image_path,module.exports.activityIcon=activityIcon,module.exports.fe_command=fe_command,module.exports.fe_reqtype=fe_reqtype,module.exports.fe_retcode=fe_retcode,module.exports.nc_command=nc_command,module.exports.nc_retcode=nc_retcode,module.exports.__special_url_tag=__special_url_tag,module.exports.__special_fjsafe_tag=__special_fjsafe_tag,module.exports.__special_client_tag=__special_client_tag,module.exports.projectFileExt=projectFileExt,module.exports.endJobFName=endJobFName,module.exports.endJobFName1=endJobFName1,module.exports.Response=Response,module.exports.sendResponse=sendResponse,module.exports.sendResponseMessage=sendResponseMessage,module.exports.Request=Request);var _taskIndex={0:{type:"Root",after:[]},A:{type:"TaskCCP4go",after:["0"]},A1:{type:"TaskMigrate",after:["0"]},A2:{type:"TaskImportReplace",after:[]},B:{type:"TaskImport",after:["0","B","B1","C","D","E","m"]},B1:{type:"TaskImportSeqCP",after:["0","B","B1","C","D","E","m"]},B2:{type:"TaskStructurePrediction",after:["B","B1","m"]},C:{type:"TaskEnsemblePrepSeq",after:["B","B1","m"]},D:{type:"TaskEnsemblePrepXYZ",after:["B","B1","C","m"]},D1:{type:"TaskModelPrepXYZ",after:["B","B1","C","m"]},D2:{type:"TaskModelPrepAlgn",after:["B","B1","C","m"]},D3:{type:"TaskEnsembler",after:["D1","D2"]},D4:{type:"TaskModelPrepMC",after:["B","B1","C","m"]},D5:{type:"TaskSlice",after:["B","B1","C","m"]},E:{type:"TaskMakeLigand",after:["B","B1","C","D","E","m"]},E1:{type:"TaskCrosSec",after:["B","m"]},E2:{type:"TaskWFlowAMR",after:["0","B"]},E3:{type:"TaskWFlowAEP",after:["0","B"]},E4:{type:"TaskWFlowDPL",after:["0","B"]},E5:{type:"TaskWFlowSMR",after:["0","B"]},E6:{type:"TaskWFlowAFMR",after:["0","B"]},F:{type:"TaskAimless",after:["B","F"]},F1:{type:"TaskAuspex",after:["B","F","v","m"]},F2:{type:"TaskSRF",after:[]},G:{type:"TaskSimbad",after:["B","B1","C","D","E","F","h","m","t","u"]},H:{type:"TaskASUDef",after:["B","B1","C","D","D1","D2","D3","E","F","h","m","t","u"]},I:{type:"TaskXyz2Revision",after:["B","B1","C","D","E","F","h","m","t","u"]},J:{type:"TaskMorda",after:["H"]},K:{type:"TaskBalbes",after:["H"]},L:{type:"TaskMrBump",after:["H"]},L1:{type:"TaskAmple",after:[]},L2:{type:"TaskArcimboldoLite",after:[]},L3:{type:"TaskArcimboldoBorges",after:[]},L4:{type:"TaskArcimboldoShredder",after:[]},L5:{type:"TaskSliceNDice",after:["H"]},M:{type:"TaskPhaserMR",after:["H","M"]},N:{type:"TaskMolrep",after:["H","N"]},O:{type:"TaskShelxEMR",after:["M","N"]},P:{type:"TaskCrank2",after:["H","J","K","L","M","N"]},Q:{type:"TaskShelxAuto",after:["H","J","K","L","M","N"]},R:{type:"TaskShelxSubstr",after:["H","J","K","L","M","N"]},S:{type:"TaskPhaserEP",after:["R","p"]},T:{type:"TaskParrot",after:["J","K","L","M","N","O","R","S"]},U:{type:"TaskBuccaneer",after:["J","K","L","M","N","O","S","T","n"]},U1:{type:"TaskNautilus",after:["J","K","L","M","N","O","S","T","n"]},U2:{type:"TaskModelCraft",after:["J","K","L","M","N","O","S","T","n"]},U3:{type:"TaskAWNuce",after:["J","K","L","M","N","O","S","T","n"]},V:{type:"TaskRefmac",after:["M","N","O","P","Q","U","U1","j","r"]},V1:{type:"TaskBuster",after:["M","N","O","P","Q","U","U1","j","r"]},V2:{type:"TaskWFlowREL",after:["M","N","O","P","Q","U","U1","j","r"]},W:{type:"TaskLorestr",after:["U","V","r"]},X:{type:"TaskFitLigand",after:["V","W","X","U","U1","r"]},Y:{type:"TaskFitWaters",after:["V","W","X","U","U1","r"]},Z:{type:"TaskZanuda",after:["V","W"]},a:{type:"TaskGesamt",after:["U","U1","V","W","r"]},b:{type:"TaskPISA",after:["V","W","X"]},b1:{type:"TaskContact",after:["V","W","X"]},b2:{type:"TaskRotamer",after:["V","W","X"]},b3:{type:"TaskAreaimol",after:["V","W","X"]},c:{type:"TaskChangeSpGHKL",after:["h","t","u"]},c2:{type:"TaskChangeSpGASU",after:["H"]},c2:{type:"TaskFreeRFlag",after:[]},c1:{type:"TaskChangeReso",after:["h","t","u"]},d:{type:"TaskEditRevisionASU",after:[]},d1:{type:"TaskEditRevisionStruct",after:[]},d2:{type:"TaskEditRevision",after:[]},e:{type:"TaskASUDefStruct",after:["A"]},f:{type:"TaskSeqAlign",after:["B","B1","m"]},f1:{type:"TaskFindMySequence",after:["G"]},g:{type:"TaskFacilityImport",after:[]},h:{type:"TaskXia2",after:["0"]},i:{type:"TaskDimple",after:["M","N","O","P","Q","U","r"]},j:{type:"TaskCootMB",after:["V","W","i","U","r"]},j1:{type:"TaskCombStructure",after:["V","W","i","U","r"]},k:{type:"TaskDeposition",after:["V","V1"]},l:{type:"TaskCootCE",after:[]},l1:{type:"TaskGemmi",after:[]},l1:{type:"TaskXyzUtils",after:[]},m:{type:"TaskCloudImport",after:["0","B","B1","C","D","E","m"]},n:{type:"TaskAcorn",after:["J","K","L","M","N","O","R","S"]},o:{type:"TaskArpWarp",after:["J","K","L","M","N","O","S","T","n","T"]},p:{type:"TaskShelxCD",after:["H","J","K","L","M","N"]},q:{type:"TaskSymMatch",after:[]},r:{type:"TaskCCP4Build",after:["J","K","L","M","N","O","S"]},s:{type:"TaskLsqKab",after:["U","V","W","r"]},t:{type:"TaskDUI",after:["0"]},u:{type:"TaskIMosflm",after:["0"]},v:{type:"TaskImportPDB",after:["0","B","B1","C","D","E","m"]},w:{type:"TaskEnsemblePrepMG",after:["B","B1","D","m"]},x:{type:"TaskXDSGUI",after:["0"]}};function getTasksFromTaskIndex(e){var t,i=[];for(t in _taskIndex)0<=_taskIndex[t].after.indexOf(e)&&i.push(_taskIndex[t].type);return i}var _revTaskIndex=null;function getTaskKeyFromType(e){if(!_revTaskIndex)for(var t in _revTaskIndex={},_taskIndex)_revTaskIndex[_taskIndex[t].type]=t;return e in _revTaskIndex?_revTaskIndex[e]:"0"}function getTaskKey(e){return e?getTaskKeyFromType(e._type):"0"}function addWfKnowledgeByTypes(e,t,i){for(var o="",n=0;n<3;n++)o=n<i.length?getTaskKeyFromType(i[n])+o:getTaskKeyFromType("Root")+o;var t=getTaskKeyFromType(t),s=null;o in e?t in(s=e[o])?s[t]++:s[t]=1:((s={})[t]=1,e[o]=s)}var _wfKnowledge={};function getWfKnowledgeFromTypes(e,t,i){var e=getTaskKeyFromType(e),t=getTaskKeyFromType(t),i=getTaskKeyFromType(i),e=e+t+i,o={counts:[]};o.tasks=getTasksFromTaskIndex(i);for(var n=0;n<o.tasks.length;n++)o.counts.push(1);if(e in _wfKnowledge){var s,a,r,l=_wfKnowledge[e];for(s in l)s in _taskIndex&&("Root"!=(a=_taskIndex[s].type)&&(0<=(r=o.tasks.indexOf(a))?o.counts[r]+=l[s]:(o.tasks.push(a),o.counts.push(l[s]))))}return o}function getWfKnowledge(e,t,i){var o="0",n="0",s="0";return getWfKnowledgeFromTypes(o=e?e._type:o,n=t?t._type:n,s=i?i._type:s)}function loadKnowledge(e){serverRequest(fe_reqtype.getUserKnowledge,0,e,function(e){_wfKnowledge=e},function(){},"persist")}function addWfKnowledge(e,t){for(var i=[],o=0;o<t.length;o++)i.push(t[o]._type);addWfKnowledgeByTypes(_wfKnowledge,e._type,i)}function mapExcludeKey(e,t){var i,o={};for(i in e)i!=t&&(o[i]=e[i]);return o}function mapMaskIn(e,t){var i,o={};for(i in e)i in t&&(o[i]=e[i]);return o}function mapMaskOut(e,t){var i,o={};for(i in e)i in t||(o[i]=e[i]);return o}function padDigits(e,t){return Array(Math.max(t-String(e).length+1,0)).join(0)+e}function round(e,t){try{return Number(Number(e).toFixed(t))}catch(e){return 0}}function padStringLeft(e,t,i){for(var o=e;o.length<i;)o=t+o;return o}function padStringRight(e,t,i){for(var o=e,n=Math.abs(i);o.length<n;)o+=t;return i<0&&o.length>n?o.substring(0,n):o}"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.addWfKnowledgeByTypes=addWfKnowledgeByTypes);var __regexp_int=/^(-?[0-9]+\d*)$|^0$/,__regexp_float=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;function isInteger(e){return __regexp_int.test(e)}function isFloat(e){return __regexp_float.test(e)}function isObject(e){return 0<=Object.prototype.toString.call(e).indexOf(" Object]")}function shallowCopy(e){if(!e)return e;var t,i={};for(t in e)e.hasOwnProperty(t)&&!isObject(e[t])&&(i[t]=e[t]);return i}function replaceAll(e,t,i){return e.split(t).join(i)}function strip_html_tags(e){return e?e.toString().replace(/<[^>]*>/g,""):""}function startsWith(e,t){return 0===e.lastIndexOf(t,0)}function endsWith(e,t){return-1!==e.indexOf(t,e.length-t.length)}function getBasename(e){return e.split(/[\\/]/).pop()}function getDateString(){var e=new Date,t=e.getDate().toString();return t.length<2&&(t="0"+t),(t=e.getMonth()+1+"-"+t).length<5&&(t="0"+t),e.getFullYear()+"-"+t}"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.mapExcludeKey=mapExcludeKey,module.exports.mapMaskIn=mapMaskIn,module.exports.mapMaskOut=mapMaskOut,module.exports.padDigits=padDigits,module.exports.padStringLeft=padStringLeft,module.exports.padStringRight=padStringRight,module.exports.isInteger=isInteger,module.exports.isObject=isObject,module.exports.isFloat=isFloat,module.exports.replaceAll=replaceAll,module.exports.startsWith=startsWith,module.exports.round=round,module.exports.getDateString=getDateString);var _chem_elements=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Db","Sg","Bh","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og"];function checkElementSymbol(e){for(var t=e.toUpperCase(),i=null,o=0;o<_chem_elements.length&&!i;o++)_chem_elements[o].toUpperCase()==t&&(i=_chem_elements[o]);return i}var _sg_class_list=[["P 4 3 2","P 41 3 2","P 42 3 2","P 43 3 2"],["I 4 3 2","I 41 3 2"],["F 4 3 2","F 41 3 2"],["P 2 3","P 21 3"],["I 2 3","I 21 3"],["F 2 3"],["P 4 2 2","P 4 21 2","P 41 2 2","P 41 21 2","P 42 2 2","P 42 21 2","P 43 2 2","P 43 21 2"],["P 4","P 41","P 42","P 43"],["I 4 2 2","I 41 2 2"],["I 4","I 41"],["P 6 2 2","P 61 2 2","P 62 2 2","P 63 2 2","P 64 2 2","P 65 2 2"],["P 6","P 61","P 62","P 63","P 64","P 65"],["P 3 2 1","P 31 2 1","P 32 2 1"],["P 3 1 2","P 31 1 2","P 32 1 2"],["P 3","P 31","P 32"],["H 3 2"],["H 3"],["P 2 2 2","P 21 2 2","P 2 21 2","P 2 2 21","P 2 21 21","P 21 2 21","P 21 21 2","P 21 21 21"],["C 2 2 2","C 2 2 21"],["I 2 2 2","I 21 21 21"],["F 2 2 2"],["P 1 2 1","P 1 21 1"],["C 1 2 1"],["I 1 2 1"],["P 1"]],_sg_enantimorph_list=[["P 41 3 2","P 43 3 2"],["P 41 2 2","P 43 2 2"],["P 41 21 2","P 43 21 2"],["P 41","P 43"],["P 61 2 2","P 65 2 2"],["P 62 2 2","P 64 2 2"],["P 61","P 65"],["P 62","P 64"],["P 31 2 1","P 32 2 1"],["P 31 1 2","P 32 1 2"],["P 31","P 32"]],_sg_indistinguishable_list=[["I 2 3","I 21 3"],["I 2 2 2","I 21 21 21"]];function getAllPointSpG(e){for(var t=[],i=0;i<_sg_class_list.length;i++)if(0<=_sg_class_list[i].indexOf(e)){t=_sg_class_list[i];break}return t}function getEnantiomorphSpG(e){for(var t=null,i=0;i<_sg_enantimorph_list.length;i++){var o=_sg_enantimorph_list[i].indexOf(e);if(0<=o){t=_sg_enantimorph_list[i][(o+1)%2];break}}return t}function getIndistinguishableSpG(e){for(var t=null,i=0;i<_sg_indistinguishable_list.length;i++){var o=_sg_indistinguishable_list[i].indexOf(e);if(0<=o){t=_sg_indistinguishable_list[i][(o+1)%2];break}}return t}function get_cons_sg_list(e){for(var t=[],i=0;i<_sg_class_list.length;i++){var o=_sg_class_list[i].indexOf(e);if(0<=o){(t=_sg_class_list[i].slice(0)).splice(o,1);for(var n=0;n<_sg_enantimorph_list.length;n++)if(0<=(r=_sg_enantimorph_list[n].indexOf(e))){var s=t.indexOf(_sg_enantimorph_list[n][(r+1)%2]),a=t[0];t[0]=t[s]+" (enantiomorph)",0<s&&(t[s]=a);break}for(var r,n=0;n<_sg_indistinguishable_list.length;n++)if(0<=(r=_sg_indistinguishable_list[n].indexOf(e))){s=t.indexOf(_sg_indistinguishable_list[n][(r+1)%2]),a=t[0];t[0]=t[s]+" (indistinguishable)",0<s&&(t[s]=a);break}break}}return t}var __maintainerEmail="ccp4@ccp4.ac.uk",__login_token="",__login_id="",__login_user="",__user_settings={},__user_role=role_code.user,__user_licence="",__dormant=0,__ccp4_version="",__current_page=null,__current_project=null,__current_folder={name:"My Projects",path:"My Projects",nprojects:0,type:folder_type.user,folders:[]},__local_setup=!1,__is_archive=!1,__offline_message="off",__cloud_storage=!1,__demo_projects=!1,__url_parameters=null,__jobs_safe=!1,__fe_url="",__auth_software=null,__user_authorisation=null,__environ_server=[],__environ_client=[],__tips=null,__mobile_device=/Android|webOS|BlackBerry/i.test(navigator.userAgent),__iOS_device=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||navigator.maxTouchPoints&&2<navigator.maxTouchPoints&&/MacIntel/.test(navigator.platform),__any_mobile_device=__mobile_device||__iOS_device,__browser_checked=!1;function checkBrowser(){__browser_checked=!0}function report_problem(e,t,i){t=encodeURIComponent("CCP4 Cloud Report\nLogin ID   : "+__login_id+"\nLogin Name : "+__login_user+"\nLocal setup: "+__local_setup+"\nPage       : "+__current_page._type+"\n----------------------------------------------------------------\n"+t),i=(i=i)||appName()+" maintainer";return'<a href="mailto:'+__maintainerEmail+"?subject="+encodeURIComponent(e)+"&body="+t+'"><span style="color:blue">'+i+"</span></a>"}function isFullScreen(){return void 0!==document.fullscreen?document.fullscreen:void 0!==document.mozFullScreen?document.mozFullScreen:void 0!==document.webkitIsFullScreen?document.webkitIsFullScreen:void 0!==document.msFullscreenElement?document.msFullscreenElement:-1}function setFullScreen(){var e;isFullScreen()||((e=document.documentElement).requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen())}function quitFullScreen(){var e=isFullScreen();-1!=e&&e&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())}function toggleFullScreen(){var e=isFullScreen();-1==e?alert("Full Screen Mode is not supported"):(e?quitFullScreen:setFullScreen)()}$(window).resize(function(){__current_page&&__current_page.onResize(window.innerWidth,window.innerHeight)});var __check_job_interval=8e3,__persistence_level=100,__suggested_task_prob=.03,__suggested_task_nmin=3,__task_reference_base_url="./manuals/html-taskref/",__user_guide_base_url="./manuals/html-userguide/",__dev_reference_base_url="./manuals/html-dev/",__tutorials_base_url="./manuals/html-tutorials/";function __object_to_instance(key,value){if(!value)return value;if(!value.hasOwnProperty("_type"))return value;var obj=eval("new "+value._type+"()"),property;for(property in value)obj[property]=value[property];return obj}function getObjectInstance(e){return JSON.parse(e,__object_to_instance)}var client_code={ccp4:"ccp4",ccpem:"ccpem"},__client=client_code.ccp4;function setClientCode(e){__client=e}function getClientCode(){return __client}function getClientName(){switch(__client){default:case client_code.ccp4:return"CCP4";case client_code.ccpem:return"CCPEM"}return"CCP4"}function getFEURL(){return window.location.protocol+"//"+window.location.host+window.location.pathname}var __doNotShowList=[];function doNotShowAgain(e,t){t=t.replace(/^.*\/|\.[^.]*$/g,"");return 0==e?__doNotShowList.indexOf(t)<0&&__doNotShowList.indexOf("*")<0:(1==e&&__doNotShowList.indexOf(t)<0&&(__doNotShowList.push(t),(e={}).helpTopics=__doNotShowList,serverRequest(fe_reqtype.saveHelpTopics,e,"Do not show again",null,null,"persist")),!1)}var cofe_signals={taskReady:"task_ready",jobStarted:"job_started",treeUpdated:"tree_updated",reloadTree:"reload_tree",makeProjectList:"make_project_list",jobDialogOpened:"job_dialog_opened",rationUpdated:"ration_updated",jobDlgSignal:"job_dlg_signal",uploadEvent:"uploadEvent"};function validateUserData(e,t,i){var o="";return e.getValue().length<=0&&(o+="<b>User name</b> must be provided.<p>"),t.getValue().length<=0?o+="<b>E-mail address</b> must be provided.<p>":t.element.validity.typeMismatch&&(o+="<b>E-mail address</b> should the correct one. Your temporary<br>password will be sent to the e-mail provided.<p>"),i.getValue().length<=0?o+="<b>Login name</b> must be provided.<p>":i.element.validity.patternMismatch&&(o+="<b>Login name</b> should contain only latin letters, numbers,<br> undescores, dashes and dots, and must start with a letter.<p>"),o}function makeCommErrorMessage(e,t,i){switch(i.status){case fe_retcode.readError:case fe_retcode.jobballError:MessageDataReadError(e,i.message);break;case fe_retcode.noProjectData:MessageNoProjectDataError(e,i.message);break;case fe_retcode.writeError:MessageDataWriteError(e,i.message);break;case fe_retcode.mkDirError:MessageMkDirError(e,i.message);break;case fe_retcode.notLoggedIn:t!=fe_reqtype.logout&&logout(__current_page.element.id,0,function(){MessageNotLoggedIn(e)});break;case fe_retcode.uploadErrors:MessageUploadErrors(e,i.message);break;case fe_retcode.noJobDir:MessageNoJobDir(e);break;case fe_retcode.proxyError:MessageProxyError(e);break;case fe_retcode.projectAccess:MessageProjectAccess(e);break;case fe_retcode.serverInactive:MessageServerInactive();break;case fe_retcode.fileNotFound:MessageFileNotFound(i.message);break;default:MessageUnknownError(e,'"'+i.message+'"')}}function checkVersionMatch(e,t){var i=appVersion().split(" ")[0],o=e.version.split(" "),n=o[0];if(!t&&"*"!=e.version)if(i!=n&&"client"==o[o.length-1]){if(i.split(".")[1]!=n.split(".")[1])return t="",t=n<i?"Please update CCP4 setup on your computer":"The maintainer of your "+appName()+" setup should update the setup<br>to the latest version",new MessageBox("Incompatible Client Version","<h2>Incompatible Client Version</h2>Your device runs "+appName()+" Client version <b>"+o[0]+" "+o[1]+"</b>,<br>which is not compatible with version <b>"+appVersion()+"</b>, running<br>on the server.<p>"+t+".<p>You may use "+appName()+" by using the direct web-link, however,<br><i>Coot</i> and other graphical applications will not be available.","msg_excl"),!1}else if(i<n)return new MessageBoxF(appName()+" update","<center>"+appName()+" has advanced to version<br><center><sup>&nbsp;</sup><b><i>"+e.version+"</i></b><sub>&nbsp;</sub></center>which is incompatible with version<br><center><sup>&nbsp;</sup><b><i>"+appVersion()+"</b></i><sub>&nbsp;</sub></center>you are currently using.<hr/>"+appName()+" will now update in your browser, which will end the current login<br>session. Please login again after update; your projects and data should<br>be safe, however, you may find that you cannot clone some old tasks.<hr/></center>","Update",function(){location.reload()},!0,"msg_excl"),!1;return!0}function makeJSONString(e){var t=null;try{t=JSON.stringify(e)}catch(e){new MessageBox("Unsuitable data",'<div style="width:500px"><h2>Unsuitable data</h2><p>Unsuitable data encountered when sending data to '+appName()+" server. Usually this is caused by using symbols from a non-Latin alphabet or rare special characters.<p>Try repeating your actions making sure that your keyboard is on English register. If this does not help, close this page or tab in your browser and log on "+appName()+" again. Ultimately, contact "+appName()+" support.</div>","msg_error")}return t}var __server_queue=[],__local_queue=[],__server_queue_id=1,__delays_ind=null,__delays_timer=null,__delays_wait=1e3,__holdup_dlg=null,__holdup_timer=null,__holdup_wait=2e4,__communication_ind=null;function clearNetworkIndicators(){__delays_timer&&window.clearTimeout(__delays_timer),__communication_ind=__delays_timer=__delays_ind=null}function __process_network_indicators(){0<__server_queue.length?__communication_ind&&!__communication_ind.isVisible()&&__communication_ind.fade(!0):__delays_ind&&(__delays_timer&&(window.clearTimeout(__delays_timer),__delays_timer=null),__delays_ind.isVisible()&&__delays_ind.hide(),__holdup_timer&&(window.clearTimeout(__holdup_timer),__holdup_timer=null),__holdup_dlg&&(__holdup_dlg.close(),__holdup_dlg=null),__communication_ind.isVisible()&&__communication_ind.fade(!1))}var __check_session_drops=0;function processServerQueue(){var q0;0<__server_queue.length&&(q0=__server_queue[0],"waiting"==q0.status&&(q0.status="running","command"==q0.type?__server_command(q0.cmd,q0.data_obj,q0.page_title,q0.function_response,q0.function_always,q0.function_fail,q0.id):__server_request(q0.request_type,q0.data_obj,q0.page_title,q0.function_ok,q0.function_always,q0.function_fail,q0.id)),!__delays_ind||__delays_ind.isVisible()||__delays_timer||(__delays_timer=window.setTimeout(function(){__delays_ind.show()},__delays_wait),__holdup_timer=window.setTimeout(function(){__holdup_timer=null,0<__server_queue.length&&"command"==__server_queue[0].type&&__server_queue[0].request_type==fe_command.checkSession&&__check_session_drops<10?(__check_session_drops++,__server_queue.shift(),__process_network_indicators(),processServerQueue()):__holdup_dlg=new QuestionBox("Communication hold-up",'<div style="width:450px"><h3>Communication hold-up</h3>Communication with '+appName()+" is severely delayed. Please be patient, the problem may resolve in few moments, after which this dialog will disappear automatically.<p>If communication does not resume after a long time, you can either reload the current page (quick option) or start new working session (complete refresh, hard option) using buttons below.<p>Make sure that your Internet connection is stable.",[{name:"Reload current page",onclick:function(){__holdup_dlg=null,window.setTimeout(function(){__current_page?(__server_queue=[],__process_network_indicators(),makePage(eval("new "+__current_page._type+' ( "'+__current_page.sceneId+'" );')),makeSessionCheck(__current_page.sceneId)):reloadBrowser()},100)}},{name:"Start new working session",onclick:function(){reloadBrowser()}}],"msg_system")},__holdup_wait)))}function processLocalQueue(){var e;0<__local_queue.length&&("waiting"==(e=__local_queue[0]).status&&(e.status="running",local_command(e.cmd,e.data_obj,e.command_title,e.function_response)))}function __server_command(o,e,n,s,t,i,a){e=makeJSONString(e);e&&$.ajax({url:o,async:!0,type:"POST",data:e,timeout:1e6,dataType:"text"}).done(function(t){if(0<__server_queue.length&&a==__server_queue[0].id){__server_queue.shift(),__process_network_indicators();try{var e,i=jQuery.parseJSON(t);checkVersionMatch(i,!1)&&(e=jQuery.extend(!0,new Response,i),s(e)||makeCommErrorMessage(n,o,e))}catch(e){console.log(" >>> error catch in __server_command.done: "+e),console.log(" >>> rdata = "+t)}processServerQueue()}else console.log(" >>> return on skipped operation in __server_command.done"),console.log(" >>> rdata = "+t)}).always(function(){__check_session_drops=0,t&&t()}).fail(function(e,t){0<__server_queue.length&&a==__server_queue[0].id?(__server_queue.shift(),__process_network_indicators(),i?i():MessageAJAXFailure(n,e,t),processServerQueue()):console.log(" >>> return on skipped operation in __server_command.fail")})}function __server_request(o,e,n,s,a,r,l){var t=makeJSONString(new Request(o,__login_token,e));function c(i){$.ajax({url:fe_command.request,async:!0,type:"POST",data:t,processData:!1,timeout:1e6,dataType:"text"}).done(function(e){var t;0<__server_queue.length&&l==__server_queue[0].id?(__server_queue.shift(),__process_network_indicators(),checkVersionMatch(e=jQuery.parseJSON(e),!1)&&((t=jQuery.extend(!0,new Response,e)).status==fe_retcode.ok?s&&s(t.data):makeCommErrorMessage(n,o,t)),processServerQueue()):console.log(" >>> return on skipped operation in __server_request.done"),a&&a(0,t.data)}).always(function(){__check_session_drops=0}).fail(function(e,t){if(0<__server_queue.length&&l==__server_queue[0].id){__server_queue.shift(),__process_network_indicators();try{if(("string"==typeof r||r instanceof String)&&"persist"==r){if(0<i)return void c(i-1);MessageAJAXFailure(n,e,t)}else r?r():MessageAJAXFailure(n,e,t);a&&a(1,{})}catch(t){console.log(" >>> error catch in __server_request.fail: "+t)}processServerQueue()}else console.log(" >>> return on skipped operation in __server_request.fail")})}t&&c(__persistence_level)}function local_command(t,e,i,o){e=makeJSONString(e);__local_service&&e&&$.ajax({url:__local_service+"/"+t,async:!0,type:"POST",data:e,dataType:"text",crossDomain:!0,timeout:0}).done(function(e){var e=jQuery.parseJSON(e);checkVersionMatch(e,!0)&&(e=jQuery.extend(!0,new Response,e),o&&!o(e)&&makeCommErrorMessage(i,t,e))}).always(function(){__local_queue.shift(),processServerQueue()}).fail(function(e,t){o&&!o(null)&&MessageAJAXFailure(i,e,t)})}function serverCommand(e,t,i,o,n,s){__server_queue.push({status:"waiting",type:"command",id:__server_queue_id++,cmd:e,data_obj:t,page_title:i,function_response:o,function_always:n,function_fail:s}),__process_network_indicators(),processServerQueue()}function serverRequest(e,t,i,o,n,s){__server_queue.push({status:"waiting",type:"request",id:__server_queue_id++,request_type:e,data_obj:t,page_title:i,function_ok:o,function_always:n,function_fail:s}),__process_network_indicators(),processServerQueue()}function localCommand(e,t,i,o){__local_service?(__local_queue.push({status:"waiting",cmd:e,data_obj:t,command_title:i,function_response:o}),processLocalQueue()):o&&o(null)}function downloadFile(e){var t="hiddenDownloader",i=document.getElementById(t);i||((i=document.createElement("a")).id=t,i.style.display="none",i.type="application/octet-stream",document.body.appendChild(i)),i.download=e.split("/").pop(),i.href=e,i.click()}function fetchFile(e,t,i,o){var n=new XMLHttpRequest;n.onload=function(e){t(n.responseText),i&&i()},n.onerror=function(){o&&o("communication errors"),i&&i()},n.overrideMimeType("text/plain; charset=x-user-defined"),n.timeout=9999999,n.open("POST",e,!0);try{n.send(null)}catch(e){o&&o("general error")}}function fetchJobFile(e,t,i,o,n){fetchFile(e.getProjectURL(parseInt(t.split("-")[0],10),t),i,o,n)}function fetchJobOutputFile(e,t,i,o,n){fetchFile(e.getProjectURL(parseInt(t.split("-")[0],10),"output/"+t),i,o,n)}function getJobFileURL(e,t){var i=__special_url_tag+"/";return(i+=__login_token||"404")+"/"+__current_project+"/"+e+"/"+t}function downloadJobFile(e,t){downloadFile(getJobFileURL(e,t))}function onWindowMessage(e){var t=e.data;"saveFile"==t.command?serverRequest(fe_reqtype.saveJobFile,t,"Save file",function(e){e.project_missing?new MessageBox("Project not found",'<h3>Project "'+t.meta.project+'" is not found on server</h3>Project "'+t.meta.project+'" was shared with you, please check<br>whether it was deleted by project owner.',"msg_error"):new MessageBox("File saved",'<h3>File "'+t.fpath+'" saved</h3>File "'+t.fpath+'" saved in '+appName()+".","msg_ok")},null,"persist"):console.log("Unknown windows message command: "+t.command)}window.addEventListener?window.addEventListener("message",onWindowMessage,!1):window.attachEvent?window.attachEvent("onmessage",onWindowMessage,!1):alert("No Window messaging");var __id_cnt=0;function Widget(e){this.id=e+"_"+__id_cnt++,this.type=e,this.child=[],this.parent=null,this.element=document.createElement(e),this.element.setAttribute("id",this.id),this.element.setAttribute("name","name-"+this.id),this.element.style.fontSize="16px"}function __set_tooltip(e,t){var i;t&&(e.setAttribute("title",t),0<(i=1500*Math.sqrt(t.split(" ").length))&&$(e).tooltip({show:{effect:"slideDown",delay:1500},track:!0,content:function(e){e($(this).prop("title"))},open:function(e,t){setTimeout(function(){$(t.tooltip).hide("explode")},1500+i)}}))}function Grid(e){Widget.call(this,"table"),"None"!=e&&this.element.setAttribute("class","grid-layout"+e)}function Fieldset(e){Widget.call(this,"fieldset"),this.legend=new Widget("legend"),this.legend.setText(e),this.addWidget(this.legend)}function Label(e){Widget.call(this,"div"),this.setText(e)}function IconLabel(e,t){Widget.call(this,"div"),this.setIconLabel(e,t)}function InputText(e){Widget.call(this,"input"),this.element.setAttribute("type","text"),this.element.setAttribute("value",e)}function ACEditor(e,t,i){Widget.call(this,"div");e={position:"relative",width:e,height:t,border:"1px solid gray"},"border"in i&&(e.border=i.border),"box-shadow"in i&&(e["box-shadow"]=i["box-shadow"]),$(this.element).css(e),this.panel=new Widget("div"),this.element.appendChild(this.panel.element),t={position:"absolute",top:0,right:0,bottom:0,left:0,width:"100%","font-size":"14px"};"font-size"in i&&(t["font-size"]=i["font-size"]),$(this.panel.element).css(t),this.editor_theme="chrome",this.editor_mode="python","theme"in i&&(this.editor_theme=i.theme),"mode"in i&&(this.editor_mode=i.mode),this.editor=null}function TextArea(e,t,i,o){Widget.call(this,"textarea"),this.element.setAttribute("rows",i),this.element.setAttribute("cols",o),this.element.setAttribute("placeholder",t),this.element.value=e}function HLine(e){Widget.call(this,"hr"),0<e.length&&(this.element.style.height=e)}function Image(e,t,i){Widget.call(this,"img"),0<e.length&&this.element.setAttribute("src",e),0<t.length&&this.element.setAttribute("width",t),0<i.length&&this.element.setAttribute("height",i)}function Button(e,t){Widget.call(this,"button"),this.element.setAttribute("type","button"),this.div=document.createElement("div"),this.element.appendChild(this.div),this.click_count=1,this._set_button(e,t)}function ImageButton(e,t,i){Label.call(this," "),this.image=new Image(e,t,i),this.addWidget(this.image),this.setWidth(t),this.setHeight(i)}function setDefaultButton(t,e){t.element.style.fontWeight="bold",$(e.element).keydown(function(e){13==e.keyCode&&t.click()})}function unsetDefaultButton(e,t){e.element.style.fontWeight="normal",$(t.element).keydown()}function RadioSet(){Widget.call(this,"div"),this.name="radio_"+this.element.id,this.selected=""}function ProgressBar(e){Widget.call(this,"div"),0<e?$(this.element).progressbar({max:e,value:0}):$(this.element).progressbar({value:!1})}function SelectFile(e,t){Widget.call(this,"input"),this.element.setAttribute("type","file"),this.element.setAttribute("name","uploads[]"),e&&this.element.setAttribute("multiple","multiple"),t&&this.element.setAttribute("accept",t)}function ToolBar(){Grid.call(this,""),this.element.setAttribute("class","toolbar ui-widget-header ui-corner-all")}function IFrame(e){Widget.call(this,"iframe"),0<e.length&&this.element.setAttribute("src",e),$(this.element).css({border:"none"})}function Section(e,t){Widget.call(this,"div"),this.header=new Widget("h3"),this.titleId=this.id+"_title",this.header.element.innerHTML='<span id="'+this.titleId+'">'+e+"</span>",this.addWidget(this.header),this.body=new Widget("div"),this.addWidget(this.body),this.grid=new Grid(""),this.body.addWidget(this.grid);e={collapsible:!0,heightStyle:"content"};e.active=!!t&&0,$(this.element).accordion(e)}function Combobox(){Widget.call(this,"select"),this.selected_value=null,this.selected_text=null,this.onchange=null,this.width="auto"}function Checkbox(e,t){Widget.call(this,"label");var i="cbx-"+this.id;this.element.htmlFor=i,this.element.innerHTML=e.toString(),$(this.element).css({"white-space":"nowrap","text-align":"left"}),this.checkbox=document.createElement("input"),this.checkbox.setAttribute("type","checkbox"),this.checkbox.setAttribute("id",i),this.checkbox.setAttribute("name",i),this.element.appendChild(this.checkbox),this.checkbox.checked=t,$(this.checkbox).checkboxradio()}function RadioButton(e,t){Widget.call(this,"label");var i="cbx-"+this.id;this.element.htmlFor=i,this.element.innerHTML=e.toString(),$(this.element).css({"white-space":"nowrap"}),this.radio=document.createElement("input"),this.radio.setAttribute("type","radio"),this.radio.setAttribute("id",i),this.radio.setAttribute("name",i),$(this.element).css({"text-align":"left"}),this.element.appendChild(this.radio),this.radio.checked=t,$(this.radio).checkboxradio()}function Slider(e){Widget.call(this,"div"),$(this.element).slider({range:"max",min:0,max:e,value:0})}function Spinner(e,t,i,o){Widget.call(this,"div"),this.spinner=new Widget("input"),this.addWidget(this.spinner),this.minV=e,this.maxV=t,this.steps=[],this._lastV=0,$(this.spinner.element).spinner({min:e,max:t,step:i,page:o})}function MenuItem(e,t){Widget.call(this,"a"),this.setNoWrap(),0<t.length&&$(this.element).css({"background-image":'url("'+t+'")',"background-repeat":"no-repeat","background-size":"1.5em","background-position":"0.25em center"}),0<e.length?(this.text_div=new Widget("div"),this.text_div.element.innerHTML=e.toString(),$(this.text_div.element).css({"text-align":"left","white-space":"nowrap"}),0<t.length&&$(this.text_div.element).css({"margin-left":"1.5em"}),this.addWidget(this.text_div)):this.text_div=null,this.menu=null}Widget.prototype.setId=function(e){return this.id=e,this.element.setAttribute("id",this.id),this},Widget.prototype.delete=function(){$(this.element).empty(),$(this.element).remove()},Widget.prototype.setAttribute=function(e,t){return this.element.setAttribute(e,t),this},Widget.prototype.hasAttribute=function(e){return this.element.hasAttribute(e)},Widget.prototype.getAttribute=function(e){return this.element.getAttribute(e)},Widget.prototype.removeAttribute=function(e){return this.element.removeAttribute(e),this},Widget.prototype.setText=function(e){return this.element.innerHTML=e.toString(),this},Widget.prototype.addClass=function(e){return this.element.classList.add(e),this},Widget.prototype.removeClass=function(e){return this.element.classList.remove(e),this},Widget.prototype.toggleClass=function(e){return this.element.classList.toggle(e),this},Widget.prototype.setCursor=function(e){return $(this.element).css("cursor",e),this},Widget.prototype.setTooltip=function(e){return __set_tooltip(this.element,e),this},Widget.prototype.setTooltip1=function(e,t,i,o){return this.element.setAttribute("title",e),o<=0?$(this.element).tooltip({content:e,show:{effect:t},track:i}):$(this.element).tooltip({content:e,show:{effect:t},track:i,open:function(e,t){setTimeout(function(){$(t.tooltip).hide("explode")},o)}}),this},Widget.prototype.redraw=function(e){var t=this.element.display;this.element.display="none",this.element.offsetHeight,this.element.display=t},Widget.prototype.setWidth=function(e){return this.element.style.width=e,this},Widget.prototype.setWidth_px=function(e){return $(this.element).width(e),this},Widget.prototype.setHeight=function(e){return this.element.style.height=e,this},Widget.prototype.setMaxHeight=function(e){return this.element.style.maxHeight=e,this},Widget.prototype.setHeight_px=function(e){return $(this.element).height(e),this},Widget.prototype.setSize=function(e,t){return 0<e.length&&(this.element.style.width=e),0<t.length&&(this.element.style.height=t),this},Widget.prototype.setSize_px=function(e,t){return $(this.element).outerWidth(e),$(this.element).outerHeight(t),this},Widget.prototype.width_px=function(){return $(this.element).outerWidth()},Widget.prototype.height_px=function(){return $(this.element).outerHeight()},Widget.prototype.getBoundingRect=function(){return this.element.getBoundingClientRect()},Widget.prototype.setFontSize=function(e){return $(this.element).css({"font-size":e}),this},Widget.prototype.setFontBold=function(e){return this.element.style.fontWeight=e?"bold":"normal",this},Widget.prototype.setFontWeight=function(e){return this.element.style.fontWeight=e,this},Widget.prototype.setFontItalic=function(e){return this.element.style.fontStyle=e?"italic":"normal",this},Widget.prototype.setBackgroundColor=function(e){return this.element.style.backgroundColor=e,this},Widget.prototype.setFontColor=function(e){return this.element.style.color=e,this},Widget.prototype.setFontFamily=function(e){return this.element.style.fontFamily=e,this},Widget.prototype.setFontLineHeight=function(e){return this.element.style.lineHeight=e,this},Widget.prototype.setFont=function(e,t,i,o){return this.element.style.fontFamily=e,this.element.style.fontSize=t,this.element.style.fontWeight=i?"bold":"normal",this.element.style.fontStyle=o?"italic":"normal",this},Widget.prototype.setPaddings=function(e,t,i,o){var n={};return e&&(n["padding-left"]=e),t&&(n["padding-top"]=t),i&&(n["padding-right"]=i),o&&(n["padding-bottom"]=o),$(this.element).css(n),this},Widget.prototype.setMargins=function(e,t,i,o){var n={};return e&&(n["margin-left"]=e),t&&(n["margin-top"]=t),i&&(n["margin-right"]=i),o&&(n["margin-bottom"]=o),$(this.element).css(n),this},Widget.prototype.setScrollable=function(e,t){return 0<e.length&&$(this.element).css({"overflow-x":e}),0<t.length&&$(this.element).css({"overflow-y":t}),this},Widget.prototype.getScrollPosition=function(){return[this.element.scrollLeft,this.element.scrollTop]},Widget.prototype.setScrollPosition=function(e){this.element.scrollLeft=e[0],this.element.scrollTop=e[1]},Widget.prototype.setHorizontalAlignment=function(e){return $(this.element).css({"text-align":e}),this},Widget.prototype.setVerticalAlignment=function(e){return $(this.element).css({"vertical-align":e}),this},Widget.prototype.setNoWrap=function(){return $(this.element).css({"white-space":"nowrap"}),this},Widget.prototype.addWidget=function(e){return this.child.push(e),this.element.appendChild(e.element),e.parent=this},Widget.prototype.insertWidget=function(e,t){return this.child.splice(t,0,e),this.element.insertBefore(e.element,this.element.childNodes[t]),e.parent=this},Widget.prototype.removeChild=function(e){for(var t=[],i=0;i<this.child.length;i++)this.child[i].id==e.id?this.element.removeChild(e.element):t.push(this.child[i]);return this.child=t,this},Widget.prototype.removeAllChildren=function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);return this.child=[],this},Widget.prototype.empty=function(){return $(this.element).empty(),this},Widget.prototype.hide=function(){return $(this.element).hide(),this},Widget.prototype.show=function(){return $(this.element).show(),this},Widget.prototype.setVisible=function(e){return e?$(this.element).show():$(this.element).hide(),this},Widget.prototype.isVisible=function(){return $(this.element).is(":visible")},Widget.prototype.toggle=function(){return $(this.element).toggle(),this},Widget.prototype.setOpacity=function(e){return $(this.element).css({opacity:e}),this},Widget.prototype.fade=function(e){e?$(this.element).fadeIn():$(this.element).fadeOut()},Widget.prototype.setDisabled=function(e){return this.element.disabled=e,this},Widget.prototype.setEnabled=function(e){return this.element.disabled=!e,this},Widget.prototype.isEnabled=function(){return!this.element.disabled},Widget.prototype.isDisabled=function(){return this.element.disabled},Widget.prototype.setDisabledAll=function(e){var t;return $(this.element).find(":input").prop("disabled",e),t=this,window.setTimeout(function(){$(t.element).find(":input").prop("disabled",e)},0),this},Widget.prototype.setEnabledAll=function(e){var t;return $(this.element).find(":input").prop("disabled",!e),t=this,window.setTimeout(function(){$(t.element).find(":input").prop("disabled",!e)},0),this},Widget.prototype.addOnClickListener=function(t){return this.element.addEventListener("click",function(e){e.preventDefault(),t(e)}),this},Widget.prototype.addOnDblClickListener=function(t){return this.element.addEventListener("dblclick",function(e){e.preventDefault(),t(e)}),this},Widget.prototype.addOnRightClickListener=function(t){return this.element.addEventListener("contextmenu",function(e){return e.preventDefault(),t(e),!1},!1),this},Widget.prototype.addOnChangeListener=function(e){return this.element.addEventListener("change",e),this},Widget.prototype.addOnInputListener=function(e){return this.element.addEventListener("input",e),this},Widget.prototype.emitSignal=function(e,t){e=new CustomEvent(e,{detail:t});this.element.dispatchEvent(e)},Widget.prototype.postSignal=function(e,t,i){var o;o=this,window.setTimeout(function(){o.emitSignal(e,t)},i)},Widget.prototype.addSignalHandler=function(e,t){this.element.addEventListener(e,function(e){t(e.detail)},!1)},Widget.prototype.click=function(){this.element.click()},Grid.prototype=Object.create(Widget.prototype),Grid.prototype.constructor=Grid,Grid.prototype.clear=function(){this.element.innerHTML=" "},Grid.prototype.setStyle=function(e){"None"!=e&&this.element.setAttribute("class","grid-layout"+e)},Grid.prototype.hideRow=function(e){for(;this.element.rows.length<=e;)this.element.insertRow(-1);$(this.element.rows[e]).hide(),this.element.rows[e]._was_hidden=!0},Grid.prototype.showRow=function(e){for(;this.element.rows.length<=e;)this.element.insertRow(-1);$(this.element.rows[e]).show(),this.element.rows[e]._was_hidden=!1},Grid.prototype.wasRowHidden=function(e){return!(e>=this.element.rows.length)&&("_was_hidden"in this.element.rows[e]&&this.element.rows[e]._was_hidden)},Grid.prototype.setRowVisible=function(e,t){t?this.showRow(e):this.hideRow(e)},Grid.prototype.getCell=function(e,t){for(var i=this.element.rows.length;this.element.rows.length<=e;)this.element.insertRow(-1),this.element.rows[i].setAttribute("id",this.id+"__"+i),i++;var o=this.element.rows[e];if(0<=t){for(;o.cells.length<=t;)o.insertCell(-1);return o.cells[t]}return o},Grid.prototype.insertCell=function(e,t){this.getCell(e,t);e=this.element.rows[e];return e.insertCell(t),e.cells[t]},Grid.prototype.getNRows=function(){return this.element.rows.length},Grid.prototype.truncateRows=function(e){for(;this.element.rows.length>e+1;)this.element.deleteRow(-1);return this.element.rows.length},Grid.prototype.deleteRow=function(e){return this.element.deleteRow(e),this.element.rows.length},Grid.prototype.getNCols=function(){for(var e=0,t=0;t<this.element.rows.length;t++)e=Math.max(e,this.element.rows[t].cells.length);return e},Grid.prototype.setWidget=function(e,t,i,o,n){t=this.getCell(t,i);return t.rowSpan=o,t.colSpan=n,$(t).empty(),e&&(t.appendChild(e.element),e.parent=this),t},Grid.prototype.addWidget=function(e,t,i,o,n){t=this.getCell(t,i);return t.rowSpan=o,t.colSpan=n,e&&(t.appendChild(e.element),e.parent=this),t},Grid.prototype.insertWidget=function(e,t,i,o,n){t=this.insertCell(t,i);return t.rowSpan=o,t.colSpan=n,e&&(t.appendChild(e.element),e.parent=this),t},Grid.prototype.setSpan=function(e,t,i,o){e=this.getCell(e,t);return e.rowSpan=i,e.colSpan=o,e},Grid.prototype.setPanel=function(e,t,i,o){var n=new Widget("div");return this.setWidget(n,e,t,i,o),n},Grid.prototype.setFieldset=function(e,t,i,o,n){e=new Fieldset(e);return this.setWidget(e,t,i,o,n),e},Grid.prototype.setGrid=function(e,t,i,o,n){e=new Grid(e);return this.setWidget(e,t,i,o,n),e},Grid.prototype.setTable=function(e,t,i,o){var n=new Table;return this.setWidget(n,e,t,i,o),n},Grid.prototype.setButton=function(e,t,i,o,n,s){e=new Button(e,t);return this.setWidget(e,i,o,n,s),e},Grid.prototype.addButton=function(e,t,i,o,n,s){e=new Button(e,t);return this.addWidget(e,i,o,n,s),e},Grid.prototype.setRadioSet=function(e,t,i,o){var n=new RadioSet;return this.setWidget(n,e,t,i,o),this.setNoWrap(e,t),n},Grid.prototype.setLabel=function(e,t,i,o,n){e=new Label(e);return this.setWidget(e,t,i,o,n),e},Grid.prototype.addLabel=function(e,t,i,o,n){e=new Label(e);return this.addWidget(e,t,i,o,n),e},Grid.prototype.setIconLabel=function(e,t,i,o,n,s){e=new IconLabel(e,t);return this.setWidget(e,i,o,n,s),e},Grid.prototype.setInputText=function(e,t,i,o,n){e=new InputText(e);return this.setWidget(e,t,i,o,n),e},Grid.prototype.addInputText=function(e,t,i,o,n){e=new InputText(e);return this.addWidget(e,t,i,o,n),e},Grid.prototype.setTextArea=function(e,t,i,o,n,s,a,r){e=new TextArea(e,t,i,o);return this.setWidget(e,n,s,a,r),e},Grid.prototype.addTextArea=function(e,t,i,o,n,s,a,r){e=new TextArea(e,t,i,o);return this.addWidget(e,n,s,a,r),e},Grid.prototype.setHLine=function(e,t,i,o,n){e=new HLine(e);return this.setWidget(e,t,i,o,n),e},Grid.prototype.setImageButton=function(e,t,i,o,n,s,a){e=new ImageButton(e,t,i);return this.setWidget(e,o,n,s,a),e},Grid.prototype.setImage=function(e,t,i,o,n,s,a){e=new Image(e,t,i);return this.setWidget(e,o,n,s,a),e},Grid.prototype.setTree=function(e,t,i,o,n){e=new Tree(e);return this.setWidget(e,t,i,o,n),e},Grid.prototype.setProgressBar=function(e,t,i,o,n){e=new ProgressBar(e);return this.setWidget(e,t,i,o,n),e},Grid.prototype.setSelectFile=function(e,t,i,o,n,s){e=new SelectFile(e,t);return this.setWidget(e,i,o,n,s),e},Grid.prototype.setSection=function(e,t,i,o,n,s){e=new Section(e,t);return this.setWidget(e,i,o,n,s),e},Grid.prototype.setCombobox=function(e,t,i,o){var n=new Combobox;return this.setWidget(n,e,t,i,o),n},Grid.prototype.setCheckbox=function(e,t,i,o,n,s){e=new Checkbox(e,t);return this.setWidget(e,i,o,n,s),e},Grid.prototype.addCheckbox=function(e,t,i,o,n,s){e=new Checkbox(e,t);return this.addWidget(e,i,o,n,s),e},Grid.prototype.setIFrame=function(e,t,i,o,n){e=new IFrame(e);return this.setWidget(e,t,i,o,n),e},Grid.prototype.addIFrame=function(e,t,i,o,n){e=new IFrame(e);return this.addWidget(e,t,i,o,n),e},Grid.prototype.setCellSize=function(e,t,i,o){i=this.getCell(i,o);return 0<e.length&&(i.style.width=e),0<t.length&&(i.style.height=t),this},Grid.prototype.setFontFamily=function(e,t,i){e=this.getCell(e,t);return $(e).css({"font-family":i}),this},Grid.prototype.setNoWrap=function(e,t){return this.getCell(e,t).setAttribute("style","white-space: nowrap"),this},Grid.prototype.setHorizontalAlignment=function(e,t,i){e=this.getCell(e,t);return $(e).css({"text-align":i}),this},Grid.prototype.setVerticalAlignment=function(e,t,i){e=this.getCell(e,t);return $(e).css({"vertical-align":i}),this},Grid.prototype.setAlignment=function(e,t,i,o){e=this.getCell(e,t);return $(e).css({"text-align":o,"vertical-align":i}),this},Fieldset.prototype=Object.create(Widget.prototype),Fieldset.prototype.constructor=Fieldset,Label.prototype=Object.create(Widget.prototype),Label.prototype.constructor=Label,Label.prototype.setDocFromURL=function(e){return this.element.innerHTML='<object type="text/html" data="'+e+'" ></object>',this},Label.prototype.getText=function(){return this.element.innerHTML},IconLabel.prototype=Object.create(Widget.prototype),IconLabel.prototype.constructor=IconLabel,IconLabel.prototype.setIconLabel=function(e,t){this.element.innerHTML=e.toString(),0<t.length&&$(this.element).css({"text-align":"center","background-image":'url("'+t+'")',"background-repeat":"no-repeat","background-size":"22px","background-position":"0.5em center"})},IconLabel.prototype.setBackground=function(e){0<e.length&&$(this.element).css({"background-image":'url("'+e+'")'})},InputText.prototype=Object.create(Widget.prototype),InputText.prototype.constructor=InputText,InputText.prototype.setStyle=function(e,t,i,o){return i&&this.element.setAttribute("placeholder",i),o&&this.setTooltip(o),e&&this.element.setAttribute("type",e),t&&("integer"==t||"integer_"==t?this.element.setAttribute("pattern","^(-?[0-9]+d*)$|^0$"):"real"==t||"real_"==t?this.element.setAttribute("pattern","^[-+]?[0-9]*.?[0-9]+([eE][-+]?[0-9]+)?$"):this.element.setAttribute("pattern",t)),this},InputText.prototype.setType=function(e){return e&&this.element.setAttribute("type",e),this},InputText.prototype.setReadOnly=function(e){return this.element.readOnly=e,this},InputText.prototype.setMaxInputLength=function(e){return this.element.setAttribute("maxlength",e),this},InputText.prototype.setDisabled=function(e){return this.element.disabled=e,this},InputText.prototype.getValue=function(){return this.element.value},InputText.prototype.setValue=function(e){return this.element.value=e},InputText.prototype.setOnEnterListener=function(t){var i;i=this,$(i.element).keypress(function(e){13==e.keyCode&&t(i.getValue())})},ACEditor.prototype=Object.create(Widget.prototype),ACEditor.prototype.constructor=ACEditor,ACEditor.prototype.init=function(e,t){var i;this.editor||(this.editor=ace.edit(this.panel.element.id),i={mode:"ace/mode/"+this.editor_mode,theme:"ace/theme/"+this.editor_theme},t&&(i.placeholder=t),this.editor.setOptions(i),e&&this.setText(e))},ACEditor.prototype.setReadOnly=function(e){return this.editor&&this.editor.setReadOnly(e),this},ACEditor.prototype.addOnChangeListener=function(e){return this.editor&&this.editor.getSession().on("change",e),this},ACEditor.prototype.setText=function(e){this.editor&&(this.editor.setValue(e),this.editor.clearSelection())},ACEditor.prototype.getText=function(){return this.editor?this.editor.getValue():""},TextArea.prototype=Object.create(Widget.prototype),TextArea.prototype.constructor=TextArea,TextArea.prototype.getValue=function(){return this.element.value},HLine.prototype=Object.create(Widget.prototype),HLine.prototype.constructor=HLine,Image.prototype=Object.create(Widget.prototype),Image.prototype.constructor=Image,Image.prototype.setImage=function(e){0<e.length&&this.element.setAttribute("src",e)},Button.prototype=Object.create(Widget.prototype),Button.prototype.constructor=Button,Button.prototype._set_button=function(e,t){this.div.innerHTML=e.toString(),0<t.length&&($(this.div).css({"text-align":"center","margin-left":"1.2em"}),$(this.element).css({"background-image":'url("'+t+'")',"background-repeat":"no-repeat","background-size":"22px","background-position":"0.5em center"})),$(this.element).button()},Button.prototype.getText=function(){return this.div.innerHTML},Button.prototype.setButton=function(e,t){return this._set_button(e,t),this},Button.prototype.setIndicator=function(e,t){var e=new Image(e,"16px","16px"),i={position:"absolute"};switch(t){case 0:i.top="-4px",i.left="-8px";break;default:case 1:i.top="-4px",i.right="-8px";break;case 2:i.bottom="-12px",i.right="-8px";break;case 3:i.bottom="-12px",i.left="-8px"}$(e.element).css(i),this.addWidget(e)},Button.prototype.setText=function(e){return this._set_button(e,""),this},Button.prototype.setIcon=function(e){$(this.element).css({"background-image":'url("'+e+'")'})},Button.prototype.setDisabled=function(e){try{$(this.element).button("option","disabled",e)}catch(e){}return this},Button.prototype.setEnabled=function(e){try{$(this.element).button("option","disabled",!e)}catch(e){}return this},Button.prototype.isDisabled=function(){try{return $(this.element).button("option","disabled")}catch(e){}},Button.prototype.setSize=function(e,t){var i=parseInt(e),o=parseInt(t),n=Math.min(i,o),i=(i-(n-=2*Math.max(1,Math.floor(n/8))))/2.25;return 0<this.div.innerHTML.length&&(i=Math.min((o-n)/2,i)),$(this.element).css({"background-size":n+"px","background-position":i+"px"}),Widget.prototype.setSize.call(this,e,t)},Button.prototype.setSize_px=function(e,t){return $(this.element).css({"background-size":t-4+"px"}),this.element.style.width=e+"px",this.element.style.height=t+"px",this},Button.prototype.addOnClickListener=function(e){var t;return(t=this).element.addEventListener("click",function(){0<t.click_count&&(t.click_count=0,e(),window.setTimeout(function(){t.click_count=1},1e3))}),this},ImageButton.prototype=Object.create(Label.prototype),ImageButton.prototype.constructor=ImageButton,ImageButton.prototype.setImage=function(e){this.image.setImage(e)},RadioSet.prototype=Object.create(Widget.prototype),RadioSet.prototype.constructor=RadioSet,RadioSet.prototype.addButton=function(e,t,i,o){var n=this.element.id+"_"+t,s=new Widget("label"),e=(s.element.setAttribute("for",n),s.element.innerHTML=e.toString(),this.addWidget(s),i&&s.setTooltip(i),new Widget("input"));return e.element.setAttribute("type","radio"),e.setId(n),e.radioID=t,e.element.setAttribute("name",this.name),o&&(e.element.setAttribute("checked","checked"),this.selected=t),this.addWidget(e),this},RadioSet.prototype.make=function(t){var i=this;function o(){for(var e=0;e<i.child.length;e++)"input"==i.child[e].type&&i.child[e].element.checked&&(i.selected=i.child[e].element.id.substr(i.element.id.length+1),t&&t(i.selected))}for(var e=0;e<i.child.length;e++)"input"==i.child[e].type&&i.child[e].element.addEventListener("click",function(e){o()});return $(this.element).controlgroup(),this},RadioSet.prototype.selectButton=function(e){for(var t=this.element.id+"_"+e,i=0;i<this.child.length;i++)this.child[i].element.id==t&&$(this.child[i].element).click();return this},RadioSet.prototype.setDisabled=function(e){try{$(this.element).controlgroup("option","disabled",e)}catch(e){}return this},RadioSet.prototype.setEnabled=function(e){try{$(this.element).controlgroup("option","disabled",!e)}catch(e){}return this},RadioSet.prototype.isDisabled=function(){try{return $(this.element).controlgroup("option","disabled")}catch(e){return!0}},RadioSet.prototype.getValue=function(){return this.selected},ProgressBar.prototype=Object.create(Widget.prototype),ProgressBar.prototype.constructor=ProgressBar,ProgressBar.prototype.setMaxValue=function(e){try{$(this.element).progressbar("option","max",e)}catch(e){}},ProgressBar.prototype.getMaxValue=function(){try{return $(this.element).progressbar("option","max")}catch(e){}},ProgressBar.prototype.setValue=function(e){try{$(this.element).progressbar("value",e)}catch(e){}},ProgressBar.prototype.getValue=function(){return $(this.element).progressbar("value")},SelectFile.prototype=Object.create(Widget.prototype),SelectFile.prototype.constructor=SelectFile,SelectFile.prototype.getFiles=function(){return this.element.files},ToolBar.prototype=Object.create(Grid.prototype),ToolBar.prototype.constructor=ToolBar,IFrame.prototype=Object.create(Widget.prototype),IFrame.prototype.constructor=IFrame,IFrame.prototype.setFramePosition=function(e,t,i,o){return this.setAttribute("style","border:none;position:absolute;top:"+t+";left:"+e+";width:"+i+";height:"+o+";"),this},IFrame.prototype.setOnLoadListener=function(e){this.element.addEventListener("load",function(){e()})},IFrame.prototype.loadPage=function(e){return this.element.src=e,this},IFrame.prototype.setText=function(e){return this.element.src="data:text/html;charset=utf-8,"+encodeURI(e),this},IFrame.prototype.setHTML=function(e){return this.element.srcdoc=e,this},IFrame.prototype.getURL=function(){return this.element.src},IFrame.prototype.clear=function(){return this.element.src="about:blank",this},IFrame.prototype.reload=function(){return this.element.src=this.element.src,this},IFrame.prototype.getDocument=function(){return this.element.contentWindow||this.element.contentDocument},Section.prototype=Object.create(Widget.prototype),Section.prototype.constructor=Section,Section.prototype.isOpen=function(){try{if(0==$(this.element).accordion("option","active"))return!0}catch(e){}return!1},Section.prototype.open=function(){try{$(this.element).accordion("option","active",0)}catch(e){}},Section.prototype.close=function(){try{$(this.element).accordion("option","active",!1)}catch(e){}},Section.prototype.setTitle=function(e){$("#"+this.titleId).html(e)},Combobox.prototype=Object.create(Widget.prototype),Combobox.prototype.constructor=Combobox,Combobox.prototype.addItem=function(e,t,i){var o=new Widget("option");return o.element.setAttribute("value",t),o.element.setAttribute("name",t),i&&(o.element.setAttribute("selected","selected"),this.selected_value=t,this.selected_text=e),o.element.innerHTML=e.toString(),this.addWidget(o),this},Combobox.prototype.setWidth=function(e){return this.width=e,this},Combobox.prototype.make=function(){var e;return $(this.element).selectmenu({width:this.width}),e=this,$(e.element).on("selectmenuchange",function(){e.selected_value=e.element.value,e.selected_text=e.element.options[e.element.selectedIndex].text,e.onchange&&e.onchange(e.selected_value,e.selected_text)}),this},Combobox.prototype.addOnChangeListener=function(e){return this.onchange=e,this},Combobox.prototype.getValue=function(){return this.selected_value},Combobox.prototype.getText=function(){return this.selected_text},Checkbox.prototype=Object.create(Widget.prototype),Checkbox.prototype.constructor=Checkbox,Checkbox.prototype.addOnClickListener=function(e){return this.checkbox.addEventListener("click",e),this},Checkbox.prototype.getValue=function(){return this.checkbox.checked},Checkbox.prototype.setValue=function(e){this.checkbox.checked=e,$(this.checkbox).checkboxradio("refresh")},Checkbox.prototype.setDisabled=function(e){return e?$(this.checkbox).checkboxradio("disable"):$(this.checkbox).checkboxradio("enable"),this},RadioButton.prototype=Object.create(Widget.prototype),RadioButton.prototype.constructor=RadioButton,RadioButton.prototype.getValue=function(){return this.radio.checked},RadioButton.prototype.setValue=function(e){this.radio.checked=e,$(this.radio).checkboxradio("refresh")},RadioButton.prototype.setDisabled=function(e){e?$(this.radio).checkboxradio("disable"):$(this.radio).checkboxradio("enable")},Slider.prototype=Object.create(Widget.prototype),Slider.prototype.constructor=Slider,Slider.prototype.setListener=function(i){$(this.element).on("slide",function(e,t){i(t.value)})},Slider.prototype.setValue=function(e){$(this.element).slider("value",e)},Slider.prototype.getValue=function(){return $(this.element).slider("value")},Spinner.prototype=Object.create(Widget.prototype),Spinner.prototype.constructor=Spinner,Spinner.prototype.setWidth_px=function(e){this.spinner.setWidth_px(e)},Spinner.prototype.setCustomSteps=function(e,t){this.setMinValue(e[0]),this.setMaxValue(e[e.length-1]),this.steps=[];for(var i=0;i<e.length;i++)this.steps.push(e[i]);this.setValue(this.steps[t])},Spinner.prototype.setListener=function(n){function i(){var e=s.getValue(),t=Math.max(s.minV,Math.min(s.maxV,e));e!=t&&s.setValue(t),s._lastV=e,n(t)}var s;s=this,$(s.spinner.element).on("spin",function(e,t){var i=t.value;if(0<s.steps.length){if(i>s._lastV)for(var o=0;i>s.steps[o]&&o<s.steps.length-1;)o++;else for(o=s.steps.length-1;i<s.steps[o]&&0<o;)o--;i=s.steps[o],window.setTimeout(function(){s.setValue(i)},0)}else s._lastV=i,n(i)}),$(s.spinner.element).on("spinchange",function(e,t){i()}),$(s.spinner.element).keypress(function(e){13==e.keyCode&&i()})},Spinner.prototype.setMaxValue=function(e){this.maxV=e;try{$(this.spinner.element).spinner("option","max",e)}catch(e){}},Spinner.prototype.getMaxValue=function(){try{return $(this.spinner.element).spinner("option","max")}catch(e){return this.maxV}},Spinner.prototype.setMinValue=function(e){this.minV=e;try{$(this.spinner.element).spinner("option","min",e)}catch(e){}},Spinner.prototype.getMinValue=function(){try{return $(this.spinner.element).spinner("option","min")}catch(e){return this.minV}},Spinner.prototype.setValue=function(e){this._lastV=Math.max(this.minV,Math.min(this.maxV,e)),$(this.spinner.element).spinner("value",this._lastV)},Spinner.prototype.getValue=function(){return $(this.spinner.element).spinner("value")},MenuItem.prototype.addMenu=function(e){this.addWidget(e),this.menu=e},MenuItem.prototype.setFontItalic=function(e){return this.text_div&&this.text_div.setFontItalic(e),this},MenuItem.prototype=Object.create(Widget.prototype),MenuItem.prototype.constructor=MenuItem;var __onclick_ignore_counter=-1;function __close_all_menus(){for(var e=document.getElementsByClassName("menu-dropdown-content"),t=0;t<e.length;t++){var i=e[t];i.classList.contains("menu-show")&&i.classList.remove("menu-show")}__onclick_ignore_counter=-1}function Menu(e,t){var i;Widget.call(this,"div"),this.addClass("menu-dropdown"),this.disabled=!1,this.onclick_custom_function=null,""!=e||""!=t?(this.button=new IconLabel("",t),this.button.setNoWrap(),this.button.addClass("menu-dropbtn"),""==e&&""!=t&&$(this.button.element).css({"background-color":"transparent","background-size":"28px"}),this.addWidget(this.button),(i=this).button.addOnClickListener(function(e){__close_all_menus(),i.disabled||(i.onclick_custom_function&&i.onclick_custom_function(),__onclick_ignore_counter<0?__onclick_ignore_counter=1:__onclick_ignore_counter++,i.dropdown.toggleClass("menu-show"))})):this.button=null,this.dropdown=new Widget("div"),this.dropdown.addClass("menu-dropdown-content"),this.addWidget(this.dropdown),this.n_items=0}function ContextMenu(e,t){var i;Menu.call(this,"",""),$(this.element).width(1),$(this.element).height(1),i=this,e.addOnRightClickListener(function(){__close_all_menus(),t&&t(),i.disabled||(__onclick_ignore_counter<0&&(__onclick_ignore_counter=0),i.dropdown.element.classList.toggle("menu-show"))})}function DropdownItemGroup(e){Widget.call(this,"optgroup"),0<e.length&&this.setAttribute("label",e)}function Dropdown(){Widget.call(this,"div"),this.select=new Widget("select"),this.addWidget(this.select),this.width="auto",this.selected_value=null,this.selected_text=null,this.activated=!1,this.onchange=null}function ComboDropdown(e,n,t){Grid.call(this,"-compact"),this.content=e,this.makeDropdowns=function(){this.headers=[],this.dropdowns=[];for(var e=this.content,t=0;e;){var i=new Dropdown;i.setTooltip1(e.tooltip,"slideDown",!0,7e3),this.dropdowns.push(i),this.headers.push(e.title),this.dropdowns[t].content=e,this.dropdowns[t].setWidth(n[t]);for(var o=0;o<e.items.length;o++)this.dropdowns[t].addItem(e.items[o].label,"",o,o==e.select);this.dropdowns[t].make(),this.setLabel(this.headers[t],0,t,1,1).setFontSize("80%").setFontItalic(!0).setVisible(e.show),this.setWidget(this.dropdowns[t],1,t,1,1),this.dropdowns[t].setVisible(e.show),!function(t,i){i.element.addEventListener("state_changed",function(e){i.content.select=e.detail.item,t.makeDropdowns();e=new CustomEvent("state_changed",{detail:{values:t.getValues()}});t.element.dispatchEvent(e)},!1)}(this,this.dropdowns[t]);i=e.items[this.dropdowns[t].getValue()],e="next"in i?i.next:null;t++}},this.makeDropdowns()}function Sortable(e,t,i,o,n){Widget.call(this,"ul"),this.cellwidth=e+"px",this.cellheight=t+"px",$(this.element).css({"list-style-type":"none","min-height":t+4+"px",margin:"0px",padding:"0px"}),this.onclick=i,this.onrightclick=o,$(this.element).sortable({update:function(e,t){n(e,t)}}),$(this.element).disableSelection()}function Table(){Grid.call(this,"None"),this.element.setAttribute("class","table-blue")}function TableCell(e){Widget.call(this,"td"),this.setText(e),this.text=e,this.css0=null}function TableHeaderCell(e){Widget.call(this,"th"),this.setText(e)}function TableRow(){Widget.call(this,"tr"),this.selected=-1}function TableScroll(e,t,i,o){Widget.call(this,"div"),this.element.className="scrollingtable",this.div1=new Widget("div"),this.addWidget(this.div1),this.div2=new Widget("div"),this.div1.addWidget(this.div2),this.table=new Widget("table"),this.div2.addWidget(this.table),t&&(this.bottomLegend=new Label(t),this.div2.addWidget(this.bottomLegend)),e&&(this.topLegend=new Widget("caption"),this.topLegend.setText(e),this.table.addWidget(this.topLegend)),this.thead=new Widget("thead"),this.tbody=new Widget("tbody"),this.table.addWidget(this.thead),this.table.addWidget(this.tbody);for(var n=new TableRow,s=0;s<i.length;s++){var a=new TableHeaderCell(""),r=new Widget("div");a.setAttribute("class","table-blue-hh"),r.setAttribute("label",i[s]),a.addWidget(r),o.length>s&&a.setTooltip(o[s]),n.addWidget(a)}(a=new TableHeaderCell("")).element.className="scrollbarhead",this.thead.addWidget(n)}function TableSort(){Widget.call(this,"div"),this.spacer=new Widget("div"),this.table_div=new Widget("div"),this.table_div.element.className="table-content",this.element.appendChild(this.spacer.element),this.element.appendChild(this.table_div.element),this.table=new Widget("table"),this.table.element.className="tablesorter widget-zebra",this.table_div.element.appendChild(this.table.element),this.head=new Widget("thead"),this.body=new Widget("tbody"),this.table.element.appendChild(this.head.element),this.table.element.appendChild(this.body.element),this.selectedRow=null,this.spacer.setWidth_px(1),this.head_top=0,this.head_height=0,this.onsorted=null}function Tabs(){Widget.call(this,"div"),this.tabbar=new Widget("ul"),this.addWidget(this.tabbar),$(this.element).tabs({heightStyle:"fill"})}function TreeNodeCustomIcon(e,t,i,o){this.customIcon=e,this.ci_width=t,this.ci_height=i,this.ci_state=new String(o)}function __get_tree_node_id(){return"treenode_"+padDigits(__id_cnt++,5)}function TreeNode(e,t,i){this.id=__get_tree_node_id(),this.parentId=null,this.folderId=null,this.fchildren=[],this.text=e,this.text0=e,this.highlightId=0,this.icon=t,this.data=i,this.data||(this.data=new TreeNodeCustomIcon("","","","")),this.state={},this.state.opened=!0,this.state.disabled=!1,this.state.selected=!1,this.children=[],this.li_attr={},this.a_attr={},this.dataId=""}function Tree(e){Widget.call(this,"div"),this.root_label=new Label(e),this.addWidget(this.root_label),this.root=new Widget("div"),this.addWidget(this.root),this.root_nodes=[],this.node_map={},this.folder_map={},this.created=!1,this.multiple=!1,this.selected_node_id="",this.deleteChildren=function(e){for(var t=0;t<e.children.length;t++){for(var i=0;i<e.children[t].fchildren.length;i++)this.node_map[e.children[t].fchildren[i].id]=null;e.children[t].fchildren=[],this.deleteChildren(e.children[t]),this.node_map[e.children[t].id]=null}e.children=[]},this.__set_fchildren=function(e,t){for(var i=0;i<t.length;i++){var o=new TreeNode("","",null);0<t[i].fchildren.length?this.__set_fchildren(o,t[i].fchildren):(o.copy(t[i]),e.fchildren.push(o),this.node_map[o.id]=o)}},this.setNode=function(e,t,i){var o=new TreeNode("","",null);if(o.copy(t),i||(o.state.selected=!1),o.parentId=e.id,e.children.push(o),this.node_map[o.id]=o,"fchildren"in t)for(var n=0;n<t.fchildren.length;n++){var s=new TreeNode("","",null);s.copy(t.fchildren[n]),o.fchildren.push(s),this.node_map[s.id]=s}for(n=0;n<t.children.length;n++)this.setNode(o,t.children[n],i);o.state.selected&&(this.selected_node_id=o.id)}}function Dialog(e){Widget.call(this,"div"),this.element.setAttribute("title",e),document.body.appendChild(this.element),this._options={resizable:!1,height:"auto",width:"auto",modal:!0,buttons:{Ok:function(){$(this).dialog("close")}}}}function MessageBox(e,t,i=""){Widget.call(this,"div"),this.element.setAttribute("title",e),document.body.appendChild(this.element),i?(e=new Grid(""),this.addWidget(e),e.setLabel(" ",0,0,1,1),e.setCellSize("","6px",0,0),e.setImage(image_path(i),"48px","48px",1,0,1,1),e.setLabel("&nbsp;&nbsp;&nbsp;",0,1,2,1),e.setLabel(t,0,2,2,1),e.setVerticalAlignment(0,2,"middle")):this.element.innerHTML=t,$(this.element).dialog({resizable:!1,height:"auto",width:"auto",modal:!0,buttons:[{id:"ok_btn_"+__id_cnt++,text:"Ok",click:function(){$(this).dialog("close")}}]})}function MessageBoxW(e,t,i,o=""){Widget.call(this,"div"),this.element.setAttribute("title",e),document.body.appendChild(this.element),o?(e=new Grid(""),this.addWidget(e),e.setLabel(" ",0,0,1,1),e.setCellSize("","6px",0,0),e.setImage(image_path(o),"48px","48px",1,0,1,1),e.setLabel("&nbsp;&nbsp;&nbsp;",0,1,2,1),e.setLabel(t,0,2,2,1),e.setVerticalAlignment(0,2,"middle")):this.element.innerHTML=t;o=Math.round(i*$(window).width())+"px";$(this.element).dialog({resizable:!1,height:"auto",width:o,modal:!0,buttons:{Ok:function(){$(this).dialog("close")}}})}function MessageBoxF(e,t,i,o,n,s=""){Dialog.call(this,e),s?(e=new Grid(""),this.addWidget(e),e.setLabel(" ",0,0,1,1),e.setCellSize("","6px",0,0),e.setImage(image_path(s),"48px","48px",1,0,1,1),e.setLabel("&nbsp;&nbsp;&nbsp;",0,1,2,1),e.setLabel(t,0,2,2,1),e.setVerticalAlignment(0,2,"middle")):this.element.innerHTML=t,this._options={resizable:!1,height:"auto",width:"auto",modal:!0,buttons:{}},this._options.buttons[i]=function(){$(this).dialog("close"),o&&window.setTimeout(o,0)},n&&(this._options.closeOnEscape=!1,this._options.open=function(e,t){$(this).parent().children().children(".ui-dialog-titlebar-close").hide()}),this.launch()}function HelpBox(e,t,i,o=null){var n,s,a;i&&!i(0,t)||(Widget.call(this,"div"),0<e.length?this.element.setAttribute("title",e):this.element.setAttribute("title","Online Help"),this.display=new IFrame(""),this.display.setText("<!DOCTYPE html>\n<html><body><h2>Loading ...</h2></body></html>"),$(this.display.element).css({overflow:"hidden"}),this.addWidget(this.display),$(this.element).css({overflow:"hidden"}),this.history_length=-1,this.history_position=-1,this.history_control=0,document.body.appendChild(this.element),n=1e3,s=600,o?("width"in o&&(n=o.width),"height"in o&&(s=o.height)):__any_mobile_device&&(n=$(window).width()-24,s=$(window).height()-158,__mobile_device&&(s+=24)),this.resizeDisplay=function(e,t){n=e,s=t,this.display.setSize_px(e-16,t-4)},e=Date.now(),this.options={width:n,height:s,modal:!1},this.navigation=!0,o&&"navigation"in o&&(this.navigation=o.navigation),this.navigation?this.options.buttons=[{text:"Back",id:"back_"+e},{text:"Forward",id:"forward_"+e},{text:"Return",id:"return_"+e},{text:"Detach",id:"detach_"+e}]:this.options.buttons=[],this.options.resizable=!__any_mobile_device,this.options.buttons=i?this.options.buttons.concat([{text:"Do not show again",click:function(){$(this).dialog("close"),i(1,t)}},{text:"Close",click:function(){$(this).dialog("close"),i(2,t)}}]):this.options.buttons.concat([{text:"Close",click:function(){$(this).dialog("close")}}]),this.display.element.contentWindow.document.querySelector("body").style.fontSize="16px",__any_mobile_device||(this.options.width=n,this.options.height=s+116),(a=this).navigation&&(a.options.buttons[0].click=function(){if(0<a.history_position){a.history_position--,a.history_control=-1;try{a.display.getDocument().history.back()}catch(e){a.history_length=-1,a.history_position=-1,a.display.loadPage(t)}}},a.options.buttons[1].click=function(){if(a.history_position<a.history_length){a.history_position++,a.history_control=1;try{a.display.getDocument().history.forward()}catch(e){a.history_length=-1,a.history_position=-1,a.display.loadPage(t)}}},a.options.buttons[2].click=function(){a.history_length=-1,a.history_position=-1,a.display.loadPage(t)},a.options.buttons[3].click=function(){var e=t;try{e=a.display.getDocument().location.href}catch(e){}$(this).dialog("close"),window.setTimeout(function(){window.open(e)},0)}),a.options.create=function(e,t){a.resizeDisplay(n,s),a.history_length=-2,a.history_position=-2},o=$(this.element).dialog(this.options),__any_mobile_device&&o.siblings(".ui-dialog-titlebar").remove(),$(a.element).on("dialogresize",function(e,t){a.resizeDisplay(a.width_px(),a.height_px())}),$(a.display.element).on("load",function(){a.history_control||(a.history_position++,a.history_length=a.history_position),a.history_control=0,a.navigation&&(0<a.history_position?($("#"+a.options.buttons[0].id).button("enable"),$("#"+a.options.buttons[2].id).button("enable")):($("#"+a.options.buttons[0].id).button("disable"),$("#"+a.options.buttons[2].id).button("disable")),a.history_position<a.history_length?$("#"+a.options.buttons[1].id).button("enable"):$("#"+a.options.buttons[1].id).button("disable")),a.resizeDisplay(n,s)}),$(a.element).on("dialogclose",function(e,t){a.delete()}),this.display.loadPage(t))}function launchHelpBox(e,t,i,o,n=null){return window.setTimeout(function(){new HelpBox(e,t,i,n)},o)}function WaitDialog(e,t,i){var o;Widget.call(this,"div"),this.element.setAttribute("title",e),this.element.innerHTML=t,document.body.appendChild(this.element),$(this.element).dialog({resizable:!1,height:"auto",width:"auto",modal:!0}),i(o=this,function(){$(o.element).dialog("close")})}function QuestionBox(e,t,i,o=""){Widget.call(this,"div"),this.element.setAttribute("title",e),document.body.appendChild(this.element),o?(e=new Grid(""),this.addWidget(e),e.setLabel(" ",0,0,1,1),e.setCellSize("","6px",0,0),e.setImage(image_path(o),"48px","48px",1,0,1,1),e.setLabel("&nbsp;&nbsp;&nbsp;",0,1,2,1),e.setLabel(t,0,2,2,1),e.setVerticalAlignment(0,2,"middle")):this.element.innerHTML=t;var n=this;this.initiated=!1,this.options={resizable:!1,height:"auto",width:"auto",modal:!0,closeOnEscape:!1,open:function(e,t){n.initiated=!0,$(this).parent().children().children(".ui-dialog-titlebar-close").hide()},buttons:{}};for(var s=0;s<i.length;s++)!function(e,t){e.options.buttons[t.name]=function(){$(this).dialog("close"),"onclick"in t&&t.onclick&&window.setTimeout(t.onclick,0)}}(this,i[s]);$(this.element).dialog(this.options)}function InputBox(e){Widget.call(this,"div"),this.element.setAttribute("title",e),document.body.appendChild(this.element)}function _calc_viewer_size(e,t){var i=window.parent.innerWidth,o=i-40,n=window.parent.innerHeight-56;return window.parent.__any_mobile_device||(n-=8,void 0!==window.parent.__touch_device&&window.parent.__touch_device||(0<e&&(o=e*Math.min(i,n)),0<t&&(n=t*Math.min(i,n)))),[o,n]}function WebAppBox(e){this.onClose_func=null,Widget.call(this,"div"),this.element.setAttribute("title",e),document.body.appendChild(this.element),$(this.element).css({"box-shadow":"8px 8px 16px 16px rgba(0,0,0,0.2)",overflow:"hidden"}),this.iframe=new IFrame(""),$(this.iframe.element).css({border:"none",overflow:"hidden"}),this.addWidget(this.iframe),t=window.parent.__any_mobile_device?_calc_viewer_size(1,1):window.parent.__user_settings&&window.parent.__user_settings.viewers_size?_calc_viewer_size(window.parent.__user_settings.viewers_size[0],window.parent.__user_settings.viewers_size[1]):_calc_viewer_size(1.25,.85),$(this.iframe.element).width(t[0]),$(this.iframe.element).height(t[1]),this.iframe.setSize_px(t[0],t[1]);var t,i=this;this.options={resizable:!0,height:"auto",width:"auto",modal:!1,title:e,effect:"fade",headerVisible:!1,create:function(){i.iframe.getDocument().focus()},focus:function(){i.iframe.getDocument().focus()},open:function(){i.iframe.getDocument().focus()},dragStop:function(){i.iframe.getDocument().focus()},resizeStop:function(){i.iframe.getDocument().focus()},buttons:{}},window.parent.__any_mobile_device&&(this.options.position={my:"left top",at:"left top"},this.options.resizable=!1,this.options.modal=!0)}document.onclick=function(e){return 0<=__onclick_ignore_counter&&(0==__onclick_ignore_counter?__close_all_menus():__onclick_ignore_counter--),!0},Menu.prototype=Object.create(Widget.prototype),Menu.prototype.constructor=Menu,Menu.prototype.setMenuIcon=function(e){this.button&&this.button.setBackground(e)},Menu.prototype.setOnClickCustomFunction=function(e){this.onclick_custom_function=e},Menu.prototype.setMaxHeight=function(e){this.dropdown.element.style.maxHeight=e},Menu.prototype.addItem=function(e,t){e=new MenuItem(e,t);return this.dropdown.addWidget(e),this.n_items++,e},Menu.prototype.addSeparator=function(){var e=new MenuItem("<hr/>","");return this.dropdown.addWidget(e),this.n_items++,e},Menu.prototype.setDisabled=function(e){this.disabled=e},Menu.prototype.setEnabled=function(e){this.disabled=!e},Menu.prototype.setZIndex=function(e){$(this.element).css({"z-index":e})},Menu.prototype.setWidth=function(e){this.element.style.width=e,this.button&&this.button.setWidth(e);for(var t=0;t<this.child.length;t++)this.child[t].setWidth(e)},Menu.prototype.setWidth_px=function(e){$(this.element).width(e),this.button&&this.button.setWidth_px(e);for(var t=0;t<this.child.length;t++)this.child[t].setWidth_px(e)},Menu.prototype.setHeight_px=function(e){$(this.dropdown.element).css({"max-height":e+"px"})},ContextMenu.prototype=Object.create(Menu.prototype),ContextMenu.prototype.constructor=ContextMenu,DropdownItemGroup.prototype=Object.create(Widget.prototype),DropdownItemGroup.prototype.constructor=DropdownItemGroup,DropdownItemGroup.prototype.addItem=function(e,t,i,o){var n=new Widget("option");return n.element.setAttribute("value",i),n.value=i,o&&n.element.setAttribute("selected","selected"),n.element.innerHTML=e.toString(),this.addWidget(n),this},Dropdown.prototype=Object.create(Widget.prototype),Dropdown.prototype.constructor=Dropdown,Dropdown.prototype.reset=function(){$(this.select.element).selectmenu("destroy"),this.removeChild(this.select),this.select=new Widget("select"),this.addWidget(this.select)},Dropdown.prototype.addItem=function(e,t,i,o){var n=new Widget("option");return n.element.setAttribute("value",i),n.value=i,o&&(n.element.setAttribute("selected","selected"),this.selected_value=i,this.selected_text=e),n.element.innerHTML=e.toString(),this.select.addWidget(n),1==this.select.child.length&&(this.selected_value=i,this.selected_text=e),this},Dropdown.prototype.addItemGroup=function(e){this.select.addWidget(e);for(var t=0;t<e.child.length;t++)if(e.child[t].hasAttribute("selected")){this.selected_value=e.child[t].value,this.selected_text=e.child[t].element.innerHTML;break}return this},Dropdown.prototype.setWidth=function(e){return this.width=e,this},Dropdown.prototype.make=function(){var i;return i=this,window.setTimeout(function(){$(i.select.element).selectmenu({width:i.width,change:function(e,t){e=new CustomEvent("state_changed",{detail:{text:t.item.label,item:t.item.value,prev_text:i.selected_text,prev_item:i.selected_value}});i.selected_value=t.item.value,i.selected_text=t.item.label,i.element.dispatchEvent(e),i.onchange&&i.onchange(i.selected_text,i.selected_value)}}).selectmenu("menuWidget").addClass("dropdown-overflow"),i.activated=!0},0),this},Dropdown.prototype.addOnChangeListener=function(e){return this.onchange=e,this},Dropdown.prototype.click=function(){var e,t;e=this,t=new CustomEvent("state_changed",{detail:{text:e.selected_text,item:e.selected_value}}),e.element.dispatchEvent(t)},Dropdown.prototype.setZIndex=function(e){},Dropdown.prototype.getItemByPosition=function(e){return 0<=e&&e<this.select.child.length?this.select.child[e]:null},Dropdown.prototype.getItem=function(n){var s=null;return function e(t,i){for(var o=0;o<i.child.length&&!s;o++)"optgroup"==i.child[o].type?e(t,i.child[o]):i.child[o].value==n&&(s=i.child[o])}(this,this.select),s},Dropdown.prototype.selectItem=function(o){function n(e,t){for(var i=0;i<t.child.length;i++)"optgroup"==t.child[i].type?n(e,t.child[i]):t.child[i].value==o?(t.child[i].setAttribute("selected","selected"),e.selected_value=o,e.selected_text=t.child[i].element.innerHTML):t.child[i].removeAttribute("selected")}return this.activated?($(this.select.element).val(o),$(this.select.element).selectmenu("refresh")):n(this,this.select),this.selected_value},Dropdown.prototype.selectItemByPosition=function(e){if(0<=e&&e<this.select.child.length){for(var t=0;t<this.select.child.length;t++)t==e?(this.select.child[t].setAttribute("selected","selected"),this.selected_value=this.select.child[t].value,this.selected_text=this.select.child[t].element.innerHTML):this.select.child[t].removeAttribute("selected");this.activated&&($(this.select.element).val(this.selected_value),$(this.select.element).selectmenu("refresh"))}return this},Dropdown.prototype.getContent=function(){for(var e=[],t=0;t<this.select.child.length;t++)e.push([this.select.child[t].element.innerHTML,this.select.child[t].value,this.select.child[t].hasAttribute("selected")]);return e},Dropdown.prototype.disableItem=function(n,s){var a=-1,r=null;return function e(t,i){for(var o=0;o<i.child.length;o++)"optgroup"==i.child[o].type?e(t,i.child[o]):i.child[o].value==n&&(i.child[o].hasAttribute("disabled")?s||(i.child[o].removeAttribute("disabled"),a=o,r=i):s&&(i.child[o].setAttribute("disabled","disabled"),a=o,r=i))}(this,this.select),0<=a&&(this.selected_value==n?a<r.child.length-1?this.selectItem(r.child[a+1].value):0<a&&this.selectItem(r.child[a-1].value):this.activated&&$(this.select.element).selectmenu("refresh")),this},Dropdown.prototype.disableItemByPosition=function(e,t){var i;return 0<=e&&e<this.select.child.length&&(t?this.select.child[e].setAttribute("disabled","disabled"):this.select.child[e].removeAttribute("disabled"),i=!0,t&&this.selected_value==this.select.child[e].value&&(e<this.select.child.length-1?(this.selectItemByPosition(e+1),i=!1):0<e&&(this.selectItemByPosition(e-1),i=!1)),i&&this.activated&&$(this.select.element).selectmenu("refresh")),this},Dropdown.prototype.setDisabled=function(e){return e?this.select.setAttribute("disabled","disabled"):this.select.removeAttribute("disabled"),this.activated&&$(this.select.element).selectmenu("refresh"),this},Dropdown.prototype.setEnabled=function(e){this.setDisabled(!e)},Dropdown.prototype.deleteItem=function(e){var t=-1,i=null;for(var o=this,n=this.select,s=0;s<n.child.length;s++)"optgroup"==n.child[s].type?disItem(o,n.child[s]):n.child[s].value==e&&(t=s,i||o.selected_value!=e||(t<n.child.length-1?i=n.child[t+1]:0<t&&(i=n.child[t-1])),n.removeChild(n.child[s]));return i&&this.selectItem(i.value),this},Dropdown.prototype.deleteItemByPosition=function(e){return 0<=e&&e<this.select.child.length&&(this.selected_value==this.select.child[e].value&&(e<this.select.child.length-1?this.selectItemByPosition(e+1):0<e&&this.selectItemByPosition(e-1)),this.select.removeChild(this.select.child[e]),this.activated&&$(this.select.element).selectmenu("refresh")),this},Dropdown.prototype.isItemDisabled=function(s){return function e(t,i){for(var o=!1,n=0;n<i.child.length;n++)"optgroup"==i.child[n].type?o=e(t,i.child[n]):i.child[n].value==s&&i.child[n].getAttribute("disabled")&&(o=!0);return o}(this,this.select)},Dropdown.prototype.getValue=function(){return this.selected_value},Dropdown.prototype.getText=function(){return this.selected_text},ComboDropdown.prototype=Object.create(Grid.prototype),ComboDropdown.prototype.constructor=ComboDropdown,ComboDropdown.prototype.getValues=function(){for(var e=[],t=0;t<this.headers.length;t++)this.dropdowns[t].isVisible()?e.push(this.dropdowns[t].content.items[this.dropdowns[t].getValue()].value):e.push("");return e},Sortable.prototype=Object.create(Widget.prototype),Sortable.prototype.constructor=Sortable,Sortable.prototype.addItem=function(t,i,o){for(var e=0;e<this.child.length;e++)if(this.child[e].itemId==o)return null;var n,s=new ImageButton(t,this.cellwidth,this.cellheight),a=new Widget("li");return a.addWidget(s),a.setTooltip(i),a.setSize_px(this.cellwidth,this.cellheight),$(a.element).css({margin:"3px 4px 3px 4px",padding:"1px",float:"left"}),this.addWidget(a),n=this,s.addOnClickListener(function(e){n.onclick(o,i,t),e.stopPropagation()}),s.addOnRightClickListener(function(e){1==n.onrightclick(o,i,t)&&n.removeItem(o),e.stopPropagation()}),a.itemId=o,a.tooltip=i,a.icon_uri=t,s.item=a,s},Sortable.prototype.removeItem=function(e){for(var t=null,i=0;i<this.child.length&&!t;i++)"li"==this.child[i].type&&this.child[i].itemId==e&&(t=this.child[i]);t&&this.removeChild(t)},Sortable.prototype.getNItems=function(){return this.child.length},Sortable.prototype.getItems=function(){for(var e=$(this.element).sortable("toArray"),t=[],i=0;i<e.length;i++)for(var o=0;o<this.child.length;o++)this.child[o].id==e[i]&&t.push([this.child[o].itemId,this.child[o].tooltip,this.child[o].icon_uri]);return t},Table.prototype=Object.create(Grid.prototype),Table.prototype.constructor=Table,Table.prototype.setHeaderWidget=function(e,t,i,o,n){t=this.getCell(t,i);return t.rowSpan=o,t.colSpan=n,$(t).empty(),t.setAttribute("class","table-blue-hh"),e&&(t.appendChild(e.element),e.parent=this),t},Table.prototype.setHeaderText=function(e,t,i,o,n){e=new Label(e);return e.setAttribute("class","label-blue-vh"),this.setHeaderWidget(e,t,i,o,n),e},Table.prototype.setHeaderRow=function(e,t){for(var i=this.getCell(0,-1),o=0;o<e.length;o++){var n=document.createElement("th");n.innerHTML=e[o],n.setAttribute("class","table-blue-vh"),__set_tooltip(n,t[o]),i.appendChild(n)}},Table.prototype.setRow=function(e,t,i,o,n){var s,a,r=0;e&&(s=this.getCell(o,-1),(a=document.createElement("th")).innerHTML=e,a.setAttribute("class","table-blue-vh"),__set_tooltip(a,t),s.appendChild(a),r++);for(var l=0;l<i.length;l++){var c=this.getCell(o,r++);c.rowSpan=1,c.colSpan=1,$(c).empty(),n?c.setAttribute("class","table-blue-alt"):c.setAttribute("class","table-blue-td"),c.innerHTML=i[l]}},Table.prototype.setColumnCSS=function(e,t,i){for(var o=i;o<this.element.rows.length;o++)t<this.element.rows[o].cells.length&&$(this.element.rows[o].cells[t]).css(e)},Table.prototype.setAllColumnCSS=function(e,t,i){for(var o=t;o<this.element.rows.length;o++)for(var n=i;n<this.element.rows[o].cells.length;n++)$(this.element.rows[o].cells[n]).css(e)},TableCell.prototype=Object.create(Widget.prototype),TableCell.prototype.constructor=TableCell,TableCell.prototype.setNoWrap=function(){return this.element.setAttribute("style","white-space: nowrap"),this},TableHeaderCell.prototype=Object.create(Widget.prototype),TableHeaderCell.prototype.constructor=TableHeaderCell,TableRow.prototype=Object.create(Widget.prototype),TableRow.prototype.constructor=TableRow,TableRow.prototype.addCell=function(e){e=new TableCell(void 0!==e&&null!=e?e.toString():"&nbsp;");return this.addWidget(e),e},TableScroll.prototype=Object.create(Widget.prototype),TableScroll.prototype.constructor=TableScroll,TableScroll.prototype.setHeaderFontSize=function(e){for(var t=this.thead.child[0],i=0;i<t.child.length;i++)t.child[i].setFontSize(e)},TableScroll.prototype.setHeaderNoWrap=function(e){var t=this.thead.child[0];if(e<0)for(var i=0;i<t.child.length;i++)t.child[i].element.setAttribute("style","white-space: nowrap");else e<t.child.length&&t.child[e].element.setAttribute("style","white-space: nowrap")},TableScroll.prototype.addRow=function(e,t,i,o){var n=new TableRow;e&&((e=new TableHeaderCell(e)).setAttribute("class","table-blue-vh"),t&&e.setTooltip(t),n.addWidget(e));for(var s=0;s<i.length;s++){var a=new TableCell(i[s]);o?a.setAttribute("class","table-blue-alt"):a.setAttribute("class","table-blue-td"),n.addWidget(a)}return this.tbody.addWidget(n),n},TableScroll.prototype.clearBody=function(){$(this.tbody.element).empty()},TableSort.prototype=Object.create(Widget.prototype),TableSort.prototype.constructor=TableSort,TableSort.prototype.setHeaders=function(e){for(var t=new TableRow,i=0;i<e.length;i++)t.addWidget(new TableHeaderCell(e[i]));this.head.addWidget(t)},TableSort.prototype.setHeaderFontSize=function(e){for(var t=this.head.child[0],i=0;i<t.child.length;i++)t.child[i].setFontSize(e)},TableSort.prototype.setHeaderNoWrap=function(e){var t=this.head.child[0];if(e<0)for(var i=0;i<t.child.length;i++)t.child[i].element.setAttribute("style","white-space: nowrap");else e<t.child.length&&t.child[e].element.setAttribute("style","white-space: nowrap")},TableSort.prototype.setHeaderColWidth=function(e,t){var i=this.head.child[0];i.child[e].element.style.width=t,0<this.body.child.length&&((i=this.body.child[0]).child[e].element.style.width=t)},TableSort.prototype.selectRow=function(e){if(-1==e.selected){if(this.selectedRow){for(var t=this.selectedRow.child,i=0;i<t.length;i++)$(t[i].element).css("background",t[i].css0);this.selectedRow.selected=-1}this.selectedRow=e;for(t=this.selectedRow.child,i=0;i<t.length;i++)$(t[i].element).css("background","lightblue");this.selectedRow.selected=1}},TableSort.prototype.addRow=function(){var t,i,e=new TableRow;return this.body.addWidget(e),t=this,(i=e).addOnClickListener(function(){t.selectRow(i),t.emitSignal("row_click",i)}),i.addOnDblClickListener(function(){t.emitSignal("row_dblclick",i)}),i.addOnRightClickListener(function(e){t.selectRow(i),t.emitSignal("row_rightclick",i)}),e},TableSort.prototype.removeAllRows=function(){this.body.removeAllChildren()},TableSort.prototype.clear=function(){this.table.element.removeChild(this.head.element),this.table.element.removeChild(this.body.element),this.head=new Widget("thead"),this.body=new Widget("tbody"),this.table.element.appendChild(this.head.element),this.table.element.appendChild(this.body.element)},TableSort.prototype.createTable=function(e){this.onsorted=e,i=this,$(i.table.element).tablesorter({theme:"blue",widgets:["zebra"]}).bind("sortEnd",function(e,t){i.onsorted&&i.onsorted()});for(var i,t=this.body.child,o=0;o<t.length;o++)for(var n=t[o].child,s=0;s<n.length;s++)n[s].css0=$(n[s].element).css("background")},TableSort.prototype.fixHeader=function(){if(0<this.body.child.length&&0<this.head.child.length){$(this.head.element).addClass("fixthead");var e=this.head.child[0].child,t=this.body.child[0].child;this.head_height<=0&&(this.head_height=Math.round($(this.head.element).outerHeight()),this.head_top=Math.round($(this.head.element).position().top),this.head.element.style.top=this.head_top+"px",this.spacer.setHeight_px(this.head_height)),this.head.setWidth_px(this.body.width_px());for(var i=0;i<e.length;i++)$(e[i].element).outerWidth($(t[i].element).outerWidth());for(i=0;i<e.length;i++)$(t[i].element).outerWidth($(e[i].element).outerWidth())}},TableSort.prototype.setTableHeight=function(e){0<this.body.child.length&&(this.table_div.element.style.height=e-this.head_top+"px")},TableSort.prototype.getSortList=function(){return $(this.table.element)[0].config.sortList},TableSort.prototype.applySortList=function(e,t){var i=this.onsorted;t&&(this.onsorted=null),$(this.table.element).trigger("sorton",[e]),this.onsorted=i},Tabs.prototype=Object.create(Widget.prototype),Tabs.prototype.constructor=Tabs,Tabs.prototype.addTab=function(e,t){var i=new Widget("div"),o=new Widget("li"),n=new Widget("a");return n.setAttribute("href","#"+i.id),n.setText(e),o.addWidget(n),this.tabbar.addWidget(o),this.addWidget(i),i.grid=new Grid(""),i.addWidget(i.grid),$(this.element).tabs("refresh"),t&&$(this.element).tabs("option","active",this.child.length-2),i},Tabs.prototype.setTabChangeListener=function(i){$(this.element).on("tabsactivate",function(e,t){i(t)})},Tabs.prototype.numberOfTabs=function(){return this.child.length-1},Tabs.prototype.refresh=function(){$(this.element).tabs("refresh")},Tabs.prototype.getTabNo=function(e){return $("#"+this.id+" >div").index(e.id)-1},Tabs.prototype.getActiveTabNo=function(){return $(this.element).tabs("option","active")},Tabs.prototype.setActiveTab=function(e){$(this.element).tabs("option","active",this.getTabNo(e))},Tabs.prototype.setActiveTabByNo=function(e){$(this.element).tabs("option","active",e)},TreeNode.prototype.setSelected=function(){return this.state.selected=!0,this},TreeNode.prototype.copy=function(e){return this.text=e.text,"text0"in e?this.text0=e.text0:this.text0=e.text,"highlightId"in e?this.highlightId=e.hightlightId:this.highlightId=0,this.icon=e.icon,this.state=e.state,this.dataId=e.dataId,this.data=$.extend({},e.data),this.data.customIcon=e.data.customIcon,this.data.ci_width=e.data.ci_width,this.data.ci_height=e.data.ci_height,this.data.ci_state=new String(e.data.ci_state),this.a_attr=$.extend({},e.a_attr),this},TreeNode.prototype.compare=function(e){return this.text==e.text&&this.text0==e.text0&&this.highlightId==e.hightlightId&&this.icon==e.icon&&this.state==e.state&&this.dataId==e.dataId&&this.data&&e.data&&this.data.customIcon==e.data.customIcon&&this.data.ci_state==e.data.ci_state},TreeNode.prototype.setCustomIconVisible=function(e){var t,i;this.data&&(this.data.ci_state=e?"visible":"hidden",(e=document.getElementById(this.id+"_pbar"))&&(t=e,i=this.data.ci_state,window.setTimeout(function(){t.style.visibility=i},0)))},TreeNode.prototype.setTooltip=function(e){e?this.a_attr.title=e:"title"in this.a_attr&&delete this.a_attr.title},Tree.prototype=Object.create(Widget.prototype),Tree.prototype.constructor=Tree,Tree.prototype.delete=function(){this.created&&$(this.root.element).jstree("destroy").empty(),$(this.root.element).remove(),this.root_label.delete(),Widget.prototype.delete.call(this)},Tree.prototype.addRootNode=function(e,t,i){e=new TreeNode(e,t,i);return this.root_nodes.push(e),this.node_map[e.id]=e,this.created&&(t=$.extend({},e),$(this.root.element).jstree(!0).create_node("#",e,"last",!1,!1),e=$.extend(e,t),this.selectSingle(e),this.confirmCustomIconsVisibility()),e},Tree.prototype.addNode=function(e,t,i,o){t=new TreeNode(t,i,o);return t.parentId=e.id,e.children.push(t),this.node_map[t.id]=t,this.created&&(i=$.extend({},t),$(this.root.element).jstree(!0).create_node("#"+e.id,t,"last",!1,!1),(t=$.extend(t,i)).children=[],this.selectSingle(t),this.confirmCustomIconsVisibility()),t},Tree.prototype.insertNode=function(e,t,i,o){var n=new TreeNode(t,i,o);if(n.parentId=e.id,this.node_map[n.id]=n,this.created){t=$.extend({},n);if($(this.root.element).jstree(!0).create_node("#"+e.id,n,"first",!1,!1),(n=$.extend(n,t)).children=[],0<e.children.length){$(this.root.element).jstree(!0).hide_node(e.children),$(this.root.element).jstree(!0).move_node(e.children,n,0,!1,!1),n.children=e.children;for(var s=0;s<n.children;s++)n.children[s].parentId=n.id,this.node_map[n.children[s].id].parentId=n.id}e.children=[n],this.selectSingle(n),this.confirmCustomIconsVisibility()}else{n.children=e.children;for(s=0;s<n.children;s++)n.children[s].parentId=n.id;e.children=[n]}return n},Tree.prototype.getChildNodes=function(e){return e&&"children"in e?e.children:[]},Tree.prototype.getNodePosition=function(e){var t=null,i=null,o=0,n=-2;if(e.parentId&&e.parentId in this.node_map&&(t=this.node_map[e.parentId]))for(var i=t.parentId,s=t.children,o=s.length,n=-1,a=0;a<o&&n<0;a++)s[a].id==e.id&&(n=a);return[n,t,i,o]},Tree.prototype.moveNodeUp=function(e){if(e.parentId&&e.parentId in this.node_map){for(var t=this.node_map[e.parentId],i=t.children,o=-1,n=0;n<i.length&&o<0;n++)i[n].id==e.id&&(o=n);if(0<o){this.created&&$(this.root.element).jstree(!0).move_node(e,t,o-1,!1,!1);var s=i[o-1];i[o-1]=i[o],i[o]=s}else if(1<i.length){for(var a=[],n=0;n<i.length;n++)i[n].id!=e.id&&a.push(i[n]);this.created&&$(this.root.element).jstree(!0).move_node(a,e,"last",!1,!1);for(n=0;n<a.length;n++)a[n].parentId=e.id;e.children=e.children.concat(a),t.children=[e]}else if(t.parentId){for(var r=this.node_map[t.parentId],s=e.children,l=r.children,c=-1,n=0;n<l.length&&c<0;n++)l[n].id==t.id&&(c=n);e.children=[],t.children=[],r.children=[],this.created&&($(this.root.element).jstree(!0).move_node(t,e,"last",!1,!1),$(this.root.element).jstree(!0).move_node(e,r,c,!1,!1),$(this.root.element).jstree(!0).move_node(s,t,"last",!1,!1));for(n=0;n<i.length;n++)i[n].id!=e.id&&t.children.push(i[n]);t.children=t.children.concat(s);for(n=0;n<t.children.length;n++)t.children[n].parentId=t.id;e.children=[t],t.parentId=e.id;for(n=0;n<l.length;n++)l[n].id!=t.id?r.children.push(l[n]):r.children.push(e);e.parentId=r.id}}},Tree.prototype.setNodes=function(e,t){this.root_nodes=[],this.node_map={};for(var i=0;i<e.length;i++){var o=new TreeNode("","",null);o.copy(e[i]),this.root_nodes.push(o),this.node_map[o.id]=o;for(var n=0;n<e[i].children.length;n++)this.setNode(o,e[i].children[n],t)}},Tree.prototype.getNumberOfNodes=function(){var e,t=0;for(e in this.node_map)this.node_map.hasOwnProperty(e)&&t++;return t},Tree.prototype.selectNode=function(e,t){t&&this.selected_node_id in this.node_map&&(this.node_map[this.selected_node_id].state.selected=!1),this.created&&(t&&$(this.root.element).jstree("deselect_all"),$(this.root.element).jstree(!0).select_node("#"+e.id)),e.state.selected=!0,this.selected_node_id=e.id},Tree.prototype.selectNodeById=function(e,t){return e in this.node_map&&(this.selectNode(this.node_map[e],t),!0)},Tree.prototype.selectSingle=function(e){this.selectNode(e,!0)},Tree.prototype.selectMultiple=function(e){this.selectNode(e,!1)},Tree.prototype.deselectNode=function(e){this.created&&$(this.root.element).jstree(!0).deselect_node("#"+e.id)},Tree.prototype.deselectNodeById=function(e){this.created&&$(this.root.element).jstree(!0).deselect_node("#"+e)},Tree.prototype.selectSingleById=function(e){return e in this.node_map&&(this.selectSingle(this.node_map[e]),!0)},Tree.prototype.selectMultipleById=function(e){return e in this.node_map&&(this.selectMultiple(this.node_map[e]),!0)},Tree.prototype.forceSingleSelection=function(){this.created&&($(this.root.element).jstree("deselect_all"),$(this.root.element).jstree(!0).select_node("#"+this.selected_node_id))},Tree.prototype.setText=function(e,t){e.text=t,e.text0=t,this.created&&$(this.root.element).jstree(!0).rename_node("#"+e.id,t)},Tree.prototype.setIcon=function(e,t){e.icon=t,this.created&&$(this.root.element).jstree(!0).set_icon("#"+e.id,t)},Tree.prototype.setStyle=function(e,t,i){if(this.created&&e)if(0<t.length?("text0"in e||(e.text0=e.text),e.text='<span style="'+t+'">'+e.text0+"</span>",$(this.root.element).jstree(!0).rename_node("#"+e.id,e.text)):"text0"in e&&(e.text=e.text0,$(this.root.element).jstree(!0).rename_node("#"+e.id,e.text)),i<0)this.setStyle(this.node_map[e.parentId],t,i);else if(0<i)for(var o=0;o<e.children.length;o++)this.setStyle(e.children[o],t,i)},Tree.prototype.confirmCustomIconsVisibility=function(){for(var e in this.node_map){e=this.node_map[e];e&&e.data&&e.setCustomIconVisible("visible"==e.data.ci_state)}},Tree.prototype.clear=function(){for(var e=0;e<this.root_nodes.length;e++)this.deleteChildren(this.root_nodes[e]),$(this.root.element).jstree(!0).delete_node([this.root_nodes[e]]);this.root_nodes=[],this.node_map={},this.selected_node_id=""},Tree.prototype.deleteNode=function(e){if(e&&e.parentId&&e.id in this.node_map&&e.parentId in this.node_map){for(var t=this.node_map[e.parentId],i=[],o=-1,n=0;n<t.children.length;n++)if(t.children[n].id==e.id)for(var o=n,s=0;s<e.children.length;s++)i.push(e.children[s]),e.children[s].parentId=t.id;else i.push(t.children[n]);t.children=i,this.node_map[e.id]=null;var a,r={};for(a in this.node_map)this.node_map[a]&&(r[a]=this.node_map[a]);this.node_map=r,this.created&&($(this.root.element).jstree(!0).move_node(e.children,t,o,!1,!1),$(this.root.element).jstree(!0).delete_node([e]),this.confirmCustomIconsVisibility(),0<t.children.length?this.selectSingle(t.children[0]):this.selectSingle(t))}},Tree.prototype.deleteRootNode=function(e){if(e&&e.id in this.node_map){this.node_map[e.id]=null;var t,i={};for(t in this.node_map)this.node_map[t]&&(i[t]=this.node_map[t]);this.node_map=i,this.created&&($(this.root.element).jstree(!0).delete_node([e]),this.confirmCustomIconsVisibility())}},Tree.prototype.deleteBranch=function(e){if(e&&e.parentId&&e.id in this.node_map&&e.parentId in this.node_map){this.deleteChildren(e);for(var t=this.node_map[e.parentId],i=[],o=-1,n=0;n<t.children.length;n++)t.children[n].id==e.id?o=n:i.push(t.children[n]);this.node_map[e.id]=null,t.children=i;var s,a={};for(s in this.node_map)this.node_map[s]&&(a[s]=this.node_map[s]);this.node_map=a,this.selected_node_id==e.id&&(o>=i.length&&o--,0<=o?this.selectSingle(t.children[o]):this.selectSingle(t)),$(this.root.element).jstree(!0).delete_node([e.id]),this.confirmCustomIconsVisibility()}},$.jstree.plugins.addHTML=function(e,n){this.redraw_node=function(e,t,i,o){return(e=n.redraw_node.call(this,e,t,i,o))&&(t=this.get_node(jQuery(e).attr("id")))&&t.data&&0<t.data.customIcon.length&&((i=document.createElement("img")).setAttribute("src",t.data.customIcon),i.setAttribute("id",t.id+"_pbar"),0<t.data.ci_width.length&&i.setAttribute("width",t.data.ci_width),0<t.data.ci_height.length&&i.setAttribute("height",t.data.ci_height),i.style.visibility=t.data.ci_state,e.insertBefore(i,e.childNodes[2])),e}},$.jstree.defaults.addHTML={},Tree.prototype.createTree=function(o,n,e,t,s){var a,i;a=this,$(a.root.element).bind("ready.jstree",function(e,t){var i;a.created=!0,o&&((i=a.calcSelectedNodeIds()).length<=0&&0<a.root_nodes.length?(a.selectSingle(a.root_nodes[0]),a.selected_node_id=a.root_nodes[0].id):a.selectSingleById(i[0])),n&&n()}),$(a.root.element).on("contextmenu",".jstree-anchor",function(e){e=$(a.root.element).jstree(!0).get_node(e.target);e&&(a.selected_node_id=e.id)}),i={plugins:["addHTML"],core:{check_callback:!(a.created=!1),data:a.root_nodes,themes:{responsive:!1}},grid:{hoverable:!0,clickable:!0}},e&&(i.plugins.push("contextmenu"),i.contextmenu={items:e}),t&&(i.core.dblclick_toggle=!1),a.multiple&&(i.plugins.push("checkbox"),i.checkbox={three_state:!1,visible:!1}),$(a.root.element).jstree(i),$(a.root.element).on("select_node.jstree",function(e,t){a.selected_node_id in a.node_map&&(a.node_map[a.selected_node_id].state.selected=!1),a.selected_node_id=t.node.id,a.selected_node_id in a.node_map&&(a.node_map[a.selected_node_id].state.selected=!0),s&&s()}),$(a.root.element).on("deselect_node.jstree",function(e,t){var i=a.calcSelectedNode();i?(a.selected_node_id in a.node_map&&(a.node_map[a.selected_node_id].state.selected=!1),a.selected_node_id=i.id,a.node_map[a.selected_node_id].state.selected=!0,s&&s()):a.selectSingleById(a.selected_node_id)}),$(a.root.element).on("open_node.jstree",function(e,t){a.node_map[t.node.id].state.opened=!0}),$(a.root.element).on("close_node.jstree",function(e,t){a.node_map[t.node.id].state.opened=!1}),t&&$(a.root.element).bind("dblclick.jstree",function(e){t()})},Tree.prototype.refresh=function(){$(this.root.element).jstree().refresh(function(){})},Tree.prototype.calcSelectedNodeIds=function(){for(var e=$(this.root.element).jstree("get_selected"),t=[],i=e.length-1;0<=i;i--)t.push(e[i]);return t},Tree.prototype.getSelectedNodeId=function(){return this.selected_node_id},Tree.prototype.calcSelectedNode=function(){var e=this.calcSelectedNodeIds();return 0<e.length?this.node_map[e[0]]:null},Tree.prototype.getSelectedNode=function(){return""!=this.selected_node_id?this.node_map[this.selected_node_id]:null},Tree.prototype.addNodeToSelected=function(e,t,i){var o=this.getSelectedNode();return o?this.addNode(o,e,t,i):null},Tree.prototype.insertNodeAfterSelected=function(e,t,i){var o=this.getSelectedNode();return o?this.insertNode(o,e,t,i):null},Tree.prototype.addSiblingToSelected=function(e,t,i){var o,n=this.getSelectedNode();if(n){if(n.parentId&&n.parentId in this.node_map)return o=this.node_map[n.parentId],this.addNode(o,e,t,i);console.log(" >>>> parentId "+n.parentId+" not found")}return null},Tree.prototype.deleteSelectedNode=function(){var e=this.getSelectedNode();e&&this.deleteBranch(e)},Tree.prototype.moveSelectedNodeUp=function(){var e=this.getSelectedNode();return e&&this.moveNodeUp(e),e},Tree.prototype.deleteSelectedNodes=function(){for(var e=this.calcSelectedNodeIds(),t=0;t<e.length;t++){var i=this.node_map[e[t]];i&&this.deleteBranch(i)}},Tree.prototype.canMakeFolder=function(){return this.canMakeFolder1(this.calcSelectedNodeIds())},Tree.prototype.__connectivity_sort=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.node_map[e[i]].parentId);for(var o=[],i=0;i<e.length;i++)if(e.indexOf(t[i])<0){o=[i],t[i]="-"+i;break}for(i=1;i<e.length;i++){var n=t.indexOf(e[o[i-1]]);if(!(0<=n)){o=[];break}o.push(n),t[n]="-"+n}for(var s=[],i=0;i<o.length;i++)s.push(e[o[i]]);return s},Tree.prototype.canMakeFolder1=function(e){var t=this.__connectivity_sort(e);if(1<t.length&&this.node_map[t[0]].parentId){t.reverse();for(var i=!0,o=0;o<t.length&&i;o++)i=1==this.node_map[t[o]].children.length;i||(t=[])}return t},Tree.prototype.makeStack=function(e,t){return this.makeStack1(this.calcSelectedNodeIds(),e,t)},Tree.prototype.makeStack1=function(e,t,i){var o=this.__connectivity_sort(e);if(1<o.length){for(var n=[o[0]],s=Math.max(1,this.node_map[n[0]].fchildren.length),a=1;a<o.length;a++)o[a]!=o[a-1]&&(n.push(o[a]),s+=Math.max(1,this.node_map[n[a]].fchildren.length));for(var r=this.node_map[n[0]],e=t,l=(e&&(e+=" "),new TreeNode(e+=s+" jobs stacked",i,null)),c=this.node_map[r.parentId],a=0;a<c.children.length;a++)if(c.children[a].id==r.id){c.children[a]=l;break}l.parentId=c.id;for(a=0;a<n.length;a++){if(0<(r=this.node_map[n[a]]).fchildren.length){for(var d=0;d<r.fchildren.length;d++)r.fchildren[d].folderId=l.id,r.fchildren[d].state.selected=!1,l.fchildren.push(r.fchildren[d]);r.fchildren=[]}else r.folderId=l.id,r.state.selected=!1,l.fchildren.push(r);$(this.root.element).jstree(!0).delete_node([r])}(this.node_map[l.id]=l).children=this.node_map[n[n.length-1]].children;for(var h,a=0;a<l.children.length;a++)l.children[a].parentId=l.id;for(h in this.node_map)this.node_map[h].state.selected=!1;c.state.selected=!0,this.selected_node_id=c.id}},Tree.prototype.unfoldFolder=function(){var e=this.getSelectedNode(),t=e.fchildren;if(0<t.length){for(var i=this.node_map[e.parentId],o=0;o<t.length;o++){var n=new TreeNode("","",null);if(n.copy(t[o]),n.parentId=i.id,n.folderId=null,n.state.selected=!0,this.node_map[n.id]=n,0<o)i.children=[n];else for(var s=0;s<i.children.length;s++)if(i.children[s].id==e.id){i.children[s]=n;break}i=n}i.children=e.children;for(o=0;o<i.children.length;o++)i.children[o].parentId=i.id;delete this.node_map[e.id],this.selectNode(this.node_map[e.parentId],!0),e.children=[],$(this.root.element).jstree(!0).delete_node([e])}},Dialog.prototype=Object.create(Widget.prototype),Dialog.prototype.constructor=Dialog,Dialog.prototype.launch=function(){$(this.element).dialog(this._options)},MessageBox.prototype=Object.create(Widget.prototype),MessageBox.prototype.constructor=MessageBox,MessageBoxW.prototype=Object.create(Widget.prototype),MessageBoxW.prototype.constructor=MessageBoxW,MessageBoxF.prototype=Object.create(Dialog.prototype),MessageBoxF.prototype.constructor=MessageBoxF,HelpBox.prototype=Object.create(Widget.prototype),HelpBox.prototype.constructor=HelpBox,WaitDialog.prototype=Object.create(Widget.prototype),WaitDialog.prototype.constructor=WaitDialog,QuestionBox.prototype=Object.create(Widget.prototype),QuestionBox.prototype.constructor=QuestionBox,QuestionBox.prototype.close=function(){this.initiated&&$(this.element).dialog("close")},InputBox.prototype=Object.create(Widget.prototype),InputBox.prototype.constructor=InputBox,InputBox.prototype.setText=function(e,t=""){t?(this.grid=new Grid(""),this.addWidget(this.grid),this.grid.setLabel(" ",0,0,1,1),this.grid.setCellSize("","6px",0,0),this.grid.setImage(image_path(t),"48px","48px",1,0,1,1),this.grid.setLabel("&nbsp;&nbsp;&nbsp;",0,1,2,1),this.grid.setLabel(e,0,2,2,1),this.grid.setVerticalAlignment(0,2,"middle")):this.element.innerHTML=message},InputBox.prototype.launch=function(e,t){this.options={resizable:!1,height:"auto",width:"auto",modal:!0,buttons:{}},this.options.buttons[e]=function(){t()&&$(this).dialog("close")},this.options.buttons.Cancel=function(){$(this).dialog("close")},$(this.element).dialog(this.options)},WebAppBox.prototype=Object.create(Widget.prototype),WebAppBox.prototype.constructor=WebAppBox,WebAppBox.prototype.setOnCloseFunction=function(e){this.onClose_func=e},WebAppBox.prototype.launch=function(){$(this.element).dialog(this.options);var n=this;$(this.element).on("dialogresize",function(e,t){var i=$(n.element).width(),o=$(n.element).height();n.iframe.setSize_px(i,o)}),$(this.element).on("dialogclose",function(e,t){window.setTimeout(function(){n.onClose_func&&n.onClose_func(),$(n.element).dialog("destroy"),n.element.parentNode&&n.element.parentNode.removeChild(n.element)},10)}),$(this.element).click(function(){n.iframe.getDocument().focus()})};var __local_service=null,__via_proxy=!1,__client_version=null,__local_user=!1,__shared_fs=!1,__regMode="email",__exclude_tasks=[],__licensed_tasks=[],__setup_desc=null,__check_session_period=2e3;function setLocalService(e){__local_service=e&&__via_proxy?__special_client_tag:e}function checkLocalService(t){function n(i,o){localCommand(nc_command.countBrowser,{},"Advance Browser Count",function(e){var t=i-1;return e?e.status!=nc_retcode.ok?t<=0&&(setLocalService(null),new MessageBox("Local service","<h2>Local Service Is Not Available</h2>You will not be able to use Coot and other local applications.<p><i>Local Service was either not launched or has terminated because of error.<br>Please contact "+appName()+" maintainer.<i>","msg_warning")):(__client_version=e.version,t=0):t<=0&&(setLocalService(null),new MessageBox("Local service","<h2>Cannot connect to Local Service</h2>You will not be able to use Coot and other local applications.<p><i>Local Service was either not launched or has terminated because of error.<br>Please contact "+appName()+" maintainer.<i>","msg_warning")),0<t?window.setTimeout(function(){n(t,o)},100):o(),!0})}function e(){serverCommand(fe_command.getInfo,{},"getInfo",function(e){return e.status==fe_retcode.ok?(e=e.data,__exclude_tasks=e.exclude_tasks,__licensed_tasks=e.licensed_tasks,__cloud_storage=e.cloud_storage,__jobs_safe=e.jobs_safe,__demo_projects=e.demo_projects,__auth_software=e.auth_software,__local_setup=e.localSetup,__is_archive=e.isArchive,__regMode=e.regMode,__setup_desc=e.setup_desc,__ccp4_version=e.ccp4_version,__maintainerEmail=e.maintainerEmail,__check_session_period=e.check_session_period,__fe_url=document.location.protocol+"//"+document.location.host+document.location.pathname,e.localuser&&(__local_user=!0,__login_user=e.localuser,__login_token=e.logintoken,__doNotShowList=e.helpTopics),__local_service?t(0):serverCommand(fe_command.getClientInfo,{},"getClientInfo",function(e){return e.status==fe_retcode.ok&&(__via_proxy=e.data.via_proxy,setLocalService(e.data.local_service),e.data.fe_url&&(__fe_url=e.data.fe_url)),__local_service?n(20,function(){t(0)}):t(0),!0})):(new MessageBox("Server not Configured","Server not configured, contact administrator.","msg_warning"),t(1)),!0},null,null)}var i=window.location.search.indexOf("lsp="),o="http";i<0&&(i=window.location.search.indexOf("lsps=")+1,o="https"),1<=i?(startsWith(i=window.location.search.substring(i+4),"http")?setLocalService(i):setLocalService(o+"://"+localhost_name+":"+i),n(20,function(){e()})):(setLocalService(null),e())}function ls_RVAPIAppButtonClicked(e,t,i){var o,n;__local_service?((o={}).base_url=e,o.command=t,o.data=i,localCommand(nc_command.runRVAPIApp,o,"Local call",function(e){return!!e&&(e.status!=nc_retcode.ok&&new MessageBox("Local service","<p>Launching local application "+t+" failed due to:<p><i>"+e.message+'</i><p>Please report this as a bug to <a href="mailto:'+__maintainerEmail+'">'+__maintainerEmail+"</a>"),!0)})):"{viewhkl}"==t?(n=e.indexOf(__special_url_tag),window.setTimeout(function(){startViewHKL(i.split("/").pop(),e.substr(n)+"/"+i,window.parent)},10)):"{ccp4mg}"==t&&new MessageBox("Local application",'<div style="width:400px"><h3>Client-side application</h3><b>CCP4mg</b> can be used only if <i>'+appName()+'</i> is accessed from a <a href="https://www.ccp4.ac.uk" target="_blank">CCP4 Setup</a> on your computer (look out for <i>'+appName()+"</i> icon in CCP4 directory).<p>It looks like you have accessed <i>"+appName()+"</i> using the direct web-link, in which mode the client-side applications, such as CCP4mg and Coot, cannot be used.</div>")}function FoldersBrowser(e,t,i,o,n,s){this.projectList=t,this.folders=t.folders,this.currentFolder=i,this.currentPDesc=o,this.funcKey=n,this.onReturn_fnc=s,this.nprojects=i.nprojects,"move"==n&&this.nprojects<=0?new MessageBox("No projects to move","<h2>No projects to move</h2>The folder is empty, no projects to move","msg_stop"):(Widget.call(this,"div"),this.element.setAttribute("title",e),document.body.appendChild(this.element),this.grid=new Grid("-compact"),this.addWidget(this.grid),this.grid.setLabel('<span style="font-size:160%"><b>Project Folders</b></span>',1,0,1,1).setNoWrap(),this.grid.setLabel("&nbsp;&nbsp;&nbsp;",1,1,1,1),this.makeToolBar(1,2),this.grid.setCellSize("30%","",1,0),this.grid.setCellSize("auto","",1,1),this.grid.setCellSize("30%","",1,2),this.grid.setVerticalAlignment(1,0,"bottom"),this.grid.setVerticalAlignment(1,1,"middle"),this.grid.setVerticalAlignment(1,2,"middle"),this.makeFoldersTree(2,0,4))}function AccessArchiveDialog(i){Widget.call(this,"div"),this.element.setAttribute("title","Access "+appName()+" archive"),document.body.appendChild(this.element),this.aID_inp=null,this.makeLayout();var e=this;$(this.element).dialog({resizable:!1,height:"auto",width:"auto",modal:!0,closeOnEscape:!1,open:function(e,t){$(this).parent().children().children(".ui-dialog-titlebar-close").hide()},buttons:[{id:"archdlg_access_btn",text:"Access",click:function(){var t;t=this,e.accessProject(function(e){e&&(i(!0),$(t).dialog("close"))})}},{id:"archdlg_cancel_btn",text:"Cancel",click:function(){i(!1),$(this).dialog("close")}}]})}function accessArchProject(a,r,l){serverRequest(fe_reqtype.accessArchivedPrj,{archiveID:a,mode:r},"Access Archived Project",function(e){var t="",i="<b>"+a+"</b>",o=appName()+" Archive",n=!1,s="msg_system";switch(e.code){case"project_not_found":t="<h2>Project not found</h2>Project "+i+" is not found in "+o,s="msg_excl_yellow";break;case"already_accessed":t="<h2>Project already accessed</h2>Project "+i+' is in your <i>"'+o+'"</i> folder already.',s="msg_information";break;case"error_read_project":t="<h2>Project cannot be accessed</h2>There are read errors when accessing project "+i+". This project cannot be accessed without repairs. Please inform "+report_problem("Errors reading archived projwect "+a,"Read errors encountered at accessing archived project "+a,"");break;case"duplicate_name":t="<h2>Duplicate project name</h2>Project "+i+" cannot be accessed in "+o+" because a project with this name is found in your work folder(s). Rename or delete your project before accessing it in "+o,s="msg_stop";break;case"author_archive":t="<h2>Project archived by you</h2>Project "+i+' was archived by you and can be found in your <i>"Projects archived by me"</i> folder.',s="msg_information";break;case"error_access_project":t="<h2>Access errors (1)</h2>There are link errors when accessing project "+i+". This project cannot be accessed without repairs. Please inform "+report_problem("Errors accessing archived project "+a,"Link errors encountered at accessing archived project "+a,"");break;case"error_write_plist":t="<h2>Access errors (2)</h2>There are write errors when accessing project "+i+". This project cannot be accessed without repairs. Please inform "+report_problem("Errors accessing archived project "+a,"Project list write errors encountered at accessing archived project "+a,"");break;case"error_update_plist":t="<h2>Access errors (3)</h2>There are general errors when accessing project "+i+". This project cannot be accessed without repairs. Please inform "+report_problem("Errors accessing archived project "+a,"Project list update errors encountered at accessing archived project "+a,"");break;case"ok":t="<h2>Access acquired</h2>Project "+i+' is now accessible to you via your "'+o+'" folder.',s="msg_ok",n=!0;break;default:t="<h2>Access errors (4)</h2>Unknown return code encountered when accessing project "+i+". Please inform "+report_problem("Errors accessing archived project "+a,"Unknown return code encountered at accessing archived project "+a,"")}"strict"!=r&&0<=["already_accessed","author_archive","ok"].indexOf(e.code)?n=!0:new MessageBox("Accessing project "+a,'<div style="width:350px">'+t+"</div>",s),l(n)},null,"persist")}function AddProjectDialog(e,t){Widget.call(this,"div"),this.element.setAttribute("title","Add New Project"),document.body.appendChild(this.element);var i=new Grid(""),o=(this.addWidget(i),0),n=(i.setLabel("ID",0,0,1,1).setWidth("120px").setFontBold(!0),i.setLabel("Name",o++,1,1,1).setWidth("550px").setFontBold(!0),i.setInputText("",1,0,1,1).setStyle("text","^[A-Za-z0-9\\-\\._]+$","e.g., project-1","").setFontItalic(!0).setWidth("120px")),s=i.setInputText("",o++,1,1,1).setStyle("text","","Put a descriptive title here","").setFontItalic(!0).setWidth("520px"),a=(i.setLabel("<h3>Initialisation mode</h3>",o++,0,1,2),new RadioButton("Autostart",e.startmode==start_mode.auto)),r=new RadioButton("Standard",e.startmode==start_mode.standard||e.startmode==start_mode.expert),l=new RadioButton("Hop on",e.startmode==start_mode.migrate);a.setSize("100px","40px"),r.setSize("100px","40px"),l.setSize("100px","40px"),i.setWidget(a,o++,0,1,2),i.setWidget(a,4,0,1,1),i.setLabel("Simplified mode for starting with one of automatic workflows featuring structure solution scenarios in "+appName()+", and optimised list of essential tasks for structure completion (can be switched to the full list).",o++,1,1,1).setFontSize("90%").setFontItalic(!0),i.setWidget(r,5,0,1,1),i.setLabel("Standard mode for operating all "+appName()+" tasks manually, with access to the full list of tasks by default.",+o,1,1,1).setFontSize("90%").setFontItalic(!0),i.setWidget(l,6,0,1,1),i.setLabel("Quick start from phased (possibly partially built and refined) structure or heavy-atom substructure, for further refinement and model building, with the optimised list of essential tasks for structure completion (can be switched to the full list).",6,1,1,1).setFontSize("90%").setFontItalic(!0),$(this.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:750,modal:!0,buttons:[{id:"Add_btn",text:"Add Project",click:function(){var e=[];n.getValue().length<=0?e.push("<b>Project ID</b> must be provided."):n.element.validity.patternMismatch&&e.push("<b>Project ID</b> should contain only latin letters, numbers, undescores,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dashes and dots, and must start with a letter."),s.getValue().length<=0&&e.push("<b>Project Name</b> must be provided.<p>"),0<e.length?new MessageBox("Incomplete data","New project cannot be created due to the following:<p>"+e.join("<br>")+"<p>Please provide all needful data in correct format and try again.","msg_warning"):(e={id:n.getValue(),title:s.getValue()},a.getValue()?e.startmode=start_mode.auto:r.getValue()?e.startmode=start_mode.standard:e.startmode=start_mode.migrate,t(e)&&$(this).dialog("close"))}},{id:"cancel_btn",text:"Cancel",click:function(){t(null),$(this).dialog("close")}}]}),$(a.element).click(function(){$("#choose_btn").button("enable"),r.setValue(!1),l.setValue(!1)}),$(r.element).click(function(){$("#choose_btn").button("enable"),a.setValue(!1),l.setValue(!1)}),$(l.element).click(function(){$("#choose_btn").button("enable"),a.setValue(!1),r.setValue(!1)})}function AnnounceDialog(){Widget.call(this,"div"),this.element.setAttribute("title","Announcement"),document.body.appendChild(this.element);var e=new Grid(""),t=(this.addWidget(e),e.setLabel("<h2>Announcement for all users</h2>",0,0,1,3),e.setLabel("Dear &lt;User Name&gt;,<p>You receive this e-mail bacause you are registered as a "+appName()+" user.",1,0,1,3)),i=e.setTextArea("","Place text of the announcement here",5,80,2,0,1,3),o=(e.setLabel("&nbsp;",3,0,1,3),e.setLabel("This e-mail was sent from unmanned mailbox, please do not reply as replies cannot be<br>received. For any questions, please contact "+appName()+' maintainer at <a href="mailto:'+__maintainerEmail+'?Subject=jsCoFE%20Question">'+__maintainerEmail+"</a>.<p>Kind regards<p>"+appName()+" maintenance.",4,0,1,3));$(this.element).dialog({resizable:!1,height:"auto",maxHeight:600,width:700,modal:!0,buttons:[{id:"send_btn",text:"Send",click:function(){var e=t.getText()+"<p>"+i.getValue()+"<p>"+o.getText();serverRequest(fe_reqtype.sendAnnouncement,e,"Admin Page",function(e){},null,"persist"),$(this).dialog("close")}},{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]})}function DormantUsersDialog(i){function e(e){e=e.getValue().trim();return 0<e.length&&isInteger(e)?parseInt(e):"NaN"}Widget.call(this,"div"),this.element.setAttribute("title","Dormant Users"),document.body.appendChild(this.element);var o,t=new Grid("-compact"),n=0,s=(this.addWidget(t),t.setLabel("<h2>Dormant users management</h2>",n++,0,1,5),t.setLabel("<b>&#8226; <i>declare user account as dormant, if</i></b>",1,0,1,5),t.setAlignment(n++,0,"middle","left"),t.setLabel("&nbsp;&nbsp;&nbsp;&nbsp;user is inactive during last",2,0,1,1),t.setAlignment(2,0,"middle","right"),t.setInputText("365",2,1,1,1).setStyle("text","integer","365","Inactivity period for making a user dormant").setWidth_px(50)),a=(t.setLabel("days, <b><i>or</i></b>",2,2,1,1),t.setAlignment(n++,2,"middle","left"),t.setLabel("has run fewer than",3,0,1,1),t.setAlignment(3,0,"middle","right"),t.setInputText("5",3,1,1,1).setStyle("text","integer","5","Maximum number of jobs for making a user dormant").setWidth_px(50)),r=(t.setLabel("jobs <b><i>and</i></b> is inactive during last",3,2,1,1),t.setAlignment(3,2,"middle","left"),t.setInputText("90",3,3,1,1).setStyle("text","integer","90","Inactivity period for making a user dormant").setWidth_px(50)),l=(t.setLabel("days",3,4,1,1),t.setAlignment(n++,4,"middle","left"),t.setLabel("&nbsp;",n++,0,1,1),t.setLabel("<b>&#8226; <i>delete user account, if</i></b>",5,0,1,5),t.setAlignment(n++,0,"middle","left"),t.setLabel("&nbsp;&nbsp;&nbsp;&nbsp;it remains dormant during",6,0,1,1),t.setAlignment(6,0,"middle","right"),t.setInputText("90",6,1,1,1).setStyle("text","integer","90","Inactivity period for deleting a dormant account").setWidth_px(50));t.setLabel("days",6,2,1,1),t.setAlignment(+n,2,"middle","left"),t.setLabel("&nbsp;<br><i>Affected users will be notified by e-mail.</i>",7,0,1,5),o=this,$(o.element).dialog({resizable:!1,height:"auto",maxHeight:600,width:700,modal:!0,buttons:[{id:"apply_btn",text:"Apply",click:function(){var t={period1:e(s),period2:e(r),njobs:e(a),period3:e(l),checkOnly:!0};"NaN"==t.period1||"NaN"==t.period2||"NaN"==t.period3||"NaN"==t.njobs?new MessageBox("Wrong integer input","<h2>Wrong integer input</h2>Please check input fields","msg_error"):serverRequest(fe_reqtype.manageDormancy,t,"Admin Page",function(e){"ok"!=e.status?new MessageBox("Dormancy management","<h2>Failure</h2>"+e.status,"msg_error"):new QuestionBox("Dormancy management","<h2>Changes about to be made</h2><table><tr><td></td><td><b><i>Number&nbsp;&nbsp;</b></i></td><td><b><i>Disk effect (MB)</b></i></td></tr><tr><td><b><i>Total user accounts:</b></i></td><td>&nbsp;&nbsp;&nbsp;"+e.total_users+"</td><td></td></tr><tr><td><b><i>To become dormant:&nbsp;&nbsp;</b></i></td><td>&nbsp;&nbsp;&nbsp;"+e.dormant_users+"</td><td>&nbsp;&nbsp;&nbsp;"+e.disk_released+"</td></tr><tr><td><b><i>To be deleted:</b></i></td><td>&nbsp;&nbsp;&nbsp;"+e.deleted_users+"</td><td>&nbsp;&nbsp;&nbsp;"+e.disk_freed+"</td></tr></tr><tr><td><b><i>Total disk effect:</b></i></td><td>&nbsp;</td><td>&nbsp;&nbsp;&nbsp;"+(e.disk_freed+e.disk_released)+"</td></tr></table>",[{name:"Confirm",onclick:function(){t.checkOnly=!1,serverRequest(fe_reqtype.manageDormancy,t,"Admin Page",function(e){"ok"!=e.status?new MessageBox("Dormancy management","<h2>Failure</h2>"+e.status,"msg_error"):(new MessageBox("Dormancy management","<h2>Summary</h2>Out of "+e.total_users+" users accounts, "+e.dormant_users+" were declared dormant,<br>and "+e.deleted_users+" were deleted. "+(e.disk_freed+e.disk_released)+" MBytes of disk released."),$(o.element).dialog("close"),i&&i())},null,"persist")}},{name:"Cancel",onclick:function(){}}],"msg_confirm")},null,"persist")}},{id:"cancel_btn",text:"Cancel",click:function(){$(o.element).dialog("close")}}]})}function ProjectArchiveDialog(o,e){Widget.call(this,"div"),this.element.setAttribute("title","Project archiving"),document.body.appendChild(this.element),this.projectDesc=o,this.archiving_started=!1,this.ration=null,__current_page&&(this.ration=__current_page.ration);var n=this;this.makeLayout()?$(this.element).dialog({resizable:!1,height:"auto",maxHeight:600,width:820,modal:!0,closeOnEscape:!1,open:function(e,t){$(this).parent().children().children(".ui-dialog-titlebar-close").hide()},buttons:[{id:"archdlg_archive_btn",text:"Archive",click:function(){var e,t,i;n.validateData()&&(e="Confirm archiving",t='<h2>Confirm archiving</h2>You are about to archive project <b>"'+o.name+'"</b>.',i="Yes, archive",n.projectDesc.archive&&(e="Confirm archive updating",t='<h2>Confirm archive updating</h2>You are about to update archived project <b>"'+o.name+'"</b>.',i="Yes, update"),new QuestionBox(e,'<div style="width:400px">'+t+"<p>This operation cannot be undone and will take 10-20 minutes for average-size projects, during which time your "+appName()+" account will be suspended.<p>Please confirm.",[{name:i,onclick:function(){window.setTimeout(function(){n.archiveProject()},100)}},{name:"Cancel",onclick:function(){}}],"msg_confirm"))}},{id:"archdlg_cancel_btn",text:"Cancel",click:function(){n.archiving_started?logout(__current_page.element.id,3):$(this).dialog("close")}}]}):$(this.element).dialog({resizable:!1,height:"auto",width:600,modal:!0,buttons:[{id:"archdlg_cancel_btn",text:"Close",click:function(){n.archiving_started?logout(__current_page.element.id,3):$(this).dialog("close")}}]})}function AuthorisationDialog(i){Widget.call(this,"div"),this.element.setAttribute("title","Software Authorisations"),document.body.appendChild(this.element),this.auth_dic={},this.auth_lbl={},this.timer=null,this.grid=new Grid("-compact"),this.addWidget(this.grid),this.grid.setLabel("<h3>Software Authorisations</h3>",0,0,1,4),this.grid.setLabel(appName()+" provides access to 3rd party software, not covered by CCP4 license. In order to use this software, a user needs to be authorised by the corresponding software provider. This page gives a summary of your authorisations and allows you to send authorisation requests. Note that authorisation request will redirect you to the provider's web-site. Any data requested by software provider will be processed at provider's end and will not be stored in "+appName()+".",1,0,1,5).setFontSize("80%"),this.grid.setHLine(1,2,0,1,5);var o=this;this.userData=null,serverRequest(fe_reqtype.getUserData,0,"My Account",function(e){(o.userData=e).hasOwnProperty("authorisation")&&(o.auth_dic=e.authorisation),o.layAuthorisationEntries();e=3*$(window).width()/5+"px";$(o.element).dialog({resizable:!0,height:"auto",maxHeight:500,width:e,modal:!0,buttons:[{id:"close_btn",text:"Close",click:function(){$(this).dialog("close")}}]}),$(o.element).on("dialogclose",function(e,t){o.stopTimer(),i&&i(o)})},null,"persist")}function ExportJobDialog(s){var a;a=this,serverRequest(fe_reqtype.prepareJobExport,s,"Prepare Job Export",function(){var i=s.project+"-job_"+s.id,e=(InputBox.call(a,"Export Job "+i),a.setText("","export"),a.grid),o=(e.setLabel('<h2>Export Job "'+i+'"</h2>',0,2,2,3),new Label('Job <b>"'+i+'"</b> is being prepared for download ....')),n=(e.setWidget(o,2,2,1,3),new ProgressBar(0));e.setWidget(n,3,2,1,3),a.jobSize=-2,$(a.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:"auto",modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:[{id:"download_btn",text:"Download",click:function(){var e=__login_token||"404";downloadFile(__special_url_tag+"/"+e+"/"+s.project+"/"+s.id+"/"+i+".zip"),$("#cancel_btn").button("option","label","Close")}},{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]}),window.setTimeout(function(){$("#download_btn").hide()},0),window.setTimeout(function t(){serverRequest(fe_reqtype.checkJobExport,s,"Prepare Job Export",function(e){e.size<=0&&a.jobSize<-1?window.setTimeout(t,1e3):(a.jobSize=e.size,n.hide(),o.setText('Job <b>"'+i+'"</b> is prepared for download. The total download<br>size is '+round(e.size/1e6,3)+" MB. Push the <i>Download</i> button to begin<br>the job export. <p><b><i>Do not close this dialog until the download has finished.</i></b>"),$("#download_btn").show())},null,function(){window.setTimeout(t,1e3)})},2e3),$(a.element).on("dialogclose",function(e,t){serverRequest(fe_reqtype.finishJobExport,s,"Finish Job Export",null,function(){window.setTimeout(function(){$(a.element).dialog("destroy"),a.delete()},10)},function(){})})},null,null)}function ExportFromSafeDialog(e){Widget.call(this,"div"),this.element.setAttribute("title","Export Job from Safe"),document.body.appendChild(this.element);var t,i=new Grid(""),o=(this.addWidget(i),i.setLabel("<h3>Export Job from Failed Jobs Safe</h3>",0,0,1,1),new Label('Use "<i>Select failed job directory</i>" button to navigate<br>to a demo project.<p>The export will commence automatically once a directory<br>is chosen -- <b><i>do not close this dialog until the export<br>is complete.</i></b><hr/>')),o=(i.setWidget(o,1,0,1,1),i.setButton("Select failed job directory",image_path("open_file"),2,0,1,1).setNoWrap());i.setHorizontalAlignment(2,0,"center"),this.currentCloudPath="Failed Jobs Safe",this.tree_type="jobs_safe",t=this,o.addOnClickListener(function(){new CloudFileBrowser(null,t,3,[],function(e){return new ExportFailedJobDialog(e.path),1},null)}),$(this.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:"auto",modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:[{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]})}function ExportFailedJobDialog(s){var a,r;a=this,r={path:s},serverRequest(fe_reqtype.prepareFJobExport,r,"Prepare Failed Job Export",function(e){Widget.call(a,"div");var i=s.split("/").pop(),t=(a.element.setAttribute("title","Export Failed Job "+i),document.body.appendChild(a.element),new Grid("")),o=(a.addWidget(t),t.setLabel('<h3>Exporting Failed Job "'+i+'"</h3>',0,0,1,3),new Label('Failed Job <b>"'+i+'"</b> is being prepared for download ....')),n=(t.setWidget(o,1,0,1,3),new ProgressBar(0));t.setWidget(n,2,0,1,3),a.jobSize=-2,$(a.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:"auto",modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:[{id:"download_btn",text:"Download",click:function(){downloadFile(e),$("#cancel_btn").button("option","label","Close")}},{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]}),window.setTimeout(function(){$("#download_btn").hide()},0),window.setTimeout(function t(){serverRequest(fe_reqtype.checkFJobExport,r,"Prepare Job Export",function(e){e.size<=0&&a.jobSize<-1?window.setTimeout(t,1e3):(a.jobSize=e.size,n.hide(),o.setText('Failed Job <b>"'+i+'"</b> is prepared for download. The total download<br>size is '+round(e.size/1e6,3)+" MB. Push the <i>Download</i> button to export the job.<p><b><i>Do not close this dialog until the download has finished.</i></b>"),$("#download_btn").show())},null,function(){window.setTimeout(t,1e3)})},2e3),$(a.element).on("dialogclose",function(e,t){serverRequest(fe_reqtype.finishFJobExport,r,"Finish Failed Job Export",null,function(){window.setTimeout(function(){$(a.element).dialog("destroy"),a.delete()},10)},function(){})})},null,null)}function ExportProjectDialog(n){var s;s=this,serverRequest(fe_reqtype.preparePrjExport,n,"Prepare Project Export",function(){InputBox.call(s,"Export Project"),s.setText("","export");var e=s.grid,i=(e.setLabel('<h2>Export Project "'+n.current+'"</h2>',0,2,2,3),new Label('Project <b>"'+n.current+'"</b> is being prepared for download ....')),o=(e.setWidget(i,2,2,1,3),new ProgressBar(0));e.setWidget(o,3,2,1,3),s.projectSize=-2,$(s.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:"auto",modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:[{id:"download_btn",text:"Download",click:function(){var e=__login_token||"404";downloadFile(__special_url_tag+"/"+e+"/"+n.current+"/"+n.current+projectFileExt),$("#cancel_btn").button("option","label","Close")}},{id:"cancel_btn",text:"Close",click:function(){$(this).dialog("close")}}]}),window.setTimeout(function(){$("#download_btn").hide()},0),window.setTimeout(function t(){serverRequest(fe_reqtype.checkPrjExport,n,"Prepare Project Export",function(e){e.size<=0&&s.projectSize<-1?window.setTimeout(t,1e3):(s.projectSize=e.size,o.hide(),i.setText('Project <b>"'+n.current+'"</b> is prepared for download. The total download<br>size is '+round(e.size/1e6,3)+" MB. Push the <i>Download</i> button to begin<br>the project export. <p><b><i>Do not close this dialog until the download has finished.</i></b>"),$("#download_btn").show())},null,function(){window.setTimeout(t,1e3)})},2e3),$(s.element).on("dialogclose",function(e,t){serverRequest(fe_reqtype.finishPrjExport,n,"Finish Project Export",null,function(){window.setTimeout(function(){$(s.element).dialog("destroy"),s.delete()},10)},function(){})})},null,null)}function FeedbackDialog(e,t){Widget.call(this,"div"),this.element.setAttribute("title","Feedback Agreement"),document.body.appendChild(this.element);var i=new Grid(""),o=(this.addWidget(i),i.setLabel("<h3>Feedback Agreement</h3>",0,0,1,3),i.setLabel('We all know that software bugs are common, but may be difficult to discover. CCP4 is a community-driven project, which relies on users like yourself for continuing development and improvement, and here we ask you for help. Please indicate your agreement to provide CCP4 with a feedback on software performance, including data that may be useful for finding bugs and rectifying faults. Please read through the following options and choose one that is suitable for you.<p>Note: <i>You may change your mind at any time. Just go to your personal settings (page "My Account"), and give your preference for the Feedback Agreement. The change will have immediate effect for all new jobs</i>.<p>Should you have any questions, please contact CCP4 at <a href="mailto:'+__maintainerEmail+'?Subject=Feedback%20enquiry">'+__maintainerEmail+"</a>.<br>&nbsp;",1,0,1,3),new RadioButton("Agreement (1)",!1)),n=new RadioButton("Agreement (2)",!1),s=new RadioButton("Decline",!1),i=(i.setWidget(o,2,0,1,1),i.setWidget(n,3,0,1,1),i.setWidget(s,4,0,1,1),i.setLabel("&nbsp;",2,1,1,1).setWidth_px(10),i.setLabel("You may want to choose this agreement if (a) your data <i>may be</i> offered for fault investigation by CCP4 developers and (b) you wish to help CCP4 to improve the software you use. If you choose this option, all data related to fault events, arising in your jobs, will be retained in a special safe area of "+appName()+", such that thus noted faults can be reproduced and investigated by CCP4 developers. Please note that failed jobs will be retained in the safe <i>automatically, silently and regardlessly of whether they are deleted in your Project or not</i>. The safe area cannot be accessed by general public, and shall be available only to CCP4 developers with the sole purpose of fault investigation, tests and software improvement.<br>&nbsp;",2,2,1,1),i.setLabel("You may choose this agreement if, in addition to all terms listed for <i>Agreement (1)</i>, you also agree that CCP4 developers may contact you. In most cases, they may be interested in the origin of data that caused a particular effect, but sometimes they may wish to inform you of possible workarounds or simply let you know that the problem is fixed.<br>&nbsp;",3,2,1,1),i.setLabel("You should choose this option if your data <i>may not be</i> offered for fault investigation, or if you do not agree with terms of any of above agreements. If you choose this option, only fault events, arised in your jobs, will be noted in "+appName()+" log files.These fault records will contain no reference to fault circumstances and can be used only for general summary compilations. No data from your jobs, whether failed or not, will be made available to anybody for any purposes.<br>&nbsp;",4,2,1,1),i.setCellSize("100%","",2,2),3*$(window).width()/5+"px");$(this.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:i,modal:!0,buttons:[{id:"choose_btn",text:"Choose",click:function(){o.getValue()?t(feedback_code.agree1):n.getValue()?t(feedback_code.agree2):t(feedback_code.decline),$(this).dialog("close")}},{id:"cancel_btn",text:"Cancel",click:function(){t(e),$(this).dialog("close")}}]}),e==feedback_code.agree1?o.setValue(!0):e==feedback_code.agree2?n.setValue(!0):e==feedback_code.decline?s.setValue(!0):$("#choose_btn").button("disable"),o.setWidth_px($(n.element).width()),s.setWidth_px($(n.element).width()),$(o.element).click(function(){$("#choose_btn").button("enable"),n.setValue(!1),s.setValue(!1)}),$(n.element).click(function(){$("#choose_btn").button("enable"),o.setValue(!1),s.setValue(!1)}),$(s.element).click(function(){$("#choose_btn").button("enable"),o.setValue(!1),n.setValue(!1)})}function HopOnDemoProjectDialog(o){Widget.call(this,"div"),this.element.setAttribute("title","Proceed to Demo Project"),document.body.appendChild(this.element);var t=new Grid(""),n=(this.addWidget(t),t.setLabel("<h3>Proceed to Demo Project</h3>",0,0,1,1),new Label('Project "'+__url_parameters.project+'" is being prepared, please wait ...')),i=(t.setWidget(n,1,0,1,1),$(this.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:"auto",modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:[{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]}),this);$(i.element).on("dialogclose",function(e,t){serverRequest(fe_reqtype.finishPrjImport,0,"Finish Project Import",null,function(){window.setTimeout(function(){$(i.element).dialog("destroy"),i.delete()},10)},function(){})}),serverRequest(fe_reqtype.startDemoImport,{cloudmount:__url_parameters.cmount,demoprj:{name:__url_parameters.project},duplicate:!0},"Demo Project Loading",function(e){var i=new ProgressBar(0);t.setWidget(i,2,0,1,1),window.setTimeout(function t(){serverRequest(fe_reqtype.checkPrjImport,0,"Demo Project Import",function(e){e.signal?(i.hide(),$("#cancel_btn").button("option","label","Close"),"Success"==e.signal?(n.setText('Demo Project "'+e.name+'" is prepared, you may close this dialog now.'),o&&o()):n.setText('Demo Project "'+e.name+'" failed to import, the reason being:<p><b><i>'+e.signal+"</i></b>.")):window.setTimeout(t,1e3)},null,function(){window.setTimeout(t,1e3)})},2e3)},function(e,t){"ok"!=t.status&&$(i.element).dialog("close")},function(e,t){}),__url_parameters=null}function ImportAnnotationDialog(e,t){var i;Widget.call(this,"div"),this.element.setAttribute("title","Import Annotation"),document.body.appendChild(this.element),this.grid=new Grid(""),this.addWidget(this.grid),this.annotation=e.annotation,this.scalepack={},"scalepack"in e&&(this.scalepack=e.scalepack),this.makePage(),i=this,e=$(window).height()/2,$(i.element).dialog({resizable:!0,height:"auto",maxHeight:e,width:750,modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:{"Apply & Upload":function(){i.validate()&&($(this).dialog("close"),t())}}})}function ImportDemoProjectDialog(i){Widget.call(this,"div"),this.element.setAttribute("title","Import Demo Project"),document.body.appendChild(this.element);var o,e=new Grid(""),n=(this.addWidget(e),e.setLabel("<h3>Import Demo Project</h3>",0,0,1,1),e.setText("The project is being imported, please wait ... ",1,0,1,1)),s=e.setProgressBar(0,2,0,1,1);$(this.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:"auto",modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:[{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]}),o=this,$(o.element).on("dialogclose",function(e,t){serverRequest(fe_reqtype.finishPrjImport,0,"Finish Project Import",null,function(){window.setTimeout(function(){$(o.element).dialog("destroy"),o.delete()},10)},function(){})}),window.setTimeout(function t(){serverRequest(fe_reqtype.checkPrjImport,0,"Demo Project Import",function(e){e.signal?(s.hide(),$("#cancel_btn").button("option","label","Close"),"Success"==e.signal?(__current_folder.type==folder_type.all_projects?n.setText('Demo Project "'+e.name+'" is imported, you may close this dialog now.'):n.setText('Demo Project "'+e.name+"\" is imported.<p><b>Note that you are now in the Tutorials project's folder.<br>To navigate back to your folder(s), click on the <br>page title or use Main Menu.</b><p>You may close this dialog now."),i&&i()):n.setText('Demo Project "'+e.name+'" failed to import, the reason being:<p><b><i>'+e.signal+"</i></b>.")):window.setTimeout(t,1e3)},null,function(){window.setTimeout(t,1e3)})},2e3)}function ImportPDBDialog(n){Widget.call(this,"div"),this.element.setAttribute("title","Import from the PDB"),document.body.appendChild(this.element);var e=new Grid(""),s=(this.addWidget(e),e.setLabel("<h3>Import data from the PDB</h3>",0,0,1,4),e.setLabel("PDB entries:&nbsp;&nbsp;",1,0,1,1).setTooltip("Give a comma-separated list of PDB codes, from which data will be imported"),e.setInputText("",1,1,1,3).setStyle("","","e.g. 1xyz,2xyz,3xyz ...","").setWidth_px(300)),t=(e.setVerticalAlignment(1,0,"middle"),"accept_btn_"+(new Date).getMilliseconds());function i(){$("#"+t).button("option","disabled",""==s.getValue().replace(/\s+/,""))}$(this.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:"auto",modal:!0,open:function(e,t){s.addOnInputListener(i)},buttons:[{id:t,text:"Accept",disabled:!0,click:function(){if(n){for(var e=s.getValue().split(","),t="",i=0,o=0;o<e.length;o++)e[o]=e[o].trim(),(4!=e[o].length||"0123456789".indexOf(e[o][0])<0)&&(""!=t&&(t+=", "),5<i&&(t+="<br>",i=0),t+=e[o],i++);""==t?(n(e),$(this).dialog("close")):new MessageBox("Invalid PDB code(s)","The following PDB codes:<p><b>"+t+"</b><p>are invalid. Please revise.","msg_error")}else $(this).dialog("close")}},{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]})}function ImportProjectDialog(o){InputBox.call(this,"Import Project"),this.setText("","import");var i,t=this.grid,n=(t.setLabel("<h2>Import Project</h2>",0,2,2,3),new Label('Use "<i>Select ...</i>" button to select archive file (project_name'+projectFileExt+")<br>with previously exported project. The import will commence<br>automatically once the upload is completed -- <b><i>do not close<br>this dialog until then</i></b>.<br>&nbsp;")),e=(t.setWidget(n,2,2,1,3),{}),s=(e.login_token=__login_token,new Upload(e,{type:"project",accept:projectFileExt,gzip:!1},null,null,function(e){var i;e||(s.hide(),n.setText("The project is being imported, please wait ... "),i=new ProgressBar(0),t.setWidget(i,4,2,1,3),s.__keep_polling=!0,window.setTimeout(function t(){s.__keep_polling&&serverRequest(fe_reqtype.checkPrjImport,0,"Project Import",function(e){e.signal?(i.hide(),$("#cancel_btn").button("option","label","Close"),"Success"==e.signal?(__current_folder.type==folder_type.all_projects?n.setText('Project "'+e.name+'" is imported, you may close this dialog now.'):n.setText('Project "'+e.name+"\" is imported.<p><b>Note that you are now in the original project's folder.<br>To navigate back to your folder(s), click on the <br>page title or use Main Menu.</b><p>You may close this dialog now."),o&&o()):n.setText('Project "'+e.name+'" failed to import, the reason being:<p><b><i>'+e.signal+"</i></b>.")):window.setTimeout(t,1e3)},null,function(){window.setTimeout(t,1e3)})},2e3))}));t.setWidget(s,3,2,1,3),$(this.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:"auto",modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()},buttons:[{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]}),i=this,$(i.element).on("dialogclose",function(e,t){serverRequest(fe_reqtype.finishPrjImport,0,"Finish Project Import",null,function(){s.__keep_polling=!1,window.setTimeout(function(){$(i.element).dialog("destroy"),i.delete()},10)},function(){})})}function ImportSharedProjectDialog(t){var i,o;InputBox.call(this,"Join Shared Project"),this.setText("","join"),this.grid.setLabel("<h2>Join Shared Project</h2>",0,2,2,3),i=this,serverRequest(fe_reqtype.getSharedPrjList,null,"Join Shared Project",function(e){i.makeProjectSelectPage(e,t)},null,"persist"),$(this.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:"720px",modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide(),$("#import_btn").hide()},buttons:[{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]}),o=this,$(o.element).on("dialogclose",function(e,t){serverRequest(fe_reqtype.finishPrjImport,0,"Finish Joining Project",null,function(){window.setTimeout(function(){$(o.element).dialog("destroy"),o.delete()},10)},function(){})})}function DataSummaryPage(e){Widget.call(this,"div"),this.view_btn_grid=null,this.view_btn_pos=0,this.data=e,this.grid=new Grid(""),this.addWidget(this.grid),this.trow=0,this.table=this.grid.setTable(1,0,1,1),this.makeRow("Producing job number",e.jobId,"Id of job produced this dataset"),this.makeRow("Version",e.version.toString(),"Data object version number");var t=e.title();0<e.subtype.length&&(t+=" ("+e.subtype.join(",")+")"),t=t.replace(hkl_subtype.regular+",","").replace(","+hkl_subtype.regular,""),this.makeRow("Type (subtypes)",t,"Data type and assigned subtypes"),this.makeRow("Assigned name",e.dname,"Assigned dataset name")}function DataInspectDialog(e,t,i,o){Dialog.call(this,strip_html_tags(t)),this._options.width=i,this._options.maxHeight=o,this._options.modal=!1,this._options.resizable=!0,this.addWidget(e)}function rvapi_inspectData(e,t,i){__current_page?"ProjectPage"!=__current_page._type?new MessageBox("Wrong page type","Wrong Project Page type encountered. This is a bug, please contact "+appName()+" developer.","msg_excl"):__current_page.getJobTree().inspectData(e,t,i):new MessageBox("Page not found","Project Page not found. This is a bug, please contact "+appName()+" developer.","msg_excl")}FoldersBrowser.prototype=Object.create(Widget.prototype),FoldersBrowser.prototype.constructor=FoldersBrowser,FoldersBrowser.prototype.setProjectList=function(e,t,i){this.projectList=e,this.folders=e.folders,this.currentFolder=t,this.currentPDesc=i,this.nprojects=t.nprojects},FoldersBrowser.prototype.makeFoldersTree=function(e,t,i){this.ftree=this.makeFolderTree(this.folders),this.tree_div=new Widget("div"),this.tree_div.element.setAttribute("class","tree-content"),this.tree_div.addWidget(this.ftree),this.grid.setWidget(this.tree_div,e,t,1,i);this.tree_div.setSize_px(500,310),this.btn_ids={select:this.id+"_select_btn",delete:this.id+"_delete_btn"};var o=this,e="Select";"select"!=this.funcKey&&(e="Move"),$(this.element).dialog({resizable:!1,height:"auto",width:"550px",modal:!0,buttons:[{text:e,id:o.btn_ids.select,click:function(){"select"==o.funcKey?o.onSelectBtn():o.onMoveTo()}},{text:"Close",click:function(){$(this).dialog("close"),window.setTimeout(function(){o.onReturn_fnc("cancel",{})},0)}}]})},FoldersBrowser.prototype.makeToolBar=function(e,t){this.toolbar_div=new Widget("div");var i=new Grid("-compact"),e=(this.toolbar_div.addWidget(i),this.grid.setWidget(this.toolbar_div,e,t,1,1),"36px"),t=0,o=(this.add_folder_btn=i.setButton("",image_path("folder_new"),0,t++,1,1).setSize(e,e).setTooltip("Add sub-folder"),this.add_list_btn=i.setButton("",image_path("folder_list_custom_new"),0,t++,1,1).setSize(e,e).setTooltip("Add custom list"),this.rename_btn=i.setButton("",image_path("renameprj"),0,t++,1,1).setSize(e,e).setTooltip("Rename"),this.delete_btn=i.setButton("",image_path("remove"),0,+t,1,1).setSize(e,e).setTooltip("Remove"),this.help_btn=i.setButton("",image_path("help"),0,4,1,1).setSize(e,e).setTooltip("Help"),this);this.add_folder_btn.addOnClickListener(function(){o.onAddFolder()}),this.add_list_btn.addOnClickListener(function(){o.onAddList()}),this.rename_btn.addOnClickListener(function(){o.onRenameFolder()}),this.delete_btn.addOnClickListener(function(){o.onDeleteFolder()}),this.help_btn.addOnClickListener(function(){new HelpBox("",__user_guide_base_url+"jscofe_project.html",null)})},FoldersBrowser.prototype.disableButton=function(e,t){$("#"+this.btn_ids[e]).button("option","disabled",t)},FoldersBrowser.prototype.setFolders=function(e,t,i){for(var o=0;o<t.length;o++){var n=i.addNode(e,t[o].name+" ("+t[o].nprojects+")",image_path("folder_projects"),null);n.dataId=t[o].path,n.folderType=t[o].type,n.dataId==this.currentFolder.path&&i.selectNode(n,!0),this.setFolders(n,t[o].folders,i)}},FoldersBrowser.prototype.makeFolderTree=function(e){for(var t=new Tree("<u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u>"),i=0;i<e.length;i++){var o="folder_projects_user",n=" <i>("+e[i].nprojects+")</i>";switch(e[i].type){case folder_type.shared:case folder_type.joined:case folder_type.all_projects:o="folder_list";break;case folder_type.custom_list:o="folder_list_custom";break;case folder_type.archived:o="folder_my_archive";break;case folder_type.cloud_archive:o="folder_cloud_archive";break;case folder_type.tutorials:o="folder_tutorials";break;default:n=" ("+e[i].nprojects+")"}var s=t.addRootNode(this.projectList.getRootFolderName(i,__login_id)+n,image_path(o),null);0==i&&(this.node0_id=s.id),s.dataId=e[i].path,s.folderType=e[i].type,s.dataId==this.currentFolder.path&&t.selectNode(s,!0),this.setFolders(s,e[i].folders,t)}var a=this;return t.createTree(!0,function(){},function(){},function(){"select"==a.funcKey?a.onSelectBtn():a.onMoveTo()},function(){a.onSelect()}),t},FoldersBrowser.prototype.onSelect=function(){var e,t,i=this.ftree.getSelectedNode();i&&(e=i.dataId.startsWith(__login_id+"'s "),this.add_folder_btn.setEnabled(e),t=e&&i.parentId||0<=i.icon.indexOf("folder_list_custom"),this.rename_btn.setEnabled(t),this.delete_btn.setEnabled(t),"move"==this.funcKey&&this.disableButton("select",!e&&[folder_type.custom_list,folder_type.archived,folder_type.cloud_archive].indexOf(i.folderType)<0))},FoldersBrowser.prototype.onSelectBtn=function(){var e=this.ftree.getSelectedNode();e?e.dataId!=folder_path.archived&&e.dataId!=folder_path.cloud_archive||__is_archive?(this.onReturn_fnc("select",{folder_path:e.dataId}),$(this.element).dialog("close")):new MessageBox("Feature not available","<h2>"+appName()+" Archive is not available</h3>Archive facility is not configured on this instance of "+appName()+".","msg_stop"):new MessageBox("No selection in tree","<h2>No folder is selected</h3>This likely to be a program error. Select folder and try again.","msg_error")},FoldersBrowser.prototype._find_folder=function(e,t){for(var i=null,o=0;o<t.length&&!i;o++)i=t[o].path==e?t[o]:this._find_folder(e,t[o].folders);return i},FoldersBrowser.prototype.findFolder=function(e){return this._find_folder(e,this.folders)},FoldersBrowser.prototype._delete_folder=function(e,t){for(var i=-1,o=0;o<t.length&&-1==i;o++)i=t[o].path==e?o:this._delete_folder(e,t[o].folders);return 0<=i&&(t.splice(i,1),i=-2),i},FoldersBrowser.prototype.deleteFolder=function(e){return this._delete_folder(e,this.folders)},FoldersBrowser.prototype.onAddFolder=function(){var o=this,e=new InputBox("Add folder"),t=(e.setText("","folder_projects_new"),e.grid),n=(t.setLabel("<h2>Add new folder</h2>",0,2,2,3),t.setLabel("Name:",2,3,1,1),t.setInputText("",2,4,1,1).setStyle("text","^[A-Za-z0-9\\-\\._]+$","e.g., XX-Series","").setFontItalic(!0).setWidth("400px"));t.setNoWrap(2,2),t.setVerticalAlignment(2,3,"middle"),e.addWidget(t),e.launch("Add",function(){var e=n.getValue();if(e.length<=0)return new MessageBox("No folder name","<h2>Folder name not given</h2>New folder name must be specified.","msg_stop"),!1;if(0<=e.indexOf("/"))return new MessageBox("Invalid folder name","<h2>Invalid folder name</h2>Folder name must not contain slashes.","msg_stop"),!1;var t=o.ftree.getSelectedNode();if(!o.findFolder(t.dataId))return new MessageBox("No current folder ","<h2>Current folder not found</h2>This is likely to be a program error. Try to reload the page<br>in browser and repeat. If problem persists, report to<br>developers.","msg_error"),!1;var i=t.dataId+"/"+e;return o.findFolder(i)?(new MessageBox("Duplicate folder name","<h2>Duplicate folder name</h2>Folder names must be unique within any folder.","msg_stop"),!1):(o.ftree.addNode(t,e+" (0)",image_path("folder_projects"),null).dataId=i,o.projectList.addFolderPath(i,0,!1),o.onReturn_fnc("add",{folder_path:i}),o.onSelect(),!0)})},FoldersBrowser.prototype.onAddList=function(){var i=this,e=new InputBox("Add list"),t=(e.setText("","folder_list_custom_new"),e.grid),o=(t.setLabel("<h2>Add new list</h2>",0,2,2,3),t.setLabel("Name:",2,3,1,1),t.setInputText("",2,4,1,1).setStyle("text","^[A-Za-z0-9\\-\\._]+$","e.g., XX-Series","").setFontItalic(!0).setWidth("400px"));t.setNoWrap(2,2),t.setVerticalAlignment(2,3,"middle"),e.addWidget(t),e.launch("Add",function(){var e=o.getValue();if(e.length<=0)return new MessageBox("No list name","<h2>List name not given</h2>New list name must be specified.","msg_stop"),!1;if(0<=e.indexOf("/"))return new MessageBox("Invalid list name","<h2>Invalid list name</h2>List name must not contain slashes.","msg_stop"),!1;if(i.findFolder(e))return new MessageBox("Duplicate list name","<h2>Duplicate list name</h2>List names must be unique and different from names of top-level folders.","msg_stop"),!1;i.projectList.addFolderPath(e,0,!0),i.folders=i.projectList.folders;var t=i.findFolder(e);return t?(t.type=folder_type.custom_list,i.projectList.setCurrentFolder(t),i.currentFolder=i.projectList.currentFolder,i.projectList.sortFolders(),i.tree_div.removeChild(i.ftree),i.ftree=i.makeFolderTree(i.folders),i.tree_div.addWidget(i.ftree),i.onReturn_fnc("add",{folder_path:e})):new MessageBox("Error","<h2>Error</h2>Error when adding List.","msg_error"),!0})},FoldersBrowser.prototype.onDeleteFolder=function(){var i,e,o=this.ftree.getSelectedNode(),n=this.findFolder(o.dataId);n?n.type!=folder_type.custom_list&&(0<n.nprojects||0<n.folders.length)?new MessageBox("Non-empty folder","<h2>Folder "+n.name+" is not empty</h2>Delete all projects and any sub-folders in this folder before deleting it.","msg_stop"):(i=this,e="Folder",n.type==folder_type.custom_list&&(e="List"),new QuestionBox("Delete "+n.name.toLowerCase(),"<h2>"+e+" "+n.name+" will be deleted</h2>Please confirm.",[{name:"Yes, delete",onclick:function(){i.deleteFolder(o.dataId);var e,t=i.folders[0].path;o.parentId?(i.ftree.deleteNode(o),(e=i.ftree.getSelectedNode())&&(t=e.dataId)):(i.ftree.deleteRootNode(o),i.ftree.selectNodeById(i.node0_id)),i.onReturn_fnc("delete",{folder_path:t,folder_name:n.name,folder_type:n.type})}},{name:"Cancel",onclick:null}],"msg_confirm")):new MessageBox("Error","<h2>Error</h2>Error deleting folder","msg_error")},FoldersBrowser.prototype.onMoveTo=function(){var e,t,i,o,n=this.ftree.getSelectedNode(),s=this.findFolder(n.dataId),a=folderPathTitle(s,__login_id,0),r="Folder",l=(r=s.type==folder_type.custom_list?"List":r).toLowerCase();!n.dataId.startsWith(__login_id+"'s ")&&[folder_type.custom_list,folder_type.archived,folder_type.cloud_archive].indexOf(n.folderType)<0||(n.folderType!=folder_type.custom_list&&n.dataId==this.currentFolder.path||n.folderType==folder_type.custom_list&&checkProjectLabel(__login_id,this.currentPDesc,n.dataId)?new MessageBox("Already in the "+l,"<h2>Already in the "+r+'</h2>Project <i>"'+this.currentPDesc.name+'"</i> is already in '+l+'<p><i>"'+a+'"</i>',"msg_stop"):n.folderType==folder_type.archived||n.folderType==folder_type.cloud_archive?new ProjectArchiveDialog(this.currentPDesc,function(){$(e.element).dialog("close"),e.onReturn_fnc("move",{folder_path:n.dataId})}):(t="Move project to "+l,i="<h2>Move project to "+r+'</h2>Project <i><b>"'+(e=this).currentPDesc.name+'"</b></i> will be moved to '+l+' <i><b>"'+a+'"</b></i>',o="Please move",s.type==folder_type.custom_list&&(t="Add project to "+l,i="<h2>Add project to "+r+'</h2>Project <i><b>"'+this.currentPDesc.name+'"</b></i> will be added to '+l+' <i><b>"'+a+'"</b></i>',o="Please add"),new QuestionBox(t,'<div style="width:400px">'+i+"<p>Please confirm.</div>",[{name:o,onclick:function(){$(e.element).dialog("close"),e.onReturn_fnc("move",{folder_path:n.dataId})}},{name:"Cancel",onclick:null}],"msg_confirm")))},FoldersBrowser.prototype.onRenameFolder=function(){var s=this.ftree.getSelectedNode(),a="Folder",r=(s.dataId.startsWith(folder_type.custom_list)&&(a="List"),name.toLowerCase()),e=new InputBox("Rename "+r),t=(e.setText("","renameprj"),e.grid),l=(t.setLabel("<h2>Rename "+r+' "'+s.dataId.split("/").pop()+'"</h2>',0,2,2,3).setWidth("400px"),t.setLabel("New name:",2,3,1,1).setNoWrap(),t.setInputText("",2,4,1,1).setStyle("text","","","").setFontItalic(!0).setWidth("300px")),c=(t.setVerticalAlignment(2,3,"middle"),e.addWidget(t),this);e.launch("Rename",function(){var e=l.getValue();if(e.length<=0)return new MessageBox("No "+r+" name","<h2>"+a+" name not given</h2>New "+r+" name must be given.","msg_stop"),!1;if(0<=e.indexOf("/"))return new MessageBox("Invalid "+r+" name","<h2>Invalid "+r+" name</h2>"+a+" name must not contain slashes.","msg_stop"),!1;var t=s.dataId,i=t.split("/"),o=(i[i.length-1]=e,c.findFolder(s.dataId)),n=o.name,i=(o.name=e,i.join("/"));return c.projectList.renameFolders(s.dataId,i),c.onReturn_fnc("rename",{folder_path:t,rename_path:i,folder_name:n,rename_name:e}),c.ftree.setText(s,e+" ("+o.nprojects+")"),s.dataId=i,!0})},AccessArchiveDialog.prototype=Object.create(Widget.prototype),AccessArchiveDialog.prototype.constructor=AccessArchiveDialog,AccessArchiveDialog.prototype.makeLayout=function(){this.grid=new Grid(""),this.addWidget(this.grid),this.grid.setLabel(" ",0,0,1,1),this.grid.setCellSize("","6px",0,0),this.grid.setImage(image_path("folder_cloud_archive"),"48px","48px",1,0,1,1),this.grid.setLabel("&nbsp;&nbsp;&nbsp;",0,1,2,1),this.grid.setLabel("<h2>Access "+appName()+" Archive</h2>",0,2,2,1),this.grid.setVerticalAlignment(0,2,"middle"),this.grid.setHLine(2,2,2,1,1);var e=this.grid.setPanel(3,2,1,1),t=new Grid("-compact");e.addWidget(t),t.setLabel("Access project with Archive ID:",0,0,1,1).setNoWrap(),this.aID_inp=t.setInputText("",0,1,1,1).setWidth("200px").setStyle("text","","CCP4-XXX.YYYY",appName()+" Archive ID of project to access").addOnInputListener(function(){var e=this.value.trim().toUpperCase();e&&!e.match(/^[0-9A-Z.\\-]+$/)&&(e=e.slice(0,-1)),this.value=e}),t.setVerticalAlignment(0,0,"middle"),t.setVerticalAlignment(0,1,"middle"),__user_role==role_code.developer&&(t.setLabel("&nbsp;",1,0,1,1).setNoWrap(),t.setLabel("Do not have Archive ID?",2,0,1,1).setFontItalic(!0).setNoWrap(),t.setButton("find Archive ID",image_path("search"),2,1,1,1).addOnClickListener(function(){new SearchArchiveDialog(function(){})}),t.setVerticalAlignment(2,0,"middle"),t.setHorizontalAlignment(2,0,"right"),t.setVerticalAlignment(2,1,"middle"))},AccessArchiveDialog.prototype.accessProject=function(t){var e=this.aID_inp.getValue().trim().toUpperCase();e?($("#archdlg_access_btn").button("disable"),$("#archdlg_cancel_btn").button("disable"),accessArchProject(e,"strict",function(e){$("#archdlg_access_btn").button("enable"),$("#archdlg_cancel_btn").button("enable"),t(e)})):(new MessageBox("Archive ID not given",'<div style="width:300px"><h2>Archive ID not given</h2><i>Please provide a valid '+appName()+" Archive ID.</i></div>","msg_stop"),t(!1))},AddProjectDialog.prototype=Object.create(Widget.prototype),AddProjectDialog.prototype.constructor=AddProjectDialog,AnnounceDialog.prototype=Object.create(Widget.prototype),AnnounceDialog.prototype.constructor=AnnounceDialog,DormantUsersDialog.prototype=Object.create(Widget.prototype),DormantUsersDialog.prototype.constructor=DormantUsersDialog,ProjectArchiveDialog.prototype=Object.create(Widget.prototype),ProjectArchiveDialog.prototype.constructor=ProjectArchiveDialog,ProjectArchiveDialog.prototype.makeLayout=function(){this.grid=new Grid(""),this.addWidget(this.grid);var e="<a href=\"javascript:launchHelpBox('"+appName()+" Archive','"+__user_guide_base_url+'jscofe_archive.html\',null,10)"><span style="color:blue">',t=(this.grid.setLabel(" ",0,0,1,1),this.grid.setCellSize("","6px",0,0),this.grid.setImage(image_path("folder_cloud_archive"),"48px","48px",1,0,1,1),this.grid.setLabel("&nbsp;&nbsp;&nbsp;",0,1,2,1),getProjectAuthor(this.projectDesc)),i='<h2>Archive Project "'+this.projectDesc.name+'"</h2>',o="",n="",s="",a="",r="";if(this.projectDesc.archive&&(i="<h2>Update Archived Project "+this.projectDesc.archive.id+"</h2>",o=this.projectDesc.archive.id,n=this.projectDesc.archive.coauthors,s=this.projectDesc.archive.pdbs.join(","),a=this.projectDesc.archive.dois.join(","),r=this.projectDesc.archive.kwds.join(",")),t!=__login_id)return this.grid.setImage(image_path("msg_stop"),"48px","48px",1,0,1,1),this.grid.setLabel(i+"Projects can be archived only by their first authors. Please delegate this action to your collaborator, who originally created the project.<p>Read all details about "+appName()+" archiving "+e+"here</span></a>.",0,2,2,1),!1;if(isProjectJoined(__login_id,this.projectDesc))return this.grid.setImage(image_path("msg_stop"),"48px","48px",1,0,1,1),this.grid.setLabel(i+"Projects can be archived only by their owners. Please delegate this action to your collaborator, who shared this project with you.<p>Read all details about "+appName()+" archiving "+e+"here</span></a>.",0,2,2,1),!1;if(this.projectDesc.archive&&this.projectDesc.archive.depositor.login!=__login_id)return this.grid.setImage(image_path("msg_stop"),"48px","48px",1,0,1,1),this.grid.setLabel(i+"Projects can be updated in "+appName()+" Archive only by their original depositors. Please delegate this action to your collaborator, who archived first version of this project.<p>Read all details about "+appName()+" archiving "+e+"here</span></a>.",0,2,2,1),!1;if(!this.projectDesc.archive&&this.ration&&this.ration.archives.length>=this.ration.archive_year)return this.grid.setImage(image_path("msg_stop"),"48px","48px",1,0,1,1),this.grid.setLabel(i+"Your Archive quota ("+this.ration.archive_year+" archived projects per year) is used up. Please contact your "+appName()+" maintainer to increase your quota.<p>Read all details about "+appName()+" archiving "+e+"here</span></a>.",0,2,2,1),!1;this.grid.setLabel(i+e+"Read what "+appName()+" archiving means before proceeding</span></a> and fill in the form below (make sure to scroll the form down to the end)",0,2,2,1),this.grid.setVerticalAlignment(0,2,"middle"),this.grid.setHLine(2,2,2,1,1);var t=this.grid.setPanel(3,2,1,1),i=($(t.element).css({width:700,height:300,"overflow-y":"scroll"}),new Grid("-compact")),t=(t.addWidget(i),0),e=(i.setLabel('<b>1. Declaration.</b><i> I archive project </i><b>"'+this.projectDesc.name+'"</b><i>, developed by myself and my co-authors listed below in Section 3, who all have consented to this archiving, for the benefit of research community, as scientific evidence of my/our results, for citing in publications, and for educational purposes. I/we understand and agree that the archived project will be accessible to all other users of '+appName()+", who will be able to inspect it, clone, export and make additions in thus cloned or exported copies, where my/our original archived work will remain unchanged, and the whole project will retain my/our authorship. I/we further understand that there is no obligation to archive my/our work and do so in good faith for reasons listed in the beginning of this Declaration. I have read and understood terms of project archiving in "+appName()+", given "+e+"here</span></a>, and informed my co-authors of archiving</i>.",t++,2,1,1),i.setGrid("-compact",t++,2,1,1)),e=(e.setLabel(__login_user+":&nbsp;",0,0,1,1),this.signed_sel=new Dropdown,this.signed_sel.addItem(" ","","no_choice",!0),this.signed_sel.addItem("Agreed and signed","","signed",!1),this.signed_sel.setWidth("200px"),e.setWidget(this.signed_sel,0,1,1,1),this.signed_sel.make(),e.setLabel(getDateString(),0,2,1,1),e.setVerticalAlignment(0,0,"middle"),e.setVerticalAlignment(0,2,"middle"),this.projectDesc.archive?i.setLabel("&nbsp;<br><b>2. Archive ID.</b> Archive ID will be reused as shown below.",t++,2,1,1):i.setLabel("&nbsp;<br><b>2. Archive ID.</b> You may choose your own up to 8-character long Archive ID for your project. It will be declined if already found in the archive. Leave the field blank for automatic choice.",t++,2,1,1),i.setGrid("-compact",t++,2,1,1)),l=(e.setLabel("Archive ID:&nbsp;",0,0,1,1).setNoWrap().setFontItalic(!0).setHorizontalAlignment("right"),this.aid_inp=e.setInputText(o,0,1,1,1).setWidth("140px").setStyle("text","","MYOWN.ID","Archive ID may contain letters, digits and periods. It will be capitalised.").addOnInputListener(function(){var e=this.value.trim().toUpperCase();e&&!e.match(/^[0-9A-Z.]+$/)&&(e=e.slice(0,-1)),this.value=e}),this.projectDesc.archive?this.aid_inp.setReadOnly(!0):this.aid_inp.setMaxInputLength(8),i.setLabel('&nbsp;<br><b>3. Co-authors.</b> Put list of your co-authors here, one per line, or <b>"None" for no co-authors</b>',t++,2,1,1),this.coauthors_edt=new ACEditor(650,100,{border:"1px solid black","box-shadow":"6px 6px lightgray","font-size":"16px",theme:"chrome",mode:"python"}),i.setWidget(this.coauthors_edt,t++,2,1,1),this.coauthors_edt.init(n,"John R. Smith, University of Nowhere, jrsmith@uninowhere.edu\nMary A. Berry, Nocorporation Ltd., m.a.Berry@nocorp.com"),i.setLabel("&nbsp;<br><b>4. Annotation.</b> Provide as much annotation details as possible below; they will be used in archive searches. <b>Put asterisk (*)</b> where annotation details are not currently available -- you will be able to add them later.",t++,2,1,1),i.setGrid("-compact",t++,2,1,1));l.setLabel("Associated PDB code(s):&nbsp;",0,0,1,1).setNoWrap().setFontItalic(!0).setHorizontalAlignment("right"),this.pdb_inp=l.setInputText(s,0,1,1,1).setWidth("440px").setStyle("text","","1XYZ, 2XYZ, 3XYZ, ...","Comma-separated list of PDB codes associated with this project. Typically, specify PDB codes of deposited structures"),l.setLabel("Publication DOI(s):&nbsp;",1,0,1,1).setNoWrap().setFontItalic(!0).setHorizontalAlignment("right"),this.doi_inp=l.setInputText(a,1,1,1,1).setWidth("440px").setStyle("text","","10.1107/S2059798322007987, ...","Comma-separated list of DOI of relevant publications."),l.setLabel("Keywords:&nbsp;",2,0,1,1).setNoWrap().setFontItalic(!0).setHorizontalAlignment("right"),this.kwd_inp=l.setInputText(r,2,1,1,1).setWidth("440px").setStyle("text","","hydrolase, carboxypeptidase, ...","Comma-separated list of keywords suitable for archive searches.");for(var c=0;c<3;c++)l.setVerticalAlignment(c,0,"middle");return!0},ProjectArchiveDialog.prototype.getInputList=function(e){var e=e.getValue().trim(),t=[];if(e&&("*"==e||e.indexOf("*")<0))for(var t=e.split(",").filter(Boolean),i=0;i<t.length;i++)t[i]=t[i].trim();return t},ProjectArchiveDialog.prototype.validateData=function(){var e=[];if("signed"!=this.signed_sel.getValue()&&e.push("sign declaration"),this.aid=this.aid_inp.getValue().trim().toUpperCase(),this.coauthors=this.coauthors_edt.getText().trim(),(!this.coauthors||this.coauthors.length<4||4==this.coauthors.length&&"none"!=this.coauthors.toLowerCase())&&e.push('specify co-authors or put "None"'),this.pdbs=this.getInputList(this.pdb_inp),this.pdbs.length<=0)e.push("provide valid non-empty PDB code(s) annotation");else if("*"!=this.pdbs[0]){for(var t=!0,i=0;i<this.pdbs.length&&t;i++)t=4==this.pdbs[i].length;t||e.push("provide valid PDB code(s)")}return this.dois=this.getInputList(this.doi_inp),this.dois.length<=0&&e.push("provide valid non-empty publication DOI(s) annotation"),this.kwds=this.getInputList(this.kwd_inp),this.kwds.length<=0&&e.push("provide valid non-empty keyword(s) annotation"),0<e.length&&new MessageBox("Invalid input","<h2>Invalid input</h2>Please correct your input:<ul><li>"+e.join("</li><li>")+"</li></ul>","msg_stop"),e.length<=0},ProjectArchiveDialog.prototype.archiveProject=function(){$("#archdlg_archive_btn").button().hide(),$("#archdlg_cancel_btn").button("disable"),stopSessionChecks();var o=this;serverRequest(fe_reqtype.archiveProject,{pdesc:this.projectDesc,annotation:{id:this.aid,coauthors:this.coauthors,pdbs:this.pdbs,dois:this.dois,kwds:this.kwds}},"Start Project Archiving",function(e){$("#archdlg_cancel_btn").button("enable");var t="";switch(e.code){case"not_owner":t="<h2>No privileges</h2>Projects can be archived only by their owners, who created them in first place.";break;case"not_depositor":t="<h2>No privileges</h2>Projects can be updated in "+appName()+" Archive only by their original depositors.";break;case"duplicate_project_name":t="<h2>Duplicate Project Name</h2>Chosen Archive ID:<p><center><b>"+e.archiveID+"</b></center><p>coincides with project name found in your account. You can resolve this conflict by renaming or deleting/unjoining the same-named project; by choosing another Archive ID; or leaving Archive ID blank for automatic choice.";break;case"duplicate_archive_id":t="<h2>Duplicate Archive ID</h2>Chosen Archive ID:<p><center><b>"+e.archiveID+"</b></center><p>is already found in "+appName()+"Archive. Please choose another Archive ID or leave blank for automatic choice.";break;case"no_space":t="<h2>No space left in Archive</h2>Your project cannot be archived because there is no space left in the Archive. Please inform "+report_problem(appName()+" archiving problem","No space left in the Archive, please increase","")+".<p>Sincere apologies for any inconvenience this may have caused.";break;case"no_quota":var i="",t="<h2>No Archive Quota</h2>Your Archive quota "+(i=o.ration?"("+o.ration.archive_year+" archived projects per year) ":i)+"is used up. Please contact your "+appName()+" mainteiner to increase your quota.<p>Sincere apologies for any inconvenience this may have caused.";break;case"ok":o.archiving_started=!0,$("#archdlg_cancel_btn").button().text("Log out"),t=o.projectDesc.archive?'<h2>Archived Project "'+o.projectDesc.name+'" is being updated</h2>Updating is currently in progress. Updated project will be referenced by the same Archive ID as the original version:':'<h2>Project "'+o.projectDesc.name+'" is being archived</h2>Archiving is currently in progress. The following Archive ID was issued for your project:',t+="<p><center><b>"+e.archiveID+"</b></center><p>please take a note of it. Archive ID is used for accessing archived projects and referencing them in publication and elsewhere.<p>For the process to complete uninterrupted, your "+appName()+" account is now suspended. <p>Please log out now. Your account will be released automatically when archiving ends.<br>Contact "+report_problem(appName()+" archiving problem","Archiving project "+o.projectDesc.name+" seems to be stuck","")+" if your account is not released after 2 hours.";break;default:t="<h2>Unknown return code "+e.code+"</h2><i>Please report as a bug</h2>"}o.grid.setLabel(t,0,2,2,1),o.grid.truncateRows(1)},null,"persist")},AuthorisationDialog.prototype=Object.create(Widget.prototype),AuthorisationDialog.prototype.constructor=AuthorisationDialog,AuthorisationDialog.prototype.startTimer=function(){var e;(e=this).timer||(e.timer=window.setTimeout(function(){e.updateOnTimer()},1500))},AuthorisationDialog.prototype.updateOnTimer=function(){var s;0<this.timerCount&&(s=this,serverRequest(fe_reqtype.getUserData,0,"My Account",function(e){if(e.hasOwnProperty("authorisation"))for(var t in s.auth_dic){var i,o,n;e.authorisation.hasOwnProperty(t)&&(i=e.authorisation[t].auth_date,o=e.authorisation[t].token,s.auth_dic[t].auth_date0==i&&s.auth_dic[t].token0==o||(s.timerCount--,s.auth_dic[t].auth_date0=i,s.auth_dic[t].token0=o,s.auth_dic[t].auth_date=i,s.auth_dic[t].token=o,__user_authorisation[t]=e.authorisation[t],n=o="",n=i.length<=0?(o="<b><i>not authorised</i></b>","darkred"):(o="<b><i>authorised since "+i+"</i></b>","green"),s.auth_lbl[t].setText(o).setFontColor(n).setNoWrap()))}0<s.timerCount?s.timer=window.setTimeout(function(){s.updateOnTimer()},1500):s.stopTimer()}))},AuthorisationDialog.prototype.stopTimer=function(){this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.timerCount=0},AuthorisationDialog.prototype.layAuthorisationEntries=function(){this.timerCount=0;var r,e=3;for(r in __auth_software){this.grid.setLabel("&nbsp;",e++,0,1,5).setHeight("9pt").setBackgroundColor("lightblue"),this.grid.setLabel("&nbsp;",e++,0,1,5).setHeight("6pt"),this.auth_dic.hasOwnProperty(r)||(this.auth_dic[r]={auth_date:"",token:""});var t=e+1,i=e+2,o=(this.grid.setLabel("<b><i>Software:</i></b>",e,0,1,1),this.grid.setLabel('<img src="'+image_path(__auth_software[r].icon_software)+'" height="36pt" style="vertical-align: middle;"/>&nbsp;&nbsp;&nbsp;'+__auth_software[r].desc_software,e,1,1,3).setNoWrap(),this.grid.setLabel("<b><i>Provider:</i></b>",t,0,1,1),this.grid.setLabel('<img src="'+image_path(__auth_software[r].icon_provider)+'" height="36pt" style="vertical-align: middle;"/>&nbsp;&nbsp;&nbsp;'+__auth_software[r].desc_provider,t,1,1,3).setNoWrap(),null);if("auth_data"in __auth_software[r]){for(var n in this.grid.setLabel("&nbsp;",i++,0,1,1),"help_page"in __auth_software[r]&&this.grid.setLabel("<a href=\"javascript:launchHelpBox('Autorization instructions','"+__user_guide_base_url+__auth_software[r].help_page+'.html\',null,10)"><span style="color:blue">Authorisation instructions</span></a>',i++,1,1,2),o={},__auth_software[r].auth_data){this.grid.setLabel("<i>"+__auth_software[r].auth_data[n].label+":</i>&nbsp;",i,0,1,1).setHorizontalAlignment("right");var s="";n in this.auth_dic[r]&&(s=this.auth_dic[r][n]),o[n]=this.grid.setInputText(s,i,1,1,1).setWidth_px(350),this.grid.setVerticalAlignment(i,0,"middle"),i++}this.grid.setLabel("&nbsp;",i++,0,1,1)}this.grid.setLabel("<b><i>Authorisation:&nbsp;&nbsp;</i></b>",i,0,1,1);var a,l,c="",d="",h=(this.auth_dic[r].auth_date0=this.auth_dic[r].auth_date,this.auth_dic[r].token0=this.auth_dic[r].token,this.auth_dic[r].auth_date.length<=0?(c="<b><i>not authorised</i></b>",d="darkred"):"requested"==this.auth_dic[r].auth_date?(c="<b><i>requested</i></b>",d="#FFBF00"):("expiry_date"in this.auth_dic[r]&&("Invalid Date"!=(a=new Date(this.auth_dic[r].expiry_date))&&(l=new Date(this.auth_dic[r].auth_date),a.getTime()<l.getTime()&&(c="<b><i>authorisation expired on "+this.auth_dic[r].expiry_date+"</i></b>",d="darkred"))),c||(c="<b><i>authorised since "+this.auth_dic[r].auth_date+"</i></b>",d="green")),this.auth_lbl[r]=this.grid.setLabel(c+"&nbsp;&nbsp;&nbsp;",i,1,1,1).setFontColor(d).setNoWrap(),this.grid.setButton("request authorisation",image_path("authorisation"),i,2,1,1).setNoWrap());o?function(s,a){h.addOnClickListener(function(){var e,t=!0,i="";for(e in a){var o=a[e].getValue().trim();if(s.auth_dic[r][e]=o)switch(__auth_software[r].auth_data[e].type){case"integer":isInteger(o)||(o="",i+="<li>"+__auth_software[r].auth_data[e].label+" must be a valid integer</li>");break;case"date":var n=new Date(o);"Invalid Date"==n?(o="",i+="<li>"+__auth_software[r].auth_data[e].label+" must be a valid date</li>"):n.getTime()<Date.now()&&(o="",i+="<li>"+__auth_software[r].auth_data[e].label+" must be a date in future</li>")}o||(t=!1,s.auth_dic[r].auth_date="",s.userData.authorisation=s.auth_dic,s.userData.pwd="",serverRequest(fe_reqtype.updateUserData,s.userData,"Authorisation data update",function(e){s.timerCount++,s.startTimer()}))}i?new MessageBox("Misformatted input",'<div style="width:400px"><h2>Misformatted input</h2>The following items are given wrong values:<ul>'+i+"</ul>Please provide data in correct format.</div>","msg_error"):t?(s.auth_dic[r].auth_date=(new Date).toUTCString(),s.userData.authorisation=s.auth_dic,s.userData.pwd="",serverRequest(fe_reqtype.updateUserData,s.userData,"Authorisation data update",function(e){s.timerCount++,s.startTimer(),new MessageBox("Authorisation",'<div style="width:400px"><h2>Conditonal authorisation</h2>Your data was accepted but is not verified at this point. You can now start tasks from this software provider, which will run if authorisation data is correct. If tasks are rejected, assume typo and repeat authorisation.</div>',"msg_information")})):new MessageBox("Insufficient data","<h2>Insufficient data</h2>Please provide all requested data.","msg_excl_yellow")})}(this,o):"auth_url"in __auth_software[r]&&function(t,i){h.addOnClickListener(function(){var e=window.location.protocol+"//"+window.location.host+window.location.pathname,e=(e.endsWith("/")&&(e=e.slice(0,-1)),__auth_software[i].auth_url.replace("$reqid","authorisation-"+i+"-"+__login_token).replace("$cburl",e));window.open(e),t.auth_lbl[i].setText("<b><i>requested</i></b>&nbsp;&nbsp;&nbsp;").setFontColor("#FFBF00"),t.timerCount++,t.startTimer()})}(this,r);for(var u=0;u<2;u++)this.grid.setVerticalAlignment(e,u,"middle"),this.grid.setVerticalAlignment(t,u,"middle"),this.grid.setVerticalAlignment(i,u,"middle");this.grid.setCellSize("5%","",i,0),this.grid.setCellSize("auto","",i,1),this.grid.setCellSize("auto","",i,2),this.grid.setCellSize("25%","",i,3),this.grid.setCellSize("60%","",i,4),e+=3}},ExportJobDialog.prototype=Object.create(InputBox.prototype),ExportJobDialog.prototype.constructor=ExportJobDialog,ExportFromSafeDialog.prototype=Object.create(Widget.prototype),ExportFromSafeDialog.prototype.constructor=ExportFromSafeDialog,ExportFailedJobDialog.prototype=Object.create(Widget.prototype),ExportFailedJobDialog.prototype.constructor=ExportFailedJobDialog,ExportProjectDialog.prototype=Object.create(InputBox.prototype),ExportProjectDialog.prototype.constructor=ExportProjectDialog,FeedbackDialog.prototype=Object.create(Widget.prototype),FeedbackDialog.prototype.constructor=FeedbackDialog,HopOnDemoProjectDialog.prototype=Object.create(Widget.prototype),HopOnDemoProjectDialog.prototype.constructor=HopOnDemoProjectDialog,ImportAnnotationDialog.prototype=Object.create(Widget.prototype),ImportAnnotationDialog.prototype.constructor=ImportAnnotationDialog,ImportAnnotationDialog.prototype.makePage=function(){var e=["E","F","J","L","O","P","Q","X","Z"],t=0,i=0;if(this.winputs=[],!jQuery.isEmptyObject(this.scalepack)){this.grid.setLabel("<h2>Import of Scalepack Dataset(s)</h2> <i>Specify wavelength values.</i>",t++,0,1,1),this.grid.setHLine(1,t++,0,1,1);var o,n=this.grid.setGrid("-compact",t++,0,1,5),i=0;for(o in this.scalepack){n.setLabel("File:&nbsp;",i,0,1,1),n.setLabel('<span class="pre-heavy">'+o+"</span>",i,1,1,1),n.setLabel("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wavelength (&Aring;):",i,2,1,1),n.setVerticalAlignment(i,0,"middle"),n.setVerticalAlignment(i,1,"middle"),n.setVerticalAlignment(i,2,"middle"),n.setHorizontalAlignment(i,2,"right");var s=n.setInputText(this.scalepack[o].wavelength,i++,3,1,1).setStyle("text","real","","must be specified").setWidth_px(40);s.file=o,this.winputs.push(s)}n.setLabel("&nbsp;",i++,0,1,1)}if(this.dropdowns=[],0<this.annotation.length){this.grid.setLabel("<h2>Sequence Import</h2> <i>Specify appropriate sequence types.</i>",t++,0,1,1),this.grid.setHLine(1,t++,0,1,1);for(var a=this.grid.setGrid("-compact",t++,0,1,1),r=this.annotation.length-1;0<=r;r--)if("none"==this.annotation[r].items[0].type){a.setLabel("File: ",t,0,1,1);var l=this.annotation[r].file;1<this.annotation[r].items.length?l+=" will be split into single-sequence files":this.annotation[r].file!=this.annotation[r].rename&&(l+=" (renamed to "+this.annotation[r].rename+")"),a.setLabel(l,t++,1,1,1),a.setLabel(" ",t,4,1,1),a.setCellSize("auto","",t,0),a.setCellSize("auto","",t,1),a.setCellSize("auto","",t,2),a.setCellSize("auto","",t,3),a.setCellSize("99%","",t,4);for(var c=0;c<this.annotation[r].items.length;c++){for(var d='<pre class="pre-heavy">',h=(0<(m=this.annotation[r].items[c].contents.replace(/\r/g,"").split("\n")).length&&(d+=m[0]+"\n"),0),u=1;u<m.length;u++)for(var p=0;p<m[u].length;p++)62<=h&&(d+="\n",h=0),d+=m[u][p],h++;for(;h<62;)d+=" ",h++;d+="\n";a.setLabel(d+"</pre>",t,1,1,1);if("none"==this.annotation[r].items[c].type){(m=this.annotation[r].items[c].contents.split("\n"))[0]="",2<m.length&&endsWith(this.annotation[r].file.toLowerCase(),".pir")&&(m[1]="");for(var m,f=m.join(" "),g=!1,u=0;u<f.length&&!g;u++)g=0<=e.indexOf(f[u]);g&&(this.annotation[r].items[c].type="protein")}a.setLabel("&nbsp;&nbsp;&nbsp;",t,2,1,1);var _=new Dropdown;a.addWidget(_,t++,3,1,1),_.addItem("[select type]","","none","none"==this.annotation[r].items[c].type),_.addItem("Protein","","protein","protein"==this.annotation[r].items[c].type),_.addItem("DNA","","dna","dna"==this.annotation[r].items[c].type),_.addItem("RNA","","rna","rna"==this.annotation[r].items[c].type),_.make(),_.annotation_item=this.annotation[r].items[c],this.dropdowns.push(_)}a.setLabel("&nbsp;",t++,0,1,1)}}},ImportAnnotationDialog.prototype.validate=function(){for(var e="",t=0;t<this.winputs.length;t++){var i=this.winputs[t].getValue();if(!isFloat(this.scalepack[this.winputs[t].file].wavelength=i)){e="<li>specify wavelength for all datasets</li>";break}}for(t=0;t<this.dropdowns.length;t++)if(this.dropdowns[t].annotation_item.type=this.dropdowns[t].getValue(),"none"==this.dropdowns[t].annotation_item.type){e+="<li>specify types of all sequences</li>";break}return 0<e.length&&new MessageBox("Annotation not complete","Please complete annotation of imported data item(s):<ul>"+e+"</ul","msg_warning"),e.length<=0},ImportDemoProjectDialog.prototype=Object.create(Widget.prototype),ImportDemoProjectDialog.prototype.constructor=ImportDemoProjectDialog,ImportPDBDialog.prototype=Object.create(Widget.prototype),ImportPDBDialog.prototype.constructor=ImportPDBDialog,ImportProjectDialog.prototype=Object.create(InputBox.prototype),ImportProjectDialog.prototype.constructor=ImportProjectDialog,ImportSharedProjectDialog.prototype=Object.create(InputBox.prototype),ImportSharedProjectDialog.prototype.constructor=ImportSharedProjectDialog,ImportSharedProjectDialog.prototype.makeProjectSelectPage=function(e,n){var s,t=e.shared_projects;if(t.length<=0)this.grid.setLabel("You do not have projects shared with you by other users.",2,2,1,1);else{var a=this.grid.setLabel("Select a project to join:",2,2,1,1),i=new Dropdown;i.setTooltip("Choose a project to join").setWidth("600px");for(var o=0;o<t.length;o++)i.addItem(t[o].owner.login+":["+t[o].name+'] "'+t[o].title+'"',"",o,0==o);i.make(),this.grid.setWidget(i,3,2,1,1),this.grid.setLabel("&nbsp;",4,2,1,1);var r=this.grid.setButton("Join",image_path("share"),5,2,1,1).setWidth_px(120);this.grid.setHorizontalAlignment(5,2,"center"),s=this,r.addOnClickListener(function(){var e=t[i.getValue()],o=(a.setText("The project is being joined, please wait ... "),i.hide(),r.hide(),new ProgressBar(0));o.setWidth_px(600),s.grid.setWidget(o,4,2,1,1),serverRequest(fe_reqtype.startSharedImport,e,"Join Shared Project",function(e){window.setTimeout(function i(){serverRequest(fe_reqtype.checkPrjImport,0,"Join Shared Project",function(e){var t;e.signal?(o.hide(),$("#cancel_btn").button("option","label","Close"),"Success"==e.signal?(s.grid.setLabel("<h2>Project Joined Successfully</h2>",0,2,2,3),t="",__current_folder.type!=folder_type.joined&&__current_folder.type!=folder_type.all_projects&&(t="<p><b>Note that you are now in the project's owner folder. To navigate back to your folder(s), click on the page title or use Main Menu.</b>"),a.setText('<div style="width:600px">Project "'+e.name+'" is now joined, and you may work on it simultaneously with the project owner and other users, with whom the project may have also been shared.'+t+"<p>You may close this dialog now.</div>"),n&&n()):(s.grid.setLabel("<h2>Join Shared Project Failed</h2>",0,2,2,3),t='<div style="width:600px">Project "'+e.name+'" was not joined, the reason being:<p><b>*** <i>'+e.signal+"</i></b>",0<=e.signal.indexOf("already exists")&&(t+='<p>You can:<ul><li>find and rename your project "'+e.name+'" and try joining again</li><li>ask your collaborator to rename the project and re-share it with you</li><li>delete/unjoin project '+e.name+" if renaming is not possible (project's backup copy may be exported before deletion)</li></ul>"),a.setText(t+"</div>"))):window.setTimeout(i,1e3)},null,function(){window.setTimeout(i,1e3)})},2e3)},null,"persist")})}},DataSummaryPage.prototype=Object.create(Widget.prototype),DataSummaryPage.prototype.constructor=DataSummaryPage,DataSummaryPage.prototype.getTitle=function(){return this.data.dname},DataSummaryPage.prototype.makeRow=function(e,t,i){this.table.setHeaderText(e,this.trow,0,1,1).setTooltip(i).setNoWrap(),t&&this.table.setLabel(t,this.trow,1,1,10),this.table.setHorizontalAlignment(this.trow,0,"left"),this.table.setHorizontalAlignment(this.trow,1,"left"),this.table.setCellSize("10%","",this.trow,0),this.table.setCellSize("90%","",this.trow,1),this.trow++},DataSummaryPage.prototype._getPath=function(e,t,i){return t.files.hasOwnProperty(i)?e.getProjectURL(t.jobId,"output/"+t.files[i]):""},DataSummaryPage.prototype._getMapLabels=function(e){return"DataStructure"==e._type?e.mapLabels:null},DataSummaryPage.prototype.addUglyMolButton=function(o){this.view_btn_grid||(this.grid.setLabel("&nbsp;",2,0,1,1),this.view_btn_grid=this.grid.setGrid("-compact",3,0,1,1));var n,e=this.view_btn_grid.setButton("UglyMol",image_path("display"),3,this.view_btn_pos++,1,1);n=this,e.addOnClickListener(function(){var e=(e=n._getPath(o,n.data,file_key.xyz))||n._getPath(o,n.data,file_key.sub),t=n._getPath(o,n.data,file_key.map),i=n._getPath(o,n.data,file_key.dmap);t||i?startUglyMol(n.data.dname,e,"",n._getPath(o,n.data,file_key.map),n._getPath(o,n.data,file_key.dmap),null):startUglyMol(n.data.dname,e,n._getPath(o,n.data,file_key.mtz),"","",n._getMapLabels(n.data))})},DataSummaryPage.prototype.addViewHKLButton=function(e){var t,i;this.data.files[file_key.mtz]&&(this.view_btn_grid||(this.grid.setLabel("&nbsp;",2,0,1,1),this.view_btn_grid=this.grid.setGrid("-compact",3,0,1,1)),t=this.view_btn_grid.setButton("ViewHKL",image_path("display"),3,this.view_btn_pos++,1,1),i=this,t.addOnClickListener(function(){startViewHKL(i.data.dname,i._getPath(e,i.data,file_key.mtz),window)}))},DataInspectDialog.prototype=Object.create(Dialog.prototype),DataInspectDialog.prototype.constructor=DataInspectDialog;var job_dialog_reason={rename_node:"rename_node",set_node_icon:"set_node_icon",reset_node:"reset_node",select_node:"select_node",stop_job:"stop_job",end_job:"end_job",webapp_finish:"webapp_finish",tree_updated:"tree_updated",add_job:"add_job",clone_job:"clone_job",run_job:"run_job"};function JobDialog(e,t,i,o,n){var s;this.tree=e.tree,this.nodeId=e.nodeId,this.task=e.ancestors[0],this.dataBox=e.dataBox,this.ancestors=e.ancestors,this.parent_page=t,this.job_edited=!1,this.onClose_func=o,this._created=!1,this.dlg_active=!(__dormant||this.tree.in_archive||"archive_version"in this.task),this.task.state==job_code.remark&&this.task.openWebLink()?o(this):(Widget.call(this,"div"),e="["+padDigits(this.task.id,4)+"] ",0<this.task.uname.length?e+=this.task.uname:e+=this.task.name,e+=this.statusLine(),this.element.setAttribute("title",strip_html_tags(e)),$(this.element).css({"box-shadow":"8px 8px 16px 16px rgba(0,0,0,0.2)",overflow:"hidden"}),document.body.appendChild(this.element),this.inputPanel=null,this.outputPanel=null,this.run_btn=null,this.autorun_cbx=null,this.run_image=null,this.ind_timer=null,this.hot_btn=[],t=calcDialogSize(__user_settings.jobdlg_size[0],__user_settings.jobdlg_size[1],1,1,this.task.job_dialog_data),this.initialWidth=t[0],this.initialHeight=t[1],(s=this).dialog_options={resizable:!0,width:t[0],height:t[1],buttons:{},open:function(e,t){__any_mobile_device&&$(this).siblings(".ui-dialog-titlebar").remove(),s.task.state==job_code.new?window.setTimeout(function(){s.task.onJobDialogStart(s),s._created=!0,s.setDlgSize()},100):(s._created=!0,s.setDlgSize())},focus:function(){n&&n(s,job_dialog_reason.select_node,null)}},this.dialog_options.position=__any_mobile_device?{my:"left top",at:"left top"}:this.task.job_dialog_data.position,this.makeLayout(i),$(this.element).dialog(this.dialog_options),this.setDlgState(),s=this,$(s.element).on("dialogclose",function(e,t){s.delete()}),s.task.state!=job_code.running&&s.inputPanel&&!s.tree.in_archive&&s.inputPanel.element.addEventListener(cofe_signals.jobDlgSignal,function(e){n(s,e.detail,null)},!1),this.onDlgSignal_func=n,this.task.updateInputPanel(this.inputPanel))}function LicenceDialog(e,t){Widget.call(this,"div"),this.element.setAttribute("title","Licence"),document.body.appendChild(this.element);var i=new Grid(""),o=(this.addWidget(i),i.setLabel("<h3>Choose your licence type</h3>",0,0,1,3),i.setLabel('Using CCP4 Software is subject to appropriate licencing. Please choose licence, applicable to your situation, from choices below. In case of doubts, please contact CCP4 at <a href="mailto:'+__maintainerEmail+'?Subject=License%20enquiry">'+__maintainerEmail+"</a>.<br>&nbsp;",1,0,1,3),new RadioButton("Academic",!1)),n=new RadioButton("Commercial",!1),i=(i.setWidget(o,2,0,1,1),i.setWidget(n,3,0,1,1),i.setLabel("&nbsp;",2,1,1,1).setWidth_px(10),i.setLabel("You may choose this license if you are employed by a publicly-funded or educational research organisation, such as an University, National Laboratory, Research Council or similar, and all results of your research may be published in open journals. This excludes working on industrial contracts, if all or some of the results become a private property of funders or may not be published. Academic licences are free of charge but require a formal registration with CCP4. By choosing Academic Licence you hereby give your permission to retain your registration data by CCP4. Your data will be used only for verification of you as a user and for anonymous statistics.<br>&nbsp;",2,2,1,1),i.setLabel('You should choose this licence if you are employed by any commercial (for-profit) organisation, such as a pharmaceutical company, or if any part of your work is funded by such an organisation, leading to a restricted public access to your results or impossibility to publish them freely. This applies to otherwise academic groups working on industrial contracts, where final results or part of them become a private property of funders. Commercial licences are subject to paying a licence fee. Please contact CCP4 at <a href="mailto:'+__maintainerEmail+'?Subject=License%20enquiry">'+__maintainerEmail+"</a> in order to obtain licence terms and quote. You should not use CCP4 Software if you qualify for Commercial Licence but have not acquired one yet. Note that CCP4 Licences are issued on per-organisation basis, therefore, you may wish to check whether you are already covered by your Employer.<br>&nbsp;",3,2,1,1),i.setCellSize("100%","",2,2),3*$(window).width()/5+"px");$(this.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:i,modal:!0,buttons:[{id:"choose_btn",text:"Choose",click:function(){o.getValue()?t(licence_code.academic):t(licence_code.commercial),$(this).dialog("close")}},{id:"cancel_btn",text:"Cancel",click:function(){t(e),$(this).dialog("close")}}]}),e==licence_code.academic?o.setValue(!0):e==licence_code.commercial?n.setValue(!0):$("#choose_btn").button("disable"),o.setWidth_px($(n.element).width()),$(o.element).click(function(){$("#choose_btn").button("enable"),n.setValue(!1)}),$(n.element).click(function(){$("#choose_btn").button("enable"),o.setValue(!1)})}function ManageUserDialog(e,t,o){if(Widget.call(this,"div"),this.element.setAttribute("title","Manage User "+e.login),document.body.appendChild(this.element),this.grid=new Grid(""),this.addWidget(this.grid),this.userData=e,this.diskNames=[],isObject(t.projectsPath))for(var i in t.projectsPath)this.diskNames.push(i);var n;this.diskNames.indexOf(e.volume)<0&&this.diskNames.push(e.volume),this.makeLayout(),n=this,$(n.element).dialog({resizable:!1,height:"auto",maxHeight:600,width:"auto",modal:!0,buttons:[{id:"update_btn",text:"Update",click:function(){n.userData.role=[role_code.user,role_code.admin,role_code.developer][n.profile.getValue()],n.userData.licence=["academic","commercial"][n.licence.getValue()],1==n.status.getValue()?n.userData.dormant||(n.userData.dormant=Date.now()):n.userData.dormant=0;var e=n.diskNames[n.volume.getValue()],t=(n.userData.ration.storage=n.storage.getValue(),n.userData.ration.storage_max=n.storage_max.getValue(),n.userData.ration.cpu_day=n.cpu_day.getValue(),n.userData.ration.cpu_month=n.cpu_month.getValue(),n.userData.ration.cloudrun_day=n.cloudrun_day.getValue(),n.userData.ration.archive_year=n.archive_year.getValue(),"");e!=n.userData.volume&&(t="<p><b>NOTE:</b> storage disk for user's projects will be changed. This is a potentially dangerous procedure, which, if unsuccessful, can result in loss of some or all user data. Therefore, consider preliminary backup or export of user's projects.<p><i><u>Please make sure that:</u></i><ul><li>the destination volume has enough of space to accept user's data</li><li>no user's jobs are running or are queuing on any number cruncher during the change</li><li>that the system is not shut down or restarted before the change is complete</li></li></ul>The user will be forcibly logged out and their account suspended until the change is complete. After that, the account will be released automatically.<p><i><u>This operation can take considerable time</u></i>."),new QuestionBox("Modify User Account",'<div style="width:600px;"><h2>Modify User Account</h2>Current account settings of user "<i>'+n.userData.name+'</i>" will be replaced with ones shown in the dialog, and the user will be informed of the change via e-mail. '+t+"<p>Please confirm this action.</div>",[{name:"Yes, modify",onclick:function(){n.userData.volume=e,serverRequest(fe_reqtype.updateUData_admin,n.userData,"Manage User Data",function(e){e?new MessageBoxW("Manage User Data",e,.5):new MessageBox("Manage User Data","Account of <i>"+n.userData.name+"</i> has been successfully updated, and notification<br>sent to e-mail address:<p><b><i>"+n.userData.email+"</i></b>.","msg_confirm"),o(),$(n.element).dialog("close")},null,"persist")}},{name:"Cancel",onclick:function(){}}],"msg_confirm")}},{id:"resetpwd_btn",text:"Reset password",click:function(){new QuestionBox("Reset User Password","<h2>Reset User Password</h2>Password of <i>"+n.userData.name+"</i> will be replaced with a randomly<br>generated one, and sent to the user via e-mail.<p>Are you sure?",[{name:"Yes, reset",onclick:function(){serverRequest(fe_reqtype.resetUser_admin,n.userData,"Reset User Password",function(e){e?new MessageBoxW("Reset User Password",e,.5):new MessageBox("Reset User Password","Password of <i>"+n.userData.name+"</i> has been successfully reset, and notification<br>sent to e-mail address:<p><b><i>"+n.userData.email+"</i></b>.","msg_ok"),o(),$(n.element).dialog("close")},null,"persist")}},{name:"Cancel",onclick:function(){}}],"msg_confirm")}},{id:"delete_btn",text:"Delete User",click:function(){new QuestionBox("Delete User Account",'<div style="width:450px;"><h2>Delete User Account "'+n.userData.login+'"</h2>Account "<i>'+n.userData.login+'</i>" will be deleted.<p>Once deleted, all user data, including registration details, imported files, projects and results will be removed from the server irrevocably.<p>Are you sure?</div>',[{name:"Yes, delete",onclick:function(){serverRequest(fe_reqtype.deleteUser_admin,n.userData,"Delete User",function(e){e?new MessageBoxW("Delete User",e,.5):new MessageBox("Delete User","Account of <i>"+n.userData.name+"</i> has been successfully deleted, and notification<br>sent to e-mail address:<p><b><i>"+n.userData.email+"</i></b>."),o(),$(n.element).dialog("close")},null,"persist")}},{name:"Cancel",onclick:function(){}}],"msg_question")}},{id:"retire_btn",text:"Retire User",click:function(){var e=new InputBox("Retire user"),t=(e.setText("","user_leaving"),e.grid),i=(t.setLabel('<div style="width:350px"><h2>Retire user "'+n.userData.login+'"</h2>User\'s projects will be moved to the Successor.<p><span style="font-size:85%"><i>User and Successor will be logged out and their accounts suspended until the move is complete.</i></span></div>',0,2,2,3),t.setLabel("Successor:&nbsp;",2,2,1,1),t.setInputText("",2,3,1,1).setStyle("text","^[A-Za-z][A-Za-z0-9\\-\\._-]+$","login name of successor","").setFontItalic(!0).setWidth("250px"));t.setNoWrap(2,2),t.setVerticalAlignment(2,3,"middle"),e.addWidget(t),e.launch("Retire now",function(){var e=i.getValue();return e.length<=0?(new MessageBox("No login name","<h2>Successor login name not given</h2>Successor login name must be specified.","msg_stop"),!1):i.element.validity.patternMismatch?(new MessageBox("Invalid login name","<h2>Invalid login name</h2>Provide a valid login name.","msg_stop"),!1):(serverRequest(fe_reqtype.retireUser_admin,{userData:n.userData,successor:e},"Retire User",function(e){var t="";switch(e.code){case"duplicate_users":t="Unsuitable successor name";break;case"no_privileges":t="No privileges";break;case"duplicate_ids":t="Duplicate project IDs";break;case"started":break;default:alert("Unknown stop code.\nresponse="+JSON.stringify(e))}t?new MessageBox(t,'<div style="width:400px"><h2>'+t+"</h2>"+e.message+".</div>","msg_stop"):(o(),$(n.element).dialog("close"))},null,"persist"),!0)})}},{id:"cancel_btn",text:"Close",click:function(){$(n.element).dialog("close")}}]})}function ProjectSettingsDialog(e,t){Widget.call(this,"div"),this.element.setAttribute("title","Project Settings"),document.body.appendChild(this.element);var i,o=e.projectData.settings,n=(this.grid=new Grid(""),this.addWidget(this.grid),this.grid.setLabel("File name prefix to prepend all generated file names:&nbsp;&nbsp;",0,0,1,1).setTooltip("Chosen prefix will be used for forming file names in all project tasks"),null),s=new InputText(o.prefix);s.setStyle("text","^[A-Za-z0-9\\-\\._]+$","","File prefix should contain only latin letters, numbers, undescores, dashes and dots, and must start with a letter. Specified prefix, unless blank, will be used for forming output file names in this project").setFontItalic(!0).setWidth("100pt"),__user_settings.hasOwnProperty("project_prefix")&&__user_settings.project_prefix?((n=new Dropdown).setTooltip('Choose whether "<i>Project name</i>" should be used for file name prefixing (this is the default option chosen in your account settings), or select "<i>Custom</i>" for specifying a particular prefix in this project.').setWidth("130pt"),n.addItem("Project name","",0,1!=o.prefix_key),n.addItem("Custom","",1,1==o.prefix_key),n.make(),this.grid.setWidget(n,0,1,1,1),i=this.grid.setInputText(e.projectData.desc.name,0,2,1,1).setReadOnly(!0).setWidth("100pt"),this.grid.addWidget(s,0,2,1,1),i.setVisible(0==o.prefix_key),s.setVisible(0!=o.prefix_key),n.addOnChangeListener(function(e,t){i.setVisible(1!=t),s.setVisible(1==t)})):this.grid.setWidget(s,0,1,1,1);for(var a=0;a<3;a++)this.grid.setVerticalAlignment(0,a,"middle");$(this.element).dialog({resizable:!0,height:"auto",width:"auto",modal:!0,buttons:{Save:function(){o.prefix_key=n?n.getValue():2,s.isVisible()&&(o.prefix=s.getValue()),window.setTimeout(function(){t()},0),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})}function SearchArchiveDialog(i){Widget.call(this,"div"),this.element.setAttribute("title","Search "+appName()+" archive"),document.body.appendChild(this.element),this.makeLayout();var e=this;$(this.element).dialog({resizable:!1,height:"auto",width:"auto",modal:!0,closeOnEscape:!1,open:function(e,t){$(this).parent().children().children(".ui-dialog-titlebar-close").hide()},buttons:[{id:"archdlg_search_btn",text:"Search",click:function(){var t;t=this,e.searchArchive(function(e){e&&(i(!0),$(t).dialog("close"))})}},{id:"archdlg_search_cancel_btn",text:"Cancel",click:function(){i(!1),$(this).dialog("close")}}]})}function shareProject(n,s){var e,a,t=getProjectAuthor(n);t!=__login_id&&t.toLowerCase()!=folder_type.tutorials?(new MessageBox("Share Project","Only Project owner (<b>"+t+"</b>) can share this Project.","msg_information"),s(null)):n.archive&&n.archive.in_archive?(new MessageBox("Archived Project",'<div style="width:450px"><h2>Archived Project</h2>Projects in '+appName()+" Archive cannot be shared. Instead, your collaborators can access this project directly from Archive by project's Archive ID.<p>If you intend to develop this project further, clone it and work on the clone, which may be also shared with others. Note that you won't be able to update project in "+appName()+" Archive from that clone unless you are the original depositor.","msg_stop"),s(null)):((t=new InputBox("Share Project")).setText('<h2>Share Project "'+n.name+'"</h2>',"share"),(e=t.grid).setLabel("The following users:<br>&nbsp;",2,2,1,1),(a=new InputText(Object.keys(n.share).join(","))).setStyle("text","","login1,login2,...",""),a.setFontItalic(!0),e.setWidget(a,3,2,1,1),a.setWidth("300pt"),e.setLabel("&nbsp;<br>can join this project and work on it simultaneously.",4,2,1,1),e.setLabel("&nbsp;<br>* Full (comma-separated) list of users with access to the project<br>must be given. In order to unshare project with a user, remove<br>their login name from the list.",5,2,1,1).setFontItalic(!0).setFontSize("85%"),t.launch("Apply",function(){var e=a.getValue(),t=n.share,i=e.split(",").map(function(e){return e.trim()}).filter(function(e,t,i){return i.indexOf(e)==t});n.share={};for(var o=0;o<i.length;o++)i[o]!=n.owner.login&&(i[o]in t?n.share[i[o]]=t[i[o]]:n.share[i[o]]={labels:{},permissions:"rw"});return serverRequest(fe_reqtype.shareProject,{desc:n,share0:t},"Share Project",function(e){if(e.desc){var t='<h2>Project "'+e.desc.name+'" Share Status</h2><b>Shared with:</b>&nbsp;<i>',i=Object.keys(e.desc.share);if(i.length<=0?t+="nobody":t=t+i.join(", ")+'<br><font size="-1">(these users can join this project and work on it simultaneously with you)</font>',t+="</i>",0<e.unshared.length){t+="<p><b>Unshared with:</b>&nbsp;<i>"+e.unshared[0].login;for(var o=1;o<e.unshared.length;o++)t+=", "+e.unshared[o].login;t+="</i>"}if(0<e.unknown.length){t+="<p><b>Unknown users:</b>&nbsp;<i>"+e.unknown[0].login;for(o=1;o<e.unknown.length;o++)t+=", "+e.unknown[o].login;t+='<br><font size="-1">(sharing request was not fulfilled for these users)</font></i>'}new MessageBox("Share Project",t,"share"),s(e.desc)}else new MessageBox("Share Project","<h2>Sharing request denied</h2><i>Only Project owner can change sharing.</i>","msg_excl"),s(null)},null,null),!0}))}function TaskDataDialog(e,t,i){Widget.call(this,"div"),this.element.setAttribute("title",t.title),document.body.appendChild(this.element),this.grid=new Grid(""),this.addWidget(this.grid);var o=0;if("ok"!=i[0])this.grid.setLabel(i[2],o++,0,1,2);else if(t.getInputMode()==input_mode.root)this.grid.setLabel("This task:<h3>"+t.title+"</h3>can be run only on top of Project.<p><hr/><i>Highlight the top node of the job tree and add this task from there.</i>",o++,0,1,2);else{var n=0;for(r in e)"status"!=r&&n++;if(n<=0)this.grid.setLabel("<h3>Data summary</h3>This task does not use data from any other task in "+appName()+".",o++,0,1,2);else{var i=this.grid.setLabel("",o++,0,1,2).setWidth("650px"),s=this.grid.setTable(o++,0,1,2);s.setHeaderText("Input Data",0,0,1,1),s.setHeaderText("Status",0,1,1,1),s.setHeaderText("Required",0,2,1,1),s.setHeaderText("Available",0,3,1,1);for(var a=0;a<4;a++)s.setNoWrap(0,a);var r,l,c=1,d=[],h=!0,u=0,p=0;for(r in e)if("status"!=r){switch(s.setLabel(this.getDataDescription(e[r]),c,0,1,1),e[r].status){default:case 0:l=image_path("data_absent"),d=d.concat(e[r].hints),h=!1;break;case 1:l=image_path("ok_amber");break;case 2:l=image_path("ok")}s.setImage(l,"","20px",c,1,1,1),e[r].n_allowed<=0?(0<e[r].n_available&&u++,s.setLabel("not allowed",c,2,1,1)):e[r].n_required<=0?s.setLabel("optional",c,2,1,1):(e[r].n_available<=0&&p++,s.setLabel(e[r].n_required,c,2,1,1)),e[r].n_available<=0?s.setLabel("none",c,3,1,1):s.setLabel(e[r].n_available,c,3,1,1),c++}for(var m,f='"Trebuchet MS", Arial, Helvetica, sans-serif',g=0;g<c;g++)s.setNoWrap(g,0),s.setHorizontalAlignment(g,0,"left").setFontFamily(g,0,f),s.setHorizontalAlignment(g,1,"center"),s.setHorizontalAlignment(g,2,"right").setFontFamily(g,2,f),s.setHorizontalAlignment(g,3,"right").setFontFamily(g,3,f),s.setVerticalAlignment(g,0,"middle"),s.setVerticalAlignment(g,1,"middle"),s.setVerticalAlignment(g,2,"middle"),s.setVerticalAlignment(g,3,"middle");if(h?i.setText("<h3>Data summary</h3>"):(m=t="",m=0<u&&p<=0?(t="<h2>Project workflow restrictions</h2>This task cannot be run at this point of the project, because data type(s), shown below, are present but not allowed.","Branch your project by adding this task to a node of the project tree, where disallowed data do not exist (before they were created or imported)."):0<u&&0<p?(t="<h2>Missing data and project workflow restrictions</h2>Full set of data, needed to run this task, was not imported or otherwise generated. In addition, this task cannot be run at this point of the project, because data type(s), shown below, are present but not allowed.","Use <b><i>Import</i></b> task to import missing data, or run respective job(s) in order to generate them.Also, branch your project by adding this task to a node of the project tree, where disallowed data do not exist (before they were created or imported)."):(t="<h2>Insufficient data</h2>Full set of data, needed to run this task, was not imported or otherwise generated.","Use <b><i>Import</i></b> task to import missing data, or run respective job(s) in order to generate them."),i.setText(t+"<p><h3>Data summary</h3>"),this.grid.setLabel("&nbsp;<p>"+m+" Check data types and respective job summary <a href=\"javascript:launchHelpBox('Data Management','"+__task_reference_base_url+"doc.task.Import.html#ccp4-cloud-data-management',null,10)\"><i>"+String("here").fontcolor("blue")+"</i></a>.",o++,0,1,2).setWidth("650px")),1==(d=d.filter(function(e){return""!=e.trim()})).length)this.grid.setLabel("<b><i>Hint:</i></b>",o,0,1,1),this.grid.setLabel(d[0],o,1,1,1).setWidth_px(600);else for(g=0;g<d.length;g++)this.grid.setLabel("<b><i>Hint&nbsp;"+(g+1)+":</i></b>",o,0,1,1),this.grid.setLabel(d[g],o++,1,1,1).setWidth_px(600)}}$(this.element).dialog({resizable:!0,height:"auto",width:"auto",modal:!0,buttons:{Close:function(){$(this).dialog("close")}}})}function TaskListDialog(e,t,i,o){Widget.call(this,"div"),this.element.setAttribute("title","Task List"),document.body.appendChild(this.element);var n=i.projectData.desc;this.branch_tasks=[];for(var s=0;s<t.length;s++)t[s].isRemark()||this.branch_tasks.push(t[s]);this.dataBox=e,this.task=this.branch_tasks[0],this.onSelect_func=o,this.selected_task=null,this.dlg_width=window.innerWidth,this.dlg_width=Math.min(Math.max(700,4*this.dlg_width/9),6*this.dlg_width/8),this.dlg_height=6*window.innerHeight/8,this.listAtoZ=[],this.tabs_basic=null,this.tabs_full=null,this.tabs_AtoZ=null,this.combobox=null,this.combobox_lbl=null;var a,r=__user_guide_base_url+"jscofe_tasklist.html";n.startmode==start_mode.migrate?(this.makeLayout(30),this.combobox=new Combobox,this.combobox.addItem("Basic task list","basic",n.tasklistmode==tasklist_mode.basic).addItem("Full task list","full",n.tasklistmode==tasklist_mode.full).setWidth("180px")):n.startmode==start_mode.auto?0<i.countTasks()?(t.length<1?this.makeLayout(21):this.makeLayout(22),this.combobox=new Combobox,this.combobox.addItem("Basic task list","basic",n.tasklistmode==tasklist_mode.basic).addItem("Full task list","full",n.tasklistmode==tasklist_mode.full).setWidth("180px")):(this.makeLayout(20),r=__user_guide_base_url+"jscofe_workflows.html"):this.makeLayout(10),this.combobox&&(this.combobox_lbl=new Label("Switch to full list<br>for more tasks"),this.combobox_lbl.setFontSize("80%").setFontItalic(!0).setWidth("150px")),this.tabs_basic&&(this.tabs_basic.setVisible(n.tasklistmode==tasklist_mode.basic),this.tabs_full.setVisible(n.tasklistmode==tasklist_mode.full),this.combobox_lbl.setVisible(n.tasklistmode==tasklist_mode.basic)),a=this,$(a.element).dialog({resizable:!0,height:a.dlg_height,width:a.dlg_width,maxHeight:$(window).height()-20,modal:!0,create:function(e,t){var i,o;a.combobox&&(i=$(this).dialog("widget").find(".ui-dialog-buttonpane"),o=new Widget("span"),$(o.element).prependTo(i),o.addWidget(a.combobox),a.combobox.make(),$(o.element).css({position:"relative",left:"10px",top:"8px"}),o.addWidget(a.combobox_lbl),$(a.combobox_lbl.element).css({position:"relative",left:"200px",top:"32px","margin-top":"-64px"}))},buttons:[{text:"Help",click:function(){new HelpBox("",r,null)}},{text:"Cancel",click:function(){a.combobox?a.onSelect_func(null,a.combobox.getValue()):a.onSelect_func(null,null),$(this).dialog("close")}}]}),$(a.element).on("dialogresize",function(e,t){var i=a.element.innerHeight-16;a.tabs_basic&&($(a.tabs_basic.element).height(i),a.tabs_basic.refresh()),a.tabs_full&&($(a.tabs_full.element).height(i),a.tabs_full.refresh())}),a.combobox&&a.combobox.addOnChangeListener(function(e,t){a.tabs_basic.setVisible(e==tasklist_mode.basic),a.tabs_full.setVisible(e==tasklist_mode.full),a.combobox_lbl.setVisible(e==tasklist_mode.basic),("full"==e?a.tabs_full:a.tabs_basic).refresh()}),$(this.element).css("width:100%"),this.combobox&&($(this.tabs_basic.element).height(this.element.innerHeight-16),this.tabs_basic.refresh()),this.tabs_full&&($(this.tabs_full.element).height(this.element.innerHeight-16),this.tabs_full.refresh())}function FacilityUserDialog(i,o){var e,t,n,s;i.facility?(Widget.call(this,"div"),this.element.setAttribute("title","Facility User Authentication"),document.body.appendChild(this.element),e=new Grid("-compact"),this.addWidget(e),t=0,e.setImage(i.facility.icon,"","80px",0,0,1,1),e.setLabel(" ",0,1,1,1).setWidth_px(10).setHeight("0.5em"),e.setLabel("<b>"+i.facility.title+"</b>",0,2,1,1).setFontSize("150%").setNoWrap(),e.setVerticalAlignment(0,2,"middle"),t++,e.setLabel("<hr/>",t++,0,1,4),e.setLabel("User ID",2,0,1,1),e.setLabel("&nbsp;",2,1,1,1),e.setLabel("Password",3,0,1,1),e.setLabel("&nbsp;",3,1,1,1),e.setVerticalAlignment(2,0,"middle"),e.setVerticalAlignment(3,0,"middle"),n=new InputText(i.uid),s=new InputText(""),i.uid&&n.setReadOnly(!0),n.setFontItalic(!0).setStyle("text","","login name",""),s.setFontItalic(!0).setStyle("password","","password",""),e.setWidget(n,2,2,1,1),e.setWidget(s,3,2,1,1),$(this.element).dialog({resizable:!1,height:"auto",width:"auto",modal:!0,buttons:[{text:"Authenticate",click:function(){var e=n.getValue().trim(),t=s.getValue().trim();""==e?new MessageBox("Error","User ID cannot be blank","msg_error"):(i.uid=e,i.pwd=t,$(this).dialog("close"),window.setTimeout(function(){o(e,t)},0))}},{text:"Cancel",click:function(){$(this).dialog("close"),window.setTimeout(function(){o("","")},0)}}]})):new MessageBox("Error","No facility to update.","msg_error")}function FacilityCheckDialog(e,i){Widget.call(this,"div"),this.element.setAttribute("title","Communication"),document.body.appendChild(this.element);var o,n,t=new Grid("-compact"),s=(this.addWidget(t),0),s=(t.setLabel("Communicating with facility.<br>This may take long time, please wait ...",+s,0,1,1),new ProgressBar(0));t.setWidget(s,1,0,1,1),o=this,$(o.element).dialog({resizable:!1,height:"auto",width:"auto",modal:!0,buttons:[{text:"Stop waiting",click:function(){new QuestionBox("Stop waiting","&nbsp;<br><b>Stop waiting, are you sure?</b><p><i>Closing this dialog will not terminate current operation,<br>but unlock the interface and let you do other tasks.<br>However, facility tree will not refresh automatically<br>after request is complete.</i>",[{name:"Stop waiting",onclick:function(){$(o.element).dialog("close")}},{name:"Wait",onclick:function(){}}],"msg_confirm")}}]}),(n={}).tid=e.id,n.project=e.project,window.setTimeout(function t(){serverRequest(fe_reqtype.checkFclUpdate,n,e.title,function(e){e.status==fe_retcode.inProgress?window.setTimeout(t,2e3):($(o.element).dialog("close"),e.status==fe_retcode.readError?new MessageBox("Errors","&nbsp;<br><b>File read errors.</b><p><i>This is a server-side error caused by program bug<br>or hardware malfunction. Apologies.</i>","msg_error"):e.status==fe_retcode.fileNotFound?new MessageBox("Errors","&nbsp;<br><b>File not found.</b><p><i>This is a server-side error caused by program bug<br>or hardware malfunction. Apologies.</i>","msg_error"):e.status!=fe_retcode.ok&&e.status!=fe_retcode.askPassword&&new MessageBox("Errors","&nbsp;<br><b>"+e.status+"</b><br>&nbsp;","msg_error"),i(e))},null,function(){window.setTimeout(t,2e3)})},2e3)}function FacilityBrowser(e,t){this.inputPanel=e,this.task=t,this.uid="",this.pwd="",Widget.call(this,"div"),this.element.setAttribute("title","Facility Browser"),document.body.appendChild(this.element),this.grid=new Grid("-compact"),this.addWidget(this.grid),this.tree_panel=this.grid.setPanel(0,0,1,1),this.tree_panel.element.setAttribute("class","tree-content"),this.facilityTree=null,this.loadFacilityTree();var i,e=Math.round(2*$(window).width()/3),t=Math.round(5*$(window).height()/6);this.btn_ids=[this.id+"_update_btn",this.id+"_choose_btn"],i=this,$(i.element).dialog({resizable:!0,height:t,width:e,modal:!0,buttons:[{text:"Update",id:i.btn_ids[0],click:function(){i.openItem()}},{text:"Choose",id:i.btn_ids[1],click:function(){i.updateItem(!1)}},{text:"Cancel",click:function(){$(this).dialog("close")}}]})}function CloudFileBrowser(e,t,i,o,n,s){this.inputPanel=e,this.tree_type="files",t.hasOwnProperty("tree_type")&&(this.tree_type=t.tree_type),this.task=t,this.file_key=i,this.ext_filter=o,this.onSelect_func=n,this.uid="",this.pwd="",Widget.call(this,"div"),this.element.setAttribute("title","Cloud File Browser"),document.body.appendChild(this.element),this.grid=new Grid("-compact"),this.grid.setWidth("100%"),this.addWidget(this.grid),this.dir_desc=this.grid.setLabel("",0,0,1,1).setWidth("100%"),this.tree_panel=this.grid.setPanel(1,0,1,1),this.tree_panel.element.setAttribute("class","tree-content"),this.storageTree=null,this.tree_loading=!1,this.loadStorageTree(this.task.currentCloudPath);var a,e={resizable:!0,modal:!0};e.width=Math.max(500,Math.round(+window.innerWidth/2)),e.height=Math.round(5*window.innerHeight/6),this.btn_ids=[this.id+"_open_btn",this.id+"_select_btn",this.id+"_cancel_btn"],e.buttons=[{text:"Cancel",id:this.btn_ids[2],click:function(){$(this).dialog("close")}}],$(this.element).dialog(e),a=this,$(a.element).on("dialogclose",function(e,t){$(a.element).dialog("destroy"),s&&s(),a.delete()})}function calcDialogSize(e,t,i,o,n){var s,a,r=window.innerWidth,l=window.innerHeight;return __any_mobile_device?(s=i*$(window).width()-8,a=o*$(window).height()-40,__iOS_device?a+=36:__mobile_device&&(a+=24)):(s=2*r,a=2*l,n&&(0<n.width&&(s=n.width),0<n.height&&(a=n.height)),(r<=s||l<=a)&&(r-=8,l-=42,0<e&&(s=Math.min(e*Math.min(r,l),r)),0<t&&(a=Math.min(t*Math.min(r,l),l)),n&&(n.position={my:"center top",at:"center top+"+(l-a)/2+"px"},n.width=0,n.height=0))),[s=s<=0?"auto":s,a=a<=0?"auto":a]}function MessageAJAXFailure(e,t,i){var o="<h2>Communication errors</h2>";t?(0===t.status?o+="Not connected. Please check your network connection.":404==t.status?o+="The requested page not found. [404]":500==t.status?o+="Internal Server Error [500].":o+="parsererror"===i?"Requested JSON parse failed.":"timeout"===i?"Time out error.":"abort"===i?"Ajax request aborted.":"Uncaught Error.<br>"+t.responseText,o="<b><i>"+o+"</i></b><p><b>Status:</b><i> "+t.status+"</i><br><b>Description:</b><i> "+t.statusText+"</i><br><b>Response text:</b><i> "+t.responseText+"</i><br><b>Error:</b><i> "+i+"</i>"):o+="<b><i>Unknown error.</i></b>",new MessageBox(e,'<div style="width:450px">'+o+"<p>This may be an intermittent error due to a poor internet connection, however, persistent appearance of this message is likely to indicate "+appName()+" failure or temporary shutdown.</div>","msg_error")}function MessageNoProjectDataError(e,t){var i="<h2>General failure: project metadata not found on server</h2>";0<t.length&&(i+="Server replied: <i>"+t+"</i>"),new MessageBox(e,i+"<p>This is an internal error, and the respective maintener has been informed.<p>Sorry and please come back later!","msg_error")}function MessageDataWriteError(e,t){var i="<h2>General failure: data cannot be written</h2>";0<t.length&&(i+="Server replied: <i>"+t+"</i>"),new MessageBox(e,i+"<p>This is an internal error, and the respective maintener has been informed.<p>Sorry and please come back later!","msg_error")}function MessageMkDirError(e,t){var i="<h2>General failure: cannot create a directory.</h2>";0<t.length&&(i+="<p>Server replied: <i>"+t+"</i>"),new MessageBox(e,i+"<p>This is an internal error, and the respective maintener has been informed.<p>Sorry and please come back later!","msg_error")}function MessageDataReadError(e,t){var i="<h2>General failure: data cannot be read.</h2>";0<t.length&&(i+="<p>Server replied: <i>"+t+"</i>"),new MessageBox(e,i+"<p>This is an internal error, and the respective maintener has been informed.<p>Sorry and please come back later!","msg_error")}function MessageNotLoggedIn(e){__current_page&&0<=["LogoutPage","LoginPage"].indexOf(__current_page._type)||new MessageBox(e,'<div style="width:500px"><h2>User not logged in.</h2><p>This may result from duplicate logging (either explicitly in another browser or machine, or implicitly by, e.g., copy/pasting URL in another browser tab or window), or using forward/back/reload buttons in your browser.<p>Please log in again.<p>If problem persists, please report to '+report_problem("CCP4 Cloud Report: D0001","Report code: D0001","")+".</div>","msg_stop")}function MessageUploadErrors(e,t){var i="<h2>General failure: upload errors.</h2>";0<t.length&&(i+="<p>Server replied: <i>"+t+"</i>"),new MessageBox(e,i+"<p>This is an internal error, and the respective maintener has been informed.<p>Sorry and please come back later!","msg_error")}function MessageNoJobDir(e){new MessageBox(e,'<div style="width:500px"><h2>Job directory not found on server.</h2><p>This may result from duplicate logging (either explicitly in another browser or machine, or implicitly by, e.g., copy/pasting URL in anotherbrowser tab or window), or using forward/back/reload buttons in your browser.<p>Please log in again and repeat your actions.<p>If problem persists, please report to '+report_problem("CCP4 Cloud Report: D0002","Report code: D0002","")+".</div>","msg_error")}function MessageProxyError(e){new MessageBox(e,"<h2>Proxy server error.</h2><p>Usually, this means that connection with "+appName()+" is lost.<br>Please check your internet connection. <p>If problem persists, please report to "+report_problem("CCP4 Cloud Report: D0003","Report code: D0003","")+".","msg_error")}function MessageProjectAccess(e){new MessageBox(e,"<h2>Project Access Denied</h2><p>The Project is no longer available to you. Most probably, it was<br>unshared with you by the project owner. You may delete this<br>project from your <i>Project List</i> now.<p>If problem persists, please report to "+report_problem("CCP4 Cloud Report: D0004","Report code: D0004","")+".","msg_error")}function MessageServerInactive(){new MessageBox("Server Inactive",'<div style="width:500px"><h2>'+appName()+" Inactive</h2><p>"+appName()+" is inactive, which may be because of starting up, shutting down or being temporary suspended for maintenance.<p>Please come back later.</div>","msg_stop")}function MessageFileNotFound(e){new MessageBox("File not found",'<div style="width:500px"><h2>File not found</h2><p>'+e+"<p>Please come back later.</div>","msg_error")}function MessageUnknownError(e,t){new MessageBox("Unknown error",'<div style="width:500px"><h2>Unknown error.</h2> The server replied with:<p><i>'+t+"</i><p>Please file a report to "+report_problem("CCP4 Cloud Report: D0005","Report code: D0005","")+". Sorry and please come back later!</div>","msg_error")}function Dock(e,o,n,t){var i;this.opened=!1,this.dock=new Widget("div"),$(this.dock.element).css({position:"absolute",right:"16px",top:"46px","padding-top":"4px","padding-left":"20px","padding-bottom":"4px","padding-right":"20px","background-color":"rgba(242,242,242,0.67)",border:"1px solid gray","border-radius":"8px","box-shadow":"5px 5px 6px #888888","white-space":"nowrap"}),$(this.dock.element).appendTo(e.element),this.dock.setVisible(!1),(i=this).sortable=new Sortable(26,24,function(e,t,i){window.setTimeout(function(){o(e,t,i)},100)},function(e,t,i){return n(e,t,i)},function(e,t){i.saveDockData()}),this.dock.addWidget(this.sortable),this.sortable.setWidth_px(256),this.addTask_func=t,this.loadDockData()}function BasePage(e,t,i){var o;$(document.body).empty(),$("<div>").attr("id",e).addClass("main-page").appendTo(document.body),checkBrowser(),checkAnnouncement(),clearNetworkIndicators(),getClientCode()==client_code.ccp4?(o=__local_setup?"background_local":"background_remote",$("#"+e).css({"background-image":"url('"+image_path(o)+"')","background-repeat":"no-repeat","background-size":"cover","background-position":"center center"})):$("#"+e).css({"background-image":"url('"+image_path("ccpem_background")+"')","background-repeat":"no-repeat","background-size":"cover","background-position":"center center"}),this.element=document.getElementById(e),this._type=i,this.sceneId=e,this.ration=null,this.rationPanel=null,this.toolPanel=null,this.grid=new Grid(t),$(this.grid.element).appendTo(this.element),this.getUserRation()}JobDialog.prototype=Object.create(Widget.prototype),JobDialog.prototype.constructor=JobDialog,JobDialog.prototype.delete=function(){this.inputPanel&&(this.inputPanel.delete(),this.inputPanel=null),this.outputPanel&&(this.outputPanel.delete(),this.outputPanel=null),this._created&&(this._created=!1,$(this.element).dialog("destroy")),this.onClose_func&&this.onClose_func(this),Widget.prototype.delete.call(this)},JobDialog.prototype.changeTitle=function(e){e="["+padDigits(this.task.id,4)+"] "+e+this.statusLine();$(this.element).dialog({title:strip_html_tags(e)})},JobDialog.prototype.statusLine=function(){switch(this.task.state){case job_code.new:return" (new)";case job_code.running:return" -- running";case job_code.finished:return" -- completed";case job_code.noresults:return" -- finished";case job_code.failed:return" -- failed";case job_code.stopped:return" -- terminated by user"}return""},JobDialog.prototype.displayInputErrors=function(e){if("#"==e[0])new MessageBox("Input errors",'<div style="width:450px;">'+e.substring(1)+"</div>","msg_error");else{for(var t=e.split("|"),i=[],o=0;o<t.length;o++){var n=t[o].trim();n&&i.push(n)}0<i.length&&new MessageBox("Input errors",'<div style="width:550px;"><h2>Input errors</h2>The following errors occurred while processing task input:<p><ul><li>'+i.join("</li><li>")+"</li></ul><p>Please correct the task input as appropriate.</h2>","msg_error")}},JobDialog.prototype.setDlgState=function(){this.task.state==job_code.remdoc&&this.toolBar&&(this.toolBar.setVisible(!1),this.toolBarSep.setVisible(!1),this.toolBar=null,this.outputPanel.setFramePosition("16px","8px","100%","100%"),this.onDlgResize());for(var e,t=this.task.state==job_code.new||this.task.state==job_code.remark||this.task.state==job_code.remdet,i=this.task.state==job_code.running||this.task.state==job_code.ending,o=(this.inputPanel&&(this.inputPanel.setDisabledAll(!t),this.tree.in_archive||this.task.disableInputWidgets(this.inputPanel,!t)),this.radioSet&&this.radioSet.setDisabled(t),this.run_btn&&(this.run_btn.setVisible(t),this.run_btn.setDisabled(!this.dlg_active)),this.autorun_cbx&&(this.autorun_cbx.setVisible(t),this.autorun_cbx.setDisabled(!this.dlg_active)),this.ind_timer&&window.clearTimeout(this.ind_timer),i&&!this.stop_btn.isVisible()?(e=this).ind_timer=window.setTimeout(function(){e.run_image&&e.run_image.setVisible(!0),e.stop_btn&&e.stop_btn.setVisible("browser"!=e.task.nc_type),e.end_btn&&e.end_btn.setVisible("browser"!=e.task.nc_type)},1e3):(this.run_image&&this.run_image.setVisible(i),this.stop_btn&&this.stop_btn.setVisible(i&&"browser"!=this.task.nc_type),this.end_btn&&this.end_btn.setVisible(i&&"browser"!=this.task.nc_type)),""),n=(0<this.task.uname.length?o+=this.task.uname:o+=this.task.name,this.changeTitle(o),this.dlg_active&&this.task.isComplete()),s=0;s<this.hot_btn.length;s++)this.hot_btn[s].setVisible(n),this.hot_btn[s].setEnabled(this.dlg_active&&this.task.state==job_code.finished);this.addjob_btn&&(this.addjob_btn.setVisible(n),this.addjob_btn.setEnabled(this.dlg_active&&(this.task.state==job_code.finished||this.task.isRemark()))),this.clone_btn&&this.clone_btn.setVisible(this.dlg_active&&this.task.state!=job_code.new&&!i),this.export_btn&&this.export_btn.setVisible(!this.task.isRemark()),t?(this.outputPanel.setVisible(!1),this.inputPanel.setVisible(!0),this.task.job_dialog_data.panel="input"):!i&&__local_service&&startsWith(this.outputPanel.getURL(),__local_service)&&this.loadReport()},JobDialog.prototype.getDlgSize=function(){var e;__any_mobile_device||(this.task.job_dialog_data.width=this.width_px(),this.task.job_dialog_data.height=this.height_px(),e=$(this.element).dialog("option","position"),this.task.job_dialog_data.position.my=e.my,this.task.job_dialog_data.position.at=e.at)},JobDialog.prototype.onDlgResize=function(){var e,t=this.toolBar?(e=__any_mobile_device?this.initialHeight-36-this.child[0].height_px()-this.child[1].height_px():this.task.job_dialog_data.height-36-this.child[0].height_px()-this.child[1].height_px(),this.child[1].width_px()):(e=__any_mobile_device?this.initialHeight-24:this.task.job_dialog_data.height-24,this.task.job_dialog_data.width-30);this.inputPanel&&(this.inputPanel.setSize_px(t,e),this.inputPanel.hasOwnProperty("panel")&&(this.inputPanel.hasOwnProperty("header")&&(e-=this.inputPanel.header.height_px()),this.inputPanel.panel.setSize_px(t,e)),this.task.inputPanelResize(this.inputPanel,t,e)),this.outputPanel.setSize_px(t,e)},JobDialog.prototype.setDlgSize=function(){__any_mobile_device?this.setSize_px(this.initialWidth,this.initialHeight):(this.task.job_dialog_data.height<=0&&(this.task.job_dialog_data.width=this.width_px(),this.task.job_dialog_data.height=this.initialHeight),this.setSize_px(this.task.job_dialog_data.width,this.task.job_dialog_data.height)),this.onDlgResize()},JobDialog.prototype.close=function(){this.delete()},JobDialog.prototype.hide=function(){$(this.element).parent().hide()},JobDialog.prototype.show=function(){$(this.element).parent().show()},JobDialog.prototype.loadReport=function(){var e;this.outputPanel&&(e="client"==this.task.nc_type&&this.task.state==job_code.running&&__local_service&&this.task.job_dialog_data.job_token?(e=__special_url_tag+"/"+this.task.job_dialog_data.job_token+"/"+this.task.getLocalReportPath(),__local_service+"/"+e):this.task.getReportURL(),__local_service&&(e+="?local_service"),this.outputPanel.loadPage(e))},JobDialog.prototype.reloadReport=function(){this.outputPanel&&this.outputPanel.reload()},JobDialog.prototype.collectTaskData=function(e){this.getDlgSize();var t="";return this.task.state!=job_code.new&&this.task.state!=job_code.remark&&this.task.state!=job_code.remdet||(t=this.task.collectInput(this.inputPanel),e?t="":0<t.length&&this.displayInputErrors(t),this.task.state==job_code.new&&0<t.length&&(this.job_edited=!0)),this.autorun_cbx&&(this.autorun_cbx.getValue()?this.task.autoRunId=this.task.autoRunId0:this.task.autoRunId=""),t.length<=0},JobDialog.prototype.requestServer=function(e,t){var i={};i.meta=this.task,i.ancestors=[],this.tree.projectData?i.is_shared=this.tree.isShared():i.is_shared=!1;for(var o=1;o<this.ancestors.length;o++)i.ancestors.push(this.ancestors[o]._type);this.task.job_dialog_data.viewed||(this.onDlgSignal_func(this,job_dialog_reason.reset_node,null),this.task.job_dialog_data.viewed=!0,this.job_edited=!0),i.update_tree=this.job_edited&&i.is_shared,serverRequest(e,i,this.task.title,t,null,null)},JobDialog.prototype.addToolBarButton=function(e,t,i){t=this.toolBar.setButton("",image_path(t),0,this.col++,1,1).setSize("40px","34px").setTooltip(i);return e&&t.setMargins("4px","","",""),t},JobDialog.prototype.makeToolBar=function(){this.toolBar=new Grid(""),this.col=2;for(var dlg=this,hot_list=(this.task.runButtonName()&&(this.radioSet=this.toolBar.setRadioSet(0,0,1,1).addButton("Input","input","","input"==this.task.job_dialog_data.panel).addButton("Output","output","","output"==this.task.job_dialog_data.panel),$(dlg.outputPanel.element).on("load",function(){dlg.onDlgResize()}),dlg.radioSet.make(function(e){dlg.inputPanel.setVisible("input"==e),dlg.outputPanel.setVisible("output"==e),dlg.task.job_dialog_data.panel=e,dlg.onDlgResize(),dlg.outputPanel.element.src.length<=0&&dlg.loadReport()}),this.radioSet.setSize("220px",""),this.inputPanel.fullVersionMismatch||(this.run_btn=this.toolBar.setButton(this.task.runButtonName(),image_path("runjob"),0,this.col++,1,1).setTooltip("Start job").setDisabled(!this.dlg_active),"autoRunId0"in this.task&&0<this.task.autoRunId0.length&&(this.autorun_cbx=this.toolBar.setCheckbox("Keep auto",0<this.task.autoRunId.length,0,this.col++,1,1).setTooltip("Check to start an automatic workflow").setDisabled(!this.dlg_active),dlg.autorun_cbx.addOnClickListener(function(){dlg.autorun_cbx.getValue()?dlg.task.autoRunId=dlg.task.autoRunId0:dlg.task.autoRunId="",dlg.inputPanel.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node)})))),this.toolBar.setCellSize("35%","",0,1),this.run_image=this.toolBar.setImage(activityIcon(),"36px","36px",0,this.col++,1,1),this.task.canEndGracefully()?this.end_btn=this.toolBar.setButton("End",image_path("endjob"),0,this.col++,1,1).setTooltip("End the job gracefully. This may take a long time, but will make obtaned results available for subsequent jobs. Once ended, a job cannot be resumed"):this.end_btn=null,this.stop_btn=this.toolBar.setButton("Stop",image_path("stopjob"),0,this.col++,1,1).setTooltip("Stop the job immediately. Obtained results will be kept for inspection but unavailable for subsequent jobs."),dlg.task.hotButtons()),gap=!1,dBox=null,i=0;i<hot_list.length;i++){var task_obj=eval("new "+hot_list[i].task+"()"),avail_key=task_obj.isTaskAvailable();"ok"==avail_key[0]&&(dBox=dBox||dlg.tree.harvestTaskData(1,[]),0<dBox.getDataSummary(task_obj).status&&(task_obj.hot_launch=!0,function(e){var t=dlg.addToolBarButton(gap,task_obj.icon(),hot_list[i].tooltip).addOnClickListener(function(){dlg.onDlgSignal_func(dlg,job_dialog_reason.run_job,e)});gap=!0,dlg.hot_btn.push(t)}(task_obj)))}dlg.addjob_btn=dlg.addToolBarButton(gap,"add","Add next job").addOnClickListener(function(){dlg.onDlgSignal_func(dlg,job_dialog_reason.add_job,null)}),gap=!0,dlg.clone_btn=dlg.addToolBarButton(gap,"clonejob","Clone job").addOnClickListener(function(){return dlg.onDlgSignal_func(dlg,job_dialog_reason.clone_job,null),!1}),this.task.getHelpURL()&&(this.ref_btn=this.addToolBarButton(!0,"reference","Task Documentation")),this.toolBar.setLabel("&nbsp;&nbsp;",0,this.col,1,1).setNoWrap(),this.toolBar.setCellSize("45%","",0,this.col++),this.newtab_btn=this.addToolBarButton(!1,"new_tab","Open in new tab or window"),this.export_btn=this.addToolBarButton(!1,"export","Download job data"),this.help_btn=this.addToolBarButton(!0,"help","Dialog Help"),this.close_btn=this.toolBar.setButton("Close",image_path("close"),0,this.col,1,1).setMargins("4px","","","").setTooltip("Close Job Dialog")},JobDialog.prototype.enableCloseButton=function(e){var t=this;window.setTimeout(function(){t.parent_page.can_reload?(t.close_btn.setDisabled(!1),e&&t.task.autoRunId&&t.close_btn.click()):t.enableCloseButton()},2e3)},JobDialog.prototype.makeLayout=function(n){var s=this;this.outputPanel=new IFrame(""),this.task.state!=job_code.remdoc?(this.outputPanel.setFramePosition("16px","58px","100%","100%"),this.inputPanel=this.task.makeInputPanel(this.dataBox),(this.inputPanel.job_dialog=this).makeToolBar(),this.addWidget(this.toolBar),this.toolBarSep=new HLine("2px"),this.addWidget(this.toolBarSep),this.addWidget(this.inputPanel),this.addWidget(this.outputPanel)):(this.outputPanel.setFramePosition("16px","8px","100%","100%"),this.inputPanel=null,this.toolBar=null,this.toolBarSep=null,this.radioSet=null,this.run_btn=null,this.autorun_cbx=null,this.run_image=null,this.addjob_btn=null,this.clone_btn=null,this.stop_btn=null,this.end_btn=null,this.newtab_btn=null,this.export_btn=null,this.ref_btn=null,this.help_btn=null,this.close_btn=null,this.addWidget(this.outputPanel),$(s.outputPanel.element).on("load",function(){s.onDlgResize()})),"new"!=this.task.state&&"output"==this.task.job_dialog_data.panel&&this.outputPanel.getURL().length<=0&&this.loadReport(),this.inputPanel&&this.inputPanel.setVisible("input"==this.task.job_dialog_data.panel),this.outputPanel.setVisible("output"==this.task.job_dialog_data.panel),s.run_btn&&s.inputPanel&&s.inputPanel.element.addEventListener(cofe_signals.taskReady,function(e){s.dlg_active?e.detail.length<=0?(s.run_btn.setEnabled(s.dlg_active),s.autorun_cbx&&s.autorun_cbx.setEnabled(s.dlg_active),s.close_btn.setEnabled(!0)):"hide_run_button"==e.detail?(s.run_btn.setEnabled(!1),s.autorun_cbx&&s.autorun_cbx.setEnabled(!1),s.close_btn.setEnabled(!0)):"show_run_button"==e.detail?(s.run_btn.setEnabled(!0),s.autorun_cbx&&s.autorun_cbx.setEnabled(!0),s.close_btn.setEnabled(!0)):"upload_started"==e.detail?(s.run_btn.setEnabled(!1),s.autorun_cbx&&s.autorun_cbx.setEnabled(!1),s.close_btn.setEnabled(!1)):("upload_finished"==e.detail?(s.run_btn.setEnabled(s.dlg_active),s.autorun_cbx&&s.autorun_cbx.setEnabled(s.dlg_active)):(s.run_btn.setEnabled(!1),s.autorun_cbx&&s.autorun_cbx.setEnabled(!1)),s.close_btn.setEnabled(!0)):(s.run_btn.setEnabled(!1),s.close_btn.setEnabled(!0))},!1),$(s.element).on("dialogresize",function(e,t){s.task.job_dialog_data.width=s.width_px(),__any_mobile_device||(s.task.job_dialog_data.height=s.height_px(),s.onDlgResize())}),s.run_btn&&s.run_btn.addOnClickListener(function(){var e=s.task.isTaskAvailable();"ok"!=e[0]?new MessageBox("The task cannot be run",e[2],"msg_warning"):(s.close_btn.setDisabled(!0),serverRequest(fe_reqtype.getUserRation,{topup:!0},"User Ration",function(e){var t=s.parent_page.ration.pdesc,i=e.ration,o=(s.parent_page.ration=i,s.parent_page.displayUserRation(t)," <a href=\"javascript:launchHelpBox('Project storage','"+__user_guide_base_url+'jscofe_tips.store_completed_projects.html\',null,10)"><span style="color:blue">here</span>.');if(i&&!__local_setup){if(0<i.storage&&i.storage_used>=i.storage)return new MessageBox("Disk Quota Exceeded",'<div style="width:520px;"><h2>Disk Quota Exceeded</h2>The job cannot be run because disk quota is up and cannot be automatically increased. Your account currently uses<p><b style="font-size:120%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+round(i.storage_used,1)+" MBytes at "+round(i.storage,1)+" MBytes allocated.</b><p><i><b>Hint 1:</b></i> deleting jobs and projects will free up disk space.<p><i><b>Hint 2:</b></i> resource usage can be monitored using disk and CPU widgets in the top-right corner of the screen.<p><i><b>Recommended action:</b></i> export an old project and then delete it from the list. You will be able to re-import that project later using the file exported.<p><i>Read about disk space and project management in "+appName()+o+"</i></div>","msg_excl"),void s.enableCloseButton(!1);if(0<i.cpu_day&&i.cpu_day_used>=i.cpu_day)return new MessageBox("24-hour CPU Quota Exceeded",'<div style="width:520px;"><h2>24-hour CPU Quota Exceeded</h2>The job cannot be run because your 24-hour CPU quota is up. In last 24 hours, you have used<p><b style="font-size:120%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+round(i.cpu_day_used,3)+" CPU hours at "+round(i.cpu_day,3)+' CPU hours allocated.</b><p><i><b>Hint:</b></i> resource usage can be monitored using disk and CPU widgets in the top-right corner of the screen. You may need to push the <i>"Reload"</i> button in the toolbar after periods of inactivity to get updated readings.<p><i><b>Recommended action:</b></i> run the job later or ask '+appName()+" maintainer to increase your 24-hour CPU quota.","msg_excl"),void s.enableCloseButton(!1);if(0<i.cpu_month&&i.cpu_month_used>=i.cpu_month)return new MessageBox("30-day CPU Quota Exceeded",'<div style="width:520px;"><h2>30-day CPU Quota Exceeded</h2>The job cannot be run because your 30-day CPU quota is up. In last 30 days, you have used<p><b style="font-size:120%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+round(i.cpu_month_used,3)+" CPU hours at "+round(i.cpu_month,3)+' CPU hours allocated.</b><p><i><b>Hint:</b></i> resource usage can be monitored using disk and CPU widgets in the top-right corner of the screen. You may need to push the <i>"Reload"</i> button in the toolbar after periods of inactivity to get updated readings.<p><i><b>Recommended action:</b></i> run the job later or ask '+appName()+" maintainer to increase your 30-day CPU quota.","msg_excl"),void s.enableCloseButton(!1)}"topup"==e.code&&(s.parent_page.ration=i,s.parent_page.makeUserRationIndicator(),window.setTimeout(function(){new MessageBox("Disk Quota Increased",'<div style="width:400px;"><h2>Disk quota increased</h2>Your disk quota was automatically increased to<p><b style="font-size:120%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+round(i.storage,1)+' MBytes</b><p>Enjoy! Just push "Ok" to proceed.<p><i><b>Important:</b> cleaning your '+appName()+" disk space will be necessary at some point. Read about disk space and project management"+o+"</i></div>","msg_information")},500)),s.collectTaskData(!1)?(s.task.autoRunId&&(s.tree.projectData.desc.autorun=!0),s.task.doRun(s.inputPanel,function(){s.task.job_dialog_data.panel="output",s.task.state=job_code.running,s.outputPanel.clear(),s.setDlgState(),s.requestServer(fe_reqtype.runJob,function(e){var t;addWfKnowledge(s.task,s.ancestors.slice(1)),s.tree.projectData.desc.timestamp=e.timestamp,"client"==s.task.nc_type?(s.task.job_dialog_data.job_token=e.job_token,(t={}).job_token=e.job_token,t.feURL=getFEURL(),t.dnlURL=s.task.getURL(e.jobballName),localCommand(nc_command.runClientJob,t,"Run Client Job",function(e){return s.task.postSubmit(),e?(e.status!=nc_retcode.ok?new MessageBox("Run Client Job","<p>Launching local application "+s.task.name+" failed due to:<p><i>"+e.message+' (code="'+e.status+'")</i><p>Please report this as possible bug to <a href="mailto:'+__maintainerEmail+'">'+__maintainerEmail+"</a>"):(s.loadReport(),s.radioSet.selectButton("output"),n(s),s.enableCloseButton(!0)),!0):(s.close_btn.setDisabled(!1),!1)})):"browser"==s.task.nc_type?(s.close_btn.setDisabled(!0),s.task.launchWebApp(function(){s.requestServer(fe_reqtype.webappEndJob,function(e){s.show(),s.enableCloseButton(!0)})}),s.loadReport(),s.radioSet.selectButton("output"),n(s),s.stop_btn&&s.stop_btn.setVisible(!1),s.hide()):(s.task.postSubmit(),s.loadReport(),s.radioSet.selectButton("output"),n(s),s.enableCloseButton(!0))})})):s.close_btn.setDisabled(!1)},null,function(){s.close_btn.setDisabled(!1)}))}),s.stop_btn&&s.stop_btn.addOnClickListener(function(){s.onDlgSignal_func(s,job_dialog_reason.stop_job,null)}),s.end_btn&&s.end_btn.addOnClickListener(function(){s.onDlgSignal_func(s,job_dialog_reason.end_job,null)}),s.newtab_btn&&s.newtab_btn.addOnClickListener(function(){var e;s.outputPanel&&(e="<!DOCTYPE html>\n<html><head><style>body, html {width: 100%; height: 100%; margin: 0; padding: 0}</style><title>"+s.task.project+":["+padDigits(s.task.id,4)+"] "+s.task.title+"</title><script>var __user_settings="+JSON.stringify(__user_settings)+';<\/script></head><body><iframe src="'+s.outputPanel.getURL()+'" style="height:calc(100% - 4px);width:calc(100% - 4px)"></iframe></body></html>',window.open("","").document.write(e))}),s.export_btn&&s.export_btn.addOnClickListener(function(){new ExportJobDialog(s.task)}),s.task.getHelpURL()&&s.ref_btn&&s.ref_btn.addOnClickListener(function(){new HelpBox("",s.task.getHelpURL(),null)}),s.help_btn&&s.help_btn.addOnClickListener(function(){new HelpBox("",__user_guide_base_url+"jscofe_jobdialog.html",null)}),s.close_btn&&s.close_btn.addOnClickListener(function(){s.task.state==job_code.running||s.task.state==job_code.ending||s.task.state==job_code.exiting||s.tree.in_archive||(s.collectTaskData(!0),s.requestServer(fe_reqtype.saveJobData,function(e){e.project_missing&&(new MessageBox("Project not found",'<h3>Project "'+s.tree.projectData.desc.name+'" is not found on server</h3>Project "'+s.tree.projectData.desc.name+'" was shared with you, please check<br>whether it was deleted by project owner.',"msg_error"),s.tree.emitSignal(cofe_signals.makeProjectList,e))})),s.task.onJobDialogClose(s,function(e){e&&s.close()})})},LicenceDialog.prototype=Object.create(Widget.prototype),LicenceDialog.prototype.constructor=LicenceDialog,ManageUserDialog.prototype=Object.create(Widget.prototype),ManageUserDialog.prototype.constructor=ManageUserDialog,ManageUserDialog.prototype.putLine=function(e,t,i,o,n){(7==n?this.grid.setLabel(e,o,0,1,3).setWidth_px(300):this.grid.setLabel(e,o,0,1,1).setWidth_px(200)).setFontBold(!0).setNoWrap();var s=null,a="&nbsp;allocated";switch(n){case 0:s=this.grid.setLabel(t,o,1,1,5).setWidth("100%").setFontItalic(!0).setNoWrap();break;case 1:s=this.grid.setInputText(t,o,1,1,5).setWidth("100%");break;case 2:s=new Dropdown,this.grid.setWidget(s,o,1,1,4);for(var r=0;r<t.length-1;r++)s.addItem(t[r],"",r,t[r]==t[t.length-1]);s.make();break;case 3:s=this.grid.setLabel(new Date(t).toISOString().slice(0,10),o,1,1,1).setFontItalic(!0).setNoWrap();break;case 6:a="&nbsp;committed";case 4:this.grid.setLabel(""+t,o,1,1,1).setFontItalic(!0).setWidth_px(80),this.grid.setLabel("&nbsp;of&nbsp;",o,2,1,1).setWidth_px(30),s=this.grid.setInputText(i,o,3,1,1).setWidth_px(80),this.grid.setLabel(a,o,4,1,1).setWidth_px(60),this.grid.setLabel("",o,5,1,1),this.grid.setVerticalAlignment(o,2,"middle"),this.grid.setVerticalAlignment(o,3,"middle"),this.grid.setVerticalAlignment(o,4,"middle"),this.grid.setCellSize("80px","",o,1),this.grid.setCellSize("30px","",o,2),this.grid.setCellSize("80px","",o,3),this.grid.setCellSize("60px","",o,4),this.grid.setCellSize("auto","",o,5);break;case 5:s=this.grid.setLabel(t,o,1,1,1).setFontItalic(!0);break;case 7:s=this.grid.setInputText(i,o,1,1,1).setWidth_px(80),this.grid.setVerticalAlignment(o,0,"middle"),this.grid.setVerticalAlignment(o,1,"middle")}return this.grid.setVerticalAlignment(o,0,"middle"),this.grid.setVerticalAlignment(o,1,"middle"),this.grid.setCellSize("200px","1.75em",o,0),s},ManageUserDialog.prototype.makeLayout=function(){this.grid.setLabel("<h2>User Data</h2>",0,0,1,4);var e=1,t=(this.putLine("Name:",this.userData.name,0,e++,0),this.putLine("Login:",this.userData.login,0,e++,0),this.putLine("E-mail:",this.userData.email,0,e++,0),this.profile=this.putLine("Profile:",[role_code.user,role_code.admin,role_code.developer,this.userData.role],0,e++,2),this.licence=this.putLine("Licence:",["academic","commercial",this.userData.licence],0,e++,2),"dormant"),i="active";this.userData.dormant&&(i=t+=" since "+new Date(this.userData.dormant).toISOString().slice(0,10)),this.status=this.putLine("Status:",["active",t,i],0,e++,2),this.userData.hasOwnProperty("feedback")?0<this.userData.feedback.length?this.putLine("Feedback agreement:",this.userData.feedback,0,e++,0):this.putLine("Feedback agreement:","not chosen",0,e++,0):this.putLine("Feedback agreement:","undefined",0,e++,0),this.putLine("Known since:",this.userData.knownSince,0,e++,3),"lastSeen"in this.userData?this.putLine("Last seen:",this.userData.lastSeen,0,e++,3):this.putLine("Last seen:","unknown",0,e++,0),this.volume=this.putLine("Storage disk:",this.diskNames.concat(this.userData.volume),0,e++,2),this.storage=this.putLine("Storage used (MBytes):",round(this.userData.ration.storage_used,1),this.userData.ration.storage,e++,6),this.storage_max=this.putLine("Maximum storage allocation (MBytes):",0,round(this.userData.ration.storage_max,1),e++,7),this.cpu_day=this.putLine("CPU-hours used (day):",round(this.userData.ration.cpu_day_used,2),this.userData.ration.cpu_day,e++,4),this.cpu_month=this.putLine("CPU-hours used (month):",round(this.userData.ration.cpu_month_used,2),this.userData.ration.cpu_month,e++,4),this.cloudrun_day=this.putLine("CloudRun tasks (day):",this.userData.ration.cloudrun_day_used,this.userData.ration.cloudrun_day,e++,4),this.archive_year=this.putLine("Archived projects (year):",this.userData.ration.archives.length,this.userData.ration.archive_year,e++,4),this.putLine("Total jobs run:",this.userData.ration.jobs_total,0,e++,5),this.putLine("Total CPU-hours used:",round(this.userData.ration.cpu_total_used,2),0,e,5)},ProjectSettingsDialog.prototype=Object.create(Widget.prototype),ProjectSettingsDialog.prototype.constructor=ProjectSettingsDialog,SearchArchiveDialog.prototype=Object.create(Widget.prototype),SearchArchiveDialog.prototype.constructor=SearchArchiveDialog,SearchArchiveDialog.prototype.makeLayout=function(){this.grid=new Grid(""),this.addWidget(this.grid),this.grid.setLabel(" ",0,0,1,1),this.grid.setCellSize("","6px",0,0),this.grid.setImage(image_path("folder_cloud_archive"),"48px","48px",1,0,1,1),this.grid.setLabel("&nbsp;&nbsp;&nbsp;",0,1,2,1),this.grid.setLabel("<h2>Search "+appName()+' Archive</h2><hr/><span style="font-size:85%"><i>Provide as many filters as possible; at least one filter must be given</i><br>&nbsp;</span>',0,2,2,1),this.grid.setVerticalAlignment(0,2,"middle");var e=this.grid.setGrid("-compact",2,2,1,1);e.setLabel("Depositor name:",0,0,1,1).setNoWrap(),this.dname=e.setInputText("",0,1,1,1).setWidth("300px").setStyle("text","","John R. Nobody","Depositor name if known"),e.setLabel("Depositor login:",1,0,1,1).setNoWrap(),this.dlogin=e.setInputText("",1,1,1,1).setWidth("300px").setStyle("text","","j.r.nobody","Depositor login name if known"),e.setLabel("Deposition year:",2,0,1,1).setNoWrap()},SearchArchiveDialog.prototype.searchArchive=function(e){},TaskDataDialog.prototype=Object.create(Widget.prototype),TaskDataDialog.prototype.constructor=TaskDataDialog,TaskDataDialog.prototype.getDataDescription=function(e){function t(e){if(e.length<=0)return"";if(1==e.length)return" "+e[0];for(var t='<ul style="margin:0;">',i=0;i<e.length;i++)t+="<li>"+e[i]+"</li>";return t+"</ul>"}var i,o="";for(i in e.dtypes){var n=getObjectInstance('{ "_type" : "'+i+'" }'),s=(0<o.length&&(endsWith(o,"</ul>")||(o+="<br>"),o+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><i>-- or --</i></b><br>"),o+="<b>"+n.title()+"</b>",e.desc&&(o+=" ("+e.desc+")"),[]),a=[],r=e.dtypes[i];if(1<r.length)for(var l,c=0;c<r.length;c++)(l=n.getSubtypeDescription(r[c]))&&(0==l[0]?s.push(l.substring(1)):a.push(l));else 1==r.length&&(l=n.getSubtypeDescription(r[0]))&&(0==l[0]?s.push(l.substring(1)):a.push(l));var d=n.ddesc_bridge_word(),h=a.length+s.length;if(1==h)o+=d,1==a.length?o+=a[0]:o+=s[0];else if(1<h)if(o+=d,0==a.length)o+="at least one of"+t(s);else{for(c=0;c<s.length;c++)a.push("optional "+s[c]);o+=t(a)}}return o},TaskListDialog.prototype=Object.create(Widget.prototype),TaskListDialog.prototype.constructor=TaskListDialog,TaskListDialog.prototype.setTask=function(e,t,i,o){if(e.state==job_code.retired)return null;var n=e.isTaskAvailable(),s=this.dataBox.getDataSummary(e);if("ok"!=n[0]&&(s.status=-1),!o&&s.status<=0)return null;var a,r,l=t.setButton("",image_path(e.icon()),i,0,1,1).setSize_px(54,40),o=(t.setLabel(" ",i,1,1,1),e.title),c=(this._setting_wf&&(o=o.replace("Workflow: ","")),"ok"!=n[0]?o='<div style="line-height:16px;">'+o+'<br><span style="font-size:13px;"><i>** '+n[1]+"</i></span></div>":(a=e.desc_title())&&(o='<div style="line-height:16px;padding-top:4px;">'+o+'<br><span style="font-size:13px;color:gray;">&nbsp;&nbsp;<i>-- '+a+"</i></span></div>"),t.setLabel(o,i,2,1,1));switch(t.setNoWrap(i,2),t.setVerticalAlignment(i,2,"middle"),t.setCellSize("99%","",i,2),l.dataSummary=s,l.dataSummary.status){default:case 0:$(l.element).css({border:"2px solid #FF1C00"}),l.setIndicator(image_path("nogo"),1),c.setFontColor("#888888").setFontItalic(!0);break;case 1:$(l.element).css({border:"2px solid #FFBF00"});break;case 2:$(l.element).css({border:"2px solid #03C03C"})}function d(){0<l.dataSummary.status?(r.selected_task=e,r.combobox?r.onSelect_func(e,r.combobox.getValue()):r.onSelect_func(e,null),$(r.element).dialog("close")):new TaskDataDialog(l.dataSummary,e,n)}return r=this,l.addOnClickListener(d),c.addOnClickListener(d),l},TaskListDialog.prototype.makeLayout=function(e){var t,i,o;20==e?(this.element.setAttribute("title","Autostart"),i=new Grid("-compact"),this.addWidget(i),this.makeAutostartList(i),this.dlg_height="auto"):(10<e&&(this.tabs_basic=new Tabs,this.addWidget(this.tabs_basic),t=i=null,21==e?(i=this.tabs_basic.addTab("Workflows",!0),t=this.tabs_basic.addTab("Essential tasks",!1)):(e=22,t=this.tabs_basic.addTab("Essential tasks",!0),i=this.tabs_basic.addTab("Workflows",!1)),this.makeBasicList(t.grid,e),i&&this.makeWorkflowsList(i.grid)),this.tabs_full=new Tabs,this.addWidget(this.tabs_full),this.tabs_AtoZ=new Tabs,this.addWidget(this.tabs_AtoZ),t=this.tabs_full.addTab("Suggested tasks",!0),e=this.tabs_full.addTab("All tasks",!1),i=this.tabs_full.addTab("Workflows",!1),o=this.tabs_full.addTab("A-Z",!1),this._setting_wf=!1,this.makeSuggestedList(t.grid),this.makeFullList(e.grid),this.makeWorkflowsList(i.grid),this.makeAtoZList(o.grid))},TaskListDialog.prototype.makeBasicList=function(e,t){var i=0,o=(e.setLabel("Essential Tasks",i++,0,1,3).setFontSize("140%").setFontBold(!0),e.setLabel("&nbsp;",i++,0,1,3).setFontSize("40%"),"<i>This list contains "+appName()+' tasks commonly used for structure completion after running structure solution workflows. For full set of tasks, switch to </i>"Full task list"<i> below.</i>'),n=(30==t&&(o="<i>This list contains "+appName()+' tasks commonly used for structure completion after importing partially solved structures. For full set of tasks, switch to </i>"Full task list"<i> below.</i>'),e.setLabel(o,i++,0,1,3).setFontSize("90%"),e.setLabel("&nbsp;",i++,0,1,3).setFontSize("20%"),["Refinement",new TaskRefmac,new TaskBuster,new TaskCootMB,new TaskLorestr,"Ligands",new TaskMakeLigand,new TaskFitLigand,new TaskFitWaters,"Import Additional Data",new TaskImport,new TaskImportReplace]);30==t&&n.push(new TaskMigrate);for(var s,n=n.concat(["Model Building",new TaskParrot,new TaskCCP4Build,new TaskBuccaneer,new TaskArpWarp,new TaskModelCraft,new TaskNautilus,"Deposition",new TaskDeposition]),a=0;a<n.length;a++)"string"==typeof n[a]||n[a]instanceof String?(e.setLabel("&nbsp;",i++,0,1,3).setHeight_px(4),e.setLabel("<hr/>",i,0,1,1),(s=e.setGrid("",i++,1,1,2)).setLabel("&nbsp;"+n[a]+"&nbsp;",0,0,1,1).setFontItalic(!0).setFontBold(!0).setNoWrap(),s.setLabel("<hr/>",0,1,1,1),s.setCellSize("10%","8px",0,0),s.setCellSize("90%","8px",0,1)):this.setTask(n[a],e,i,!0)&&i++;return i},TaskListDialog.prototype.makeAutostartList=function(e){for(var t=0,i=(e.setLabel("<h3>Choose project template from options below that matches your data best:</h3>",t++,0,1,4),[new TaskWFlowAMR,new TaskWFlowAFMR,new TaskWFlowSMR,new TaskWFlowAEP,new TaskWFlowDPL]),o=0;o<i.length;o++)0<i[o].file_select.length&&(i[o].inputMode="root"),this.setTask(i[o],e,t,!0)&&t++;return e.setLabel("&nbsp;<br><hr/>After data upload and starting, the project tree unfolds automatically. More jobs from Task List can be added to the project tree at any time, using the green plus button.",t++,0,1,3).setFontSize("90%").setFontItalic(!0),t},TaskListDialog.prototype.makeWorkflowsList=function(e){for(var t,i=0,o=(this._setting_wf=!0,e.setLabel("Automatic Workflows",i++,0,1,3).setFontSize("140%").setFontBold(!0),e.setLabel("&nbsp;",i++,0,1,3).setFontSize("40%"),e.setLabel("Each workflow will run a series of tasks, see details <a href=\"javascript:launchHelpBox('Automatic Workflows','"+__user_guide_base_url+"jscofe_workflows.html',null,10)\">here</a>.",i++,0,1,3).setFontSize("90%").setFontItalic(!0),e.setLabel("&nbsp;",i++,0,1,3).setFontSize("40%"),["Workflows for starting a Project",new TaskWFlowAMR,new TaskWFlowAFMR,new TaskWFlowSMR,new TaskWFlowAEP,new TaskWFlowDPL,"Workflows for using within a Project",new TaskWFlowREL]),n=0;n<o.length;n++)"string"==typeof o[n]||o[n]instanceof String?(e.setLabel("&nbsp;",i++,0,1,3).setHeight_px(4),e.setLabel("<hr/>",i,0,1,1),(t=e.setGrid("",i++,1,1,2)).setLabel("&nbsp;"+o[n]+"&nbsp;",0,0,1,1).setFontItalic(!0).setFontBold(!0).setNoWrap(),t.setLabel("<hr/>",0,1,1,1),t.setCellSize("10%","8px",0,0),t.setCellSize("90%","8px",0,1)):(this.dataBox.isEmpty()&&0<o[n].file_select.length&&(o[n].inputMode="root"),this.setTask(o[n],e,i,!0)&&(i++,this.listAtoZ.push(o[n])));return this._setting_wf=!1,i},TaskListDialog.prototype.makeSuggestedList=function(grid){for(var knowledge=getWfKnowledge(this.branch_tasks[2],this.branch_tasks[1],this.branch_tasks[0]),tasks=knowledge.tasks,counts=knowledge.counts,ctotal=0,r=0,i=0;i<counts.length;i++){for(var j=i+1,t,c;j<counts.length;j++){counts[j]>counts[i]&&(t=tasks[i],tasks[i]=tasks[j],tasks[j]=t,c=counts[i],counts[i]=counts[j],counts[j]=c)}ctotal+=counts[i]}for(var cthresh=ctotal*__suggested_task_prob,i=0,task;i<tasks.length;i++){(i<__suggested_task_nmin||cthresh<=ctotal)&&(task=eval("new "+tasks[i]+"()"),this.setTask(task,grid,r,!1)&&r++,ctotal-=counts[i])}return r},TaskListDialog.prototype.makeFullList=function(l){var c=null,d=0,h=0,e=(this.makeSection=function(e,t,i){for(var o,n=l.setSection(e,!1,h++,0,1,3),s=0,a=0,r=0;r<t.length;r++)"string"==typeof t[r]||t[r]instanceof String?(n.grid.setLabel("&nbsp;",a++,0,1,3).setHeight_px(4),n.grid.setLabel("<hr/>",a,0,1,1),(o=n.grid.setGrid("",a++,1,1,2)).setLabel("&nbsp;"+t[r]+"&nbsp;",0,0,1,1).setFontItalic(!0).setFontBold(!0).setNoWrap(),o.setLabel("<hr/>",0,1,1,1),o.setCellSize("10%","8px",0,0),o.setCellSize("90%","8px",0,1)):(o=this.setTask(t[r],n.grid,a++,!0))&&(0<o.dataSummary.status&&s++,i&&this.listAtoZ.push(t[r]));n.setTitle(e+" <b>("+s+")</b>"),0<s&&(d++,c=n)},c),t=(__user_role==role_code.developer&&(this.makeSection("Documentation tools",[new TaskDocDev],!1),this.makeSection("Tasks in Development",[new TaskPDBREDO,new TaskPhaserRB,new TaskPaiRef,new TaskWebCoot,new TaskJLigand,new TaskFragon,new TaskMergeData,new TaskHelloWorld],!1)),[new TaskImport,new TaskImportSeqCP,new TaskImportPDB,new TaskImportReplace,new TaskMigrate]);__cloud_storage&&t.splice(3,0,new TaskCloudImport),this.makeSection("Data Import",t,!0),this.makeSection("Structure Prediction",[new TaskStructurePrediction],!0),this.makeSection("Data Processing",[new TaskXia2,new TaskXDSGUI,new TaskDUI,new TaskIMosflm,new TaskAimless,new TaskChangeSpGHKL,new TaskChangeReso,new TaskFreeRFlag],!0),this.makeSection("Asymmetric Unit and Structure Revision",[new TaskASUDef,new TaskChangeSpGASU,new TaskEditRevision,new TaskOptimiseASU],!0),this.makeSection("Automated Molecular Replacement",["Conventional Auto-MR",new TaskMorda,new TaskMrBump,new TaskBalbes,new TaskSliceNDice,"No-sequence methods",new TaskSimbad,"Sequence reconstruction",new TaskFindMySequence],!0),this.makeSection("Molecular Replacement",["MR model preparation",new TaskMrParse,new TaskModelPrepXYZ,new TaskModelPrepMC,new TaskSlice,new TaskModelPrepAlgn,"MR ensemble preparation",new TaskEnsembler,new TaskEnsemblePrepSeq,new TaskEnsemblePrepXYZ,new TaskEnsemblePrepMG,"Fundamental MR",new TaskPhaserMR,new TaskMolrep],!0),this.makeSection("Fragment-Based Molecular Replacement",[new TaskArcimboldoLite,new TaskArcimboldoBorges,new TaskArcimboldoShredder],!0),this.makeSection("Experimental Phasing",["Automated EP",new TaskCrank2,new TaskShelxAuto,"Fundamental EP",new TaskShelxSubstr,new TaskShelxCD,new TaskPhaserEP],!0),this.makeSection("Density Modification",[new TaskParrot,new TaskAcorn,new TaskShelxEMR],!0),this.makeSection("Refinement and Model Building",["Refinement",new TaskRefmac,new TaskBuster,new TaskLorestr,new TaskDimple,new TaskCombStructure,new TaskSheetbend,"Model building -- polypeptides",new TaskModelCraft,new TaskCCP4Build,new TaskBuccaneer,new TaskArpWarp,"Model building -- polynucleotides",new TaskAWNuce,new TaskNautilus],!0),this.makeSection("Coot",[new TaskCootMB,new TaskCootCE],!0),this.makeSection("Ligands",[new TaskMakeLigand,new TaskFitLigand,new TaskFitWaters],!0),this.makeSection("Validation, Analysis and Deposition",[new TaskZanuda,new TaskPrivateer,new TaskPISA,new TaskSC,new TaskDeposition,new TaskContact,new TaskRotamer,new TaskAreaimol,new TaskRampage],!0),this.makeSection("Toolbox",["Reflection data tools",new TaskAuspex,new TaskSRF,new TaskCrosSec,new TaskReindexHKL,"Coordinate data tools",new TaskXyzUtils,new TaskGemmi,new TaskTextEditor,"Alignment and comparison tools",new TaskGesamt,new TaskLsqKab,new TaskSeqAlign,new TaskSymMatch],!0),1==d?c.open():e&&e.open()},TaskListDialog.prototype.makeAtoZList=function(e){for(var t=0,i=(e.setLabel("<b>Filter by keyword(s):&nbsp;</b>",0,0,1,1).setNoWrap().setWidth("20%"),e.setInputText("",0,1,1,1).setWidth("350px")),o=(e.setLabel(" ",0,2,1,1),e.setHLine(2,1,0,1,3),e.setCellSize("10%","",0,0),e.setCellSize("30%","",0,1),e.setCellSize("60%","",0,2),e.setGrid("",2,0,1,3)),n=0;n<this.listAtoZ.length;n++)for(var s,a=n+1;a<this.listAtoZ.length;a++)this.listAtoZ[a].title<this.listAtoZ[n].title&&(s=this.listAtoZ[n],this.listAtoZ[n]=this.listAtoZ[a],this.listAtoZ[a]=s);for(var r,n=0;n<this.listAtoZ.length;n++)this.setTask(this.listAtoZ[n],o,t,!0)&&t++;return r=this,i.addOnInputListener(function(){for(var e=i.getValue().toLowerCase().replace(/,/g," ").match(/[^ ]+/g),t=0;t<r.listAtoZ.length;t++)o.setRowVisible(t,r.listAtoZ[t].checkKeywords(e))}),t},TaskListDialog.prototype.getSelectedTask=function(){return this.selected_task},FacilityUserDialog.prototype=Object.create(Widget.prototype),FacilityUserDialog.prototype.constructor=FacilityUserDialog,FacilityCheckDialog.prototype=Object.create(Widget.prototype),FacilityCheckDialog.prototype.constructor=FacilityCheckDialog,FacilityBrowser.prototype=Object.create(Widget.prototype),FacilityBrowser.prototype.constructor=FacilityBrowser,FacilityBrowser.prototype.disableButton=function(e,t){$("#"+this.btn_ids[e]).button("option","disabled",t)},FacilityBrowser.prototype.onTreeLoaded=function(){this.task.inprogress&&this.startWaitLoop()},FacilityBrowser.prototype.onTreeContextMenu=function(e){var t,i,o={},n=this.facilityTree.getSelectedItem();return 0<=["Facility","FacilityUser","FacilityVisit"].indexOf(n._type)?(i=this,o.updateItem={label:"Update",icon:image_path("refresh"),action:function(){i.openItem()}}):"FacilityFile"==n._type&&(t=this,o.updateItem={label:"Choose",icon:image_path("upload"),action:function(){t.openItem()}}),o},FacilityBrowser.prototype.openItem=function(){var e=this.facilityTree.getSelectedItem();0<=["Facility","FacilityUser","FacilityVisit"].indexOf(e._type)&&this.updateItem(!1)},FacilityBrowser.prototype.onTreeItemSelect=function(){var e=this.facilityTree.getSelectedItem(),t=this.facilityTree.calcSelectedNodeIds();if(this.task.inprogress)this.disableButton(0,!0),this.disableButton(1,!0);else if(0<=["FacilityList","Facility","FacilityUser","FacilityVisit","FacilityDataset","FacilityDir"].indexOf(e._type)){for(var i=1;i<t.length;i++)this.facilityTree.deselectNodeById(t[i]);this.disableButton(0,0<=["FacilityDataset","FacilityDir"].indexOf(e._type)),this.disableButton(1,!0)}else{if(1<(t=this.facilityTree.calcSelectedNodeIds()).length)for(var o=this.facilityTree.getUserID(),i=1;i<t.length;i++){var n=t[i];"FacilityFile"==this.facilityTree.item_map[n]._type&&this.facilityTree.getUserID1(n)==o||this.facilityTree.deselectNodeById(n)}this.disableButton(0,!0),this.disableButton(1,!1)}},FacilityBrowser.prototype.loadFacilityTree=function(){var t,e;t=this,(e=new FacilityTree("icat","")).element.style.paddingTop="0px",e.element.style.paddingBottom="25px",e.element.style.paddingLeft="10px",e.element.style.paddingRight="40px",e.readFacilitiesData("Facilities",function(){t.onTreeLoaded()},function(e){return t.onTreeContextMenu(e)},function(){t.openItem()},function(){t.onTreeItemSelect()}),t.tree_panel.addWidget(e),t.facilityTree&&t.facilityTree.delete(),t.facilityTree=e},FacilityBrowser.prototype.startWaitLoop=function(){var t;(t=this).task.inprogress=1,t.onTreeItemSelect(),new FacilityCheckDialog(t.task,function(e){t.task.inprogress=0,t.onTreeItemSelect(),e.status==fe_retcode.ok?e.hasOwnProperty("flist")?(t.task.setUploadedFiles(t.inputPanel,e.flist),$(t.element).dialog("close")):t.loadFacilityTree():e.status==fe_retcode.askPassword&&t.updateItem(!0)})},FacilityBrowser.prototype.updateItem=function(e){var t={},o=(t.facility=this.facilityTree.getFacility(),t.user=this.facilityTree.getUser(),t.visit=this.facilityTree.getVisit(),t.uid="",t.pwd="",t.tid=this.task.id,t.project=this.task.project,t.item=shallowCopy(this.facilityTree.getSelectedItem()),t.user&&(t.uid=t.user.id,t.uid==this.uid&&(t.pwd=this.pwd)),this);function n(e){serverRequest(fe_reqtype.updateFacility,e,o.task.title,function(e){e.status==fe_retcode.ok?o.startWaitLoop():alert("server replied data="+JSON.stringify(e))})}function i(i){new FacilityUserDialog(i,function(e,t){e&&t&&(i.uid=e,i.pwd=t,o.uid=e,o.pwd=t,n(i))})}if("FacilityFile"==t.item._type){t.selFiles=[];for(var s=o.facilityTree.calcSelectedNodeIds(),a=0;a<s.length;a++){var r=s[a],l=o.facilityTree.item_map[r];"FacilityFile"==l._type&&((l=shallowCopy(l)).did=o.facilityTree.getDatasetID1(r),l.dirpath=o.facilityTree.getDirPath(r),t.selFiles.push(l))}(e?i:n)(t)}else(!e&&t.pwd?n:i)(t)},CloudFileBrowser.prototype=Object.create(Widget.prototype),CloudFileBrowser.prototype.constructor=CloudFileBrowser,CloudFileBrowser.prototype.disableButton=function(e,t){$("#"+this.btn_ids[e]).button("option","disabled",t)},CloudFileBrowser.prototype.setButtonLabel=function(e,t){$("#"+this.btn_ids[e]).button("option","label",t)},CloudFileBrowser.prototype.loadStorageTree=function(e){var t,i;(t=this).tree_loading=!0,(i=new StorageTree(t.tree_type,e,t.file_key,t.dir_desc)).element.style.paddingTop="0px",i.element.style.paddingBottom="25px",i.element.style.paddingLeft="10px",i.element.style.paddingRight="40px",i.readStorageData("Cloud File Storage",t.ext_filter,function(){i.storageList&&(0<=i.storageList.size?(t.task.currentCloudPath=i.storageList.path,$(t.element).dialog("option","buttons",[{text:"Open",id:t.btn_ids[0],click:function(){t.openItem()}},{text:"Select",id:t.btn_ids[1],click:function(){t.selectItem()}},{text:"Close",id:t.btn_ids[2],click:function(){$(this).dialog("close")}}]),t.storageTree&&t.storageTree.delete(),t.tree_panel.addWidget(i),t.storageTree=i,t.onTreeItemSelect()):($(t.element).dialog("option","width",600),$(t.element).dialog("option","height",330),$(t.element).dialog("option","buttons",[{text:"Ok",id:t.btn_ids[2],click:function(){$(this).dialog("close")}}]),t.storageTree&&t.storageTree.delete(),t.storageTree=null,t.tree_panel.addWidget(new Label('<h2>Cloud File Storage Not Allocated</h2>Cloud file storage is not allocated for user <i>"'+__login_user+'"</i>. Cloud storage is used for keeping raw experimental data, as well as partly processed data, brought from data producing facilities such as synchrotrons.<p>Please contact your '+appName()+" maintainer if you believe that you should have access to Cloud storage.")))),t.tree_loading=!1},function(e){return null},function(){t.openItem()},function(){t.onTreeItemSelect()})},CloudFileBrowser.prototype.openItem=function(){var e,t,i,o;this.tree_loading||0<(e=this.storageTree.getSelectedItems()).length&&("FacilityDir"==e[0]._type?(i="",i=this.task.currentCloudPath?".."==e[0].name?(t=this.task.currentCloudPath.split("/")).slice(0,t.length-1).join("/"):this.task.currentCloudPath+"/"+e[0].name:e[0].name,o=this,window.setTimeout(function(){o.loadStorageTree(i)},0)):2==this.file_key?(this.onSelect_func&&this.onSelect_func(this.storageTree.storageList),$(this.element).dialog("close")):this.onSelect_func&&1==this.onSelect_func(e)&&$(this.element).dialog("close"))},CloudFileBrowser.prototype.getStorageList=function(e,t){var i;e?((i=new StorageTree("files",e,this.file_key,this.dir_desc)).tree_type=this.tree_type,i.readStorageData("Cloud File Storage",this.ext_filter,function(){i.storageList?t(i.storageList):t({})},function(e){return null},function(){},function(){})):t(this.storageTree.storageList)},CloudFileBrowser.prototype.selectItem=function(){for(var t,e=this.storageTree.getSelectedItems(),i=e.length-1;i--;)".."==e[i].name&&e.splice(i,1);0<e.length&&("FacilityDir"==e[0]._type&&2<=this.file_key?this.onSelect_func&&(".."==e[0].name?(this.onSelect_func(this.storageTree.storageList),$(this.element).dialog("close")):(t=this).getStorageList(t.task.currentCloudPath+"/"+e[0].name,function(e){$(t.element).dialog("close"),t.onSelect_func(e)})):this.onSelect_func&&1==this.onSelect_func(e)&&$(this.element).dialog("close"))},CloudFileBrowser.prototype.onTreeItemSelect=function(){if(this.storageTree){for(var e,t=this.storageTree.getSelectedItems(),i=0,o=0,n=!1,s=0;s<t.length;s++)"FacilityDir"==t[s]._type?(i++,".."==t[s].name&&(n=!0)):o++;3==this.file_key?(this.disableButton(0,e=1!=i||0<o),this.disableButton(1,e||n)):2==this.file_key?(this.disableButton(0,e=1!=i||0<o),this.disableButton(1,e)):1==i&&0==o?(this.disableButton(0,!1),this.disableButton(1,!0)):0==i&&0<o?(this.disableButton(0,!0),this.disableButton(1,!1)):this.disableButton(1,!0)}},Dock.prototype=Object.create(Widget.prototype),Dock.prototype.constructor=Dock,Dock.prototype.loadDockData=function(){var i;i=this,window.setTimeout(function(){serverRequest(fe_reqtype.getDockData,{},"Task Dock",function(e){if("_type"in e&&"DockData"==e._type){i.opened=e.opened;for(var t=0;t<e.tasks.length;t++)i._add_button(e.tasks[t].icon,e.tasks[t].title,e.tasks[t].task)}i.dock.addOnRightClickListener(function(){i.addTask(i.addTask_func())}),i.dock.setVisible(e.opened)},function(){},"persist")},1)},Dock.prototype._add_button=function(e,t,i){e=this.sortable.addItem(image_path(e),t,i);e&&($(e.item.element).addClass("sortable-button"),$(e.item.element).css({margin:"1px 0px 1px 6px",padding:"3px",float:"left"}),this.saveDockData())},Dock.prototype.addTask=function(e){e&&this._add_button(e.icon,e.title,e.task)},Dock.prototype.addTaskClass=function(e){e&&this._add_button(e.icon(),e.title,e._type)},Dock.prototype.removeTask=function(e){this.sortable.removeItem(e),this.saveDockData()},Dock.prototype.saveDockData=function(){var e=this.sortable.getItems(),t=new DockData;t.opened=this.opened;for(var i=0;i<e.length;i++)t.tasks.push({task:e[i][0],title:e[i][1],icon:e[i][2].split("\\").pop().split("/").pop().split(".").slice(0,-1).join(".")});serverRequest(fe_reqtype.saveDockData,t,"Task Dock",function(e){},null,"persist")},Dock.prototype.toggle=function(){this.opened=!this.opened,this.dock.setVisible(this.opened),this.saveDockData()},Dock.prototype.show=function(){this.opened||this.toggle()},Dock.prototype.setDisabled=function(e){e?$(this.sortable.element).css({opacity:.5}):$(this.sortable.element).css({opacity:1}),this.dock.setDisabled(e)},Dock.prototype.setEnabled=function(e){this.setDisabled(!e)},BasePage.prototype.onResize=function(e,t){},BasePage.prototype.putWatermark=function(e,t){this.watermark=new Label(e);var i,o={position:"absolute","background-color":"rgba(242,242,242,0.0)",opacity:"0.3","z-index":"-1"};for(i in t)o[i]=t[i];$(this.watermark.element).css(o),$(this.watermark.element).appendTo(document.body)},BasePage.prototype.makeSetupNamePanel=function(){var i=new Grid("");function e(e,t){i.setImage(t,"30px","30px",0,1,1,1),i.setLabel(e,0,2,1,1).setFont("times","150%",!0,!0).setNoWrap(),i.setCellSize("40%","",0,0),i.setCellSize("10%","",0,1),i.setCellSize("10%","",0,2),i.setCellSize("40%","",0,3),i.setVerticalAlignment(0,1,"bottom"),i.setVerticalAlignment(0,2,"bottom")}return __setup_desc?e(__setup_desc.name,__setup_desc.icon):__local_setup?e("Home setup",image_path("setup_home")):e("Unnamed setup",image_path("setup_unknown")),__fe_url!=document.location.protocol+"//"+document.location.host+document.location.pathname&&(i.setLabel(__fe_url,1,0,1,4).setFontSize("100%").setFontItalic(!0).setNoWrap(),i.setCellSize("","20pt",1,0),i.setVerticalAlignment(1,0,"bottom"),i.setHorizontalAlignment(1,0,"center")),i},BasePage.prototype.makeLogoPanel=function(e,t,i){if(__setup_desc&&"partners"in __setup_desc&&!(__setup_desc.partners.length<=0)){if(!__setup_desc.partners[0].hasOwnProperty("icon"))for(var o=0;o<__setup_desc.partners.length;o++)__setup_desc.partners[o].icon=new ImageButton(__setup_desc.partners[o].logo,"","28px"),!function(e){e.icon.setCursor("pointer").addOnClickListener(function(){window.open(e.url,"_blank")})}(__setup_desc.partners[o]);for(var n=this.grid.setGrid("",e,t,1,i),s=0,a=(n.setLabel("&nbsp;Powered by CCP4 v."+__ccp4_version,0,s,1,1).setFontSize("75%").setNoWrap().setVerticalAlignment("middle"),n.setCellSize("50%","",0,s++),Math.max(20,40-5*(__setup_desc.partners.length-2))+"px"),o=0;o<__setup_desc.partners.length;o++)n.setWidget(__setup_desc.partners[o].icon,0,s++,1,1),o<__setup_desc.partners.length-1&&n.setLabel("",0,s++,1,1).setWidth(a);n.setLabel(appName()+" v."+appVersion()+"&nbsp;&nbsp;&nbsp;&nbsp;",0,s,1,1).setFontSize("75%").setNoWrap().setVerticalAlignment("middle"),n.setVerticalAlignment(0,0,"middle"),n.setCellSize("50%","",0,s),n.setHorizontalAlignment(0,s,"right"),n.setVerticalAlignment(0,s,"middle"),this.grid.setVerticalAlignment(e,t,"middle"),this.grid.setCellSize("","30px",e,t),$(n.element).css({position:"absolute",left:"0px",bottom:"0px",padding:0,margin:0,border:"1px solid lightgray","background-color":"rgba(240,250,255,0.67)"})}},BasePage.prototype.getUserRation=function(){var t;__login_user?(t=this,serverRequest(fe_reqtype.getUserRation,{topup:!1},"User Ration",function(e){t.ration=e.ration,t.makeUserRationIndicator()},null,function(){t.ration=null,t.makeUserRationIndicator()})):this.makeUserRationIndicator()},BasePage.prototype._setConnectionIcons=function(e){var t=new Widget("div");__delays_ind=new ProgressBar(0),t.addWidget(__delays_ind),this.headerPanel.setWidget(t,0,e,1,1),t.setTooltip1("Network delays","show",!1,0).setSize("80px","22px"),$(__delays_ind.element).css({"margin-top":"4px",width:"80px",height:"12px",position:"relative"}),__delays_ind.hide(),__communication_ind=this.headerPanel.setImageButton(image_path("network_request"),"22px","22px",0,e+1,1,1).setTooltip1("Communication queue activity","show",!1,0).image,this.headerPanel.setVerticalAlignment(0,e,"top"),this.headerPanel.setVerticalAlignment(0,e+1,"top")},BasePage.prototype._setModeIcon=function(e){var t="<i>"+appName(),i='<ul style="font-size:80%;margin:2px;padding-left:24px;">',t=__local_setup?(o=image_path("setup_local"),(t+=" is in <b>local</b> mode:</i>"+i+"<li>projects and data are stored on local drive</li>")+(__local_service?"<li>all tasks run on your computer</li>":"<li>non-interactive tasks run on your computer</li><li><b>interactive tasks are not available</b><br><i>("+appName()+" Client not used)</i></li>")):(o=image_path("setup_remote"),(t+=" is in <b>remote</b> mode:</i>"+i+"<li>projects and data are stored on server</li><li>non-interactive tasks run on server</li>")+(__local_service?"<li>interactive tasks run on your computer</li>":"<li><b>interactive tasks are not available</b><br><i>("+appName()+" Client not used)</i></li>")),i=(this.headerPanel.setImageButton(o,"22px","22px",0,e,1,1).setTooltip1(t+"</ul>","show",!1,0).setFontSize("90%").setVerticalAlignment("middle"),"Unnamed CCP4 Cloud Setup"),o="images_png/setup_unknown.png";__setup_desc?(i='CCP4 Cloud Setup "'+__setup_desc.name+'" at<br><i>'+__fe_url+"</i>",o=__setup_desc.icon):__local_setup&&(i="Local CCP4 Cloud Setup at<br><i>"+__fe_url+"</i>",o=image_path("setup_home")),this.headerPanel.setImageButton(o,"22px","22px",0,e+1,1,1).setTooltip1(i,"show",!1,0).setFontSize("90%").setVerticalAlignment("middle"),this.headerPanel.setVerticalAlignment(0,e,"top"),this.headerPanel.setVerticalAlignment(0,e+1,"top"),this.headerPanel.setLabel("&nbsp;",0,e+2,1,1)},BasePage.prototype.makeHeader0=function(e){this.headerPanel=new Grid(""),this.grid.setWidget(this.headerPanel,0,0,1,e),this.grid.setCellSize("","32px",0,0),this.headerPanel.menu=new Menu("",image_path("menu")),this.headerPanel.setWidget(this.headerPanel.menu,0,0,1,1),this.headerPanel.setLabel("",0,1,1,1).setWidth("40px"),this.headerPanel.setCellSize("40px","",0,1),__login_user?(this.headerPanel.setCellSize("99%","",0,12),this._setConnectionIcons(13),this._setModeIcon(15),this.rationPanel=new Grid(""),this.headerPanel.setWidget(this.rationPanel,0,18,1,1),this.toolPanel=new Grid(""),this.headerPanel.setWidget(this.toolPanel,0,19,1,1),this.headerPanel.setLabel("&nbsp;",0,20,1,1).setWidth("40px"),e=new Label("<i>"+__login_user+"</i>"),this.headerPanel.setWidget(e,0,21,1,1),e.setHorizontalAlignment("right"),e.setNoWrap()):(this.rationPanel=null,this.headerPanel.setCellSize("99%","",0,17),this._setModeIcon(18)),__local_user?this.logout_btn=null:(this.logout_btn=new ImageButton(image_path("logout"),"24px","24px"),this.headerPanel.setWidget(this.logout_btn,0,22,1,1),this.headerPanel.setHorizontalAlignment(0,22,"right"),this.headerPanel.setVerticalAlignment(0,22,"top"),this.headerPanel.setCellSize("32px","32px",0,22),this.logout_btn.setTooltip("Logout")),this.headerPanel.setLabel("&nbsp;",0,23,1,1).setWidth("10px")},BasePage.prototype.makeHeader=function(e,t){var i;this.makeHeader0(e),(i=this).logout_btn&&i.logout_btn.addOnClickListener(function(){t?t(function(){logout(i.element.id,0)}):logout(i.element.id,0)})},BasePage.prototype.addMenuItem=function(e,t,i){return this.headerPanel.menu.addItem(e,image_path(t)).addOnClickListener(i),this},BasePage.prototype.addMenuSeparator=function(){return this.headerPanel.menu.addSeparator(),this},BasePage.prototype.addFullscreenToMenu=function(){return 0<this.headerPanel.menu.n_items&&this.headerPanel.menu.addSeparator(),this.headerPanel.menu.addItem("Toggle fullscreen",image_path("fullscreen")).addOnClickListener(toggleFullScreen),this},BasePage.prototype.addLogoutToMenu=function(e){return this.addFullscreenToMenu(),__local_user||this.headerPanel.menu.addItem("Log out",image_path("logout")).addOnClickListener(e),this},BasePage.prototype.makeUserRationIndicator=function(){this.rationPanel&&(this.rationPanel.disk_usage=null,this.ration&&0<this.ration.storage?(this.rationPanel.disk_icon=this.rationPanel.setImageButton(image_path("disk"),"20px","20px",0,0,1,1),this.rationPanel.disk_usage=this.rationPanel.setLabel("",0,1,1,1).setFontSize("90%"),this.rationPanel.sep_label=this.rationPanel.setLabel("&nbsp;",0,2,1,1).setWidth("4px"),this.rationPanel.cpu_icon=this.rationPanel.setImageButton(image_path("cpu"),"20px","20px",0,3,1,1),this.rationPanel.cpu_usage=this.rationPanel.setLabel("",0,4,1,1).setNoWrap().setFontSize("90%"),this.displayUserRation(null)):this.rationPanel.hideRow(0))},BasePage.prototype.displayUserRation=function(e){function t(e,t){if(t<=0)return"";e=round(100*e/t,0);return e<90?e+="%":e=e<99?'<font class="ration-warning">'+e+"%</font>":'<font class="ration-critical">'+e+"%</font>",e}var i,o,n,s,a;this.rationPanel&&this.ration&&(this.ration.pdesc=e,0<this.ration.storage&&this.rationPanel.disk_usage&&(i=t(this.ration.storage_used,this.ration.storage),o=t(this.ration.cpu_day_used,this.ration.cpu_day),n=t(this.ration.cpu_month_used,this.ration.cpu_month),s='<table class="table-rations"><tr><th>Resource</th><th>Used&nbsp;</th><th>Quota&nbsp;</th><th>%%</th></tr><tr><td colspan="4"><hr/></td></tr><tr><td>Storage&nbsp;(MBytes)&nbsp;</td><td>&nbsp;'+round(this.ration.storage_used,1)+"&nbsp;</td><td>&nbsp;"+round(this.ration.storage,1)+"&nbsp;</td><td>&nbsp;"+i+"</td></tr><tr><td>CPU 24h (hours)</td><td>&nbsp;"+round(this.ration.cpu_day_used,4)+"&nbsp;</td><td>&nbsp;"+round(this.ration.cpu_day,2)+"&nbsp;</td><td>&nbsp;"+o+"</td></tr><tr><td>CPU 30d (hours)</td><td>&nbsp;"+round(this.ration.cpu_month_used,4)+"&nbsp;</td><td>&nbsp;"+round(this.ration.cpu_month,2)+"&nbsp;</td><td>&nbsp;"+n+"</td></tr>",0<this.ration.cloudrun_day&&0<this.ration.cloudrun_day_used&&(a=t(this.ration.cloudrun_day_used,this.ration.cloudrun_day),s+="<tr><td>CloudRun 24h (jobs)</td><td>&nbsp;"+this.ration.cloudrun_day_used+"&nbsp;</td><td>&nbsp;"+this.ration.cloudrun_day+"&nbsp;</td><td>&nbsp;"+a+"</td></tr>"),0<this.ration.archive_year&&0<this.ration.archives.length&&(a=t(this.ration.archives.length,this.ration.archive_year),s+="<tr><td>Archive 1yr (projects)</td><td>&nbsp;"+this.ration.archives.length+"&nbsp;</td><td>&nbsp;"+this.ration.archive_year+"&nbsp;</td><td>&nbsp;"+a+"</td></tr>"),s+='<tr><td colspan="4"><hr/></td></tr>',e&&"disk_space"in e&&(s+='<tr><td colspan="4"><b><i>Project stats:</i></b></td></tr><tr><td colspan="2"><i>Storage used (MBytes)</i></td><td><i>&nbsp;'+round(e.disk_space,1)+'&nbsp;</i></td><td></td></tr><tr><td colspan="2"><i>Total jobs run</i></td><td><i>&nbsp;'+e.njobs+'&nbsp;</i></td><td></td></tr><tr><td colspan="2"><i>CPU total used (hours)</i></td><td><i>&nbsp;'+round(e.cpu_time,4)+'&nbsp;</i></td><td></td></tr><tr><td colspan="4"><hr/></td></tr>'),s+='<tr><td colspan="4"><b><i>User stats:</i></b></td></tr><tr><td colspan="2"><i>Total storage used (MBytes)</i></td><td><i>&nbsp;'+round(this.ration.storage_used,1)+'&nbsp;</i></td><td></td></tr><tr><td colspan="2"><i>Total jobs run</i></td><td><i>&nbsp;'+this.ration.jobs_total+'&nbsp;</i></td><td></td></tr><tr><td colspan="2"><i>CPU lifetime used (hours)</i></td><td><i>&nbsp;'+round(this.ration.cpu_total_used,4)+"&nbsp;</i></td><td></td></tr></table>",this.rationPanel.setTooltip1(s,"show",!1,2e4),this.rationPanel.disk_usage.setText(i),this.rationPanel.cpu_usage.setText(o+":"+n)))},BasePage.prototype.updateUserRationDisplay=function(e){"ration"in e&&(this.ration=e.ration),"pdesc"in e?this.displayUserRation(e.pdesc):"_type"in e&&"ProjectDesc"==e._type?this.displayUserRation(e):"ration"in e?this.displayUserRation(null):this.getUserRation()},BasePage.prototype.destructor=function(e){e()};var __history_count=0;function setHistoryState(e){0==__history_count?replaceHistoryState(e):window.history&&window.history.pushState&&(window.history.pushState(e,null,""),__history_count++)}function replaceHistoryState(e){window.history&&window.history.replaceState&&(window.history.replaceState(e,null,""),__history_count++)}function makePage(e,t=null){function i(){window.setTimeout(function(){__current_page=e,t&&t()},50)}__current_page?__current_page.destructor(i):i()}function setHistoryListener(sceneId){$(window).on("popstate",function(event){event.originalEvent.state?makePage(eval("new "+event.originalEvent.state+' ( "'+sceneId+'" );')):__current_page&&"LoginPage"!=__current_page._type&&"LogoutPage"!=__current_page._type?new MessageBoxF("Exit "+appName(),"<h3>Are you leaving your "+appName()+" session?</h3>Pressing <i><b>Back</b></i> button again will take you to previous page<br>in your browser history and end your current "+appName()+"<br>session, but leave you logged in.<p><i>It is strongly recommended that you end your "+appName()+"<br>session via regular logout.</i>","Continue "+appName()+" session",function(){window.history.forward()},!0):window.history.back()})}function AccountPage(o){if(BasePage.call(this,o,"-full","AccountPage"),__login_token){this.makeHeader(3,null),__current_project&&this.addMenuItem("Current project","project",function(){makeProjectPage(o)}),this.addMenuItem("Project folder","list",function(){makeProjectListPage(o)}),__user_role==role_code.admin&&this.addMenuItem("Admin Page",role_code.admin,function(){makeAdminPage(o)}),this.addLogoutToMenu(function(){logout(o,0)}),this.grid.setCellSize("25%","",1,0,1,1),this.grid.setVerticalAlignment(1,1,"middle"),this.grid.setCellSize("50%","",1,1,1,1),this.grid.setCellSize("25%","",1,2,1,1),this.makeLogoPanel(2,0,3);var n={},i=new Grid(""),s=(this.grid.setWidget(i,1,1,1,1),!__local_user),a="My Account",e=new Label(a=__local_user?"Settings":a).setNoWrap().setFont("times","300%",!0,!0),t=null,r=null,l=null,c=null,d=null,h=null,u=null,p=null,m=null,f=null,g=null,_=null,b=(s&&(t=new Label("User name:").setNoWrap(),r=new Label("E-mail:"),l=new Label("Login name:").setNoWrap(),c=new Label("Password:"),d=new Label("Retype password:").setNoWrap(),h=new Label("Licence agreement:").setNoWrap(),u=new Label("Feedback agreement:").setNoWrap(),p=new InputText(""),m=new InputText(""),f=new InputText(""),g=new InputText(""),_=new InputText("")),new Label("CloudRun Id:").setNoWrap()),y=null,v=(__auth_software&&(y=new Label("Software authorisations:").setNoWrap()).setFontSize("112%"),new InputText("")),k=(s&&(p.setStyle("text","","John Smith","This name will be used for addressing to you in\nweb-pages and e-mails"),m.setStyle("email","","john.smith@university.ac.uk","Should be a valid e-mail address, at which your\n new password will be sent"),f.setStyle("text","^[A-Za-z0-9\\-\\._]+$","john.smith","Login name cannot be changed"),g.setStyle("password","","password (old or new)","Choose new password"),_.setStyle("password","","confirm password","Type password again here")),v.setTooltip("CloudRun Id is used for starting CCP4 Cloud projects from command prompt. It should be changed periodically for security reasons. Press button on the left to generate new CloudRun Id."),s&&(t.setFontSize("112%").setWidth("auto"),r.setFontSize("112%"),l.setFontSize("112%"),c.setFontSize("112%"),d.setFontSize("112%"),h.setFontSize("112%"),u.setFontSize("112%"),p.setFontSize("112%").setFontItalic(!0).setWidth("200pt"),m.setFontSize("112%").setFontItalic(!0).setWidth("200pt"),f.setFontSize("112%").setFontItalic(!0).setWidth("200pt").setReadOnly(!0),g.setFontSize("112%").setFontItalic(!0).setWidth("200pt"),_.setFontSize("112%").setFontItalic(!0).setWidth("200pt")),b.setFontSize("112%"),v.setFontSize("94%").setReadOnly(!0).setWidth("110pt").setHeight("26px"),0),e=(i.setWidget(e,k,0,1,4),i.setHorizontalAlignment(k++,0,"center"),i.setWidget(this.makeSetupNamePanel(),k++,0,1,4),i.setCellSize("","20pt",k++,0),new Grid("-compact"));if(e.setWidget(v,0,0,1,1),s){i.setWidget(t,k,0,1,1),i.setWidget(r,k+1,0,1,1),i.setWidget(l,k+2,0,1,1),i.setWidget(c,k+3,0,1,1),i.setWidget(d,k+4,0,1,1),i.setWidget(b,k+5,0,1,1),i.setWidget(h,k+6,0,1,2),i.setWidget(u,k+7,0,1,2),__auth_software&&i.setWidget(y,k+8,0,1,2);for(var w=0;w<5;w++)i.setCellSize("96pt","",k+w,0);if(i.setWidget(p,k,1,1,3),i.setWidget(m,k+1,1,1,3),i.setWidget(f,k+2,1,1,3),i.setWidget(g,k+3,1,1,3),i.setWidget(_,k+4,1,1,3),i.setWidget(e,k+5,1,1,3),__auth_software)for(w=0;w<9;w++)i.setVerticalAlignment(k+w,0,"middle"),i.setVerticalAlignment(k+w,1,"middle");else for(w=0;w<7;w++)i.setVerticalAlignment(k+w,0,"middle"),i.setVerticalAlignment(k+w,1,"middle")}else i.setWidget(b,k,0,1,1),i.setWidget(e,k,1,1,3),i.setCellSize("96pt","",k,0),i.setVerticalAlignment(k,0,"middle"),i.setVerticalAlignment(k,1,"middle"),__auth_software&&(i.setWidget(y,k+1,0,1,2),i.setVerticalAlignment(k+1,0,"middle"),i.setVerticalAlignment(k+1,1,"middle"));var T,S,t=new Grid(""),r=(t.setWidth("260pt"),i.setLabel("&nbsp;",k,2,1,1).setWidth("80px"),i.setWidget(t,k,3,15,3),i.setLabel("Preferences<sup>*</sup>",k-1,5,1,1).setFont("times","150%",!0,!0),0),x=(t.setLabel("<hr/>",r++,0,1,2),t.setLabel("On login, go to: ",1,0,1,1),t.setVerticalAlignment(1,0,"middle"),t.setCellSize("120px","",1,0),new Dropdown),l=(x.addItem('"All Projects" list',"",on_login.all_projects,__user_settings.onlogin==on_login.all_projects),x.addItem('"My Projects" folder',"",on_login.my_projects,__user_settings.onlogin==on_login.my_projects),x.addItem("last used project folder","",on_login.last_folder,__user_settings.onlogin==on_login.last_folder),x.addItem("last opened project","",on_login.last_project,__user_settings.onlogin==on_login.last_project),t.setWidget(x,r++,1,1,1),x.make(),t.setGrid("-compact",r++,0,1,2)),c=(l.setLabel("&nbsp;",0,0,1,3).setFontSize("50%"),l.setLabel("Initial size (% of browser window):",1,0,1,3).setNoWrap(),l.setLabel("width",2,1,1,1).setFontItalic(!0),l.setLabel("height",2,2,1,1).setFontItalic(!0),l.setLabel("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Job dialogs:",3,0,1,1).setFontItalic(!0),l.setLabel("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Viewers:",4,0,1,1).setFontItalic(!0)," (in percents of browser window width or height, whichever is less; set negative in order to use full window size)"),C=[["job dialogs width",l.setInputText(100*__user_settings.jobdlg_size[0],3,1,1,1).setStyle("text","real","","Initial width"+c).setWidth_px(40)],["job dialogs height",l.setInputText(100*__user_settings.jobdlg_size[1],3,2,1,1).setStyle("text","real","","Initial height"+c).setWidth_px(40)],["viewers width",l.setInputText(100*__user_settings.viewers_size[0],4,1,1,1).setStyle("text","real","","Initial width"+c).setWidth_px(40)],["viewers height",l.setInputText(100*__user_settings.viewers_size[1],4,2,1,1).setStyle("text","real","","Initial height"+c).setWidth_px(40)]],D=(l.setLabel("&nbsp;",5,0,1,3).setFontSize("50%"),t.setCheckbox("Use project name as default file prefix",__user_settings.project_prefix,r++,0,1,2).setWidth("300px").setTooltip("If selected, all generated file names will be prefixed with project name unless another prefix is specified in project settings")),L=t.setCheckbox("Guide through data import",__user_settings.guided_import,r++,0,1,2).setWidth("300px").setTooltip("If selected, extra guidance through data import procedure will be given."),A=t.setCheckbox("Send end-of-job notifications",__user_settings.notifications.end_of_job.send,r++,0,1,2).setWidth("300px").setTooltip("If selected, end-of-job e-mails will be sent for jobs that take longer than the specified time period."),I=t.setGrid("-compact",+r,0,1,2),R=(I.setLabel("&nbsp;&nbsp; ",0,0,1,1).setWidth_px(45),I.setLabel("for jobs taking longer than",0,1,1,1).setFontSize("90%").setFontItalic(!0),I.setInputText(__user_settings.notifications.end_of_job.lapse,0,2,1,1).setStyle("text","real","","Execution time threshold").setWidth_px(40)),d=(I.setLabel("hours",0,3,1,1).setFontSize("90%").setFontItalic(!0),I.setVerticalAlignment(0,1,"middle"),I.setVerticalAlignment(0,3,"middle"),I.setVisible(__user_settings.notifications.end_of_job.send),A.addOnClickListener(function(){I.setVisible(A.getValue())}),t.setLabel("&nbsp;<br><hr/><sup>*</sup> Save changes for Preferences to take an effect",7,0,1,2).setFontSize("90%").setFontItalic(!0),new Button("renew",image_path("regenerate"))),E=(d.setTooltip("Generate new CloudRun Id (do this periodically for security reasons)"),e.setWidget(d,0,1,1,1),e.setVerticalAlignment(0,0,"middle"),e.setVerticalAlignment(0,1,"middle"),d.addOnClickListener(function(){v.setValue(getRandomToken()),new MessageBox("Save changes",'<div style="width:300px"><h2>CloudRun Id changed</h2>Do not forget to save changes and update your CloudRun scripts.</div>',"msg_excl_yellow")}),s&&(k+=6,(T=new Button("choose",image_path("licence"))).setWidth("100%"),T.setTooltip("Type of licence must be chosen"),i.setWidget(T,k,1,1,2),i.setVerticalAlignment(k,1,"middle"),T.setDisabled(!0),T.addOnClickListener(function(){new LicenceDialog(T.getText(),function(e){T.setButton(e,image_path("licence"))})}),k++,(S=new Button("choose",image_path("feedback"))).setWidth("100%"),S.setTooltip("Terms of feedback agremment must be chosen"),i.setWidget(S,k,1,1,2),i.setVerticalAlignment(k,1,"middle"),S.setDisabled(!0),S.addOnClickListener(function(){new FeedbackDialog(S.getText(),function(e){S.setButton(e,image_path("feedback"))})})),null),P=(__auth_software&&(k++,(E=new Button("manage",image_path("authorisation"))).setWidth("100%"),E.setTooltip("Optional 3rd-part software authorisation"),i.setWidget(E,k,1,1,2),i.setVerticalAlignment(k,1,"middle"),E.setDisabled(!0),E.addOnClickListener(function(){new AuthorisationDialog(function(e){n.authorisation=e.auth_dic})})),k++,s?i.setCellSize("","12pt",k++,0):i.setCellSize("","142pt",k++,0),i.setHLine(2,k++,0,1,4),i.setCellSize("","12pt",k++,0),i.setButton("Save changes",image_path("disk"),k++,0,1,4).setWidth("100%").setDisabled(!0)),M=null;s&&(M=i.setButton("Delete my account",image_path("remove"),k++,0,1,4).setWidth("100%").setDisabled(!0)),i.setCellSize("","64pt",k++,0),P.addOnClickListener(function(){var e="";s&&(e=validateUserData(p,m,f),g.getValue().length<=0?e+="<b>Password</b> must be provided (old or new).<p>":_.getValue().length<=0?e+="<b>Password</b> must be retyped for confirmation.<p>":_.getValue()!=g.getValue()&&(e+="<b>Retyped password</b> does not match the original.<p>"),[licence_code.academic,licence_code.commercial].indexOf(T.getText())<0&&(e+="<b>Licence</b> must be chosen.<p>"),[feedback_code.agree1,feedback_code.agree2,feedback_code.decline].indexOf(S.getText())<0&&(e+="<b>Feedback agreement</b> must be chosen.<p>"));for(var t=0;t<C.length;t++){var i=C[t][1].getValue().trim();i.length<=0?e+="<b>Value for "+C[t][0]+"</b> must be given.<p>":isFloat(i)?C[t].push(parseFloat(i)/100):e+="<b>Value for "+C[t][0]+"</b> is misformatted.<p>"}e?new MessageBox(a+" Update",a+" Update cannot be done due to the following:<p>"+e+"Please provide all needful data and try again","msg_information"):(s&&(n.name=p.getValue(),n.email=m.getValue(),n.login=f.getValue(),n.pwd=g.getValue(),n.licence=T.getText(),n.feedback=S.getText()),n.cloudrun_id=v.getValue(),n.action=userdata_action.none,__user_settings.onlogin=x.getValue(),__user_settings.jobdlg_size=[C[0][2],C[1][2]],__user_settings.viewers_size=[C[2][2],C[3][2]],__user_settings.project_prefix=D.getValue(),__user_settings.guided_import=L.getValue(),__user_settings.notifications.end_of_job.send=A.getValue(),__user_settings.notifications.end_of_job.lapse=R.getValue(),n.settings=__user_settings,serverRequest(fe_reqtype.updateUserData,n,a,function(e){s?(e?new MessageBoxW(a,e+"<p>You are logged out now, please login again.",.5,"msg_excl"):new MessageBox(a,"Dear "+n.name+",<p>Your account has been successfully updated, and notification<br>sent to your e-mail address:<p><b><i>"+n.email+"</i></b>.<p>You are logged out now, please login again.","msg_information"),stopSessionChecks(),makeLoginPage(o)):makeProjectListPage(o)},null,"persist"))}),M&&M.addOnClickListener(function(){var e=new InputBox("Delete My Account"),t=new InputText("");t.setStyle("password","","Your password",""),t.setFontSize("112%").setFontItalic(!0).setWidth_px(200),e.setText("","msg_confirm"),(ibx_grid=e.grid).setWidget(new Label("<h2>Delete My Account</h2>Your account will be deleted, are you sure?<p>Once deleted, all your data, including registration details,<br>imported files, projects and results will be removed from<br>the server irrevocably.<p>In order to confirm complete deletion of your account and<br>all associated data, in your password and press <b>Confirm</b><br>button."),0,2,2,3),ibx_grid.setWidget(new Label("Password:").setWidth("75px"),2,2,1,1),ibx_grid.setWidget(t,2,3,1,1),ibx_grid.setLabel("&nbsp;",2,4,1,1).setWidth("80px"),ibx_grid.setVerticalAlignment(2,2,"middle"),ibx_grid.setVerticalAlignment(2,3,"middle"),e.launch("Confirm",function(){return t.getValue().length<=0?(new MessageBox("Delete My Account","Please provide password and try again","msg_excl"),!1):(n.name=p.getValue(),n.email=m.getValue(),n.login=f.getValue(),n.pwd=t.getValue(),n.licence=T.getText(),n.feedback=S.getText(),serverRequest(fe_reqtype.deleteUser,n,"Delete My Account",function(e){e?new MessageBoxW("Delete My Account",e,.5):(new MessageBox("Delete My Account","Dear "+n.name+",<p>Your account and all associated data have been<br>successfully deleted, and notification sent<br>to your e-mail address:<p><b><i>"+n.email+"</i></b>.<p>You are logged out now."),stopSessionChecks(),makeLoginPage(o))},null,"persist"),!0)})}),serverRequest(fe_reqtype.getUserData,0,a,function(e){var t=checkUserData(n=e);0<t.length&&!__local_user&&window.setTimeout(function(){new MessageBox("Update Account Data","Please check your account settings:<ul>"+t+"</ul>To confirm your changes, push <b>Save changes</b> button.","msg_excl")},0),v.setValue(n.cloudrun_id),s&&(p.setValue(n.name),m.setValue(n.email),f.setValue(n.login),T.setButton(n.licence,image_path("licence")),0<n.feedback.length&&0<=[feedback_code.agree1,feedback_code.agree2,feedback_code.decline].indexOf(n.feedback)&&S.setButton(n.feedback,image_path("feedback")),T.setDisabled(!1),S.setDisabled(!1),M.setDisabled(!1)),E&&E.setDisabled(!1),P.setDisabled(!1),setDefaultButton(P,i)},null,"persist")}else alert(" NOT LOGED IN")}function makeAccountPage(e){makePage(new AccountPage(e)),setHistoryState("AccountPage")}function AdminPage(e){if(BasePage.call(this,e,"-full","AdminPage"),__login_token){this.makeHeader(3,null);this.headerPanel.setLabel(appName()+" Administration Facility",0,2,1,1).setFont("times","150%",!0,!0).setNoWrap().setHorizontalAlignment("left"),this.headerPanel.setVerticalAlignment(0,2,"middle"),this.headerPanel.setCellSize("99%","",0,3);for(var t=4,i=this.headerPanel.setButton("",image_path("refresh"),0,t,1,1),o=(i.setSize("30px","30px").setTooltip("Refresh"),"My Account"),o=(__local_user&&(o="Settings"),this.addMenuItem(o,"settings",function(){makeAccountPage(e)}).addMenuItem("Project folder","list",function(){makeProjectListPage(e)}).addLogoutToMenu(function(){logout(e,0)}),this.tabs=new Tabs,this.usersTab=this.tabs.addTab("Users",!0),this.nodesTab=this.tabs.addTab("Nodes",!1),this.anlTab=this.tabs.addTab("Monitor",!1),this.usageTab=this.tabs.addTab("Usage",!1),this.jobsTab=this.tabs.addTab("Jobs",!1),this.grid.setCellSize("5pt","auto",1,0,1,1),this.grid.setWidget(this.tabs,1,1,1,1),this.grid.setCellSize("5pt","auto",1,2,1,1),this.makeLogoPanel(2,0,3),this.jobsTitle=this.jobsTab.grid.setLabel("",0,0,1,1).setHeight_px(32),this.jobStats=this.jobsTab.grid.setLabel("",1,0,1,1).setHeight_px(32),this.usersTitle=this.usersTab.grid.setLabel("",0,0,1,1).setHeight_px(32),this.userListTable=null,this.uaPanel=new Grid(""),this.usersTab.grid.setWidget(this.uaPanel,0,1,1,1),this.usersTab.grid.setCellSize("","32px",0,0),this.usersTab.grid.setCellSize("","32px",0,1),this.usersTab.grid.setVerticalAlignment(0,0,"middle"),this.usersTab.grid.setVerticalAlignment(0,1,"middle"),this.uaPanel.setLabel("   ",0,0,1,1),this.uaPanel.setCellSize("95%","32px",0,0),t=1,this.uaPanel.setButton("",image_path("user"),0,t++,1,1).setSize("30px","30px").setTooltip("Make new user")),n=this.uaPanel.setButton("",image_path("dormant"),0,t++,1,1).setSize("30px","30px").setTooltip("Identify and mark dormant users"),s=this.uaPanel.setButton("",image_path("announce"),0,t++,1,1).setSize("30px","30px").setTooltip("Send e-mail announcement to all users"),a=1;a<t;a++)this.uaPanel.setCellSize("auto","32px",0,a);this.usageStats=this.usageTab.grid.setIFrame("",0,0,1,1).setFramePosition("0px","50px","100%","92%"),this.usageStats._url="",this.usageStats._loaded=!1,this.nodesTitle=this.nodesTab.grid.setLabel("",0,0,1,1).setHeight_px(32),this.nodeListTable=null,this.naPanel=new Grid(""),this.nodesTab.grid.setWidget(this.naPanel,0,1,1,1),this.nodesTab.grid.setCellSize("","32px",0,0),this.nodesTab.grid.setCellSize("","32px",0,1),this.nodesTab.grid.setVerticalAlignment(0,0,"middle"),this.nodesTab.grid.setVerticalAlignment(0,1,"middle"),this.naPanel.setLabel("   ",0,0,1,1),this.naPanel.setCellSize("95%","32px",0,0);for(var t=1,r=this.naPanel.setButton("",image_path("ghost"),0,t++,1,1).setSize("30px","30px").setTooltip("Wake up zombies"),l=this.naPanel.setButton("",image_path("update"),0,t++,1,1).setSize("30px","30px").setTooltip("Update and restart"),a=1;a<t;a++)this.naPanel.setCellSize("auto","32px",0,a);this.onResize(window.innerWidth,window.innerHeight);var c=this;c.tabs.setTabChangeListener(function(e){c.loadUsageStats()}),o.addOnClickListener(function(){makeRegisterPage(e)}),n.addOnClickListener(function(){new DormantUsersDialog(function(){i.click()})}),r.addOnClickListener(function(){serverRequest(fe_reqtype.wakeZombieJobs,{project:"*"},"Admin Page",function(e){new MessageBox("Wake Zombie jobs","<h2>Wake Zombie jobs</h2>Total "+e.nzombies+" zombie jobs found and awaken.<p>Reload page after a minute or so.","msg_information")},null,function(){new MessageBox("Wake Zombie jobs","<h2>Communication errors</h2>Communication errors with Number Crunchers.","msg_error")})}),l.addOnClickListener(function(){new QuestionBox(appName()+" update",'<div style="width:400px"><h2>'+appName()+" update</h2>"+appName()+" will be shut down, updated and restarted. This is administrative action, which will work only if "+appName()+"is appropriately configured. Use this only if you know what you are doing.<p>Are you sure?",[{name:"Yes, update and restart",onclick:function(){stopSessionChecks(),serverRequest(fe_reqtype.updateAndRestart,"","Admin Page",function(e){window.setTimeout(function(){reloadBrowser()},6e4),logout(c.element.id,10)},null,function(){})}},{name:"No, cancel",onclick:function(){}}],"msg_confirm")}),s.addOnClickListener(function(){new AnnounceDialog}),i.addOnClickListener(function(){c.refresh()}),i.click()}else alert(" NOT LOGED IN")}function makeAdminPage(e){makePage(new AdminPage(e)),setHistoryState("AdminPage")}function ForgottenLoginPage(e){__login_token=__login_token&&"",BasePage.call(this,e,"-full","ForgottenLoginPage"),this.grid.setCellSize("45%","",0,0,1,1),this.grid.setVerticalAlignment(0,1,"middle"),this.grid.setCellSize("10%","",0,1,1,1),this.grid.setCellSize("45%","",0,2,1,1),this.makeLogoPanel(1,0,3);var t=new Grid(""),i=(t.setWidth("300pt"),this.grid.setWidget(t,0,1,1,1),new Label("CCP4 Login Recovery")),o=new Label("E-mail:"),n=new InputText(""),s=new Label("Please specify e-mail address, which was used for registering with "+appName()+', and push the "E-mail ..." button below. Your login name(s) and password(s) will be e-mailed to you then.'),a=(i.setFont("times","200%",!0,!0),o.setFontSize("125%"),s.setFontSize("90%"),n.setStyle("email","","john.smith@university.ac.uk","Should be a valid e-mail address, which was used\n for registering with "+appName()+"."),n.setFontSize("112%"),n.setFontItalic(!0),n.setWidth("95%"),0),i=(t.setWidget(i,0,0,1,2),t.setHorizontalAlignment(a++,0,"center"),t.setWidget(this.makeSetupNamePanel(),a++,0,1,2),t.setCellSize("","20pt",a++,0),t.setWidget(o,3,0,1,1),t.setVerticalAlignment(3,0,"middle"),t.setWidget(n,a++,1,1,1),t.setCellSize("","6pt",a++,0),t.setWidget(s,a++,0,1,2),t.setCellSize("","12pt",a++,0),t.setWidget(new HLine("3pt"),a++,0,1,2),t.setCellSize("","1pt",a++,0),new Button("E-mail my login details to me",image_path("email"))),o=new Button("Back to User Login",image_path("login"));i.setWidth("100%"),o.setWidth("100%"),t.setWidget(i,+a,0,1,2),t.setWidget(o,10,0,1,2),o.addOnClickListener(function(){makeLoginPage(e)}),i.addOnClickListener(function(){var e="";n.getValue().length<=0?e+="<b>E-mail address</b> must be provided.<p>":n.element.validity.typeMismatch&&(e+="<b>E-mail address</b> should the correct one. Your login details<br>will be sent to the e-mail provided.<p>"),e?new MessageBox("Login Recover","Login Recovery cannot be done due to the following reasons:<p>"+e+"<p>Please provide all needful data and try again","msg_warning"):((ud=new UserData).email=n.getValue(),serverCommand(fe_command.recoverLogin,ud,"CCP4 Login Recovery",function(e){switch(e.status){case fe_retcode.ok:return e.data?new MessageBoxW("CCP4 Login Recovery",e.data,.4):new MessageBox("CCP4 Login Recovery","Dear "+e.message+',<p>You login details have been successfully recovered and sent to you at<br><i>"'+ud.email+'"</i>.<p>Please check your e-mail and return to the login page.',"msg_information"),!0;case fe_retcode.userNotFound:return new MessageBox("CCP4 Login Recovery",'No user with e-mail <i>"'+ud.email+'"</i> has been found.<p>',"msg_excl"),!0}return!1},null,null))}),setDefaultButton(i,this.grid)}function makeForgottenLoginPage(e){makePage(new ForgottenLoginPage(e)),setHistoryState("ForgottenLoginPage")}function _privacyStatement(){new HelpBox("Privacy Statement","./html/privacy_statement.html",null)}function _ccp4_download(){window.open("https://www.ccp4.ac.uk/download/")}function LoginPage(t){__login_user=__login_token="",__announcement_made=!1,BasePage.call(this,t,"-full","LoginPage");var e=new Grid(""),i=(e.setWidth("300pt"),this.grid.setCellSize("45%","",0,0,1,1),this.grid.setCellSize("","15px",0,0,1,3),this.grid.setWidget(e,1,1,1,1),this.grid.setVerticalAlignment(1,1,"middle"),this.grid.setCellSize("10%","",1,1,1,1),this.grid.setCellSize("45%","",1,2,1,1),this.grid.setLabel("&nbsp;",2,0,1,3)),o=(this.grid.setHorizontalAlignment(2,0,"center"),this.grid.setVerticalAlignment(2,0,"top"),this.grid.setCellSize("","12px",2,0,1,3),this.grid.setCellSize("","3px",3,0,1,3),this.makeLogoPanel(4,0,3),__mobile_device||window.setTimeout(function(){var e,t;__tips&&__tips.use_tips&&0<__tips.tips.length&&(e=0,e="tipNo"in __tips?__tips.tipNo:round(Date.now()/5e3,0),e%=__tips.tips.length,t="<a href=\"javascript:launchHelpBox('"+__tips.tips[e].title+"','"+__tips.tips[e].doc+"/"+__tips.tips[e].link+"',null,10)\">",i.setText('<img src="'+image_path("tip")+'" style="width:24px;height:24px;vertical-align:bottom;"/><span><i style="font-style:Garamond;color:#666666;">'+__tips.tips[e].summary.replace("<a>",t)+"</i></span>"))},1e3),new Label("Login name:")),n=new Label("Password:"),s=new InputText(""),a=new InputText(""),r=new ImageButton(image_path("pwd_hidden"),"32px","14px"),l=(o.setNoWrap(),o.setFontSize("125%"),n.setFontSize("125%"),s.setFontSize("112%"),s.setStyle("text","^[A-Za-z][A-Za-z0-9\\-\\._-]+$","Your CCP4 login",""),r.setTooltip("Toggle password visibility"),r.icon_hidden=!0,s.setFontItalic(!0),a.setFontSize("112%"),a.setStyle("password","","Your CCP4 password",""),a.setFontItalic(!0),s.setWidth("95%"),a.setWidth("95%"),0),o=(e.setLabel(appName()+" Login",l,0,1,3).setFont("times","40px",!0,!0).setNoWrap(),e.setHorizontalAlignment(l++,0,"center"),e.setWidget(this.makeSetupNamePanel(),l++,0,1,3),e.setCellSize("","10pt",l++,0),e.setWidget(o,l,0,1,1),e.setWidget(n,l+1,0,1,1),e.setVerticalAlignment(l,0,"middle"),e.setVerticalAlignment(l+1,0,"middle"),e.setWidget(s,l++,1,1,1),e.setWidget(a,l,1,1,1),e.setWidget(r,l,2,1,1),e.setVerticalAlignment(l++,2,"middle"),e.setCellSize("","4pt",l++,0),e.setWidget(new HLine("3pt"),l++,0,1,3),new Button("Login",image_path("login"))),n=new Button("Forgotten password",image_path("reminder")),c=new Button("Registration",image_path("new_file"));o.setWidth("100%"),n.setWidth("100%"),c.setWidth("100%"),e.setWidget(o,l++,0,1,3),e.setWidget(n,l++,0,1,3),e.setWidget(c,l++,0,1,3),e.setCellSize("","6pt",l++,0),__any_mobile_device?e.setLabel("<center><i>Note: Coot and some other tasks cannot be used when<br>working from tablets and phones<br>&nbsp;</i></center>",l++,0,1,3).setTooltip("For best experience, access this web-site from MS Windows, Linux or Mac OSX device  with CCP4 Software Suite version 7.1 or higher installed.").setNoWrap():__local_service||e.setLabel('<div style="min-width:380px"><center><i><b>NOTE:</b> For using <span style="color:maroon"><b>Coot, DUI, iMosflm</b></span> and similar<br>tasks, install <a href="javascript:_ccp4_download()">the CCP4 Software Suite</a> and start<br>'+appName()+' with this icon:<br><img src="images_com/ccp4cloud_remote.png" style="height:36px;width:36px;padding-top:6px;"/></i></center></div>',l++,0,1,3),e.setLabel("<center><i>Check "+appName()+' <a target="_blank" href="html/roadmap.html">roadmap<a></i> for new users</center>',l++,0,1,3),e.setLabel('<center style="padding-top:6px;"><i><a href="javascript:_privacyStatement()">Privacy Statement<a></i></center>',l++,0,1,3),e.setCellSize("","24pt",l++,0),r.addOnClickListener(function(){r.icon_hidden=!r.icon_hidden,r.icon_hidden?(r.setImage(image_path("pwd_hidden")),a.setType("password")):(r.setImage(image_path("pwd_visible")),a.setType("text"))}),c.addOnClickListener(function(){"email"==__regMode?makeRegisterPage(t):new MessageBox("New user registration","<p>In order to register as a new user, please contact "+appName()+"<br>admin or maintainer in your organisation.","msg_information")}),n.addOnClickListener(function(){"email"==__regMode?makeForgottenLoginPage(t):new MessageBox("Password recovery","<p>In order to reset your password, please contact "+appName()+"<br>admin or maintainer in your organisation.","msg_information")}),o.addOnClickListener(function(){__mobile_device&&setFullScreen();var e="";s.getValue().length<=0?e+="<b>Login name</b> must be provided.<p>":s.element.validity.patternMismatch&&(e+="Login name can contain only latin letters, numbers,\n undescores, dashes and dots, and must start with a letter.<p>"),a.getValue().length<=0&&(e+="<b>Password</b> must be provided."),e?new MessageBox("Login","Login data is either incomplete or incorrect:<p>"+e+"<p>Please provide all needful data and try again","msg_excl"):(e=0,__url_parameters&&(e="id"in __url_parameters?102:101),login(s.getValue(),a.getValue(),t,e))}),setDefaultButton(o,this.grid),__url_parameters&&("project"in __url_parameters?new MessageBox("Log in to "+appName(),"<h2>Log in to "+appName()+"</h2>For getting access to Demo Project<h3>"+__url_parameters.project+"</h3>please log in to your "+appName()+" account now.","msg_information"):"id"in __url_parameters&&new MessageBox("Log in to "+appName(),"<h2>Log in to "+appName()+"</h2>For getting access to Archive Project<h3>"+__url_parameters.id+"</h3>please log in to your "+appName()+" account now.","msg_information"))}function makeLoginPage(e){makePage(new LoginPage(e)),setHistoryState("LoginPage")}function reloadBrowser(){window.location=window.location}function LogoutPage(e,t){__login_user=__login_token="",__user_role=role_code.user,BasePage.call(this,e,"-full","LogoutPage"),this.grid.setCellSize("45%","",0,0,1,1),this.grid.setCellSize("10%","",0,1,1,1),this.grid.setVerticalAlignment(0,1,"middle"),this.grid.setHorizontalAlignment(0,1,"center"),this.grid.setCellSize("45%","",0,2,1,1),this.makeLogoPanel(1,0,3);var e=new Grid(""),i=(e.setWidth("500pt"),this.grid.setWidget(e,0,1,1,1),new Label("Thank you for using "+appName())),o="";switch(t){case 1:o="Your session in this window was closed because you have logged in somewhere else.";break;case 2:o="Your session in this window was terminated because local "+appName()+" service has stopped or was restared.";break;case 3:o="Your session in this window was terminated in order to keep "+appName()+" archiving process uninterrupted. Your account is temporarily suspended and will be made available automatically once archiving is completed.<p>Please try to login after 10-20 minutes. Contact "+report_problem(appName()+" archiving problem","Account remains suspended after archiving for long time.","")+" if you are not able to login after 2 hours.";break;case 10:o=appName()+" is now restarting. Please wait, the page will reload automatically.";break;default:o="You are now logged out."}var n=new Label(o),s=(i.setFont("times","200%",!0,!0),i.setNoWrap(),n.setFontSize("125%"),0);e.setWidget(i,0,0,1,1),e.setHorizontalAlignment(s++,0,"center"),e.setCellSize("","20pt",s++,0),e.setWidget(n,2,0,1,1),e.setHorizontalAlignment(s++,0,"center"),e.setCellSize("","20pt",+s,0),__local_user||10==t||(i=new Button("Back to User Login",image_path("login")),e.setWidget(i,4,0,1,1),e.setHorizontalAlignment(4,0,"center"),i.setWidth("300px"),i.addOnClickListener(function(){reloadBrowser()}),setDefaultButton(i,e)),$(".ui-dialog:visible").find(".ui-dialog-content").dialog("close")}function logout(e,t,i=null){stopOfflineGreeting(),stopSessionChecks(),__current_page&&"ProjectPage"==__current_page._type&&__current_page.getJobTree().stopTaskLoop(),__login_token&&3!=t&&10!=t?serverRequest(fe_reqtype.logout,0,"Logout",function(e){},function(){makePage(new LogoutPage(e,t),i)},null):makePage(new LogoutPage(e,t),i)}function ProjectListPage(t){if(BasePage.call(this,t,"-full","ProjectListPage"),__login_token){var f=new ProjectList(__login_id),i=this.tablesort_tbl=null,g=null,_=null,b=null,y=null,v=null,k=null,w=null,T=null,e=null,S=null,o=null,x=null,C=(this.welcome_lbl=null,0),D=0,L=this,n=null,A=__login_id+"'s Projects",I=Math.max(window.screen.width,window.screen.height)<960,R=function(){j(function(e){makeProjectPage(t)},null)},s=(this._open_project=function(e){j(function(e){makeProjectPage(t)},e)},function(){new AddProjectDialog(f,function(e){if(e)return f.addProject(e.id,e.title,e.startmode,getDateString())?(f.current=e.id,f.startmode=e.startmode,p(),R(),!0):(new MessageBox("Duplicate Project ID","The Project ID chosen (<b>"+e.id+"</b>)<br>is already in the list. Please choose a different Project ID.","msg_excl_yellow"),!1)})}),N=function(){var e=u();e?new ProjectArchiveDialog(e,function(){}):new MessageBox("Current project not identified","<h2>Current project is not identified</h2><i>This is a bug please report to developers.</i>","msg_error")},E=function(){var i,e,t,o,n,s;__current_folder.type==folder_type.archived||__current_folder.type==folder_type.cloud_archive?new MessageBox("Rename Project",'<div style="width:400px"><h2>Projects in this folder cannot be renamed</h2>You may rename only your own projects, which were not shared with other users and were not archived.</div>',"msg_stop"):(x.click(),U()?(t='<div style="width:450px"><h2>Rename Project</h2>',V(!0)?t+="You cannot rename this project because you shared it with other users.<p>Shared projects cannot be renamed until they are unshared.":t+="You cannot rename this project because it was shared with you.<p>Joined projects cannot be renamed.",new MessageBox("Rename Project",t,"msg_stop")):(i=u())?i.archive?new MessageBox("Rename Project",'<div style="width:400px"><h2>Projects from Archive cannot be renamed</h2>Projects which were obtained by cloning from '+appName()+" Archive cannot be renamed.</div>","msg_stop"):(e=i.name,(t=new InputBox("Rename Project")).setText("","renameprj"),(o=t.grid).setLabel('<h2>Rename Project "'+e+'"</h2>',0,2,2,3),o.setLabel("New ID:",2,3,1,1),n=o.setInputText(e,2,4,1,1).setStyle("text","^[A-Za-z0-9\\-\\._]+$","e.g., project-1","").setFontItalic(!0).setWidth("240px"),o.setLabel("New Name:&nbsp;",3,3,1,1),s=o.setInputText(L.tablesort_tbl.selectedRow.child[1].text,3,4,1,1).setStyle("text","","Put a descriptive title here","").setFontItalic(!0).setWidth("520px"),o.setNoWrap(2,2),o.setNoWrap(3,2),o.setVerticalAlignment(2,3,"middle"),o.setVerticalAlignment(3,3,"middle"),t.addWidget(o),t.launch("Rename",function(){return n.getValue().length<=0?(new MessageBox("No Project ID","<b>Project ID is not given</b>.<p>Project cannot be renamed with empty ID.","msg_error"),!1):n.element.validity.patternMismatch?(new MessageBox("Invalid Project ID",'<div style="width:400px"><h2>Invalid project ID</h2><b>Project ID</b> should contain only latin letters, numbers, undescores, dashes and dots, and must start with a letter.</div>',"msg_stop"),!1):s.getValue().length<=0?(new MessageBox("No Project Name","<b>Project Name is not given</b>.<p>Project cannot be renamed with empty name.","msg_error"),!1):(i=f.renameProject(e,s.getValue(),getDateString()))?(t=n.getValue())!=i.name&&f.getProject(t)?(new MessageBox("Duplicate Project ID",'<div style="width:400px;"><h2>Duplicate Project ID</h2>Project with ID <b>"'+t+'"</b> already exists (check all folders).</div>',"msg_excl_yellow"),!1):(i.new_name=t,f.current=e,serverRequest(fe_reqtype.renameProject,i,"Rename Project",function(e){"ok"==e.code?(i.name=t,delete i.new_name,j(function(e){f.current=t,p()},null)):(new MessageBox("Project renaming rejected","<h2>Project renaming rejected</h2><i>"+e.code+"</i>.","msg_error"),p())},null,"persist"),!0):(new MessageBox("Project ID not found","The Project ID <b>"+e+"</b> is not found in the list.<p>This is program error, please report as a bug.","msg_error"),!1);var t})):new MessageBox("Current project not identified","<h2>Current project is not identified</h2><i>This is a bug please report to developers.</i>","msg_error"))},P=function(){x.click();var e=h(),t="",i="Yes, delete",o="Delete Project",n=(V(!1)?t='<h2>Delete Project</h2>Project <b>"'+e+'"</b> will be deleted. All project structure and data will be lost.<p>Please confirm your choice.':(t='<h2>Unjoin Project</h2>Project <b>"'+e+'"</b>, shared with you, will be unjoined, and you will be no longer able to access it until joined again.<p>Please confirm your choice.',i="Please unjoin",o="Unjoin Project"),new InputBox(o));n.setText('<div style="width:400px;">'+t+"</div>","msg_confirm"),n.launch(i,function(){return serverRequest(fe_reqtype.deleteProject,e,o,function(e){L.loadProjectList1()},null,"persist"),!0})},F=function(){x.click(),L.tablesort_tbl.selectedRow?(f.current=h(),new ExportProjectDialog(f)):new MessageBox("No project selected","<h2>No project is selected<h2>This is likely to be a program error. Select project and try again.","msg_error")},B=function(){x.click();var t=z();0<=t?shareProject(f.projects[t],function(e){e&&(f.projects[t]=e,f.resetFolders(__login_id),j(function(e){},null))}):new MessageBox("No Project","<h2>No Project is selected<h2>This is likely to be a program error. Select project and try again.","msg_error")},W=function(){x.click();var s=u();if(!s)return new MessageBox("Current project not identified","<h2>Current project is not identified</h2><i>This is a bug please report to developers.</i>","msg_error"),!1;if(L.ration&&0<L.ration.storage&&L.ration.storage_used+s.disk_space>L.ration.storage)return new MessageBox("Disk Quota is short",'<div style="width:500px;"><h3>Insufficient Disk Space</h3>The project cannot be cloned because disk quota is short. Your account currently uses <b>'+round(L.ration.storage_used,1)+"</b> MBytes out of <b>"+round(L.ration.storage,1)+"</b> MBytes allocated.<p><i><b>Hint 1:</b></i> deleting jobs and projects will free up disk space.<p><i><b>Hint 2:</b></i> resource usage can be monitored using disk and CPU widgets in the top-right corner of the screen.<p><i><b>Recommended action:</b></i> export an old project and then delete it from the list. You will be able to re-import that project later using the file exported.</div>","msg_stop"),!1;var e=s.name,t=new InputBox("Clone Project"),i=(t.setText("","cloneprj"),t.grid),o=(i.setLabel('<h2>Clone Project "'+e+'"</h2>',0,2,2,3),i.setLabel("Cloned Project ID:",2,3,1,1),e+"-clone"),n=L.tablesort_tbl.selectedRow.child[1].text.trim(),a=(s.archive?(o=e+"-rev"+s.archive.version,n=n.split(": Revision #")[0]+": Revision #"+s.archive.version):n+=" (cloned)",i.setInputText(o,2,4,1,1).setStyle("text","^[A-Za-z0-9\\-\\._]+$","e.g., project-1","").setFontItalic(!0).setWidth("240px").setReadOnly(null!=s.archive)),r=(i.setLabel("Cloned Project Name:&nbsp;",3,3,1,1),i.setInputText(n,3,4,1,1).setStyle("text","","Put a descriptive title here","").setFontItalic(!0).setWidth("520px").setReadOnly(null!=s.archive));i.setNoWrap(2,3),i.setNoWrap(3,3),i.setVerticalAlignment(2,3,"middle"),i.setVerticalAlignment(3,3,"middle"),t.launch("Clone",function(){if(a.getValue().length<=0)return new MessageBox("No Project ID","<b>Project ID is not given</b>.<p>Project cannot be renamed with empty ID.","msg_excl_yellow"),!1;if(r.getValue().length<=0)return new MessageBox("No Project Name","<b>Project Name is not given</b>.<p>Project cannot be renamed with empty name.","msg_excl_yellow"),!1;var n=a.getValue();return f.getProject(n)?(new MessageBox("Duplicate Project ID",'<div style="width:400px;"><h2>Duplicate Project ID</h2>Project with ID <b>"'+n+'"</b> already exists (check all folders).</div>',"msg_stop"),!1):(s.new_name=n,s.new_title=r.getValue(),new WaitDialog("Clone Project","",function(e,t){var i=new Grid(""),e=(e.addWidget(i),i.setLabel("<h3>Cloning project in progress, please wait ...</h3>",0,0,1,3),new ProgressBar(0));function o(){serverRequest(fe_reqtype.checkCloneProject,n,"Check Project Clone Status",function(e){"done"==e.code?(t(),L.loadProjectList1()):"fail"==e.code?(t(),new MessageBox("Project cloning failed","<h2>Project cloning failed</h2><i>Please report this to your "+appName()+" maintainer</i>.","msg_error")):window.setTimeout(o,1e3)},null,function(){window.setTimeout(o,1e3)})}i.setWidget(e,1,0,1,3),i.setLabel('<i style="font-size:85%;">this may take long time; the dialog will close automatically</i>',2,0,1,3),serverRequest(fe_reqtype.cloneProject,s,"Clone Project",function(e){"ok"==e.code?o():(t(),new MessageBox("Project cloning rejected","<h2>Project cloning rejected</h2><i>"+e.code+"</i>.","msg_error"))},null,"persist")}),!0)})},M=function(){x.click();var e=u();if(!e)return new MessageBox("Current project not identified","<h2>Current project is not identified</h2><i>This is a bug please report to developers.</i>","msg_error"),!1;var t=new InputBox("Delist project");__current_folder.type==folder_type.cloud_archive?(t.setText('<div style="width:400px;"><h2>Delist Project</h2>Project <b>"'+e.name+'"</b> will be removed from the list of accessed projects of the '+appName()+" Archive.<p>Please confirm.</div>","folder_cloud_archive_delist"),t.launch("Delist",function(){return serverRequest(fe_reqtype.deleteProject,e.name,"Delist project",function(e){L.loadProjectList1()},null,"persist"),!0})):(t.setText('<div style="width:400px;"><h2>Delist Project</h2>Project <b>"'+e.name+'"</b> will be removed from list <i>"'+__current_folder.path+'"</i>. This is not a deletion; the project will remain intact in its folder.<p>Please confirm.</div>',"folder_list_custom_delist"),t.launch("Delist",function(){return removeProjectLabel(__login_id,e,__current_folder.path),f.resetFolders(__login_id),j(function(e){p()},null),!0}))},a=(this.loadProjectList1=function(){X(),L.getUserRation()},this.makeHeader(3,null),this.headerPanel.setCellSize("30%","",0,2),i=new ImageButton(image_path("folder_projects"),"34px","34px").setTooltip("Browse project folders").setVisible(!1),this.headerPanel.setWidget(i,0,3,1,1),this.headerPanel.setVerticalAlignment(0,3,"middle"),this.headerPanel.setHorizontalAlignment(0,3,"right"),n=this.headerPanel.setLabel("&nbsp;My Projects",0,4,1,1).setFont("times","200%",!0,!0).setNoWrap().setVisible(!1),this.headerPanel.setCellSize("60%","",0,4),this.headerPanel.setVerticalAlignment(0,4,"middle"),this.headerPanel.setHorizontalAlignment(0,4,"left"),i.addOnClickListener(function(){O("select")}),n.addOnClickListener(function(){O("select")}),this.addMenuItem("Change project folder","folder_projects",function(){O("select")}),"My Account"),r=(__local_user&&(a="Settings"),this.addMenuItem(a,"settings",function(){j(function(e){makeAccountPage(t)},null)}),__user_role==role_code.admin&&this.addMenuItem("Admin Page",role_code.admin,function(){j(function(e){makeAdminPage(t)},null)}),__user_role!=role_code.developer&&__user_role!=role_code.admin||(this.addMenuSeparator(),__jobs_safe&&this.addMenuItem("Failed Tasks Safe","development",function(){new ExportFromSafeDialog(function(){})}),this.addMenuItem("Developer's Documentation","development",function(){new HelpBox("",__dev_reference_base_url+"index.html",null)})),this.addLogoutToMenu(function(){j(function(e){logout(t,0)},null)}),[]),a="26pt",m="18pt",H="28pt";if(I)for(var m="2pt",H="22pt",g=new Button("",image_path("go")),_=new Button("",image_path("add")),b=new Button("",image_path("renameprj")),y=new Button("",image_path("cloneprj")),v=new Button("",image_path("folder_projects")),k=new Button("",image_path("remove")),w=new Button("",image_path("export")),T=new Button("",image_path("import")),S=new Button("",image_path("join")),e=new Button("",image_path("demoprj")),o=new Button("",image_path("help")),l=0;l<11;l++)r.push("30pt");else g=new Button("Open",image_path("go")),_=new Button("Add",image_path("add")),b=new Button("Rename",image_path("renameprj")),y=new Button("Clone",image_path("cloneprj")),v=new Button("Move",image_path("folder_projects")),k=new Button("Delete",image_path("remove")),w=new Button("Export",image_path("export")),T=new Button("Import",image_path("import")),S=new Button("Join",image_path("join")),e=new Button("Tutorials",image_path("demoprj")),o=new Button("Help",image_path("help")),r=["65pt","60pt","80pt","70pt","65pt","70pt","70pt","70pt","60pt","80pt","60pt"];g.setWidth(r[0]).setHeight(a),_.setWidth(r[1]).setHeight(a),b.setWidth(r[2]).setHeight(a),y.setWidth(r[3]).setHeight(a),v.setWidth(r[4]).setHeight(a),k.setWidth(r[5]).setHeight(a),w.setWidth(r[6]).setHeight(a),T.setWidth(r[7]).setHeight(a),S.setWidth(r[8]).setHeight(a),e.setWidth(r[9]).setHeight(a),o.setWidth(r[10]).setHeight(a),x=new Grid(""),this.grid.setCellSize(m,"",1,0,1,1),this.grid.setWidget(x,1,1,1,1),this.grid.setCellSize(H,"100%",1,2,1,1),x.setVerticalAlignment(1,1,"middle"),this.makeLogoPanel(2,0,3);var c=0;x.setHorizontalAlignment(c,0,"center"),x.setCellSize("","10pt",c++,0),C=0,x.setWidget(g,c,C++,1,1),x.setWidget(_,c,C++,1,1),x.setWidget(b,c,C++,1,1),x.setWidget(y,c,C++,1,1),x.setWidget(v,c,C++,1,1),x.setWidget(k,c,C++,1,1),x.setWidget(w,c,C++,1,1),x.setWidget(T,c,C++,1,1),x.setWidget(S,c,C++,1,1),x.setWidget(e,c,C++,1,1),x.setWidget(o,c,C++,1,1);for(var d,l=0;l<C-1;l++)x.setCellSize(r[l],"",c,l);x.setCellSize("auto","",c++,C-1),g.setDisabled(!0),_.setDisabled(!0),b.setDisabled(!0),y.setDisabled(!0),v.setDisabled(!0),k.setDisabled(!0),T.setDisabled(!0),D=c,g.addOnClickListener(R),_.addOnClickListener(function(){__current_folder.type==folder_type.cloud_archive?new AccessArchiveDialog(function(e){e&&L.loadProjectList1()}):__current_folder.path.startsWith(A)||__current_folder.type==folder_type.all_projects?s():new QuestionBox("Cannot create project in this folder","<h2>Cannot create Project in this folder</h2>Projects can be created only in <i>My Projects</i> area.<p>Create new Project in <i>My Projects</i> and switch there?",[{name:"Yes",onclick:function(){f.setCurrentFolder(f.folders[0]),__current_folder=f.currentFolder,s()}},{name:"Cancel",onclick:function(){}}],"msg_question")}),b.addOnClickListener(E),y.addOnClickListener(W),v.addOnClickListener(function(){__current_folder.type==folder_type.custom_list||__current_folder.type==folder_type.cloud_archive?M():O("move")}),k.addOnClickListener(P),w.addOnClickListener(F),T.addOnClickListener(function(){new ImportProjectDialog(L.loadProjectList1)}),S.addOnClickListener(function(){new ImportSharedProjectDialog(L.loadProjectList1)}),d=this,e.addOnClickListener(function(){__demo_projects?(d.currentCloudPath=__demo_projects,new CloudFileBrowser(null,d,5,[],function(e){return serverRequest(fe_reqtype.startDemoImport,{cloudpath:d.currentCloudPath,demoprj:e[0]},"Tutorial/Demo Project Import",function(e){new ImportDemoProjectDialog(d.loadProjectList1)}),1})):new MessageBox("Tutorials/Demo not installed",'<div style="width:450px"><h3>Tutorials package is not installed</h3>See installation instructions in CCP4 Download Pages or contact your '+appName()+" maintainer.</div>","msg_excl_yellow")}),o.addOnClickListener(function(){new HelpBox("",__user_guide_base_url+"jscofe_myprojects.html",null)}),window.setTimeout(function(){X(),offlineGreeting(function(){})},10)}else alert(" NOT LOGED IN");function h(){return 0<__current_folder.nprojects?L.tablesort_tbl.selectedRow.child[0].text.split(":</b>").pop():""}function u(){var e=null;if(0<__current_folder.nprojects)for(var t=h(),i=0;i<f.projects.length&&!e;i++)f.projects[i].name==t&&(e=f.projects[i]);return e}function z(){var e=-1;if(0<__current_folder.nprojects)for(var t=h(),i=0;i<f.projects.length&&e<0;i++)f.projects[i].name==t&&(e=i);return e}function U(){var e=u();return e&&0<Object.keys(e.share).length}function V(e){var t=u();return t&&(e?getProjectAuthor(t)==__login_id:t.owner.login==__login_id)}function q(){switch(__current_folder.type){case folder_type.custom_list:case folder_type.list:case folder_type.shared:case folder_type.joined:case folder_type.all_projects:return 1}}function G(e){if(n&&(n.setText("&nbsp;"+folderPathTitle(e,__login_id,50)),n.setFont("times","200%",!0,!0),n.setVisible(!0)),i){var t="folder_projects";switch(e.type){case folder_type.custom_list:t="folder_list_custom";break;case folder_type.list:case folder_type.shared:case folder_type.joined:case folder_type.all_projects:t="folder_list";break;case folder_type.archived:t="folder_my_archive";break;case folder_type.cloud_archive:t="folder_cloud_archive";break;case folder_type.tutorials:t="folder_tutorials";break;case folder_type.user:t="folder_projects_user"}i.setImage(image_path(t)),i.setVisible(!0)}}function j(t,e){if(f.current=e||"",L.tablesort_tbl.selectedRow){e||(f.current=h());for(var i=0;i<f.projects.length;i++){var o=f.projects[i];if(o.name==f.current){o.dateLastUsed=getDateString();break}}}f.sortList=L.tablesort_tbl.getSortList(),serverRequest(fe_reqtype.saveProjectList,f,"Project List",function(e){t&&t(e),L.updateUserRationDisplay(e)},null,"persist")}function K(e){return e.archive&&e.archive.in_archive?e.owner.login==__login_id?__current_folder.type==folder_type.archived:__current_folder.type==folder_type.cloud_archive:e.folderPath==__current_folder.path||__current_folder.type==folder_type.joined&&isProjectJoined(__login_id,e)||__current_folder.type==folder_type.shared&&isProjectShared(__login_id,e)||__current_folder.type==folder_type.custom_list&&checkProjectLabel(__login_id,e,__current_folder.path)||__current_folder.type==folder_type.all_projects}function p(){L.tablesort_tbl?f.sortList=L.tablesort_tbl.getSortList():"sortList"in f||(f.sortList=[[5,1]]),0<=__current_folder.nprojects?__current_folder=f.currentFolder:f.currentFolder=__current_folder;for(var e=0,t=0;t<f.projects.length;t++)K(f.projects[t])&&e++;switch(__current_folder.nprojects=e,__current_folder.type){case folder_type.shared:f.folders[1].nprojects=e;break;case folder_type.joined:f.folders[2].nprojects=e;break;case folder_type.all_projects:f.folders[3].nprojects=e;break;case folder_type.archived:f.folders[4].nprojects=e;break;case folder_type.cloud_archive:f.folders[5].nprojects=e}G(__current_folder);var i=__current_folder.type==folder_type.archived||__current_folder.type==folder_type.cloud_archive,o=(L.tablesort_tbl=new TableSort,[]),o=(L.tablesort_tbl.setHeaders((o=i?["Archive ID"]:o).concat(["ID","Name","<center>R<sub>free</sub></center>","<center>Disk<br>(MBytes)</center>","<center>CPU<br>(hours)</center>","<center>Date<br>Created</center>","<center>Last<br>Opened</center>"])),x.setWidget(L.tablesort_tbl,D,0,1,C),"folder"),o='<div style="width:100%;color:darkgrey">&nbsp;<p>&nbsp;<p><h3>There are no projects in '+(o=q()?"list":o)+' "'+folderPathTitle(__current_folder,__login_id,1e3)+'".<p>Use "Add" button to create a new Project;<br>"Import" button for importing a project exported from '+appName()+';<br>"Join" button for joining project shared with you by another user;<br>or "Tutorials" button for loading tutorial/demo projects;<br>or click on page title or folder icon in it to change the folder.</h3></div>',o=(L.welcome_lbl=x.setLabel(o,D+1,0,1,C).setFontItalic(!0).setNoWrap(),x.setHorizontalAlignment(D+1,0,"center"),"Add"),n="add",s="60pt",o=(__current_folder.type==folder_type.cloud_archive&&(o="Access",n="folder_cloud_archive",s="75pt"),I&&(o="",s="30pt"),_.setButton(o,image_path(n)).setWidth(s),""),n="folder_projects";if([folder_type.custom_list,folder_type.shared,folder_type.joined,folder_type.all_projects].includes(__current_folder.type)?(I||(o="Delist"),n="folder_list_custom_delist"):__current_folder.type==folder_type.cloud_archive?(I||(o="Delist"),n="folder_cloud_archive_delist"):I||(o="Move"),v.setButton(o,image_path(n)),e<=0){__current_project=null;var a=L.tablesort_tbl.addRow();i&&a.addCell(""),a.addCell(""),a.addCell(""),a.addCell(""),a.addCell(""),a.addCell(""),a.addCell(""),a.addCell(""),L.tablesort_tbl.createTable(null),g.setDisabled(!0),_.setDisabled(0!=__dormant),b.setDisabled(!0),y.setDisabled(!0),v.setDisabled(!0),k.setDisabled(!0),T.setDisabled(0!=__dormant),w.setDisabled(!0),S.setDisabled(0!=__dormant)}else{for(var r,l,c,d,h,u,p=null,e=0,t=0;t<f.projects.length;t++){function m(e,t){u+="<tr><td>"+e+"</td><td>"+t+"</td></tr>"}K(f.projects[t])&&(a=L.tablesort_tbl.addRow(),l=(r=f.projects[t]).name,i&&(l=r.archive.project_name),d=!(c=["","",""]),"owner"in r&&(0<Object.keys(r.share).length?r.owner.login!=__login_id&&(c=["<i>","</i>","is not included in user's quota"],l="<b>[<i>"+r.owner.login+"</i>]:</b>"+l,d=!0):"author"in r.owner&&r.owner.author&&r.owner.author!=r.owner.login&&r.owner.author!=__login_id&&(l="<b>(<i>"+r.owner.author+"</i>):</b>"+l)),function(){var e=I?"":d?"Unjoin":"Delete";$(a.element).click(function(){k.setText(e)}),(h=new ContextMenu(a,function(){k.setText(e)})).addItem("Open",image_path("go")).addOnClickListener(R),i||h.addItem("Rename",image_path("renameprj")).addOnClickListener(E),i||h.addItem(e,image_path("remove")).addOnClickListener(P),h.addItem("Export",image_path("export")).addOnClickListener(F),i||__current_folder.type==folder_type.joined||h.addItem("Share",image_path("share")).addOnClickListener(B),h.addItem("Clone",image_path("cloneprj")).addOnClickListener(W),__current_folder.type==folder_type.user&&__current_folder.path.startsWith(A)||__current_folder.type==folder_type.tutorials?h.addItem("Move",image_path("folder_projects")).addOnClickListener(function(){O("move")}):__current_folder.type==folder_type.custom_list?h.addItem("Delist",image_path("folder_list_custom_delist")).addOnClickListener(function(){M()}):__current_folder.type==folder_type.cloud_archive&&h.addItem("Delist",image_path("folder_cloud_archive_delist")).addOnClickListener(function(){M()}),__is_archive&&r.folderPath.startsWith(A)&&h.addItem("Archive",image_path("archive")).addOnClickListener(N)}(),i&&a.addCell(r.archive.id).setNoWrap(),a.addCell(l).setNoWrap(),a.addCell(r.title).insertWidget(h,0),"metrics"in r&&"R_free"in r.metrics&&r.metrics.R_free<"1.0"?(u='<table class="table-rations"><tr><td colspan="2"><b><i>Best scores (job '+padDigits(r.metrics.jobId,4)+')</i></b></td></tr><tr><td colspan="2"><hr/></td></tr>',m("R-free/R-factor","<b>"+round(r.metrics.R_free,4)+"</b> / "+round(r.metrics.R_factor,4)),m("Residues/Units modelled&nbsp;&nbsp;&nbsp;","<b>"+r.metrics.nRes_Model+"</b> / <b>"+r.metrics.nUnits_Model+"</b>"),u+='</table><table class="table-rations"><tr><td colspan="2">&nbsp;<br><b><i>Project data</i></b></td></tr><tr><td colspan="2"><hr/></td></tr>',m("Space group",r.metrics.SG),m("High resolution&nbsp;&nbsp;&nbsp;",round(r.metrics.res_high,2)+" &Aring;"),0<r.metrics.Solvent&&m("Solvent content&nbsp;&nbsp;&nbsp;",round(r.metrics.Solvent,1)+"%"),0<r.metrics.MolWeight&&m("ASU Molecular weight",round(r.metrics.MolWeight,1)),0<r.metrics.nRes_ASU&&m("Residues/Units expected&nbsp;&nbsp;&nbsp;","<b>"+r.metrics.nRes_ASU+"</b> / <b>"+r.metrics.nUnits_ASU+"</b>"),"ha_type"in r.metrics&&0<r.metrics.ha_type.length&&m("HA type",r.metrics.ha_type),a.addCell(r.metrics.R_free).setNoWrap().setTooltip1(u+"</table>","show",!1,2e4)):a.addCell(""),(r.hasOwnProperty("disk_space")?a.addCell(c[0]+round(r.disk_space,1)+c[1]):a.addCell(c[0]+"-:-"+c[1])).setNoWrap().setTooltip(c[2]),(r.hasOwnProperty("cpu_time")?a.addCell(c[0]+round(r.cpu_time,4)+c[1]):a.addCell(c[0]+"-:-"+c[1])).setNoWrap().setTooltip(c[2]),a.addCell(r.dateCreated).setNoWrap().setHorizontalAlignment("center"),a.addCell(r.dateLastUsed).setNoWrap().setHorizontalAlignment("center"),0!=e&&r.name!=f.current||(p=a),e++)}L.tablesort_tbl.createTable(function(){j(null,null)}),f.sortList&&window.setTimeout(function(){L.tablesort_tbl.applySortList(f.sortList,!0)},10),L.tablesort_tbl.selectRow(p),p.click(),g.setDisabled(!1),_.setDisabled(0!=__dormant),b.setDisabled(i),y.setDisabled(!1),v.setEnabled(__current_folder.path.startsWith(A)||[folder_type.tutorials,folder_type.custom_list,folder_type.cloud_archive].includes(__current_folder.type)),k.setDisabled(i),T.setDisabled(0!=__dormant),w.setDisabled(!1),S.setDisabled(0!=__dormant),L.welcome_lbl.hide()}L.tablesort_tbl.setHeaderNoWrap(-1);s=0;i&&L.tablesort_tbl.setHeaderColWidth(s++,"5%"),L.tablesort_tbl.setHeaderColWidth(s++,"5%"),L.tablesort_tbl.setHeaderColWidth(s++,"70%"),L.tablesort_tbl.setHeaderColWidth(s++,"5%"),L.tablesort_tbl.setHeaderColWidth(s++,"5%"),L.tablesort_tbl.setHeaderColWidth(s++,"5%"),L.tablesort_tbl.setHeaderColWidth(s++,"5%"),L.tablesort_tbl.setHeaderColWidth(s++,"5%"),L.tablesort_tbl.setHeaderFontSize("100%"),L.onResize(window.innerWidth,window.innerHeight),L.tablesort_tbl.addSignalHandler("row_dblclick",function(e){R()})}function X(){serverRequest(fe_reqtype.getProjectList,0,"Project List",function(e){f=jQuery.extend(!0,new ProjectList(__login_id),e),p()},null,"persist")}function O(e){var t="Select project folder";if("select"!=e){if(U())return void new MessageBox("Cannot move a shared project","<h2>Cannot move a shared project</h2>The currently selected project cannot be moved into<br>another project folder because it is shared with other<br>user(s).","msg_stop");t="Move project to folder"}var o=u();new FoldersBrowser(t,f,__current_folder,o,e,function(e,t){switch(e){case"delete":t.folder_type==folder_type.custom_list&&f.removeProjectLabels(__login_id,t.folder_name);case"select":f.setCurrentFolder(f.findFolder(t.folder_path))||new MessageBox("Error",'<h2>Error</h2>Selected folder:<p><i>"'+t.folder_path+'</i>"<p>not found (1).',"msg_error"),j(function(e){p()},null);break;case"add":j(function(e){},null);break;case"move":o&&(f.setCurrentFolder(f.findFolder(t.folder_path))?(f.currentFolder.type==folder_type.custom_list?addProjectLabel(__login_id,o,t.folder_path):o.folderPath=t.folder_path,f.resetFolders(__login_id),j(function(e){p()},null)):new MessageBox("Error",'<h2>Error</h2>Selected folder:<p><i>"'+t.folder_path+'</i>"<p>not found (2).',"msg_error"));break;case"rename":var i;t.folder_path==__current_folder.path&&(G(i=f.findFolder(t.rename_path)),f.setCurrentFolder(i)||new MessageBox("Error",'<h2>Error</h2>Selected folder:<p><i>"'+t.rename+'</i>"<p>not found (2).',"msg_error"),__current_folder=f.currentFolder),q()?f.renameProjectLabels(__login_id,t.folder_name,t.rename_name):f.renameProjectPaths(__login_id,t.folder_path,t.rename_path),j(function(e){p()},null);break;case"cancel":f.resetFolders(__login_id);break;default:new MessageBox("Unknown action key","<h2>Unknown action key</h2>This is likely to be a program error. Please report code PPL-BF-001 to developers.","msg_error")}})}}function makeProjectListPage(e){makePage(new ProjectListPage(e)),setHistoryState("ProjectListPage")}function ProjectPage(i){if(BasePage.call(this,i,"-full","ProjectPage"),__login_token){var e=this.dock=null,o=(this.jobTree=null,this.can_reload=!1,this.pending_act="",this.tree_div=null,this.add_btn=null,this.add_rem_btn=null,this.thlight_btn=null,this.moveup_btn=null,this.del_btn=null,this.stack_btn=null,this.open_btn=null,this.stop_btn=null,this.clone_btn=null,this.refresh_btn=null,this.help_btn=null,this.roadmap_btn=null,this.selmode_btn=null,this),t=(this.makeHeader0(3),o.logout_btn&&o.logout_btn.addOnClickListener(function(){o.jobTree.stopTaskLoop(),o.jobTree.saveProjectData([],[],!1,function(e,t){logout(o.element.id,0)})}),(e=this.headerPanel.setLabel("",0,2,1,1)).setFont("times","150%",!0,!0).setHorizontalAlignment("left"),this.headerPanel.setCellSize("99%","",0,2),this.headerPanel.setCellSize("0px","",0,12),this.headerPanel.setVerticalAlignment(0,2,"middle"),this.makeDock(),o.addMenuItem("Project folder","list",function(){o.jobTree&&o.jobTree.projectData?o.jobTree.saveProjectData([],[],!1,function(e,t){makeProjectListPage(i)}):makeProjectListPage(i)}),"My Account"),n=(__local_user&&(t="Settings"),o.addMenuItem(t,"settings",function(){o.jobTree&&o.jobTree.projectData?o.jobTree.saveProjectData([],[],!1,function(e,t){makeAccountPage(i)}):makeAccountPage(i)}),__local_user||__user_role==role_code.admin&&o.addMenuItem("Admin Page",role_code.admin,function(){o.jobTree&&o.jobTree.projectData?o.jobTree.saveProjectData([],[],!1,function(e,t){makeAdminPage(i)}):makeAdminPage(i)}),o.addMenuSeparator(),o.addMenuItem("Project settings","project_settings",function(){o.jobTree&&o.jobTree.projectData?new ProjectSettingsDialog(o.jobTree,function(){o.jobTree.saveProjectData([],[],!0,null)}):new MessageBox("No Project","No Project loaded","msg_warning")}),o.addMenuItem("Share Project","share",function(){o.share_project()}),o.addLogoutToMenu(function(){o.jobTree&&o.jobTree.projectData?o.jobTree.saveProjectData([],[],!1,function(e,t){logout(i,0)}):logout(i,0)}),this.toolbar_div=new Widget("div"),this.toolbar_div.element.setAttribute("class","toolbox-content"),new Grid("")),t=(this.toolbar_div.addWidget(n),this.grid.setWidget(this.toolbar_div,1,0,1,1),this.panel=this.grid.setGrid("",1,1,1,1),this.grid.setCellSize("40px","",1,0,1,1),this.grid.setVerticalAlignment(1,1,"top"),this.grid.setCellSize("","100%",1,1,1,1),this.grid.setCellSize("40px","",1,2,1,1),0);this.add_btn=n.setButton("",image_path("add"),t++,0,1,1),this.moveup_btn=n.setButton("",image_path("moveup"),t++,0,1,1),this.clone_btn=n.setButton("",image_path("clonejob"),t++,0,1,1),this.del_btn=n.setButton("",image_path("remove"),t++,0,1,1),this.stack_btn=n.setButton("",image_path("job_stack"),t++,0,1,1),n.setLabel('<hr style="border:1px dotted;"/>',t++,0,1,1),this.add_rem_btn=n.setButton("",image_path("task_remark"),t++,0,1,1),this.thlight_btn=n.setButton("",image_path("highlight_branch"),t++,0,1,1),this.selmode_btn=n.setButton("",image_path("selmode_single"),t++,0,1,1),this.selmode_btn.multiple=!1,n.setLabel('<hr style="border:1px dotted;"/>',t++,0,1,1),this.open_btn=n.setButton("",image_path("openjob"),t++,0,1,1),this.stop_btn=n.setButton("",image_path("stopjob"),t++,0,1,1),n.setLabel('<hr style="border:1px dotted;"/>',t++,0,1,1),this.refresh_btn=n.setButton("",image_path("refresh"),t++,0,1,1),this.help_btn=n.setButton("",image_path("help"),t++,0,1,1),this.roadmap_btn=n.setButton("",image_path("roadmap"),+t,0,1,1),this.add_btn.setSize("40px","40px").setTooltip("Add job").setDisabled(!0),this.dock.setDisabled(!0),this.moveup_btn&&this.moveup_btn.setSize("40px","40px").setTooltip("Move job one position up the tree branch").setDisabled(!0),this.del_btn.setSize("40px","40px").setTooltip("Delete job").setDisabled(!0),this.stack_btn.setSize("40px","40px").setTooltip("Stack/Unstack jobs").setDisabled(!0),this.open_btn.setSize("40px","40px").setTooltip("Open job").setDisabled(!0),this.stop_btn.setSize("40px","40px").setTooltip("Stop job").setDisabled(!0),this.clone_btn.setSize("40px","40px").setTooltip("Clone job").setDisabled(!0),this.add_rem_btn.setSize("40px","40px").setTooltip("Add remark").setDisabled(!0),this.thlight_btn.setSize("40px","40px").setTooltip("Toggle branch highlight").setDisabled(!0),this.selmode_btn.setSize("40px","40px").setTooltip("Single/multiple selection mode").setDisabled(!0),this.refresh_btn.setSize("40px","40px").setTooltip("Refresh and push stalled jobs"),this.help_btn.setSize("40px","40px").setTooltip("Documentation"),this.roadmap_btn.setSize("40px","40px").setTooltip(appName()+" roadmap");for(var s=0;s<16;s++)n.setCellSize("","12px",s,0);this.help_btn.addOnClickListener(function(){new HelpBox("",__user_guide_base_url+"jscofe_project.html",null)}),this.roadmap_btn.addOnClickListener(function(){window.open("html/roadmap.html")}),o.selmode_btn.addOnClickListener(function(){o.setSelMode(0)}),o.refresh_btn.addOnClickListener(function(){o.setDisabled(!0),o.can_reload=!0,o.pending_act="",o.wakeZombieJobs(function(){o.reloadTree(!0,!0,null)})}),this.setJobTree(this.makeJobTree()),this.makeLogoPanel(2,0,3),o.jobTree.readProjectData("Project",!0,-1,function(){o.onTreeLoaded(!1,o.jobTree)&&(o.add_btn.addOnClickListener(function(){o.addJob()}),o.moveup_btn&&o.moveup_btn.addOnClickListener(function(){o.moveJobUp()}),o.del_btn.addOnClickListener(function(){o.deleteJob()}),o.stack_btn.addOnClickListener(function(){o.stackJobs()}),o.open_btn.addOnClickListener(function(){o.openJob()}),o.stop_btn.addOnClickListener(function(){o.stopJob()}),o.clone_btn.addOnClickListener(function(){o.cloneJob()}),o.add_rem_btn.addOnClickListener(function(){o.addRemark()}),o.thlight_btn.addOnClickListener(function(){o.toggleBranchHighlight()}),e.setText(o.jobTree.projectData.desc.title),o.can_reload=!0,o.pending_act="",o.jobTree.hasRunningJobs(0)&&o.wakeZombieJobs(null))},function(e){return o.onTreeContextMenu()},function(){o.openJob()},function(){o.onTreeItemSelect()})}else alert(" NOT LOGGED IN")}function rvapi_cloneJob(e){__current_page?"ProjectPage"!=__current_page._type?new MessageBox("Wrong page type","Wrong Project Page type encountered. This is a bug, please contact "+appName()+" developer.","msg_error"):__current_page.cloneJobWithSuggestedParameters(e):new MessageBox("Page not found","Project Page not found. This is a bug, please contact "+appName()+" developer.","msg_error")}function makeProjectPage(e){makePage(new ProjectPage(e)),setHistoryState("ProjectPage")}function RegisterPage(e){BasePage.call(this,e,"-full","RegisterPage"),this.grid.setCellSize("45%","",0,0,1,1),this.grid.setVerticalAlignment(0,1,"middle"),this.grid.setCellSize("10%","",0,1,1,1),this.grid.setCellSize("45%","",0,2,1,1),this.makeLogoPanel(1,0,3);var t=new Grid(""),i=(t.setWidth("300pt"),this.grid.setWidget(t,0,1,1,1),new Label("Registration")),o=new Label("User name:").setNoWrap(),n=new Label("E-mail:").setNoWrap(),s=new Label("Login name:").setNoWrap(),a=new Label("Licence agreement:&nbsp;&nbsp;&nbsp;").setNoWrap(),r=new Label("Feedback agreement:&nbsp;&nbsp;&nbsp;").setNoWrap(),l=new InputText(""),c=new InputText(""),d=new InputText(""),h=(l.setStyle("text","^[A-Za-z\\-\\.\\s]+$","John Smith","User name should only contain latin letters,\n dots, dashes and spaces"),c.setStyle("email","","john.smith@university.ac.uk","Should be a valid e-mail address, at which your\n temporary password will be sent"),d.setStyle("text","^[A-Za-z][A-Za-z0-9\\-\\._-]+$","john.smith","Login name should contain only latin letters, numbers,\n undescores, dashes and dots, and must start with a letter"),i.setFont("times","300%",!0,!0),o.setFontSize("125%"),n.setFontSize("125%"),s.setFontSize("125%"),a.setFontSize("125%"),r.setFontSize("125%"),l.setFontSize("112%").setFontItalic(!0).setWidth("97%"),c.setFontSize("112%").setFontItalic(!0).setWidth("97%"),d.setFontSize("112%").setFontItalic(!0).setWidth("97%"),0);t.setWidget(i,h,0,1,4),t.setHorizontalAlignment(h++,0,"center"),t.setWidget(this.makeSetupNamePanel(),h++,0,1,4),t.setCellSize("","20pt",h++,0),t.setWidget(o,h,0,1,1),t.setWidget(n,h+1,0,1,1),t.setWidget(s,h+2,0,1,1);for(var u=0;u<3;u++)t.setCellSize("96pt","",h+u,0);t.setWidget(a,h+3,0,1,2),t.setWidget(r,h+4,0,1,2),t.setWidget(l,h,1,1,3),t.setWidget(c,h+1,1,1,3),t.setWidget(d,h+2,1,1,3);for(u=0;u<5;u++)t.setVerticalAlignment(h+u,0,"middle"),t.setVerticalAlignment(h+u,1,"middle");h+=3;var p=new Button("choose",image_path("licence")),m=(p.setWidth("100%"),p.setTooltip("Type of licence must be chosen"),t.setWidget(p,h,1,1,2),t.setVerticalAlignment(h,1,"middle"),h++,new Button("choose",image_path("feedback"))),i=(m.setWidth("100%"),m.setTooltip("Terms of feedback agremment must be chosen"),t.setWidget(m,h,1,1,2),t.setVerticalAlignment(h,1,"middle"),h++,t.setCellSize("","12pt",h++,0),t.setWidget(new HLine("3pt"),h++,0,1,4),t.setCellSize("","1pt",h++,0),new Button("Register and send password by e-mail",image_path("email"))),o=null;""==__login_token?(o=new Button("Back to User Login",image_path("login"))).addOnClickListener(function(){makeLoginPage(e)}):(o=new Button("Back to Admin Page",image_path("admin"))).addOnClickListener(function(){makeAdminPage(e)}),i.setWidth("100%"),o.setWidth("100%"),t.setWidget(i,h++,0,1,4),t.setWidget(o,h++,0,1,4),p.addOnClickListener(function(){new LicenceDialog(p.getText(),function(e){p.setButton(e,image_path("licence"))})}),m.addOnClickListener(function(){new FeedbackDialog(m.getText(),function(e){m.setButton(e,image_path("feedback"))})}),i.addOnClickListener(function(){var t,e=validateUserData(l,c,d);[licence_code.academic,licence_code.commercial].indexOf(p.getText())<0&&(e+="<p><b>Licence</b> must be chosen"),[feedback_code.agree1,feedback_code.agree2,feedback_code.decline].indexOf(m.getText())<0&&(e+="<p><b>Feedback agreement</b> must be chosen"),d.getValue()==folder_type.tutorials&&(e+="<p>Login name <b>"+folder_type.tutorials+"</b> is reserved and cannot be used"),e?new MessageBox("Registration","Registration of new user cannot be done due to the following:"+e+".<p>Please make the necessary corrections and try again.","msg_information"):((t=new UserData).name=l.getValue(),t.email=c.getValue(),t.login=d.getValue(),t.licence=p.getText(),t.feedback=m.getText(),t.pwd="",serverCommand(fe_command.register,t,"Registration",function(e){switch(e.status){case fe_retcode.ok:return e.data?new MessageBoxW("Registration",e.data,.5):new MessageBox("Registration","Dear "+t.name+",<p>You are now registered for "+appName()+" with login name<p><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>"+t.login+"</i></b>.<p>Your temporary password was sent to e-mail address<p><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>"+t.email+'</i></b>.<p>Please check your e-mail and return to the login page.<p><b><i>If the confirmation e-mail does not arrive:</i></b><ol><li>Check your Spam folder</li><li><b>Do not register again!</i> Instead, use the <i>"Forgotten password"</i> option</li><li>Write to CCP4 if recovering your account is not successful after several attempts.</li></ol>',"msg_information"),!0;case fe_retcode.existingLogin:return new MessageBox("Registration",'<b>Login name <i>"'+t.login+'"</i> is already used.</b><p>If this is your name: Go back to Login Page and use button <i>Forgotten password</i><p>If you try to register a new user: Please choose a different login name.',"msg_excl"),!0;case fe_retcode.regFailed:return new MessageBox("Registration Failed",e.message,"msg_error"),!0}return!1},null,null))}),setDefaultButton(i,t)}function makeRegisterPage(e){makePage(new RegisterPage(e)),setHistoryState("RegisterPage")}function startSession(t,i){setClientCode(client_code.ccp4),_jsrview_uri="js-lib/jsrview/";var e=window.location.search;if(e){var o=decodeURI(e).split("?").pop().split("&");__url_parameters={};for(var n,s=0;s<o.length;s++){var a=o[s].split("=");__url_parameters[a[0]]=a[1]}(window.location.href.indexOf("localhost")<0||window.location.href.indexOf("127.0.0.1")<0)&&(e="/",0<(n=window.location.pathname.slice(1).split("/")).length&&n[0]&&(e="/"+n[0]+"/"),window.history.replaceState({},document.title,e))}checkLocalService(function(e){e||(__local_user?(__offline_message="on",login("**"+__local_user_id+"**","",t,0)):0==i?makeLoginPage(t):10==i?(__login_token="a6ed8a1570e6c2bc8211997f9f1672528711e286",__login_user="Admin",__doNotShowList=["*"],loadKnowledge("Login"),makeAdminPage(t),makeSessionCheck(t)):(__doNotShowList=["*"],__cloud_storage=!0,__login_user=(__login_token=__login_token?"devel":"340cef239bd34b777f3ece094ffb1ec5","Developer"),login("devel","devel",t,i)),setHistoryListener(t))})}AccountPage.prototype=Object.create(BasePage.prototype),AccountPage.prototype.constructor=AccountPage,AdminPage.prototype=Object.create(BasePage.prototype),AdminPage.prototype.constructor=AdminPage,AdminPage.prototype.loadUsageStats=function(){this.usageStats._loaded||3!=this.tabs.getActiveTabNo()||(this.usageStats.loadPage(this.usageStats._url),this.usageStats._loaded=!0)},AdminPage.prototype.refresh=function(){var r;this.loadAnalytics(),r=this,serverRequest(fe_reqtype.getAdminData,0,"Admin Page",function(t){if(t.served){r.jobsTitle.setText("<h2>Jobs Log</h2>");for(var e=t.jobsStat.split(/\r\n|\r|\n/),i=(0<e.length&&startsWith(e[0],"--------")&&(e[0]=e[0].replace(/-/g,"="),e[2]=e[2].replace(/-/g,"="),e[e.length-1]||e.pop(),e.push(e.shift()),e.push(e.shift()),e.push(e.shift())),0),o=[],n="["+(n=new Date(Date.now()).toUTCString().split(" "))[0]+" "+n[1]+" "+n[2]+" "+n[3],s=e.length-1;0<=s;s--)if("0"<=e[s][0]&&e[s][0]<="9"){if(!(0<=e[s].indexOf(n)))break;i++;var a=e[s].split(" (")[0].split(" ").pop();o.indexOf(a)<0&&o.push(a)}r.jobStats.setText("<pre>Jobs today: total "+i+" from "+o.length+" users\n"+e.reverse().join("\n")+"</pre>"),r.usageStats._url=t.usageReportURL,r.usageStats._loaded=!1,r.loadUsageStats(),r.makeUsersInfoTab(t.usersInfo,t.nodesInfo.FEconfig),serverCommand(fe_command.getFEProxyInfo,{},"FE Proxy Info Request",function(e){return e&&(e.status==nc_retcode.ok?t.nodesInfo.FEProxy=e.data:new MessageBox("Get FE Proxy Info Error","Unknown error: <b>"+e.status+"</b><p>when trying to fetch FE Proxy data.","msg_error")),__local_service?localCommand(nc_command.getNCInfo,{},"NC Info Request",function(e){return e&&(e.status==nc_retcode.ok?t.nodesInfo.ncInfo.push(e.data):new MessageBox("Get NC Info Error","Unknown error: <b>"+e.status+"</b><p>when trying to fetch Client NC data.","msg_error")),r.makeNodesInfoTab(t.nodesInfo),r.onResize(window.innerWidth,window.innerHeight),null!=e}):(r.makeNodesInfoTab(t.nodesInfo),r.onResize(window.innerWidth,window.innerHeight)),null!=e})}else r.jobsTitle.setText(t.jobsStat),r.usersTitle.setText(t.jobsStat),r.nodesTitle.setText(t.jobsStat)},null,"persist")},AdminPage.prototype.onResize=function(e,t){this.tabs.setWidth_px(e-50),this.tabs.setHeight_px(t-116),this.usageStats.setFramePosition("0px","50px","100%",t-160+"px"),this.tabs.refresh();e=t-190+"px";$(this.anlTab.element).css({height:e,"overflow-y":"scroll"}),$(this.usersTab.element).css({height:e,"overflow-y":"scroll"}),$(this.nodesTab.element).css({height:e,"overflow-y":"scroll"}),$(this.usageTab.element).css({height:e,"overflow-y":"scroll"}),$(this.jobsTab.element).css({height:e,"overflow-y":"scroll"})},AdminPage.prototype.make_analytics_table=function(e,t,i,o,n,s,a,r,l,c){if(this.anlTab.grid.setLabel(o,e++,t,1,1).setNoWrap(),n<=0)this.anlTab.grid.setLabel(s,e++,t,i,1);else{var d=new Table;$(d.element).css({width:"auto"}),this.anlTab.grid.setWidget(d,e++,t,i,1),d.setHeaderRow(a,r);for(var h=0;h<n;h++)l(d,h);d.setAllColumnCSS({"vertical-align":"middle","text-align":c,"white-space":"nowrap"},1,1)}return e},AdminPage.prototype.loadAnalytics=function(){var t;this.anlTab.grid.setLabel("Site Monitor",0,0,1,1).setHeight_px(32).setFontSize("1.5em").setFontBold(!0),t=this,serverRequest(fe_reqtype.getAnalytics,0,"Admin Page",function(s){var e=t.make_analytics_table(1,0,1,"<h3><i>Now on site</i></h3>",s.users_current.length,"<i>Nobody</i>",["##","Login","Country","Domain"],["Ordinal number","User login name","Country by registration","Internet domain"],function(e,t){e.setRow(""+(t+1),"",[s.users_current[t].login,s.users_current[t].country,s.users_current[t].domain],t+1,1==(1&t))},"left");e=t.make_analytics_table(e,0,1,"&nbsp;<br><h3><i>Recent users geography</i></h3>",s.geography_recent.length,"<i>No users were present recently</i>",["##","Country","Users","Domains"],["Ordinal number","Country by registration","Total number of recent users","Internet domains"],function(e,t){for(var i=[],o=0;o<s.geography_recent[t].domains.length;o++)i.push(s.geography_recent[t].domains[o].domain+" ("+s.geography_recent[t].domains[o].count+")");e.setRow(""+(t+1),"",[s.geography_recent[t].country,s.geography_recent[t].ucount,i.join("<br>")],t+1,1==(1&t))},"left"),e=t.make_analytics_table(e,0,1,"&nbsp;<br><h3><i>Page views</i></h3>",s.doc_stats.length,"<i>No views detected</i>",["##","Page","Views"],["Ordinal number","Page file name","Total number of views"],function(e,t){e.setRow(""+(t+1),"",["<a href=\"javascript:launchHelpBox('Documentation','"+s.doc_stats[t].name.replaceAll("\\","/")+"',null,10)\">"+s.doc_stats[t].name.replace(/^.*[\\\/]/,"")+"</a>",s.doc_stats[t].count+" ("+round(s.doc_stats[t].percent,1)+"%)"],t+1,1==(1&t))},"left"),t.anlTab.grid.setLabel("&nbsp;",1,1,1,1).setWidth_px(40).setNoWrap(),t.make_analytics_table(1,2,e,"<h3><i>Unique users by week</i></h3>",s.users_per_week.length,"<i>No data collected yet</i>",["Week","Users"],["Week number from today","Number of unique users detected last time"],function(e,t){var i=s.users_per_week.length-t;if(e.setRow(i.toString(),"",[s.users_per_week[t]],t+1,1==(1&t)),1==i){for(var o=0,n=0;n<s.users_per_week.length;n++)o+=s.users_per_week[n];e.setRow("Total:","Total number of active unique users",[o],t+2,1!=(1&t))}},"right"),t.anlTab.grid.setLabel("&nbsp;",1,3,1,1).setWidth_px(40).setNoWrap(),t.make_analytics_table(1,4,e,"<h3><i>Year's geography</i></h3>",s.geography_year.length,"<i>No users were present yet</i>",["##","Country","Users","Domains"],["Ordinal number","Country by registration","Total number of recent users","Internet domains"],function(e,t){for(var i=[],o=0;o<s.geography_year[t].domains.length;o++)i.push(s.geography_year[t].domains[o].domain+" ("+s.geography_year[t].domains[o].count+")");e.setRow(""+(t+1),"",[s.geography_year[t].country,s.geography_year[t].ucount,i.join("<br>")],t+1,1==(1&t))},"left"),t.anlTab.grid.setCellSize("50%","",1,5)},null,"persist")},AdminPage.prototype.makeUsersInfoTab=function(e,t){this.usersTitle.setText("Users").setFontSize("1.5em").setFontBold(!0),this.userListTable=new TableSort,this.usersTab.grid.setWidget(this.userListTable,1,0,1,2),this.userListTable.setHeaders(["##","Name","Login","Online","Profile","Dormant<br>since","E-mail","Licence","N<sub>jobs</sub>","Space<br>(MB)","CPU<br>(hours)","Known<br>since","Last<br>seen"]);for(var i,o=(("loggedUsers"in e?e:e.loginHash).loggedUsers),n=0;n<e.userList.length;n++){var s,a=this.userListTable.addRow(),r=e.userList[n],l=(a.addCell(n+1).setNoWrap().setHorizontalAlignment("right"),a.addCell(r.name).setNoWrap(),a.addCell(r.login).setNoWrap(),"&nbsp;");for(s in o)if(o[s].login==r.login){l="&check;";break}a.addCell(l).setNoWrap().setHorizontalAlignment("center"),a.addCell(r.role).setNoWrap(),(r.dormant?a.addCell(new Date(r.dormant).toISOString().slice(0,10)):a.addCell("active")).setNoWrap(),a.addCell(r.email).setNoWrap(),a.addCell(r.licence).setNoWrap(),a.addCell(r.ration.jobs_total).setNoWrap().setHorizontalAlignment("right"),a.addCell(round(r.ration.storage_used,1)).setNoWrap().setHorizontalAlignment("right"),a.addCell(round(r.ration.cpu_total_used,2)).setNoWrap().setHorizontalAlignment("right"),a.addCell(new Date(r.knownSince).toISOString().slice(0,10)).setNoWrap().setHorizontalAlignment("right");var c="";"lastSeen"in r&&r.lastSeen&&(c=new Date(r.lastSeen).toISOString().slice(0,10)),a.addCell(c).setNoWrap().setHorizontalAlignment("right"),a.uDesc=r}(i=this).userListTable.addSignalHandler("row_dblclick",function(e){new ManageUserDialog(e.uDesc,t,function(){i.refresh()})}),this.userListTable.createTable(null),this.userListTable.setHeaderNoWrap(-1),this.userListTable.setHeaderColWidth(0,"3%"),this.userListTable.setHeaderColWidth(1,"auto"),this.userListTable.setHeaderColWidth(2,"4%"),this.userListTable.setHeaderColWidth(3,"3%"),this.userListTable.setHeaderColWidth(4,"3%"),this.userListTable.setHeaderColWidth(5,"4%"),this.userListTable.setHeaderColWidth(6,"auto"),this.userListTable.setHeaderColWidth(7,"4%"),this.userListTable.setHeaderColWidth(8,"3%"),this.userListTable.setHeaderColWidth(9,"3%"),this.userListTable.setHeaderColWidth(10,"3%"),this.userListTable.setHeaderColWidth(11,"4%"),this.userListTable.setHeaderColWidth(12,"4%"),this.userListTable.setHeaderFontSize("100%")},AdminPage.prototype.makeNodesInfoTab=function(e){function t(e){return'<font style="font-size:80%">'+e+"</font>"}this.nodesTitle.setText("Nodes").setFontSize("1.5em").setFontBold(!0),this.nodeListTable=new Table,this.nodesTab.grid.setWidget(this.nodeListTable,1,0,1,2),this.nodeListTable.setHeaderRow(["Node","Name","URL","Type","Time started","CCP4<br>version",appName()+" version","Fast<br>track","State","Jobs<br>done","Job<br>capacity","Jobs<br>running","Zombie<br>jobs"],["Server node","Node name","Node URL","Node type","Node start time","Version of CCP4 running on the node","Version of "+appName()+" running on the node","Yes if accepts fast track jobs","Current node state","Total number of jobs executed on the node","Estimated job capacity of the node","Current number of jobs running on the node","Current number of stalled or zombie jobs on the node"]);var i=1,o=__setup_desc?__setup_desc.name:__local_setup?"Home setup":"Unnamed setup",n="FEProxy"in e&&e.FEProxy.fe_config?e.FEProxy.fe_config.externalURL:document.location.protocol+"//"+document.location.host+document.location.pathname;e.FEconfig.externalURL!=n&&(n+="<br><i>["+e.FEconfig.externalURL+"]</i>");for(var s="unspecified",a=("jscofe_version"in e&&(s=e.jscofe_version),this.nodeListTable.setRow("Front End","Front End Server",[o,n,"FE",t(e.FEconfig.startDate),e.ccp4_version,s,"N/A","running","N/A","N/A","N/A","N/A"],i,1==(1&i)),i++,"FEProxy"in e&&e.FEProxy.proxy_config&&(s="jscofe_version"in e.FEProxy?e.FEProxy.jscofe_version:"unspecified",this.nodeListTable.setRow("FE Proxy","Front End Proxy Server",["Local proxy",e.FEProxy.proxy_config.externalURL,"FE-PROXY",t(e.FEProxy.proxy_config.startDate),e.FEProxy.ccp4_version,s,"N/A","running","N/A","N/A","N/A","N/A"],i,1==(1&i)),i++),1),r=0;r<e.ncInfo.length;r++){var l=e.ncInfo[r];if(l){var c="&check;",d=(l.config.fasttrack||(c="-"),0),h=0,u=0,p="running",m="N/A";if(l.config.in_use)if(l.jobRegister){for(var f in u=l.jobRegister.launch_count,l.jobRegister.job_map)l.jobRegister.job_map[f].endTime?h++:d++;m=t(l.config.startDate)}else p="dead";else p="not in use";var g="NC-"+l.config.exeType;l.config.jobManager!=l.config.exeType&&(g+="("+l.config.jobManager+")"),s="jscofe_version"in l?l.jscofe_version:"unspecified",this.nodeListTable.setRow("NC-"+a,"Number Cruncher #"+a,[l.config.name,l.config.externalURL,g,m,l.ccp4_version,s,c,p,u,l.config.capacity,d,h],i,1==(1&i)),i++,a++}}this.nodeListTable.setAllColumnCSS({"vertical-align":"middle","white-space":"nowrap"},1,1)},ForgottenLoginPage.prototype=Object.create(BasePage.prototype),ForgottenLoginPage.prototype.constructor=ForgottenLoginPage,LoginPage.prototype=Object.create(BasePage.prototype),LoginPage.prototype.constructor=LoginPage,LogoutPage.prototype=Object.create(BasePage.prototype),LogoutPage.prototype.constructor=LogoutPage,ProjectListPage.prototype=Object.create(BasePage.prototype),ProjectListPage.prototype.constructor=ProjectListPage,ProjectListPage.prototype.onResize=function(e,t){this.tablesort_tbl&&(this.tablesort_tbl.fixHeader(),this.welcome_lbl&&!this.welcome_lbl.isVisible()&&this.tablesort_tbl.setTableHeight(t-72))},ProjectListPage.prototype.reloadProjectList=function(){this.loadProjectList1()},ProjectListPage.prototype.loadProject=function(e){this._open_project(e)},ProjectPage.prototype=Object.create(BasePage.prototype),ProjectPage.prototype.constructor=ProjectPage,ProjectPage.prototype.destructor=function(e){this.jobTree&&(this.jobTree.stopTaskLoop(),this.jobTree.closeAllJobDialogs(),this.jobTree.delete()),BasePage.prototype.destructor.call(this,e)},ProjectPage.prototype.setJobTree=function(e){this.jobTree&&(this.jobTree.stopTaskLoop(),this.jobTree.delete()),this.tree_div&&this.tree_div.delete(),this.tree_div=new Widget("div"),this.tree_div.element.setAttribute("class","tree-content"),this.jobTree=e,this.tree_div.addWidget(this.jobTree),this.panel.setWidget(this.tree_div,0,0,1,1),this.onResize(window.innerWidth,window.innerHeight)},ProjectPage.prototype.setDisabled=function(e){this.add_btn&&(this.add_btn.setDisabled(e),this.add_rem_btn.setDisabled(e),this.thlight_btn.setDisabled(e),this.moveup_btn&&this.moveup_btn.setDisabled(e),this.del_btn.setDisabled(e),this.stack_btn.setDisabled(e),this.open_btn.setDisabled(e),this.stop_btn.setDisabled(e),this.clone_btn.setDisabled(e),this.selmode_btn.setDisabled(e))},ProjectPage.prototype.start_action=function(e){return this.can_reload?(this.can_reload=!1,this.pending_act="",this.jobTree.stopTaskLoop(),!0):(this.pending_act?this.pending_act!=e&&(new MessageBox("Communication delays","Communication delays, please wait a moment.<br>If this message persists, reload Project using<br><i>Refresh</i> button in the vertical toolbar.","msg_system"),console.log(" >>>> action requested: "+e+", pending: "+this.pending_act)):this.pending_act=e,!1)},ProjectPage.prototype.end_action=function(){this.jobTree.startTaskLoop(),this.can_reload=!0,this.pending_act=""},ProjectPage.prototype.addJob=function(){this.selectRemark();var t=this;this.start_action("add_job")&&t.jobTree.addJob(!1,!1,t,function(e){t._set_del_button_state(),t.end_action()})},ProjectPage.prototype.addJobRepeat=function(){this.selectRemark();var t=this;this.start_action("add_job_repeat")&&t.jobTree.addJob(!1,!0,t,function(e){t._set_del_button_state(),t.end_action()})},ProjectPage.prototype.insertJob=function(){this.selectRemark();var t=this;this.start_action("insert_job")&&t.jobTree.addJob(!0,!1,t,function(e){1!=e&&t._set_del_button_state(),t.end_action(),1==e&&t.reloadTree(!1,!0,null)})},ProjectPage.prototype.addRemark=function(){var t;this.start_action("add_remark")&&((t=this).can_reload=!0,t.jobTree.addTask(new TaskRemark,!0,!1,t,function(e){1!=e&&t._set_del_button_state(),t.end_action(),1==e&&t.reloadTree(!1,!0,null)}))},ProjectPage.prototype.cloneJob=function(){var e;this.start_action("clone_job")&&(e=this).jobTree.cloneJob("clone",e,function(){e._set_del_button_state(),e.end_action()})},ProjectPage.prototype.deleteJob=function(){var t;this.start_action("delete_job")&&(t=this).jobTree.deleteJob(!1,function(e){t.end_action(),t._set_button_state()})},ProjectPage.prototype.moveJobUp=function(){var e;this.start_action("move_job_up")&&(e=this).jobTree.moveJobUp(function(){e.end_action(),e._set_button_state()})},ProjectPage.prototype.toggleBranchHighlight=function(){this.jobTree.toggleBranchHighlight()},ProjectPage.prototype.stackJobs=function(){var t,e,i,o,n,s,a;this.start_action("stack_jobs")&&(t=this.jobTree.selectStackJobs(),e=!1,i=this,1==t[0]?t[1].length<=0?(this.jobTree.makeStack1(t[2],"",image_path("job_stack")),e=!0):t[2].length<=0?(this.jobTree.makeStack1(t[1],"",image_path("job_stack")),e=!0):(o=new Dialog("Stacking direction"),n=new Grid(""),o.addWidget(n),n.setLabel("<h2>Stacking direction</h2>You can choose to stack suitable jobs which are<br>(the selected job is included):<br>&nbsp;",0,0,1,3),s=n.setCheckbox("above the currently selected job",!1,1,1,1,1),a=n.setCheckbox("below the currently selected job",!0,2,1,1,1),n.setLabel("&nbsp;<br>Make your choice and click <b><i>Stack</i></b> button.",3,0,1,3),o._options.buttons={Stack:function(){var e=[];s.getValue()&&(e=t[1]),a.getValue()&&(e.shift(),e=e.concat(t[2])),e.length<=0?(new MessageBox("Empty selection","<h2>Empty selection</h2>At least one checkbox must be checked<br>for acrhiving.","msg_warning"),i.end_action()):($(this).dialog("close"),i.jobTree.makeStack1(e,"",image_path("job_stack")),i.jobTree.saveProjectData([],[],!0,function(e,t){i.setSelMode(1),i.end_action(),0<t.reload?new MessageBox("Project updating","<h3>Project updating</h3>Project update in progress, please repeat archiving operation later.","msg_system"):i.reloadTree(!1,!0,t)}))},Cancel:function(){$(this).dialog("close"),i.end_action()}},o.launch()):2==t[0]&&(this.jobTree.unfoldFolder(),e=!0),e&&i.jobTree.saveProjectData([],[],!0,function(e,t){i.setSelMode(1),i.end_action(),0<t.reload?new MessageBox("Project updating","<h3>Project updating</h3>Project update in progress, please repeat archiving operation later.","msg_system"):i.reloadTree(!1,!0,t)}))},ProjectPage.prototype.setButtonState=function(){this.start_action("set_button_state")&&(this._set_button_state(),this.end_action())},ProjectPage.prototype.openJob=function(){this.jobTree.openJob(null,this)},ProjectPage.prototype.stopJob=function(){this.jobTree.stopJob("",!1,null)},ProjectPage.prototype.setSelMode=function(e){(0==e||1==e&&this.jobTree.multiple||2==e&&!this.jobTree.multiple)&&(this.jobTree.multiple=!this.jobTree.multiple,this.setDisabled(!0),this.reloadTree(!1,!0,null))},ProjectPage.prototype.addToDock=function(){this.dock.addTaskClass(this.jobTree.getSelectedTask()),this.dock.show()},ProjectPage.prototype._set_del_button_state=function(){var e=!1,t=this.jobTree.getSelectedNode();t&&(e=null!=t.parentId)&&this.jobTree.projectData.desc.archive&&((t=this.jobTree.getSelectedTask())&&(e=!("archive_version"in t))),this.del_btn.setEnabled(e)},ProjectPage.prototype._set_button_state=function(){var e,t,i=!1,o=this.jobTree.getSelectedTask(),n=this.jobTree.getSelectedNode(),s=!this.jobTree.in_archive,a=this.jobTree.getChildTasks(n),r=!1;1==a.length&&(r=a[0].state==job_code.remark),n&&(i=null!=n.parentId),this.open_btn.setEnabled(i),this.stack_btn.setEnabled(0<this.jobTree.selectStackJobs()[0]),o?((e=a=o.isRemark())&&(t=this.jobTree.getNonRemarkParent(o))&&(e=t.state==job_code.finished),t=!__dormant&&s&&(o.state==job_code.finished||a&&e),this.add_btn.setEnabled(t),this.del_btn.setEnabled(!__dormant&&i&&!("archive_version"in o)),this.dock.setEnabled(t),this.clone_btn.setEnabled(!__dormant&&i&&o.canClone(n,this.jobTree)),this.moveup_btn&&this.moveup_btn.setEnabled(!__dormant&&o.canMove(n,this.jobTree)),this.stop_btn.setEnabled(i&&(o.state==job_code.running||o.state==job_code.ending)),this.add_rem_btn.setEnabled(!__dormant&&!r&&!a&&s),a?this.del_btn.setTooltip("Delete remark"):this.del_btn.setTooltip("Delete job")):(this.add_btn.setEnabled(!__dormant&&s),this.del_btn.setEnabled(!__dormant&&s&&i),this.dock.setEnabled(!__dormant&&s),this.clone_btn.setEnabled(!1),this.moveup_btn&&this.moveup_btn.setEnabled(!1),this.stop_btn.setEnabled(!1),this.add_rem_btn.setEnabled(!__dormant&&!r&&s)),this.thlight_btn.setEnabled(!0)},ProjectPage.prototype.share_project=function(){var t;this.jobTree?shareProject((t=this).jobTree.projectData.desc,function(e){e&&(t.jobTree.projectData.desc=e,t.jobTree.saveProjectData([],[],!0,function(e,t){e.isShared()&&e.startTaskLoop()}))}):new MessageBox("No Project","No Project loaded","msg_warning")},ProjectPage.prototype.onTreeContextMenu=function(){var e={},t=this.jobTree.getSelectedNode(),i=(__close_all_menus(),this),o=i.jobTree.task_map[t.id],n=($(i.add_btn.element).button("option","disabled")||(e.addJobItem={label:"Add new job",icon:image_path("add"),action:function(){i.addJob()}},t.parentId&&(e.addJobRepeatItem={label:"Add job with last used parameters",icon:image_path("add_repeat"),action:function(){i.addJobRepeat()}})),i.moveup_btn&&!$(i.moveup_btn.element).button("option","disabled")&&(e.moveJobUpItem={label:"Move job up the tree",icon:image_path("moveup"),action:function(){i.moveJobUp()}}),$(i.clone_btn.element).button("option","disabled")||(e.cloneJobItem={label:"Clone job",icon:image_path("clonejob"),action:function(){i.cloneJob()}}),$(i.del_btn.element).button("option","disabled")||(e.delJobItem={label:"Delete job with descendants",icon:image_path("remove"),action:function(){i.deleteJob()}},o&&o.state==job_code.remark&&(e.delJobItem.label="Delete remark")),$(i.open_btn.element).button("option","disabled")||(o&&o.state==job_code.remark&&o.isWebLink()?(e.openJobItem={label:"Open link",icon:image_path("openjob"),action:function(){i.openJob()}},__user_role!=role_code.developer&&__user_role!=role_code.admin&&o.isDocLink()||(e.editLinkItem={label:"Edit link",icon:image_path("editlink"),action:function(){o.doclink_type="*"+o.doclink_type,i.openJob()}})):e.openJobItem={label:"Open job dialog",icon:image_path("openjob"),action:function(){i.openJob()}}),$(i.stop_btn.element).button("option","disabled")||(e.stopJobItem={label:"Stop job running",icon:image_path("stopjob"),action:function(){i.stopJob()}}),$(i.add_rem_btn.element).button("option","disabled")||(e.addRemarkItem={label:"Add remark",icon:image_path("task_remark"),action:function(){i.addRemark()}}),e.addHighlightBranchItem={label:"Toggle branch highlighting",icon:image_path("highlight_branch"),action:function(){i.toggleBranchHighlight()}},i.jobTree.selectStackJobs());return 1==n[0]?e.addStackItem={label:"Stack jobs",icon:image_path("job_stack"),action:function(){i.stackJobs()}}:2==n[0]&&(e.addUnstackItem={label:"Unstack jobs",icon:image_path("job_stack"),action:function(){i.stackJobs()}}),t.parentId&&!i.jobTree.in_archive&&(o=i.jobTree.task_map[t.id])&&o.state!=job_code.remark&&(e.addToDockItem={label:"Add task to dock",icon:image_path("dock_small"),action:function(){i.addToDock()}}),e},ProjectPage.prototype.onTreeLoaded=function(e,t){if(this.refresh_btn.setDisabled(!1),this.selmode_btn.setDisabled(t.in_archive),!t||!t.projectData)return e?new MessageBox("Connection problems",'<div style="width:400px;"><h2>Intermittent Connection Problems</h2>Try to reload the Project by pushing refresh button in the toolbar. If problem persists, check your Internet connection.',"msg_system"):makeProjectListPage(sceneId),!1;t.multiple?this.selmode_btn.setIcon(image_path("selmode_multi")):this.selmode_btn.setIcon(image_path("selmode_single")),this.selmode_btn.multiple=t.multiple,this._set_button_state(),__current_project=t.projectData.desc.name;var i=this;if(t.addSignalHandler(cofe_signals.jobDialogOpened,function(e){i.setSelMode(1)}),t.addSignalHandler(cofe_signals.jobStarted,function(e){i.setButtonState()}),t.addSignalHandler(cofe_signals.treeUpdated,function(e){i.updateUserRationDisplay(t.projectData.desc),i.setButtonState()}),t.addSignalHandler(cofe_signals.reloadTree,function(e){"force_reload"in e&&(i.can_reload=!0),i.reloadTree(!1,!1,e)}),t.addSignalHandler(cofe_signals.makeProjectList,function(e){makeProjectListPage(sceneId)}),1==t.root_nodes.length&&t.root_nodes[0].children.length<=0)switch(i.can_reload=!0,t.projectData.desc.startmode){case start_mode.auto:i.addJob();break;case start_mode.migrate:i.start_action("add_job")&&(i.can_reload=!0,i.jobTree.addTask(new TaskMigrate,!1,!1,i,function(e){i._set_del_button_state(),i.end_action()}));break;case start_mode.standard:case start_mode.expert:default:i.addJob()}return this.updateUserRationDisplay(t.projectData.desc),!0},ProjectPage.prototype.onTreeItemSelect=function(){this.setButtonState()},ProjectPage.prototype.reloadTree=function(o,e,n){var s,a,t,i,r,l;this.jobTree&&this.jobTree.parent&&this.can_reload&&(this.can_reload=!1,this.jobTree.stopTaskLoop(),this.jobTree.checkTimeout=-1,s=this.jobTree.getJobDialogTaskParameters(),a=this.jobTree.parent.getScrollPosition(),t=this.makeJobTree(),i=this.jobTree.projectData.desc.timestamp,o?(this.jobTree.closeAllJobDialogs(),this.jobTree.hide(),i=-1):(t.hide(),e&&(i=-1)),r=this,(l=t).multiple=r.jobTree.multiple,l.readProjectData("Project",!1,i,function(){if(l.projectData)if(l.multiple=r.jobTree.multiple,r.onTreeLoaded(!0,l)){var e=r.jobTree.getSelectedTasks(),t=r.jobTree.dlg_map;if(r.jobTree.delete(),r.setJobTree(l),r.jobTree.selectTasks(e),r.jobTree.show(),r.jobTree.parent.setScrollPosition(a),o?r.jobTree.openJobs(s,r):r.jobTree.relinkJobDialogs(t,r),n&&(r.updateUserRationDisplay(n),"completed_map"in n))for(var i in n.completed_map)r.jobTree.startChainTask(n.completed_map[i],null),update_project_metrics(n.completed_map[i],r.jobTree.projectData.desc.metrics)}else l.delete(),r.jobTree.show(),r.jobTree.openJobs(s,r);else l.delete(),r.jobTree.show(),r.jobTree.openJobs(s,r);switch(r.jobTree.checkTimeout=null,r.can_reload=!0,r.pending_act){case"add_job":r.addJob();break;case"add_job_repeat":r.addJobRepeat();break;case"insert_job":r.insertJob();break;case"add_remark":r.addRemark();break;case"clone_job":r.cloneJob();break;case"delete_job":r.deleteJob();break;case"move_job_up":r.moveJobUp();break;case"stack_jobs":r.stackJobs();break;default:r.jobTree.startTaskLoop()}r._set_button_state()},function(e){return r.onTreeContextMenu()},function(){r.openJob()},function(){r.onTreeItemSelect()}))},ProjectPage.prototype.wakeZombieJobs=function(i){var e;this.jobTree.projectData?((e={}).project=this.jobTree.projectData.desc.name,serverRequest(fe_reqtype.wakeZombieJobs,e,"Project Page",function(e){},function(e,t){__local_service?localCommand(nc_command.wakeZombieJobs,{job_tokens:["*"]},"Wake Zombi Jobs",function(e){return i&&i(),!0}):i&&i()},function(){})):i&&i()},ProjectPage.prototype.makeJobTree=function(){var e=new JobTree,t=(e.element.style.paddingTop="0px",e.element.style.paddingBottom="25px",e.element.style.paddingRight="40px",this);return e.addSignalHandler(cofe_signals.rationUpdated,function(e){t.updateUserRationDisplay(e)}),e},ProjectPage.prototype.selectRemark=function(){var e,t=this.jobTree.getSelectedNode(),t=this.jobTree.getChildNodes(t);1==t.length&&(e=this.jobTree.getTaskByNodeId(t[0].id))&&e.state==job_code.remark&&(this.jobTree.calcSelectedNodeIds().length<=1?this.jobTree.selectSingle(t[0]):this.jobTree.selectMultiple(t[0]))},ProjectPage.prototype.makeDock=function(){var dock_btn=this.toolPanel.setImageButton(image_path("dock"),"20px","20px",0,0,1,1).setTooltip1("Toggle task dock","show",!0,1e3).setFontSize("90%").setVerticalAlignment("middle"),self=this;self.dock=new Dock(self,function(taskType,title,icon_uri){var task,rc;$(self.add_btn.element).button("option","disabled")||(task=eval("new "+taskType+"()"),task.state==job_code.retired?new MessageBox("Task retired",'<div style="min-width:400px"><h2>Task retired</h2>Task<p><div style="text-align:center"><img style="vertical-align:middle" src="'+icon_uri+'" width="26" height="24"><span style="vertical-align:middle">&nbsp;&nbsp;<b>'+title+"</b></span></div><p>has been retired and cannot be added to the Project. You may remove this task from the dock.</div>","msg_warning"):(self.selectRemark(),self.start_action("add_job")&&(self.can_reload=!0,rc=self.jobTree.addTask(task,!1,!1,self,function(e){self._set_del_button_state(),self.end_action();var t=rc[0],i=rc[1];i.status<=0&&new TaskDataDialog(i,task,t)}))))},function(e,t,i){return new QuestionBox("Remove dock item",'<div style="min-width:400px"><h2>Remove dock item</h2>Remove<p><div style="text-align:center"><img style="vertical-align:middle" src="'+i+'" width="26" height="24"><span style="vertical-align:middle">&nbsp;&nbsp;<b>'+t+"</b></span></div><p>from the dock?</div>",[{name:"Yes, remove",onclick:function(){self.dock.removeTask(e)}},{name:"Cancel",onclick:function(){}}],"msg_confirm"),0},function(){return null}),dock_btn.addOnClickListener(function(){self.dock.toggle()})},ProjectPage.prototype.onResize=function(e,t){t=t-108+"px",e=e-110+"px";this.toolbar_div.element.style.height=t,this.tree_div.element.style.height=t,this.tree_div.element.style.width=e},ProjectPage.prototype.getJobTree=function(){return this.jobTree},ProjectPage.prototype.getProjectName=function(){return this.jobTree&&this.jobTree.projectData?this.jobTree.projectData.desc.name:""},ProjectPage.prototype.reloadProject=function(){this.refresh_btn.click()},ProjectPage.prototype.cloneJobWithSuggestedParameters=function(e){var t=this;t.jobTree.cloneJob("copy_suggested",t,function(){t._set_del_button_state(),e in t.jobTree.dlg_map&&t.jobTree.dlg_map[e].close()})},RegisterPage.prototype=Object.create(BasePage.prototype),RegisterPage.prototype.constructor=RegisterPage;var __announcement_made=!1;function checkAnnouncement(){__announcement_made||serverCommand(fe_command.checkAnnouncement,{},"Announcement",function(e){return e.data.message&&(startsWith(e.data.message,"!#")&&(e.data.message=e.data.message.split("\n").slice(1).join("\n")),e.data.message&&new MessageBox("Announcement",'<div style="width:500px;">'+e.data.message+"</div>","msg_notification")),__tips=e.data.tips,__announcement_made=!0},function(){},function(){})}function login(i,e,o,n){var t=new UserData;t.login=i,t.pwd=e,serverCommand(fe_command.login,t,"Login",function(e){switch(e.status){case fe_retcode.ok:var t=e.data.userData;switch(__login_token=e.message,__login_id=i=="**"+__local_user_id+"**"?__local_user_id:i,__cloud_storage=e.data.cloud_storage,__jobs_safe=e.data.jobs_safe,__demo_projects=e.data.demo_projects,__environ_server=e.data.environ_server,__login_user=t.name,__user_settings=t.settings,__user_role=t.role,__user_licence=t.licence,__dormant=t.dormant,__user_authorisation=t.authorisation,e.data.onlogin_message&&window.setTimeout(function(){new MessageBox("Information",e.data.onlogin_message,"msg_information")},1e3),__local_service?localCommand(nc_command.getNCInfo,{},"NC Info Request",function(e){return!!e&&(e.status==nc_retcode.ok?__environ_client="environ"in e.data?e.data.environ:["CCP4"]:new MessageBox("Get NC Info Error","Unknown error: <b>"+e.status+"</b><p>when trying to fetch Client NC data.","msg_error"),!0)}):__environ_client=[],__doNotShowList="helpTopics"in t?t.helpTopics:[],__local_setup=e.data.localSetup,__is_archive=e.data.isArchive,loadKnowledge("Login"),__user_settings.onlogin){case on_login.all_projects:__current_folder.path=folder_path.all_projects,__current_folder.type=folder_type.all_projects,__current_folder.nprojects=-1;break;case on_login.my_projects:__current_folder.path=__login_id+"'s Projects",__current_folder.type=folder_type.user,__current_folder.nprojects=-1}switch(n){case 0:__user_role==role_code.admin&&"admin"==t.login?makeAdminPage(o):__local_setup||t.action==userdata_action.none?__user_settings.onlogin==on_login.last_project?serverRequest(fe_reqtype.getProjectList,0,"Project List",function(e){__current_folder=e.currentFolder;for(var t=-1,i=0;i<e.projects.length&&t<0;i++)e.projects[i].name==e.current&&(t=i);(0<=t?makeProjectPage:makeProjectListPage)(o)},null,"persist"):makeProjectListPage(o):makeAccountPage(o);break;case 1:makeProjectListPage(o);break;case 2:makeAccountPage(o);break;case 101:new HopOnDemoProjectDialog(function(){makeProjectPage(o)});break;case 102:accessArchProject(__url_parameters.id,"external",function(e){e?makeProjectPage(o):(makeProjectListPage(o),window.setTimeout(function(){new MessageBox("Project not found","<h2>Project not found</h2>Project code<h3>"+__url_parameters.id+"</h3>is not found in "+appName()+" Archive. Check project code.","msg_error"),__url_parameters=null},100))});break;default:(__user_role==role_code.admin?makeAdminPage:makeProjectPage)(o)}return makeSessionCheck(o),__dormant&&window.setTimeout(function(){new MessageBox("Dormant Account","Dear "+__login_user+",<p>Your account was deemed dormant due to low use rate.<br>This means: <ul>  <li>you can login as before</li>  <li>you can browse your projects and jobs</li>  <li>you can export all your data, job directories and projects</li>  <li>you can delete your account, jobs and projects</li>  <li>you <b>cannot run</b> new jobs</li>  <li>you <b>cannot create</b> new projects</li>  <li>you <b>cannot import</b> projects</li></ul>In order to re-activate your account, please send an e-mail<br>request to server's maintainer at<p><a href=\"mailto:"+__maintainerEmail+"?Subject="+appName()+'%20Account re-activation">'+__maintainerEmail+"</a>.<p>Kind regards<p>"+appName()+" maintenance.","msg_mail")},100),!0;case fe_retcode.wrongLogin:return new MessageBox("Login","<b>Login data cannot be recognised.</b><p>Please check that provided login name and password are correct.","msg_excl_yellow"),!0;case fe_retcode.suspendedLogin:return new MessageBox("Suspended Login",'<div style="width:500px;"><h2>Your account is suspended.</h2><p>Your account is suspended due to sensitive data operations on your project(s), taking place at this moment. This should not last longer than a minute per gigabyte of your project(s) data, after which your account will be released automatically. Please contact '+appName()+' maintainer at <a href="mailto:'+__maintainerEmail+'?Subject=Account%20suspended">'+__maintainerEmail+"</a> if your account remains suspended for unreasonably long time.<p>Sincere apologies for any inconvenience this may be causing to you.</div>","msg_stop"),!0}return!1},null,null)}function offlineGreeting(e){"on"==__offline_message?__offline_message=launchHelpBox(appName()+" offline","./html/offline_greeting.html",doNotShowAgain,200,{width:600,height:300,navigation:!1}):e()}function stopOfflineGreeting(){"on"!=__offline_message&&"off"!=__offline_message&&(clearTimeout(__offline_message),__offline_message="off")}var __session_check_timer=null;function checkSession(i){0<__server_queue.length?makeSessionCheck(i):serverCommand(fe_command.checkSession,{login_token:__login_token},"Check session",function(t){return __session_check_timer&&(t.status==fe_retcode.wrongSession||t.status==fe_retcode.notLoggedIn?(__login_token="",logout(i,1)):offlineGreeting(function(){if(__current_page&&"string"===$.type(t.data)){var e=t.data.split(":");if(2==e.length)switch(__current_page._type){case"ProjectListPage":"cloudrun_reload_project_list"==e[0]?__current_page.reloadProjectList():"cloudrun_switch_to_project"==e[0]&&__current_page.loadProject(e[1]);break;case"ProjectPage":if(__current_page.getProjectName()==e[1]){__current_page.reloadProject();break}default:"cloudrun_switch_to_project"==e[0]&&new MessageBox("CloudRun submitted",'<div style="width:400px"><h2>CloudRun job submitted</h2>A CloudRun job was just submitted in your account and it now starts in project <b>'+e[1]+"</b>.<p>This message is only for your information.</div>","msg_information")}}makeSessionCheck(i)})),!0},function(){},function(){__session_check_timer&&(__local_setup?(__login_token="",logout(i,2)):makeSessionCheck(i))})}function stopSessionChecks(){__session_check_timer&&(clearTimeout(__session_check_timer),__session_check_timer=null)}function makeSessionCheck(e){stopSessionChecks(),__session_check_timer=setTimeout(function(){checkSession(e)},__check_session_period)}function FacilityTree(e,t){Tree.call(this,"_____"),this.tree_type=e,this.tree_root=t,this.item_map={}}function StorageTree(e,t,i,o){Tree.call(this,"_____"),this.tree_type=e,this.tree_root=t,this.file_key=i,this.dirdesc_lbl=o,this.storageList=null,this.item_map={}}FacilityTree.prototype=Object.create(Tree.prototype),FacilityTree.prototype.constructor=FacilityTree,FacilityTree.prototype.customIcon=function(){return new TreeNodeCustomIcon(activityIcon(),"22px","22px","hidden")},FacilityTree.prototype.readFacilitiesData=function(_,b,y,v,k){this.item_map={};var w,e={type:this.tree_type,path:this.tree_root};w=this,serverRequest(fe_reqtype.getCloudFileTree,e,_,function(e){function r(e,t,i){var o=e.addNode(t,i.name,image_path("folder"),e.customIcon());e.item_map[o.id]=i;for(var n=0;n<i.dirs.length;n++)r(e,o,i.dirs[n]);for(n=0;n<i.files.length;n++){var s=i.files[n],a=e.addNode(o,s.name,image_path("box"),e.customIcon());e.item_map[a.id]=s}}"message"in e&&MessageDataReadError(_,e.message),w.facilityList=jQuery.extend(!0,new FacilityList,e);for(var t=0;t<w.facilityList.facilities.length;t++){var i=w.facilityList.facilities[t],o=w.addRootNode("<b><i>"+i.title+"</i></b>",i.icon,w.customIcon());w.item_map[o.id]=i;for(var n=0;n<i.users.length;n++){var s=i.users[n],a=w.addNode(o,s.id,image_path("user"),w.customIcon());w.item_map[a.id]=s;for(var l=0;l<s.visits.length;l++){var c=s.visits[l],d=w.addNode(a,c.id+"  <i>["+c.date.substring(0,10)+"]</i>",image_path("visit"),w.customIcon());w.item_map[d.id]=c;for(var h=0;h<c.datasets.length;h++){var u=c.datasets[h],p=w.addNode(d,u.path,image_path("folder"),w.customIcon());w.item_map[p.id]=u;for(var m=0;m<u.dirs.length;m++)r(w,p,u.dirs[m]);for(m=0;m<u.files.length;m++){var f=u.files[m],g=w.addNode(p,f.name,image_path("box"),w.customIcon());w.item_map[g.id]=f}}}}}w.createTree(!0,b,y,v,k)},function(){},"persist")},FacilityTree.prototype.getSelectedItem=function(){return this.selected_node_id in this.item_map?this.item_map[this.selected_node_id]:null},FacilityTree.prototype.getItem=function(e,t){for(var i=null,o=this.selected_node_id;!i&&o;){var n=this.item_map[o];n._type==e?i=n:o=this.node_map[o].parentId}return i},FacilityTree.prototype.getFacility=function(){return shallowCopy(this.getItem("Facility",this.selected_node_id))},FacilityTree.prototype.getUser=function(){return shallowCopy(this.getItem("FacilityUser",this.selected_node_id))},FacilityTree.prototype.getVisit=function(){return shallowCopy(this.getItem("FacilityVisit",this.selected_node_id))},FacilityTree.prototype.getFile=function(){return shallowCopy(this.getItem("FacilityFile",this.selected_node_id))},FacilityTree.prototype.getDirPath=function(e){for(var t="",i=e;i;){var o=this.item_map[i];"Facility"==o._type||"FacilityDir"==o._type?t=o.name+"/"+t:"FacilityUser"==o._type||"FacilityVisit"==o._type?t=o.id+"/"+t:"FacilityDataset"==o._type&&(t=o.path+"/"+t),i=this.node_map[i].parentId}return t},FacilityTree.prototype.getFacilityName1=function(e){e=this.getItem("Facility",e);return e?e.name:""},FacilityTree.prototype.getFacilityName=function(){var e=this.getItem("Facility",this.selected_node_id);return e?e.name:""},FacilityTree.prototype.getUserID1=function(e){e=this.getItem("FacilityUser",e);return e?e.id:""},FacilityTree.prototype.getUserID=function(){var e=this.getItem("FacilityUser",this.selected_node_id);return e?e.id:""},FacilityTree.prototype.getVisitID1=function(e){e=this.getItem("FacilityVisit",e);return e?e.id:""},FacilityTree.prototype.getVisitID=function(){var e=this.getItem("FacilityVisit",this.selected_node_id);return e?e.id:""},FacilityTree.prototype.getDatasetID1=function(e){e=this.getItem("FacilityDataset",e);return e?e.id:""},FacilityTree.prototype.getDatasetID=function(){var e=this.getItem("FacilityDataset",this.selected_node_id);return e?e.id:""},StorageTree.prototype=Object.create(Tree.prototype),StorageTree.prototype.constructor=StorageTree,StorageTree.prototype.customIcon=function(){return new TreeNodeCustomIcon(activityIcon(),"22px","22px","hidden")};var icon_ext={mtz:"file_mtz",sca:"file_mtz",h5:"file_hdf",ccp4_demo:"file_ccp4demo",ccp4cloud:"file_ccp4demo",pdb:"file_pdb",ent:"file_pdb",mmcif:"file_pdb",jpg:"file_image",jpeg:"file_image",png:"file_image",gif:"file_image",html:"file_doc",txt:"file_doc",pdf:"file_doc",seq:"file_seq",fasta:"file_seq",pir:"file_seq",hhr:"file_hhpred",borges:"file_borges"},importable_ext=["mtz","pdb","ent","mmcif","jpg","jpeg","png","gif","html","txt","pdf","seq","fasta","pir","hhr","sca","cif","lib","borges"];function JobTree(){Tree.call(this,"___"),this.projectData=null,this.task_map={},this.run_map={},this.dlg_map={},this.checkTimeout=null,this.mode="project",this.in_archive=!1}StorageTree.prototype.readStorageData=function(h,e,u,p,m,f){if(this.item_map={},e&&0<e.length){this.ext_filter=[];for(var t=0;t<e.length;t++){var i=e[t].toLowerCase().replace(/^./,"");0<=importable_ext.indexOf(i)&&this.ext_filter.push(i)}}else this.ext_filter=importable_ext;var g,o={type:this.tree_type,path:this.tree_root};g=this,serverRequest(fe_reqtype.getCloudFileTree,o,h,function(e){if("message"in e)MessageDataReadError(h,e.message),g.storageList=null,u();else if(g.dirdesc_lbl.setText(""),g.storageList=jQuery.extend(!0,new StorageList,e),g.storageList.path.length<=0&&g.storageList.dirs.length<=0&&g.storageList.files.length<=0)g.storageList.size=-1,u();else{e="Cloud File Storage";g.tree_root=g.storageList.path,g.tree_root&&(e=g.tree_root),g.root_label.setText("<u><i><b>"+e+"</b></i></u>"),g.root.element.style.paddingTop="4px",g.root.element.style.paddingLeft="40px";for(var t=0;t<g.storageList.dirs.length;t++){var i=g.storageList.dirs[t],o=(".."==(s=i.name)&&(s+=" (&#8593; <i>upper directory</i>)",i.hasOwnProperty("fullDesc")&&g.dirdesc_lbl.setText(i.fullDesc+"<hr/>&nbsp;<br>")),"folder"),n=s.toLowerCase(),n=(0<=n.indexOf("my computer")?o="folder_mycomputer":0<=n.indexOf("home")?o="folder_home":0<=n.indexOf("ccp4")||0<=n.indexOf("demo")?o="folder_ccp4":0<=n.indexOf("tutorial")?o="folder_tutorials":0<=n.indexOf("workshop")&&(o="folder_workshops"),(0<=n.indexOf("howto")||0<=n.indexOf("how ")||0<=n.indexOf("?"))&&(o="folder_howto"),g.addRootNode(s,image_path(o),g.customIcon()));".."!=s&&i.hasOwnProperty("shortDesc")&&n.setTooltip(i.shortDesc),g.item_map[n.id]=i}for(t=0;t<g.storageList.files.length;t++){var s,a,r,l,c,d=g.storageList.files[t];".."==(s=d.name)||startsWith(s,".")||("gz"==(r=(a=d.name.split(".")).pop().toLowerCase())&&(r=a.pop().toLowerCase(),importable_ext.indexOf(r)<0&&(r="gz")),a=a.join(".").toLowerCase(),l=2!=g.file_key,4==g.file_key?l=0<=g.ext_filter.indexOf(r):5==g.file_key&&(l="ccp4_demo"==r||"ccp4cloud"==r)&&(s=s.substring(0,s.lastIndexOf("."))),o="file_dummy",r in icon_ext?o=icon_ext[r]:"h5"in d?(0<d.h5?o="file_hdf":s="("+Array(s.length).join("....")+")",l=!1):"cif"==r?o=endsWith(a,"-sf")?"file_mtz":"file_pdb":"image"in d&&(0<d.image?o="file_xray":s="("+Array(s.length).join("....")+")",l=1==g.file_key||2==g.file_key),l?(c=g.addRootNode(s,image_path(o),g.customIcon()),g.item_map[c.id]=d):c=g.addRootNode('<span style="color:gray">'+s+"</span>",image_path(o),g.customIcon()))}g.createTree(!0,u,p,m,f)}},function(){},"persist")},StorageTree.prototype.getSelectedItems=function(){for(var e=this.calcSelectedNodeIds(),t=[],i=0;i<e.length;i++)e[i]in this.item_map&&t.push(this.item_map[e[i]]);return t},JobTree.prototype=Object.create(Tree.prototype),JobTree.prototype.constructor=JobTree,JobTree.prototype.setReplayMode=function(){this.mode="replay"},JobTree.prototype.setSelectMode=function(){this.mode="select"},JobTree.prototype.isProjectMode=function(){return"project"==this.mode},JobTree.prototype.isRemark=function(e){return e in this.task_map&&this.task_map[e].isRemark()},JobTree.prototype.isReplayMode=function(){return"replay"==this.mode},JobTree.prototype.isSelectMode=function(){return"select"==this.mode},JobTree.prototype.customIcon=function(){return new TreeNodeCustomIcon(activityIcon(),"22px","22px","hidden")},JobTree.prototype.getTaskByNodeId=function(e){return e in this.task_map?this.task_map[e]:null},JobTree.prototype.countTasks=function(){var e,t=0;for(e in this.task_map)this.task_map[e].isRemark()||t++;return t},JobTree.prototype.getTask=function(e){var t,i=null;for(t in this.task_map)if(this.task_map[t].id==e){i=this.task_map[t];break}return i},JobTree.prototype.getTaskNodeId=function(e){var t,i=null;for(t in this.task_map)if(this.task_map[t].id==e){i=t;break}return i};var __deleteStyle="color:#FF0000;text-decoration:line-through;",__notViewedStyle="color:#00A000;",__remarkStyle="color:#A00000;font-style:italic;",__linkStyle="color:#0000FF;font-style:italic;text-decoration:underline;",__highlightStyle="background-color:yellow;padding:4px 16px 4px 0px;",__highlightStyleL="background-color:lime;padding:4px 16px 4px 0px;";function __projectStyle(e){return'<span style="color:blue;"><b>'+e+"</b></span>"}function Upload(u,p,t,e,m){var f,i,o=p instanceof Array,n=(Widget.call(this,"div"),this.setHorizontalAlignment("center"),this.progressBar=new ProgressBar(100),this.progressBar.setSize("99%","20px"),$(this.progressBar.element).css({"margin-bottom":"10px",position:"relative"}),this.addWidget(this.progressBar),this.indicator=new Label(""),this.progressBar.addWidget(this.indicator),$(this.indicator.element).css({position:"absolute",center:"50%",top:"0px","font-weight":"bold","font-style":"italic","text-shadow":"1px 1px 0 #fff"}),this.indicator.setHorizontalAlignment("center"),this.indicator.setFontSize("90%"),this.indicator.setWidth("100%"),new Grid("")),s=0;n.setCellSize("50%","",0,s++),this.addWidget(n),this.returnCode="in progress",this.upload_files=[],this.accept_gzip=!1,this.ignored_list=[],this.linkDataType=null,this.link_button=null,this.button=null,this.pdb_button=null,o||("project"==p.type?this.button=n.setButton("Select project archive(s)",image_path("open_file"),0,s++,1,1).setNoWrap():(this.button=n.setButton("Upload file(s)",image_path("open_file"),0,s++,1,1).setNoWrap(),e&&(this.pdb_button=n.setButton("Select PDB entry(s)",image_path("open_file"),0,s++,1,1).setNoWrap(),this.pdb_button.addOnClickListener(e))),n.setCellSize("50%","",0,s),this.fileListTitle=new Label("<b><i>Uploaded</i></b>"),this.fileListTitle.setHorizontalAlignment("left").setSize("100%","26px"),this.addWidget(this.fileListTitle),this.fileListPanel=new Label(""),this.fileListPanel.element.setAttribute("class","upload-filelist"),this.addWidget(this.fileListPanel),"project"==p.type&&this.fileListPanel.setHeight_px(40),this.setScrollable("hidden","hidden"),"project"==p.type&&(this.fileListTitle.hide(),this.fileListPanel.hide()),this.accept_files=p.accept,this.accept_gzip=p.gzip,e=this.accept_files,this.accept_gzip&&(e&&(e+=","),e+=".gz"),this.selFile=new SelectFile("project_data"==p.type,e),this.selFile.hide(),this.addWidget(this.selFile)),this.link_directory=null,(f=this).upload_data=function(e){var t=e;if(e||(f.button.setDisabled(!0),f.link_button&&f.link_button.setDisabled(!0),f.pdb_button&&f.pdb_button.setDisabled(!0),t=f.selFile.element.files),f.ignored_list=[],f.accept_gzip)for(var i,o=t,t=[],n=f.accept_files.split(","),s=0;s<o.length;s++)!endsWith(o[s].name,".gz")||2<(i=o[s].name.split(".")).length&&0<=n.indexOf("."+i[i.length-2])?t.push(o[s]):f.ignored_list.push(o[s].name);if(0<t.length||f.link_directory){f.indicator.setText("upload in progress ...");var a=new FormData;if(null!=u)for(var r in u)null!==u[r]&&"object"==typeof u[r]?a.append(r,JSON.stringify(u[r])):a.append(r,u[r]);f.link_directory&&(a.append("link_directory",f.link_directory),a.append("link_data_type",f.linkDataType));var l=!0;if(e)for(s=0;s<e.length;s++)for(var c=e[s],d=0;d<c.length;d++){h=c[d];a.append("uploads[]",h,h.name)}else for(var h,s=0;s<t.length;s++)endsWith((h=t[s]).name,projectFileExt)||(l=!1),a.append("uploads[]",h,h.name);"project"!=p.type||l?(f.emitSignal(cofe_signals.uploadEvent,"upload_started"),$.ajax({url:fe_command.upload,type:"POST",data:a,cache:!1,processData:!1,contentType:!1,success:function(e){e=jQuery.extend(!0,new Response,jQuery.parseJSON(e));f.new_files=[],e.status!=fe_retcode.ok?(makeCommErrorMessage("Upload",fe_command.upload,e),f.indicator.setText("upload failed"),f.returnCode="failed"):(f.progressBar.setValue(100),f.indicator.setText("Done."),f.setUploadedFiles(e.data.files),f.returnCode=""),m(f.returnCode),"button"in f&&f.button&&(f.button.setEnabled(!0),f.link_button&&f.link_button.setEnabled(!0),f.pdb_button&&f.pdb_button.setEnabled(!0)),f.emitSignal(cofe_signals.uploadEvent,"upload_finished")},xhr:function(){var e=new XMLHttpRequest;return e.upload.addEventListener("progress",function(e){e.lengthComputable&&(e=e.loaded/e.total,e=parseInt(100*e),f.progressBar.setValue(e),f.indicator.setText(e+"%"))},!1),e}})):(new MessageBox("Not a project archive","Selected file is not a project archive. Please<br>select project archive previously exported<br>from "+appName()+"."),f.button.setDisabled(!1),f.indicator.setText(""),f.pdb_button&&f.pdb_button.setDisabled(!1))}},o?f.upload_data(p):(f.button.addOnClickListener(function(){f.indicator.setText(""),f.progressBar.setValue(0),$(f.selFile.element).click()}),$(f.selFile.element).on("change",function(e){t?t(e,function(){f.upload_data(null)}):f.upload_data(null)}),f.link_button&&(i="Select Directory",i="X-ray"==f.linkDataType?"Select Directory with X-ray images":"Select Directory with EM micrographs",f.link_button.addOnClickListener(function(){f.link_button.setDisabled(!0),localCommand(nc_command.selectDir,{dataType:f.linkDataType,title:i},"Select Directory",function(e){return!!e&&(e.status==nc_retcode.ok?""!=e.data.directory&&(f.link_directory=e.data.directory,f.upload_data(null)):new MessageBox("Select Directory Error","Directory selection failed:<p><b>stdout</b>:&nbsp;&nbsp;"+e.data.stdout+"<br><b>stderr</b>:&nbsp;&nbsp;"+e.data.stderr),f.link_button.setEnabled(!0),!0)})})))}function UploadDialog(e,i,o,n,s){Widget.call(this,"div"),this.element.setAttribute("title",e),document.body.appendChild(this.element);var a,r=new Grid("");this.addWidget(r),r.setLabel("<h3>"+e+"</h3>",0,0,1,3),o.login_token=__login_token,a=this,e=2*$(window).width()/7+"px",$(a.element).dialog({resizable:!1,height:"auto",maxHeight:500,width:e,modal:!0,open:function(e,t){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide(),a.upload=new Upload(o,i,null,null,function(e){$("#cancel_btn").button("option","label","Close"),s(e),!e&&n&&$(a.element).dialog("close")}),r.setWidget(a.upload,2,0,1,3)},buttons:[{id:"cancel_btn",text:"Cancel",click:function(){$(this).dialog("close")}}]})}function rvapi_rsviewer(e,t,i,o){var n;__current_page?"ProjectPage"!=__current_page._type?new MessageBox("Wrong page type","Wrong Project Page type encountered. This is a bug, please contact "+appName()+" developer.","msg_error"):(n=__current_page.getJobTree().getTask(e))?startRSViewer(t,n.getProjectURL(e,i),n.getProjectURL(e,o)):new MessageBox("Task not found","Project Task not found. This is a bug, please contact "+appName()+" developer.","msg_error"):new MessageBox("Page not found","Project Page not found. This is a bug, please contact "+appName()+" developer.","msg_error")}function rvapi_umviewer(e,t,i,o,n){var s,a,r,l;__current_page?"ProjectPage"!=__current_page._type?new MessageBox("Wrong page type","Wrong Project Page type encountered. This is a bug, please contact "+appName()+" developer.","msg_error"):(s=__current_page.getJobTree().getTask(e))?(l=r=a="",startUglyMol(t,a=i?s.getProjectURL(e,i):a,"",r=o?s.getProjectURL(e,o):r,l=n?s.getProjectURL(e,n):l,null)):new MessageBox("Task not found","Project Task not found. This is a bug, please contact "+appName()+" developer.","msg_error"):new MessageBox("Page not found","Project Page not found. This is a bug, please contact "+appName()+" developer.","msg_error")}function DataBox(){this._type="DataBox",this.data={},this.jobs=[]}JobTree.prototype.__compare_node=function(e,t){if(t.dataId!=node2.dataId||t.children.length!=node2.children.length)return null;var i=[];this.compare(node2)||(i=[node2.dataId]);for(var o=0;o<t.children.length&&i;o++)var n=this.__compare_node(t.children[o],node2.children[o]),i=n?i.concat(n):null;return i},JobTree.prototype.compare=function(e){var t=this.tree,i=e.tree;if(t.length!=i.length)return null;for(var o=[],n=0;n<t.length&&o;n++)var s=this.__compare_node(t[n],i[n]),o=s?o.concat(s):null;return o},JobTree.prototype.readProjectData=function(c,d,h,u,p,m,f){var g;this.stopTaskLoop(),this.checkLoop=!1,g=this,serverRequest(fe_reqtype.getProjectData,{mode:g.mode},c,function(e){if("missing"in e)g.projectData=null,new MessageBox("Missing Project",'<div style="width:400px"><h2>Missing Project</h2>Project <i>"'+e.project+'"</i> does not exist. If it was shared with you, check that it is not deleted by owner.</div>',"msg_error");else if("message"in e)MessageDataReadError(c,e.message);else if(e.meta.desc.timestamp>h){g.task_map={},g.run_map={},g.dlg_map={};var t=null,t=(g.projectData&&(t=g.projectData.desc.startmode),g.projectData=jQuery.extend(!0,new ProjectData,e.meta),g.projectData.desc.dateLastUsed=getDateString(),g.projectData.desc.autorun=!1,g.in_archive=inArchive(g.projectData.desc),t&&(g.projectData.desc.startmode=t),getProjectAuthor(g.projectData.desc)),i=((t=t==__login_id?"":t)&&(t+=":"),""),o=g.projectData.desc.name,t=(g.in_archive&&(i=", <i>arch.ID:</i> "+g.projectData.desc.archive.id,o=g.projectData.desc.archive.project_name),__projectStyle(t+"["+o+"]"+i));if(g.projectData.tree.length<=0)g.addRootNode(t,image_path("project"),g.customIcon());else{e.meta.tree[0].text=t,g.setNodes(e.meta.tree,d);for(var n,s={},a=0;a<e.tasks_add.length;a++)s[e.tasks_add[a].id]=e.tasks_add[a];for(n in g.node_map){var r,l=g.node_map[n].dataId;l in s&&(r=JSON.stringify(s[l]),g.task_map[n]=getObjectInstance(r),g.task_map[n].treeItemId=n,g.task_map[n].project=g.projectData.desc.name,g.task_map[n].state==job_code.running||g.task_map[n].state==job_code.ending||g.task_map[n].state==job_code.exiting?(g.run_map[l]=n,g.task_map[n].autoRunId&&(g.projectData.desc.autorun=!0),g.setNodeName(n,!1),g.node_map[n].setCustomIconVisible(!0)):(g.setNodeName(n,!1),g.node_map[n].setCustomIconVisible(!1)))}}g.createTree(d,function(){for(var e in g.task_map)g.task_map[e].isRemark()?g.setRemarkStyle(g.node_map[e],g.task_map[e]):g.task_map[e].job_dialog_data.viewed||g.setStyle(g.node_map[e],__notViewedStyle,0);"R_free"in g.projectData.desc.metrics&&!(1<=g.projectData.desc.metrics.R_free)||(g.calcMetrics(),"R_free"in g.projectData.desc.metrics&&g.projectData.desc.metrics.R_free<1&&g.saveProjectData([],[],!0,function(e,t){})),u()},p,m,f);o={};o.pdesc=g.projectData.desc,g.emitSignal(cofe_signals.rationUpdated,o)}else g.projectData=null,u()},function(){g.startTaskLoop()},"persist")},JobTree.prototype.makeNodeId=function(e){return"["+padDigits(e,4)+"]"},JobTree.prototype.makeNodeName=function(e){if(!e)return"no task!";var t=e.autoRunId;if("submitter"in e&&e.submitter&&(a=this.projectData.desc.owner.login,(a="author"in this.projectData.desc.owner?this.projectData.desc.owner.author:a)&&"tutorials"!=a&&e.submitter!=a&&(t&&(t+=":"),t+=e.submitter)),t=t&&"<b>"+t+":</b>",t+=this.makeNodeId(e.id)+" ",0<e.harvestedTaskIds.length){for(var i=this.getAllAncestors(e),o=[],n=0;n<i.length;n++)o.push(i[n].id);for(var s=[],n=0;n<e.harvestedTaskIds.length;n++)o.indexOf(e.harvestedTaskIds[n])<0&&s.push(padDigits(e.harvestedTaskIds[n],4));0<s.length&&(t+=' <font style="font-size:80%" cross-branch="1"><b><i>+('+s.join(",")+")</i></b></font> ")}0<e.uname.length?t+=e.uname:t+=e.name;var a=e.result_indicator();return a&&"*none*"!=a&&(t+=' <b><i>-- <font style="font-size:80%">'+a+"</font></i></b>"),t},JobTree.prototype.setNodeName=function(e,t){var i,o;e in this.task_map&&(i=this.task_map[e],e=this.node_map[e],(o=this.makeNodeName(i))!=e.text&&(this.setText(e,o),this.confirmCustomIconsVisibility(),i.isRemark()&&this.setRemarkStyle(e,i),t&&this.saveProjectData([],[],!0,function(e,t){})))},JobTree.prototype.setNodeIcon=function(e,t){var i=this.task_map[e],e=this.node_map[e];this.setIcon(e,image_path(i.icon())),t&&this.saveProjectData([],[],!0,function(e,t){})},JobTree.prototype.resetNodeName=function(e){var t;e in this.task_map&&((t=this.task_map[e])&&(e=this.node_map[e],this.setText(e,this.makeNodeName(t)),t.isRemark()&&this.setRemarkStyle(e,t)),this.confirmCustomIconsVisibility())},JobTree.prototype.__checkTaskLoop=function(){var a;(a=this).checkTimeout=window.setTimeout(function(){var e={};e.project=a.projectData.desc.name,e.shared=a.isShared(),e.timestamp=a.projectData.desc.timestamp,e.run_map=a.run_map,serverRequest(fe_reqtype.checkJobs,e,"Check jobs state",function(e){if(a.checkTimeout&&-1!=a.checkTimeout)if(e.reload)a.emitSignal(cofe_signals.reloadTree,e);else{var t,i=e.completed_map,o=[];for(t in i){var n,s=getObjectInstance(JSON.stringify(i[t]));s.id in a.run_map&&((n=a.run_map[s.id])in a.task_map&&(s.treeItemId=n,a.task_map[n]=s,a.setNodeName(n,!1),s.isRemark()?a.setRemarkStyle(a.node_map[n],s):a.setStyle(a.node_map[n],__notViewedStyle,0),a.node_map[n].setCustomIconVisible(!1),a.setNodeIcon(n,!1),o.push(s),update_project_metrics(s,a.projectData.desc.metrics)),t in a.dlg_map&&(a.dlg_map[t].task=s,a.dlg_map[t].setDlgState(),s.state==job_code.failed?a.dlg_map[t].reloadReport():"client"==s.nc_type&&a.dlg_map[t].loadReport()),a.startChainTask(s,n))}a.run_map=mapMaskOut(a.run_map,i),0<o.length&&(a.emitSignal(cofe_signals.treeUpdated,{}),a.updateRation(e),a.saveProjectData([],[],!1,function(e,t){}))}},function(){-1!=a.checkTimeout&&(a.checkTimeout&&(0<Object.keys(a.run_map).length||a.isShared())?a.__checkTaskLoop():a.checkTimeout=null)},function(){})},__check_job_interval)},JobTree.prototype.startTaskLoop=function(){!this.checkTimeout&&this.projectData&&(0<Object.keys(this.run_map).length||this.isShared())&&this.__checkTaskLoop()},JobTree.prototype.stopTaskLoop=function(){this.checkTimeout&&-1!=this.checkTimeout&&(window.clearTimeout(this.checkTimeout),this.checkTimeout=null)},JobTree.prototype.getSelectedTask=function(){return this.selected_node_id in this.task_map?this.task_map[this.selected_node_id]:null},JobTree.prototype.getSelectedTasks=function(){for(var e,t=this.calcSelectedNodeIds(),i=[],o=0;o<t.length;o++)t[o]in this.task_map?i.push(this.task_map[t[o]]):t[o]in this.node_map&&!this.node_map[t[o]].parentId&&i.push({id:-1});return i.length<=0&&((e=this.getSelectedTask())&&i.push(e)),i},JobTree.prototype.selectTask=function(e){e=this.getTaskNodeId(e.id);e&&this.selectSingleById(e)},JobTree.prototype.selectTasks=function(e){var t=0;if(0<e.length)for(var i=e.length-1;0<=i;i--)0<=e[i].id?(o=this.getTaskNodeId(e[i].id))&&this.selectNodeById(o,t<=0)&&t++:this.selectNodeById(this.root_nodes[0].id,t<=0)&&t++;if((t=0<t?$(this.root.element).jstree("get_selected").length:t)<=0){for(var o in this.node_map)this.node_map[o].state.selected&&this.selectNodeById(o,t<=0)&&t++;(t=$(this.root.element).jstree("get_selected").length)<=0&&this.selectNodeById(this.root_nodes[0].id,!0)&&t++}return t},JobTree.prototype.updateRation=function(e){"pdesc"in e&&(this.projectData.desc.disk_space=e.pdesc.disk_space,this.projectData.desc.cpu_time=e.pdesc.cpu_time,this.projectData.desc.njobs=e.pdesc.njobs,this.emitSignal(cofe_signals.rationUpdated,e))},JobTree.prototype.checkReload=function(e,t){var i,o,n;return!(1<e.reload)||(i='<div style="width:400px;"><h2>Project Update Required</h2>Requested operation cannot be performed because the Project was just updated ',(o=0<Object.keys(this.projectData.desc.share).length)&&this.projectData.desc.autorun?i+="by either a user, with whom this Project is shared, or automatic workflow running, or both.":i+=o?"by user, with whom this Project is shared.":"by automatic workflow running.",n=this,new MessageBoxF("Project update required",i+'<p>Click "Update" button and try to '+t+" again.</div>","Update",function(){e.force_reload=!0,n.emitSignal(cofe_signals.reloadTree,e)},!0),!1)},JobTree.prototype.missingProject=function(){new MessageBox("Project not found",'<div style="width:400px"><h2>Project not found on server</h2>Project "'+this.projectData.desc.name+'" was not found on server. This project was shared with you, please check whether it was deleted by project owner.</div>',"msg_error"),this.emitSignal(cofe_signals.makeProjectList,{})},JobTree.prototype.saveProjectData=function(e,t,i,o){var n,s;this.in_archive?o&&o(this,{reload:0}):this.projectData&&(this.projectData.desc.dateLastUsed=getDateString(),this.projectData.tree=this.root_nodes,(n={}).meta=this.projectData,n.tasks_add=e,n.tasks_del=t,n.update=i,s=this,serverRequest(fe_reqtype.saveProjectData,n,"Project",function(e){-11111==e.reload?s.missingProject():0<e.reload?(s.projectData.desc.timestamp=e.pdesc.timestamp,o?o(s,e):s.emitSignal(cofe_signals.reloadTree,e)):(s.updateRation(e),s.projectData.desc.timestamp=e.pdesc.timestamp,o&&o(s,e))},null,"persist"))},JobTree.prototype.hasRunningJobs=function(e){return e?function e(t,i){var o=!1;if(i in t.task_map)for(var o=t.task_map[i].state==job_code.running,n=t.node_map[i].children,s=0;s<n.length&&!o;s++)o=e(t,n[s].id);return o}(this,e):0<Object.keys(this.run_map).length},JobTree.prototype.selectStackJobs=function(){var e=this.calcSelectedNodeIds();if(1<e.length){for(var t=!0,i=0;i<e.length&&t;i++)t=this.node_map[e[i]].text.indexOf('cross-branch="1"')<0;if(t&&1<(e=this.canMakeFolder1(e)).length)return[1,e,[]]}else if(0<e.length&&e[0]in this.node_map){if(0<this.node_map[e[0]].fchildren.length)return[2,e,[]];var o=[],n=[],s=e[0],a=this.node_map[s];"children"in a&&1==a.children.length&&this.isRemark(a.children[0].id)&&(s=a.parentId);for(;s;)s=(a=this.node_map[s]).parentId&&0==a.fchildren.length&&"children"in a&&1==a.children.length&&a.text.indexOf('cross-branch="1"')<0?(o.push(s),a.parentId):(0<o.length&&!a.parentId&&o.pop(),null);for(s=e[0];s;)s=(a=this.node_map[s]).parentId&&0==a.fchildren.length&&"children"in a&&1==a.children.length&&a.text.indexOf('cross-branch="1"')<0?(n.push(s),a.children[0].id):(0<n.length&&this.isRemark(s)&&n.pop(),null);if(o.length<2&&(o=[]),n.length<2&&(n=[]),1<o.length||1<n.length)return[1,o,n]}return[0,[],[]]},JobTree.prototype._add_job=function(e,i,o,n,s){var t,a;this.selected_node_id?((t=this.getSelectedTask())&&"archive_version"in t&&0<t.archive_version&&(a=this.addNodeToSelected(__projectStyle("revision #"+this.projectData.desc.archive.version),image_path("project"),this.customIcon()),this.selectNode(a,!0)),i.project=this.projectData.desc.name,i.id=this.projectData.desc.jobCount+1,i.harvestedTaskIds=o.harvestedTaskIds,i.submitter=__login_id,a=e?this.insertNodeAfterSelected("",image_path(i.icon()),this.customIcon()):this.addNodeToSelected("",image_path(i.icon()),this.customIcon()),(this.task_map[a.id]=i).treeItemId=a.id,a.dataId=i.id,this.setText(a,this.makeNodeName(i)),i.isRemark()&&this.setRemarkStyle(a,i),t&&(i.parentId=t.id),this.saveProjectData([i],[],!0,function(e,t){e.checkReload(t,"add the job")&&(i.id=t.jobIds[0],a.dataId=i.id,e.projectData.desc.jobCount=i.id,s&&s(Math.min(a.children.length,1)),e.openJob(o,n))})):(console.log("no selection in the tree:_add_job"),s&&s(-1))},JobTree.prototype._copy_task_parameters=function(e,t){for(var i=null,o=0;o<t.length&&!i;o++)e._type==t[o]._type&&(i=t[o]);return i?i.version<e.currentVersion()?-1:(e.parameters=jQuery.extend(!0,{},i.parameters),1):0},JobTree.prototype._copy_task_cloud_path=function(e,t){if("currentCloudPath"in e){for(var i=null,o=0;o<t.length&&!i;o++)"currentCloudPath"in t[o]&&(i=t[o]);i&&(e.currentCloudPath=i.currentCloudPath)}},JobTree.prototype.addJob=function(i,o,n,s){var a,r,l;this.projectData?(r=(a=this).harvestTaskData(1,[]),l=a.getAllAncestors(a.getSelectedTask()),new TaskListDialog(r,l,a,function(e,t){t&&(a.projectData.desc.tasklistmode=t),e?o&&a._copy_task_parameters(e,l)<0?(new MessageBox("Cannot copy job parameters",'<div style="width:500px;"</div><h2>Cannot copy parameters from previous job.</h2>The previous job was created with a lower version of '+appName()+' and its parameters cannot be copied into the new one.<p>Please add the job with default parameters, using "<i>Add Job</i>" button from the control bar, and set parameters manually.</div>',"msg_stop"),s&&s(-5)):(a._copy_task_cloud_path(e,l),a._add_job(i,e,r,n,s)):s&&s(-2)})):s&&s(-3)},JobTree.prototype.addTask=function(e,t,i,o,n){var s,a=this.harvestTaskData(1,[]),r=(a.isEmpty()&&(e.inputMode=input_mode.root),e.isTaskAvailable()),l=a.getDataSummary(e);return e.state==job_code.retired?l.status=-2:"ok"!=r[0]&&(l.status=-1),0<l.status?(s=this.getAllAncestors(this.getSelectedTask()),i&&this._copy_task_parameters(e,s),this._copy_task_cloud_path(e,s),this._add_job(t,e,a,o,n)):n&&n(-4),[r,l]},JobTree.prototype.startChainTask=function(task,nodeId){if(task.hasOwnProperty("task_chain"))if(task.task_chain.length<=0)delete task.task_chain;else if(task.state==job_code.finished||"delete_job"==task.task_chain[0]){var nid=nodeId;if(nid||(nid=this.getTaskNodeId(task.id),nid))if(this.selectSingleById(nid),"delete_job"==task.task_chain[0])!function(t){t.deleteJob(!0,function(e){e&&t.emitSignal(cofe_signals.treeUpdated,{})})}(this);else{var newtask=eval("new "+task.task_chain[0]+"()");if(1<task.task_chain.length){newtask.task_chain=[];for(var i=1;i<task.task_chain.length;i++)newtask.task_chain.push(task.task_chain[i])}newtask.onJobDialogStart=function(e){e.run_btn.click()},!function(e){e.addTask(newtask,!1,!0,__current_page,function(){task.id in e.dlg_map&&e.dlg_map[task.id].close()})}(this)}}},JobTree.prototype.clearHighlights=function(){for(var e in this.node_map){var t=this.node_map[e];t.highlightId&&(e in this.task_map&&!this.task_map[e].job_dialog_data.viewed?this.setStyle(t,__notViewedStyle,0):this.setStyle(t,"",0),t.highlightId=0)}},Tree.prototype.getLastNode=function(e){for(var t=e,i=-1,o=(e.id in this.task_map&&(i=this.task_map[e.id].id),-1),n=0;n<e.children.length;n++){var s=this.getLastNode(e.children[n]);s[0].id in this.task_map&&s[1]>=o&&(o=s[1],t=s[0])}return[t,Math.max(o,i)]},Tree.prototype.getLastHighlightedNode=function(){var e,t=null;for(e in this.node_map)if(2==this.node_map[e].highlightId){t=this.node_map[e];break}return t},JobTree.prototype._highlight_to_root=function(e,t){t?(this.setStyle(e,__highlightStyleL,0),e.highlightId=2):(this.setStyle(e,__highlightStyle,0),e.highlightId=1);var i=[],o=this.task_map[e.id];if(o)for(var n=0;n<o.harvestedTaskIds.length;n++)i.push(o.harvestedTaskIds[n]);for(;e.parentId;)if(e=this.node_map[e.parentId],this.setStyle(e,__highlightStyle,0),e.highlightId=1,o=this.task_map[e.id])for(n=0;n<o.harvestedTaskIds.length;n++)i.indexOf(o.harvestedTaskIds[n])<0&&i.push(o.harvestedTaskIds[n]);for(n=0;n<i.length;n++){var s=this.getTaskNodeId(i[n]);s in this.node_map&&this._highlight_to_root(this.node_map[s],!1)}},JobTree.prototype.toggleBranchHighlight=function(){var e=this.getSelectedNode();e.highlightId?this.clearHighlights():(this.clearHighlights(),this._highlight_to_root(this.getLastNode(e)[0],!0))},JobTree.prototype.moveJobUp=function(o){this.selected_node_id?(this.moveSelectedNodeUp(),this.saveProjectData([],[],!0,function(e,t){var i;e.checkReload(t,"move the job up")?(e.projectData.desc.timestamp=t.pdesc.timestamp,e.projectData.desc.jobCount=t.pdesc.jobCount,(i=e.getLastHighlightedNode())?window.setTimeout(function(){e._highlight_to_root(i,!0),o()},100):o()):o()})):(console.log("no selection in the tree:moveJobUp"),o())},JobTree.prototype.calcMetrics=function(){for(var e in this.projectData.desc.metrics={},this.task_map)update_project_metrics(this.task_map[e],this.projectData.desc.metrics)},JobTree.prototype.deleteJob=function(e,r){if(this.selected_node_id){for(var l=this,c=l.calcSelectedNodeIds(),t=(c.length<=0&&c.push(l.getSelectedNodeId()),[]),i=0;i<c.length;i++){var o=l.task_map[c[i]];o&&t.push(o.id)}do{var n,s=c.length;for(n in l.task_map){var a=l.task_map[n];if(t.indexOf(a.id)<0){var d=!1,h=l.node_map[n];h.parentId&&0<=c.indexOf(h.parentId)&&(d=(h=l.task_map[h.parentId])&&!h.isRemark());for(i=0;!d&&i<a.harvestedTaskIds.length;i++)d=0<=t.indexOf(a.harvestedTaskIds[i]);d&&(c.push(n),t.push(a.id))}}}while(s<c.length);c.sort(function(e,t){return t-e});for(var u=[],p=0,m=0,i=0;i<c.length;i++){var f=1;(a=l.task_map[c[i]])&&a.isRemark()&&(f=0,m++),l.setStyle(l.node_map[c[i]],__deleteStyle,f),p++,f&&(p+=l.node_map[c[i]].children.length),u.push(f)}var g,_="",b="Delete Node";function y(){for(var e=0;e<c.length;e++)1==u[e]?l.deleteBranch(l.node_map[c[e]]):l.deleteNode(l.node_map[c[e]]);var t,i,o,n=[],s={},a={};for(o in l.task_map)o in l.node_map?s[o]=l.task_map[o]:(t=l.task_map[o].id,i=0,"disk_space"in l.task_map[o]&&(i=l.task_map[o].disk_space),n.push([t,i]),t in l.dlg_map&&(l.dlg_map[t].close(),l.dlg_map=mapExcludeKey(l.dlg_map,t)));for(o in l.task_map=s,l.run_map)l.run_map[o]in l.node_map&&(a[o]=l.run_map[o]);l.run_map=a,l.calcMetrics(),l.saveProjectData([],n,!0,function(e,t){e.checkReload(t,"delete the job(s)<br>")&&r&&r(!0)})}1==p?(g="Selected node",l.selected_node_id in l.task_map&&(g=l.makeNodeId(l.task_map[l.selected_node_id].id),b=l.task_map[l.selected_node_id].isRemark()?(_="Selected remark ","Delete Remark"):(_="Selected job ","Delete Job")),_+=g+" will be deleted.<br>Are you sure?"):(b=m==p?(_="Selected remarks","Delete Remarks"):0<m?(_="Selected job(s) and remark(s)","Delete Jobs and Remarks"):(_="Selected jobs","Delete Jobs"),_+=", indicated in the job tree, will be deleted.<br>Are you sure?"),e?y():new QuestionBox(b,_,[{name:"Yes",onclick:y},{name:"No",onclick:function(){for(var e=0;e<c.length;e++)l.isRemark(c[e])?l.setRemarkStyle(l.node_map[c[e]],l.task_map[c[e]]):l.setStyle(l.node_map[c[e]],"",1);r&&r(!1)}}],"msg_confirm")}else console.log("no selection in the tree:deleteJob")},JobTree.prototype.closeAllJobDialogs=function(){for(var e in this.dlg_map)this.dlg_map[e].delete();this.dlg_map={}},JobTree.prototype.getJobDialogTaskParameters=function(){var e,t=[];for(e in this.dlg_map){var i=this.dlg_map[e];t.push({id:i.task.id,job_dialog_data:i.task.job_dialog_data})}return t},JobTree.prototype.openJobs=function(e,t){if(0<e.length){for(var i=this.getSelectedNodeId(),o=0;o<e.length;o++){this.selectSingleById(this.getTaskNodeId(e[o].id));var n=this.task_map[this.getSelectedNodeId()];n&&n.id==e[o].id&&(n.job_dialog_data=e[o].job_dialog_data,this.openJob(null,t))}this.selectSingleById(i)}},JobTree.prototype.relinkJobDialogs=function(e,t){var i,o=this.getSelectedNodeId();for(i in e){var n=this.getTaskNodeId(i),s=e[i];n?this.task_map[n].state!=s.task.state?(this.selectSingleById(n),s.close(),this.task_map[n].job_dialog_data=s.task.job_dialog_data,this.openJob(null,t)):(s.tree=this,s.nodeId=n,this.task_map[n]=s.task,s.parent_page=t,this.dlg_map[i]=s):s.close()}this.selectSingleById(o)},JobTree.prototype.stopJob=function(e,t,i){this.forceSingleSelection();var o=this.makeNodeId(this.task_map[this.selected_node_id].id),n={},s="",a=e,s=e?"this":(a=this.selected_node_id,"selected"),r=(n.meta=this.task_map[a],n.job_token=n.meta.job_dialog_data.job_token,n.gracefully=t,[]),r=t?["End Job","End "+s+" job "+o+"? Ending job may take long time, but obtained results<br>(if any) will be made available for subsequent jobs.<br>Once a job is ended, it cannot be resumed.","End","Job "+o+" is being ended"]:["Stop Job","Stop "+s+" job "+o+"? Once a job is stopped, it cannot be resumed,<br>and no output data (even already obtained) can be<br>passed on subsequent jobs.","Stop","Job "+o+" is being stopped"];n.meta.state==job_code.running||n.meta.state==job_code.ending&&!t?(new QuestionBox(r[0],r[1],[{name:r[2],onclick:function(){n.meta.state=t?job_code.ending:job_code.exiting,"client"==n.meta.nc_type?localCommand(nc_command.stopJob,n,n.meta.title,null):serverRequest(fe_reqtype.stopJob,n,n.meta.title,null,null,null),setTimeout(function(){new MessageBox(r[3],r[3]+", please wait a while.","msg_information")},100),i&&i(1)}},{name:"Cancel",onclick:null}],"msg_confirm"),i&&i(0)):(n.meta.state==job_code.exiting?new MessageBox(r[0],"The job "+o+" is in exit state -- please wait.","msg_information"):n.meta.state==job_code.ending?new MessageBox(r[0],"The job "+o+" is ending -- please wait.","msg_information"):new MessageBox(r[0],"The job "+o+" is not running -- nothing to do.","msg_information"),a in this.node_map&&this.node_map[a].setCustomIconVisible(!1),"client"==n.meta.nc_type?localCommand(nc_command.stopJob,n,n.meta.title,null):serverRequest(fe_reqtype.stopJob,n,n.meta.title,null,null,null),i&&i(2))},JobTree.prototype.openJob=function(e,t){var i,o,n;this.selected_node_id?(this.forceSingleSelection(),this.selected_node_id in this.task_map&&(i=this.selected_node_id,(o=this.task_map[i]).id in this.dlg_map?$(this.dlg_map[o.id].element).dialog("open"):(e=(e=e)||(o.isComplete()?this.getTaskDataBox(o):this.harvestTaskData(2,o.harvestedTaskIds)),(n={}).tree=this,n.nodeId=i,n.dataBox=e,n.ancestors=this.getAllAncestors(o),this.dlg_map[o.id]=new JobDialog(n,t,function(e){e.tree.run_map[e.task.id]=e.nodeId,e.tree.node_map[e.nodeId].setCustomIconVisible(!0),e.tree.setNodeName(e.nodeId,!1),e.tree.emitSignal(cofe_signals.jobStarted,{nodeId:e.nodeId,taskId:e.task.id}),e.tree.startTaskLoop()},function(e){e.tree.dlg_map=mapExcludeKey(e.tree.dlg_map,e.task.id)},function(t,e,i){switch(e){case job_dialog_reason.rename_node:t.job_edited=!0,t.tree.setNodeName(t.nodeId,!1);break;case job_dialog_reason.set_node_icon:t.job_edited=!0,t.tree.setNodeIcon(t.nodeId,!0);break;case job_dialog_reason.reset_node:t.tree.node_map[t.nodeId].setCustomIconVisible(!1),t.tree.resetNodeName(t.nodeId);break;case job_dialog_reason.select_node:t.tree.selectSingle(t.tree.node_map[t.nodeId]);break;case job_dialog_reason.stop_job:t.tree.stopJob(t.nodeId,!1,function(e){e&&(t.end_btn&&t.end_btn.setDisabled(!0),t.stop_btn.setDisabled(!0))});break;case job_dialog_reason.end_job:t.tree.stopJob(t.nodeId,!0,function(e){});break;case job_dialog_reason.tree_updated:t.tree.emitSignal(cofe_signals.treeUpdated,{});break;case job_dialog_reason.add_job:t.tree.selectSingle(t.tree.node_map[t.nodeId]),t.tree.addJob(!1,!1,t.parent_page,function(e){t.close()});break;case job_dialog_reason.clone_job:t.tree.selectSingle(t.tree.node_map[t.nodeId]),t.tree.cloneJob("clone",t.parent_page,function(){t.close()});break;case job_dialog_reason.run_job:t.tree.selectSingle(t.tree.node_map[t.nodeId]);var o=t.tree.harvestTaskData(1,[]),n=t.tree.getAllAncestors(t.tree.getSelectedTask());t.tree._copy_task_cloud_path(i,n),t.tree._copy_task_parameters(i,n),(2==o.getDataSummary(i).status||"DataRevision"in o.data&&1==o.data.DataRevision.length)&&(i.onJobDialogStart=function(e){e.run_btn.click()}),t.tree._add_job(!1,i,o,t.parent_page,function(e){t.close()})}}),this.emitSignal(cofe_signals.jobDialogOpened,{nodeId:i,taskId:o.id})))):console.log("no selection in the tree:openJob")},JobTree.prototype.isShared=function(){return!!this.projectData&&(0<Object.keys(this.projectData.desc.share).length||this.projectData.desc.autorun)},JobTree.prototype.cloneJob=function(cloneMode,parent_page,onAdd_func){if(!this.in_archive)if(this.selected_node_id){this.forceSingleSelection();var nodeId=this.selected_node_id,task0=this.task_map[nodeId],task=eval("new "+task0._type+"()");if(task0.version<task.currentVersion())new MessageBox("Cannot clone",'<div style="width:400px"><h2>This job cannot be cloned.</h2><p>The job was created with a lower version of '+appName()+' and cannot be cloned.<p>Please create the job as a new one, using "<i>Add Job</i>" button from the control bar.</div>',"msg_stop"),onAdd_func&&onAdd_func(-5);else{task.uname=task0.uname,task.uoname=task0.uoname,task.cloned_id=task0.id,task.autoRunId=task0.autoRunId,"autoRunId0"in task0?task.autoRunId0=task0.autoRunId0:0<task.autoRunId.length&&(task.autoRunId0=task0.autoRunId),task.autoRunName=task0.autoRunName,task.inputMode=task0.inputMode,task.nc_type=task0.nc_type,task.file_select=[];for(var i=0;i<task0.file_select.length;i++)task.file_select.push($.extend(!0,{},task0.file_select[i]));task.input_ligands=[];for(var i=0;i<task0.input_ligands.length;i++)task.input_ligands.push($.extend(!0,{},task0.input_ligands[i]));task.input_data=$.extend(!0,{},task0.input_data),task.parameters=$.extend(!0,{},task0.parameters);for(var i=0,node;i<task0.harvestedTaskIds.length;i++)task.harvestedTaskIds.push(task0.harvestedTaskIds[i]);"file_system"in task0&&(task.file_system=task0.file_system,task.currentCloudPath=task0.currentCloudPath,"file_mod"in task0&&"cloud"==task.file_system&&(task.file_mod=task0.file_mod)),task.customDataClone(cloneMode,task0),task.project=this.projectData.desc.name,task.id=this.projectData.desc.jobCount+1,task.parentId=task0.parentId,task.submitter=__login_id,node="archive_version"in task0&&0<task0.archive_version?(node=this.addSiblingToSelected(__projectStyle("revision #"+this.projectData.desc.archive.version),image_path("project"),this.customIcon()),this.selectNode(node,!0),this.addNodeToSelected("",image_path(task.icon()),this.customIcon())):this.addSiblingToSelected("",image_path(task.icon()),this.customIcon()),task.isRemark()&&this.setRemarkStyle(node,task),this.task_map[node.id]=task,task.treeItemId=node.id,node.dataId=task.id,this.setText(node,this.makeNodeName(task)),this.saveProjectData([task],[],!0,function(e,t){e.checkReload(t,"add the job")&&(task.id=t.jobIds[0],node.dataId=task.id,e.projectData.desc.jobCount=task.id,e.setText(node,e.makeNodeName(task)),onAdd_func&&onAdd_func(0),e.openJob(null,parent_page),task.isRemark()&&e.setRemarkStyle(node,task))})}}else console.log("no selection in the tree:cloneJob"),onAdd_func&&onAdd_func(-6)},JobTree.prototype.setRemarkStyle=function(e,t){t.isLink()?this.setStyle(e,__linkStyle,0):this.setStyle(e,__remarkStyle,0)},JobTree.prototype.harvestTaskData=function(e,t){var i=new DataBox;if(i.inp_assoc={},i.harvestedTaskIds=[],0<t.length){var o,n=null;2==e&&(o=this.calcSelectedNodeIds()).length<=1&&(n=new DataBox).addTaskInputData(this.task_map[this.selected_node_id],!0);for(var s=0;s<t.length;s++)for(var a in this.task_map){var r=this.task_map[a];if(r.id==t[s]){i.addTaskData(r,!1),i.harvestedTaskIds.push(r.id);break}}for(h in i.data_n0={},i.data)i.data_n0[h]=i.data[h].length;n&&(n.merge(i),i=n)}else if((o=this.calcSelectedNodeIds()).length<=1){var l=this.selected_node_id,a=l,n=null;switch(e){case 2:(n=new DataBox).addTaskInputData(this.task_map[a],!0),l=this.node_map[a].parentId;case 0:a=this.node_map[a].parentId}for(var c=[];a;){var d=this.node_map[a];if(0<d.fchildren.length)c.push([d,d.fchildren.length]);else if(a in this.task_map&&(i.addTaskData(this.task_map[a],a!=l||0<e),!("data_n0"in i)))for(var h in i.data_n0={},i.data)i.data_n0[h]=i.data[h].length;var u=c.length-1;u<0?a=d.parentId:(c[u][1]--,0<=c[u][1]?a=c[u][0].fchildren[c[u][1]].id:(a=c[u][0].parentId,c.pop()))}n&&(n.merge(i),i=n)}else{for(s=1;s<o.length;s++)o[s]==this.selected_node_id&&(o[s]=o[0],o[0]=this.selected_node_id);for(s=0;s<o.length;s++)o[s]in this.task_map&&(i.addTaskData(this.task_map[o[s]],!1),i.harvestedTaskIds.push(this.task_map[o[s]].id));for(h in i.data_n0={},i.data)i.data_n0[h]=i.data[h].length}return i},JobTree.prototype.getTaskDataBox=function(e){var t,i=new DataBox;for(t in i.inp_assoc={},i.harvestedTaskIds=e.harvestedTaskIds,i.addTaskInputData(e,!0),i.data_n0={},i.data)i.data_n0[t]=i.data[t].length;return i},JobTree.prototype.inspectData=function(jobId,dataType,dataId){var task=this.getTask(jobId);if(task){var td=task.output_data.data,td0=null,dtype;for(dtype in td)if(dtype==dataType){for(var tdr=td[dtype],i=0;i<tdr.length&&!td0;i++)tdr[i].dataId==dataId&&(td0=tdr[i]);if(td0)break}td0?(td0=$.extend(!0,eval("new "+dataType+"()"),td0),td0.inspectData(task)):new MessageBox("Data "+dataType.substr(4)+" ["+dataId+"] not found",'<div style="width:400px"><h3><i>Data '+dataType.substr(4)+" ["+dataId+"] not found in job "+jobId+"</i></h3><p>If job is still running, wait until it finishes and try again.","msg_excl_yellow")}else new MessageBox("Job "+jobId+" not found","Job "+jobId+" not found. This may be a bug, please contact "+appName()+" developer.","msg_error")},JobTree.prototype.getAllAncestors=function(e){if(!e)return[];for(var t=[e],i=this.getTaskNodeId(e.id),i=this.node_map[i].parentId;i;)i in this.task_map&&t.push(this.task_map[i]),i=this.node_map[i].parentId;return t},JobTree.prototype.getNonRemarkParent=function(e){if(!e)return[];for(var t=this.getTaskNodeId(e.id),t=this.node_map[t].parentId,i=null;t&&!i;)t in this.task_map&&(i=this.task_map[t]).isRemark()&&(i=null),t=this.node_map[t].parentId;return i},JobTree.prototype.getChildTasks=function(e){var t=[];if(e)for(var i=this.getChildNodes(e),o=0;o<i.length;o++){var n=this.getTaskByNodeId(i[o].id);n&&t.push(n)}return t},JobTree.prototype.addReplayTasks=function(replay_node_list,ref_node_list){this.stopTaskLoop();for(var newJobs=!1,i=0;i<replay_node_list.length;i++){var retcode=job_code.finished,task,retcode;if(replay_node_list[i].parentId&&(task=this.getTaskByNodeId(replay_node_list[i].id),retcode=task?task.state:job_code.failed),retcode==job_code.finished)for(var children=ref_node_list[i].children,j=0;j<children.length;j++){var ref_node=children[j],ref_task=this.ref_tree.getTaskByNodeId(ref_node.id),replay_task=(this.projectData.desc.jobCount=Math.max(this.projectData.desc.jobCount,ref_task.id),$.extend(eval("new "+ref_task._type+"()"),ref_task)),replay_node=(replay_task.state=job_code.new,replay_task.project=this.projectData.desc.name,this.addNode(replay_node_list[i],ref_node.text,ref_node.icon,this.customIcon()));this.task_map[replay_node.id]=replay_task,replay_task.treeItemId=replay_node.id,replay_node.dataId=replay_task.id,this.saveProjectData([replay_task],[],!0,function(e,t){t.reload<=0&&(replay_task.state=job_code.running,(t={}).meta=replay_task,t.ancestors=[],serverRequest(fe_reqtype.replayJob,t,replay_task.title,function(e){},null,null))})}}newJobs&&this.startTaskLoop()},JobTree.prototype.replayTree=function(s){this.ref_tree=s,this.stopTaskLoop(),this.checkLoop=!1;var e,t=[];for(e in this.task_map)t.push([this.task_map[e].id,this.task_map[e].disk_space]);this.task_map={},this.run_map={},this.dlg_map={},this.clear(),this.projectData.desc.jobCount=0,tree.saveProjectData([],t,!0,function(e,t){if(t.reload<=0){for(var i=[],o=0;o<s.root_nodes.length;o++){var n=s.root_nodes[o];i.push(e.addRootNode(n.text.replace("]",":replay]"),n.icon,e.customIcon()))}e.addReplayTasks(i,s.root_nodes)}})},Upload.prototype=Object.create(Widget.prototype),Upload.prototype.constructor=Upload,Upload.prototype.setUploadedFiles=function(e){this.new_files=[];for(var t=0;t<e.length;t++)this.upload_files.indexOf(e[t])<0&&(this.upload_files.push(e[t]),this.new_files.push(e[t]));if("fileListPanel"in this&&0<this.upload_files.length){this.fileListTitle.show();for(var i=this.upload_files[0],t=1;t<this.upload_files.length;t++)i+="<br>"+this.upload_files[t];this.fileListPanel.setText(i).show()}},UploadDialog.prototype=Object.create(Widget.prototype),UploadDialog.prototype.constructor=UploadDialog,DataBox.prototype.markNotEmpty=function(){this.isEmpty()&&(this.data.___=[1])},DataBox.prototype.isEmpty=function(){var e,t,i=!0;for(e in this.data)if("___"==e?i=!1:"undefined"!=this.data[e]&&0<this.data[e].length&&(isObject(t=this.data[e][0])&&t.hasSubtype("proxy")||(i=!1)),!i)break;return i},DataBox.prototype.merge=function(i){for(var e in this.mergeIds=function(e){if(e in i)if(e in this)for(var t=0;t<i[e].length;t++)this[e].indexOf(i[e][t])<0&&this[e].push(i[e][t]);else this[e]=i[e]},i.data)if(e in this.data)for(var t=this.data[e],o=i.data[e],n=0;n<o.length;n++){for(var s=!1,a=0;a<t.length&&!s;a++)s=t[a].dataId==o[n].dataId;s||t.push(o[n])}else this.data[e]=i.data[e];for(var r in this.mergeIds("jobs"),this.mergeIds("inp_assoc"),i)r in this||(this[r]=i[r])},DataBox.prototype.extendData=function(){for(var e in this.data)for(var t=0;t<this.data[e].length;t++)"object"==typeof this.data[e][t]&&null!==this.data[e][t]&&(this.data[e][t]=this.data[e][t].extend())},DataBox.prototype._add_assoc_data=function(e){var t=e.input_data.data;if("inp_assoc"in this)for(var i in t){i in this.inp_assoc||(this.inp_assoc[i]=[]);for(var o=0;o<t[i].length;o++)this.inp_assoc[i].indexOf(t[i][o].dataId)<0&&this.inp_assoc[i].push(t[i][o].dataId)}},DataBox.prototype.addTaskData=function(e,t){var i,o=e.output_data.data;for(i in this.jobs.indexOf(e.id)<0&&this.jobs.push(e.id),o)if(i in this.data||(this.data[i]=[]),this.data[i].length<=0||o[i][0].backtrace)for(var n=0;n<o[i].length;n++){for(var s=o[i][n],a=!1,r=0;r<this.data[i].length&&!a;r++)a=this.data[i][r].dataId==s.dataId;a||this.data[i].push(s)}t?this.addTaskInputData(e,!1):this._add_assoc_data(e)},DataBox.prototype.addTaskInputData=function(e,t){e.output_data.data;var i,o=e.input_data.data;for(i in this.jobs.indexOf(e.id)<0&&this.jobs.push(e.id),o)if(!startsWith(i,"void"))for(var n=0;n<o[i].length;n++){var s=o[i][n];if(null!==s&&"object"==typeof s){var a=s._type;if(a in this.data){if(t)this.data[a].push(s);else if(s.backtrace){for(var r=!1,l=0;l<this.data[a].length&&!r;l++)r=this.data[a][l].dataId==s.dataId;r||this.data[a].push(s)}}else this.data[a]=[s]}}this._add_assoc_data(e)},DataBox.prototype.addData=function(e){var t;e&&((t=e._type)in this.data||(this.data[t]=[]),this.data[t].push(e))},DataBox.prototype.addCustomData=function(e,t){e in this.data||(this.data[e]=[]),this.data[e].push(t)},DataBox.prototype.getDataIds=function(e){var t=[];if(e){if(e in this.data)for(var i=0;i<this.data[e].length;i++)t.push(this.data[e][i].dataId)}else for(var o in this.data)for(i=0;i<this.data[o].length;i++)t.push(this.data[o][i].dataId);return t},DataBox.prototype.getData=function(e){return e in this.data?this.data[e]:[]},DataBox.prototype.compareSubtypes=function(e,t){var i=!1,o=e.length;if(o<=0)i=!0;else{var n=t.subtype,s=-1;"leadKey"in t&&(s=t.leadKey);for(var a=0;a<o;a++)if(e[a].constructor===Array){for(var i=!1,r=0;r<e[a].length&&!i;r++)i=0<=n.indexOf(e[a][r])||"EP"==e[a][r]&&2==s||"MR"==e[a][r]&&1==s;if(!i)break}else if(startsWith(e[a],"!")){var l=e[a].substr(1);if(!(i=0<=n.indexOf(l)||"EP"==l&&2==s||"MR"==l&&1==s))break}else if(startsWith(e[a],"~")){l=e[a].substr(1);if(!(i=n.indexOf(l)<0&&("EP"!=l||2!=s)&&("MR"!=l||1!=s)))break}else(0<=n.indexOf(e[a])||"EP"==e[a]&&2==s||"MR"==e[a]&&1==s)&&(i=!0)}return i},DataBox.prototype.getDataSummary=function(e){var t={status:2};if(e.getInputMode()==input_mode.root){var i=0;for(s in this.data)"undefined"!=s&&(i+=this.data[s].length);0<i&&(t.status=0)}else{for(var o,n=0;n<e.input_dtypes.length;n++){var s,a=0,r=e.input_dtypes[n],l=r.data_type,c="",d="",h=(r.hasOwnProperty("desc")&&(d=r.desc),[]),u={};for(s in l){if(u[s]=l[s],s in this.data){var p=l[s],m=this.data[s];if(p.length<=0)a+=m.length;else for(var f=0;f<m.length;f++)this.compareSubtypes(p,m[f])&&a++}var g=getObjectInstance('{ "_type" : "'+s+'" }');if(c&&(c+=" <i>or</i><br>"),c+=g?g.title():s,0<l[s].length){c+=" (";for(f=0;f<l[s].length;f++)0<f&&(c+=","),l[s][f].constructor==Array?c+=l[s][f].join("|"):c+=l[s][f];c+=")"}h=h.concat(g.dataDialogHints(l[s],r.max))}var _=r.min,b=r.max,y=(c in t&&(_=Math.max(_,t[c].n_required),b=Math.min(b,t[c].n_allowed)),2);a<_||r.max<=0&&0<a?y=0:_<a&&(y=1),t[c]=e.addDataDialogHints(r,{status:y,n_available:a,n_required:_,n_allowed:b,hints:h,dtypes:u,desc:d})}for(o in t)"status"!=o&&(t.status=Math.min(t.status,t[o].status))}return t},"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.DataBox=DataBox);var file_key={xyz:"xyz",mmcif:"mmcif",sol:"sol",sub:"sub",seq:"seq",mtz:"mtz",map:"map",dmap:"dmap",lib:"lib",coot:"coot",molp:"molp",hhr:"hhr",borges:"borges"};function DataTemplate(){this._type="DataTemplate",this.version=this.currentVersion(),this.subtype=[],this.jobId="",this.dataId="",this.dname="template",this.files={},this.associated=[],this.backtrace=!0,this.citations=[]}DataTemplate.prototype.title=function(){return"Template Data"},DataTemplate.prototype.icon=function(){return"data"},DataTemplate.prototype.currentVersion=function(){return 2},"undefined"!=typeof module&&void 0!==module.exports?(module.exports.DataTemplate=DataTemplate,module.exports.file_key=file_key):(DataTemplate.prototype.extend=function(){return $.extend(!0,{},this)},DataTemplate.prototype.hasSubtype=function(e){return 0<=this.subtype.indexOf(e)},DataTemplate.prototype.setSubtype=function(e){this.subtype=[e]},DataTemplate.prototype.addSubtype=function(e){this.subtype.indexOf(e)<0&&this.subtype.push(e)},DataTemplate.prototype.cast=function(newTypeName){var ext_class=this.extend(),new_class,cst_class;return startsWith(newTypeName,"Data")&&newTypeName!=this._type?(new_class=eval("new "+newTypeName+"()"),cst_class=$.extend(!0,new_class,ext_class),cst_class._type=new_class._type,cst_class):ext_class},DataTemplate.prototype.layCustomDropdownInput=function(e){},DataTemplate.prototype.makeDataSummaryPage=function(e){return new DataSummaryPage(this)},DataTemplate.prototype.inspectData=function(e){new DataInspectDialog(this.makeDataSummaryPage(e),this.dname,"800px","700px").launch()},DataTemplate.prototype.collectCustomDropdownInput=function(e){return""},DataTemplate.prototype.dataDialogHints=function(e,t){return[]},DataTemplate.prototype.subtypeDescription=function(e){switch(e){case"anomalous":return"anomalous signal";case"protein":return"protein sequence(s)";case"unknown":return"unknown";case"rna":return"RNA sequence(s)";case"dna":return"DNA sequence(s)";case"xyz":return"macromolecular model(s)";case"seq":return"macromolecular sequence(s)";case"substructure":return"heavy atom substructure";case"phases":return"phases"}return""},DataTemplate.prototype.ddesc_bridge_word=function(){return", containing "},DataTemplate.prototype.getSubtypeDescription=function(e){var i=[],o=[];if(this.get_item=function(e){var t;0<=["!","~"].indexOf(e[0])?(t=this.subtypeDescription(e.substring(1)))&&("!"==e[0]?i:o).push(t):(t=this.subtypeDescription(e))&&i.push(" "+t)},e.constructor==Array)for(var t=0;t<e.length;t++)this.get_item(e[t]);else this.get_item(e);var n="",s=i.length+o.length;if(1==s)n=1==i.length?i[0]:"no "+o[0];else if(1<s){for(var n='at least one of<ul style="margin:0;">',a=0;a<i.length;a++)n+="<li>"+i[a].trim()+"</li>";for(a=0;a<o.length;a++)n+="<li>no "+o[a]+"</li>";n+="</ul>"}return n});var __template=null;function DataAlignment(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataAlignment",this.alignment_type="",this.align_meta={type:"unknown",msg:"Not parsed",hits:[]},this.hitlist=""}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),DataAlignment.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataAlignment.prototype.constructor=DataAlignment,DataAlignment.prototype.title=function(){return"Alignment data"},DataAlignment.prototype.icon=function(){return"data_alignment"},DataAlignment.prototype.currentVersion=function(){return __template?0+__template.DataTemplate.prototype.currentVersion.call(this):0+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataAlignment=DataAlignment:(DataAlignment.prototype.makeDataSummaryPage=function(e){var t=new DataSummaryPage(this);return t.makeRow("File name",this.files[file_key.hhr],"Imported file name"),t.makeRow("Alignment type",this.alignment_type,"Aligment type or source"),t.makeRow("Hits",this.align_meta.hits.length,"Number of hits"),t},DataAlignment.prototype.layCustomDropdownInput=function(e){var e=e.customGrid,t=(e.setLabel("Hits:",0,0,1,1).setFontItalic(!0).setWidth("50px"),e.setVerticalAlignment(0,0,"middle"),"Available hits: 1-"+this.align_meta.hits.length);e.hitlist=e.setInputText(this.hitlist,0,1,1,1).setTooltip1(t,"slideDown",!0,5e3).setWidth("440px"),e.setCellSize("50px","",0,0),e.setLabel(" ",1,0,1,2).setHeight_px(8)},DataAlignment.prototype.collectCustomDropdownInput=function(e){var t="",e=e.customGrid,i=(this.hitlist=e.hitlist.getValue().trim(),0==this.hitlist.length);if(!i&&(i=/^\s*(\d+\s*(-\s*\d+\s*)?(,\s*\d+\s*(-\s*\d+\s*)?)*)?$/.test(this.hitlist))){var o=this.hitlist.replace(/[, \-]+/g,",").split(","),e=o.slice(0);if(e.sort(function(e,t){return e-t}),i=o.toString()==e.toString())for(var n,s=o[0],a=1;a<o.length;a++)n=s,s=o[a],i=i&&n!=s}return t=i?t:"|<b><i>Incorrect hit selection:</i>&nbsp;"+this.hitlist+"</b><br><br>An example of a correct selection:<br>1-101, 110, 111, 112, 121-222<br>"});var __template=null;function DataBorges(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataBorges"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),DataBorges.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataBorges.prototype.constructor=DataBorges,DataBorges.prototype.title=function(){return"Borges library"},DataBorges.prototype.icon=function(){return"data"},DataBorges.prototype.currentVersion=function(){return __template?0+__template.DataTemplate.prototype.currentVersion.call(this):0+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataBorges=DataBorges:DataBorges.prototype.makeDataSummaryPage=function(e){var t=new DataSummaryPage(this);return t.makeRow("File name",this.files[file_key.borges],"Imported file name"),t};var __template=null,_agents;function DataXYZ(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataXYZ",this.xyzmeta={},this.exclLigs=["(agents)"],this.chainSel="",this.chainSelType="",this.BF_correction="none",this.coot_meta=null}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),DataXYZ.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataXYZ.prototype.constructor=DataXYZ,DataXYZ.prototype.title=function(){return"Structure Model"},DataXYZ.prototype.icon=function(){return"data"},DataXYZ.prototype.currentVersion=function(){return __template?0+__template.DataTemplate.prototype.currentVersion.call(this):0+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataXYZ=DataXYZ:(DataXYZ.prototype.addToInspectData=function(e){var t;"BF_correction"in this&&"none"!=this.BF_correction&&(t=null,t="alphafold"==this.BF_correction?"AlphaFold":"Rosetta",e.makeRow("B-factor correction","Assuming "+t+" model","Model for B-factors re-calculation"),e.trow++)},DataXYZ.prototype.getSpaceGroup=function(){return"cryst"in this.xyzmeta&&0<this.xyzmeta.cryst.spaceGroup.length?this.xyzmeta.cryst.spaceGroup:"Unspecified"},DataXYZ.prototype.getCellParametersHTML=function(){return"cryst"in this.xyzmeta&&2<this.xyzmeta.cryst.a?this.xyzmeta.cryst.a+"&nbsp;&nbsp;"+this.xyzmeta.cryst.b+"&nbsp;&nbsp;"+this.xyzmeta.cryst.c+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+this.xyzmeta.cryst.alpha+"&nbsp;&nbsp;"+this.xyzmeta.cryst.beta+"&nbsp;&nbsp;"+this.xyzmeta.cryst.gamma:"Unspecified"},DataXYZ.prototype.getCellParameters=function(){return"cryst"in this.xyzmeta&&2<this.xyzmeta.cryst.a?[this.xyzmeta.cryst.a,this.xyzmeta.cryst.b,this.xyzmeta.cryst.c,this.xyzmeta.cryst.alpha,this.xyzmeta.cryst.beta,this.xyzmeta.cryst.gamma]:[0,0,0,0,0,0]},DataXYZ.prototype.inspectXYZData=function(e){"cryst"in this.xyzmeta&&0<this.xyzmeta.cryst.spaceGroup.length&&(e.makeRow("Space Group",this.xyzmeta.cryst.spaceGroup,"Space group"),e.makeRow("Cell parameters (a,b,c,&alpha;,&beta;,&gamma;)",this.getCellParametersHTML(),"Cell parameters"));var t=1,i=this.xyzmeta.xyz;if(i)for(var o=0;o<i.length;o++)t+=i[o].chains.length;if(e.table.setHeaderText("Contents",e.trow,0,t,1),e.table.setHorizontalAlignment(e.trow,0,"left"),e.table.setHeaderText("Model",e.trow,1,1,1),e.table.setHeaderText("Chain",e.trow,2,1,1),e.table.setHeaderText("Type",e.trow,3,1,1),e.table.setHeaderText("Size",e.trow,4,1,1),e.table.setLabel(" ",e.trow,5,t,1),e.table.setCellSize("90%","",e.trow,5),e.trow++,i)for(o=0;o<i.length;o++){var n=i[o],s=1;e.table.setLabel(n.model,e.trow,0,n.chains.length,1);for(var a=0;a<n.chains.length;a++)e.table.setLabel(n.chains[a].id,e.trow,s,1,1),e.table.setLabel(n.chains[a].type,e.trow,s+1,1,1),e.table.setLabel(n.chains[a].size,e.trow,s+2,1,1),s=0,e.trow++}},DataXYZ.prototype.makeDataSummaryPage=function(e){var t=new DataSummaryPage(this);if("DataStructure"==this._type)this.files.hasOwnProperty(file_key.xyz)?t.makeRow("XYZ file name",this.files[file_key.xyz],"Name of file with XYZ coordinates"):this.files.hasOwnProperty(file_key.sub)&&t.makeRow("HA-XYZ file",this.files[file_key.sub],"Heavy atom (substructure) file name"),file_key.mmcif in this.files&&t.makeRow("mmCIF file name",this.files[file_key.mmcif],"Name of file with XYZ coordinates in mmCIF (deposition) format");else for(var i in this.files)this.files.hasOwnProperty(i)&&t.makeRow("File name",this.files[i],"Imported file name");return this.coot_meta&&t.makeRow("Coot state","present","Coot scripts with custom settings or data"),this.inspectXYZData(t),this.addToInspectData(t),t.addUglyMolButton(e),t},_agents=["BE7","MRD","MHA","BU3","EDO","PGO","BU2","PDO","BU1","PG6","1BO","PE7","PG5","TFP","DHD","PEU","TRS","TAU","SBT","SAL","MPD","IOH","IPA","PGE","PIG","B3P","BTB","NHE","C8E","OTE","PE4","XPE","PE8","P33","N8E","2OS","1PS","CPS","DMX","MPO","GCD","IDT","DXG","CM5","ACA","ACT","ACN","CCN","AGC","GLC","MAN","DR6","NH4","AZI","BNG","BOG","LAK","BGC","BMA","BCN","BRO","CAC","CBX","FMT","ACY","CBM","CLO","FCL","CIT","3CO","NCO","CU1","CYN","MA4","BTC","CYS","TAR","GLO","MTL","DPR","SOR","SYL","DMU","DDQ","DMS","DMF","DIO","DOX","12P","SDS","LMT","EOH","EEE","EDO","EGL","FLO","TRT","FCY","FRU","GBL","GLC","GLY","GPX","HTO","HTG","B7G","C10","16D","HEZ","IOD","IDO","IOD","ICI","ICT","IPA","TLA","LAT","LBT","LDA","MN3","MRY","MOH","BEQ","C15","MG8","POL","NO3","JEF","P4C","CE1","DIA","CXE","IPH","PIN","15P","CRY","GOL","PGR","PGO","PGQ","SPD","SPK","SPM","SUC","SO4","SUL","TBU","TMA","TEP","SCN","TRE","PGE","ETF","144","UMQ","URE","YT3","ZN2","FE2","3NI","AL","BA","BR","CD","CA","CM","CS","CL","CO","CU","CN","FE","PB","LI","MG","MN","HG","NI","RB","AG","NA","SR","Y1","ZN","F","K"],DataXYZ.prototype.getChainList=function(){var e=this.xyzmeta.xyz,t=[];if(e)for(var i=0;i<e.length;i++)for(var o=e[i].chains,n=0;n<o.length;n++){var s={};s.id=o[n].id,s.model=e[i].model,s.type=o[n].type,1<e.length?s.fullId="/"+e[i].model+"/"+o[n].id:s.fullId=o[n].id,s.label=s.fullId+" ("+o[n].type.toLowerCase()+")",t.push(s)}return t},DataXYZ.prototype.layCustomDropdownInput=function(e){var i=e.customGrid;if("cell-info"==e.layCustom)i.setLabel("Space group:&nbsp;",0,0,1,1).setFontItalic(!0).setNoWrap(),i.setLabel(this.getSpaceGroup(),0,1,1,1).setNoWrap(),i.setLabel("Cell&nbsp;(a,b,c,&alpha;,&beta;,&gamma;):&nbsp;",1,0,1,1).setFontItalic(!0),i.setLabel(this.getCellParametersHTML(),1,1,1,2),i.setLabel(" ",2,0,1,1).setHeight_px(8);else if("pisa"==e.layCustom){if(0<this.xyzmeta.ligands.length){if(0<=this.exclLigs.indexOf("(agents)")){this.exclLigs=[];for(var t=0;t<this.xyzmeta.ligands.length;t++)0<=_agents.indexOf(this.xyzmeta.ligands[t])&&this.exclLigs.push(this.xyzmeta.ligands[t])}i.setLabel("Uncheck ligands that are not part of biochemical system:",0,0,1,7).setFontItalic(!0).setNoWrap(),i.cbxs=[];for(var o=1,n=0,t=0;t<this.xyzmeta.ligands.length;t++)6<=n&&(n=0,o++),i.cbxs.push(i.setCheckbox(this.xyzmeta.ligands[t],this.exclLigs.indexOf(this.xyzmeta.ligands[t])<0,o,n,1,1).setWidth_px(50)),i.setCellSize("50px","",o,n++);for(;n<6;)i.setLabel(" ",o,n++,1,1).setWidth("50px")}}else if(startsWith(e.layCustom,"chain-sel")){var s=this.xyzmeta.xyz,a=[],r=[];if(s)for(t=0;t<s.length;t++)for(var l,c=s[t].chains,d=0;d<c.length;d++)("chain-sel"==e.layCustom||"chain-sel-protein"==e.layCustom&&"Protein"==c[d].type||("chain-sel-poly"==e.layCustom||"chain-sel-poly-2"==e.layCustom)&&0<=["Protein","DNA","RNA","NA"].indexOf(c[d].type))&&(l=c[d].id,1<s.length&&(l="/"+s[t].model+"/"+l),a.push(l+" ("+c[d].type.toLowerCase()+")"),r.push(l),this.chainSel||(this.chainSel=l));if("chain-sel-poly-2"==e.layCustom){if(r.length<1)i.setLabel("No suitable chains found",0,0,1,1).setFontItalic(!0).setFontColor("maroon").setNoWrap(),this.chainSel2="";else if(1==r.length)i.setLabel("Single-chain structure, unsuitable",0,0,1,1).setFontItalic(!0).setFontColor("maroon").setNoWrap(),this.chainSel2="";else{if(!("chainSel2"in this&&this.chainSel2)){this.chainSel2="";for(d=0;d<r.length&&!this.chainSel2;d++)r[d]!=this.chainSel&&(this.chainSel2=r[d])}i.setLabel("1<sup>st</sup> chain:&nbsp;",0,0,1,1).setFontItalic(!0).setNoWrap(),i.setVerticalAlignment(0,0,"middle"),i.setLabel("2<sup>nd</sup> chain:&nbsp;",1,0,1,1).setFontItalic(!0).setNoWrap(),i.setVerticalAlignment(1,0,"middle"),i.chainSel=new Dropdown,i.chainSel.setWidth("160px"),i.chainSel2=new Dropdown,i.chainSel2.setWidth("160px");for(d=0;d<a.length;d++)i.chainSel.addItem(a[d],"",r[d],this.chainSel==r[d]),i.chainSel2.addItem(a[d],"",r[d],this.chainSel2==r[d]);i.setWidget(i.chainSel,0,1,1,2),i.chainSel.make(),i.setWidget(i.chainSel2,1,1,1,2),i.chainSel2.make();var h=this;i.chainSel.addOnChangeListener(function(e,t){t==h.chainSel2?(i.chainSel.selectItem(h.chainSel),new MessageBox("Duplicate selection","<h2>Duplicate chain selection</h2>Selected chains must be different.","msg_stop")):h.chainSel=t}),i.chainSel2.addOnChangeListener(function(e,t){t==h.chainSel?(i.chainSel2.selectItem(h.chainSel2),new MessageBox("Duplicate selection","<h2>Duplicate chain selection</h2>Selected chains must be different.","msg_stop")):h.chainSel2=t})}i.setLabel(" ",2,0,1,2).setHeight_px(8)}else{a.length<1&&(a.unshift("No suitable chains found"),r.unshift("(none)")),i.setLabel("Select chain:&nbsp;",0,0,1,1).setFontItalic(!0).setNoWrap(),i.setVerticalAlignment(0,0,"middle"),i.chainSel=new Dropdown,i.chainSel.setWidth("160px");for(d=0;d<a.length;d++)i.chainSel.addItem(a[d],"",r[d],this.chainSel==r[d]);i.setWidget(i.chainSel,0,1,1,2),i.chainSel.make(),i.setLabel(" ",1,0,1,2).setHeight_px(8)}}else"texteditor"==e.layCustom&&i.setLabel("&nbsp;",0,0,1,1).setFontItalic(!0).setNoWrap().setHeight_px(34)},DataXYZ.prototype.collectCustomDropdownInput=function(e){var t,i=e.customGrid;if("pisa"==e.layCustom){this.exclLigs=[];for(var o=0;o<this.xyzmeta.ligands.length;o++)i.cbxs[o].getValue()||this.exclLigs.push(this.xyzmeta.ligands[o])}else startsWith(e.layCustom,"chain-sel")&&"chainSel"in i&&(this.chainSel=i.chainSel.getValue(),1<(t=i.chainSel.getText().replace("(","").replace(")","").split(" ")).length?this.chainSelType=t[1]:this.chainSelType="","chain-sel-poly-2"==e.layCustom&&(this.chainSel2=i.chainSel2.getValue(),1<(t=i.chainSel2.getText().replace("(","").replace(")","").split(" ")).length?this.chainSel2Type=t[1]:this.chainSel2Type=""));return""},DataXYZ.prototype.subtypeDescription=function(e){switch(e){case"protein":return"protein chain(s)";case"rna":return"RNA chain(s)";case"dna":return"DNA chain(s)";case"na":return"DNA/RNA chain(s)";case"lig":return"Ligand chain(s)"}return DataTemplate.prototype.subtypeDescription.call(this,e)});var __template=null,model_subtype=("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.xyz")),{sequnk:"sequnk"});function DataModel(){(__template?__template.DataXYZ:DataXYZ).call(this),this._type="DataModel",this.sequence=null,this.ncopies=1,this.nModels=1,this.simtype="seqid",this.rmsd="",this.seqId="",this.xyzmeta={},this.seqrem=!1,this.meta=null}DataModel.prototype=__template?Object.create(__template.DataXYZ.prototype):Object.create(DataXYZ.prototype),DataModel.prototype.constructor=DataModel,DataModel.prototype.title=function(){return"MR model"},DataModel.prototype.currentVersion=function(){return __template?1+__template.DataXYZ.prototype.currentVersion.call(this):1+DataXYZ.prototype.currentVersion.call(this)},DataModel.prototype.icon=function(){return"data"},__template?module.exports.DataModel=DataModel:(DataModel.prototype.extend=function(){var e=$.extend(!0,{},this);return this.sequence&&(e.sequence=this.sequence.extend()),e},DataModel.prototype.addToInspectData=function(e){var t;return this.sequence&&(e.makeRow("Associated sequence",this.sequence.dname,"Associated sequence"),e.trow++),this.meta&&(1<this.nModels?("seqrem"in this&&this.seqrem&&(e.makeRow("Model(s) seq.Id(s) %",this.meta.seqId_ens.join(", "),"Sequence Ids for models in model"),e.trow++),e.table.setHeaderText("Alignment",e.trow,0,2,1),e.table.setHorizontalAlignment(e.trow,0,"left"),e.table.setHeaderText("Q-score",e.trow,1,1,1),e.table.setHeaderText("R.m.s.d.",e.trow,2,1,1),e.table.setHeaderText("N<sub>align</sub>",e.trow,3,1,1),e.table.setLabel(" ",e.trow,4,2,2),e.table.setCellSize("90%","",e.trow,4),e.trow++,e.table.setLabel(this.meta.qscore,e.trow,0,1,1),e.table.setLabel(this.meta.rmsd,e.trow,1,1,1),e.table.setLabel(this.meta.nalign,e.trow,2,1,1),e.trow++):this.meta.seqId&&(e.table.setHeaderText("Scores",e.trow,0,2,1),e.table.setHorizontalAlignment(e.trow,0,"left"),t=1,this.meta.eLLG&&(e.table.setHeaderText("eLLG",e.trow,t,1,1),e.table.setLabel(this.meta.eLLG,e.trow+1,t-1,1,1),t++),e.table.setHeaderText("Seq. Id",e.trow,t,1,1),e.table.setLabel(this.meta.seqId,e.trow+1,t-1,1,1),t++,this.meta.rmsd&&(e.table.setHeaderText("R.M.S.D.",e.trow,t,1,1),e.table.setLabel(this.meta.rmsd,e.trow+1,t-1,1,1),t++),e.trow+=2)),e.trow},DataModel.prototype.layCustomDropdownInput=function(e){var t,i=e.customGrid,o=0;function n(e){i.setLabel("Sequence:",o,0,1,1).setFontItalic(!0).setWidth("70px"),i.setLabel("&nbsp;"+e,o,1,1,3).setNoWrap(),i.setVerticalAlignment(o,0,"middle"),i.setVerticalAlignment(o,1,"middle"),i.setCellSize("","24px",o++,0)}startsWith(e.layCustom,"model")?(this.sequence?n(this.sequence.dname):n((t=this.getChainList().length)<2?"not associated":"complex of "+t+" chains"),i.setLabel(" ",o,0,1,2).setHeight_px(8)):startsWith(e.layCustom,"chain-sel")?DataXYZ.prototype.layCustomDropdownInput.call(this,e):startsWith(e.layCustom,"phaser-mr")&&(this.sequence?n(this.sequence.dname):n((t=this.getChainList().length)<2?"not associated":"complex of "+t+" chains"),i.setLabel("Look for",o,0,1,1).setFontItalic(!0).setNoWrap(),i.ncopies=i.setInputText(this.ncopies,o,1,1,1).setStyle("text","integer","","Specify the number of model copies to look for in asymmetric unit").setWidth_px(50),i.setLabel("copies in ASU",o,2,1,1).setFontItalic(!0).setNoWrap(),i.setVerticalAlignment(o,0,"middle"),i.setVerticalAlignment(o++,2,"middle"),i.setLabel("Similarity to target",o,0,1,2).setFontItalic(!0).setNoWrap(),i.simtype=new Dropdown,i.simtype.setWidth("230px"),"seqrem"in this&&this.seqrem&&i.simtype.addItem("read from model","","cardon","cardon"==this.simtype),i.simtype.addItem("by sequence identity","","seqid","seqid"==this.simtype),i.simtype.addItem("by rms difference (&Aring;)","","rmsd","rmsd"==this.simtype),i.setWidget(i.simtype,o,1,1,1),i.setCellSize("240px","",0,1),i.simtype.make(),i.rmsd=i.setInputText(this.rmsd,o,2,1,1).setStyle("text","real","","Specify the measure of dispersion (in angstroms) for model").setWidth_px(50),i.seqid=i.addInputText(this.seqId,o,2,1,1).setStyle("text","real","","Specify sequence identity between target sequence and model structure between 0-1.").setWidth_px(50),i.rmsd.setVisible("rmsd"==this.simtype),i.seqid.setVisible("seqid"==this.simtype),i.setVerticalAlignment(o,0,"middle"),i.setVerticalAlignment(o++,2,"middle"),i.simtype.addOnChangeListener(function(e,t){i.rmsd.setVisible("rmsd"==t),i.seqid.setVisible("seqid"==t)}),o++,i.setLabel(" ",o,0,1,2).setHeight_px(8))},DataModel.prototype.collectCustomDropdownInput=function(e){var t,i="",o=e.customGrid;return startsWith(e.layCustom,"phaser-mr")?(this.ncopies=parseInt(o.ncopies.getValue()),this.simtype=o.simtype.getValue(),"seqid"==this.simtype?(t=o.seqid.getValue())&&!isNaN(t)?this.seqId=parseFloat(t):i+="|<b><i>Sequence Identity not given or poorly formatted</i></b>":"rmsd"==this.simtype&&((t=o.rmsd.getValue())&&!isNaN(t)?this.rmsd=parseFloat(t):i+="|<b><i>RMS difference not given or poorly formatted</i></b>")):startsWith(e.layCustom,"chain-sel")&&(i=DataXYZ.prototype.collectCustomDropdownInput.call(this,e)),i},DataModel.prototype.dataDialogHints=function(e,t){return['MR model is missing. Use a suitable <i>"Model preparation"</i> task to create one.',"Have you imported a PDB or mmCIF file with coordinates and wonder why, instead, a <i>\"Model\"</i> data type is required for a Molecular Replacement task? <a href=\"javascript:launchHelpBox('XYZs, Models and Ensembles','"+__user_guide_base_url+"/jscofe_qna.xyz_model_ensemble.html',null,10)\"><i>"+String("Check here").fontcolor("blue")+"</i></a>."]});var __template=null;function DataEnsemble(){(__template?__template.DataModel:DataModel).call(this),this._type="DataEnsemble"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.model")),DataEnsemble.prototype=__template?Object.create(__template.DataModel.prototype):Object.create(DataModel.prototype),DataEnsemble.prototype.constructor=DataEnsemble,DataEnsemble.prototype.title=function(){return"MR ensemble"},DataEnsemble.prototype.currentVersion=function(){return __template?0+__template.DataModel.prototype.currentVersion.call(this):0+DataModel.prototype.currentVersion.call(this)},DataEnsemble.prototype.icon=function(){return"data"},__template?module.exports.DataEnsemble=DataEnsemble:(DataEnsemble.prototype.extend=function(){var e=$.extend(!0,{},this);return this.sequence&&(e.sequence=this.sequence.extend()),e},DataEnsemble.prototype.dataDialogHints=function(e,t){return['An ensemble of MR models is missing. Use a suitable <i>"Ensemble preparation"</i> task to create one.',"Have you imported a PDB or mmCIF file with coordinates and wonder why, instead, an <i>\"Ensemble\"</i> data type is required for a Molecular Replacement task? <a href=\"javascript:launchHelpBox('XYZ, Models and Ensembles','"+__user_guide_base_url+"/jscofe_qna.xyz_model_ensemble.html',null,10)\"><i>"+String("Check here").fontcolor("blue")+"</i></a>."]});var __template=null,hkl_subtype=("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),{regular:"regular",anomalous:"anomalous"});function DataHKL(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataHKL",this.wtype="choose-one",this.ha_type="",this.f_use_mode="NO",this.f1="",this.f11="",this.res_low="",this.res_high="",this.res_ref="",this.wavelength="",this.useForPhasing=!1,this.new_spg="",this.spg_alt="ALL",this.freeRds=null,this.useHKLSet="F",this.detwin=!1,this.dataStats=null,this.aimless_meta={jobId:0,file_xml:null,file_unm:null}}DataHKL.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataHKL.prototype.constructor=DataHKL,DataHKL.prototype.title=function(){return"Reflection Data"},DataHKL.prototype.icon=function(){return"data"},DataHKL.prototype.currentVersion=function(){return __template?1+__template.DataTemplate.prototype.currentVersion.call(this):1+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataHKL=DataHKL:(DataHKL.prototype.getMeta=function(e,t){for(var i=e.split("."),o=this.dataset,n=0;n<i.length;n++){if(!(i[n]in o))return t;o=o[i[n]]}return o},DataHKL.prototype.getSpaceGroup=function(){return this.getMeta("HM","Unspecified")},DataHKL.prototype.getCellParametersHTML=function(){var e="Not specified";return e="*"!=this.dataset.DCELL?this.dataset.DCELL[0]+"&nbsp;&nbsp;"+this.dataset.DCELL[1]+"&nbsp;&nbsp;"+this.dataset.DCELL[2]+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+this.dataset.DCELL[3]+"&nbsp;&nbsp;"+this.dataset.DCELL[4]+"&nbsp;&nbsp;"+this.dataset.DCELL[5]:e},DataHKL.prototype.getCellParameters=function(){return"*"!=this.dataset.DCELL?this.dataset.DCELL:[0,0,0,0,0,0]},DataHKL.prototype.getLowResolution=function(){return this.dataset.RESO[0]},DataHKL.prototype.getHighResolution=function(){return this.dataset.RESO[1]},DataHKL.prototype.getWavelength=function(){return"DWAVEL"in this.dataset?this.dataset.DWAVEL:null},DataHKL.prototype.isImean=function(){return this.getMeta("Imean.value","")&&this.getMeta("Imean.sigma","")},DataHKL.prototype.isFmean=function(){return this.getMeta("Fmean.value","")&&this.getMeta("Fmean.sigma","")},DataHKL.prototype.isIpm=function(){return this.getMeta("Ipm.plus.value","")&&this.getMeta("Ipm.plus.sigma","")&&this.getMeta("Ipm.minus.value","")&&this.getMeta("Ipm.minus.sigma","")},DataHKL.prototype.isFpm=function(){return this.getMeta("Fpm.plus.value","")&&this.getMeta("Fpm.plus.sigma","")&&this.getMeta("Fpm.minus.value","")&&this.getMeta("Fpm.minus.sigma","")},DataHKL.prototype.hasAnomalousSignal=function(){return 0<=$.inArray("anomalous",this.subtype)},DataHKL.prototype.makeDataSummaryPage=function(e){var t=new DataSummaryPage(this),i=(t.makeRow("File name",this.files[file_key.mtz],"Imported file name"),t.makeRow("Original dataset name",this.dataset.PROJECT+"/"+this.dataset.CRYSTAL+"/"+this.dataset.DATASET,"Original dataset name"),t.makeRow("Wavelength",this.getWavelength(),"Wavelength"),t.makeRow("Space group",this.getSpaceGroup(),"Space symmetry group"),t.makeRow("Cell",this.getCellParametersHTML(),"Unit cell parameters"),t.makeRow("Resolution low",round(this.getLowResolution(),2),"Low resolution limit"),t.makeRow("Resolution high",round(this.getHighResolution(),2),"High resolution limit"),"Not present");return this.hasAnomalousSignal()&&(i="Present",this.ha_type&&(i+=" ("+this.ha_type+")")),t.makeRow("Anomalous scattering",i,"Presence of anomalous data"),t.makeRow("Columns",this.getMeta("Imean.value","")+" "+this.getMeta("Imean.sigma","")+" "+this.getMeta("Fmean.value","")+" "+this.getMeta("Fmean.sigma","")+" "+this.getMeta("Ipm.plus.value","")+" "+this.getMeta("Ipm.plus.sigma","")+" "+this.getMeta("Ipm.minus.value","")+" "+this.getMeta("Ipm.minus.sigma","")+" "+this.getMeta("Fpm.plus.value","")+" "+this.getMeta("Fpm.plus.sigma","")+" "+this.getMeta("Fpm.minus.value","")+" "+this.getMeta("Fpm.minus.sigma","")+" "+this.getMeta("FREE",""),"Original data columns"),i="No",0<=this.dname.indexOf("truncated")&&(i="Yes"),t.makeRow("Truncated",i,"Indicated whether the original dataset was truncated."),t.addViewHKLButton(e),t},DataHKL.prototype.layCustomDropdownInput=function(l){var c=l.customGrid,d=c.getNRows();function h(e,t,i){e=c.setLabel(e,t,i,1,1).setFontItalic(!0).setNoWrap();return c.setVerticalAlignment(t,i,"middle"),e}function u(e,t,i,o,n){return c.setInputText(e,o,n,1,1).setStyle("text","real",t,i).setWidth_px(60)}switch(this.setWType=function(){c.wtype_lbl=h("wavelength type:",d,0),c.wtype=new Dropdown,c.wtype.setWidth("180px"),c.wtype.addItem("[must be chosen]","","choose-one","choose-one"==this.wtype),c.wtype.addItem("low remote","","low-remote","low-remote"==this.wtype),c.wtype.addItem("inflection","","inflection","inflection"==this.wtype),c.wtype.addItem("peak","","peak","peak"==this.wtype),c.wtype.addItem("high remote","","high-remote","high-remote"==this.wtype),c.setWidget(c.wtype,d,1,1,2),c.setCellSize("160px","",0,1),c.wtype.make()},this.anomDataLayout=function(){this.setWType(),h("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f':",d,2),c.f1=u(this.f1,"","Real part of scattering factor; leave blank for automatic choice.",d,3),h('&nbsp;&nbsp;&nbsp;&nbsp;f":',d,4),c.f11=u(this.f11,"","Imaginary part of scattering factor; leave blank for automatic choice.",d,5),c.setCellSize("20%","",d,6),c.setLabel(" ",++d,0,1,1).setHeight_px(8)},this.nativeLayout=function(){c.useForPhasing=c.setCheckbox("use for phasing",this.useForPhasing,0,0,1,1).setTooltip("Check if the dataset must be used also for phasing, in addition to model building and density modification"),c.useForPhasing.addOnClickListener(function(){l.task.inputChanged(l.grid.inpParamRef,"native",1)}),c.setVerticalAlignment(0,0,"bottom"),c.setCellSize("","26px",0,0),c.setLabel(" ",1,0,1,1).setHeight_px(8)},this.unmergedRefLayout=function(){h("Space group "+this.getMeta("HM","Unspecified")+" will be used for merging",d,0),c.setLabel(" ",++d,0,1,1).setHeight_px(1),c.setLabel(" ",d,1,1,1).setHeight_px(1)},this.cellInfoLayout=function(){h("Space group:&nbsp;",d,0),c.setLabel(this.getSpaceGroup(),d,1,1,1).setNoWrap(),h("Cell&nbsp;(a,b,c,&alpha;,&beta;,&gamma;):&nbsp;",++d,0),c.setLabel(this.getCellParametersHTML(),d,1,1,2),c.setLabel(" ",++d,0,1,1).setHeight_px(8)},this.reindexLayout=function(){h("Space group:&nbsp;",d,0),c.setLabel(this.getSpaceGroup(),d,1,1,1).setNoWrap(),h("Cell&nbsp;(a,b,c,&alpha;,&beta;,&gamma;):&nbsp;",++d,0),c.setLabel(this.getCellParametersHTML(),d,1,1,2),c.setHLine(1,++d,0,1,2),h("New space group:&nbsp;",++d,0);var e=get_cons_sg_list(this.getSpaceGroup());if(0<e.length){c.new_spg=new Dropdown;var t=0;"new_spg"in this&&(t=Math.max(0,e.indexOf(this.new_spg)));for(var i=0;i<e.length;i++)c.new_spg.addItem(e[i],"",e[i],i==t);c.setWidget(c.new_spg,d,1,1,1),c.new_spg.make()}else c.setLabel("<b><i>Space group "+this.getSpaceGroup()+" cannot be changed</i></b>",d,1,1,1),l.grid.parent.parent.emitSignal(cofe_signals.taskReady,"do not run");c.setLabel(" ",++d,0,1,1).setHeight_px(8)},this.spgLayout=function(){h("Try space group(s):&nbsp;",++d,0),c.spaceGroup=new Dropdown,c.spaceGroup.setWidth("300px");var e=this.getSpaceGroup(),t=getEnantiomorphSpG(e),i=getIndistinguishableSpG(e),o=getAllPointSpG(e),n=e.replace(/\s+/g,""),s="",a="",r=this.spg_alt;t&&(s=n+";"+t.replace(/\s+/g,"")),i&&(a=n+";"+i.replace(/\s+/g,"")),r=r||(1<o.length?"ALL":t?s:i?a:n),c.spaceGroup.addItem(e+" (as in the dataset)","",n,r==n),t&&c.spaceGroup.addItem(e+" + "+t+" (enantiomorphs)","",s,r==s),i&&c.spaceGroup.addItem(e+" + "+i+" (indistinguishable)","",a,r==a),1<o.length&&(c.spaceGroup.addItem("all compatible space groups","","ALL","ALL"==r),c.spaceGroup.getItem("ALL").setTooltip1("Compatible space groups:<p>"+o.join("<br>"),"slideDown",!0,5e3)),c.setWidget(c.spaceGroup,d,1,1,4),c.spaceGroup.make()},this.makeHighResolutionLimit=function(){h("High resolution limit (&Aring;):&nbsp;",++d,0);var e=round(this.getLowResolution(),2),t=round(this.getHighResolution(),2);c.res_high=u(this.res_high,"auto","High resolution limit. Set a value between "+t+" and "+e+", or leave blank for automatic choice.",d,1),c.setLabel(" ",d,2,1,1),c.setCellSize("4%","",d,0),c.setCellSize("4%","",d,1),c.setCellSize("92%","",d,2)},this.makeResolutionLimits=function(e){h("Resolution range (&Aring;):&nbsp;",++d,0);var t=round(this.getLowResolution(),2),i=round(this.getHighResolution(),2),o=t,n=i;"auto"==e&&(n=o="auto"),c.res_low=u(this.res_low,o,"Low resolution limit. Set a value between "+i+" and "+t+", or leave blank for automatic choice.",d,1),h("&nbsp;to&nbsp;",d,2),c.setCellSize("40px","",d,2),c.res_high=u(this.res_high,n,"High resolution limit. Set a value between "+i+" and "+t+", or leave blank for automatic choice.",d,3),c.setLabel(" ",d,4,1,1),c.setCellSize("4%","",d,0),c.setCellSize("4%","",d,1),c.setCellSize("4%","",d,2),c.setCellSize("4%","",d,3),c.setCellSize("84%","",d,4)},this.makeWavelengthInput=function(){var e=this.getWavelength();null==e&&(e=""),h("Wavelength (&Aring;):&nbsp;",++d,0),c.wavelength=u(this.wavelength,e,"Set wavelength value, or leave blank for automatic choice.",d,1)},this.simbadLayout=function(){this.spgLayout(),d++,this.cellInfoLayout()},this.phaserMRLayout=function(){this.makeResolutionLimits("auto");round(this.getHighResolution(),2);h("High res-n for final refinement (&Aring;):&nbsp;",++d,0),c.res_ref=u(this.res_ref,"auto","Set a value equal or larger than "+round(this.getHighResolution(),2)+", or leave blank for automatic choice.",d,1),c.setLabel(" ",++d,0,1,1).setHeight_px(8)},this.phaserEPLayout=function(){var e,t;this.makeResolutionLimits("auto"),this.makeWavelengthInput(),h("Fluorescent Scan Data:&nbsp;",++d,0),c.f_use_mode=new Dropdown,c.f_use_mode.setWidth("120%"),c.f_use_mode.addItem("do not use","","NO","NO"==this.f_use_mode),c.f_use_mode.addItem('use with f" refinement near edge',"","EDGE","EDGE"==this.f_use_mode),c.f_use_mode.addItem('use with full f" refinement',"","ON","ON"==this.f_use_mode),c.f_use_mode.addItem('use without f" refinement',"","OFF","OFF"==this.f_use_mode),c.setWidget(c.f_use_mode,d,1,1,5),c.setCellSize("460px","",d,1),c.f_use_mode.make(),h("&nbsp;&nbsp;f':",++d,1).setHorizontalAlignment("right").setWidth_px(60),c.f1=u(this.f1,"","Real part of scattering factor; leave blank for automatic choice.",d,2),h('&nbsp;&nbsp;f":',d,3).setHorizontalAlignment("right").setWidth_px(60),c.f11=u(this.f11,"","Imaginary part of scattering factor; leave blank for automatic choice.",d,4),t=d,(e=c).f_use_mode.addSignalHandler("state_changed",function(){e.setRowVisible(t,"NO"!=e.f_use_mode.getValue())}),c.setRowVisible(d,"NO"!=this.f_use_mode),c.setLabel(" ",++d,0,1,1).setHeight_px(8)},this.refmacLayout=function(){"refmac"==l.layCustom&&this.makeResolutionLimits("");var e,t,i,o=this.isImean(),n=this.isFmean(),s=this.isIpm(),a=this.isFpm(),r=0,s=(o&&r++,n&&r++,s&&r++,a&&r++,0<r&&(h("Refine using:&nbsp;",++d,0),c.useHKLSet=new Dropdown,n&&c.useHKLSet.addItem("Mean Amplitudes only","","F","F"==this.useHKLSet),l.hasOwnProperty("Structure")&&(l.Structure.PHI&&c.useHKLSet.addItem("Phases as PHI/FOM","","PF","PF"==this.useHKLSet),l.Structure.HLA&&c.useHKLSet.addItem("Phases as HL coefficients","","HL","HL"==this.useHKLSet)),a&&c.useHKLSet.addItem("Anomalous Differences","","Fpm","Fpm"==this.useHKLSet),o&&"refmac"==l.layCustom&&c.useHKLSet.addItem("Mean Intensities assuming twinning","","TI","TI"==this.useHKLSet),n&&c.useHKLSet.addItem("Mean Amplitudes assuming twinning","","TF","TF"==this.useHKLSet),c.setWidget(c.useHKLSet,d,1,1,4),c.useHKLSet.make()),-1),r=("arpwarp"==l.layCustom&&l.hasOwnProperty("Structure")&&(h("Phase blurring factor:&nbsp;",++d,0),c.phaseBlur=u(l.Structure.phaseBlur,"1.0","Set blurring factor for phase restraints",d,1),s=d),-1);a&&(this.makeWavelengthInput(),r=d),(0<r||0<s)&&(e=c,t=s,i=r,o=this.useHKLSet,e.useHKLSet.addSignalHandler("state_changed",function(){0<t&&e.setRowVisible(t,0<=["PF","HL"].indexOf(e.useHKLSet.getValue())),0<i&&e.setRowVisible(i,"Fpm"==e.useHKLSet.getValue())}),0<t&&e.setRowVisible(t,0<=["PF","HL"].indexOf(o)),0<i&&e.setRowVisible(i,"Fpm"==o)),c.setLabel(" ",++d,0,1,1).setHeight_px(8)},this.ccp4buildLayout=function(){this.makeResolutionLimits("auto")},this.modelcraftLayout=function(){"detwin"in this||(this.detwin=!1);var e=0;0<c.getNRows()&&(e=1),c.detwin=c.setCheckbox("Apply detwinning",this.detwin,0,e,1,1).setTooltip("Check for twinned refinement. Only use this option if you are sure your crystal is twinned.")},l.layCustom){case"crank2":case"anomData":this.anomDataLayout();break;case"shelx-auto":case"shelx-substr":case"anomData-Shelx":this.setWType();break;case"native":this.nativeLayout();break;case"unmerged-ref":this.unmergedRefLayout();break;case"simbad":this.simbadLayout();break;case"cell-info":this.cellInfoLayout();break;case"reindex":this.reindexLayout();break;case"changereso":this.makeResolutionLimits("");break;case"nautilus":this.makeHighResolutionLimit();break;case"buster":this.makeResolutionLimits("auto");break;case"phaser-mr":case"phaser-mr1":this.spgLayout();case"phaser-mr-fixed":case"phaser-mr-fixed1":this.phaserMRLayout();break;case"phaser-ep":this.phaserEPLayout();break;case"arpwarp":case"refmac":this.refmacLayout();break;case"ccp4build":this.ccp4buildLayout();break;case"modelcraft":this.modelcraftLayout()}},DataHKL.prototype.collectCustomDropdownInput=function(e){var n="",t=e.customGrid;function i(e,t,i,o){e=e.getValue().trim();return""==e&&i||isFloat(e)?e:(n+="|"+o,t)}switch(this.collectAnom=function(){this.wtype=t.wtype.getValue(),this.f1=i(t.f1,this.f1,!0,"<b>hkl dataset #"+(e.serialNo+1)+"</b> wrong format of f'"),this.f11=i(t.f11,this.f11,!0,"<b>hkl dataset #"+(e.serialNo+1)+'</b> wrong format of f"'),isFloat(this.f11)&&parseFloat(this.f11)<0&&(n+='|<b><i>f" must be positive</i></b>'),"choose-one"==this.wtype&&(n+="|<b><i>Wavelength type must be chosen</i></b>")},this.collectAnomShelx=function(){t.wtype.isVisible()&&(this.wtype=t.wtype.getValue(),"choose-one"==this.wtype&&(n+="|<b><i>Wavelength type must be chosen</i></b>"))},this.collectNative=function(){this.useForPhasing=t.useForPhasing.getValue()},this.collectReindex=function(){"new_spg"in t?this.new_spg=t.new_spg.getValue().replace(" (enantiomorph)","").replace(" (indistinguishable)",""):this.new_spg=""},this.collectSpG=function(){this.spg_alt=t.spaceGroup.getValue()},this.collectPhaserMR=function(){this.res_low=t.res_low.getValue(),this.res_high=t.res_high.getValue(),this.res_ref=t.res_ref.getValue()},this.collectPhaserEP=function(){this.res_low=t.res_low.getValue(),this.res_high=t.res_high.getValue(),this.wavelength=t.wavelength.getValue(),""==this.wavelength&&(this.wavelength=this.getWavelength()),this.f_use_mode=t.f_use_mode.getValue(),"NO"!=this.f_use_mode&&(this.f1=i(t.f1,this.f1,!1,"<b>wrong format (empty field?) of f'</b>"),this.f11=i(t.f11,this.f11,!1,'<b>wrong format (empty field?) of f"</b>'),isFloat(this.f11)&&parseFloat(this.f11)<0&&(n+='|<b><i>f" must be positive</i></b>'))},this.collectRefmac=function(){"refmac"==e.layCustom&&(this.res_low=t.res_low.getValue(),this.res_high=t.res_high.getValue()),"wavelength"in t&&(this.wavelength=t.wavelength.getValue()),""==this.res_low&&(this.res_low=round(this.getLowResolution(),2)),""==this.res_high&&(this.res_high=round(this.getHighResolution(),2)),""==this.wavelength&&(this.wavelength=this.getWavelength()),"useHKLSet"in t?this.useHKLSet=t.useHKLSet.getValue():this.useHKLSet="auto","phaseBlur"in t&&(e.Structure.phaseBlur=t.phaseBlur.getValue())},this.collectResoLimits=function(){"res_low"in t&&(this.res_low=t.res_low.getValue()),"res_high"in t&&(this.res_high=t.res_high.getValue())},this.collectCCP4build=function(){this.collectResoLimits()},this.collectModelcraft=function(){this.detwin=t.detwin.getValue()},this.collectChangeReso=function(){var e,t;this.collectResoLimits(),""==this.res_high&&""==this.res_low?n+="|<b><i>At least one resolution limit must be specified</i></b>":(e=round(this.getLowResolution(),2),t=round(this.getHighResolution(),2),""!=this.res_high&&(this.res_high<t||this.res_high>e)&&(n+="|<b><i>High resolution limit must be within "+t+" - "+e+"</i></b>"),""!=this.res_low&&(this.res_low<t||this.res_low>e)&&(n+="|<b><i>Resolution limits must be within "+t+" - "+e+"</i></b>"),""!=this.res_high&&""!=this.res_low&&this.res_low<this.res_high&&(n+="|<b><i>High resolution limit must be lower than low resolution limit</i></b>"))},e.layCustom){case"crank2":case"anomData":this.collectAnom();break;case"shelx-auto":case"shelx-substr":case"anomData-Shelx":this.collectAnomShelx();break;case"native":this.collectNative();break;case"reindex":this.collectReindex();break;case"changereso":this.collectChangeReso();break;case"nautilus":case"buster":this.collectResoLimits();break;case"simbad":this.collectSpG();break;case"phasser-mr":case"phaser-mr1":this.collectSpG();case"phaser-mr-fixed":case"phaser-mr-fixed1":this.collectPhaserMR();break;case"phaser-ep":this.collectPhaserEP();break;case"arpwarp":case"refmac":this.collectRefmac();break;case"ccp4build":this.collectCCP4build();break;case"modelcraft":this.collectModelcraft()}return n});var __template=null;function DataLibrary(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataLibrary",this.codes=[]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),DataLibrary.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataLibrary.prototype.constructor=DataLibrary,DataLibrary.prototype.title=function(){return"Ligand Library"},DataLibrary.prototype.icon=function(){return"data"},DataLibrary.prototype.currentVersion=function(){return __template?0+__template.DataTemplate.prototype.currentVersion.call(this):0+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataLibrary=DataLibrary:DataLibrary.prototype.makeDataSummaryPage=function(e){var t=new DataSummaryPage(this);return t.makeRow("File name",this.files[file_key.lib],"Imported or generated file name"),t};var __template=null;function DataLigand(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataLigand",this.code="DRG"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),DataLigand.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataLigand.prototype.constructor=DataLigand,DataLigand.prototype.title=function(){return"Ligand Structure"},DataLigand.prototype.icon=function(){return"data"},DataLigand.prototype.currentVersion=function(){return __template?0+__template.DataTemplate.prototype.currentVersion.call(this):0+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataLigand=DataLigand:DataLigand.prototype.makeDataSummaryPage=function(e){var t=new DataSummaryPage(this);return t.makeRow("File name",this.files[file_key.xyz],"Imported or generated file name"),t};var __template=null;function DataRemove(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataRemove",this.subtype=["proxy"],this.dname="[remove]"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),DataRemove.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataRemove.prototype.constructor=DataRemove,__template&&(module.exports.DataRemove=DataRemove);var __template=null,revision_subtype=("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),{asu:"asu",hkl:"hkl",seq:"seq",anomalous:"anomalous",xyz:"xyz",substructure:"substructure",phases:"phases",ligands:"ligands",waters:"waters"});function DataRevision(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataRevision",this.leadKey=0,this.HKL=null,this.ASU={},this.ASU.jobNo=0,this.ASU.seq=[],this.ASU.ha_type="",this.ASU.ndisulph="",this.ASU.nRes=0,this.ASU.molWeight=0,this.ASU.solvent=0,this.ASU.matthews=0,this.ASU.prob_matth=0,this.Structure=null,this.Substructure=null,this.Ligands=[],this.Options={leading_structure:"",phasing_sel:"substructure",structure_sel:"fixed-model",ncsmodel_sel:"do-not-use",seqNo:0,load_all:!1,useSubstruct:!1},this.backtrace=!1}DataRevision.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataRevision.prototype.constructor=DataRevision,DataRevision.prototype.title=function(){return"Structure Revision"},DataRevision.prototype.icon=function(){return"data_xrayimages"},DataRevision.prototype.currentVersion=function(){return __template?5+__template.DataTemplate.prototype.currentVersion.call(this):5+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataRevision=DataRevision:(DataRevision.prototype.extend=function(){var e=$.extend(!0,{},this);this.HKL&&(e.HKL=this.HKL.extend());for(var t=0;t<e.ASU.seq.length;t++)e.ASU.seq[t]=this.ASU.seq[t].extend();this.Structure&&(e.Structure=this.Structure.extend()),this.Substructure&&(e.Substructure=this.Substructure.extend());for(t=0;t<e.Ligands.length;t++)e.Ligands[t]=this.Ligands[t].extend();return e},DataRevision.prototype.makeASUSummaryPage=function(e){var t=new DataSummaryPage(this),i=("jobNo"in this.ASU&&0<this.ASU.jobNo?(t.trow=0,t.makeRow("Producing job number",this.ASU.jobNo.toString(),"Id of job produced this dataset")):t.trow=1,t.makeRow("Total residues",this.ASU.nRes.toString(),"Total number of residues"),t.makeRow("Total weight",round(this.ASU.molWeight,0).toString(),"Total macromolecular weight"),t.makeRow("Solvent %%",round(this.ASU.solvent,1).toString(),"Solvent content"),t.makeRow("Matthews coefficient",round(this.ASU.matthews,2).toString(),"Matthews coefficient"),t.makeRow("P<sub>matthews</sub>",round(this.ASU.prob_matth,2).toString(),"Matthews probability"),this.ASU.seq.length+1);t.table.setHeaderText("Contents",t.trow,0,i,1),t.table.setHorizontalAlignment(t.trow,0,"left"),t.table.setHeaderText("##",t.trow,1,1,1),t.table.setHeaderText("Sequence",t.trow,2,1,1),t.table.setHeaderText("N<sub>copies</sub>",t.trow,3,1,1),t.table.setHeaderText("N<sub>res</sub>",t.trow,4,1,1),t.table.setHeaderText("Weight",t.trow,5,1,1),t.table.setLabel(" ",t.trow,6,i,1),t.table.setCellSize("90%","",t.trow,6),t.trow++;for(var o=0;o<this.ASU.seq.length;o++){var n=this.ASU.seq[o];t.table.setLabel((o+1).toString(),t.trow,0,1,1).setNoWrap(),t.table.setLabel(n.dname,t.trow,1,1,1).setNoWrap(),t.table.setLabel(n.ncopies.toString(),t.trow,2,1,1),t.table.setLabel(n.size.toString(),t.trow,3,1,1),t.table.setLabel(round(n.weight,1).toString(),t.trow,4,1,1),t.trow++}return this.ASU.ha_type?t.makeRow("HA type",this.ASU.ha_type,"Main anomalous scatterer"):t.makeRow("HA type","<i>unspecified</i>","Main anomalous scatterer"),t},DataRevision.prototype.makeDataSummaryPage=function(e){var t=new Grid(""),i=(t.tabs=new Tabs,t.tabs.addTab("General",!0)),o=(i.grid.setLabel("<h3>Structure Revision R"+this.dataId+"</h3>",0,0,1,1),new DataSummaryPage(this)),n="unknown (possible bug)",s="Not phased";return"structure"==this.Options.leading_structure?(n="Structure",s=this.Structure.phaseType()):"substructure"==this.Options.leading_structure&&(n="Substructure",s=this.Substructure.phaseType()),this.Structure&&this.Substructure&&o.makeRow("Revision's phases from",n,"Dataset containing phases for using in subsequent tasks"),(this.Structure&&this.Structure.hasPhases()||this.Substructure&&this.Substructure.hasPhases())&&o.makeRow("Phases' type",s,"Type of phasing method used to calculate revision's phases"),i.grid.setWidget(o,1,0,1,1),this.HKL&&t.tabs.addTab("HKL",!1).grid.setWidget(this.HKL.makeDataSummaryPage(e),0,0,1,1),t.tabs.addTab("ASU",!1).grid.setWidget(this.makeASUSummaryPage(e),0,0,1,1),this.Structure&&t.tabs.addTab("Structure",!1).grid.setWidget(this.Structure.makeDataSummaryPage(e),0,0,1,1),this.Substructure&&t.tabs.addTab("Substructure",!1).grid.setWidget(this.Substructure.makeDataSummaryPage(e),0,0,1,1),t.setWidget(t.tabs,0,0,1,1),t},DataRevision.prototype.inspectData=function(e){var t=this.makeDataSummaryPage(e),i=new DataInspectDialog(t,this.dname,"800px","700px");function o(){t.setHeight_px($(i.element).dialog("option","height")-128),t.tabs.refresh()}i._options.height=620,i._options.resize=function(e,t){window.setTimeout(o,0)},i.launch(),o()},DataRevision.prototype._layCDI_Crank2=function(e,t){var i=e.customGrid,o=i.getNRows();function n(){var e=i.ha_type.getValue().trim(),t="s"==e.toLowerCase();i.ndis_lbl.setVisible(t),i.ndisulph.setVisible(t),i.ha_lbl.setVisible(e.length<=0)}function s(){i.phasing_sel&&(i.setRowVisible(i.sctNRow,"model"==i.phasing_sel.getValue()),"inpParamRef"in e.grid&&e.task.inputChanged(e.grid.inpParamRef,"revision",1)),n()}i.phasing_sel=null,"crank2"==t&&(this.Structure||this.Substructure)&&(i.setLabel("phase using:",o,0,1,1).setFontItalic(!0).setNoWrap(),i.setVerticalAlignment(o,0,"middle"),i.phasing_sel=new Dropdown,this.Substructure&&i.phasing_sel.addItem("heavy-atom substructure ("+this.ASU.ha_type+")","","substructure","substructure"==this.Options.phasing_sel),this.Structure&&(i.phasing_sel.addItem("protein model","","model","model"==this.Options.phasing_sel),this.Structure.layCustomDropdownInput(e)),this.Structure&&this.Substructure&&(i.phasing_sel.addItem("protein model and heavy-atom substructure ("+this.ASU.ha_type+")","","model-and-substr","model-and-substr"==this.Options.phasing_sel),this.Structure.layCustomDropdownInput(e)),i.setWidget(i.phasing_sel,o++,1,1,7),i.phasing_sel.make(),o++),i.sctNRow=o,i.setLabel("main anomalous scatterer:",o,0,1,1).setFontItalic(!0).setNoWrap(),i.ha_type=i.setInputText(this.ASU.ha_type,o,1,1,1).setStyle("text","","","Specify the atom type of dominant anomolous scatterer (e.g., S, SE etc.)").setWidth_px(40).setMaxInputLength(2),i.ha_lbl=i.setLabel('<font color="maroon">(must be chosen)</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;',o,2,1,1).setFontSize("80%").setNoWrap(),i.setVerticalAlignment(o,0,"middle"),i.setVerticalAlignment(o,2,"middle"),i.setCellSize("80%","",o,2),i.ndis_lbl=i.setLabel("number of S-S pairs:",o,3,1,3).setFontItalic(!0).setNoWrap(),i.ndisulph=i.setInputText(this.ASU.ndisulph,o,4,1,1).setStyle("text","integer","","Optional number of disulphides to be treated as S-S pairs. Ignored if left blank (default).").setWidth_px(36).setMaxInputLength(2),i.setVerticalAlignment(o,3,"middle"),i.ha_type.addOnInputListener(n),i.phasing_sel&&i.phasing_sel.addOnChangeListener(s),s(),this.HKL.layCustomDropdownInput(e)},DataRevision.prototype._layMROptions=function(e,t,i){var o=null,n=e.customGrid;if("structure"==this.Options.leading_structure?o=[["as fixed model","fixed-model"],["for fit in density and as fixed model","edfit-fixed-model"],["only for fit in density","edfit"]]:"substructure"==this.Options.leading_structure&&(n.setLabel("MR model will be fit in electron density of heavy atom substructure",t++,0,1,4).setFontItalic(!0).setNoWrap(),this.Structure?o=[["as fixed model","fixed-model"],["ignore and replace","ignore"]]:i&&n.setLabel(" ",t,0,1,1).setHeight_px(8)),o){n.setLabel("Use current structure:",t,0,1,1).setFontItalic(!0).setNoWrap(),n.setVerticalAlignment(t,0,"middle"),n.structure_sel=new Dropdown,n.setWidget(n.structure_sel,t,1,1,4);for(var s=0;s<o.length;s++)n.structure_sel.addItem(o[s][0],"",o[s][1],this.Options.structure_sel==o[s][1]);n.structure_sel.make(),n.setCellSize("5%","",t,0),n.setCellSize("95%","",t,1),i&&n.setLabel(" ",++t,0,1,1).setHeight_px(8)}},DataRevision.prototype._layCDI_Molrep=function(e){var t=e.customGrid.getNRows();this._layMROptions(e,t,!0)},DataRevision.prototype._layMROptions1=function(e,t){var i=e.customGrid,e=t,t=this.Structure&&this.Structure.hasXYZ(),o=this.Structure&&this.Structure.hasPhases(),n=this.Substructure&&this.Substructure.hasPhases(),s="substructure"==this.Options.leading_structure;if(t&&i.setLabel("Currently fitted model will not be changed",e++,0,1,4).setFontItalic(!0).setNoWrap(),n&&s)i.setLabel("MR model will be fit using EP phases",e++,0,1,4).setFontItalic(!0).setNoWrap(),this.Options.mr_type="subsph";else{var a=[["reflection data","refl"]];if(o&&a.push(["structure phases","sph"]),n&&a.push(["substructure phases","subsph"]),1<a.length){i.setLabel("Fit MR model using:",e,0,1,1).setFontItalic(!0).setNoWrap(),i.setVerticalAlignment(e,0,"middle"),i.mr_type_sel=new Dropdown,i.setWidget(i.mr_type_sel,e,1,1,4);for(var r=0;r<a.length;r++)i.mr_type_sel.addItem(a[r][0],"",a[r][1],this.Options.mr_type==a[r][1]);i.mr_type_sel.make(),i.setCellSize("5%","",e,0),i.setCellSize("95%","",e,1),e++}}},DataRevision.prototype._layCDI_Molrep1=function(i){var e,o=i.customGrid,t=o.getNRows(),n=this.Structure&&this.Structure.hasPhases(),s=this.Substructure&&this.Substructure.hasPhases(),a=(this._layMROptions1(i,t),o.getNRows());(n||s)&&(o.setLabel("Density search protocol:",a,0,1,1).setFontItalic(!0).setNoWrap(),o.setVerticalAlignment(a,0,"middle"),o.ds_protocol_sel=new Dropdown,o.setWidget(o.ds_protocol_sel,a,1,1,4),o.ds_protocol_sel.addItem("RF + Phased TF","","N","N"==this.Options.ds_protocol),o.ds_protocol_sel.addItem("SAPTF + Local Phased RF + Phased TF","","Y","Y"==this.Options.ds_protocol),o.ds_protocol_sel.addItem("SAPTF + Local RF + Phased TF","","S","S"==this.Options.ds_protocol),o.ds_protocol_sel.make(),o.setCellSize("5%","",a,0),o.setCellSize("95%","",a,1),e=null,"mr_type_sel"in o?(o.ds_row=a,o.mr_type_sel.addOnChangeListener(function(e,t){o.setRowVisible(o.ds_row,"refl"!=t),i.task.MRTypeChanged(i.grid.inpParamRef,t)}),e=o.mr_type_sel.getValue(),o.setRowVisible(o.ds_row,"refl"!=e)):"substructure"==this.Options.leading_structure&&(e="subsph"),e&&window.setTimeout(function(){i.task.MRTypeChanged(i.grid.inpParamRef,e)},100)),t<a&&o.setLabel(" ",++a,0,1,1).setHeight_px(8)},DataRevision.prototype._layCDI_AsuMod=function(e){this.HKL.hasAnomalousSignal()&&((e=e.customGrid).setLabel("main anomalous scatterer:",0,0,1,1).setFontItalic(!0).setNoWrap(),e.ha_type=e.setInputText(this.ASU.ha_type,0,1,1,1).setStyle("text","","","Specify atom type of anomolous scatterers, or leave blank if uncertain.").setWidth_px(40).setMaxInputLength(2),e.setVerticalAlignment(0,0,"middle"))},DataRevision.prototype._layCDI_PhaserEP=function(e){var i=e.customGrid;i.setLabel("Phase using:",0,0,1,1).setFontItalic(!0).setNoWrap(),i.setVerticalAlignment(0,0,"middle"),i.phasing_sel=new Dropdown,this.Substructure&&i.phasing_sel.addItem("heavy-atom substructure ("+this.ASU.ha_type+")","","substructure","substructure"==this.Options.phasing_sel),this.Structure&&(i.phasing_sel.addItem("macromolecular model","","model","substructure"!=this.Options.phasing_sel),this.Structure.layCustomDropdownInput(e)),i.setWidget(i.phasing_sel,0,1,1,5),i.phasing_sel.addOnChangeListener(function(e,t){i.setRowVisible(1,"model"==t)}),i.phasing_sel.make(),this.Structure&&i.setRowVisible(1,"substructure"!=this.Options.phasing_sel),this.HKL.layCustomDropdownInput(e)},DataRevision.prototype._layCDI_PhaserMR=function(e){var t=e.customGrid,i=t.getNRows(),o=i;if(this.hasOwnProperty("phaser_meta")){for(var n in t.setLabel("<b>Prefitted models</b>:",i++,0,1,1).setFontItalic(!0).setNoWrap(),this.phaser_meta.ensembles)t.setLabel("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+this.phaser_meta.ensembles[n].ncopies+"x "+n+" :",i,0,1,1).setFontItalic(!0).setNoWrap(),("data"in this.phaser_meta.ensembles[n]?t.setLabel(this.phaser_meta.ensembles[n].data.files[file_key.xyz],i++,1,1,4):this.phaser_meta.sol.files.hasOwnProperty(file_key.sol)?t.setLabel(this.phaser_meta.sol.files[file_key.sol].replace("-02_","-01_").replace(".sol",".pdb"),i++,1,1,4):t.setLabel("<b>absent (can be in error)</b>",i++,1,1,4).setFontItalic(!0)).setNoWrap();t.setLabel("<b>Phaser solution metadata:</b>",i,0,1,1).setFontItalic(!0).setNoWrap(),(this.phaser_meta.sol.files.hasOwnProperty(file_key.sol)?t.setLabel(this.phaser_meta.sol.files[file_key.sol],i++,1,1,4):t.setLabel("<b>absent (can be in error)</b>",i++,1,1,4).setFontItalic(!0)).setNoWrap()}for(var s=o;s<i;s++)t.setCellSize("","12pt",s,0),t.setVerticalAlignment(s,0,"middle"),t.setCellSize("","12pt",s,1),t.setVerticalAlignment(s,1,"middle");this._layMROptions(e,i,!1),(this.Structure||this.Substructure)&&(e.layCustom="phaser-mr-fixed"),this.HKL.layCustomDropdownInput(e)},DataRevision.prototype._layCDI_PhaserMR1=function(i){var e=i.customGrid,t=e.getNRows(),o=t;if(this.hasOwnProperty("phaser_meta")){for(var n in e.setLabel("<b>Prefitted models</b>:",t++,0,1,1).setFontItalic(!0).setNoWrap(),this.phaser_meta.ensembles)e.setLabel("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+this.phaser_meta.ensembles[n].ncopies+"x "+n+" :",t,0,1,1).setFontItalic(!0).setNoWrap(),("data"in this.phaser_meta.ensembles[n]?e.setLabel(this.phaser_meta.ensembles[n].data.files[file_key.xyz],t++,1,1,4):this.phaser_meta.sol.files.hasOwnProperty(file_key.sol)?e.setLabel(this.phaser_meta.sol.files[file_key.sol].replace("-02_","-01_").replace(".sol",".pdb"),t++,1,1,4):e.setLabel("<b>absent (can be in error)</b>",t++,1,1,4).setFontItalic(!0)).setNoWrap();e.setLabel("<b>Phaser solution metadata:</b>",t,0,1,1).setFontItalic(!0).setNoWrap(),(this.phaser_meta.sol.files.hasOwnProperty(file_key.sol)?e.setLabel(this.phaser_meta.sol.files[file_key.sol],t++,1,1,4):e.setLabel("<b>absent (can be in error)</b>",t++,1,1,4).setFontItalic(!0)).setNoWrap()}for(var s=o;s<t;s++)e.setCellSize("","12pt",s,0),e.setVerticalAlignment(s,0,"middle"),e.setCellSize("","12pt",s,1),e.setVerticalAlignment(s,1,"middle");this._layMROptions1(i,t),(this.Structure||this.Substructure)&&(i.layCustom="phaser-mr-fixed1"),this.HKL.layCustomDropdownInput(i);var a=null;"mr_type_sel"in e?(e.mr_type_sel.addOnChangeListener(function(e,t){i.task.MRTypeChanged(i.grid.inpParamRef,t)}),a=e.mr_type_sel.getValue()):"substructure"==this.Options.leading_structure&&(a="subsph"),a&&window.setTimeout(function(){i.task.MRTypeChanged(i.grid.inpParamRef,a)},100)},DataRevision.prototype._layCDI_Parrot=function(e){var t,e=e.customGrid,i=e.getNRows();this.Structure&&this.Substructure&&(t="Will use phases from ","substructure"==this.Options.leading_structure?t+="heavy-atom substructure ("+this.ASU.ha_type+")":t+="macromolecular model",e.setLabel(t,i++,0,1,7).setFontBold(!0).setFontItalic(!0).setNoWrap()),e.setLabel("Model for NCS detection:",i,0,1,1).setFontItalic(!0).setNoWrap(),e.setVerticalAlignment(i,0,"middle"),e.ncsmodel_sel=new Dropdown,e.ncsmodel_sel.addItem("do not use","","do-not-use","do-not-use"==this.Options.ncsmodel_sel),this.Substructure&&e.ncsmodel_sel.addItem("heavy-atom substructure ("+this.ASU.ha_type+")","","substructure","substructure"==this.Options.ncsmodel_sel),this.Structure&&e.ncsmodel_sel.addItem("macromolecular model","","model","model"==this.Options.ncsmodel_sel),e.setWidget(e.ncsmodel_sel,i,1,1,5),e.ncsmodel_sel.make()},DataRevision.prototype._layCDI_Structure=function(e,t){var i,o=e.customGrid,n=o.getNRows(),o=(this.Structure&&this.Substructure&&(i="Will use phases from ","substructure"==this.Options.leading_structure?i+="heavy-atom substructure ("+this.ASU.ha_type+")":i+="macromolecular model",o.setLabel(i,+n,0,1,7).setFontBold(!0).setFontItalic(!0).setNoWrap()),null);return 0<t&&((o="substructure"==this.Options.leading_structure?this.Substructure:this.Structure).layCustomDropdownInput(e),2==t&&this.Structure&&"substructure"==this.Options.leading_structure&&this.Structure.layCustomDropdownInput(e)),o},DataRevision.prototype._layCDI_CootMB=function(e){var t,e=e.customGrid,i=e.getNRows();this.Structure&&this.Substructure&&("load_all"in this.Options||(this.Options.load_all=!1),t="Load HA substructure","substructure"==this.Options.leading_structure&&(t="Load structure"),e.load_all_cbx=e.setCheckbox(t,this.Options.load_all,i,0,1,1),e.setLabel(" ",++i,0,1,1).setHeight_px(8))},DataRevision.prototype._layCDI_ModelCraft=function(e){var e=e.customGrid,t=e.getNRows();"useSubstruct"in this.Options||(this.Options.useSubstruct=!1),this.Substructure&&(e.use_substruct_cbx=e.setCheckbox("Use substructure",this.Options.useSubstruct,t,0,1,1).setTooltip("Check if substructure atoms should be taken into account as fixed model."))},DataRevision.prototype._layCDI_TextEditor=function(e){for(var t=[],i=0;i<this.ASU.seq.length;i++){var o=this.ASU.seq[i].files;file_key.seq in o&&t.push(["sequence",o[file_key.seq]])}if(this.Structure&&(file_key.xyz in this.Structure.files&&t.push(["structure (pdb)",this.Structure.files[file_key.xyz]]),file_key.mmcif in this.Structure.files&&t.push(["structure (mmcif)",this.Structure.files[file_key.mmcif]]),file_key.lib in this.Structure.files&&t.push(["ligand(s)",this.Structure.files[file_key.lib]])),this.Substructure&&file_key.sub in this.Substructure.files&&t.push(["substructure (pdb)",this.Substructure.files[file_key.sub]]),0<t.length){var n=e.customGrid,e=n.getNRows();n.setLabel("Select file:",e,0,1,1).setFontItalic(!0).setNoWrap(),n.setVerticalAlignment(e,0,"middle"),n.textedit_sel=new Dropdown,"texteditor"in this.Options||(this.Options.texteditor={fname:"",stype:""});for(i=0;i<t.length;i++)t[i].push("fid_"+i),n.textedit_sel.addItem(t[i][1]+" : "+t[i][0],"",i,this.Options.texteditor.fname==t[i][1]);n.setWidget(n.textedit_sel,e,1,1,5),n.textedit_sel.make()}},DataRevision.prototype.layCustomDropdownInput=function(e){switch(e.layCustom){case"asumod":this._layCDI_AsuMod(e);break;case"phaser-ep":this._layCDI_PhaserEP(e);break;case"reindex":case"refmac":case"ccp4build":case"cell-info":case"changereso":this.HKL.layCustomDropdownInput(e);break;case"modelcraft":this._layCDI_ModelCraft(e),this.HKL.layCustomDropdownInput(e);break;case"parrot":this._layCDI_Parrot(e);break;case"simbad":this.HKL&&this.HKL.layCustomDropdownInput(e);break;case"shelxe":this._layCDI_Structure(e,0);break;case"acorn":this._layCDI_Structure(e,1);break;case"buccaneer-ws":this._layCDI_Structure(e,2);break;case"nautilus":this._layCDI_Structure(e,2),this.HKL.layCustomDropdownInput(e);break;case"buster":this.HKL.layCustomDropdownInput(e);break;case"arpwarp":e.Structure=this._layCDI_Structure(e,1),this.HKL.layCustomDropdownInput(e);break;case"molrep":this._layCDI_Molrep(e);break;case"molrep1":this._layCDI_Molrep1(e);break;case"phaser-mr":case"phaser-mr-fixed":this._layCDI_PhaserMR(e);break;case"phaser-mr1":case"phaser-mr-fixed1":this._layCDI_PhaserMR1(e);break;case"crank2":this._layCDI_Crank2(e,"crank2");break;case"shelx-auto":this._layCDI_Crank2(e,"shelx-auto");break;case"shelx-substr":this._layCDI_Crank2(e,"shelx-substr");break;case"map-sel":this.Structure?this.Structure.layCustomDropdownInput(e):this.Substructure&&this.Substructure.layCustomDropdownInput(e);break;case"coot-mb":this._layCDI_CootMB(e);break;case"texteditor":this._layCDI_TextEditor(e)}},DataRevision.prototype._collectCDI_Crank2=function(e){var t=e.customGrid,i="";return"removeNonAnom"in t&&(this.Structure.removeNonAnom=t.removeNonAnom.getValue()),t.phasing_sel&&(this.Options.phasing_sel=t.phasing_sel.getValue()),this.ASU&&(this.ASU.ha_type=t.ha_type.getValue().trim(),this.ASU.ha_type||(i+="|<b><i>Main anomalous scatterer must be given</i></b>"),t.hasOwnProperty("ndisulph")&&"s"==this.ASU.ha_type.toLowerCase()&&(0<(t=t.ndisulph.getValue()).trim().length?isInteger(t)?0<=(t=parseInt(t))?this.ASU.ndisulph=t:i+="|<b><i>Number of disulphides should be positive</i></b>":i+="|<b><i>Wrong format for number of disulphides</i></b>":this.ASU.ndisulph="")),i+=this.HKL.collectCustomDropdownInput(e)},DataRevision.prototype.collectCustomDropdownInput=function(e){var t,i="";switch(e.layCustom){case"asumod":this.ASU&&this.HKL.hasAnomalousSignal()&&(this.ASU.ha_type=e.customGrid.ha_type.getValue());break;case"reindex":case"refmac":case"ccp4build":case"changereso":i=this.HKL.collectCustomDropdownInput(e);break;case"modelcraft":this.Substructure&&(this.Options.useSubstruct=e.customGrid.use_substruct_cbx.getValue()),i=this.HKL.collectCustomDropdownInput(e);break;case"phaser-mr":case"phaser-mr-fixed":"structure_sel"in e.customGrid&&(this.Options.structure_sel=e.customGrid.structure_sel.getValue()),i=this.HKL.collectCustomDropdownInput(e);break;case"phaser-mr1":case"phaser-mr-fixed1":"mr_type_sel"in e.customGrid&&(this.Options.mr_type=e.customGrid.mr_type_sel.getValue()),"ds_protocol_sel"in e.customGrid&&(this.Options.ds_protocol=e.customGrid.ds_protocol_sel.getValue()),i=this.HKL.collectCustomDropdownInput(e);break;case"phaser-ep":i=this.HKL.collectCustomDropdownInput(e),this.Options.phasing_sel=e.customGrid.phasing_sel.getValue(),this.Structure&&"model"==this.Options.phasing_sel&&(i+=this.Structure.collectCustomDropdownInput(e));break;case"parrot":this.Options.ncsmodel_sel=e.customGrid.ncsmodel_sel.getValue();break;case"acorn":i=("substructure"==this.Options.leading_structure?this.Substructure:this.Structure).collectCustomDropdownInput(e);break;case"buccaneer-ws":"substructure"==this.Options.leading_structure?(i=this.Substructure.collectCustomDropdownInput(e),this.Structure&&(i=this.Structure.collectCustomDropdownInput(e))):i=this.Structure.collectCustomDropdownInput(e);break;case"nautilus":"substructure"==this.Options.leading_structure?(i=this.Substructure.collectCustomDropdownInput(e),this.Structure&&(i=this.Structure.collectCustomDropdownInput(e))):i=this.Structure.collectCustomDropdownInput(e),i=this.HKL.collectCustomDropdownInput(e);break;case"buster":i=this.HKL.collectCustomDropdownInput(e);break;case"arpwarp":"substructure"==this.Options.leading_structure?e.Structure=this.Substructure:e.Structure=this.Structure,i=e.Structure.collectCustomDropdownInput(e)+this.HKL.collectCustomDropdownInput(e);break;case"molrep":"structure_sel"in e.customGrid&&(this.Options.structure_sel=e.customGrid.structure_sel.getValue());break;case"molrep1":"mr_type_sel"in e.customGrid&&(this.Options.mr_type=e.customGrid.mr_type_sel.getValue()),"ds_protocol_sel"in e.customGrid&&(this.Options.ds_protocol=e.customGrid.ds_protocol_sel.getValue());break;case"crank2":i=this._collectCDI_Crank2(e);break;case"simbad":this.HKL&&(i=this.HKL.collectCustomDropdownInput(e));break;case"shelx-auto":case"shelx-substr":i=this._collectCDI_Crank2(e);break;case"map-sel":this.Structure?this.Structure.collectCustomDropdownInput(e):this.Substructure&&this.Substructure.collectCustomDropdownInput(e);break;case"coot-mb":"load_all_cbx"in e.customGrid&&(this.Options.load_all=e.customGrid.load_all_cbx.getValue());break;case"texteditor":"textedit_sel"in e.customGrid&&(t=e.customGrid.textedit_sel.getText().split(":"),this.Options.texteditor={fname:t[0].trim(),stype:t[1].trim().split(" ")[0].trim()})}return i},DataRevision.prototype.dataDialogHints=function(e,t){var i="";return 0<t&&(i='A suitabe <i>"Structure Revision"</i> is missing ',0<=e.indexOf("xyz")||0<=e.indexOf("phases")?i+="-- perform phasing first.":0<=e.indexOf("substructure")?i+="-- perform substructure search first.":i+='-- run the <i>"Asymmetric Unit Content"</i> task to create a new revision.',0<=e.indexOf("anomalous")&&(i+=" Make sure to use revision with reflection dataset having anomalous signal."),i+=" See full description <a href=\"javascript:launchHelpBox('Structure Revision','"+__user_guide_base_url+"/jscofe_qna.structure_revision.html',null,10)\"><i>"+String("here").fontcolor("blue")+"</i></a>."),[i]});var __template=null;function DataSequence(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataSequence",this.size=0,this.weight=0,this.ncopies=1,this.nfind=1,this.ncopies_auto=!0}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),DataSequence.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataSequence.prototype.constructor=DataSequence,DataSequence.prototype.title=function(){return"Macromolecular sequence"},DataSequence.prototype.icon=function(){return"data"},DataSequence.prototype.currentVersion=function(){return __template?1+__template.DataTemplate.prototype.currentVersion.call(this):1+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataSequence=DataSequence:(DataSequence.prototype.extend=function(){var e=$.extend(!0,{},this);return e.xyzmeta=$.extend(!0,{},this.xyzmeta),e},DataSequence.prototype.makeDataSummaryPage=function(e){var t,i=new DataSummaryPage(this);return"(unknown)"==this.files[file_key.seq]?i.makeRow("Contents","** UNKNOWN SEQUENCE **","Macromolecular sequence"):(i.makeRow("Length",this.size,"Number of residues or base pairs"),i.makeRow("Weight",round(this.weight,2),"Molecular weight"),i.makeRow("Contents","","Macromolecular sequence"),(t={meta:{}}).meta.project=e.project,t.meta.id=this.jobId,t.meta.file="output/"+this.files[file_key.seq],serverRequest(fe_reqtype.getJobFile,t,"Inspect sequence data",function(e){i.table.setLabel("<pre>"+e+"</pre>",i.trow-1,1,1,1)},null,"persist")),i},DataSequence.prototype.layCustomDropdownInput=function(e){var t,i=e.customGrid,o=0,n=null;this.makeASUContentInput=function(e){e.setLabel("Number of copies in ASU:",0,0,1,1).setFontItalic(!0),i.ncopies_inp=e.setInputText(this.ncopies,0,1,1,1).setStyle("text","integer","","Specify the anticipated number of sequence copies in asymmetric unit").setWidth_px(50),e.setVerticalAlignment(0,0,"middle")},startsWith(e.layCustom,"asu-content")?(n=i.setGrid("-compact",o++,0,1,2),this.makeASUContentInput(n)):startsWith(e.layCustom,"stoichiometry")?((n=i.setGrid("-compact",o++,0,1,2)).setLabel("Number of copies in a.s.u.:",0,0,1,1).setFontItalic(!0).setNoWrap(!0),t=this.ncopies,"stoichiometry-wauto"==e.layCustom&&this.ncopies_auto&&(t=""),i.ncopies_inp=n.setInputText(t,0,1,1,1).setStyle("text","integer","auto","Specify stoichiometric coefficent for given sequence in the crystal").setWidth_px(50),n.setVerticalAlignment(0,0,"middle"),0<o&&i.setLabel(" ",o,0,1,2).setHeight_px(8)):"chain-input-list"==e.layCustom?("chain_list"in this||(this.chain_list=[]),(n=i.setGrid("-compact",o++,0,1,2)).setLabel("Associated chains:",0,0,1,1).setFontItalic(!0).setNoWrap(!0),i.chain_list_inp=n.setInputText(this.chain_list,0,1,1,1).setStyle("text","","A,B,C,...","Comma-separated list of chains from template structure corresponding to given sequence; put * for all chains in the model (homomeric complexes only)").setWidth_px(200),n.setVerticalAlignment(0,0,"middle")):"texteditor"==e.layCustom&&i.setLabel("&nbsp;",0,0,1,1).setFontItalic(!0).setNoWrap().setHeight_px(34)},DataSequence.prototype.collectCustomDropdownInput=function(e){var t,i=e.customGrid;return startsWith(e.layCustom,"asu-content")||startsWith(e.layCustom,"stoichiometry")?(t=i.ncopies_inp.getValue(),this.ncopies_auto=t.length<=0,this.ncopies_auto||(this.ncopies=parseInt(t))):"chain-input-list"==e.layCustom&&(this.chain_list=i.chain_list_inp.getValue()),""},DataSequence.prototype.subtypeDescription=function(e){switch(e){case"protein":return"(protein)";case"rna":return"(RNA)";case"dna":return"(DNA)"}return DataTemplate.prototype.subtypeDescription.call(this,e)},DataSequence.prototype.ddesc_bridge_word=function(){return" "});var __template=null,structure_subtype=("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.xyz")),{XYZ:"xyz",SUBSTRUCTURE:"substructure",PHASES:"phases"});function DataStructure(){(__template?__template.DataXYZ:DataXYZ).call(this),this._type="DataStructure",this.FP="",this.SigFP="",this.PHI="",this.FOM="",this.FWT="",this.PHWT="",this.DELFWT="",this.PHDELWT="",this.HLA="",this.HLB="",this.HLC="",this.HLD="",this.FreeR_flag="",this.leadKey=0,this.useCoordinates=!0,this.rmsd=.3,this.removeNonAnom=!1,this.useModelSel="",this.initPhaseSel=structure_subtype.XYZ,this.BFthresh=3,this.phaseBlur=1,this.mapSel="diffmap",this.ligands=[],this.refmacLinks=[],this.links=[],this.mapLabels=null,this.refiner=""}DataStructure.prototype=__template?Object.create(__template.DataXYZ.prototype):Object.create(DataXYZ.prototype),DataStructure.prototype.constructor=DataStructure,DataStructure.prototype.title=function(){return"Structure Data"},DataStructure.prototype.icon=function(){return"data"},DataStructure.prototype.currentVersion=function(){return __template?3+__template.DataXYZ.prototype.currentVersion.call(this):3+DataXYZ.prototype.currentVersion.call(this)},DataStructure.prototype.isSubstructure=function(){return 0<=this.subtype.indexOf(structure_subtype.SUBSTRUCTURE)},DataStructure.prototype.hasPhases=function(){return 0<=this.subtype.indexOf(structure_subtype.PHASES)},DataStructure.prototype.hasXYZ=function(){return 0<=this.subtype.indexOf(structure_subtype.XYZ)},DataStructure.prototype.phaseType=function(){switch(this.leadKey){case 1:return this.isSubstructure()?"Calculated from substructure coordinates":"Calculated from macromolecular model";case 2:return"Calculated via Experimental Phasing"}return"Not phased"},__template?(module.exports.DataStructure=DataStructure,module.exports.structure_subtype=structure_subtype):(DataStructure.prototype.getCellParameters=function(){return DataXYZ.prototype.getCellParameters.call(this)},DataStructure.prototype.getSpaceGroup=function(){return DataXYZ.prototype.getSpaceGroup.call(this)},DataStructure.prototype.makeDataSummaryPage=function(e){var t=DataXYZ.prototype.makeDataSummaryPage.call(this,e);return this.files.hasOwnProperty(file_key.sol)&&t.makeRow("Phaser's SOL file",this.files[file_key.sol],"SOL file with phaser's output metadata"),this.files.hasOwnProperty(file_key.coot)&&t.makeRow("Molprobity's script",this.files[file_key.coot],"Coot script with molprobity data"),this.files.hasOwnProperty(file_key.molp)&&t.makeRow("MolProbity probe",this.files[file_key.molp],'MolProbity "probe" file'),this.files.hasOwnProperty(file_key.mtz)&&t.makeRow("MTZ file",this.files[file_key.mtz],"Associated MTZ file name"),this.files.hasOwnProperty(file_key.map)&&t.makeRow("Map file",this.files[file_key.map],"Name of file with electron density map"),this.files.hasOwnProperty(file_key.dmap)&&t.makeRow("Difference map file",this.files[file_key.dmap],"Name of file with difference map"),this.files.hasOwnProperty(file_key.lib)&&t.makeRow("Restraints file",this.files[file_key.lib],"Name of file with crystallogtaphic restraints"),0<this.ligands.length&&t.makeRow("Ligand descriptions",this.ligands.join(", "),"Codes of ligands found in ligand library"),0<this.refmacLinks.length&&t.makeRow("Links with description",this.refmacLinks.join(", "),"Formulas (Residue1.Atom1-Atom2.Residue2) for covalent links with descripton (LINKR)"),0<this.links.length&&t.makeRow("Links without description",this.links.join(", "),"Formulas (Residue1.Atom1-Atom2.Residue2) for covalent links without descripton (LINK)"),this.hasPhases()&&t.makeRow("Phases' type",this.phaseType(),"Type of phasing method used to calculate phases"),t.addViewHKLButton(e),t},DataStructure.prototype.layCustomDropdownInput=function(e){var o=e.customGrid,t=o.getNRows();function n(e,t,i){o.setLabel(e,t,i,1,1).setFontItalic(!0).setNoWrap(),o.setVerticalAlignment(t,i,"middle")}function i(e,t,i){n("Eliminate residues with B-factors higher than ",e,t),o.BFthresh=o.setInputText(i,e,t+1,1,1).setStyle("text","real","3.0","Threshold value for acceptable B-factors").setWidth_px(30),n("&sigma; above the mean",e,t+2)}if(startsWith(e.layCustom,"phaser-ep"))0<=this.subtype.indexOf(structure_subtype.XYZ)&&(n("Assumed r.m.s.d. from target:",t,0),o.rmsd=o.setInputText(this.rmsd,t,1,1,1).setStyle("text","real","0.3","Estimated difference between given model and target structure, in &Aring;.").setWidth_px(60),o.setVerticalAlignment(t,1,"middle"));else if("buccaneer-ws"==e.layCustom)0<=this.subtype.indexOf(structure_subtype.XYZ)&&(n("Use model to place and name chains, and&nbsp;",t,0),o.useModelSel=new Dropdown,o.useModelSel.setWidth("120%"),o.useModelSel.addItem("nothing else","","N",!this.useModelSel||"mr-model-fixed"==this.useModelSel||"N"==this.useModelSel),o.useModelSel.addItem("seed chain growing","","mr-model-seed","mr-model-seed"==this.useModelSel),o.useModelSel.addItem("provide initial model","","mr-model-filter","mr-model-filter"==this.useModelSel),o.setWidget(o.useModelSel,t,1,1,2),o.useModelSel.make(),i(++t,0,this.BFthresh),o.setLabel(" ",++t,0,1,2).setHeight_px(8));else if("buccaneer-xm"==e.layCustom)0<=this.subtype.indexOf(structure_subtype.XYZ)&&i(t,0,this.BFthresh);else if("nautilus"==e.layCustom)0<=this.subtype.indexOf(structure_subtype.XYZ)&&(n("Current model:",t,0),o.useModelSel=new Dropdown,o.useModelSel.setWidth("120%"),o.useModelSel.addItem("ignore","","N","N"==this.useModelSel),o.useModelSel.addItem("consider fixed","","mr-model-fixed","N"!=this.useModelSel||"mr-model-fixed"==this.useModelSel),o.setWidget(o.useModelSel,t,1,1,2),o.useModelSel.make());else if(0<=["acorn","arpwarp"].indexOf(e.layCustom)){var s=[];if(0<=this.subtype.indexOf(structure_subtype.XYZ)&&s.push(["model coordinates",structure_subtype.XYZ]),0<=this.subtype.indexOf(structure_subtype.PHASES)&&s.push(["phases",structure_subtype.PHASES]),"acorn"==e.layCustom&&0<=this.subtype.indexOf(structure_subtype.SUBSTRUCTURE)&&s.push(["substructure coordinates",structure_subtype.SUBSTRUCTURE]),1<s.length){n("Obtain density from",t,0),o.initPhaseSel=new Dropdown,o.initPhaseSel.setWidth("240px");for(var a=0;a<s.length;a++)o.initPhaseSel.addItem(s[a][0],"",s[a][1],this.initPhaseSel==s[a][1]);o.setWidget(o.initPhaseSel,t,1,1,4),o.initPhaseSel.make()}else o.initPhaseSel=null;"acorn"==e.layCustom&&o.setLabel(" ",++t,0,1,2).setHeight_px(8)}else startsWith(e.layCustom,"chain-sel")||startsWith(e.layCustom,"cell-info")?DataXYZ.prototype.layCustomDropdownInput.call(this,e):startsWith(e.layCustom,"map-sel")&&(this.hasOwnProperty("mapSel")||(this.mapSel="diffmap"),n("Use map:",t,0),o.mapSel=new Dropdown,this.DELFWT&&this.PHDELWT||2!=this.leadKey?(this.FWT&&this.PHI&&o.mapSel.addItem("2Fo-Fc","","directmap","directmap"==this.mapSel),this.DELFWT&&this.PHDELWT&&o.mapSel.addItem("Fo-Fc","","diffmap","diffmap"==this.mapSel)):o.mapSel.addItem("experimental","","directmap",!0),o.setWidget(o.mapSel,t,1,1,4),o.mapSel.make())},DataStructure.prototype.collectCustomDropdownInput=function(e){var t=e.customGrid;return startsWith(e.layCustom,"phaser-ep")?0<=this.subtype.indexOf(structure_subtype.XYZ)&&(this.rmsd=t.rmsd.getValue()):"buccaneer-ws"==e.layCustom?0<=this.subtype.indexOf(structure_subtype.XYZ)&&(this.useModelSel=t.useModelSel.getValue(),this.BFthresh=t.BFthresh.getValue()):"buccaneer-xm"==e.layCustom?0<=this.subtype.indexOf(structure_subtype.XYZ)&&(this.BFthresh=t.BFthresh.getValue()):"nautilus"==e.layCustom?0<=this.subtype.indexOf(structure_subtype.XYZ)&&(this.useModelSel=t.useModelSel.getValue()):0<=["acorn","arpwarp"].indexOf(e.layCustom)?t.initPhaseSel?this.initPhaseSel=t.initPhaseSel.getValue():0<=this.subtype.indexOf(structure_subtype.XYZ)?this.initPhaseSel=structure_subtype.XYZ:"arpwarp"==e.layCustom?this.initPhaseSel=structure_subtype.PHASES:0<=this.subtype.indexOf(structure_subtype.SUBSTRUCTURE)?this.initPhaseSel=structure_subtype.SUBSTRUCTURE:0<=this.subtype.indexOf(structure_subtype.PHASES)?this.initPhaseSel=structure_subtype.PHASES:this.initPhaseSel="":startsWith(e.layCustom,"chain-sel")?DataXYZ.prototype.collectCustomDropdownInput.call(this,e):startsWith(e.layCustom,"map-sel")&&(this.mapSel=t.mapSel.getValue()),""},DataStructure.prototype.dataDialogHints=function(e,t){var i=["Have imported a PDB or mmCIF file with coordinates and wonder why <i>\"Structure\"</i> data type is not available to the task? <a href=\"javascript:launchHelpBox('Structure and XYZ','./html/jscofe_faq_structure_xyz.html',null,10)\"><i>"+String("Check here").fontcolor("blue")+"</i></a>."];return 0<e.length&&i.push('If you are certain that you have <i>"Structure"</i> data produced in one of jobs up the current branch of the job tree, make sure that it has a suitable subtype as shown in brackets : ('+e.join(",")+'). For example, subtype "protein" means that the structure must contain aminoacid chain(s).'),i});var __template=null;function DataUnmerged(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataUnmerged",this.ha_type="",this.symm_select=[],this.runs=""}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),DataUnmerged.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataUnmerged.prototype.constructor=DataUnmerged,DataUnmerged.prototype.title=function(){return"Unmerged Data"},DataUnmerged.prototype.icon=function(){return"data"},DataUnmerged.prototype.currentVersion=function(){return __template?0+__template.DataTemplate.prototype.currentVersion.call(this):0+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataUnmerged=DataUnmerged:(DataUnmerged.prototype.makeDataSummaryPage=function(e){for(var t=new DataSummaryPage(this),i=(t.makeRow("File name",this.files[file_key.mtz],"Imported file name"),t.makeRow("Original dataset name",this.dataset.name,"Original dataset name"),t.makeRow("Resolution (&Aring;)",this.dataset.reso,"Dataset resolution"),t.makeRow("Wavelength",this.dataset.wlen,"Wavelength"),"HM"in this?t.makeRow("Space group",this.HM,"Space symmetry group"):t.makeRow("Space group","Unspecified","Space symmetry group"),"Not specified"),o=("cell"in this.dataset&&(i=this.dataset.cell[0]+"&nbsp;"+this.dataset.cell[1]+"&nbsp;"+this.dataset.cell[2]+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+this.dataset.cell[3]+"&nbsp;"+this.dataset.cell[4]+"&nbsp;"+this.dataset.cell[5]),t.makeRow("Cell",i,"Unit cell parameters"),""),n=0;n<this.dataset.runs.length;n++)o+="["+this.dataset.runs[n][1]+","+this.dataset.runs[n][2]+"]&nbsp;";return t.makeRow("Batches",o,"Batch ranges"),t},DataUnmerged.prototype.layCustomDropdownInput=function(e){var t=e.customGrid;if(startsWith(e.layCustom,"unmerged")){var i=0;if("unmerged-ref"==e.layCustom){e=$.extend(!0,{},this.dataset.symm);t.combosel=new ComboDropdown(e,[230,200,180],0),t.setWidget(t.combosel,i++,0,1,2)}else{t.setLabel("Batches:",i,0,1,1).setFontItalic(!0).setWidth("70px"),t.setVerticalAlignment(i,0,"middle");for(var o=[],n=0;n<this.dataset.runs.length;n++)o.push(this.dataset.runs[n][1]+"-"+this.dataset.runs[n][2]);e="Available batches: "+o.join(", ");t.runs=t.setInputText(this.runs,i,1,1,1).setTooltip1(e,"slideDown",!0,5e3).setWidth("440px"),t.setCellSize("50px","",i,0)}t.setLabel(" ",i+1,0,1,2).setHeight_px(8)}},DataUnmerged.prototype.collectCustomDropdownInput=function(e){var t="",i=e.customGrid;if(startsWith(e.layCustom,"unmerged"))if("unmerged-ref"==e.layCustom)this.dataset.symm=i.combosel.content,this.symm_select=i.combosel.getValues();else{this.runs=i.runs.getValue().trim();var o=0==this.runs.length;if(!o&&(o=/^\s*(\d+\s*(-\s*\d+\s*)?(,\s*\d+\s*(-\s*\d+\s*)?)*)?$/.test(this.runs))){var n=this.runs.replace(/[, \-]+/g,",").split(","),e=n.slice(0);if(e.sort(function(e,t){return e-t}),o=n.toString()==e.toString())for(var s,a=n[0],r=1;r<n.length;r++)s=a,a=n[r],o=o&&s!=a}o||(t="|<b><i>Incorrect batch selection:</i>&nbsp;"+this.runs+"</b><br><br>An example of a correct selection:<br>1-101, 110, 111, 112, 121-222<br>")}return t});var __template=null;function DataXRayImages(){(__template?__template.DataTemplate:DataTemplate).call(this),this._type="DataXRayImages"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.dtypes.template")),DataXRayImages.prototype=__template?Object.create(__template.DataTemplate.prototype):Object.create(DataTemplate.prototype),DataXRayImages.prototype.constructor=DataXRayImages,DataXRayImages.prototype.title=function(){return"X-Ray Diffraction Images"},DataXRayImages.prototype.icon=function(){return"data_xrayimages"},DataXRayImages.prototype.currentVersion=function(){return __template?0+__template.DataTemplate.prototype.currentVersion.call(this):0+DataTemplate.prototype.currentVersion.call(this)},__template?module.exports.DataXRayImages=DataXRayImages:DataXRayImages.prototype.inspectData=function(e){new MessageBox("Not implemented","XRayImages Data Viewer not Implemented.")};const job_code={new:"new",running:"running",ending:"ending",exiting:"exiting",finished:"finished",noresults:"noresults",failed:"failed",stopped:"stopped",remark:"remark",remdet:"remdet",remdoc:"remdoc",retired:"retired"},input_mode={standard:"standard",root:"root"},jobDataFName="job.meta",jobReportDirName="report",jobInputDirName="input",jobOutputDirName="output",jobReportHTMLName="index.html",jobReportTaskName="task.tsk",keyEnvironment=["CCP4","BALBES_ROOT","ROSETTA_DIR","warpbin","BDG_home","XDS_home","XDSGUI_home","DOCREPO","ALPHAFOLD_CFG","$CCP4/bin/shelxe","$CCP4/bin/shelxe.exe","$CCP4/share/mrd_data/VERSION","$CCP4/lib/py2/morda/LINKED","Xia2_durin","$CCP4_MASTER/BORGES_LIBS"];var dbx=null,comut=null,fs,path,utils,prj,conf,uh,fcl;function TaskTemplate(){this._type="TaskTemplate",this.version=this.currentVersion(),this.project="",this.id=0,this.parentId=0,this.treeItemId="",this.name="template",this.uname="",this.title="Template",this.setOName("template"),this.uoname="",this.state=job_code.new,this.nc_type="ordinary",this.fasttrack=!1,this.inputMode=input_mode.standard,this.autoRunName="",this.autoRunId="",this.informFE=!0,this.upload_files=[],this.input_dtypes=[],this.file_select=[],this.input_ligands=[],dbx?(this.input_data=new dbx.DataBox,this.output_data=new dbx.DataBox):(this.input_data=new DataBox,this.output_data=new DataBox),this.parameters={},this.layCustom={},this.job_dialog_data={position:{my:"center top",at:"center top+5%"},width:0,height:0,panel:"input",job_token:0,viewed:!0},this.associated=[],this.harvestedTaskIds=[],this.disk_space=0,this.cpu_time=0}function update_project_metrics(e,t){if(e){"R_free"in t||(t.R_free=2,t.R_factor=2);var i=null;if("output_data"in e&&"DataRevision"in e.output_data.data&&(i=e.output_data.data.DataRevision[0]),"scores"in e)for(var o in e.scores){o=e.scores[o];if("R_free"in o){var n=parseFloat(o.R_free);if(o.R_free<t.R_free&&(t.R_free=n,t.R_factor=parseFloat(o.R_factor),t.jobId=e.id,i)){t.SG=i.HKL.dataset.HM,t.res_high=i.HKL.dataset.RESO[1],t.res_low=i.HKL.dataset.RESO[0],t.Solvent=i.ASU.solvent,t.MolWeight=i.ASU.molWeight,t.nRes_ASU=i.ASU.nRes,"ha_type"in i.ASU?t.ha_type=i.ASU.ha_type:t.ha_type="";for(var s=0,a=0;a<i.ASU.seq.length;a++)s+=i.ASU.seq[a].ncopies;if(t.nUnits_ASU=s,"Structure"in i&&i.Structure){var r=0,l=i.Structure.xyzmeta.xyz;if(0<l.length)for(a=0;a<l[0].chains.length;a++)r+=l[0].chains[a].size;t.nRes_Model=r,t.nUnits_Model=l[0].chains.length}else t.nRes_Model=0,t.nUnits_Model=0}}}}}function _make_label(e,t,i,o,n,s,a,r){return e.parameters[t]={},e.parameters[t].ref=i,e.parameters[t].ref.visible=!0,e.parameters[t].ref._visible=!0,i.hasOwnProperty("lwidth")&&0==i.lwidth?s:(e.parameters[t].label=o.addLabel(i.label,n,s,a,r).setNoWrap(),i.hasOwnProperty("tooltip")&&e.parameters[t].label.setTooltip(i.tooltip),i.hasOwnProperty("lwidth")&&(endsWith(i.lwidth.toString(),"%")?(e.parameters[t].label.setWidth(i.lwidth),o.setCellSize(i.lwidth,"",n,s)):(e.parameters[t].label.setWidth_px(i.lwidth),o.setCellSize(i.lwidth+"px","",n,s))),o.setVerticalAlignment(n,s,"middle"),i.hasOwnProperty("align")&&(e.parameters[t].label.setHorizontalAlignment(i.align),o.setHorizontalAlignment(n,s,i.align)),"label"!=i.type&&(e.parameters[t].sep=o.addLabel("",n,s+1,1,1).setWidth_px(1),o.setCellSize("1px","",n,s+1)),i.hasOwnProperty("label2")&&("label"!=i.type&&(e.parameters[t].sep2=o.addLabel("",n,s+3,1,1).setWidth_px(1),o.setCellSize("1px","",n,s+3)),e.parameters[t].label2=o.addLabel(i.label2,n,s+4,a,1).setNoWrap(),i.hasOwnProperty("tooltip2")&&e.parameters[t].label.setTooltip(i.tooltip2),i.hasOwnProperty("lwidth2")&&(endsWith(i.lwidth2.toString(),"%")?(e.parameters[t].label2.setWidth(i.lwidth2),o.setCellSize(i.lwidth2,"",n,s+4)):(e.parameters[t].label2.setWidth_px(i.lwidth2),o.setCellSize(i.lwidth2+"px","",n,s+4))),o.setVerticalAlignment(n,s+4,"middle"),i.hasOwnProperty("align2")&&(e.parameters[t].label2.setHorizontalAlignment(i.align2),o.setHorizontalAlignment(n,s,i.align2))),s+2)}"undefined"!=typeof module&&void 0!==module.exports&&(dbx=require("../dtypes/common.dtypes.box"),comut=require("../common.utils")),TaskTemplate.prototype.icon=function(){return"process"},TaskTemplate.prototype.desc_title=function(){return""},TaskTemplate.prototype.taskDescription=function(){return""},TaskTemplate.prototype.platforms=function(){return"WLMU"},TaskTemplate.prototype.lowestClientVersion=function(){return"0.0.0 [0.0.0]"},TaskTemplate.prototype.authorisationID=function(){return""},TaskTemplate.prototype.requiredEnvironment=function(){return["CCP4"]},TaskTemplate.prototype.doNotPackSuffixes=function(){return[".map"]},TaskTemplate.prototype.doPackSuffixes=function(){return[""]},TaskTemplate.prototype.canEndGracefully=function(){return!1},TaskTemplate.prototype.getHelpURL=function(){return __task_reference_base_url+"doc.task."+this._type.substr(4)+".html"},TaskTemplate.prototype.getInputMode=function(){return"inputMode"in this||(1==this.input_dtypes.length&&1==this.input_dtypes[0]?this.inputMode=input_mode.root:this.inputMode=input_mode.standard),this.inputMode},TaskTemplate.prototype.cloneItems=function(){return[]},TaskTemplate.prototype.hotButtons=function(){return[]},TaskTemplate.prototype.currentVersion=function(){return 1},TaskTemplate.prototype.isRemark=function(){return this.state==job_code.remark||this.state==job_code.remdet||this.state==job_code.remdoc},TaskTemplate.prototype.isLink=function(){return!1},TaskTemplate.prototype.isRunning=function(){return this.state==job_code.running||this.state==job_code.exiting},TaskTemplate.prototype.isComplete=function(){return this.state!=job_code.new&&this.state!=job_code.running&&this.state!=job_code.ending&&this.state!=job_code.exiting},TaskTemplate.prototype.isSuccessful=function(){return this.state!=job_code.new&&this.state!=job_code.running&&this.state!=job_code.ending&&this.state!=job_code.exiting&&this.state!=job_code.failed&&this.state!=job_code.stopped&&this.state!=job_code.retired},TaskTemplate.prototype.__check_keywords=function(e,t){for(var i=!e||0==e.length,o=0;o<t.length&&!i;o++)for(var n=0;n<e.length&&!i;n++)i=t[o].startsWith(e[n]);return i},TaskTemplate.prototype.checkKeywords=function(e){return this.__check_keywords(e,["template"])},TaskTemplate.prototype.cpu_credit=function(){return.02},TaskTemplate.prototype._clone_suggested=function(e,t){for(var i in e)i in t?(e[i].value=t[i],"label"in e[i]&&(e[i].label="<font style='color:darkblue'><i>"+e[i].label+"</i></font>"),"label2"in e[i]&&(e[i].label2="<font style='color:darkblue'><i>"+e[i].label2+"</i></font>")):comut?comut.isObject(e[i])&&this._clone_suggested(e[i],t):isObject(e[i])&&this._clone_suggested(e[i],t)},dbx?(fs=require("fs-extra"),path=require("path"),utils=require("../../js-server/server.utils"),prj=require("../../js-server/server.fe.projects"),conf=require("../../js-server/server.configuration"),uh=require("../../js-server/server.fe.upload_handler"),fcl=require("../../js-server/server.fe.facilities"),TaskTemplate.prototype.setOName=function(e){this.oname=e},TaskTemplate.prototype.getNCores=function(e){return 1},TaskTemplate.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.template",e,t]},TaskTemplate.prototype.addInputFile=function(t,e,i){t=prj.getSiblingJobDirPath(i,t),t=prj.getOutputFilePath(t,e),i=prj.getInputFilePath(i,e);try{fs.copySync(t,i)}catch(e){console.log(" *** cannot copy file "+t+" to "+i),console.log("     error: "+e)}},TaskTemplate.prototype.__prepare_file=function(e,t,i){if(0<e.length){var o=e.split("/");if(2<o.length&&"cloudstorage::"==o[0]){for(var n=null,s=0;s<t.length&&!n;s++)t[s][0]==o[1]&&(n=path.join(t[s][1],o.slice(2).join("/")));if(n){i=path.join(i,o[o.length-1]);try{fs.copySync(n,i)}catch(e){console.log(" ***** cannot copy file "+n+"\n                   to "+i),console.log("       error: "+e)}}else console.log(" ***** path "+e+" not found")}}},TaskTemplate.prototype.__make_input_data_root=function(e,t){if("cloud"==this.file_system){for(var i=path.join(t,uh.uploadDir()),o=(utils.writeObject(path.join(t,"annotation.json"),this.file_mod)||console.log(' ***** cannot write "annotation.json" in '+i),utils.fileExists(i)||utils.mkDir(i)||console.log(" ***** cannot create directory "+i),fcl.getUserCloudMounts(e)),n=0;n<this.file_select.length;n++)this.__prepare_file(this.file_select[n].path,o,i);for(n=0;n<this.file_mod.annotation.length;n++){utils.removeFile(path.join(i,this.file_mod.annotation[n].file));for(var s=0;s<this.file_mod.annotation[n].items.length;s++){var a=this.file_mod.annotation[n].items[s].rename;utils.writeString(path.join(i,a),this.file_mod.annotation[n].items[s].contents)}}}},TaskTemplate.prototype.__make_input_data_standard=function(e,t){for(var i in this.input_data.data)for(var o=this.input_data.data[i],n=0;n<o.length;n++)if(o[n]){var s,a=prj.getSiblingJobDirPath(t,o[n].jobId);for(s in o[n].files)if(o[n].files.hasOwnProperty(s)){var r=o[n].files[s];if(r){for(var l=!0,c=this.doNotPackSuffixes(),d=0;d<c.length&&l;d++)l=!r.endsWith(c[d]);for(var h=this.doPackSuffixes(),d=0;d<h.length&&!l;d++)l=r.endsWith(h[d]);if(l){var u=prj.getOutputFilePath(a,r),p=prj.getInputFilePath(t,r);try{fs.copySync(u,p)}catch(e){console.log(" *** cannot copy file "+u+"\n                   to "+p+"\n           for object "+o[n]._type+" : "+o[n].dname),console.log("     error: "+e)}}}}}else console.log(" *** empty data object in "+this._type+".makeInputData,dtype="+i)},TaskTemplate.prototype.makeInputData=function(e,t){this.inputMode==input_mode.root?this.__make_input_data_root(e,t):this.__make_input_data_standard(e,t);e=path.join(t,"input","databox.meta");utils.writeObject(e,this.input_data)},TaskTemplate.prototype.makeOutputData=function(e){e=path.join(e,"output","databox.meta"),e=utils.readClass(e);this.output_data=e||new dbx.DataBox},TaskTemplate.prototype.cleanJobDir=function(e){var t=path.join(e,"input"),i=path.join(t,"databox.meta"),o=utils.readString(i);utils.removePath(t),utils.mkDir_anchor(t),utils.writeString(i,o),utils.removeFiles(e,[".mtz",".map",".pdb",".seq",".fasta",".pir",".seq.txt",".fasta.txt",".pir.txt",".cif",".mmcif",".ent",".pdbx","rvapi_document"]),utils.removePath("search_a"),utils.removePath("coot-backup"),utils.removePath("coot-download")},module.exports.job_code=job_code,module.exports.input_mode=input_mode,module.exports.jobDataFName=jobDataFName,module.exports.jobReportDirName=jobReportDirName,module.exports.jobInputDirName=jobInputDirName,module.exports.jobOutputDirName=jobOutputDirName,module.exports.jobReportHTMLName=jobReportHTMLName,module.exports.jobReportTaskName=jobReportTaskName,module.exports.keyEnvironment=keyEnvironment,module.exports.TaskTemplate=TaskTemplate):(TaskTemplate.prototype.onJobDialogStart=function(e){},TaskTemplate.prototype.onJobDialogClose=function(e,t){t(!0)},TaskTemplate.prototype.setOName=function(e){var t;e&&"*"!=e?(this.oname="",__current_page&&"ProjectPage"==__current_page._type&&(t=__current_page.jobTree.projectData)&&(__user_settings.hasOwnProperty("project_prefix")&&__user_settings.project_prefix&&0==t.settings.prefix_key?this.oname=t.desc.name:this.oname=t.settings.prefix),this.oname&&(this.oname+="_"),this.oname+=e):this.oname=e},TaskTemplate.prototype.compareEnvironment=function(e,t){for(var i=!0,o=0;o<e.length&&i;o++)if(e[o].constructor===Array)for(var i=!1,n=0;n<e[o].length&&!i;n++)i=0<=t.indexOf(e[o][n]);else i=0<=t.indexOf(e[o]);return i},TaskTemplate.prototype.checkEnvironment=function(e){return this.compareEnvironment(this.requiredEnvironment(),e)},TaskTemplate.prototype.isTaskAvailable=function(){if("client"!=this.nc_type&&0<=__exclude_tasks.indexOf(this._type))return["server-excluded","task is not available on "+appName()+" server","<h3>Task is not available on server</h3>The task is excluded from configuration on "+appName()+" server which you use.<br>This may be due to the availability of software or resources, which are <br>required for the task."];if(0<=__exclude_tasks.indexOf("unix-only")&&this.platforms().indexOf("W")<0)return["windows-excluded","task is not available on MS Windows systems","<h3>Task is not available on MS Windows systems</h3>The task is based on program components that are not suitable for MS Windows,<br>and, therefore, cannot be run."];if("client"==this.nc_type&&!__local_service)return __any_mobile_device?["client","task is not available on mobile devices","<h3>CCP4 Cloud Client is required</h3>This task cannot be used when working with "+appName()+" from mobile devices.<br>In order to use the task, access "+appName()+" via CCP4 Cloud Client,<br>found in CCP4 Software Suite."]:["client","task is available only if started via CCP4 Cloud Client","<h3>CCP4 Cloud Client is required</h3>This task can be used only if "+appName()+" was accessed via CCP4 Cloud Client,<br>found in CCP4 Software Suite."];if("client-storage"==this.nc_type&&!__local_service&&!__cloud_storage)return["client-storage","task is available only if started via CCP4 Cloud Client or if Cloud Storage is configured","<h3>CCP4 Cloud Client is required</h3>This task can be used only if "+appName()+" was accessed via CCP4 Cloud Client,<br>found in CCP4 Software Suite, or if user has access to Cloud Storage."];if(startsWith(this.nc_type,"client")){if(__local_service&&compareVersions(__client_version,this.lowestClientVersion())<0)return["client-version","task requires a higher version of CCP4 Cloud Client (update CCP4 on your device)","<h3>Too low version of CCP4 Cloud Client</h3>This task requires a higher version of CCP4 Cloud Client.<br>Please update CCP4 Software Suite on your device."];if(!("client"!=this.nc_type&&__cloud_storage||this.checkEnvironment(__environ_client)))return["environment-client","task software is not installed on your device","<h3>Task software is not installed on your device</h3>The task is to run on your device, but needful software is not installed on it.<br>Consult software documentation for further details."]}else{var e=this.authorisationID();if(e&&!__local_user&&(!(e in __user_authorisation)||!__user_authorisation[e].auth_date))return __auth_software&&e in __auth_software?["authorisation","task requires authorisation from "+__auth_software[this.authorisationID()].desc_provider+' (available in "My Account")',"<h3>Authorisation is required</h3>This task requires authorisation from "+__auth_software[this.authorisationID()].desc_provider+',<br>which may be obtained in "My Account" page.']:["authorisation","task requires authorisation, which is not configured","<h3>Authorisation is required</h3>This task requires authorisation, which is not available ,<br>due to server misconfiguration."]}return"client"==this.nc_type||this.checkEnvironment(__environ_server)?["ok","",""]:__local_setup?["environment-server","task software is not installed","<h3>Task software is not installed</h3>Software, needed to run the task, is not available in "+appName()+" setup, which you use.<br>Contact your software maintainer for further details."]:["environment-server","task software is not installed on "+appName()+" server","<h3>Task software is not installed on server</h3>Software, needed to run the task, is not installed on "+appName()+" server, which you use.<br>Contact server maintainer for further details."]},TaskTemplate.prototype.canClone=function(e,t){return"ok"==this.isTaskAvailable()[0]&&!t.in_archive},TaskTemplate.prototype.isArchived=function(){return"archive_version"in this&&0<this.archive_version},TaskTemplate.prototype.canMove=function(e,t){return!this.isArchived()&&(this.state!=job_code.new&&this.state!=job_code.running&&this.state!=job_code.exiting&&0<t.getNodePosition(e)[0])},TaskTemplate.prototype.addDataDialogHints=function(e,t){return t},TaskTemplate.prototype.getProjectURL=function(e,t){var i=__login_token||"404";return __special_url_tag+"/"+i+"/"+this.project+"/"+e+"/"+t},TaskTemplate.prototype.getURL=function(e){var t=__login_token||"404";return __special_url_tag+"/"+t+"/"+this.project+"/"+this.id+"/"+e},TaskTemplate.prototype.getLocalReportPath=function(){return"report/index.html"},TaskTemplate.prototype.getReportURL=function(){var e=__login_token||"404";return __special_url_tag+"/"+e+"/"+this.project+"/"+this.id+"/"+this.getLocalReportPath()},TaskTemplate.prototype.makeInputPanelHeader=function(){function e(e,t,i){e=s.setLabel(e,t,i,1,1).setFontItalic(!0).setNoWrap().setHeight("1em");return s.setVerticalAlignment(t,i,"middle"),s.setCellSize("2%","",t,i),e}function t(e,t,i,o){var n=e.indexOf("<b>"),e=((n=n<0?e.indexOf(" -- "):n)<0&&(n=e.length),s.setInputText(e.substring(0,n).trim(),i,o,1,1).setStyle("text","",t.replace(/<(?:.|\n)*?>/gm,"")));return s.setVerticalAlignment(i,o,"middle"),s.setCellSize("98%","",i,o),e}var i=this.taskDescription(),o=3,n="80px",s=(i&&(o=4,n="100px"),new Grid("")),n=(s.task_icon=s.setImage(image_path(this.icon()),"",n,0,0,o,1),s.setLabel(" ",0,1,o,1).setWidth_px(20).setHeight("0.5em"),0),a=this.title;return"*"==this.oname&&(a+="<sup>&nbsp;</sup>"),s.title=s.setLabel("<b>"+a+"</b>",n++,2,1,2).setFontSize("150%").setNoWrap(),i&&(s.desc_lbl=s.setLabel(i,n++,0,1,2).setFontSize("85%").setFontItalic(!0).setNoWrap()),s.uname_lbl=e("job description:&nbsp;",n,0),s.setVerticalAlignment(n,0,"middle"),s.uname_inp=t(this.uname.trim(),this.name,n++,1).setWidth("90%").setTooltip("A single-line description of the job, which will appear in the Project Tree. The description can be changed before or after running the job."),"*"!=this.oname&&(s.uoname_lbl=e("output id:&nbsp;",n,0),s.setVerticalAlignment(n,0,"middle"),s.uoname_inp=t(this.uoname.trim(),this.oname,n,1).setWidth_px(200).setTooltip("Base name for output files, produced by the job. Custom names may help data identification in subsequent tasks")),s.setHLine(1,o,0,1,4),s},TaskTemplate.prototype.makeInputLayout=function(){var e,t=new Widget("div");return t.header=this.makeInputPanelHeader(),t.addWidget(t.header),t.setScrollable("hidden","hidden"),t.panel=new Widget("div"),t.addWidget(t.panel),t.grid=new Grid("-compact"),t.panel.addWidget(t.grid),t.panel.setScrollable("auto","auto"),(t.grid.inputPanel=t).fullVersionMismatch=!1,"uname_inp"in t.header&&(e=this,t.header.uname_inp.element.oninput=function(){e.uname=t.header.uname_inp.getValue().trim(),t.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node)},t.header.uname_inp.element.onpropertychange=t.header.uname_inp.element.oninput),t},TaskTemplate.prototype.makeInputPanel=function(e){e.data.DataRemove=[new DataRemove];var t=this.makeInputLayout();return t.grid.setVisible(!1),this.inputMode==input_mode.root?(0<this.file_select.length&&this.makeFileSelectLayout(t),0<this.input_ligands.length&&this.makeLigandsLayout(t)):this.setInputDataFields(t.grid,0,e,this),this.layParameters(t.grid,t.grid.getNRows()+1,0),t},TaskTemplate.prototype.updateInputPanel=function(e){},TaskTemplate.prototype.collectInput=function(e){var t="";return e.hasOwnProperty("header")&&(e.header.hasOwnProperty("uname_inp")&&(this.uname=e.header.uname_inp.getValue().trim(),e.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node)),e.header.hasOwnProperty("uoname_inp")&&(this.uoname=e.header.uoname_inp.getValue())),this.inputMode==input_mode.root?(0<this.file_select.length&&(t=this.collectFileSelects(e)),0<this.input_ligands.length&&(t+=this.collectInputLigands(e))):t=this.collectInputData(e),t&&(t+="|"),t+=this.collectParameterValues(e)},TaskTemplate.prototype.sendInputStateEvent=function(e){e.emitSignal(cofe_signals.taskReady,this.collectInput(e))},TaskTemplate.prototype.sendTaskStateSignal=function(e,t){e.emitSignal(cofe_signals.taskReady,t)},TaskTemplate.prototype.runButtonName=function(){return"Run"},TaskTemplate.prototype.__set_selected_files=function(e,t,i){var o,n,s;0<e.length&&(o={rename:{},annotation:[]},n=e[0].name,s=(n="cloud"==i.file_system?"cloudstorage::/"+this.currentCloudPath+"/"+n:n).slice(1+(n.lastIndexOf(".")-1>>>0)).toLowerCase(),0<=[".sca",".seq",".pir",".fasta"].indexOf(s)?_import_checkFiles(e,o,i.upload_files,function(){"scalepack"in o?i.customData.file_mod.scalepack=o.scalepack:(i.customData.file_mod.rename=o.rename,i.customData.file_mod.annotation=o.annotation),t.setValue(n)}):t.setValue(n))},TaskTemplate.prototype.makeFileSelectLayout=function(n){n.customData={},n.customData.login_token=__login_token,n.customData.project=this.project,n.customData.job_id=this.id,"file_system"in this||(this.file_system="local",this.currentCloudPath=""),n.file_system=this.file_system,"file_mod"in this?n.customData.file_mod=this.file_mod:n.customData.file_mod={rename:{},annotation:[]},n.upload_files=[];var e=n.grid.getNRows();n.grid.setLabel("Import data from",e,0,1,1).setTooltip("Specify data location").setFontItalic(!0).setFontBold(!0).setNoWrap();n.itext=[],n.source_select_ddn=new Dropdown,n.grid.addWidget(n.source_select_ddn,e,2,1,2),n.source_select_ddn.addItem("local file system","","local","local"==n.file_system),n.source_select_ddn.addItem("cloud storage","","cloud","cloud"==n.file_system),n.source_select_ddn.make(),n.source_select_ddn.addOnChangeListener(function(e,t){n.file_system=t;for(var i=0;i<n.itext.length;i++)n.itext[i].setValue("")}),n.source_select_ddn.setWidth("180px"),n.grid.setVerticalAlignment(e++,0,"middle"),n.grid.setLabel("&nbsp;",e++,0,1,1).setHeight_px(8);for(var t=0;t<this.file_select.length;t++){var i=this.file_select[t],o=(n.grid.setLabel(i.label,e,0,1,1).setTooltip(i.tooltip).setFontItalic(!0).setFontBold(!0).setNoWrap(),n.grid.setVerticalAlignment(e,0,"middle"),n.grid.setSelectFile(!1,i.file_types,e,2,1,1)),s=(o.hide(),n.grid.addButton("Browse",image_path("open_file"),e,2,1,1)),a=i.path,a=(this.state==job_code.new&&"cloud"!=this.file_system&&(a=""),n.grid.setInputText(a,e,3,1,2).setWidth_px(500).setReadOnly(!0).setNoWrap());n.itext.push(a),n.grid.setVerticalAlignment(e,2,"middle"),n.grid.setVerticalAlignment(e,3,"middle"),!function(t,e,i,o){s.addOnClickListener(function(){"local"==n.file_system?t.click():new CloudFileBrowser(n,o,4,e.file_types.split(","),function(e){return o.__set_selected_files(e,i,n),1},null)}),t.addOnChangeListener(function(){var e=t.getFiles();o.__set_selected_files(e,i,n)})}(o,i,a,this),n[i.inputId]=o,e++}n.grid.setLabel("&nbsp;",e++,0,1,1).setHeight_px(8)},TaskTemplate.prototype.makeLigandsLayout=function(a){var e=a.grid.getNRows(),t=e;function i(){for(var e=-1,t=0;t<a.ligands.length;t++)"none"!=a.ligands[t].selection.getValue()&&(e=t);for(var i=!1,o=!1,t=0;t<a.ligands.length;t++){var n=t<=e+1,s=a.ligands[t].selection.getValue();a.ligands[t].label.setVisible(n),a.ligands[t].selection.setVisible(n),a.ligands[t].smiles.setVisible(n&&"S"==s),a.ligands[t].code.setVisible(n&&"none"!=s),"S"==s&&(o=!0),"none"!=s&&(i=!0)}a.code_lbl.setVisible(i),a.smiles_lbl.setVisible(o),a.lig_lbl.setVisible(i||o)}a.code_lbl=a.grid.setLabel("<b><i>Code</i></b>",e,3,1,1).setTooltip('3-letter code to identify the ligand. If no SMILES string is given, the code must match one from RCSB Compound dictionary. However, if SMILES string is provided, the code must not match any of known ligands, e.g., "DRG".'),a.smiles_lbl=a.grid.setLabel("<b><i>SMILES String</i></b>",e++,4,1,1).setTooltip("SMILES string describing ligands structure."),a.ligands=[];var o="[Optional] Provide description of ligand to fit in electron density, using either a SMILES string or 3-letter code. It is advised not to specify the 3-letter code when SMILES string is used; if left empty, a vacant code will be chosen automatically.";1<this.input_ligands.length&&(o+=" Up to "+this.input_ligands.length+" ligands may be specified.");for(var n=0;n<this.input_ligands.length;n++){var s="Ligand",s=(0<n&&(s+=" #"+(n+1)),a.grid.setLabel(s,e,0,1,1).setTooltip(o).setFontItalic(!0).setFontBold(!0).setNoWrap()),r=(a.grid.setVerticalAlignment(e,0,"middle"),new Dropdown),l=(r.setWidth("120px").setTooltip(o),a.grid.setWidget(r,e,2,1,1),r.addItem("None","","none","none"==this.input_ligands[n].source),r.addItem("SMILES","","S","S"==this.input_ligands[n].source),r.addItem("Code","","M","M"==this.input_ligands[n].source),r.make(),a.grid.setInputText(this.input_ligands[n].code,e,3,1,1).setWidth_px(50).setNoWrap().setMaxInputLength(3).setTooltip(o).setVisible("M"==this.input_ligands[n].source)),c=a.grid.setInputText(this.input_ligands[n].smiles,e,4,1,1).setWidth_px(500).setNoWrap().setTooltip(o).setVisible("S"==this.input_ligands[n].source);a.grid.setVerticalAlignment(e,2,"middle"),a.grid.setVerticalAlignment(e,3,"middle"),a.grid.setVerticalAlignment(e,4,"middle"),a.ligands.push({label:s,selection:r,smiles:c,code:l}),r.sno=n,r.addOnChangeListener(function(e,t){a.ligands[this.sno].code.setVisible("none"!=t),a.ligands[this.sno].smiles.setVisible("S"==t),i()}),e++}0<this.input_ligands.length&&(a.lig_lbl=a.grid.setLabel("&nbsp;<br><i>Codes "+__coot_reserved_codes.join(", ")+" are reserved by Coot and cannot be used here. If no code is given (recommended), a suitable new one will be autogenerated</i>",e++,3,1,2).setFontColor("maroon").setVisible(!1)),a.grid.setLabel("&nbsp;",e++,0,1,1).setHeight_px(8),i();for(var d=a.grid.getNCols(),n=1;n<d;n++)a.grid.setLabel(" ",t,n,1,1).setHeight_px(8),a.grid.setCellSize("auto","",t,n);a.grid.setLabel(" ",t,d,1,1).setHeight_px(8),a.grid.setCellSize("95%","",t,d)},TaskTemplate.prototype.setInputDataFields=function(e,t,i){function o(e){for(var t=e.ddndata,i=0;i<t.length;i++)t[i][0]&&(e.addItem(t[i][0],"",t[i][1],t[i][2]),e.ddndata[i][3]&&e.disableItem(t[i][1],!0))}function n(e,t){for(var i=0;i<e.ddndata.length;i++)e.ddndata[i][0]&&(e.ddndata[i][2]=e.ddndata[i][1]==t)}function O(e,t){for(var i=e.ddndata,o=0;o<i.length;o++)i[o][0]&&(i[o][2]=i[o][1]==t);for(o=0;o<i.length-1;o++)if(i[o][0])for(var n=o+1;n<i.length;n++)i[n][0]&&i[n][0]==i[o][0]&&(i[n][2]&&(i[o]=i[n]),i[n]=[null]);for(o=0;o<i.length;o++)i[o][0]&&(e.addItem(i[o][0],"",i[o][1],i[o][2]),i[o][3]&&e.disableItem(i[o][1],!0))}if(this.getInputMode()!=input_mode.root){i.extendData(),$(e.element).css("position","relative"),e.inpDataRef={row:t,grid:e,input:[]};var s=[],a=[],r=[],l=[];e.void_data={};for(var c=0;c<this.input_dtypes.length;c++){var d=[],h=[],u=!1;if(startsWith((v=this.input_dtypes[c]).inputId,"void")){var p=[];for(P in v.data_type)P in i.data&&(p=p.concat(i.data[P]));e.void_data[v.inputId]=p}else{var m=0;for(P in v.data_type)if(P in i.data){P in i.data_n0&&(u=!0);var f=i.data[P];if("castTo"in v&&v.castTo!=P)for(var g=0;g<f.length;g++)h.push(f[g].cast(v.castTo));else h=h.concat(f);if(v.data_type[P].length<=0)for(g=0;g<f.length;g++)d.push(m++);else for(g=0;g<f.length;g++)i.compareSubtypes(v.data_type[P],f[g])&&d.push(m),m++}for(var _=this.input_data.getData(v.inputId),g=-1,b=0;b<_.length;b++){for(g++;g<h.length&&h[g].dataId!=_[b].dataId;)g++;g<h.length&&(h[g]=_[b].extend())}}s.push(d),a.push(h),r.push(u),l.push([])}for(var N=!0,y=(e.inputPanel.fullVersionMismatch=!1,t),c=0;c<this.input_dtypes.length;c++){h=a[c];if(0<(d=s[c]).length){var v=this.input_dtypes[c],_=this.input_data.getData(v.inputId),k="",w=(v.hasOwnProperty("customInput")&&(k=v.customInput),0),T=(v.hasOwnProperty("version")&&(w=v.version),Math.min(d.length,v.max)),S=v.min;v.hasOwnProperty("force")&&(S=Math.max(S,v.force));for(b=0;b<T;b++){l[c].push(new Dropdown);for(var x=l[c][b],C=(x.dataBox=i,x.row=y,x.task=this,x.grid=e,v.label),C=e.setLabel(C=1<T?C+" ("+(b+1)+")":C,y,0,1,1).setFontItalic(!0).setFontBold(!0).setNoWrap(),F=(e.setCellSize("5%","",y,0),e.setVerticalAlignment(y,0,"middle"),v.hasOwnProperty("tooltip")&&C.setTooltip(v.tooltip),e.setLabel("&nbsp;",y,1,1,1),e.setCellSize("1%","",y,1),x.inspect_btn=e.setButton("",image_path("inspect"),y,2,1,1).setTooltip("Inspect details").setSize("32px","32px").setVisible(!1),e.setCellSize("1%","",y,2),!function(e,t,i){e.inspect_btn.addOnClickListener(function(){t[e.getValue()].inspectData(i)})}(x,h,this),!0),D=(b>=v.min&&(v.hasOwnProperty("unchosen_label")&&0==b?x.addItem(v.unchosen_label,"",-1,S<=b):x.addItem("[do not use]","",-1,S<=b),F=b<v.min),0),B=[],g=0;g<d.length;g++){var L,A,I=h[m=d[g]].dname;"cast"in v&&!h[m].hasSubtype("proxy")&&(L="/"+v.cast+"/",0<(A=(A=(A=(A=(A=(A=(A=I.indexOf("/xyz/"))<0?I.indexOf("/hkl/"):A)<0?I.indexOf("/unmerged/"):A)<0?I.indexOf("/seqeunce/"):A)<0?I.indexOf("/ensemble/"):A)<0?I.indexOf("/structure/"):A)<0?I.indexOf("/substructure/"):A)?I=I.substr(0,A)+L:I+=" "+L),B.push([I,m,F&&g==b,h[m].version<w]),h[m].version<w&&D++}x.ddndata=B,0<D&&(N=!1),b<v.min&&D==d.length&&0<D&&(e.inputPanel.fullVersionMismatch=!0),e.setWidget(x,y,3,1,1),e.setHorizontalAlignment(y,3,"left"),e.setCellSize("10%","",y,3),e.setLabel(" ",y,4,1,1),e.setCellSize("84%","",y,4),x.make(),y++,x.layCustom=k,x.serialNo=b,k&&(x.customGrid=e.setGrid("-compact",y++,3,1,1),h[d[b]].layCustomDropdownInput(x),x.grid.setRowVisible(x.row+1,b<S),x.customGrid.setVisible(b<S)),x.dt=h,!function(o,n){o[n].addSignalHandler("state_changed",function(e){var t=0<=e.item&&!o[n].dt[e.item].hasSubtype("proxy");if(o[n].inspect_btn.setVisible(t),o[n].layCustom){for(var i=0;i<o.length;i++)i!=n&&0<=o[i].getValue()&&o[i].dt[o[i].getValue()].collectCustomDropdownInput(o[i]);void 0!==e.prev_item&&0<=e.prev_item&&o[n].dt[e.prev_item].collectCustomDropdownInput(o[n]),0<=e.item&&(o[n].customGrid.clear(),o[n].dt[e.item].layCustomDropdownInput(o[n])),o[n].grid.setRowVisible(o[n].row+1,t),o[n].customGrid.setVisible(t)}})}(l[c],b)}e.inpDataRef.input.push({inputId:v.inputId,dt:h,dropdown:l[c]})}}if(this.input_data.isEmpty()){for(var R=[],c=0;c<this.input_dtypes.length;c++)if(0<l[c].length&&r[c]){h=a[c];if(0<(d=s[c]).length)for(var E=0,T=((v=this.input_dtypes[c]).hasOwnProperty("force")&&(E=v.force),Math.min(d.length,Math.max(v.min,E))),b=0;b<T;b++)0<=d[b]&&(R=R.concat(h[d[b]].associated)),b<l[c].length&&(n(l[c][b],d[b]),l[c][b].inspect_btn.setVisible(!0));for(b=0;b<l[c].length;b++)o(l[c][b])}for(c=0;c<this.input_dtypes.length;c++)if(0<l[c].length&&!r[c]){h=a[c];if(0<(d=s[c]).length){var P,M=[];for(P in(v=this.input_dtypes[c]).data_type)P in i.inp_assoc&&(M=M.concat(i.inp_assoc[P]));E=0;if(v.hasOwnProperty("force"))E=v.force;else for(g=0;g<d.length;g++)0<=R.indexOf(h[d[g]].dataId)&&E++;for(var T=Math.min(d.length,Math.max(v.min,E)),m=0,j=!0,b=0;b<T;b++){if(j){for(;m<d.length&&!(0<=R.indexOf(h[d[m]].dataId));)m++;m>=d.length&&(j=!1,m=0)}if(!j){for(;m<d.length&&!(0<=M.indexOf(h[d[m]].dataId));)m++;m>=d.length?m=0:j=!0}if(!j){for(;m<d.length&&!(R.indexOf(h[d[m]].dataId)<0);)m++;m>=d.length&&(m=b)}0<=d[m]&&(R=R.concat(h[d[m]].associated)),b<l[c].length&&(k=l[c][b].layCustom,l[c][b].layCustom="",n(l[c][b],d[b]),l[c][b].inspect_btn.setVisible(!0),k&&(l[c][b].layCustom=k,l[c][b].customGrid.clear(),h[d[m]].layCustomDropdownInput(l[c][b]),l[c][b].grid.setRowVisible(l[c][b].row+1,!0),l[c][b].customGrid.setVisible(!0)),m++)}}for(b=0;b<l[c].length;b++)o(l[c][b])}}else for(c=0;c<this.input_dtypes.length;c++)if(0<l[c].length){h=a[c];if(0<(d=s[c]).length){for(v=this.input_dtypes[c],_=this.input_data.getData(v.inputId),g=-1,b=0;b<_.length;b++){for(g++;g<d.length&&h[d[g]].dataId!=_[b].dataId;)g++;g<d.length?(k=l[c][b].layCustom,l[c][b].layCustom="",O(l[c][b],d[g]),l[c][b].inspect_btn.setVisible(!0),k&&(l[c][b].layCustom=k,l[c][b].customGrid.clear(),h[d[g]].layCustomDropdownInput(l[c][b]),l[c][b].grid.setRowVisible(l[c][b].row+1,!0),l[c][b].customGrid.setVisible(!0))):o(l[c][b])}for(b=_.length;b<l[c].length;b++)o(l[c][b])}}e.inpDataRef.row=y,e.dataBox=i,this.state!=job_code.new||N||(e.inputPanel.fullVersionMismatch?window.setTimeout(function(){new MessageBox("Out-versioned data","<h3>Out-versioned data encountered</h3>Some data items, collected for this task, were created with a lower version of "+appName()+',<br>where forward compatibility could not be provided for technical reasons. Such items<br>are disabled in comboboxes and cannot be selected. <b>For at least one data type,<br>all available data items are incompatible with the current version of the task. As a<br>result, the task cannot be formed and the "<i>Run</i>" button is removed from<br>the toolbar.</b><p>In order to form the task, missing data must be re-generated or re-imported by<br>repeating all the relevant tasks. You may find that some old tasks cannot be cloned,<br>too, in which case they should be created anew.<p>Apologies for the inconvenience caused, which is due to the routine development and<br>update of '+appName()+".")},0):window.setTimeout(function(){new MessageBox("Out-versioned data","<h3>Out-versioned data encountered</h3>Some data items, collected for this task, were created with a lower version of "+appName()+",<br>where forward compatibility could not be provided for technical reasons. <b>Such items<br>are disabled in comboboxes and cannot be selected.</b><p>If outdated data items are required, they must be re-generated or re-imported by<br>repeating all the relevant tasks. You may find that some old tasks cannot be cloned,<br>too, in which case they should be formed anew.<p>Apologies for the inconvenience caused, which is due to the routine development and<br>update of "+appName()+".")},0))}},TaskTemplate.prototype.trimDropdowns=function(e){if("inpDataRef"in e.grid)for(var t=e.grid.inpDataRef.input,i=0;i<t.length;i++){var o=t[i].dropdown;if(1<o.length){for(var n=-1,s=0;s<o.length;s++)0<=o[s].getValue()?n=-1:(o[s].hasOwnProperty("customGrid")&&(o[s].grid.setRowVisible(o[s].row+1,!1),o[s].customGrid.setVisible(!1)),n<0&&(n=s));if(0<=n)for(s=0;s<t[i].dropdown.length;s++)e.grid.setRowVisible(o[s].row,s<=n)}}},TaskTemplate.prototype.collectFileSelects=function(e){for(var t,i="",o=0;o<this.file_select.length;o++)this.file_select[o].path="","local"==e.file_system?0<(t=e[this.file_select[o].inputId].getFiles()).length&&(this.file_select[o].path=t[0].name):this.file_select[o].path=e.itext[o].getValue(),this.file_select[o].path.length<=0&&0<this.file_select[o].min&&(i+="|<b><i>"+this.file_select[o].label+" file is not specified</i></b>");return this.file_system=e.file_system,this.file_mod=e.customData.file_mod,i},TaskTemplate.prototype.collectInputLigands=function(e){for(var t="",i=0;i<this.input_ligands.length;i++)this.input_ligands[i].source=e.ligands[i].selection.getValue(),this.input_ligands[i].smiles=e.ligands[i].smiles.getValue(),this.input_ligands[i].code=e.ligands[i].code.getValue(),"none"!=this.input_ligands[i].source&&("M"!=this.input_ligands[i].source||this.input_ligands[i].code||(t+="|<b><i>Code for ligand #"+(i+1)+" is not given</i></b>"),"S"!=this.input_ligands[i].source||this.input_ligands[i].smiles||(t+="|<b><i>SMILES string for ligand #"+(i+1)+" is not given</i></b>"));for(var o=!0,i=0;i<this.input_ligands.length&&o;i++)if("none"!=this.input_ligands[i].source&&this.input_ligands[i].code)for(var n=i+1;n<this.input_ligands.length&&o;n++)"none"!=this.input_ligands[n].source&&this.input_ligands[i].code==this.input_ligands[n].code&&(o=!1,t+="|<b><i>Repeat use of ligand code "+this.input_ligands[i].code+"</i></b>");return t},TaskTemplate.prototype.collectInputData=function(e){var d="",h=new DataBox;return function e(t){if("inpDataRef"in t&&"dataBox"in t)for(var i=t.inpDataRef.input,o=0;o<i.length;o++)for(var n=i[o].dt,s=i[o].dropdown,a=0;a<s.length;a++){var r,l=s[a].getValue();0<=l&&(l=jQuery.extend(!0,{},n[l]),s[a].hasOwnProperty("customGrid")&&0<(r=l.collectCustomDropdownInput(s[a])).length&&(d+="|"+r),l.visible=s[a].isVisible(),h.addCustomData(i[o].inputId,l))}if("void_data"in t)for(var c in t.void_data)for(a=0;a<t.void_data[c].length;a++)h.addCustomData(c,t.void_data[c][a]);for(o=0;o<t.child.length;o++)e(t.child[o])}(e),this.input_data=h,this.input_data.markNotEmpty(),d},TaskTemplate.prototype.evaluateCondition=function(e,t,i){var o,n="&&",s="&&"==(n="_"in e?e._:n);for(o in e)if("_"!=o){var a,r=!1;if(e[o].constructor===Array?o in t?(a=null,t[o].hasOwnProperty("input")?a=t[o].input.getValue():t[o].ref.hasOwnProperty("value")&&(a=t[o].ref.value),(r=0<=e[o].indexOf(a))||(0<=e[o].indexOf("__is_visible__")?r=t[o].ref.visible:0<=e[o].indexOf("__not_visible__")&&(r=!t[o].ref.visible))):r=o in i?0<=e[o].indexOf(i[o]):0<=e[o].indexOf(-1):r=this.evaluateCondition(e[o],t,i),"&&"==n){if(!(s=r))break}else if(s=r)break}return s},TaskTemplate.prototype.addCustomDataState=function(e,t){},TaskTemplate.prototype.getDataState=function(e){for(var t=e.grid,i={},o=0;o<this.input_dtypes.length;o++){var n=this.input_dtypes[o].inputId,s=this.getInputItem(e,n);if(s)for(var a=s.dropdown,r=s.dt,l=i[n]=0;l<a.length;l++){var c=a[l].getValue();if(!t.wasRowHidden(a[l].row)&&0<=c){i[n]++;for(var d=n+".type:"+r[c]._type,h=(i.hasOwnProperty(d)?i[d]++:i[d]=1,r[c].subtype),u=0;u<h.length;u++)d=n+".subtype:"+h[u],i.hasOwnProperty(d)?i[d]++:i[d]=1}}}return this.addCustomDataState(e,i),i},TaskTemplate.prototype.inputChanged=function(e,t,i){var o,n=e.parameters,s=null,s="inpDataRef"in e.grid?this.getDataState(e.grid.inpDataRef):{};for(o in n)n[o].ref.visible=!0,o in e.showon&&(n[o].ref.visible=this.evaluateCondition(e.showon[o],n,s)),n[o].ref.visible&&o in e.hideon&&(n[o].ref.visible=!this.evaluateCondition(e.hideon[o],n,s));for(o in n){var a=n[o].ref.visible;if(n[o].ref._visible!=a){for(var r in n[o])"setVisible"in n[o][r]&&n[o][r].setVisible(a);n[o].ref._visible=a}}this.trimDropdowns(e)},TaskTemplate.prototype._make_show_links=function(e){var t,i=e.parameters;for(t in i){var o=i[t].ref,n=(o.hasOwnProperty("showon")&&(e.showon[t]=o.showon),o.hasOwnProperty("hideon")&&(e.hideon[t]=o.hideon),[]);if(o.hasOwnProperty("showon"))for(var s in o.showon)i.hasOwnProperty(s)?this.inputChanged(e,s,i[s].ref.value):this.inputChanged(e,s,-1),n.push(s);if(o.hasOwnProperty("hideon"))for(var s in o.hideon)n.indexOf(s)<0&&(i.hasOwnProperty(s)?this.inputChanged(e,s,i[s].ref.value):this.inputChanged(e,s,-1),n.push(s))}},TaskTemplate.prototype._set_item_emitting=function(e,t,i){var o,n,s,a;i.hasOwnProperty("emitting")&&i.emitting&&(n=t,s=this,(a=(o=e).parameters[n].input).change_counter=0,a.addOnInputListener(function(){a.change_counter++,window.setTimeout(function(){a.change_counter--,a.change_counter<=0&&s.inputChanged(o,n,a.getValue())},750)}))},TaskTemplate.prototype._lay_parameters=function(e,t,i,o,n){var s,a,r;for(r in o)if(o.hasOwnProperty(r)){var l=o[r];if(l.hasOwnProperty("type")){var c,d=t+l.position[0],h=i+l.position[1],u=l.position[2],p=l.position[3];switch(l.visible=!0,s="default"in l?l.default:"placeholder"in l?l.placeholder:"",a="tooltip"in l?l.tooltip:"",l.type){case"section":n.parameters[r]={},0<(n.parameters[r].ref=l).title.length?(c=e.setSection(l.title,l.open,d,h,u,p),n.parameters[r].sec=c,n.parameters[r].ref.visible=!0,n.parameters[r].ref._visible=!0,c.grid.setStyle("-compact"),this._lay_parameters(c.grid,0,0,l.contains,n)):(c=e.setGrid("-compact",d,h,u,p),n.parameters[r].sec=c,n.parameters[r].ref.visible=!0,n.parameters[r].ref._visible=!0,this._lay_parameters(c,0,0,l.contains,n));break;case"label":_make_label(n,r,l,e,d,h,u,p);break;case"integer":case"integer_":h=_make_label(n,r,l,e,d,h,u,1),v=l.hasOwnProperty("iwidth")?l.iwidth:80,n.parameters[r].input=e.addInputText(l.value,d,h,u,p).setStyle("text","integer",s,a).setWidth_px(v),this._set_item_emitting(n,r,l),l.hasOwnProperty("readonly")&&n.parameters[r].input.setReadOnly(l.readonly),e.setVerticalAlignment(d,h,"middle");break;case"real":case"real_":h=_make_label(n,r,l,e,d,h,u,1),v=l.hasOwnProperty("iwidth")?l.iwidth:80,n.parameters[r].input=e.addInputText(l.value,d,h,u,p).setStyle("text","real",s,a).setWidth_px(v),this._set_item_emitting(n,r,l),l.hasOwnProperty("readonly")&&n.parameters[r].input.setReadOnly(l.readonly),e.setVerticalAlignment(d,h,"middle");break;case"string":case"string_":h=_make_label(n,r,l,e,d,h,u,1),v=l.hasOwnProperty("iwidth")?l.iwidth:80,n.parameters[r].input=e.addInputText(l.value,d,h,u,p).setStyle("text","",s,a).setWidth_px(v),l.hasOwnProperty("maxlength")&&n.parameters[r].input.setMaxInputLength(l.maxlength),this._set_item_emitting(n,r,l),l.hasOwnProperty("readonly")&&n.parameters[r].input.setReadOnly(l.readonly),e.setVerticalAlignment(d,h,"middle");break;case"combobox":for(var h=_make_label(n,r,l,e,d,h,u,1),m=new Dropdown,f=0;f<l.range.length;f++){var g=l.range[f].split("|");g.length<2&&(g=[f.toString(),l.range[f]]),m.addItem(g[1],"",g[0],g[0]==l.value)}e.addWidget(m,d,h,u,p),l.hasOwnProperty("iwidth")&&m.setWidth(l.iwidth),m.make(),m.setZIndex(200-d),n.parameters[r].input=m,!function(t,i,o){m.element.addEventListener("state_changed",function(e){o.inputChanged(t,i,e.detail.item)},!1),window.setTimeout(function(){o.inputChanged(t,i,l.value)},0)}(n,r,this);break;case"checkbox":n.parameters[r]={},n.parameters[r].ref=l,n.parameters[r].ref.visible=!0,n.parameters[r].ref._visible=!0;var _=e.addCheckbox(l.label,l.value,d,h,u,p);_.setTooltip(l.tooltip),l.hasOwnProperty("iwidth")?endsWith(l.iwidth.toString(),"%")?_.setWidth(l.iwidth):_.setWidth_px(l.iwidth):_.setWidth("100%"),n.parameters[r].input=_,!function(e,t,i,o){$(i.checkbox).on("click",function(){o.inputChanged(e,t,i.getValue())})}(n,r,_,this);break;case"textarea_":case"textarea":n.parameters[r]={},n.parameters[r].ref=l,n.parameters[r].ref.visible=!0,n.parameters[r].ref._visible=!0;var _="",b=5,y=80,b=(l.hasOwnProperty("placeholder")&&(_=l.placeholder),l.hasOwnProperty("nrows")&&(b=l.nrows),l.hasOwnProperty("ncols")&&(y=l.ncols),e.setTextArea(l.value,_,b,y,d,h,u,p));b.setTooltip(l.tooltip),$(b.element).css({"box-shadow":"6px 6px lightgray",resize:"none","font-family":"monospace"}),l.hasOwnProperty("iwidth")?endsWith(l.iwidth.toString(),"%")?b.setWidth(l.iwidth):b.setWidth_px(l.iwidth):b.setWidth("100%"),n.parameters[r].input=b,!function(e,t,i,o){i.addOnInputListener(function(){o.inputChanged(e,t,i.getValue())})}(n,r,b,this);break;case"aceditor_":case"aceditor":n.parameters[r]={},n.parameters[r].ref=l,n.parameters[r].ref.visible=!0,n.parameters[r].ref._visible=!0;var v=800,y=320,b=(l.hasOwnProperty("iwidth")&&(v=l.iwidth),l.hasOwnProperty("iheight")&&(y=l.iheight),""),k=(l.hasOwnProperty("placeholder")&&(b=l.placeholder),new ACEditor(v,y,{"box-shadow":"6px 6px lightgray",theme:"chrome",mode:"python"}));e.setWidget(k,d,h,u,p),k.setTooltip(l.tooltip),!function(e,t,i){window.setTimeout(function(){e.init(t,i)},0)}(n.parameters[r].input=k,l.value,b)}}}},TaskTemplate.prototype.countInputData=function(e,t,i){var o=0,t=this.getInputItem(e,t),n=e.grid;if(t){var s=t.dropdown;if(i)for(var a=t.dt,r=0;r<s.length;r++){var l=s[r].getValue();!n.wasRowHidden(s[r].row)&&0<=l&&0<=a[l].subtypes.indexOf(i)&&o++}else for(var r=0;r<s.length;r++)!n.wasRowHidden(s[r].row)&&0<=s[r].getValue()&&o++}return o},TaskTemplate.prototype.getInputItem=function(e,t){for(var i=null,o=e.input,n=0;n<o.length&&!i;n++)o[n].inputId==t&&(i=o[n]);return i},TaskTemplate.prototype.getInputData=function(e,t){var e=this.getInputItem(e,t),i=[];if(e)for(var o=e.dt,n=e.dropdown,s=0;s<n.length;s++){var a=n[s].getValue();0<=a&&(a=jQuery.extend(!0,{},o[a]),n[s].hasOwnProperty("customGrid")&&a.collectCustomDropdownInput(n[s]),a.visible=n[s].isVisible(),i.push(a))}return i},TaskTemplate.prototype.getInputItemNo=function(e,t){for(var i=-1,o=e.input,n=0;n<o.length&&i<0;n++)o[n].inputId==t&&(i=n);return i},TaskTemplate.prototype._make_data_signals=function(r){if(r.hasOwnProperty("inpParamRef")&&r.hasOwnProperty("inpDataRef"))for(var e=r.inpDataRef.input,t=0;t<e.length;t++){for(var i=e[t].dropdown,l=0;l<i.length;l++)!function(o,n,s,a){i[l].element.addEventListener("state_changed",function(e){for(var t=0,i=0;i<o.length;i++)!r.wasRowHidden(o[i].row)&&0<=o[i].getValue()&&t++;a.inputChanged(n,s,t)},!1)}(i,r.inpParamRef,e[t].inputId,this);i[0].click()}},TaskTemplate.prototype.layParameters=function(e,t,i){var o,n;e.inpParamRef={row:t,grid:e,parameters:{},showon:{},hideon:{}},this._lay_parameters(e,t,i,this.parameters,e.inpParamRef),o=this,n=e,window.setTimeout(function(){o._make_show_links(n.inpParamRef),o._make_data_signals(n),window.setTimeout(function(){n.setVisible(!0)},10)},0)},TaskTemplate.prototype.invalidParamMessage=function(e,t){return"<b>"+e+'</b><br><i style="font-size:14px;">'+t+"</i>"},TaskTemplate.prototype.collectParameterValues=function(e){var o="";function r(e,t,i){e.visible&&(t=t,"reportas"in e?t=e.reportas:"label"in e?t=e.label:"keyword"in e&&(t=e.keyword),startsWith(t,"<b>")&&(t=t.replace("<b>","").replace("</b>","")),o+="|<b>"+t+":</b> "+i)}function l(e,t,i){"range"in t?"*"==t.range[0]?e>t.range[1]?r(t,i,"value should be less or equal to "+t.range[1]):t.value=e:"*"==t.range[1]?e<t.range[0]?r(t,i,"value should be greater or equal to "+t.range[0]):t.value=e:e<t.range[0]||e>t.range[1]?r(t,i,"value should be between "+t.range[0]+" and "+t.range[1]):t.value=e:t.value=e}return function e(t){if("inpParamRef"in t)for(var i in t.inpParamRef.parameters){var o,n=t.inpParamRef.parameters[i],s=n.ref;switch(s.type){case"integer_":case"integer":(o=n.input.getValue().trim()).length<=0?"integer_"==s.type?isNaN(s.default)?s.value="":s.value=s.default:r(s,i,"no value given"):isInteger(o)?l(parseInt(o),s,i):r(s,i,"wrong integer format");break;case"real_":case"real":(o=n.input.getValue().trim()).length<=0?"real_"==s.type?isNaN(s.default)?s.value="":s.value=s.default:r(s,i,"no value given"):isFloat(o)?l(parseFloat(o),s,i):r(s,i,"wrong real format");break;case"string_":case"string":(o=n.input.getValue().trim()).length<=0?"string_"==s.type?"default"in s?s.value=s.default:s.value="":r(s,i,"no value given"):s.value=o;break;case"checkbox":case"combobox":s.value=n.input.getValue();break;case"textarea_":case"textarea":(o=n.input.getValue()).length<=0?"textarea_"==s.type?"default"in s?s.value=s.default:s.value="":r(s,i,"no value given"):s.value=o;break;case"aceditor_":case"aceditor":(o=n.input.getText()).length<=0?"aceditor_"==s.type?"default"in s?s.value=s.default:s.value="":r(s,i,"no value given"):s.value=o}}for(var a=0;a<t.child.length;a++)e(t.child[a])}(e),o},TaskTemplate.prototype.disableInputWidgets=function(o,n){window.setTimeout(function(){if("grid"in o&&"inpDataRef"in o.grid)for(var e=o.grid.inpDataRef.input,t=0;t<e.length;t++)for(var i=0;i<e[t].dropdown.length;i++)n&&e[t].dropdown[i].inspect_btn.setEnabled(!0)},0),o.hasOwnProperty("header")&&this.state!=job_code.running&&this.state!=job_code.exiting&&o.header.hasOwnProperty("uname_inp")&&window.setTimeout(function(){o.header.uname_inp.setEnabled(!0)},0)},TaskTemplate.prototype.inputPanelResize=function(e,t,i){},TaskTemplate.prototype.doRun=function(e,t){if(this.inputMode==input_mode.root&&0<this.file_select.length){for(var i=[],o=0;o<this.file_select.length;o++)i.push(e[this.file_select[o].inputId].getFiles());new UploadDialog("Upload data",i,e.customData,!0,function(e){e?new MessageBox("Stop run","Task cannot be run due to upload errors:<p><b><i>"+e+"</i></b>"):t()})}else t()},TaskTemplate.prototype.postSubmit=function(){},TaskTemplate.prototype.customDataClone=function(e,t){"copy_suggested"==e&&"suggestedParameters"in t&&this._clone_suggested(this.parameters,t.suggestedParameters)},TaskTemplate.prototype.score_string=function(){var e="";if("scores"in this)for(var t in e="",this.scores){var i=this.scores[t];if(i.hasOwnProperty("summary_line"))e+=i.summary_line+" ";else switch(t){case"aimless":e+="Compl="+i.Completeness+"% CC<sub>1/2</sub>="+i.Half_set_CC+" R<sub>meas_all</sub>="+i.R_meas_all+" R<sub>meas_ano</sub>="+i.R_meas_ano+" SpG="+i.Space_group+" ";break;case"phaser":"count"in i&&(e+="N<sub>sol</sub>="+i.count),e+=" LLG="+i.llg+" TFZ="+i.tfz+" ";break;case"cbuccaneer":e+="Compl="+i.percentage+"% ";break;case"buster":case"lorestr":case"refmac":e+="R="+i.R_factor+" R<sub>free</sub>="+i.R_free+" ","molp_score"in i&&(e+="MolProbity="+i.molp_score+" ");break;case"z01":e+="<u>SpG="+i.SpaceGroup+"</u> ";break;case"z02":"Ncopies"in i&&(0<e.length&&(e+=", "),1==i.Ncopies?e+="1 molecule in ASU, ":1<i.Ncopies&&(e+=i.Ncopies+" molecules in ASU, ")),e+="Solv="+i.SolventPercent+"% ";break;case"shelxemr":0==i.bestCC&&0<i.pseudoCC?e+="pseudo-CC="+i.pseudoCC:e+="CC="+i.bestCC,e+="% FOM="+i.meanFOM}}return e.trim()},TaskTemplate.prototype.result_indicator=function(){var e="";switch(this.state){case job_code.exiting:e="exiting";break;case job_code.finished:""==(e=this.score_string())&&(e="completed.");break;case job_code.noresults:""==(e=this.score_string())&&(e="finished.");break;case job_code.failed:e="failed.";break;case job_code.stopped:e="terminated."}return e});var __template=null,conf;function TaskAcorn(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskAcorn",this.name="acorn",this.setOName("acorn"),this.title="Phase Refinement and Dynamic Density Modification with ACORN",this.input_dtypes=[{data_type:{DataRevision:["!protein","!asu","!phases"]},label:"Structure revision",inputId:"revision",customInput:"acorn",version:7,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Main parameters",open:!0,position:[0,0,1,5],contains:{EXTEND_RESOLUTION_CBX:{type:"checkbox",label:"Artificially extend resolution",tooltip:'Check to extend resolution ("free lunch")',value:!0,position:[0,0,1,1]},EXTRES:{type:"real",keyword:"resolution",label:"to",align:"right",lwidth:60,reportas:"Extend resolution limit",tooltip:"Extend resolution limit of the data for use in ACORN",range:[0,5],value:"1.0",iwidth:40,label2:"&Aring",position:[0,1,1,1],showon:{EXTEND_RESOLUTION_CBX:[!0]}},ANISOTROPY_CORRECTION_CBX:{type:"checkbox",label:"Anisotropy correction",tooltip:"Check to make anisotropy correction",value:!0,position:[1,0,1,1]}}},sec2:{type:"section",title:"General ACORN phase improvement parameters (advanced)",open:!1,position:[1,0,1,5],contains:{TRIALS_SEL:{type:"combobox",keyword:"TRIALS",label:"DDM trials",tooltip:"Choose parameters for Dynamic Density Modification (DDM) trials.",range:["P|Preconfigured DDM trials","C|Customised DDM trials","D|Customised DDM trials with DDM types"],value:"P",iwidth:400,position:[0,0,1,14]},NTRIALS:{type:"integer",keyword:"NTRIALS",label:"Number of trials",tooltip:"Number of trials between 1 (default) and 10",range:[1,10],value:"1",position:[1,0,1,1],showon:{TRIALS_SEL:["P"]}},SEPARATOR_LBL:{type:"label",label:"&nbsp;",position:[1,0,1,1],showon:{TRIALS_SEL:["C","D"]}},NCYCLES_LBL:{type:"label",label:"<b><i>N<sub>cycles</sub></i></b>",tooltip:"Number of DDM cycles in each trial",position:[2,3,1,1],hideon:{TRIALS_SEL:["P"]}},TYPE_LBL:{type:"label",label:"<b><i>DDM type</i></b>",position:[2,6,1,1],hideon:{TRIALS_SEL:["P"]}},ADDONS_LBL:{type:"label",label:"<b><i>Added Enhancement/Refinement</i></b>",position:[2,9,1,7],hideon:{TRIALS_SEL:["P"]}},TRIAL1_LBL:{type:"label",label:"<b>&radic; Trial 1</b>",position:[3,0,1,1],hideon:{TRIALS_SEL:["P"]}},NCYCLES1:{type:"integer",keyword:"NCYCLES1",label:"",tooltip:"",range:[1,"*"],value:500,position:[3,1,1,1],hideon:{TRIALS_SEL:["P"]}},DDMTYPE1_LBL:{type:"label",label:"<b>DDM</b>",position:[3,6,1,3],hideon:{TRIALS_SEL:["P","D"]}},DDMTYPE1_SEL:{type:"combobox",keyword:"DDMTYPE",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[3,4,1,1],hideon:{TRIALS_SEL:["P","C"]}},ENHREF1_SEL:{type:"combobox",keyword:"DDMTYPE",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"N",iwidth:275,position:[3,7,1,7],hideon:{TRIALS_SEL:["P"]}},DDMTRIAL2_CBX:{type:"checkbox",label:"Trial 2",tooltip:"",value:!1,position:[4,0,1,1],hideon:{TRIALS_SEL:["P"]}},NCYCLES2:{type:"integer",keyword:"NCYCLES2",label:"",tooltip:"",range:[1,"*"],value:500,position:[4,1,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL2_CBX:[!1]}},DDMTYPE2_LBL:{type:"label",label:"<b>DDM</b>",position:[4,6,1,3],hideon:{_:"||",TRIALS_SEL:["P","D"],DDMTRIAL2_CBX:[!1]}},DDMTYPE2_SEL:{type:"combobox",keyword:"DDMTYPE",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[4,4,1,1],hideon:{_:"||",TRIALS_SEL:["P","C"],DDMTRIAL2_CBX:[!1]}},ENHREF2_SEL:{type:"combobox",keyword:"DDMTYPE",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"R",iwidth:275,position:[4,7,1,7],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL2_CBX:[!1]}},DDMTRIAL3_CBX:{type:"checkbox",label:"Trial 3",tooltip:"",value:!1,position:[5,0,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL2_CBX:[!1,"__not_visible__"]}},NCYCLES3:{type:"integer",keyword:"NCYCLES3",label:"",tooltip:"",range:[1,"*"],value:500,position:[5,1,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL3_CBX:[!1,"__not_visible__"]}},DDMTYPE3_LBL:{type:"label",label:"<b>DDM</b>",position:[5,6,1,3],hideon:{_:"||",TRIALS_SEL:["P","D"],DDMTRIAL3_CBX:[!1,"__not_visible__"]}},DDMTYPE3_SEL:{type:"combobox",keyword:"DDMTYPE3",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[5,4,1,1],hideon:{_:"||",TRIALS_SEL:["P","C"],DDMTRIAL3_CBX:[!1,"__not_visible__"]}},ENHREF3_SEL:{type:"combobox",keyword:"ENHREF3",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"R",iwidth:275,position:[5,7,1,7],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL3_CBX:[!1,"__not_visible__"]}},DDMTRIAL4_CBX:{type:"checkbox",label:"Trial 4",tooltip:"",value:!1,position:[6,0,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL3_CBX:[!1,"__not_visible__"]}},NCYCLES4:{type:"integer",keyword:"NCYCLES3",label:"",tooltip:"",range:[1,"*"],value:500,position:[6,1,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL4_CBX:[!1,"__not_visible__"]}},DDMTYPE4_LBL:{type:"label",label:"<b>DDM</b>",position:[6,6,1,3],hideon:{_:"||",TRIALS_SEL:["P","D"],DDMTRIAL4_CBX:[!1,"__not_visible__"]}},DDMTYPE4_SEL:{type:"combobox",keyword:"DDMTYPE3",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[6,4,1,1],hideon:{_:"||",TRIALS_SEL:["P","C"],DDMTRIAL4_CBX:[!1,"__not_visible__"]}},ENHREF4_SEL:{type:"combobox",keyword:"ENHREF3",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"R",iwidth:275,position:[6,7,1,7],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL4_CBX:[!1,"__not_visible__"]}},DDMTRIAL5_CBX:{type:"checkbox",label:"Trial 5",tooltip:"",value:!1,position:[7,0,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL4_CBX:[!1,"__not_visible__"]}},NCYCLES5:{type:"integer",keyword:"NCYCLES3",label:"",tooltip:"",range:[1,"*"],value:500,position:[7,1,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL5_CBX:[!1,"__not_visible__"]}},DDMTYPE5_LBL:{type:"label",label:"<b>DDM</b>",position:[7,6,1,3],hideon:{_:"||",TRIALS_SEL:["P","D"],DDMTRIAL5_CBX:[!1,"__not_visible__"]}},DDMTYPE5_SEL:{type:"combobox",keyword:"DDMTYPE3",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[7,4,1,1],hideon:{_:"||",TRIALS_SEL:["P","C"],DDMTRIAL5_CBX:[!1,"__not_visible__"]}},ENHREF5_SEL:{type:"combobox",keyword:"ENHREF3",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"E",iwidth:275,position:[7,7,1,7],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL5_CBX:[!1,"__not_visible__"]}},DDMTRIAL6_CBX:{type:"checkbox",label:"Trial 6",tooltip:"",value:!1,position:[8,0,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL5_CBX:[!1,"__not_visible__"]}},NCYCLES6:{type:"integer",keyword:"NCYCLES3",label:"",tooltip:"",range:[1,"*"],value:500,position:[8,1,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL6_CBX:[!1,"__not_visible__"]}},DDMTYPE6_LBL:{type:"label",label:"<b>DDM</b>",position:[8,6,1,3],hideon:{_:"||",TRIALS_SEL:["P","D"],DDMTRIAL6_CBX:[!1,"__not_visible__"]}},DDMTYPE6_SEL:{type:"combobox",keyword:"DDMTYPE3",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[8,4,1,1],hideon:{_:"||",TRIALS_SEL:["P","C"],DDMTRIAL6_CBX:[!1,"__not_visible__"]}},ENHREF6_SEL:{type:"combobox",keyword:"ENHREF3",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"E",iwidth:275,position:[8,7,1,7],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL6_CBX:[!1,"__not_visible__"]}},DDMTRIAL7_CBX:{type:"checkbox",label:"Trial 7",tooltip:"",value:!1,position:[9,0,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL6_CBX:[!1,"__not_visible__"]}},NCYCLES7:{type:"integer",keyword:"NCYCLES3",label:"",tooltip:"",range:[1,"*"],value:500,position:[9,1,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL7_CBX:[!1,"__not_visible__"]}},DDMTYPE7_LBL:{type:"label",label:"<b>DDM</b>",position:[9,6,1,3],hideon:{_:"||",TRIALS_SEL:["P","D"],DDMTRIAL7_CBX:[!1,"__not_visible__"]}},DDMTYPE7_SEL:{type:"combobox",keyword:"DDMTYPE3",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[9,4,1,1],hideon:{_:"||",TRIALS_SEL:["P","C"],DDMTRIAL7_CBX:[!1,"__not_visible__"]}},ENHREF7_SEL:{type:"combobox",keyword:"ENHREF3",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"E",iwidth:275,position:[9,7,1,7],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL7_CBX:[!1,"__not_visible__"]}},DDMTRIAL8_CBX:{type:"checkbox",label:"Trial 8",tooltip:"",value:!1,position:[10,0,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL7_CBX:[!1,"__not_visible__"]}},NCYCLES8:{type:"integer",keyword:"NCYCLES3",label:"",tooltip:"",range:[1,"*"],value:500,position:[10,1,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL8_CBX:[!1,"__not_visible__"]}},DDMTYPE8_LBL:{type:"label",label:"<b>DDM</b>",position:[10,6,1,3],hideon:{_:"||",TRIALS_SEL:["P","D"],DDMTRIAL8_CBX:[!1,"__not_visible__"]}},DDMTYPE8_SEL:{type:"combobox",keyword:"DDMTYPE3",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[10,4,1,1],hideon:{_:"||",TRIALS_SEL:["P","C"],DDMTRIAL8_CBX:[!1,"__not_visible__"]}},ENHREF8_SEL:{type:"combobox",keyword:"ENHREF3",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"E",iwidth:275,position:[10,7,1,7],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL8_CBX:[!1,"__not_visible__"]}},DDMTRIAL9_CBX:{type:"checkbox",label:"Trial 9",tooltip:"",value:!1,position:[11,0,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL8_CBX:[!1,"__not_visible__"]}},NCYCLES9:{type:"integer",keyword:"NCYCLES3",label:"",tooltip:"",range:[1,"*"],value:500,position:[11,1,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL9_CBX:[!1,"__not_visible__"]}},DDMTYPE9_LBL:{type:"label",label:"<b>DDM</b>",position:[11,6,1,3],hideon:{_:"||",TRIALS_SEL:["P","D"],DDMTRIAL9_CBX:[!1,"__not_visible__"]}},DDMTYPE9_SEL:{type:"combobox",keyword:"DDMTYPE3",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[11,4,1,1],hideon:{_:"||",TRIALS_SEL:["P","C"],DDMTRIAL9_CBX:[!1,"__not_visible__"]}},ENHREF9_SEL:{type:"combobox",keyword:"ENHREF3",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"E",iwidth:275,position:[11,7,1,7],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL9_CBX:[!1,"__not_visible__"]}},DDMTRIAL10_CBX:{type:"checkbox",label:"Trial 10",tooltip:"",value:!1,position:[12,0,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL9_CBX:[!1,"__not_visible__"]}},NCYCLES10:{type:"integer",keyword:"NCYCLES3",label:"",tooltip:"",range:[1,"*"],value:500,position:[12,1,1,1],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL10_CBX:[!1,"__not_visible__"]}},DDMTYPE10_LBL:{type:"label",label:"<b>DDM</b>",position:[12,6,1,3],hideon:{_:"||",TRIALS_SEL:["P","D"],DDMTRIAL10_CBX:[!1,"__not_visible__"]}},DDMTYPE10_SEL:{type:"combobox",keyword:"DDMTYPE3",label:"",lwidth:2,tooltip:"",range:["0|DDM0","1|DDM1","2|DDM2"],value:"0",position:[12,4,1,1],hideon:{_:"||",TRIALS_SEL:["P","C"],DDMTRIAL10_CBX:[!1,"__not_visible__"]}},ENHREF10_SEL:{type:"combobox",keyword:"ENHREF3",label:"",tooltip:"",range:["N|None","E|Weak density enhancement","R|Sayre equation refinement"],value:"E",iwidth:275,position:[12,7,1,7],hideon:{_:"||",TRIALS_SEL:["P"],DDMTRIAL10_CBX:[!1,"__not_visible__"]}},SEPARATOR2_LBL:{type:"label",label:"&nbsp;",position:[13,0,1,1],showon:{TRIALS_SEL:["C","D"]}},MINPHASESHIFT_LBL:{type:"label",label:"Cease DDM cycling if phase shift between cycles is less than",position:[14,0,1,15]},MINPHASESHIFT:{type:"real",keyword:"PSFIN",label:"",lwidth:0,reportas:"Phase shift convergence parameter",tooltip:"",range:[0,6.28],value:"0.8",placeholder:"0.8",position:[14,1,1,1]},MAXCORR_LBL:{type:"label",label:"Cease phase refinement if correlation coefficient exceeds",position:[15,0,1,15]},MAXCORR:{type:"real",keyword:"CCFIN",label:"",lwidth:0,reportas:"Correlation coefficient convergence parameter",tooltip:"",range:[0,1],value:"0.25",placeholder:"0.25",position:[15,1,1,1]}}},sec3:{type:"section",title:"Selection of Reflection Data (advanced)",open:!1,position:[2,0,1,5],contains:{RESOLUTION_RANGE_CBX:{type:"checkbox",label:"Custom resolution range",tooltip:"Check to set custom resolution range",value:!1,position:[0,0,1,1]},RESMIN:{type:"real",keyword:"RESMIN",label:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;low (&Aring;):",align:"right",reportas:"Low resolution limit",tooltip:"Low resolution cut-off",range:[0,200],value:"50.0",placeholder:"50.0",iwidth:60,position:[0,1,1,1],showon:{RESOLUTION_RANGE_CBX:[!0]}},RESMAX:{type:"real",keyword:"RESMAX",label:"&nbsp;&nbsp;&nbsp;high (&Aring;):",align:"right",reportas:"High resolution limit",tooltip:"High resolution cut-off",range:[0,200],value:"1.0",placeholder:"1.0",iwidth:60,position:[0,4,1,1],showon:{RESOLUTION_RANGE_CBX:[!0]}},EXCLUDE_LOW_SIGFP_CBX:{type:"checkbox",label:"Exclude low SIGFP reflections",tooltip:"Check to exclude reflections with low SigFP and treat them as extended data",value:!1,position:[1,0,1,1]},MINSIGFP:{type:"real",keyword:"EXCL",label:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minimal SigFP:",align:"right",reportas:"SigFP rejection threshold",tooltip:"Minimal acceptable SigFP fore reflections. Reflections with lower SigFP will be rejected and treated as extended data.",range:[0,200],value:"0.0",iwidth:60,placeholder:"0.0",position:[1,1,1,1],showon:{EXCLUDE_LOW_SIGFP_CBX:[!0]}},EXCLUDE_HIGH_EVALUE_CBX:{type:"checkbox",label:"Exclude high E-value reflections",tooltip:"Check to exclude reflections with high E-values",value:!1,position:[2,0,1,1]},MAXEVALUE:{type:"real",keyword:"ECUT",label:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximal E-value:",align:"right",reportas:"E-value rejection threshold",tooltip:"Maximal acceptable E-value for reflections. Reflections with higher value will be rejected.",range:[0,200],value:"5.0",iwidth:60,placeholder:"5.0",position:[2,1,1,1],showon:{EXCLUDE_HIGH_EVALUE_CBX:[!0]}}}},sec4:{type:"section",title:"Other Advanced Settings",open:!1,position:[3,0,1,5],contains:{PATTERSON_SUP_FINCTION_CBX:{type:"checkbox",label:"Use the Patterson Superposition Function",tooltip:"Check to use the Patterson Superposition Function",value:!0,position:[0,0,1,1]},DDM_DENSITY_LIMIT:{type:"real",keyword:"CUTDDM",label:"Upper density limit for Dynamic Density Modification (DDM)",tooltip:"Upper density limit for Dynamic Density Modification (DDM) (default 3.0)",range:[0,10],value:"3.0",placeholder:"3.0",position:[1,0,1,1]},CUSTOM_GRID_SIZE_CBX:{type:"checkbox",label:"Use custom grid size",tooltip:"Check to choose custom grid size",value:!1,position:[2,0,1,1]},GRIDSIZE:{type:"real",keyword:"GRID",label:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Grid size:",align:"right",reportas:"Grid size",tooltip:"Custom grid size (default 0.3333)",range:[0,5],value:"0.3333",placeholder:"0.3333",label2:"&Aring",position:[2,2,1,1],showon:{CUSTOM_GRID_SIZE_CBX:[!0]}}}}}}function AcornHotButton(){return{task:"TaskAcorn",tooltip:"Phase Refinement and Dynamic Density Modification with ACORN"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskAcorn.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskAcorn.prototype.constructor=TaskAcorn,TaskAcorn.prototype.icon=function(){return"task_acorn"},TaskAcorn.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskAcorn.prototype.checkKeywords=function(e){return this.__check_keywords(e,["acorn","density","modification","phase refinement"])},__template?(conf=require("../../js-server/server.configuration"),TaskAcorn.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],"substructure"==i.Options.leading_structure?this.input_data.data.istruct=[i.Substructure]:this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskAcorn.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.acorn",e,t,this.id]},module.exports.TaskAcorn=TaskAcorn):(TaskAcorn.prototype.desc_title=function(){return"refine a starting set of phases using Dynamic Density Modification"},TaskAcorn.prototype.hotButtons=function(){return[ArpWarpHotButton(),ModelCraftHotButton(),BuccaneerHotButton()]});var __template=null,conf;function TaskAimless(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskAimless",this.name="aimless",this.setOName("aimless"),this.title="Merging and Scaling with Aimless",this.input_dtypes=[{data_type:{DataUnmerged:[]},desc:"dataset to merge",label:"Unmerged<br>reflections",inputId:"unmerged",customInput:"unmerged",min:1,max:50},{data_type:{DataHKL:[],DataUnmerged:[]},desc:"symmetry reference",cast:"symmetry",label:"Crystal<br>Symmetry",inputId:"ds0",customInput:"unmerged-ref",min:1,max:1}],this.parameters={secMain:{type:"section",title:"Basic Options",open:!1,position:[0,0,1,8],contains:{PERFORM_SCALING:{position:[0,0,1,8],label:"Perform symmetry assignment,",keyword:"PERFORM_SCALING",type:"combobox",range:["YES|scaling and merging","NO|no scaling only merge"],tooltip:"Switch off scaling for scaled unmerged input data e.g. for INTEGRATED.HKL from XDS.",value:"YES"},LABEL01:{position:[1,0,1,8],type:"label",label:"For (scaling and) merging, use",tooltip:"Low and high Resolution cut-offs (&Aring;)  for scaling, merging and output dataset(s)."},RESO_LOW:{position:[2,0,1,1],align:"right",type:"real_",keyword:"RESO_LOW",label:"low resolution cut-off (&Aring;)",reportas:"Low resolution cut-off",tooltip:"Low resolution cut-off (&Aring;) for scaling, merging and output dataset(s). Leave blank to keep all low resolution data.",min:"0",value:""},RESO_HIGH:{position:[3,0,1,1],align:"right",type:"real_",keyword:"RESO_HIGH",label:"high resolution cut-off (&Aring;)",reportas:"High resolution cut-off",tooltip:"High resolution cut-off (&Aring;) for scaling, merging and output dataset(s). Leave blank to keep all high resolution data.",min:"0",value:""},LABEL02:{position:[4,0,1,8],hideon:{unmerged:[-1,0,1]},type:"label",label:"Scale all input datasets together",tooltip:"Use the option to merge separately for e.g. MAD experiment to scale together the input datasets from different wavelengths, but to merge them in separate output datasets"},MERGE_DATASETS:{position:[5,0,1,8],hideon:{unmerged:[-1,0,1]},align:"right",keyword:"MERGE_DATASETS",type:"combobox",range:["TOGETHER|together","SEPARATELY|separately"],label:"and merge",tooltip:"Use the option to merge separately for e.g. MAD experiment to scale together the input datasets from different wavelengths, but to merge them into separate output datasets",value:"TOGETHER"}}},secSymm:{type:"section",title:"Symmetry Analysis",open:!1,position:[1,0,1,8],contains:{TOLERANCE:{position:[0,0,1,8],keyword:"TOLERANCE",type:"real_",label:"Tolerance for comparing lattices (&deg;)",tooltip:"Tolerance for comparing lattices (degrees or equivalent on lengths; default 2.0)",min:"0",value:""},RESOLUTION_SYMM:{position:[1,0,1,8],keyword:"RESOLUTION_SYMM",type:"combobox",range:["AUTO|automatic","EXPLICIT|as for scaling and merging"],tooltip:"Use the same resolution for output and symmetry analysis only if automatic results are not conclusive; then use manual symmetry assignment in the final job",value:"AUTO",label:"High resolution limit for symmetry analysis"},CCHALFLIMIT:{position:[2,0,1,8],align:"right",showon:{RESOLUTION_SYMM:["AUTO"]},keyword:"CCHALFLIMIT",type:"real_",label:"CC(1/2) threshold (main method)",tooltip:"Maximum resolution for scoring set is defined by CC(1/2) threshold (default 0.6)",min:"0",max:"1",value:""},ISIGLIMIT:{position:[3,0,1,8],align:"right",showon:{RESOLUTION_SYMM:["AUTO"]},keyword:"ISIGLIMIT",type:"real_",label:" I/sig(I) threshold (fall-back method)",tooltip:"Maximum resolution for scoring set is defined by I/sig(I) threshold (default 6)",min:"0",value:""}}},secObs:{type:"section",title:"Observations Used",open:!1,position:[2,0,1,8],contains:{LABEL03:{position:[0,0,1,8],tooltip:"Accept partials with total fraction between limits below",label:"Only accept partials with total fraction",type:"label"},PARTIALS_FRACLOW:{position:[1,0,1,8],keyword:"PARTIALS_FRACLOW",type:"real_",label:"higher than",align:"right",tooltip:"Only accept partials with total fraction higher than this limit (default 0.95)",min:"0",max:"2",value:""},PARTIALS_FRACHIGH:{position:[2,0,1,8],keyword:"PARTIALS_FRACHIGH",type:"real_",label:"and lower than",align:"right",tooltip:"Only accept partials with total fraction lower than this limit (default 1.05)",min:"0",max:"2",value:""},ACCEPT_OVERLOADS:{position:[3,0,1,8],keyword:"ACCEPT_OVERLOADS",type:"combobox",range:["True|yes","False|no"],iwidth:82,tooltip:"Maybe keep overloads if many reflections are missing",value:"False",label:"Accept overloaded observations"},ACCEPT_EDGES:{position:[4,0,1,8],keyword:"ACCEPT_EDGES",type:"combobox",range:["True|yes","False|no"],iwidth:82,tooltip:"Accepting edge observations may increase completeness if needed",value:"False",label:"Accept observations on edge of tile or detector"},ACCEPT_XDS_MISFITS:{position:[5,0,1,8],keyword:"ACCEPT_XDS_MISFITS",type:"combobox",range:["True|yes","False|no"],iwidth:82,tooltip:"Accept or reject reflections flagged as outliers (MISFIT) by XDS (default: no)",value:"False",label:"Accept observations flagged by XDS as outliers"},LABEL04:{position:[6,0,1,8],tooltip:"&nbsp;",label:"&nbsp;",type:"label"},LABEL05:{position:[7,0,1,8],label:"If both summation and profile-fitted intensities",tooltip:"If both integrated and profile-fitted observations are available, choose how to use partially-recorded observations (Default: combine, e.g. use profile-fitted for weak intensities and summation for strong)",type:"label"},INTENSITIES_OPTIONS:{position:[8,0,1,8],label:"are avalable, use",align:"right",keyword:"INTENSITIES_OPTIONS",type:"combobox",range:["COMBINE|combined intensities","PROFILE|profile-fitted intensities","SUMMATION|summation intensities"],tooltip:"If both integrated and profile-fitted observations are available, choose how to use partially-recorded observations (Default: combine, e.g. use profile-fitted for weak intensities and summation for strong)",value:"COMBINE"}}},secSDCorr:{type:"section",title:"SD Correction",open:!1,position:[3,0,1,8],contains:{SDCORRECTION_REFINE:{position:[0,0,1,8],lwidth:260,keyword:"SDCORRECTION_REFINE",type:"combobox",range:["True|refined","False|set manually"],tooltip:"Refine SDcorrection parameters",value:"True",label:"SD correction parameters to be"},SDCORRECTION_SDFAC:{position:[1,0,1,8],align:"right",showon:{SDCORRECTION_REFINE:["False"]},label:"parameter sdFac",keyword:"SDCORRECTION_SDFAC",type:"real_",tooltip:"Parameter sdFac (default 1.0)",min:"0",value:""},SDCORRECTION_SDB:{position:[2,0,1,8],align:"right",showon:{SDCORRECTION_REFINE:["False"]},label:"parameter sdB",keyword:"SDCORRECTION_SDB",type:"real_",tooltip:"Parameter sdB (default 0.0)",min:"0",value:""},SDCORRECTION_SDADD:{position:[3,0,1,8],align:"right",showon:{SDCORRECTION_REFINE:["False"]},label:"parameter sdAdd",keyword:"SDCORRECTION_SDADD",type:"real_",tooltip:"Parameter sdAdd (default 0.03)",min:"0",value:""},SDCORRECTION_FIXSDB:{position:[4,0,1,8],showon:{SDCORRECTION_REFINE:["True"]},keyword:"SDCORRECTION_FIXSDB",type:"combobox",range:["False|no restrains","Tie|tie to zero","True|fix to zero"],tooltip:"Treatment of the sdB parameter",value:"False",label:"Treatment of the sdB parameter:"},SDCORRECTION_TIESDB_SD:{position:[5,0,1,8],align:"right",showon:{_:"&&",SDCORRECTION_REFINE:["True"],SDCORRECTION_FIXSDB:["Tie"]},label:"restraint on sdB value",keyword:"SDCORRECTION_TIESDB_SD",type:"real_",tooltip:"restraint on sdB value (default 10.0)",min:"0",value:""},LABEL06:{type:"label",position:[6,0,1,8],showon:{SDCORRECTION_REFINE:["True"]},tooltip:"&nbsp;",label:"&nbsp;"},LABEL07:{type:"label",position:[7,0,1,8],showon:{SDCORRECTION_REFINE:["True"]},tooltip:"If processing more than one run, define how SD parameters for different runs are linked",label:"If processing more than one run,"},SDCORRECTION_OPTIONS:{position:[8,0,1,8],align:"right",showon:{SDCORRECTION_REFINE:["True"]},keyword:"SDCORRECTION_OPTIONS",type:"combobox",range:["INDIVIDUAL|individual","SAME|same","SIMILAR|similar"],tooltip:"Use different, same or similar SDfactors for each run",value:"INDIVIDUAL",label:"SD parameters for each run are"},SDCORRECTION_SIMILARITY_SDFAC:{position:[9,0,1,8],align:"right",showon:{_:"&&",SDCORRECTION_REFINE:["True"],SDCORRECTION_OPTIONS:["SIMILAR"]},label:"sigma for restrains on sdFac",keyword:"SDCORRECTION_SIMILARITY_SDFAC",type:"real_",tooltip:"SD(sdFac) for similarity restraints (default 0.05)",min:"0",value:""},SDCORRECTION_SIMILARITY_SDB:{position:[10,0,1,8],align:"right",showon:{_:"&&",SDCORRECTION_REFINE:["True"],SDCORRECTION_OPTIONS:["SIMILAR"]},label:"sigma for restrains on sdB",keyword:"SDCORRECTION_SIMILARITY_SDB",type:"real_",tooltip:"SD(sdB) for similarity restraints (default 3.0)",min:"0",value:""},SDCORRECTION_SIMILARITY_SDADD:{position:[11,0,1,8],align:"right",showon:{_:"&&",SDCORRECTION_REFINE:["True"],SDCORRECTION_OPTIONS:["SIMILAR"]},label:"sigma for restrains on sdAdd",keyword:"SDCORRECTION_SIMILARITY_SDADD",type:"real_",tooltip:"SD(sdAdd) for similarity restraints (default 0.04)",min:"0",value:""}}},secReject:{type:"section",title:"Outlier Rejection",open:!1,position:[4,0,1,8],contains:{LABEL08:{position:[0,0,1,8],tooltip:"Reject an obserbvation if deviates from mean by more tham threshold value",label:"Thresholds deviation from mean (SDs)",type:"label"},OUTLIER_SDMAX:{position:[1,0,1,8],align:"right",label:"for three or more equivalent observations",keyword:"OUTLIER_SDMAX",type:"real_",tooltip:"for >2 observations, reject if more than this SDs (default 6.0)",min:"0",value:""},OUTLIER_SDMAX2:{position:[2,0,1,8],align:"right",label:"for two equivalent observations",keyword:"OUTLIER_SDMAX2",type:"real_",tooltip:"for 2 observations, reject if more than this SDs (default 6.0)",min:"0",value:""},OUTLIER_SDMAXALL:{position:[3,0,1,8],align:"right",label:"for differences between I+ and I-",keyword:"OUTLIER_SDMAXALL",type:"real_",tooltip:"for differences between I+ and I-, reject if more than this (SDs default 8.0)",min:"0",value:""},OUTLIER_SDMAXALL_ADJUST:{position:[4,0,1,8],align:"right",keyword:"OUTLIER_SDMAXALL_ADJUST",type:"combobox",range:["True|yes","False|no"],iwidth:82,tooltip:"Increase rejection threshold for large anomalous differences",value:"True",label:"increase for large anomalous differences"},OUTLIER_COMBINE:{position:[5,0,1,8],label:"",label:"For more than one dataset, compare outliers",keyword:"OUTLIER_COMBINE",type:"combobox",range:["True|across all datasets","False|within datasets"],tooltip:"test for rejections across all datasets or within individual datasets",value:"True"},OUTLIER_EMAX:{position:[6,0,1,8],label:"Set maximum E to reject unreasonably large intensities",keyword:"OUTLIER_EMAX",type:"real_",tooltip:"Maximum allowed E to exclude unreasonably large intensities (default 5.0)",min:"0",value:""}}},secScOpt:{type:"section",showon:{PERFORM_SCALING:["YES"]},title:"Scaling Protocols",open:!1,position:[5,0,1,8],contains:{SCALING_PROTOCOL:{position:[0,0,1,8],lwidth:320,label:"Scale",keyword:"SCALING_PROTOCOL",type:"combobox",range:["ROTATION|on rotation axis","CONSTANT|constant","BATCH|by batch (deprecated)"],tooltip:"define scaling protocol for all runs",value:"ROTATION"},SCALES_ROTATION_TYPE:{position:[1,0,1,8],showon:{SCALING_PROTOCOL:["ROTATION"]},label:"Define scale ranges along rotation axis by",keyword:"SCALES_ROTATION_TYPE",type:"combobox",range:["SPACING|rotation interval","NBINS|number of bins"],tooltip:"spacing for scales along primary beam",value:"SPACING"},SCALES_ROTATION_SPACING:{position:[2,0,1,8],align:"right",showon:{_:"&&",SCALING_PROTOCOL:["ROTATION"],SCALES_ROTATION_TYPE:["SPACING"]},keyword:"SCALES_ROTATION_SPACING",type:"real_",tooltip:"spacing in degrees (default 5.0)",value:"",min:"0",label:"spacing in degrees"},SCALES_ROTATION_NBINS:{position:[3,0,1,8],align:"right",showon:{_:"&&",SCALING_PROTOCOL:["ROTATION"],SCALES_ROTATION_TYPE:["NBINS"]},keyword:"SCALES_ROTATION_NBINS",label:"number of bins",type:"integer_",tooltip:"number of primary scales (default 1)",min:"0",value:""},LABEL09:{position:[4,0,1,8],showon:{SCALING_PROTOCOL:["ROTATION"]},label:"&nbsp;",tooltip:"&nbsp;",type:"label"},BFACTOR_SCALE:{position:[5,0,1,8],showon:{SCALING_PROTOCOL:["ROTATION","BATCH"]},label:"Refine relative B-factors",keyword:"BFACTOR_SCALE",type:"combobox",range:["True|yes","False|no"],iwidth:82,tooltip:"switch relative B-factor scaling on",value:"True"},SCALES_BROTATION_TYPE:{position:[6,0,1,8],showon:{_:"&&",SCALING_PROTOCOL:["ROTATION"],BFACTOR_SCALE:["True"]},label:"Define B-factor ranges along rotation axis by",keyword:"SCALES_BROTATION_TYPE",type:"combobox",range:["SPACING|rotation interval","NBINS|number of bins"],tooltip:"spacing for B-factors along primary beam",value:"SPACING"},SCALES_BROTATION_SPACING:{position:[7,0,1,8],align:"right",showon:{_:"&&",SCALING_PROTOCOL:["ROTATION"],BFACTOR_SCALE:["True"],SCALES_BROTATION_TYPE:["SPACING"]},keyword:"SCALES_BROTATION_SPACING",type:"real_",tooltip:"spacing in degrees (default 20.0)",value:"",min:"0",label:"spacing in degrees"},SCALES_BROTATION_NBINS:{position:[8,0,1,8],align:"right",showon:{_:"&&",SCALING_PROTOCOL:["ROTATION"],BFACTOR_SCALE:["True"],SCALES_BROTATION_TYPE:["NBINS"]},keyword:"SCALES_BROTATION_NBINS",label:"number of bins",type:"integer_",tooltip:"number of primary scales (default 1)",min:"0",value:""},LABEL10:{position:[9,0,1,8],showon:{SCALING_PROTOCOL:["ROTATION"]},label:"&nbsp;",tooltip:"&nbsp;",type:"label"},SCALES_SECONDARY_CORRECTION:{position:[10,0,1,8],showon:{SCALING_PROTOCOL:["ROTATION"]},label:"Apply secondary beam correction",keyword:"SCALES_SECONDARY_CORRECTION",type:"combobox",range:["True|yes","False|no"],iwidth:82,tooltip:"Apply and refine parameters of secondary beam correction",value:"True"},SCALES_SECONDARY_NSPHHARMONICS:{position:[11,0,1,8],align:"right",showon:{_:"&&",SCALES_SECONDARY_CORRECTION:["True"],SCALING_PROTOCOL:["ROTATION"]},label:"maximum order of spherical harmonics",keyword:"SCALES_SECONDARY_NSPHHARMONICS",type:"integer_",tooltip:"Number of spherical harmonic terms (eg 4 - 6, default 4)",min:"0",value:""},SCALES_TILETYPE:{position:[12,0,1,8],label:"Tile scaling for CCD detectors",showon:{_:"&&",SCALES_SECONDARY_CORRECTION:["True"],SCALING_PROTOCOL:["ROTATION"]},keyword:"SCALES_TILETYPE",type:"combobox",range:["DEFAULT|automatic","NONE|no tile correction","CCD|tile correction"],tooltip:"automatically on for 3x3 ADSC detectors",value:"DEFAULT"},SCALES_NTILEX:{position:[13,0,1,8],align:"right",showon:{_:"&&",SCALES_SECONDARY_CORRECTION:["True"],SCALING_PROTOCOL:["ROTATION"],SCALES_TILETYPE:["CCD"]},label:"number of tiles on X",keyword:"SCALES_NTILEX",type:"integer_",tooltip:"number of tiles on X (default 3)",min:"0",value:""},SCALES_NTILEY:{position:[14,0,1,8],align:"right",showon:{_:"&&",SCALES_SECONDARY_CORRECTION:["True"],SCALING_PROTOCOL:["ROTATION"],SCALES_TILETYPE:["CCD"]},label:"number of tiles on Y",keyword:"SCALES_NTILEY",type:"integer_",tooltip:"number of tiles on Y (default 3)",min:"0",value:""}}},secScDtl:{type:"section",showon:{PERFORM_SCALING:["YES"]},title:"Scaling Details",open:!1,position:[6,0,1,8],contains:{LABEL11:{position:[0,0,1,8],type:"label",tooltip:"Set scale refinement parameters",label:"Set scale refinement parameters"},CYCLES_N:{position:[1,0,1,8],align:"right",iwidth:72,keyword:"CYCLES_N",type:"integer_",tooltip:"Set number of cycles for scale refinement (default 10)",value:"",min:"0",label:"number of refinement cycles"},SELECT_IOVSDMIN:{position:[2,0,1,8],align:"right",iwidth:72,keyword:"SELECT_IOVSDMIN",type:"real_",tooltip:"Set minimum I/sd for 1st round scaling (default 3.0)",value:"",min:"0",label:"minimum I/sd for 1st round scaling"},SELECT_EMIN:{position:[3,0,1,8],align:"right",iwidth:72,keyword:"SELECT_EMIN",type:"real_",tooltip:"set minimum E for 2nd round scaling (default 1.0)",value:"",min:"0",label:"minimum E for 2nd round scaling"},LABEL12:{position:[4,0,1,8],type:"label",tooltip:"&nbsp;",label:"&nbsp;"},TIE_DETAILS:{position:[5,0,1,8],label:"Restarints for scale refinement:",lwidth:372,keyword:"TIE_DETAILS",type:"combobox",range:["DEFAULT|automatic","ADJUST|adjust settings"],value:"DEFAULT",tooltip:"Adjust or use automatic settings for restarints for scale refinement"},TIE_ROTATION:{position:[6,0,1,8],showon:{TIE_DETAILS:["ADJUST"]},keyword:"TIE_ROTATION",type:"combobox",range:["True|yes","False|no"],iwidth:82,tooltip:"Restrain successive primary beam scales together",value:"False",label:"Restrain neighbouring scale factors on rotation axis"},TIE_ROTATION_SD:{position:[7,0,1,8],align:"right",iwidth:72,showon:{_:"&&",TIE_DETAILS:["ADJUST"],TIE_ROTATION:["True"]},keyword:"TIE_ROTATION_SD",label:"SD",type:"real_",tooltip:"SD for restraints on successive primary beam scales (default 0.05)",min:"0",value:""},TIE_SURFACE:{position:[8,0,1,8],showon:{TIE_DETAILS:["ADJUST"]},keyword:"TIE_SURFACE",type:"combobox",range:["True|yes","False|no"],iwidth:82,tooltip:"Restrain secondary beam scales to sphere",value:"True",label:"Restrain surface parameters to a sphere"},TIE_SURFACE_SD:{position:[9,0,1,8],align:"right",iwidth:72,showon:{_:"&&",TIE_DETAILS:["ADJUST"],TIE_SURFACE:["True"]},keyword:"TIE_SURFACE_SD",label:"SD",type:"real_",tooltip:"SD for restraints on secondary beam scales to sphere (default 0.005)",min:"0",value:""},TIE_BFACTOR:{position:[10,0,1,8],showon:{TIE_DETAILS:["ADJUST"]},keyword:"TIE_BFACTOR",type:"combobox",range:["True|yes","False|no"],iwidth:82,label:"Restrain successive B-factors together",value:"False",tooltip:"Restrain neighbouring B-factors on rotation axis"},TIE_BFACTOR_SD:{position:[11,0,1,8],align:"right",iwidth:72,showon:{_:"&&",TIE_DETAILS:["ADJUST"],TIE_BFACTOR:["True"]},keyword:"TIE_BFACTOR_SD",label:"SD",type:"real_",tooltip:"SD for restraints on neighbouring B-factors on rotation axis (default 0.05)",min:"0",value:""},TIE_BZERO:{position:[12,0,1,8],showon:{TIE_DETAILS:["ADJUST"]},keyword:"TIE_BZERO",type:"combobox",range:["True|yes","False|no"],iwidth:82,label:"Tie B-factors to zero",value:"",tooltip:"Restrain B-factors to zero"},TIE_BZERO_SD:{position:[13,0,1,8],align:"right",iwidth:72,showon:{_:"&&",TIE_DETAILS:["ADJUST"],TIE_BZERO:["True"]},keyword:"TIE_BZERO_SD",label:"SD",type:"real_",tooltip:"SD for restrain on B-factors tied to zero (default 10.0)",min:"0",value:""}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskAimless.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskAimless.prototype.constructor=TaskAimless,TaskAimless.prototype.icon=function(){return"task_aimless"},TaskAimless.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskAimless.prototype.checkKeywords=function(e){return this.__check_keywords(e,["aimless","image","processing","data","reduction"])},__template?(conf=require("../../js-server/server.configuration"),TaskAimless.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.aimless",e,t,this.id]},module.exports.TaskAimless=TaskAimless):(TaskAimless.prototype.desc_title=function(){return"scale together multiple observations of reflections"},TaskAimless.prototype.collectInput=function(e){var i=TaskTemplate.prototype.collectInput.call(this,e);function t(e,t){i+="|<b><i>"+e+"</i>:</b> "+t}for(var o=this.input_data.getData("unmerged"),n=0;n<o.length;n++)for(var s=n+1;s<o.length;s++)o[n].dataId==o[s].dataId&&t("Reflection data","dataset "+o[n].dname+" is used in more than one input positions, which is not allowed");return i});var __template=null,conf;function TaskAmple(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskAmple",this.name="ample",this.setOName("ample"),this.title="Ab-Initio Molecular Replacement with Ample",this.input_dtypes=[{data_type:{DataRevision:["hkl"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1}],this.parameters={WARNING_LBL:{type:"label",label:"&nbsp;<br><i><b>Note:</b> this task takes significant computational resources and may put you outside your monthly quota.</i>",position:[0,0,1,5]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskAmple.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskAmple.prototype.constructor=TaskAmple,TaskAmple.prototype.icon=function(){return"task_ample"},TaskAmple.prototype.requiredEnvironment=function(){return["CCP4","ROSETTA_DIR"]},TaskAmple.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskAmple.prototype.checkKeywords=function(e){return this.__check_keywords(e,["ample","molecular","replacement","mr"])},__template&&(TaskAmple.prototype.desc_title=function(){return"use ab initio models as search models in molecular replacement"},conf=require("../../js-server/server.configuration"),TaskAmple.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskAmple.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.ample",e,t,this.id]},module.exports.TaskAmple=TaskAmple);var __template=null,conf;function TaskArcimboldoBorges(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskArcimboldoBorges",this.name="arcimboldo-borges",this.setOName("arcimboldo-borges"),this.title="Fragment Molecular Replacement with Arcimboldo-Borges",this.input_dtypes=[{data_type:{DataRevision:["~xyz","~phases"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1},{data_type:{DataBorges:[]},label:"Fragment library",inputId:"fragments",tooltip:"Custom fragment library (optional)",version:0,min:0,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[1,0,1,5],contains:{LIBRARY_SEL:{type:"combobox",keyword:"HELICES",label:"Use Borges Library:",tooltip:"Specify the number of helices to search for",range:["HELI_lib_uu|helices uu","HELI_lib_ud|helices ud","BETA_lib_udu|strands udu","BETA_lib_uud|strands uud","BETA_lib_uuu|strands uuu","BETA_lib_uuuu|strands uuuu","BETA_lib_udud|strands udud"],value:"HELI_lib_uu",iwidth:160,label2:"topology: u: up, d: down",position:[0,0,1,1],showon:{fragments:[-1,0]}},GYRE_SEL:{type:"combobox",keyword:"GYRE",label:"Phaser GYRE option:",tooltip:"Choose GYRE option mode",range:["auto|Auto","On|On","Off|Off"],value:"auto",iwidth:100,position:[1,0,1,1]},GIMBLE_SEL:{type:"combobox",keyword:"GIMBLE",label:"Phaser GIMBLE option:",tooltip:"Choose GIMBLE option mode",range:["auto|Auto","On|On","Off|Off"],value:"auto",iwidth:100,position:[2,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskArcimboldoBorges.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskArcimboldoBorges.prototype.constructor=TaskArcimboldoBorges,TaskArcimboldoBorges.prototype.icon=function(){return"task_arcimboldo"},TaskArcimboldoBorges.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskArcimboldoBorges.prototype.desc_title=function(){return"performs ab initio phasing with nonspecific libraries of small folds"},TaskArcimboldoBorges.prototype.platforms=function(){return"LMU"},TaskArcimboldoBorges.prototype.requiredEnvironment=function(){return["CCP4",["$CCP4_MASTER/BORGES_LIBS"]]},TaskArcimboldoBorges.prototype.checkKeywords=function(e){return this.__check_keywords(e,["arcimboldo","arcimboldoborges","borges","molecular","replacement","mr"])},__template&&(conf=require("../../js-server/server.configuration"),TaskArcimboldoBorges.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskArcimboldoBorges.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.arcimboldo",e,t,this.id]},module.exports.TaskArcimboldoBorges=TaskArcimboldoBorges);var __template=null,conf;function TaskArcimboldoLite(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskArcimboldoLite",this.name="arcimboldo-lite",this.setOName("arcimboldo-lite"),this.title="Fragment Molecular Replacement with Arcimboldo-Lite",this.input_dtypes=[{data_type:{DataRevision:["~xyz","~phases"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1},{data_type:{DataXYZ:["protein"]},label:"Fragment",inputId:"xyz",min:0,max:10}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[1,0,1,5],contains:{RMSD:{type:"real",keyword:"RMSD",label:"Assume",tooltip:"Assumed r.m.s.d. from target structure",range:[.001,2],value:"0.2",iwidth:40,position:[0,0,1,1]},RMSD_LBL:{type:"label",label:"(&Aring;)&nbsp;&nbsp;&nbsp; r.m.s.d. from target",position:[0,3,1,3]},COIL_COILED_CBX:{type:"checkbox",label:"Run in coil coiled mode",tooltip:"Check to run in coil coiled mode",value:!1,iwidth:200,position:[1,0,1,8]},SEP_LBL:{type:"label",label:"&nbsp;",position:[2,0,1,1]},HELICES_SEL:{type:"combobox",keyword:"HELICES",label:"Use",tooltip:"Specify the number of helices to search for",range:["1|one or more copies of a helix","2|2 different helices","3|3 different helices","4|4 different helices","5|5 different helices","6|6 different helices"],value:"1",iwidth:280,position:[3,0,1,6],showon:{xyz:[-1,0]}},HLEN1:{type:"integer",keyword:"HLEN1",label:"Helix length",lwidth:80,tooltip:"Length of helix",range:[4,100],value:"14",iwidth:40,position:[4,2,1,1],showon:{_:"&&",xyz:[-1,0],HELICES_SEL:["1"]}},HCOPIES1:{type:"integer",keyword:"HCOPIES1",label:"number of copies",tooltip:"Number of helix copies",range:[1,10],value:"2",iwidth:40,position:[4,5,1,1],showon:{_:"&&",xyz:[-1,0],HELICES_SEL:["1"]}},HLEN_1:{type:"integer",keyword:"HLEN_1",label:"Helix #1 length",lwidth:100,tooltip:"Length of helix #1",range:[4,100],value:"14",iwidth:40,position:[4,2,1,1],showon:{_:"&&",xyz:[-1,0],HELICES_SEL:["2","3","4","5","6"]}},HLEN_2:{type:"integer",keyword:"HLEN_2",label:"Helix #2 length",lwidth:100,tooltip:"Length of helix #2",range:[4,100],value:"14",iwidth:40,position:[5,2,1,1],showon:{_:"&&",xyz:[-1,0],HELICES_SEL:["2","3","4","5","6"]}},HLEN_3:{type:"integer",keyword:"HLEN_3",label:"Helix #3 length",lwidth:100,tooltip:"Length of helix #3",range:[4,100],value:"14",iwidth:40,position:[6,2,1,1],showon:{_:"&&",xyz:[-1,0],HELICES_SEL:["3","4","5","6"]}},HLEN_4:{type:"integer",keyword:"HLEN_4",label:"Helix #4 length",lwidth:100,tooltip:"Length of helix #4",range:[4,100],value:"14",iwidth:40,position:[7,2,1,1],showon:{_:"&&",xyz:[-1,0],HELICES_SEL:["4","5","6"]}},HLEN_5:{type:"integer",keyword:"HLEN_5",label:"Helix #5 length",lwidth:100,tooltip:"Length of helix #5",range:[4,100],value:"14",iwidth:40,position:[8,2,1,1],showon:{_:"&&",xyz:[-1,0],HELICES_SEL:["5","6"]}},HLEN_6:{type:"integer",keyword:"HLEN_6",label:"Helix #6 length",lwidth:100,tooltip:"Length of helix #6",range:[4,100],value:"14",iwidth:40,position:[9,2,1,1],showon:{_:"&&",xyz:[-1,0],HELICES_SEL:["6"]}},SCOPIES1:{type:"integer",keyword:"HCOPIES1",label:"Use",tooltip:"Number of fragment copies",range:[1,10],value:"2",iwidth:40,position:[10,0,1,1],showon:{xyz:[1]}},SCOPIES_LBL:{type:"label",label:"fragment copies",position:[10,3,1,3],showon:{xyz:[1]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskArcimboldoLite.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskArcimboldoLite.prototype.constructor=TaskArcimboldoLite,TaskArcimboldoLite.prototype.icon=function(){return"task_arcimboldo"},TaskArcimboldoLite.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskArcimboldoLite.prototype.desc_title=function(){return"performs ab initio phasing using polyalanine helices or other single search fragments for MR"},TaskArcimboldoLite.prototype.platforms=function(){return"LMU"},TaskArcimboldoLite.prototype.checkKeywords=function(e){return this.__check_keywords(e,["arcimboldo","arcimboldolite","lite","molecular","replacement","mr"])},__template&&(conf=require("../../js-server/server.configuration"),TaskArcimboldoLite.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskArcimboldoLite.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.arcimboldo",e,t,this.id]},module.exports.TaskArcimboldoLite=TaskArcimboldoLite);var __template=null;function TaskArcimboldo(){(__template?__template.TaskArcimboldoLite:TaskArcimboldoLite).call(this),this._type="TaskArcimboldo"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.arcimboldolite")),TaskArcimboldo.prototype.desc_title=function(){return"performs ab initio phasing using polyalanine helices or other single search fragments"},TaskArcimboldo.prototype=__template?Object.create(__template.TaskArcimboldoLite.prototype):Object.create(TaskArcimboldoLite.prototype),TaskArcimboldo.prototype.constructor=TaskArcimboldo,__template&&(module.exports.TaskArcimboldo=TaskArcimboldo);var __template=null,conf;function TaskArcimboldoShredder(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskArcimboldoShredder",this.name="arcimboldo-shredder",this.setOName("arcimboldo-shredder"),this.title="Fragment Molecular Replacement with Arcimboldo-Shredder",this.input_dtypes=[{data_type:{DataRevision:["~xyz","~phases"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1},{data_type:{DataXYZ:["protein"]},label:"Homology model",inputId:"xyz",min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[1,0,1,5],contains:{RMSD:{type:"real",keyword:"RMSD",label:"Assume",tooltip:"Assumed r.m.s.d. from target structure",range:[.001,2],value:"1.2",iwidth:40,position:[0,0,1,1]},RMSD_LBL:{type:"label",label:"(&Aring;)&nbsp;&nbsp;&nbsp; r.m.s.d. from target",position:[0,3,1,3]},POLYALA_SEL:{type:"combobox",keyword:"POLYALA",label:"Convert to polyalanine:",tooltip:"Mode for converting input model to polyalanine",range:["auto|Auto","On|On","Off|Off"],value:"auto",iwidth:100,position:[1,0,1,3]},BFACTORS_SEL:{type:"combobox",keyword:"BFACTORS",label:"Make all B-factors equal:",tooltip:"Mode for equalising B-factors",range:["auto|Auto","On|On","Off|Off"],value:"auto",iwidth:100,position:[2,0,1,3]},SHRMODE_SEL:{type:"combobox",keyword:"SHRMODE",label:"Shredder mode:",tooltip:"Shredder working mode",range:["sequential|sequential","spherical|spherical"],value:"spherical",iwidth:140,position:[3,0,1,3]},COIL_SEL:{type:"combobox",keyword:"COIL",label:"Maintain coil in the model:",tooltip:"Mode for maintaining coils in the model",range:["auto|Auto","On|On","Off|Off"],value:"auto",iwidth:100,position:[4,0,1,3],showon:{SHRMODE_SEL:["spherical"]}},GYRE_SEL:{type:"combobox",keyword:"GYRE",label:"Perform gyre refinement:",tooltip:"GYRE refinement mode",range:["auto|Auto","On|On","Off|Off"],value:"auto",iwidth:100,position:[5,0,1,3],showon:{SHRMODE_SEL:["spherical"]}},GIMBLE_SEL:{type:"combobox",keyword:"GIMBLE",label:"Perform gimble refinement:",tooltip:"GIMBLE refinement mode",range:["auto|Auto","On|On","Off|Off"],value:"auto",iwidth:100,position:[6,0,1,3],showon:{SHRMODE_SEL:["spherical"]}},LLG_SEL:{type:"combobox",keyword:"LLG",label:"Perform LLG-guided pruning:",tooltip:"Mode for LLG-guided pruning",range:["auto|Auto","On|On","Off|Off"],value:"auto",iwidth:100,position:[7,0,1,3],showon:{SHRMODE_SEL:["spherical"]}},PHASES_SEL:{type:"combobox",keyword:"PHASES",label:"Combine phases with alixe:",tooltip:"Combine partial solutions using ALIXE - better phases but runs longer",range:["auto|Auto","On|On","Off|Off"],value:"auto",iwidth:100,position:[8,0,1,3],showon:{SHRMODE_SEL:["spherical"]}}}},sec2:{type:"section",title:"Advanced parameters",open:!1,position:[2,0,1,5],contains:{FRAGMENT_SIZE:{type:"integer_",keyword:"FRAGMENT_SIZE",label:"Fragment size",tooltip:"Number of amoinoacids in a fragment.",iwidth:50,range:[1,"*"],value:"",position:[0,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskArcimboldoShredder.prototype.checkKeywords=function(e){return this.__check_keywords(e,["arcimboldo","arcimboldoshredder","shredder","molecular","replacement","mr"])},TaskArcimboldoShredder.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskArcimboldoShredder.prototype.constructor=TaskArcimboldoShredder,TaskArcimboldoShredder.prototype.icon=function(){return"task_arcimboldo"},TaskArcimboldoShredder.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskArcimboldoShredder.prototype.desc_title=function(){return"uses fragments derived from a distant homologue template for MR"},TaskArcimboldoShredder.prototype.platforms=function(){return"LMU"},__template&&(conf=require("../../js-server/server.configuration"),TaskArcimboldoShredder.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskArcimboldoShredder.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.arcimboldo",e,t,this.id]},module.exports.TaskArcimboldoShredder=TaskArcimboldoShredder);var __template=null,conf;function TaskAreaimol(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskAreaimol",this.name="areaimol",this.oname="*",this.title="Areaimol",this.input_dtypes=[{data_type:{DataRevision:["xyz"],DataEnsemble:[],DataModel:[],DataXYZ:[]},label:"Structure",inputId:"ixyz",min:1,max:1}],this.parameters={AREAIMOL_LBL:{type:"label",keyword:"none",lwidth:800,label:'&nbsp;<br><div style="font-size:14px;">Set AREAIMOL keywords and values in the input field below (consult <a href="https://www.ccp4.ac.uk/html/areaimol.html" target="_blank"><i>AREAIMOL reference</i></a> for more details).<sub>&nbsp;</sub></div>',position:[0,0,1,5]},AREAIMOL_INPUT:{type:"aceditor_",keyword:"none",tooltip:"",iwidth:800,iheight:320,placeholder:"# For example:\nSMODE IMOL\nSYMMETRY 19\nTRANS\nPROBE 1.6\n",value:"",position:[1,0,1,5]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskAreaimol.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskAreaimol.prototype.constructor=TaskAreaimol,TaskAreaimol.prototype.icon=function(){return"task_areaimol"},TaskAreaimol.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskAreaimol.prototype.checkKeywords=function(e){return this.__check_keywords(e,["xyz","analysis","coordinates","toolbox","areaimol"])},__template?(conf=require("../../js-server/server.configuration"),TaskAreaimol.prototype.makeInputData=function(e,t){var i=this.input_data.data.ixyz[0];"DataRevision"==i._type&&(this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskAreaimol.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.areaimol",e,t,this.id]},module.exports.TaskAreaimol=TaskAreaimol):TaskAreaimol.prototype.desc_title=function(){return"calculates the solvent accessible surface area"};var __template=null,conf;function TaskArpWarp(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskArpWarp",this.name="arpwarp",this.setOName("arpwarp"),this.title="Automated Model Building with Arp/wArp",!__template&&__licensed_tasks.indexOf(this._type)<0&&(this.nc_type="client"),this.input_dtypes=[{data_type:{DataRevision:["!protein","!phases"]},label:"Structure revision",inputId:"revision",version:7,customInput:"arpwarp",min:1,max:1}],this.parameters={sec1:{type:"section",title:"Arp/wArp Flow Parameters",open:!1,position:[0,0,1,5],contains:{AWA_BIG_CYCLES:{type:"integer",keyword:"AWA_BIG_CYCLES",label:"Number of macrocylces to do:",tooltip:"Number of macrocycles",range:[1,1e3],value:"10",iwidth:60,position:[0,0,1,1]},AWA_SMALL_CYCLES:{type:"integer",keyword:"AWA_SMALL_CYCLES",label:"each including",align:"right",tooltip:"Number of ARP-REFMAC cycles in each big cycle",range:[1,1e3],value:"5",iwidth:40,label2:"ARP-REFMAC cycles",position:[0,4,1,1]},AWA_USE_COND_CBX:{type:"checkbox",keyword:"AWA_USE_COND",label:"Use Conditional Restraints for free atoms",tooltip:"Check to use conditional restraints for free atoms",value:!0,translate:["0","1"],position:[1,0,1,7]},AWA_FORCECOND_CBX:{type:"checkbox",keyword:"AWA_FORCE_COND",label:"Force Conditional Restraints for very large structures",tooltip:"Force using conditional restraints for very large structures (time consuming)",value:!1,translate:["0","1"],position:[2,0,1,7]},AWA_FAKE_DATA_CBX:{type:"checkbox",keyword:"AWA_FAKE_DATA",label:"Use Fake Data",tooltip:"Check to use fake data",value:!1,position:[3,0,1,7]},AWA_NCS_RESTRAINTS_CBX:{type:"checkbox",keyword:"AWA_NCS_RESTRAINTS",label:"Use Non-Crystallographic Symmetry Restraints",tooltip:"Check to use NCS restraints",value:!0,translate:["0","1"],position:[4,0,1,7]},AWA_NCS_EXTENSION_CBX:{type:"checkbox",keyword:"AWA_NCS_EXTENSION",label:"Use Non-Crystallographic Symmetry for extending chains",tooltip:"Check to use NCS for extending chains",value:!0,translate:["0","1"],position:[5,0,1,7]},AWA_LOOPS_CBX:{type:"checkbox",keyword:"AWA_LOOPS",label:"Use Loopy to build loops between chain fragments",tooltip:"Check to use Loopy for building loops between structure fragments",value:!0,translate:["0","1"],position:[6,0,1,7]},AWA_BUILD_SIDE_CBX:{type:"checkbox",keyword:"AWA_BUILD_SIDE",label:"Start docking chains to sequence",tooltip:"Check to start docking the autotraced chains to sequence after given number of building cycles",value:!1,translate:["0","1"],position:[7,0,1,3]},AWA_SIDE_AFTER:{type:"integer",keyword:"AWA_SIDE_AFTER",label:"after",align:"right",align:"right",reportas:"Number of cycles to skip before docking chains",tooltip:"Number of first cycles to skip for chain tracing",range:[0,1e3],value:"0",iwidth:40,label2:"building cycles",position:[7,2,1,1],showon:{AWA_BUILD_SIDE_CBX:[!0]}},AWA_ALBE_CBX:{type:"checkbox",keyword:"AWA_ALBE",label:"Search for helices and strands before each building cycle",tooltip:"Check to search for helices and strands before each building cycle",value:!1,translate:["0","1"],position:[8,0,1,7]},AWA_SKIP_CYCLES:{type:"integer",keyword:"AWA_SKIP_CYCLES",label:"Skip chain tracing in first",tooltip:"Number of first cycles to skip for chain tracing",range:[0,1e3],value:"0",iwidth:60,label2:"building cycles",position:[9,0,1,1]},AWA_FREEBUILD_CBX:{type:"checkbox",keyword:"AWA_FREEBUILD",label:"Construct new free atoms model before autobuilding",tooltip:"Check to construct new free atoms model before autobuilding",value:!1,translate:["0","1"],position:[10,0,1,7]},AWA_FLATTEN_CBX:{type:"checkbox",keyword:"AWA_FLATTEN",label:"Perform density modification before autobuilding",tooltip:"Check to perform density modification before autobuilding",value:!1,translate:["0","1"],position:[11,0,1,7]},AWA_FREELOOPS_CBX:{type:"checkbox",keyword:"AWA_FREELOOPS",label:"Perform sequence-less loop building",tooltip:"Check to perform sequence-less loop building",value:!1,position:[12,0,1,7]},AWA_HOMOLOGY_CBX:{type:"checkbox",keyword:"AWA_HOMOLOGY",label:"Perform homology based loop building",tooltip:"Check to perform homology-based loop building",value:!1,position:[13,0,1,7]},AWA_MULTITRACE:{type:"integer",keyword:"AWA_MULTITRACE",label:"Iterate autotracing up to",tooltip:"Number of maximum iterations of autotracing",range:[1,1e3],value:"5",iwidth:60,label2:"times",position:[14,0,1,1]},AWA_ADDATOM_SIGMA:{type:"real",keyword:"AWA_ADDATOM_SIGMA",label:"Add atoms in density above",tooltip:"Minimal electron density sigma for adding atoms",range:[0,10],value:"3.2",iwidth:60,label2:"sigma",position:[15,0,1,1]},AWA_REMATOM_SIGMA:{type:"real",keyword:"AWA_REMATOM_SIGMA",label:"Remove atoms in density below",tooltip:"Maximal electron density sigma for removing atoms",range:[0,10],value:"1.0",iwidth:60,label2:"sigma",position:[16,0,1,1]},AWA_UP_UPDATE:{type:"integer",keyword:"AWA_UP_UPDATE",label:"Add and remove ",tooltip:"",range:[1,10],value:"1",iwidth:60,position:[17,0,1,1]},AWA_UP_UPDATE_LBL:{type:"label",label:"times atoms than calculated automatically",position:[17,4,1,7]}}},sec2:{type:"section",title:"Refinement Parameters",open:!1,position:[1,0,1,5],contains:{AWA_NCYCLES:{type:"integer",keyword:"AWA_NCYCLES",label:"Number of refinement cycles",tooltip:"Number of refinement cycles per every ARP-REFMAC cycle",range:[1,10],value:"1",position:[1,0,1,1]},AWA_NCYCLES_LBL:{type:"label",label:"(per every ARP-REFMAC cycle)",position:[1,3,1,4]},AWA_WEIGHT_MATRIX_SEL:{type:"combobox",keyword:"AWA_WEIGHT_MATRIX",label:"Matrix weighting for X-ray/Geometry",tooltip:"Matrix weighting mode for X-ray/Geometry",range:["AUTO|Automatic","MANUAL|Manual"],value:"A",iwidth:130,position:[2,0,1,1]},AWA_WMAT:{type:"real",keyword:"AWA_WMAT",label:"with matrix weight",reportas:"Matrix weight",tooltip:"matrix weight for X-ray/Geometry",range:[0,10],value:"0.5",position:[2,3,1,1],showon:{AWA_WEIGHT_MATRIX_SEL:["MANUAL"]}},AWA_RIDGE_RESTRAINTS_CBX:{type:"checkbox",keyword:"AWA_RIDGE_RESTRAINTS",label:"Use Jelly-Body restraints",tooltip:"Check to use jelly-body restraints in refinement",value:!1,translate:["0","1"],position:[3,0,1,1]},AWA_SCA_SEL:{type:"combobox",keyword:"AWA_SCA",label:"Scaling model",tooltip:"Scaling model to use",range:["SIMPLE|Simple","BULK|Bulk"],value:"SIMPLE",iwidth:130,position:[4,0,1,1]},AWA_SCANIS_SEL:{type:"combobox",keyword:"AWA_SCANIS",label:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with",align:"right",reportas:"Scaling B-factor model",tooltip:"Scaling B-factor model to use",range:["ANIS|anisotropic","ISO|isotropic"],value:"ANIS",iwidth:140,label2:"scaling B-factor",position:[4,3,1,1]},AWA_REFMAC_REF_SEL:{type:"combobox",keyword:"AWA_REFMAC_REF",label:"Do scaling and &sigma;<sub>A</sub> calculations with",tooltip:"Reflection set to use for scaling and &sigma;<sub>A</sub> calculations",range:["W|Working","F|Free"],value:"W",iwidth:130,position:[5,0,1,1]},AWA_REFMAC_REF_LBL:{type:"label",label:"set of reflections",position:[5,3,1,4]},AWA_SOLVENT_CBX:{type:"checkbox",keyword:"AWA_SOLVENT",label:"Use Solvent Mask correction",tooltip:"Check to use the Solvent Mask correction",value:!0,translate:["0","1"],position:[6,0,1,1]}}}}}function ArpWarpHotButton(){return{task:"TaskArpWarp",tooltip:"Automated model building with Arp/wArp"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskArpWarp.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskArpWarp.prototype.constructor=TaskArpWarp,TaskArpWarp.prototype.icon=function(){return"task_arpwarp"},TaskArpWarp.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskArpWarp.prototype.platforms=function(){return"LMU"},TaskArpWarp.prototype.requiredEnvironment=function(){return["CCP4","warpbin"]},TaskArpWarp.prototype.authorisationID=function(){return"client"==this.nc_type?"arpwarp":""},TaskArpWarp.prototype.checkKeywords=function(e){return this.__check_keywords(e,["arpwarp","model","building","auto-mb"])},__template?(conf=require("../../js-server/server.configuration"),TaskArpWarp.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq,"substructure"==i.Options.leading_structure?this.input_data.data.istruct=[i.Substructure]:this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskArpWarp.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.arpwarp",e,t,this.id]},module.exports.TaskArpWarp=TaskArpWarp):(TaskArpWarp.prototype.desc_title=function(){return"builds macromolecular models"},TaskArpWarp.prototype.hotButtons=function(){return[CootMBHotButton()]});var __template=null,conf;function TaskASUDef(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskASUDef",this.name="asymmetric unit contents",this.oname="",this.title="Asymmetric Unit Contents",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataHKL:[]},label:"Reflections",tooltip:"Reflection dataset, which will be used for phasing and refinement in the follow-up tasks.",inputId:"hkl",min:1,max:1},{data_type:{DataSequence:["~unknown"]},label:"Sequence",unchosen_label:"sequence unknown",tooltip:"Macromolecular sequence(s) expected in ASU. If unknown, choose [do not use] and set the estimated molecular size in the parameters section below in the page.",inputId:"seq",customInput:"stoichiometry-wauto",version:0,force:10,min:0,max:10}],this.parameters={HATOM:{type:"string_",keyword:"atomtype=",label:"<b><i>Main anomalous<br>scatterer</i></b>",tooltip:"Specify atom type of dominant anomalous scatterer (e.g., S, SE etc.), or leave blank if uncertain.",iwidth:40,value:"",emitting:!0,maxlength:2,position:[0,0,1,1],showon:{"hkl.subtype:anomalous":[1]}},EPLBL:{type:"label",label:'<h3>Reflection data does not contain anomalous differences.</h3><font color="maroon"><i>Not suitable for Experimental Phasing.</i></font>',position:[1,0,1,5],showon:{"hkl.subtype:anomalous":[0,-1]}},NSPL:{type:"label",label:"&nbsp",position:[2,0,1,5]},sec1:{type:"section",title:"Parameters",open:!0,position:[3,0,1,5],showon:{seq:[-1,0]},contains:{ESTIMATE_SEL:{type:"combobox",keyword:"estimate",label:"Estimate molecular size using",tooltip:"When sequence is not given, choose to estimate the molecular size using either the total number of residues or total molecular weight. In case of several different molecules, give the combined size with respect to stoichiometric ratios.",range:["NR|number of residues","MW|molecular weight"],value:"NR",position:[0,0,1,1],showon:{seq:[-1,0]}},NRES:{type:"integer",keyword:"NRES",label:"number of residues",tooltip:"Total number of residues in the molecule. In case of several different molecules, give the combined number of residues with respect to stoichiometric ratios.",iwidth:80,range:[1,"*"],value:"",position:[0,3,1,1],showon:{ESTIMATE_SEL:["NR"],seq:[-1,0]}},MOLWEIGHT:{type:"real",keyword:"MOLWEIGHT",label:"molecular weight (Daltons)",tooltip:"Total molecular weight of the molecule. In case of several different molecules, give the combined weight with respect to stoichiometric ratios.",iwidth:80,range:[1,"*"],value:"",position:[0,3,1,1],showon:{ESTIMATE_SEL:["MW"],seq:[-1,0]}},COMPOSITION_SEL:{type:"combobox",keyword:"MODE",label:"General crystal composition",tooltip:"Give general crystal composition",range:["P|protein only","C|protein/polynucletide complex","D|polynucletide only"],value:"P",position:[1,0,1,1],showon:{ESTIMATE_SEL:["NR","MW"],seq:[-1,0]}}}}}}function AsuDefHotButton(){return{task:"TaskASUDef",tooltip:"Define Asymmetric Unit"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskASUDef.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskASUDef.prototype.constructor=TaskASUDef,TaskASUDef.prototype.icon=function(){return"task_asudef"},TaskASUDef.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskASUDef.prototype.checkKeywords=function(e){return this.__check_keywords(e,["asu","asymmetric","unit","content","definition"])},__template?(conf=require("../../js-server/server.configuration"),TaskASUDef.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.asudef",e,t,this.id]},module.exports.TaskASUDef=TaskASUDef):(TaskASUDef.prototype.desc_title=function(){return"to define Asymmetric Unit Contents"},TaskASUDef.prototype.desc_title=function(){return"specify the expected ASU composition and form the initial Structure Revision"},TaskASUDef.prototype.inputChanged=function(e,t,i){var o,n;"hkl"==t&&(o=e.grid.inpDataRef,0<=(o=(o=this.getInputItem(o,"hkl").dropdown[0]).dt[o.getValue()]).subtype.indexOf(hkl_subtype.anomalous)&&(n=e.parameters.HATOM.input,o.hasOwnProperty("ha_type")&&o.ha_type&&n.setValue(o.ha_type))),TaskTemplate.prototype.inputChanged.call(this,e,t,i)});var __template=null,conf;function TaskASUDefStruct(){(__template?__template.TaskASUDef:TaskASUDef).call(this),this._type="TaskASUDefStruct",this.name="asymmetric unit content",this.setOName("asudef"),this.title="Asymmetric Unit Content from Structure",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataStructure:["xyz"]},label:"Structure",tooltip:"Structure object with phasing results.",inputId:"istruct",min:1,max:1},{data_type:{DataHKL:[]},label:"",inputId:"void1",min:1,max:1e5},{data_type:{DataSequence:["~unknown"]},label:"Sequence",tooltip:"Macromolecular sequence(s) expected in ASU. If unknown, choose [do not use] and set the estimated molecular size in the parameters section below in the page.",inputId:"seq",customInput:"stoichiometry-wauto",version:0,force:1,min:0,max:10}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.asudef")),TaskASUDefStruct.prototype=__template?Object.create(__template.TaskASUDef.prototype):Object.create(TaskASUDef.prototype),TaskASUDefStruct.prototype.constructor=TaskASUDefStruct,TaskASUDefStruct.prototype.icon=function(){return"task_asudef"},TaskASUDefStruct.prototype.currentVersion=function(){return __template?0+__template.TaskASUDef.prototype.currentVersion.call(this):0+TaskASUDef.prototype.currentVersion.call(this)},__template&&(conf=require("../../js-server/server.configuration"),TaskASUDefStruct.prototype.makeInputData=function(e,t){for(var i=this.input_data.data.istruct[0].associated,o=this.input_data.data.void1,n=[],s=0;s<o.length;s++)0<=i.indexOf(o[s].dataId)&&n.push(o[s]);this.input_data.data.hkl=n,__template.TaskASUDef.prototype.makeInputData.call(this,e,t)},TaskASUDefStruct.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.asudef",e,t,this.id]},module.exports.TaskASUDefStruct=TaskASUDefStruct);var __template=null,conf;function TaskASUMod(){(__template?__template.TaskASUDef:TaskASUDef).call(this),this._type="TaskASUMod",this.name="asymmetric unit correction",this.setOName("asucorr"),this.title="Asymmetric Unit Correction",this.fasttrack=!0,this.input_dtypes.unshift({data_type:{DataRevision:[]},label:"Structure revision",tooltip:"Structure revision, in which the ASU contents needs to be modified",inputId:"revision",customInput:"asumod",version:5,min:1,max:1}),this.input_dtypes[1].min=0,this.input_dtypes[1].unchosen_label="[do not change]",this.input_dtypes[1].tooltip="Reflection dataset to be used for phasing and refinement in further tasks. If change of the reflection dataset is not required, choose [do not change].",this.input_dtypes[2].min=0,this.input_dtypes[2].tooltip="Macromolecular sequence(s) expected in ASU. If no change required, choose [do not use]. If change is required but the sequence(s) are unknown, choose [do not use] and give an estimate of the ASU molecular size in the parameters section below in  the page.",this.input_dtypes[2].force=1,delete this.parameters.HATOM,this.parameters.sec1.contains.ESTIMATE_SEL.range=["KE|do not estimate, leave as is","NR|number of residues","MW|molecular weight"],this.parameters.sec1.contains.ESTIMATE_SEL.value="KE"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.asudef")),TaskASUMod.prototype=__template?Object.create(__template.TaskASUDef.prototype):Object.create(TaskASUDef.prototype),TaskASUMod.prototype.constructor=TaskASUMod,TaskASUMod.prototype.icon=function(){return"task_asumod"},TaskASUMod.prototype.currentVersion=function(){return __template?1+__template.TaskASUDef.prototype.currentVersion.call(this):1+TaskASUDef.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskASUMod.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl0=[i.HKL],this.input_data.data.seq0=i.ASU.seq,i.Structure&&(this.input_data.data.istruct=[i.Structure])),__template.TaskASUDef.prototype.makeInputData.call(this,e,t)},TaskASUMod.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.asumod",e,t,this.id]},module.exports.TaskASUMod=TaskASUMod):TaskASUMod.prototype.collectInput=function(e){var e=TaskASUDef.prototype.collectInput.call(this,e),t=this.input_data.getData("hkl"),i=this.input_data.getData("seq");return e=t.length<=0&&i.length<=0&&"KE"==this.parameters.sec1.contains.ESTIMATE_SEL.value?"<b><i>No ASU changes requested -- nothing to do.</i></b>":e};var __template=null,conf;function TaskAuspex(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskAuspex",this.name="Auspex",this.oname="*",this.title="Reflection data diagnostics with Auspex plots",this.input_dtypes=[{data_type:{DataHKL:[]},label:"Reflection Data",inputId:"hkl",version:0,min:1,max:1}],this.parameters={},this.parameters={SEPARATOR_LBL:{type:"label",label:"&nbsp",position:[0,1,1,1]},sec1:{type:"section",title:"Plot generation parameters",open:!0,position:[1,0,1,5],contains:{YRANGE_SEL:{type:"combobox",keyword:"yrange",label:"Range along Y-axis:",tooltip:"Range mode along Y-axis",range:["minmax|plot all data","auto|core of distribution","auto_low|core distribution with focus on low values","low|only values below the mean"],value:"auto",position:[0,0,1,1]},DMIN:{type:"real_",keyword:"--dmin",label:"High resolution cut-off",iwidth:60,tooltip:"No cut-off (empty box) includes all data",range:[0,100],value:"",default:"",position:[1,0,1,1]},PLOTS_CBX:{type:"checkbox",keyword:"--single-figure",label:"Put all plots in one figure",tooltip:"Check if separate plot figures are required",iwidth:350,value:!1,position:[2,0,1,3]},REDFLAG_CBX:{type:"checkbox",keyword:"--no-automatic",label:"Flag suspected ice rings red",tooltip:"If unchecked, no automatic ice ring detection will be performed",iwidth:350,value:!0,position:[3,0,1,3]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskAuspex.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskAuspex.prototype.constructor=TaskAuspex,TaskAuspex.prototype.icon=function(){return"task_auspex"},TaskAuspex.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskAuspex.prototype.desc_title=function(){return"detects problems and artifacts in the reflection data"},TaskAuspex.prototype.checkKeywords=function(e){return this.__check_keywords(e,["auspex","toolbox","diagnostic","reflection","data","images"])},__template?(conf=require("../../js-server/server.configuration"),TaskAuspex.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.auspex",e,t,this.id]},module.exports.TaskAuspex=TaskAuspex):TaskAuspex.prototype.collectInput=function(e){e=TaskTemplate.prototype.collectInput.call(this,e);return this.input_data.getData("hkl")[0].isImean()||(e+="|<b>Reflection data:</b> Auspex can work only with reflection datasets that include mean intensities, and they are not found in the dataset from the selected structure revision"),e};var __template=null,conf;function TaskAWNuce(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskAWNuce",this.name="arpwarp nuce",this.setOName("awnuce"),this.title="NUCE: Trace Nucleic Acid Chains with Arp/wArp",this.input_dtypes=[{data_type:{DataRevision:[["rna","dna"],"!phases"]},label:"Structure revision",inputId:"revision",version:4,min:1,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskAWNuce.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskAWNuce.prototype.constructor=TaskAWNuce,TaskAWNuce.prototype.checkKeywords=function(e){return this.__check_keywords(e,["trace","nucleic","acid","arpwarp"])},TaskAWNuce.prototype.platforms=function(){return"LMU"},TaskAWNuce.prototype.requiredEnvironment=function(){return["CCP4","warpbin"]},TaskAWNuce.prototype.authorisationID=function(){return"client"==this.nc_type?"arpwarp":""},TaskAWNuce.prototype.icon=function(){return"task_arpwarp"},TaskAWNuce.prototype.desc_title=function(){return"traces nucleic acid chains in electron density"},TaskAWNuce.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskAWNuce.prototype.hotButtons=function(){return[RefmacHotButton(),CootMBHotButton()]},__template&&(conf=require("../../js-server/server.configuration"),TaskAWNuce.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskAWNuce.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.awnuce",e,t,this.id]},module.exports.TaskAWNuce=TaskAWNuce);var __template=null,conf;function TaskBalbes(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskBalbes",this.name="balbes",this.setOName("balbes"),this.title="Auto-MR with Balbes",this.input_dtypes=[{data_type:{DataRevision:["!protein","!asu","~xyz"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskBalbes.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskBalbes.prototype.constructor=TaskBalbes,TaskBalbes.prototype.icon=function(){return"task_balbes"},TaskBalbes.prototype.platforms=function(){return"LMU"},TaskBalbes.prototype.requiredEnvironment=function(){return["CCP4","BALBES_ROOT"]},TaskBalbes.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskBalbes.prototype.checkKeywords=function(e){return this.__check_keywords(e,["balbes","mr","molecular","replacement","auto-mr"])},__template?(conf=require("../../js-server/server.configuration"),TaskBalbes.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskBalbes.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.balbes",e,t,this.id]},module.exports.TaskBalbes=TaskBalbes):(TaskBalbes.prototype.desc_title=function(){return"finds sequence homologs, prepares search models and performs MR"},TaskBalbes.prototype.taskDescription=function(){return"Finds sequence homologs, prepares search models and performs MR"},TaskBalbes.prototype.hotButtons=function(){return[CootMBHotButton()]});var __template=null,conf;function TaskBuccaneer(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskBuccaneer",this.name="buccaneer",this.setOName("buccaneer"),this.title="Automatic Model Building with Buccaneer",this.input_dtypes=[{data_type:{DataRevision:["!protein","!seq","!phases"]},label:"Structure revision",inputId:"revision",customInput:"buccaneer-ws",version:7,min:1,max:1},{data_type:{DataStructure:["~substructure","~substructure-am","!xyz"]},desc:"fixed model",label:"Fixed model",inputId:"xmodel",customInput:"buccaneer-xm",tooltip:"Optional part of model to be extended.",min:0,max:1},{data_type:{DataStructure:["~substructure-am","!xyz"]},desc:"model to aid sequencing",label:"Model to aid<br>sequencing",inputId:"smodel",tooltip:"Optional part(s) of model to aid sequencing.",min:0,max:1}],this.parameters={sec1:{type:"section",title:"Options",open:!1,position:[0,0,1,5],contains:{TITLE1:{type:"label",label:"<h3><i>General options</i></h3>",position:[0,0,1,4]},ANISO_CBX:{type:"checkbox",label:"Apply anisotropy correction to input data",keyword:"buccaneer-anisotropy-correction",tooltip:"Check to apply anisotropy correction to input data",value:!0,position:[1,0,1,3]},SELEN_CBX:{type:"checkbox",label:"Build Selenomethionine (MSE instead of MET)",keyword:"buccaneer-build-semet",tooltip:"Check to build selenomethionine",value:!1,position:[2,0,1,3]},TITLE2:{type:"label",label:"<h3><i>Calculation options</i></h3>",position:[3,0,1,4]},NCYCLES:{type:"integer",keyword:"cycles",label:"Number of building/refinement cycles",tooltip:"Choose a value between 1 and 500",range:[1,500],value:"5",position:[4,0,1,1]},FASTEST_CBX:{type:"checkbox",label:"Use fastest methods",keyword:"buccaneer-fast",tooltip:"Check to use fastests methods",value:!0,position:[5,0,1,3]}}},sec2:{type:"section",title:"Model Building Parameteres",open:!1,position:[1,0,1,5],contains:{TITLE1:{type:"label",label:"<h3><i>Parameters for first Buccaneer cycle</i></h3>",position:[0,0,1,4]},NICYCLES1:{type:"integer_",keyword:"buccaneer-1st-cycles",label:"Number of internal building cycles",tooltip:"Choose a value between 1 and 50",range:[1,50],value:"3",position:[1,0,1,1]},CORRTF1_CBX:{type:"checkbox",keyword:"buccaneer-1st-correlation-mode",label:"Use correlation target function",tooltip:"Check to use the correlation target function",value:!1,position:[2,0,1,3]},SEQASGN1_SEL:{type:"combobox",keyword:"buccaneer-1st-sequence-reliability",label:"Assign sequence when found match is ",tooltip:"Choose how to assign sequence when a match is found ",range:["0.99|definite","0.95|probable","0.80|possible"],value:"0.95",position:[3,0,1,1]},TITLE2:{type:"label",label:"<h3><i>Parameters for subsequent Buccaneer cycles</i></h3>",position:[4,0,1,4]},NICYCLES2:{type:"integer_",keyword:"buccaneer-nth-cycles",label:"Number of internal building cycles",tooltip:"Choose a value between 1 and 50",range:[1,50],value:"2",position:[5,0,1,1]},CORRTF2_CBX:{type:"checkbox",keyword:"buccaneer-nth-correlation-mode",label:"Use correlation target function",tooltip:"Check to use the correlation target function",value:!0,position:[6,0,1,3]},SEQASGN2_SEL:{type:"combobox",keyword:"buccaneer-nth-sequence-reliability",label:"Assign sequence when found match is ",tooltip:"Choose how to assign sequence when a match is found ",range:["0.99|definite","0.95|probable","0.80|possible"],value:"0.95",position:[7,0,1,1]},TITLE3:{type:"label",label:"<h3><i>General parameters</i></h3>",position:[8,0,1,4]},RESMIN:{type:"real",keyword:"buccaneer-resolution",label:"Truncate data beyond resolution limit [&Aring;]",tooltip:"Truncate resolution limit",range:[.1,"*"],value:"2.0",position:[9,0,1,1]},UNKRESN:{type:"string",keyword:"buccaneer-new-residue-name",label:"Residue name for unsequenced residues",tooltip:"Substructure atom giving anomalous scattering",value:"UNK",maxlength:3,position:[10,0,1,1]},FIX_POSITION_CBX:{type:"checkbox",label:"Build the new model in the same place as the input model",tooltip:"Fix position of the model in the a.s.u.",keyword:"buccaneer-fix-position",value:!1,position:[11,0,1,3]},TITLE5:{type:"label",label:"<h3><i>Reference structure data</i></h3>",position:[18,0,1,4]},REFMDL_SEL:{type:"combobox",keyword:"REFMDL",label:"Library reference structure to use:",tooltip:"Choose library reference structure",range:["1tqw|1tqw","1ajr|1ajr"],value:"1tqw",position:[19,0,1,1]}}},sec3:{type:"section",title:"Refinement Parameteres",open:!1,position:[2,0,1,5],contains:{REFTWIN_CBX:{type:"checkbox",label:"Refine against twinned data",keyword:"refmac-twin",tooltip:"Check to refine against twinned data",value:!1,translate:["0","1"],position:[0,0,1,3]},USEPHI_CBX:{type:"checkbox",label:"Use phases in refinement",keyword:"refmac-mlhl",tooltip:"Check to use phases in refinement",value:!1,translate:["0","1"],position:[1,0,1,3]},AUTOWEIGH_CBX:{type:"checkbox",label:"Automatic weighting of restraints",tooltip:"Check to use automatic weighting of restraints",value:!0,position:[2,0,1,3]},WEIGHTVAL:{type:"real",keyword:"KEEPATMRAD",label:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or weight value",align:"right",tooltip:"Weight value for restraints",range:[0,"*"],value:"0.1",position:[2,2,1,1],showon:{AUTOWEIGH_CBX:[!1]}}}}},void 0!==__local_service&&""!=__local_service&&(this.parameters.sec1.contains.FASTEST_CBX.position[0]=6,this.parameters.sec1.contains.NCPUS={type:"integer_",keyword:"jobs",label:"Number of CPU cores to use",tooltip:"Choose a value between 1 and 8 but no more than the number actual CPU cores in your system",range:[1,8],value:"2",position:[5,0,1,1]})}function BuccaneerHotButton(){return{task:"TaskBuccaneer",tooltip:"Automated model building with Buccaneer"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskBuccaneer.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskBuccaneer.prototype.constructor=TaskBuccaneer,TaskBuccaneer.prototype.icon=function(){return"task_buccaneer"},TaskBuccaneer.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskBuccaneer.prototype.checkKeywords=function(e){return this.__check_keywords(e,["buccaneer","density","modification","dm"])},__template?(conf=require("../../js-server/server.configuration"),TaskBuccaneer.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq,"substructure"==i.Options.leading_structure?(this.input_data.data.istruct=[i.Substructure],this.Structure&&(this.input_data.data.ixyz=[i.Structure])):this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskBuccaneer.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.buccaneer",e,t,this.id]},module.exports.TaskBuccaneer=TaskBuccaneer):(TaskBuccaneer.prototype.desc_title=function(){return"performs statistical Model Building"},TaskBuccaneer.prototype.hotButtons=function(){return[CootMBHotButton()]});var __template=null,conf;function TaskBuster(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskBuster",this.name="buster",this.setOName("buster"),this.title="Buster Refinement",this.input_dtypes=[{data_type:{DataRevision:["!xyz"]},label:"Structure revision",inputId:"revision",customInput:"buster",version:0,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Main parameters",open:!0,position:[0,0,1,5],contains:{NBIGCYC:{type:"integer_",keyword:"-nbig",label:"Perform",tooltip:"Number of big cycles of refinement",range:[1,"*"],value:"",iwidth:60,label2:"iterations",placeholder:"5",position:[0,0,1,1]},NSMALLCYC:{type:"integer_",keyword:"-nsmall",label:"of",tooltip:"Number of small cycles of refinement",range:[1,"*"],value:"",iwidth:60,placeholder:"100",position:[0,5,1,1]},CYCLLABEL_LBL:{type:"label",label:"refinement cycles each",position:[0,8,1,5]},SOLVENT_SEL:{type:"combobox",keyword:"-WAT",label:"Solvent modelling",tooltip:"Solvent modelling mode",range:["Auto|Auto","All|Update every cycle","Custom|Start updating after N first cycles","None|Do not update"],value:"Auto",iwidth:300,position:[1,0,1,6]},NWAT:{type:"integer",keyword:"-WAT",label:"N=",align:"right",tooltip:"solvent update will start after the specified number of initial cycles",range:[1,"*"],value:"",iwidth:40,label2:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",position:[1,4,1,1],showon:{SOLVENT_SEL:["Custom"]}},AUTOTLS_CBX:{type:"checkbox",label:"Auto TLS",tooltip:"Check to include TLS",value:!1,position:[2,0,1,3]},AUTORB_CBX:{type:"checkbox",label:"Rigid Body (by chains)",tooltip:"Check to perform initial Rigid-Body refinement by chains",value:!1,position:[3,0,1,3]},LIGANDED_CBX:{type:"checkbox",label:"Enhance Ligand Density",tooltip:"Attempts to enhance difference density to aid in identification of potential ligand sites with unknown location (also turns on water updating)",value:!1,position:[4,0,1,3]},AUTONCS_CBX:{type:"checkbox",label:"Auto NCS",tooltip:"Automatically detect NCS and impose LSSR restraints",value:!1,position:[5,0,1,3]},NCSPRUNE_CBX:{type:"checkbox",label:"Prune NCS outliers",tooltip:"Automatic pruning of NCS outliers",value:!0,showon:{AUTONCS_CBX:[!0]},position:[6,0,1,3]},NCSIMPROVE_SEL:{type:"combobox",keyword:"-sim_swap",label:"NCS improvement",tooltip:"Improve NCS relation of symmetrical side-chains by swapping equivalent atoms",range:["None|None","Group1|For Asp, Glu, Tyr, Phe and Arg","Group2|For Asp, Glu, Tyr, Phe, Arg, Asn, Gln and His"],value:"None",iwidth:400,showon:{AUTONCS_CBX:[!0]},position:[7,0,1,10]}}},sec2:{type:"section",title:"Gelly parameters",open:!1,position:[1,0,1,5],contains:{LABEL:{type:"label",keyword:"none",lwidth:800,label:'<div style="font-size:14px;">Set Gelly options (or copy-paste the content of .gelly file) in the input field below (consult <a href="https://www.globalphasing.com/buster/manual/gelly/manual/gelly0.html" target="_blank"><i>Gelly reference</i></a> for more details).<sub>&nbsp;</sub></div>',position:[0,0,1,5]},GELLY:{type:"aceditor_",keyword:"none",tooltip:"",iwidth:800,iheight:320,value:"",position:[1,0,1,5]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskBuster.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskBuster.prototype.constructor=TaskBuster,TaskBuster.prototype.icon=function(){return"task_buster"},TaskBuster.prototype.desc_title=function(){return"refines macromolecular structure"},TaskBuster.prototype.platforms=function(){return"LMU"},TaskBuster.prototype.requiredEnvironment=function(){return["CCP4","BDG_home"]},TaskBuster.prototype.authorisationID=function(){return"gphl-buster"},TaskBuster.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskBuster.prototype.checkKeywords=function(e){return this.__check_keywords(e,["buster","refinement"])},TaskBuster.prototype.checkKeywords=function(e){return this.__check_keywords(e,["buster","refinement","global","phasing"])},__template&&(conf=require("../../js-server/server.configuration"),TaskBuster.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskBuster.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.buster",e,t,this.id]},module.exports.TaskBuster=TaskBuster);var __template=null,conf;function TaskCCP4Build(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskCCP4Build",this.name="ccp4build",this.setOName("ccp4build"),this.title="Automatic Model Building with CCP4Build",this.input_dtypes=[{data_type:{DataRevision:["!protein","!seq","!phases"]},label:"Structure revision",inputId:"revision",customInput:"ccp4build",version:7,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Main options",open:!0,position:[0,0,1,5],contains:{NCYCLES_MIN:{type:"integer",keyword:"cycles_min",label:"Minimum number of building cycles",tooltip:"Choose a value between 1 and 50",range:[1,50],value:"3",position:[0,0,1,1]},NCYCLES_MAX:{type:"integer",keyword:"cycles_max",label:"Maximum number of build cycles",tooltip:"Choose a value between 1 and 50 and not less than the minimum number of cycles",range:[1,50],value:"8",position:[1,0,1,1]},NOIMPROVE_CYCLES:{type:"integer",keyword:"cycles",label:"Stop if results do not improve during",tooltip:"Choose a value between 1 and 50",range:[1,50],value:"4",label2:"consequitive cycles",position:[2,0,1,1]},ANISO_CBX:{type:"checkbox",label:"Apply anisotropy correction to input data",keyword:"ccp4build-anisotropy-correction",tooltip:"Check to apply anisotropy correction to input data",value:!0,position:[3,0,1,3]},SELEN_CBX:{type:"checkbox",label:"Build Selenomethionine (MSE instead of MET)",keyword:"ccp4build-build-semet",tooltip:"Check to build selenomethionine",value:!1,position:[4,0,1,3]},WATER_CBX:{type:"checkbox",label:"Model solvent for phase improvement",keyword:"ccp4build-build-semet",tooltip:"Check to model water molecules in course of building. This may or may not improve performance depending on data properties.",value:!1,position:[5,0,1,3]},TRIM_WAT_RFREE:{type:"real",keyword:"trim_wat_rfree",label:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if R<sub>free</sub> is below",tooltip:"Water modelling will be used only at Rfree lower than the specified.",range:[0,1],value:"0.33",placeholder:"0.33",position:[5,2,1,1],showon:{WATER_CBX:[!0]}}}},sec2:{type:"section",title:"Advanced Build Parameters",open:!1,position:[1,0,1,5],contains:{REFLEVEL_SEL:{type:"combobox",keyword:"ref_level",label:"Refinement level:",tooltip:'Refinement level, "normal" recommended.',range:["1|light (fast)","2|normal (intermediate)","3|laborious (slow)"],value:"2",position:[0,0,1,10]},DMMODE_SEL:{type:"combobox",keyword:"dm_mode",label:"Perform density modification:",tooltip:'Density modification mode, "as required" recommended.',range:["auto|as required","always|always","never|never"],value:"auto",position:[1,0,1,10]},FILLMODE_SEL:{type:"combobox",keyword:"fill_mode",label:"Reconstruct side chains:",tooltip:'Side chains reconstruction mode, "as required" recommended.',range:["auto|as required","always|always","never|never"],value:"never",position:[2,0,1,10]},FITMODE_SEL:{type:"combobox",keyword:"fit_mode",label:"Fit protein with Coot:",tooltip:'Fit protein mode, "as required" recommended.',range:["auto|as required","always|always","never|never"],value:"auto",position:[3,0,1,10]},RSRMODE_SEL:{type:"combobox",keyword:"fit_mode",label:"Perform Real Space Refinement:",tooltip:'Real Space Refinement mode, "as required" recommended.',range:["auto|as required","always|always","never|never"],value:"never",position:[4,0,1,10]},TRIMMODE_SEL:{type:"combobox",keyword:"trimmode",label:"Trim built models: ",tooltip:"Protein trimming mode",range:["never|never","auto|automatically","restricted|within restrictions","fixed|fixed cut-offs"],value:"never",position:[5,0,1,10]},TRIMMIN_ZDM:{type:"real",keyword:"trimmin_zdm",label:"Trim mainchains with ZEDCC varying from",tooltip:"Minimum Electron Density Z-score threshold for trimming mainchains -- exact value will be chosen automatically",range:[0,"*"],value:"1.8",placeholder:"1.8",position:[6,0,1,1],showon:{TRIMMODE_SEL:["restricted"]}},TRIMMAX_ZDM:{type:"real",keyword:"trimmax_zdm",label:"to",tooltip:"Maximum Electron Density Z-score threshold for trimming mainchains -- exact value will be chosen automatically",range:[0,"*"],value:"3.2",placeholder:"3.2",position:[6,4,1,1],showon:{TRIMMODE_SEL:["restricted"]}},TRIMMIN_ZDS:{type:"real",keyword:"trimmin_zds",label:"Trim sidechains with ZEDCC varying from",tooltip:"Minimum Electron Density Z-score threshold for trimming sidechains -- exact value will be chosen automatically",range:[0,"*"],value:"1.8",placeholder:"1.8",position:[7,0,1,1],showon:{TRIMMODE_SEL:["restricted"]}},TRIMMAX_ZDS:{type:"real",keyword:"trimmax_zds",label:"to",tooltip:"Maximum Electron Density Z-score threshold for trimming sidechains -- exact value will be chosen automatically",range:[0,"*"],value:"3.2",placeholder:"3.2",position:[7,4,1,1],showon:{TRIMMODE_SEL:["restricted"]}},TRIM_ZDM:{type:"real",keyword:"trim_zdm",label:"ZEDCC cut-off for trimming mainchains",tooltip:"Electron Density Z-score cut-off for trimming mainchains.",range:[0,"*"],value:"2.5",placeholder:"2.5",position:[8,0,1,1],showon:{TRIMMODE_SEL:["fixed"]}},TRIM_ZDS:{type:"real",keyword:"trim_zds",label:"ZEDCC cut-off for trimming sidechains",tooltip:"Electron Density Z-score cut-off for trimming sidechains.",range:[0,"*"],value:"2.5",placeholder:"2.5",position:[9,0,1,1],showon:{TRIMMODE_SEL:["fixed"]}},TRIMMODE_W_SEL:{type:"combobox",keyword:"trimmode_w",label:"Trim placed waters: ",tooltip:"Water trimming mode",range:["never|never","auto|automatically","restricted|within restrictions","fixed|fixed cut-offs"],value:"restricted",position:[10,0,1,10],showon:{WATER_CBX:[!0]}},TRIMMIN_ZDW:{type:"real",keyword:"trimmin_zdw",label:"Trim waters with ZEDCC varying from",tooltip:"Minimum Electron Density Z-score threshold for trimming waters -- exact value will be chosen automatically",range:[0,"*"],value:"1.5",placeholder:"1.5",position:[11,0,1,1],showon:{_:"&&",WATER_CBX:[!0],TRIMMODE_W_SEL:["restricted"]}},TRIMMAX_ZDW:{type:"real",keyword:"trimmax_zdw",label:"to",tooltip:"Maximum Electron Density Z-score threshold for trimming waters -- exact value will be chosen automatically",range:[0,"*"],value:"2.0",placeholder:"2.0",position:[11,4,1,1],showon:{_:"&&",WATER_CBX:[!0],TRIMMODE_W_SEL:["restricted"]}},TRIM_ZDW:{type:"real",keyword:"trim_zdw",label:"ZEDCC cut-off for trimming waters",tooltip:"Electron Density Z-score cut-off for trimming waters.",range:[0,"*"],value:"11.8",placeholder:"1.8",position:[12,0,1,1],showon:{_:"&&",WATER_CBX:[!0],TRIMMODE_W_SEL:["fixed"]}}}},sec3:{type:"section",title:"Advanced Refinement Parameters",open:!1,position:[2,0,1,5],contains:{EXPERIMENT:{type:"combobox",keyword:"none",label:"Diffraction experiment type",tooltip:"Diffraction experiment type",range:["xray|X-ray","electron|Electron","neutron|Neutron"],value:"xray",position:[0,0,1,1]},FORM_FACTOR:{type:"combobox",keyword:"none",label:"form factor calculation method",tooltip:"Electron form factor calculation method",range:["gaussian|Sum of Gaussians","mb|Mott-Bethe"],value:"gaussian",showon:{EXPERIMENT:["electron"]},position:[0,5,1,1]}}}}}function CCP4BuildHotButton(){return{task:"TaskCCP4Build",tooltip:"Automated model building with CCP4Build"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCCP4Build.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCCP4Build.prototype.constructor=TaskCCP4Build,TaskCCP4Build.prototype.icon=function(){return"task_ccp4build"},TaskCCP4Build.prototype.desc_title=function(){return"builds model with density modification, model trimming, side-chain reconstruction and real-space refinement"},TaskCCP4Build.prototype.canEndGracefully=function(){return!0},TaskCCP4Build.prototype.currentVersion=function(){return __template?6+__template.TaskTemplate.prototype.currentVersion.call(this):6+TaskTemplate.prototype.currentVersion.call(this)},TaskCCP4Build.prototype.checkKeywords=function(e){return this.__check_keywords(e,["ccp4build","model","building","auto-mb"])},__template?(conf=require("../../js-server/server.configuration"),TaskCCP4Build.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq,"substructure"==i.Options.leading_structure?this.input_data.data.istruct=[i.Substructure]:this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskCCP4Build.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.ccp4build_task",e,t,this.id]},module.exports.TaskCCP4Build=TaskCCP4Build):(TaskCCP4Build.prototype.hotButtons=function(){return[CootMBHotButton()]},TaskCCP4Build.prototype.collectInput=function(e){function t(e,t){i+="|<b>"+e+":</b> "+t}var i=TaskTemplate.prototype.collectInput.call(this,e);return this.parameters.sec1.contains.NCYCLES_MAX.value<this.parameters.sec1.contains.NCYCLES_MIN.value&&t("Maximum number of cycles","cannot be less than the minimum number of cycles"),"restricted"==this.parameters.sec2.contains.TRIMMODE_SEL.value&&(this.parameters.sec2.contains.TRIMMAX_ZDM.value<this.parameters.sec2.contains.TRIMMIN_ZDM.value&&t("Trim restrictions for mainchains","maximum ZEDCC is less than minimum ZEDCC"),this.parameters.sec2.contains.TRIMMAX_ZDS.value<this.parameters.sec2.contains.TRIMMIN_ZDS.value&&t("Trim restrictions for sidechains","maximum ZEDCC is less than minimum ZEDCC")),i});var __template=null,conf;function TaskCCP4go(){__template?(__template.TaskTemplate.call(this),this.state=__template.job_code.retired):(TaskTemplate.call(this),this.state=job_code.retired),this._type="TaskCCP4go",this.name="ccp4go",this.setOName("ccp4go"),this.title="CCP4go auto-solver (experimental)",this.files=["","",""],this.ligands=[];for(var e=0;e<10;e++)this.ligands.push({source:"none",smiles:"",code:""});this.input_dtypes=[{data_type:{DataUnmerged:[],DataHKL:[]},label:"Reflection Data",inputId:"hkldata",version:0,min:1,max:1},{data_type:{DataSequence:[]},label:"Sequence",tooltip:"(Optional) Macromolecular sequence(s) expected in ASU.",inputId:"seq",version:0,force:1,min:0,max:10},{data_type:{DataModel:[],DataXYZ:[]},label:"Structure homologue",tooltip:"(Optional) Specify coordinate data set(s) to be used as model(s) for Molecular Replacement.",inputId:"xyz",min:0,max:1},{data_type:{DataLigand:[]},label:"Ligand data",tooltip:"(Optional) Specify ligands to be fit in electron density.",inputId:"ligand",min:0,max:5},{data_type:{DataRevision:[]},label:"Structure revision",inputId:"revision",version:0,min:0,max:0}],this.parameters={HATOM:{type:"string_",keyword:"atomtype=",label:"<b><i>Main anomalous<br>scatterer</i></b>",tooltip:"Specify atom type of dominant anomalous scatterer (e.g., S, SE etc.), or leave blank if uncertain.",iwidth:40,value:"",maxlength:2,position:[0,0,1,1]},SPACER1:{type:"label",label:"&nbsp;",position:[1,0,1,1]},sec1:{type:"section",title:"Components control (advanced)",open:!1,position:[2,0,1,8],contains:{TITLE1:{type:"label",label:"<i>Uncheck components which <u>should not</u> be used:</i><sub>&nbsp;</sub>",position:[0,0,1,5]},SIMBAD12_CBX:{type:"checkbox",keyword:"simbad12",label:"Compatible lattice and contaminant search",tooltip:"Uncheck to skip database searches on compatible lattice parameters and possible contaminants.",iwidth:350,value:!1,position:[1,0,1,3]},MORDA_CBX:{type:"checkbox",keyword:"morda",label:"Automated Molecular Replacement",tooltip:"Uncheck to skip phasing with automated molecular replacement.",iwidth:350,value:!0,position:[2,0,1,3]},CRANK2_CBX:{type:"checkbox",keyword:"crank2",label:"Automated Experimental Phasing",tooltip:"Uncheck to skip automated experimental phasing.",iwidth:350,value:!0,position:[3,0,1,3]},FITLIGANDS_CBX:{type:"checkbox",keyword:"findligands",label:"Fitting Ligands",tooltip:"Uncheck to skip fitting ligands.",iwidth:350,value:!0,position:[4,0,1,3]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCCP4go.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCCP4go.prototype.constructor=TaskCCP4go,TaskCCP4go.prototype.icon=function(){return"task_ccp4go"},TaskCCP4go.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskCCP4go.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.ccp4go_task",e,t,this.id]},module.exports.TaskCCP4go=TaskCCP4go):(TaskCCP4go.prototype.makeInputPanel=function(e){return e.isEmpty()?(this.input_mode=input_mode.root,this._makeInputPanel(e)):TaskTemplate.prototype.makeInputPanel.call(this,e)},TaskCCP4go.prototype.collectInput=function(e){return this.getInputMode()==input_mode.upload?this._collectInput(e):TaskTemplate.prototype.collectInput.call(this,e)},TaskCCP4go.prototype.doRun=function(e,t){return this.getInputMode()==input_mode.upload?this._doRun(e,t):TaskTemplate.prototype.doRun.call(this,e,t)},TaskCCP4go.prototype._makeInputPanel=function(e){var t,i=1,a=this.makeInputLayout(),o=(this.setInputDataFields(a.grid,0,e,this),this.state==job_code.new||this.state==job_code.running?(a.header.setLabel(" ",2,0,1,1),a.header.setLabel(" ",2,1,1,1)):a.header.uname_inp.setValue(this.uname.replace(/<(?:.|\n)*?>/gm,"")),a.customData={},a.customData.login_token=__login_token,a.customData.project=this.project,a.customData.job_id=this.id,a.customData.file_mod={rename:{},annotation:[]},a.upload_files=[],a.grid.setLabel("<h2>Input Data</h2>",0,0,1,4).setFontItalic(!0).setNoWrap(),1);function r(e,t,i){t=a.grid.setLabel(t,e,0,1,1).setTooltip(i).setFontItalic(!0).setFontBold(!0).setNoWrap();return a.grid.setVerticalAlignment(e,0,"middle"),t}function n(e,t,i,o,n){var t=r(e,t,i),s=a.grid.setSelectFile(!1,o,e,2,1,1),i=(s.hide(),a.grid.addButton("Browse",image_path("open_file"),e,2,1,1)),o=n,n=(this.state==job_code.new&&(o=""),a.grid.setInputText(o,e,3,1,2).setWidth_px(300).setReadOnly(!0).setNoWrap());return a.grid.setVerticalAlignment(e,2,"middle"),a.grid.setVerticalAlignment(e,3,"middle"),i.addOnClickListener(function(){s.click()}),{label:t,fsel:s,browse:i,itext:n}}function s(){for(var e=0,t=0;t<a.seq_select.length;t++)a.seq_select[t].browse.isVisible()&&(e=t),a.seq_select[t].add.hide(),a.seq_select[t].remove.hide();e<i-1&&a.seq_select[e].itext.getValue()&&a.seq_select[e].add.show(),0<e&&a.seq_select[e].remove.show()}function l(e,t,i){var o=null;return(o=0==i?n(e,"Sequence(s)","[Desired] Provide a path to sequence file in .fasta or .pir format. For importing several sequences put them all in a single file.",".pir, .seq, .fasta",t):n(e,"Sequence #"+(i+1),"Provide a path to additinal sequence file if needed",".pir, .seq, .fasta",t)).add=a.grid.addButton("",image_path("add"),e,5,1,1).setHeight_px(14).setWidth_px(4).setTooltip("add"),o.remove=a.grid.addButton("",image_path("remove"),e,6,1,1).setHeight_px(14).setWidth_px(4).setTooltip("remove"),a.grid.setVerticalAlignment(e,5,"middle"),a.grid.setVerticalAlignment(e,6,"middle"),o.add.hide(),o.remove.hide(),0<i&&(o.label.hide(),o.browse.hide(),o.itext.hide()),o.add.addOnClickListener(function(){i<9&&(a.seq_select[i+1].label.show(),a.seq_select[i+1].browse.show(),a.seq_select[i+1].itext.show(),s())}),o.remove.addOnClickListener(function(){0<i&&(a.seq_select[i].label.hide(),a.seq_select[i].browse.hide(),a.seq_select[i].itext.hide(),s())}),o.fsel.addOnChangeListener(function(){a.customData.file_mod={rename:{},annotation:[]};var e=o.fsel.getFiles();0<e.length&&_import_checkFiles(e,a.customData.file_mod,a.upload_files,function(){o.itext.setValue(e[0].name),s()})}),o}a.grid.setLabel("&nbsp;",o,1,1,1).setNoWrap(),a.mtz_select=(e=o,c=this.files[0],(t=n(e,"Reflection data","[Mandatory] Provide a path to MTZ file with merged or unmerged reflections.",".mtz,.sca",c)).fsel.addOnChangeListener(function(){var e=t.fsel.getFiles();0<e.length&&t.itext.setValue(e[0].name)}),t),a.grid.setLabel("&nbsp;",o++,4,1,1).setNoWrap(),a.seq_select=[];for(var c,d,h=0;h<i;h++)a.seq_select.push(l(o++,this.files[1],h));a.coor_select=(e=o++,c=this.files[2],(d=n(e,"Structure","[Optional] Provide a path to a PDB or mmCIF file with known (and close) structural homologue, or an apo structure.",".pdb, .ent, .mmcif, .pdbx, .cif",c)).fsel.addOnChangeListener(function(){var e=d.fsel.getFiles();0<e.length&&d.itext.setValue(e[0].name)}),d);var u=o;function p(){for(var e=-1,t=0;t<a.ligands.length;t++)"none"!=a.ligands[t].selection.getValue()&&(e=t);for(var i=!1,o=!1,t=0;t<a.ligands.length;t++){var n=t<=e+1,s=a.ligands[t].selection.getValue();a.ligands[t].label.setVisible(n),a.ligands[t].selection.setVisible(n),a.ligands[t].smiles.setVisible(n&&"smiles"==s),a.ligands[t].code.setVisible(n&&"none"!=s),"smiles"==s&&(o=!0),"none"!=s&&(i=!0)}a.code_lbl.setVisible(i),a.smiles_lbl.setVisible(o)}a.grid.setLabel("",o++,0,1,1).setHeight_px(8),a.grid.setLabel("&nbsp;",o++,0,1,1).setHeight_px(8),a.code_lbl=a.grid.setLabel("<b><i>Code</i></b>",o,3,1,1).setTooltip('3-letter code to identify the ligand. If no SMILES string is given, the code must match one from RCSB Compound dictionary. However, if SMILES string is provided, the code must not match any of known ligands, e.g., "DRG".'),a.smiles_lbl=a.grid.setLabel("<b><i>SMILES String</i></b>",o++,4,1,1).setTooltip("SMILES string describing ligands structure."),a.ligands=[];for(h=0;h<this.ligands.length;h++){var m=r(o,"Ligand #"+(h+1),"[Optional] Provide description of ligand to fit in electron density, using either a SMILES string or 3-letter code. Up to "+this.ligands.length+" ligands may be specified."),f=new Dropdown,g=(f.setWidth("120px"),a.grid.setWidget(f,o,2,1,1),f.addItem("None","","none","none"==this.ligands[h].source),f.addItem("SMILES","","smiles","smiles"==this.ligands[h].source),f.addItem("Code","","code","code"==this.ligands[h].source),f.make(),a.grid.setInputText(this.ligands[h].code,o,3,1,1).setWidth_px(50).setNoWrap().setMaxInputLength(3).setVisible("code"==this.ligands[h].source)),_=a.grid.setInputText(this.ligands[h].smiles,o,4,1,1).setWidth_px(600).setNoWrap().setVisible("smiles"==this.ligands[h].source);a.grid.setVerticalAlignment(o,2,"middle"),a.grid.setVerticalAlignment(o,3,"middle"),a.grid.setVerticalAlignment(o,4,"middle"),a.ligands.push({label:m,selection:f,smiles:_,code:g}),f.sno=h,f.addOnChangeListener(function(e,t){a.ligands[this.sno].code.setVisible("none"!=t),a.ligands[this.sno].smiles.setVisible("smiles"==t),p()}),o++}p(),this.layParameters(a.grid,a.grid.getNRows()+1,0);for(var b=a.grid.getNCols(),h=1;h<b;h++)a.grid.setLabel(" ",u,h,1,1).setHeight_px(8),a.grid.setCellSize("auto","",u,h);return a.grid.setLabel(" ",u,b,1,1).setHeight_px(8),a.grid.setCellSize("95%","",u,b),a},TaskCCP4go.prototype._collectInput=function(e){for(var t="",i=e.mtz_select.fsel.getFiles(),o=0;o<this.ligands.length;o++)this.ligands[o].source=e.ligands[o].selection.getValue(),this.ligands[o].smiles=e.ligands[o].smiles.getValue(),this.ligands[o].code=e.ligands[o].code.getValue(),"none"!=this.ligands[o].source&&(this.ligands[o].code||(t+="<b><i>Code for ligand #"+(o+1)+" is not given</i></b>"),"smiles"!=this.ligands[o].source||this.ligands[o].smiles||(t+="<b><i>SMILES string for ligand #"+(o+1)+" is not given</i></b>"));for(var n=!0,o=0;o<this.ligands.length&&n;o++)if("none"!=this.ligands[o].source&&this.ligands[o].code)for(var s=o+1;s<this.ligands.length&&n;s++)"none"!=this.ligands[s].source&&this.ligands[o].code==this.ligands[s].code&&(n=!1,t+="<b><i>Repeat use of ligand code "+this.ligands[o].code+"</i></b>");return i.length<1&&(t+="<b><i>Reflection data is not specified</i></b>"),TaskTemplate.prototype.collectInput.call(this,e),t},TaskCCP4go.prototype._doRun=function(e,t){var i=[e.mtz_select.fsel.getFiles()],o=e.seq_select[0].fsel.getFiles(),n=e.coor_select.fsel.getFiles();this.files=["","",""],0<i.length&&(this.files[0]=i[0][0].name),0<o.length&&(i.push(o),this.files[1]=o[0].name),0<n.length&&(i.push(n),this.files[2]=n[0].name),i[0].length<0?new MessageBox("Stop run","Task cannot be run as no reflection<br>data are given"):new UploadDialog("Upload data",i,e.customData,!0,function(e){e?new MessageBox("Stop run","Task cannot be run due to upload errors:<p><b><i>"+e+"</i></b>"):t()})},TaskCCP4go.prototype.customDataClone=function(e,t){this.ligands=[];for(var i=0;i<t.ligands.length;i++)this.ligands.push({source:t.ligands[i].source,smiles:t.ligands[i].smiles,code:t.ligands[i].code})});var __template=null,conf;function TaskCCP4go2(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskCCP4go2",this.name="ccp4go2",this.setOName("ccp4go2"),this.title="CCP4go2 auto-solver (experimental)",this.files=["","",""],this.ligands=[];for(var e=0;e<10;e++)this.ligands.push({source:"none",smiles:"",code:""});this.input_dtypes=[{data_type:{DataUnmerged:[],DataHKL:[]},label:"Reflection Data",inputId:"hkldata",version:0,min:1,max:1},{data_type:{DataSequence:[]},label:"Sequence",tooltip:"(Optional) Macromolecular sequence(s) expected in ASU.",inputId:"seq",version:0,force:1,min:0,max:10},{data_type:{DataModel:[],DataXYZ:[]},label:"Structure homologue",tooltip:"(Optional) Specify coordinate data set(s) to be used as model(s) for Molecular Replacement.",inputId:"xyz",min:0,max:1},{data_type:{DataLigand:[]},label:"Ligand data",tooltip:"(Optional) Specify ligands to be fit in electron density.",inputId:"ligand",min:0,max:5},{data_type:{DataRevision:[]},label:"Structure revision",inputId:"revision",version:0,min:0,max:0}],this.parameters={HATOM:{type:"string_",keyword:"atomtype=",label:"<b><i>Main anomalous<br>scatterer</i></b>",tooltip:"Specify atom type of dominant anomalous scatterer (e.g., S, SE etc.), or leave blank if uncertain.",iwidth:40,value:"",maxlength:2,position:[0,0,1,1]},SPACER1:{type:"label",label:"&nbsp;",position:[1,0,1,1]},sec1:{type:"section",title:"Components control (advanced)",open:!1,position:[2,0,1,8],contains:{TITLE1:{type:"label",label:"<i>Uncheck components which <u>should not</u> be used:</i><sub>&nbsp;</sub>",position:[0,0,1,5]},SIMBAD12_CBX:{type:"checkbox",keyword:"simbad12",label:"Compatible lattice and contaminant search",tooltip:"Uncheck to skip database searches on compatible lattice parameters and possible contaminants.",iwidth:350,value:!1,position:[1,0,1,3]},MORDA_CBX:{type:"checkbox",keyword:"morda",label:"Automated Molecular Replacement",tooltip:"Uncheck to skip phasing with automated molecular replacement.",iwidth:350,value:!0,position:[2,0,1,3]},CRANK2_CBX:{type:"checkbox",keyword:"crank2",label:"Automated Experimental Phasing",tooltip:"Uncheck to skip automated experimental phasing.",iwidth:350,value:!0,position:[3,0,1,3]},FITLIGANDS_CBX:{type:"checkbox",keyword:"findligands",label:"Fitting Ligands",tooltip:"Uncheck to skip fitting ligands.",iwidth:350,value:!0,position:[4,0,1,3]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCCP4go2.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCCP4go2.prototype.constructor=TaskCCP4go2,TaskCCP4go2.prototype.icon=function(){return"task_ccp4go"},TaskCCP4go2.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskCCP4go2.prototype.getCommandLine=function(e,t){return 0<this.autoRunId.length?[conf.pythonName(),"-m","pycofe.tasks.import_autorun",e,t,this.id]:[conf.pythonName(),"-m","pycofe.tasks.ccp4go2_task",e,t,this.id]},module.exports.TaskCCP4go2=TaskCCP4go2):(TaskCCP4go2.prototype.makeInputPanel=function(e){return e.isEmpty()?(this.input_dtypes=[1],this._makeInputPanel(e)):TaskTemplate.prototype.makeInputPanel.call(this,e)},TaskCCP4go2.prototype.collectInput=function(e){return 1==this.input_dtypes?this._collectInput(e):TaskTemplate.prototype.collectInput.call(this,e)},TaskCCP4go2.prototype.doRun=function(e,t){return 1==this.input_dtypes?this._doRun(e,t):TaskTemplate.prototype.doRun.call(this,e,t)},TaskCCP4go2.prototype._makeInputPanel=function(e){var t,i=1,a=this.makeInputLayout(),o=(this.setInputDataFields(a.grid,0,e,this),this.state==job_code.new||this.state==job_code.running?(a.header.setLabel(" ",2,0,1,1),a.header.setLabel(" ",2,1,1,1)):a.header.uname_inp.setValue(this.uname.replace(/<(?:.|\n)*?>/gm,"")),a.customData={},a.customData.login_token=__login_token,a.customData.project=this.project,a.customData.job_id=this.id,a.customData.file_mod={rename:{},annotation:[]},a.upload_files=[],a.grid.setLabel("<h2>Input Data</h2>",0,0,1,4).setFontItalic(!0).setNoWrap(),1);function r(e,t,i){t=a.grid.setLabel(t,e,0,1,1).setTooltip(i).setFontItalic(!0).setFontBold(!0).setNoWrap();return a.grid.setVerticalAlignment(e,0,"middle"),t}function n(e,t,i,o,n){var t=r(e,t,i),s=a.grid.setSelectFile(!1,o,e,2,1,1),i=(s.hide(),a.grid.addButton("Browse",image_path("open_file"),e,2,1,1)),o=n,n=(this.state==job_code.new&&(o=""),a.grid.setInputText(o,e,3,1,2).setWidth_px(300).setReadOnly(!0).setNoWrap());return a.grid.setVerticalAlignment(e,2,"middle"),a.grid.setVerticalAlignment(e,3,"middle"),i.addOnClickListener(function(){s.click()}),{label:t,fsel:s,browse:i,itext:n}}function s(){for(var e=0,t=0;t<a.seq_select.length;t++)a.seq_select[t].browse.isVisible()&&(e=t),a.seq_select[t].add.hide(),a.seq_select[t].remove.hide();e<i-1&&a.seq_select[e].itext.getValue()&&a.seq_select[e].add.show(),0<e&&a.seq_select[e].remove.show()}function l(e,t,i){var o=null;return(o=0==i?n(e,"Sequence(s)","[Desired] Provide a path to sequence file in .fasta or .pir format. For importing several sequences put them all in a single file.",".pir, .seq, .fasta",t):n(e,"Sequence #"+(i+1),"Provide a path to additinal sequence file if needed",".pir, .seq, .fasta",t)).add=a.grid.addButton("",image_path("add"),e,5,1,1).setHeight_px(14).setWidth_px(4).setTooltip("add"),o.remove=a.grid.addButton("",image_path("remove"),e,6,1,1).setHeight_px(14).setWidth_px(4).setTooltip("remove"),a.grid.setVerticalAlignment(e,5,"middle"),a.grid.setVerticalAlignment(e,6,"middle"),o.add.hide(),o.remove.hide(),0<i&&(o.label.hide(),o.browse.hide(),o.itext.hide()),o.add.addOnClickListener(function(){i<9&&(a.seq_select[i+1].label.show(),a.seq_select[i+1].browse.show(),a.seq_select[i+1].itext.show(),s())}),o.remove.addOnClickListener(function(){0<i&&(a.seq_select[i].label.hide(),a.seq_select[i].browse.hide(),a.seq_select[i].itext.hide(),s())}),o.fsel.addOnChangeListener(function(){a.customData.file_mod={rename:{},annotation:[]};var e=o.fsel.getFiles();0<e.length&&_import_checkFiles(e,a.customData.file_mod,a.upload_files,function(){o.itext.setValue(e[0].name),s()})}),o}a.grid.setLabel("&nbsp;",o,1,1,1).setNoWrap(),a.mtz_select=(e=o,c=this.files[0],(t=n(e,"Reflection data","[Mandatory] Provide a path to MTZ file with merged or unmerged reflections.",".mtz,.sca",c)).fsel.addOnChangeListener(function(){var e=t.fsel.getFiles();0<e.length&&t.itext.setValue(e[0].name)}),t),a.grid.setLabel("&nbsp;",o++,4,1,1).setNoWrap(),a.seq_select=[];for(var c,d,h=0;h<i;h++)a.seq_select.push(l(o++,this.files[1],h));a.coor_select=(e=o++,c=this.files[2],(d=n(e,"Structure homologue","[Optional] Provide a path to a PDB or mmCIF file with known (and close) structural homologue, or an apo structure.",".pdb, .ent, .mmcif, .pdbx, .cif",c)).fsel.addOnChangeListener(function(){var e=d.fsel.getFiles();0<e.length&&d.itext.setValue(e[0].name)}),d);var u=o;function p(){for(var e=-1,t=0;t<a.ligands.length;t++)"none"!=a.ligands[t].selection.getValue()&&(e=t);for(var i=!1,o=!1,t=0;t<a.ligands.length;t++){var n=t<=e+1,s=a.ligands[t].selection.getValue();a.ligands[t].label.setVisible(n),a.ligands[t].selection.setVisible(n),a.ligands[t].smiles.setVisible(n&&"smiles"==s),a.ligands[t].code.setVisible(n&&"none"!=s),"smiles"==s&&(o=!0),"none"!=s&&(i=!0)}a.code_lbl.setVisible(i),a.smiles_lbl.setVisible(o)}a.grid.setLabel("",o++,0,1,1).setHeight_px(8),a.grid.setLabel("&nbsp;",o++,0,1,1).setHeight_px(8),a.code_lbl=a.grid.setLabel("<b><i>Code</i></b>",o,3,1,1).setTooltip('3-letter code to identify the ligand. If no SMILES string is given, the code must match one from RCSB Compound dictionary. However, if SMILES string is provided, the code must not match any of known ligands, e.g., "DRG".'),a.smiles_lbl=a.grid.setLabel("<b><i>SMILES String</i></b>",o++,4,1,1).setTooltip("SMILES string describing ligands structure."),a.ligands=[];for(h=0;h<this.ligands.length;h++){var m=r(o,"Ligand #"+(h+1),"[Optional] Provide description of ligand to fit in electron density, using either a SMILES string or 3-letter code. Up to "+this.ligands.length+" ligands may be specified."),f=new Dropdown,g=(f.setWidth("120px"),a.grid.setWidget(f,o,2,1,1),f.addItem("None","","none","none"==this.ligands[h].source),f.addItem("SMILES","","smiles","smiles"==this.ligands[h].source),f.addItem("Code","","code","code"==this.ligands[h].source),f.make(),a.grid.setInputText(this.ligands[h].code,o,3,1,1).setWidth_px(50).setNoWrap().setMaxInputLength(3).setVisible("code"==this.ligands[h].source)),_=a.grid.setInputText(this.ligands[h].smiles,o,4,1,1).setWidth_px(600).setNoWrap().setVisible("smiles"==this.ligands[h].source);a.grid.setVerticalAlignment(o,2,"middle"),a.grid.setVerticalAlignment(o,3,"middle"),a.grid.setVerticalAlignment(o,4,"middle"),a.ligands.push({label:m,selection:f,smiles:_,code:g}),f.sno=h,f.addOnChangeListener(function(e,t){a.ligands[this.sno].code.setVisible("none"!=t),a.ligands[this.sno].smiles.setVisible("smiles"==t),p()}),o++}p(),this.layParameters(a.grid,a.grid.getNRows()+1,0);for(var b=a.grid.getNCols(),h=1;h<b;h++)a.grid.setLabel(" ",u,h,1,1).setHeight_px(8),a.grid.setCellSize("auto","",u,h);return a.grid.setLabel(" ",u,b,1,1).setHeight_px(8),a.grid.setCellSize("95%","",u,b),a},TaskCCP4go2.prototype._collectInput=function(e){for(var t="",i=e.mtz_select.fsel.getFiles(),o=0;o<this.ligands.length;o++)this.ligands[o].source=e.ligands[o].selection.getValue(),this.ligands[o].smiles=e.ligands[o].smiles.getValue(),this.ligands[o].code=e.ligands[o].code.getValue(),"none"!=this.ligands[o].source&&(this.ligands[o].code||(t+="<b><i>Code for ligand #"+(o+1)+" is not given</i></b>"),"smiles"!=this.ligands[o].source||this.ligands[o].smiles||(t+="<b><i>SMILES string for ligand #"+(o+1)+" is not given</i></b>"));for(var n=!0,o=0;o<this.ligands.length&&n;o++)if("none"!=this.ligands[o].source&&this.ligands[o].code)for(var s=o+1;s<this.ligands.length&&n;s++)"none"!=this.ligands[s].source&&this.ligands[o].code==this.ligands[s].code&&(n=!1,t+="<b><i>Repeat use of ligand code "+this.ligands[o].code+"</i></b>");return i.length<1&&(t+="<b><i>Reflection data is not specified</i></b>"),TaskTemplate.prototype.collectInput.call(this,e),t},TaskCCP4go2.prototype._doRun=function(e,t){var i=[e.mtz_select.fsel.getFiles()],o=e.seq_select[0].fsel.getFiles(),n=e.coor_select.fsel.getFiles();this.files=["","",""],0<i.length&&(this.files[0]=i[0][0].name),0<o.length&&(i.push(o),this.files[1]=o[0].name),0<n.length&&(i.push(n),this.files[2]=n[0].name),i[0].length<0?new MessageBox("Stop run","Task cannot be run as no reflection<br>data are given"):new UploadDialog("Upload data",i,e.customData,!0,function(e){e?new MessageBox("Stop run","Task cannot be run due to upload errors:<p><b><i>"+e+"</i></b>"):t()})},TaskCCP4go2.prototype.customDataClone=function(e,t){this.ligands=[];for(var i=0;i<t.ligands.length;i++)this.ligands.push({source:t.ligands[i].source,smiles:t.ligands[i].smiles,code:t.ligands[i].code})});var __template=null;function TaskCCP4ez(){(__template?__template.TaskCCP4go:TaskCCP4go).call(this),this._type="TaskCCP4go",this.name="ccp4go",this.setOName("ccp4go"),this.title='CCP4go "Don\'t make me think!" (experimental)'}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.ccp4go")),TaskCCP4ez.prototype=__template?Object.create(__template.TaskCCP4go.prototype):Object.create(TaskCCP4go.prototype),TaskCCP4ez.prototype.constructor=TaskCCP4ez,__template&&(module.exports.TaskCCP4ez=TaskCCP4ez);var __template=null,fs,path,conf,utils,uh,fcl;function TaskCloudImport(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskCloudImport",this.name="import from cloud storage",this.oname="*",this.title="Import from Cloud Storage",this.currentCloudPath="",this.file_mod={rename:{},annotation:[]},this.fasttrack=!0,this.selected_items=[],this.file_mod={rename:{},annotation:[]},this.input_dtypes=[{data_type:{DataRevision:[]},label:"",inputId:"void1",version:0,force:1e8,min:0,max:1e8}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCloudImport.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCloudImport.prototype.constructor=TaskCloudImport,TaskCloudImport.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskCloudImport.prototype.checkKeywords=function(e){return this.__check_keywords(e,["cloudimport","import","files","data","storage"])},__template?(fs=require("fs-extra"),path=require("path"),conf=require("../../js-server/server.configuration"),utils=require("../../js-server/server.utils"),uh=require("../../js-server/server.fe.upload_handler"),fcl=require("../../js-server/server.fe.facilities"),TaskCloudImport.prototype.icon=function(){return this.state==__template.job_code.remdoc?"task_remdoc":"task_cimport"},TaskCloudImport.prototype.makeInputData=function(e,t){for(var i=path.join(t,uh.uploadDir()),o=(utils.writeObject(path.join(t,"annotation.json"),this.file_mod)||console.log(' ***** cannot write "annotation.json" in '+i),utils.fileExists(i)||utils.mkDir(i)||console.log(" ***** cannot create directory "+i),fcl.getUserCloudMounts(e)),n=0;n<this.selected_items.length;n++){var s=this.selected_items[n].name.split("/");if(2<s.length&&"cloudstorage::"==s[0]){for(var a=null,r=0;r<o.length&&!a;r++)o[r][0]==s[1]&&(a=path.join(o[r][1],s.slice(2).join("/")));if(a){var l=path.join(i,s[s.length-1]);try{fs.copySync(a,l)}catch(e){console.log(" ***** cannot copy file "+a+"\n                   to "+l),console.log("       error: "+e)}}else console.log(" ***** path "+this.selected_items[n].name+" not found")}}for(n=0;n<this.file_mod.annotation.length;n++){utils.removeFile(path.join(i,this.file_mod.annotation[n].file));for(r=0;r<this.file_mod.annotation[n].items.length;r++){var c=this.file_mod.annotation[n].items[r].rename;utils.writeString(path.join(i,c),this.file_mod.annotation[n].items[r].contents)}}__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskCloudImport.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.import_task",e,t,this.id]},module.exports.TaskCloudImport=TaskCloudImport):(TaskCloudImport.prototype.icon=function(){return this.state==job_code.remdoc?"task_remdoc":"task_cimport"},TaskCloudImport.prototype.desc_title=function(){return"browse "+appName()+" storage and import various files from it"},TaskCloudImport.prototype.customDataClone=function(e,t){this.uname="",this.currentCloudPath=t.currentCloudPath,this.selected_items=[],this.file_mod={rename:{},annotation:[]}},TaskCloudImport.prototype.onJobDialogStart=function(e){},TaskCloudImport.prototype.onJobDialogClose=function(e,t){0<this.selected_items.length&&this.state==job_code.new?new QuestionBox("Import not finished","<h3>Import not finished</h3>You have selected data files, however the import<br>is not finished yet: the files need to be processed<br>before they can be used in subsequent tasks.",[{name:"Finish now",onclick:function(){t(!1),e.run_btn.click()}},{name:"Finish later",onclick:function(){t(!0)}}],"msg_question"):t(!0)},TaskCloudImport.prototype.makeInputPanel=function(e){var t=this.makeInputLayout(),e=(this.setInputDataFields(t.grid,0,e,this),this.state==job_code.new||this.state==job_code.running?t.header.setLabel("<hr/>Use the file selection button below to select and transfer facility data to the Project (use multiple file selections and repeat uploads if necessary). When done, hit <b><i>Import</i></b> button to process files transferred.<hr/>",3,0,1,4).setFontSize("80%"):t.header.uname_inp.setValue(this.uname.replace(/<(?:.|\n)*?>/gm,"")),t.grid.getNRows()),i=(t.grid.setWidth("100%"),t.select_btn=t.grid.setButton("Select file(s)",image_path("open_file"),e,0,1,1).setNoWrap(),t.grid.setHorizontalAlignment(e,0,"center"),t.fileListTitle=t.grid.setLabel("<b><i>Selected data</i></b>",e+1,0,1,1),t.fileListPanel=t.grid.setLabel("",e+2,0,1,1),this.setSelectedCloudFiles(t,[],null),0<this.selected_items.length&&t.select_btn.setText("Select more files"),this);return t.select_btn.addOnClickListener(function(){new CloudFileBrowser(t,i,4,[],function(e){return i.setSelectedCloudFiles(t,e,function(e){0<e.length&&(t.select_btn.setText("Upload more files"),new QuestionBox("Files selected","<h3>Files selected:</h3><ul><li>"+e.join("</li><li>")+"</li></ul?",[{name:"Select more files",onclick:function(){t.select_btn.click()}},{name:"Finish import",onclick:function(){t.job_dialog.run_btn.click()}},{name:"Close"}],"msg_question"))}),1},null)}),t},TaskCloudImport.prototype._display_selected_files=function(e){if("fileListPanel"in e&&(e.fileListTitle.setVisible(0<this.selected_items.length),0<this.selected_items.length)){for(var t="",i=0;i<this.selected_items.length;i++)0<i&&(t+="<br>"),t+=this.selected_items[i].name;e.fileListPanel.setText(t).show()}},TaskCloudImport.prototype.setSelectedCloudFiles=function(n,e,s){if(e.length<=0)this._display_selected_files(n);else{for(var t,a=[],i="",o=0;o<e.length;o++)"FacilityDir"!=e[o]._type&&(endsWith(t=e[o].name.toLowerCase(),".ccp4_demo")||endsWith(t,".ccp4cloud")||endsWith(t,".zip")?i+="<li><b>"+e[o].name+"</b></li>":a.push(e[o]));0<i.length&&new MessageBox("File(s) not importable","Archive file(s) <ul>"+i+"</ul> cannot be imported as data files and will be ignored.<p>If you are trying to import "+appName()+" projects, do this from<br><i>Project List</i> page.");var r=this;if(0<a.length){for(var l=[],c=0;c<r.selected_items.length;c++)l.push(r.selected_items[c].name);_import_checkFiles(a,r.file_mod,l,function(){for(var e=[],t=0;t<a.length;t++){startsWith(a[t].name,"cloudstorage::/")||(a[t].name="cloudstorage::/"+r.currentCloudPath+"/"+a[t].name);for(var i=!1,o=0;o<r.selected_items.length&&!i;o++)i=r.selected_items[o].name==a[t].name;i||(r.selected_items.push(a[t]),e.push(a[t].name))}r._display_selected_files(n),s&&s(e)})}else r._display_selected_files(n)}},TaskCloudImport.prototype.collectInput=function(e){return TaskTemplate.prototype.collectInput.call(this,e),0<this.selected_items.length?"":"No file(s) have been uploaded"},TaskCloudImport.prototype.runButtonName=function(){return"Import"});var __template=null,conf;function TaskCombStructure(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskCombStructure",this.name="comb structure",this.setOName("combstruct"),this.title="Comb Structure with Coot/Refmac",this.input_dtypes=[{data_type:{DataRevision:["!xyz","!phases","!protein"]},label:"Structure revision",inputId:"revision",version:1,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Comb selections",open:!0,position:[0,0,1,5],contains:{COMB1_SEL:{type:"combobox",keyword:"none",label:"1<sup>st</sup> comb:",tooltip:"Choose 1st comb action",range:["FR|Fill partial residues","FP|Fit protein","SR|Stepped refine","RR|Ramachandran Plot improve"],value:"FR",iwidth:270,position:[0,0,1,1]},COMB1_NPASS:{type:"integer",keyword:"none",label:"make",tooltip:"Number of 1st comb passes",range:[1,"*"],value:"3",iwidth:50,position:[0,4,1,1],hideon:{COMB1_SEL:["FR"]}},COMB1FR_NPASS:{type:"integer",keyword:"none",label:"make",tooltip:"Number of 1st comb passes",range:[1,1],value:"1",readonly:!0,iwidth:50,position:[0,4,1,1],showon:{COMB1_SEL:["FR"]}},COMB1_NCYC:{type:"integer",keyword:"none",label:"pass(es), each with",tooltip:"Number of refinement cycles for 1st comb",range:[0,"*"],value:"10",iwidth:50,label2:"cycles of refinement",position:[0,8,1,1]},COMB2_SEL:{type:"combobox",keyword:"none",label:"2<sup>nd</sup> comb:",tooltip:"Choose 2nd comb action",range:["FR|Fill partial residues","FP|Fit protein","SR|Stepped refine","RR|Ramachandran Plot improve","N|None"],value:"FP",iwidth:270,position:[1,0,1,1]},COMB2_NPASS:{type:"integer",keyword:"none",label:"make",tooltip:"Number of 2nd comb passes",range:[0,"*"],value:"3",iwidth:50,position:[1,4,1,1],hideon:{COMB2_SEL:["N","FR"]}},COMB2FR_NPASS:{type:"integer",keyword:"none",label:"make",tooltip:"Number of 1st comb passes",range:[1,1],value:"1",readonly:!0,iwidth:50,position:[1,4,1,1],showon:{COMB2_SEL:["FR"]}},COMB2_NCYC:{type:"integer",keyword:"none",label:"pass(es), each with",tooltip:"Number of refinement cycles for 2nd comb",range:[0,"*"],value:"10",iwidth:50,label2:"cycles of refinement",position:[1,8,1,1],hideon:{COMB2_SEL:["N"]}},COMB3_SEL:{type:"combobox",keyword:"none",label:"3<sup>rd</sup> comb:",tooltip:"Choose 3rd comb action",range:["FR|Fill partial residues","FP|Fit protein","SR|Stepped refine","RR|Ramachandran Plot improve","N|None"],value:"SR",iwidth:270,position:[2,0,1,1],hideon:{COMB2_SEL:["N"]}},COMB3_NPASS:{type:"integer",keyword:"none",label:"make",tooltip:"Number of 3rd comb passes",range:[0,"*"],value:"3",iwidth:50,position:[2,4,1,1],hideon:{_:"||",COMB2_SEL:["N"],COMB3_SEL:["N","FR"]}},COMB3FR_NPASS:{type:"integer",keyword:"none",label:"make",tooltip:"Number of 1st comb passes",range:[1,1],value:"1",readonly:!0,iwidth:50,position:[2,4,1,1],showon:{COMB3_SEL:["FR"]},hideon:{_:"||",COMB2_SEL:["N"]}},COMB3_NCYC:{type:"integer",keyword:"none",label:"pass(es), each with",tooltip:"Number of refinement cycles for 3rd comb",range:[0,"*"],value:"10",iwidth:50,label2:"cycles of refinement",position:[2,8,1,1],hideon:{_:"||",COMB2_SEL:["N"],COMB3_SEL:["N"]}},COMB4_SEL:{type:"combobox",keyword:"none",label:"4<sup>th</sup> comb:",tooltip:"Choose 4th comb action",range:["FR|Fill partial residues","FP|Fit protein","SR|Stepped refine","RR|Ramachandran Plot improve","N|None"],value:"RR",iwidth:270,position:[3,0,1,1],hideon:{_:"||",COMB2_SEL:["N"],COMB3_SEL:["N"]}},COMB4_NPASS:{type:"integer",keyword:"none",label:"make",tooltip:"Number of 4th comb passes",range:[0,"*"],value:"3",iwidth:50,position:[3,4,1,1],hideon:{_:"||",COMB2_SEL:["N"],COMB3_SEL:["N"],COMB4_SEL:["N","FR"]}},COMB4FR_NPASS:{type:"integer",keyword:"none",label:"make",tooltip:"Number of 1st comb passes",range:[1,1],value:"1",readonly:!0,iwidth:50,position:[3,4,1,1],showon:{COMB4_SEL:["FR"]},hideon:{_:"||",COMB2_SEL:["N"],COMB3_SEL:["N"]}},COMB4_NCYC:{type:"integer",keyword:"none",label:"pass(es), each with",tooltip:"Number of refinement cycles for 4th comb",range:[0,"*"],value:"10",iwidth:50,label2:"cycles of refinement",position:[3,8,1,1],hideon:{_:"||",COMB2_SEL:["N"],COMB3_SEL:["N"],COMB4_SEL:["N"]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCombStructure.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCombStructure.prototype.constructor=TaskCombStructure,TaskCombStructure.prototype.icon=function(){return"task_combstructure"},TaskCombStructure.prototype.desc_title=function(){return"provides an access to the model building COOT tools with the following cycles of refinement with Refmac"},TaskCombStructure.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskCombStructure.prototype.checkKeywords=function(e){return this.__check_keywords(e,["comb","refinement","coot","refmac","fit"])},__template&&(conf=require("../../js-server/server.configuration"),TaskCombStructure.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskCombStructure.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.combstructure",e,t,this.id]},module.exports.TaskCombStructure=TaskCombStructure);var __template=null,conf;function TaskContact(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskContact",this.name="contact",this.oname="*",this.title="Contact",this.input_dtypes=[{data_type:{DataRevision:["xyz"],DataEnsemble:[],DataModel:[],DataXYZ:[]},label:"Structure",inputId:"ixyz",min:1,max:1}],this.parameters={CONTACT_LBL:{type:"label",keyword:"none",lwidth:800,label:'&nbsp;<br><div style="font-size:14px;">Set CONTACT keywords and values in the input field below (consult <a href="https://www.ccp4.ac.uk/html/contact.html" target="_blank"><i>CONTACT reference</i></a> for more details).<sub>&nbsp;</sub></div>',position:[0,0,1,5]},CONTACT_INPUT:{type:"aceditor_",keyword:"none",tooltip:"",iwidth:800,iheight:320,placeholder:"# For example:\nmode    ALL\nlimits  0.0  1.9\nSOURCE  336\nTARGET  336\n",value:"",position:[1,0,1,5]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskContact.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskContact.prototype.constructor=TaskContact,TaskContact.prototype.icon=function(){return"task_contact"},TaskContact.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskContact.prototype.checkKeywords=function(e){return this.__check_keywords(e,["xyz","analysis","coordinates","toolbox","contact"])},__template?(conf=require("../../js-server/server.configuration"),TaskContact.prototype.makeInputData=function(e,t){var i=this.input_data.data.ixyz[0];"DataRevision"==i._type&&(this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskContact.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.contact",e,t,this.id]},module.exports.TaskContact=TaskContact):TaskContact.prototype.desc_title=function(){return"computes various types of contacts in protein structures"};var __template=null,conf;function TaskCootCE(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskCootCE",this.name="coot (edit coordinates)",this.setOName("coot-ce"),this.title="Edit Coordinates with Coot",this.nc_type="client",this.input_dtypes=[{data_type:{DataStructure:["xyz"],DataXYZ:[],DataEnsemble:[],DataModel:[]},label:"Structure to edit",inputId:"ixyz",cast:"xyz",version:0,min:1,max:20}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCootCE.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCootCE.prototype.constructor=TaskCootCE,TaskCootCE.prototype.icon=function(){return"task_cootce"},TaskCootCE.prototype.desc_title=function(){return"use for editing structure models without electron density (e.g., MR models)"},TaskCootCE.prototype.taskDescription=function(){return"Edit structure models without electron density"},TaskCootCE.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},TaskCootCE.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskCootCE.prototype.checkKeywords=function(e){return this.__check_keywords(e,["coot","model","building","manual-mb","mb","coordinate","editor"])},__template&&(conf=require("../../js-server/server.configuration"),TaskCootCE.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.coot_ce",e,t,this.id]},module.exports.TaskCootCE=TaskCootCE);var __template=null,path,conf,prj,utils;function TaskCootMB(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskCootMB",this.name="coot (model building)",this.setOName("coot-mb"),this.title="Model Building with Coot",this.nc_type="client",this.input_dtypes=[{data_type:{DataRevision:["!phases"]},label:"Structure revision",inputId:"revision",customInput:"coot-mb",version:4,min:1,max:1},{data_type:{DataStructure:[],DataEnsemble:[],DataModel:[],DataXYZ:[]},label:"Additional structures",inputId:"aux_struct",version:0,min:0,max:20},{data_type:{DataLigand:[]},label:"Ligand data",inputId:"ligand",min:0,max:1},{data_type:{DataLigand:[]},label:"",inputId:"void1",version:0,force:1e3,min:0,max:1e3}]}function CootMBHotButton(){return{task:"TaskCootMB",tooltip:"Launch Coot for model building"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCootMB.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCootMB.prototype.constructor=TaskCootMB,TaskCootMB.prototype.icon=function(){return"task_cootmb"},TaskCootMB.prototype.desc_title=function(){return"fit atoms and new ligands in electron density, validate and explore"},TaskCootMB.prototype.taskDescription=function(){return"Fit atoms and new ligands in electron density, validate and explore"},TaskCootMB.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},TaskCootMB.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskCootMB.prototype.checkKeywords=function(e){return this.__check_keywords(e,["coot","model","building","manual-mb","mb","coordinate","editor"])},__template?(path=require("path"),conf=require("../../js-server/server.configuration"),prj=require("../../js-server/server.fe.projects"),utils=require("../../js-server/server.utils"),TaskCootMB.prototype.makeInputData=function(e,t){var i,o=null,n=null;if("revision"in this.input_data.data&&(n="substructure"==(i=this.input_data.data.revision[0]).Options.leading_structure?(o=i.Substructure,i.Structure):(o=i.Structure,i.Substructure),this.input_data.data.istruct=[o],n&&"load_all"in i.Options&&i.Options.load_all&&(this.input_data.data.istruct2=[n])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t),o&&"coot_meta"in o&&o.coot_meta)for(var s=o.coot_meta,a=prj.getSiblingJobDirPath(t,s.jobId),r=0;r<s.files.length;r++)utils.copyFile(path.join(a,s.files[r]),path.join(t,s.files[r]))},TaskCootMB.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.coot_mb",e,t,this.id,"expire="+conf.getClientNCConfig().zombieLifeTime]},module.exports.TaskCootMB=TaskCootMB):TaskCootMB.prototype.hotButtons=function(){return[RefmacHotButton()]};var __template=null,path,conf,prj,utils;function TaskCootUtils(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskCootUtils",this.name="coot utilities",this.setOName("coot-ut"),this.title="Coot Model Building Utilities",this.input_dtypes=[{data_type:{DataRevision:["!phases"]},label:"Structure revision",inputId:"revision",customInput:"coot-mb",version:4,min:1,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCootUtils.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCootUtils.prototype.constructor=TaskCootUtils,TaskCootUtils.prototype.icon=function(){return"task_cootut"},TaskCootUtils.prototype.desc_title=function(){return"fit atoms and new ligands in electron density, validate and explore"},TaskCootUtils.prototype.taskDescription=function(){return"Fit atoms and new ligands in electron density, validate and explore"},TaskCootUtils.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},TaskCootUtils.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskCootUtils.prototype.checkKeywords=function(e){return this.__check_keywords(e,["coot","model","building","manual-mb","mb","coordinate","editor","utilities"])},__template?(path=require("path"),conf=require("../../js-server/server.configuration"),prj=require("../../js-server/server.fe.projects"),utils=require("../../js-server/server.utils"),TaskCootUtils.prototype.makeInputData=function(e,t){var i,o=null,n=null;if("revision"in this.input_data.data&&(n="substructure"==(i=this.input_data.data.revision[0]).Options.leading_structure?(o=i.Substructure,i.Structure):(o=i.Structure,i.Substructure),this.input_data.data.istruct=[o],n&&"load_all"in i.Options&&i.Options.load_all&&(this.input_data.data.istruct2=[n])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t),o&&"coot_meta"in o&&o.coot_meta)for(var s=o.coot_meta,a=prj.getSiblingJobDirPath(t,s.jobId),r=0;r<s.files.length;r++)utils.copyFile(path.join(a,s.files[r]),path.join(t,s.files[r]))},TaskCootUtils.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.coot_mb",e,t,this.id,"expire="+conf.getClientNCConfig().zombieLifeTime]},module.exports.TaskCootUtils=TaskCootUtils):TaskCootUtils.prototype.hotButtons=function(){return[RefmacHotButton()]};var __template=null;function TaskCoot(){(__template?__template.TaskCootMB:TaskCootMB).call(this),this._type="TaskCoot"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.cootmb")),TaskCoot.prototype=__template?Object.create(__template.TaskCootMB.prototype):Object.create(TaskCootMB.prototype),TaskCoot.prototype.constructor=TaskCoot,TaskCoot.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},__template&&(module.exports.TaskCoot=TaskCoot);var __template=null,conf;function TaskChangeReso(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskChangeReso",this.name="change dataset resolution",this.setOName("ChangeRes"),this.title="Change Dataset Resolution",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataHKL:[]},label:"Reflection data",inputId:"idata",customInput:"changereso",version:0,min:1,max:1},{data_type:{DataRevision:[]},label:"Structure revision",inputId:"revision",version:0,min:0,max:0}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskChangeReso.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskChangeReso.prototype.constructor=TaskChangeReso,TaskChangeReso.prototype.icon=function(){return"task_changereso"},TaskChangeReso.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskChangeReso.prototype.checkKeywords=function(e){return this.__check_keywords(e,["change","resolution"])},__template?(conf=require("../../js-server/server.configuration"),TaskChangeReso.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.changereso",e,t,this.id]},module.exports.TaskChangeReso=TaskChangeReso):(TaskChangeReso.prototype.desc_title=function(){return"allows defining the resolution range of the dataset "},TaskChangeReso.prototype.addDataDialogHints=function(e,t){return t.hints.push('Why <i>"Structure Revision"</i> is not allowed? This means that the task can be used only before a <i>"Structure Revision"</i> is created. If you are past this point in your Project, you may have to start, with this task, a new branch in your Project after data import or data processing.'),t});var __template=null,conf;function TaskChangeSpG(){__template?(__template.TaskTemplate.call(this),this.state=__template.job_code.retired):(TaskTemplate.call(this),this.state=job_code.retired),this._type="TaskChangeSpG",this.name="change space group",this.setOName("SpG"),this.title="Change Space Group",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataRevision:["~xyz","~substructure","~phases"],DataHKL:[]},label:"ASU definition or<br>Reflection Data",inputId:"idata",customInput:"reindex",version:0,min:1,max:1}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskChangeSpG.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskChangeSpG.prototype.constructor=TaskChangeSpG,TaskChangeSpG.prototype.icon=function(){return"task_changespg"},TaskChangeSpG.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskChangeSpG.prototype.makeInputData=function(e,t){"idata"in this.input_data.data&&"DataRevision"==this.input_data.data.idata[0]._type&&(this.input_data.data.hkl=[this.input_data.data.idata[0].HKL]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskChangeSpG.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.changespg",e,t,this.id]},module.exports.TaskChangeSpG=TaskChangeSpG):(TaskChangeSpG.prototype.desc_title=function(){return"allows changing the merged reflection dataset space group with the same point group"},TaskChangeSpG.prototype.inputChanged=function(e,t,i){function o(e,t){return e.split(" (")[0]+" ("+t+")"}var n,s;"idata"==t&&this.state==job_code.new&&(n=e.grid.inpDataRef,n=(n=this.getInputItem(n,"idata").dropdown[0]).dt[n.getValue()],s=this.name,"DataHKL"==n._type?(this.title=o(this.title,"HKL"),this.name=o(this.name,"HKL")):(this.title=o(this.title,"ASU"),this.name=o(this.name,"ASU")),this.name!=s&&((n=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),s=this.name.replace(/<(?:.|\n)*?>/gm,""),n.header.uname_inp.setStyle("text","",s),n.job_dialog.changeTitle(s),this.updateInputPanel(n),n.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node))),TaskTemplate.prototype.inputChanged.call(this,e,t,i)},TaskChangeSpG.prototype.updateInputPanel=function(e){var t;this.state==job_code.new&&(t=new CustomEvent(cofe_signals.jobDlgSignal,{detail:job_dialog_reason.rename_node}),e.element.dispatchEvent(t))});var __template=null,conf;function TaskChangeSpGASU(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskChangeSpGASU",this.name="change asu space group",this.setOName("SpG"),this.title="Change ASU Space Group",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataRevision:["~xyz","~substructure","~phases"]},label:"ASU definition",inputId:"idata",customInput:"reindex",version:0,min:1,max:1}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskChangeSpGASU.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskChangeSpGASU.prototype.constructor=TaskChangeSpGASU,TaskChangeSpGASU.prototype.icon=function(){return"task_changespgasu"},TaskChangeSpGASU.prototype.desc_title=function(){return"reindex reflection dataset in Structure Revision"},TaskChangeSpGASU.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskChangeSpGASU.prototype.checkKeywords=function(e){return this.__check_keywords(e,["change","space","group","asu"])},__template?(conf=require("../../js-server/server.configuration"),TaskChangeSpGASU.prototype.makeInputData=function(e,t){this.input_data.data.hkl=[this.input_data.data.idata[0].HKL],__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskChangeSpGASU.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.changespg",e,t,this.id]},module.exports.TaskChangeSpGASU=TaskChangeSpGASU):(TaskChangeSpGASU.prototype.desc_title=function(){return"changes ASU Space Group"},TaskChangeSpGASU.prototype.addDataDialogHints=function(e,t){return t.hints.push('This task can be run only right after the definition of ASU, before any phasing or substructure search are performed -- you may need to branch your Project accordingly. Use <i>"Change Dataset Space Group"</i> task in order to change space group of a reflection dataset'),t});var __template=null,conf;function TaskChangeSpGHKL(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskChangeSpGHKL",this.name="change dataset space group",this.setOName("SpG"),this.title="Change Dataset Space Group",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataHKL:[]},label:"Reflection Data",inputId:"idata",customInput:"reindex",version:0,min:1,max:1},{data_type:{DataRevision:[]},label:"Structure revision",inputId:"revision",version:0,min:0,max:0}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskChangeSpGHKL.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskChangeSpGHKL.prototype.constructor=TaskChangeSpGHKL,TaskChangeSpGHKL.prototype.icon=function(){return"task_changespghkl"},TaskChangeSpGHKL.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskChangeSpGHKL.prototype.checkKeywords=function(e){return this.__check_keywords(e,["change","space","group","hkl"])},__template?(conf=require("../../js-server/server.configuration"),TaskChangeSpGHKL.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.changespg",e,t,this.id]},module.exports.TaskChangeSpGHKL=TaskChangeSpGHKL):(TaskChangeSpGHKL.prototype.desc_title=function(){return"allows changing the merged reflection dataset space group with the same point group"},TaskChangeSpGHKL.prototype.addDataDialogHints=function(e,t){return t.hints.push('Why <i>"Structure Revision"</i> is not allowed? This means that the task can be used only before a <i>"Structure Revision"</i> is created. If you are past this point in your Project, you may have to start, with this task, a new branch in your Project after data import or data processing.'),t.hints.push('Is it possible to change Space Group in <i>"Structure Revision"</i>? The answer is "in general, no", because such change would be incompatible with results of pre-existing phasing and refinement. However, one can change between alternative space groups in an empty ASU, before any phasing is done, with <i>"Change ASU Space Group"</i> task. This may require starting a new branch in your Project.'),t});var __template=null,conf;function TaskCrank2(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskCrank2",this.name="EP with Crank2",this.setOName("crank2"),this.title="Crank-2 Automated Experimental Phasing",this.input_dtypes=[{data_type:{DataRevision:["!protein","!anomalous","!asu"]},label:"Structure revision",inputId:"revision",customInput:"crank2",version:7,min:1,max:1},{data_type:{DataHKL:["anomalous"]},label:"Anomalous reflection<br>data (MAD)",inputId:"hkl",customInput:"anomData",tooltip:"Only anomalous reflection datasets from all imported may be chosen here. Note that neither of reflection datasets may coincide with the native dataset, if one is specified above.",min:0,max:3,force:0},{data_type:{DataHKL:[]},desc:"native dataset",label:"Native dataset",inputId:"native",customInput:"native",tooltip:"Native dataset is optional and may be chosen from both non-anomalous (typical case) and anomalous diffraction datasets. Native dataset must not coincide with any of the reflection datasets chosen above.",min:0,max:1,force:0}],this.parameters={sec1:{type:"section",title:"Main Parameters",open:!0,position:[0,0,1,5],value:"crank2",contains:{NATOMS:{type:"integer_",keyword:"exp_num_atoms=",label:"No. of substructure atoms in a.s.u.",tooltip:"Optional number of substructure atoms in asymmetric unit. Leave blank for automatic choice.",lwidth:230,iwidth:80,range:[1,"*"],value:"",position:[0,0,1,1]},SOLVENT_CONTENT:{type:"real_",keyword:"solvent_content=",label:"Efective solvent content",tooltip:"Solvent content to be used in calculations (must be between 0.01 and 0.99). If left blank, solvent fraction from asymmetric unit definition will be used.",iwidth:80,range:[.01,.99],value:"",default:"auto",position:[1,0,1,1],hideon:{sec1:["shelx-substr"]}}}},sec2:{type:"section",title:"Advanced options for substructure detection",open:!1,showon:{_:"||","revision.subtype:xyz":[0,-1],sec1:["shelx-substr"]},position:[1,0,1,5],contains:{SUBSTRDET_NUM_TRIALS:{type:"integer_",keyword:"num_trials::",label:"Number of trials",tooltip:"The number of substructure determination trials performed if the specified CFOM or CC threshold is not reached.",range:[1,"*"],value:"",position:[0,0,1,1]},SUBSTRDET_HIGH_RES_CUTOFF_SHELXD:{type:"real_",keyword:"high_res_cutoff::",label:"High resolution cutoff [&Aring]",tooltip:"The high resolution cutoff for substructure determination.",range:[.01,"*"],value:"",position:[1,0,1,1],showon:{_:"||",sec1:["shelx-substr"],SUBSTRDET_PROGRAM:["shelxd"]}},SUBSTRDET_HIGH_RES_CUTOFF:{type:"real_",keyword:"high_res_cutoff::",label:"Initial high resolution cutoff [&Aring]",tooltip:"The initially tested high resolution cutoff for substructure determination.",range:[.01,"*"],value:"",position:[1,0,1,1],hideon:{_:"||",sec1:["shelx-substr"],SUBSTRDET_PROGRAM:["shelxd"]}},SUBSTRDET_NUM_ATOMS:{type:"integer_",keyword:"num_atoms::",label:"Number of searched peaks in the ASU",tooltip:"The number of searched peaks typically corresponds to the expected number of substructure atoms in the asymmetric unit. A value of 0 for program PRASA specifies that this restraint will not be used in substructure detection",range:[0,"*"],value:"",position:[2,0,1,1]},SUBSTRDET_PROGRAM:{type:"combobox",keyword:"SUBSTRDET_PROGRAM",label:"Substructure determination program",tooltip:"The program that will be used for substructure determination",range:["_blank_|Auto","shelxd|ShelXD","prasa|Prasa"],value:"_blank_",position:[3,0,1,1],showon:{sec1:["crank2"]}},FAEST_PROGRAM:{type:"combobox",keyword:"FAEST_PROGRAM",label:"FA values estimation program",tooltip:"The program that will be used for estimation of FA respective E values, inputted to substructure determination program",range:["_blank_|Auto","afro|Afro","shelxc|ShelXC","ecalc|ECalc"],value:"_blank_",position:[4,0,1,1],showon:{sec1:["crank2"]},hideon:{SUBSTRDET_PROGRAM:["shelxd"]}},SUBSTRDET_THRESHOLD_STOP_SHELXD:{type:"real_",keyword:"threshold_stop::",label:"CFOM threshold for early stop",tooltip:'If the threshold is reached, the substructure detection will stop, assuming a solution was obtained that will be used for phasing. Saves time for the "easy" datasets.',range:[0,"*"],value:"",position:[5,0,1,1],showon:{_:"||",sec1:["shelx-substr"],SUBSTRDET_PROGRAM:["shelxd"]}},SUBSTRDET_THRESHOLD_STOP:{type:"real_",keyword:"threshold_stop::",label:"CC threshold for early stop",tooltip:'If the threshold is reached, the substructure detection will stop, assuming a solution was obtained that will be used for phasing. Saves time for the "easy" datasets.',range:[0,"*"],value:"",position:[5,0,1,1],hideon:{_:"||",sec1:["shelx-substr"],SUBSTRDET_PROGRAM:["shelxd"]}},SUBSTRDET_THRESHOLD_WEAK:{type:"real_",keyword:"threshold_weak::",label:"CFOM threshold",tooltip:"Use thorough building if CFOM from substructure detection is smaller than specified. The thorough building consists of more tracing cycles, search for helices and a larger search time factor. Setting the value to 1000 forces the thorough building.",range:[.001,"*"],value:"",position:[6,0,1,1],showon:{sec1:["shelx-auto"]}},SUBSTRDET_HIGH_RES_CUTOFF_RADIUS:{type:"real_",keyword:"high_res_cutoff_radius::",label:"Radius of tested cutoffs [&Aring]",tooltip:"High resolution cutoffs will be tested in this radius around the specified initial cutoff. A radius of +-0.5A - thus scanning over 1A range - is typically sufficient.",range:[.01,"*"],value:"",position:[7,0,1,1],showon:{_:"&&",SUBSTRDET_PROGRAM:["prasa"],sec1:["crank2"]}},SUBSTRDET_HIGH_RES_CUTOFF_STEP:{type:"real_",keyword:"high_res_cutoff_step::",label:"Incremental step for cutoff testing [&Aring]",tooltip:"The slicing of the cutoff testing: the lower the value, the more cutoffs will be tested in the chosen resolution cutoff range.",range:[.001,"*"],value:"",position:[8,0,1,1],showon:{_:"&&",SUBSTRDET_PROGRAM:["prasa"],sec1:["crank2"]}},SUBSTRDET_MIN_DIST_SYMM_ATOMS:{type:"combobox",keyword:"min_dist_symm_atoms::",label:"Atoms in special positions allowed",tooltip:"Select this option if (part of) the anomalous substructure atoms can be in special positions: positions related by more than one space group symmetry operator.",range:["_blank_|Auto","-0.1|Yes","3|No"],value:"_blank_",position:[9,0,1,2]},SUBSTRDET_MIN_DIST_ATOMS:{type:"real_",keyword:"min_dist_atoms::",label:"Minimal distance between atoms [&Aring]",tooltip:"The (expected) minimal distance between anomalous substructure atoms.",range:[.001,"*"],value:"",position:[10,0,1,1]}}},sec3:{type:"section",title:"Advanced options for substructure improvement",open:!1,showon:{_:"||",sec1:["crank2","shelx-substr"]},position:[2,0,1,5],contains:{REFATOMPICK_NUM_ITER:{type:"integer_",keyword:"num_iter::",label:"Number of iterations",tooltip:"Picking of new substructure atoms from anomalous maps and refinement will be iterated for the selected number of cycles. Leave blank for automatic choice.",range:[0,"*"],value:"",position:[0,0,1,1]},REFATOMPICK_REFCYC:{type:"integer_",keyword:"refcyc::",label:"Number of refinement cycles per iteration",tooltip:"Number of refinement cycles in each iteration of substructure atom picking. Leave blank for automatic choice.",range:[0,"*"],value:"",position:[1,0,1,1]},REFATOMPICK_RMS_THRESHOLD:{type:"real_",keyword:"rms_threshold::",label:"RMS threshold for addition of new atoms",tooltip:"Peaks above the specified RMS threshold in the anomalous difference map will be added to the anomalous substructure. Leave blank for automatic choice.",range:[1,"*"],value:"",position:[2,0,1,1]}}},sec4:{type:"section",title:"Advanced options for hand determination",open:!1,position:[3,0,1,5],showon:{"revision.subtype:xyz":[0,-1],sec1:["crank2"]},contains:{HANDDET_DO:{type:"checkbox",label:"Perform hand determination",tooltip:"Unselect if you wish to skip the hand determination and directly proceed with the current hand",value:!0,position:[0,0,1,1],showon:{"revision.subtype:xyz":[0,-1]}}}},sec5:{type:"section",title:"Advanced options for density modification",open:!1,position:[4,0,1,5],showon:{sec1:["crank2"]},hideon:{_:"&&","revision.subtype:xyz":[1],PARTIAL_AS_SUBSTR:[!1]},contains:{DMFULL_DM_PROGRAM:{type:"combobox",keyword:"dm",label:"Density modification program",tooltip:"The program that will be used for the real space density modification.",range:["_blank_|Auto","parrot|Parrot","solomon|Solomon"],value:"_blank_",position:[0,0,1,1],showon:{sec1:["crank2"]}},DMFULL_PHCOMB_PROGRAM:{type:"combobox",keyword:"phcomb",label:"Phase combination program",tooltip:"The program that will be used for the real space density modification.",range:["_blank_|Auto","refmac|Refmac","multicomb|MultiComb"],value:"_blank_",position:[1,0,1,1],showon:{sec1:["crank2"],hkl:[1]}},DMFULL_DMCYC:{type:"integer_",keyword:"dmcyc::",label:"Number of cycles",tooltip:"Number of density modification iterations.",range:[1,"*"],value:"",position:[2,0,1,1],showon:{sec1:["crank2"]}},DMFULL_THRESHOLD_STOP:{type:"real_",keyword:"threshold_stop::",label:"FOM threshold for early stop",tooltip:'If this figure of merit is reached, density modification will stop early, assuming a well phased map suitable for model building. Saves some time for the "easy" datasets.',range:[.001,"*"],value:"",position:[3,0,1,1],showon:{sec1:["crank2"]}}}},sec6:{type:"section",title:"Advanced options for model building",open:!1,showon:{sec1:["crank2"]},position:[5,0,1,5],contains:{COMB_PHDMMB_DO:{type:"checkbox",label:'Use the "combined" algorithm',iwidth:300,tooltip:'Unclick the option if you do not wish to use the "combined" Crank2 algorithm. For example, it may rarely happen that density modification makes the phases worse.',value:!0,position:[0,0,1,3],showon:{sec1:["crank2"]},hideon:{_:"||",native:[1],hkl:[2,3,4]}},BUILD_LEVEL:{type:"combobox",keyword:"num_parallel::",label:"Parallel model building depth",lwidth:250,tooltip:"The level of thoroughness of the model building algorithm. Higher levels may deliver better results as a trade-off for speed.",range:["1|Basic","3|Hightened","6|Advanced","10|Enforced","15|Superior"],value:"1",position:[1,0,1,1]},TITLE1:{type:"label",label:"<h3>Parameters for iterative model building</h3>",position:[2,0,1,4],showon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},MBREF_MB_PROGRAM:{type:"combobox",keyword:"mb",label:"Model building program",lwidth:250,tooltip:"The program that will be used for building of the protein model.",range:["_blank_|Auto","buccaneer|Buccaneer","arpwarp|Arp/wArp","shelxe|ShelXE"],value:"_blank_",position:[4,0,1,1],showon:{_:"&&",sec1:["crank2"],comb:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}}},MBREF_BIGCYC:{type:"integer_",keyword:"bigcyc::",label:"Number of building cycles",lwidth:250,tooltip:"Number of the model building iterations.",range:[1,"*"],value:"",position:[6,0,1,1],showon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},MBREF_EXCLUDE_FREE:{type:"combobox",keyword:"",label:"Exclude free reflections in building",tooltip:"Specify whether the free reflections should be excluded.",range:["_blank_|Auto","True|Yes","False|No"],value:"_blank_",position:[8,0,1,1],showon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},TITLE2:{type:"label",label:"<h3>Parameters for combined model building</h3>",position:[3,0,1,4],hideon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},COMB_PHDMMB_DMFULL_DM_PROGRAM:{type:"combobox",keyword:"dmfull dm",label:"Density modification program",tooltip:"The program that will be used for crystal space density modification.",range:["_blank_|Auto","parrot|Parrot","solomon|Solomon"],value:"_blank_",position:[5,0,1,1],showon:{sec1:["crank2"]},hideon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},COMB_PHDMMB_START_SHELXE:{type:"combobox",keyword:"start_shelxe::",label:"Start with a few SHELXE tracing cycles",tooltip:'If "yes" is chosen then a few initial model tracing cycles will be performed by ShelxE\'s backbone tracing algorithm, followed by the usual Buccaneer model building cycles. The "combined" algorithm will be still used throughout. This option is sometimes useful at higher resolutions.',range:["_blank_|Auto","True|Yes","False|No"],value:"_blank_",position:[7,0,1,1],showon:{sec1:["crank2"]},hideon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},COMB_PHDMMB_MINBIGCYC:{type:"integer_",keyword:"minbigcyc::",label:"Minimal number of building cycles",tooltip:'The minimal number of building cycles will be performed in case of "easy" tracing. For a more difficult tracing, more cycles will be performed, up to the specified maximal number of building cycles.',range:[1,"*"],value:"",position:[9,0,1,1],showon:{sec1:["crank2"]},hideon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},COMB_PHDMMB_MAXBIGCYC:{type:"integer_",keyword:"maxbigcyc::",label:"Maximal number of building cycles",tooltip:"The model building will stop after the specified number of building cycles, even if the model is not built yet.",range:[1,"*"],value:"",position:[11,0,1,1],showon:{sec1:["crank2"]},hideon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},COMB_PHDMMB_SKIP_INITIAL_BUILD:{type:"combobox",keyword:"skip_initial_build::",label:"Skip the first model building cycle",tooltip:"Use this option to skip the initial (re)building, thus starting with phase restrained refinement. If not skipped then the model is first (re)built and then subjected to phase restrained refinement.",range:["_blank_|Auto","True|Yes","False|No"],value:"_blank_",position:[13,0,1,1],showon:{sec1:["crank2"]},hideon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},COMB_PHDMMB_REBUILD_ONLY:{type:"combobox",keyword:"rebuild_only::",label:"Soft rebuilding",tooltip:"In case of soft rebuilding, the actual model is inputted to each model building cycle. If soft building is not used then Crank2 alternates cycles of rebuilding inputting and not inputting the model. Soft rebuilding may be useful when rebuilding an already good model where model bias is not a major concern.",range:["_blank_|Auto","True|Yes","False|No"],value:"_blank_",position:[15,0,1,1],showon:{sec1:["crank2"]},hideon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},COMB_PHDMMB_ALWAYS_EXCLUDE_FREE:{type:"combobox",keyword:"always_exclude_free::",label:"Exclude free reflections",tooltip:"Specify when the free reflections should be excluded.",range:["_blank_|Auto","True|always","False|in last cycles","never|never"],value:"_blank_",position:[17,0,1,1],showon:{sec1:["crank2"]},hideon:{_:"||",COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},COMB_PHDMMB_NCS_DET:{type:"combobox",keyword:"ncs_det::",label:"Try to determine NCS",tooltip:"Option to try to determine NCS operators and use them for density averaging. By defalt, the NCS operators will be obtained from the anomalous substructure which may be time consuming with a large substructure.",range:["_blank_|Auto","True|Yes","False|No"],value:"_blank_",position:[19,0,1,1],showon:{sec1:["crank2"]},hideon:{_:"||",COMB_PHDMMB_DMFULL_DM_PROGRAM:["solomon"],MONOMERS_ASYM:["1"],COMB_PHDMMB_DO:[!1],native:[1],hkl:[2,3,4]}},COMB_PHDMMB_NCS_DET_MR:{type:"checkbox",keyword:"ncs_det_mr::",label:"from partial model (rather than heavy atoms)",tooltip:"The NCS operators for NCS averaging will be obtained from the initial partial model. Requires a reasonably good input partial model.",value:!1,translate:["False","True"],position:[20,4,1,1],showon:{sec1:["crank2"]},hideon:{_:"||",COMB_PHDMMB_DMFULL_DM_PROGRAM:["solomon"],MONOMERS_ASYM:["1"],COMB_PHDMMB_NCS_DET:["_blank_","False"],COMB_PHDMMB_DO:[!1],"revision.subtype:xyz":[0,-1],native:[1],hkl:[2,3,4]}}}},sec7:{type:"section",title:"Advanced options for density modification and model building",open:!1,position:[6,0,1,5],showon:{sec1:["shelx-auto"]},hideon:{_:"&&","revision.subtype:xyz":[1],PARTIAL_AS_SUBSTR:[!1]},contains:{PHDMMB_BIGCYC:{type:"integer_",keyword:"bigcyc::",label:"Number of poly-Ala tracing cycles",tooltip:"Number of model tracing cycles.",range:[0,"*"],value:"",position:[0,0,1,1],showon:{sec1:["shelx-auto"]}},PHDMMB_DMCYC:{type:"integer_",keyword:"dmcyc::",label:"Number of density modification cycles",tooltip:"Number of density modification iterations per each model building cycle.",range:[0,"*"],value:"",position:[1,0,1,1],showon:{sec1:["shelx-auto"]}},PHDMMB_THRESHOLD_STOP:{type:"real_",keyword:"threshold_stop::",label:"CC threshold for early stop",tooltip:'If this threshold is reached, model tracing will stop, assuming a good quality model has been built. Saves time for the "easy" to build cases. At least 3 tracing cycles are always performed before the early stop is applied.',range:[.001,"*"],value:"",position:[2,0,1,1],showon:{sec1:["shelx-auto"]}},PHDMMB_THRESHOLD_HAND_STOP:{type:"real_",keyword:"threshold_hand_stop::",label:'CC threshold for the "other" hand early stop',tooltip:"If this correlation coefficient is reached, the hand is considered correct and tracing with the other hand is stopped.",range:[.001,"*"],value:"",position:[3,0,1,1],showon:{sec1:["shelx-auto"]}},PHDMMB_PROGRAM_KEYWORDS:{type:"string_",keyword:"shelxe ",label:"SHELXE program arguments",tooltip:"Custom arguments that will be passed directly to SHELXE",iwidth:"500",value:"",position:[5,0,1,1],showon:{sec1:["shelx-auto"]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCrank2.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCrank2.prototype.constructor=TaskCrank2,TaskCrank2.prototype.icon=function(){return"task_crank2"},TaskCrank2.prototype.desc_title=function(){return"finds heavy-atom substructure, performs EP and builds atomic model"},TaskCrank2.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskCrank2.prototype.canEndGracefully=function(){return!0},TaskCrank2.prototype.checkKeywords=function(e){return this.__check_keywords(e,["crank2","experimental","phasing","auto-ep","ep","substructure"])},__template?(conf=require("../../js-server/server.configuration"),TaskCrank2.prototype.makeInputData=function(e,t){if("revision"in this.input_data.data){var i=this.input_data.data.revision[0];switch(this.input_data.data.hklrev=[i.HKL],i.Options.phasing_sel){case"substructure":i.Substructure&&(this.input_data.data.substructure=[i.Substructure]);break;case"model":i.Structure&&(this.input_data.data.pmodel=[i.Structure]);break;case"model-and-substr":i.Substructure&&(this.input_data.data.substructure=[i.Substructure]),i.Structure&&(this.input_data.data.pmodel=[i.Structure])}this.input_data.data.seq=i.ASU.seq}__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskCrank2.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.crank2",e,t,this.id]},module.exports.TaskCrank2=TaskCrank2):(TaskCrank2.prototype.hotButtons=function(){return[CootMBHotButton()]},TaskCrank2.prototype.inputChanged=function(e,t,i){function o(e,t){return e.split(" (")[0]+" ("+t+")"}var n,s,a,r,l,c,d;if(0<=["revision","hkl","native"].indexOf(t)&&(a=e.grid.inpDataRef,h=this.getInputItem(a,"revision").dropdown[0],n=this.getInputItem(a,"native"),s=this.getInputItem(a,"hkl"),d=(a=this.getDataState(a)).hkl,a=a.native,r=!1,h.customGrid.phasing_sel&&(r="substructure"!=h.customGrid.phasing_sel.getValue()),h=!1,0<a&&n&&n.dropdown[0].hasOwnProperty("customGrid")&&(l=n.dropdown[0].customGrid,c=0<a&&d<=0,h=(useForPhasing_cbx=l.useForPhasing).getValue(),useForPhasing_cbx.setVisible(c),l.setVisible(c)),this.state==job_code.new&&(l=this.name,d<=0?a<=0?r?(this.title=o(this.title,"MR-SAD"),this.name=o(this.name,"MR-SAD")):(this.title=o(this.title,"SAD"),this.name=o(this.name,"SAD")):h?(this.title=o(this.title,"SIRAS"),this.name=o(this.name,"SIRAS")):r?(this.title=o(this.title,"MR-SAD + Native"),this.name=o(this.name,"MR-SAD + Native")):(this.title=o(this.title,"SAD + Native"),this.name=o(this.name,"SAD + Native")):a<=0?(this.title=o(this.title,"MAD"),this.name=o(this.name,"MAD")):(this.title=o(this.title,"MAD + Native"),this.name=o(this.name,"MAD + Native")),this.name!=l&&((c=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),d=this.name.replace(/<(?:.|\n)*?>/gm,""),c.header.uname_inp.setStyle("text","",d),c.job_dialog.changeTitle(d),c.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node)))),TaskTemplate.prototype.inputChanged.call(this,e,t,i),s&&n&&r)for(var h=s.dropdown[0].row,u=n.dropdown[0].row,p=h;p<u;p++)e.grid.setRowVisible(p,!1)},TaskCrank2.prototype.updateInputPanel=function(e){var t;this.state==job_code.new&&(t=new CustomEvent(cofe_signals.jobDlgSignal,{detail:job_dialog_reason.rename_node}),e.element.dispatchEvent(t))},TaskCrank2.prototype.collectInput=function(e){var i=TaskTemplate.prototype.collectInput.call(this,e);function t(e,t){i+="|<b>"+e+":</b> "+t}for(var o=this.input_data.getData("hkl"),n=this.input_data.getData("native"),s=0;s<o.length;s++){for(var a=s+1;a<o.length;a++)o[s].dataId==o[a].dataId&&t("Reflection data","dataset "+o[s].dname+" is used in more than one input positions, which is not allowed");0<n.length&&o[s].dataId==n[0].dataId&&t("Native dataset","dataset "+o[s].dname+" is used as both anomalous data and native dataset, which is not allowed.")}return i});var __template=null,conf;function TaskCrosSec(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskCrosSec",this.name="x-ray cross sections",this.oname="*",this.title="X-ray cross sections and anomalous scattering factors",this.parameters={UNITS_SEL:{type:"combobox",keyword:"UNITS",label:"<b>Work units:</b>",tooltip:"Choose work units",range:["E|Photon energy (KeV)","W|Wavelength (&Aring;)"],value:"E",position:[0,0,1,4]},ATOM:{type:"string",keyword:"ATOM",label:"<b>Atom type:</b>",tooltip:"Chemical element symbol, e.g., Se",default:"Se",iwidth:40,value:"Se",emitting:!0,maxlength:2,position:[1,0,1,1]},_label_P:{type:"label",label:"&nbsp;<br><h3>A) Make scattering factors plot</h3>",position:[2,0,1,5]},NPOINTS_W:{type:"integer",label:"<i>using</i>",align:"right",tooltip:"Number of wavelength energy points",default:"50",iwidth:40,value:"50",position:[3,0,1,1],showon:{UNITS_SEL:["W"]}},WLENGTH_MIN:{type:"real",label:"<i>wavelength points,&nbsp;&nbsp;&nbsp;&nbsp;starting from</i>",tooltip:"Minimal wavelength in angstrom",default:"0.5",iwidth:40,value:"0.5",position:[3,4,1,1],showon:{UNITS_SEL:["W"]}},WLENGTH_MAX:{type:"real",label:"<i>&Aring;</i>,&nbsp;&nbsp;&nbsp;&nbsp;<i>to</i>",tooltip:"Maximal wavelength in angstrom",default:"1.5",iwidth:40,value:"1.5",position:[3,7,1,1],showon:{UNITS_SEL:["W"]}},_label_W:{type:"label",label:"<i>&Aring;</i>",position:[3,10,1,1],showon:{UNITS_SEL:["W"]}},NPOINTS_E:{type:"integer",label:"<i>using</i>",align:"right",tooltip:"Number of photon energy points",default:"50",iwidth:40,value:"50",position:[3,0,1,1],showon:{UNITS_SEL:["E"]}},ENERGY_MIN:{type:"real",label:"<i>photon energy points,&nbsp;&nbsp;&nbsp;&nbsp;starting from</i>",tooltip:"Minimal photon energy in KeV",default:"8.0",iwidth:40,value:"8.0",position:[3,4,1,1],showon:{UNITS_SEL:["E"]}},ENERGY_MAX:{type:"real",label:"<i>KeV<i>,&nbsp;&nbsp;&nbsp;&nbsp;<i>to</i>",tooltip:"Maximal photon energy in KeV",default:"25.0",iwidth:40,value:"25.0",position:[3,7,1,1],showon:{UNITS_SEL:["E"]}},_label_E:{type:"label",label:"<i>KeV</i>",position:[3,10,1,1],showon:{UNITS_SEL:["E"]}},_label_PW:{type:"label",label:"&nbsp;<br><h3>B) Compute scattering factors for the following selected wavelengths:</h3>",position:[4,0,1,15],showon:{UNITS_SEL:["W"]}},WAVELENGTH_01:{type:"real_",label:"<i>W<sub>1</sub>:</i>",align:"right",tooltip:"Wavelength in angstrom",default:"",iwidth:40,value:"",label2:"<i>&Aring;</i>",align2:"left",position:[5,0,1,1],showon:{UNITS_SEL:["W"]}},WAVELENGTH_02:{type:"real_",label:"<i>W<sub>2</sub>:</i>",align:"right",tooltip:"Wavelength in angstrom",default:"",iwidth:40,value:"",label2:"<i>&Aring;</i>",align2:"left",position:[6,0,1,1],showon:{UNITS_SEL:["W"]}},WAVELENGTH_03:{type:"real_",label:"<i>W<sub>3</sub>:</i>",align:"right",tooltip:"Wavelength in angstrom",default:"",iwidth:40,value:"",label2:"<i>&Aring;</i>",align2:"left",position:[7,0,1,1],showon:{UNITS_SEL:["W"]}},WAVELENGTH_04:{type:"real_",label:"<i>W<sub>4</sub>:</i>",align:"right",tooltip:"Wavelength in angstrom",default:"",iwidth:40,value:"",label2:"<i>&Aring;</i>",align2:"left",position:[8,0,1,1],showon:{UNITS_SEL:["W"]}},WAVELENGTH_05:{type:"real_",label:"<i>W<sub>5</sub>:</i>",align:"right",tooltip:"Wavelength in angstrom",default:"",iwidth:40,value:"",label2:"<i>&Aring;</i>",align2:"left",position:[9,0,1,1],showon:{UNITS_SEL:["W"]}},WAVELENGTH_06:{type:"real_",label:"<i>W<sub>6</sub>:</i>",align:"right",tooltip:"Wavelength in angstrom",default:"",iwidth:40,value:"",label2:"<i>&Aring;</i>",align2:"left",position:[10,0,1,1],showon:{UNITS_SEL:["W"]}},_label_PE:{type:"label",label:"&nbsp;<br><h3>B) Compute scattering factors for the following selected photon energies:</h3>",position:[4,0,1,15],showon:{UNITS_SEL:["E"]}},ENERGY_01:{type:"real_",label:"<i>E<sub>1</sub>:</i>",align:"right",tooltip:"Photon energy in KeV",default:"",iwidth:40,value:"",label2:"<i>KeV</i>",align2:"left",position:[5,0,1,1],showon:{UNITS_SEL:["E"]}},ENERGY_02:{type:"real_",label:"<i>E<sub>2</sub>:</i>",align:"right",tooltip:"Photon energy in KeV",default:"",iwidth:40,value:"",label2:"<i>KeV</i>",align2:"left",position:[6,0,1,1],showon:{UNITS_SEL:["E"]}},ENERGY_03:{type:"real_",label:"<i>E<sub>3</sub>:</i>",align:"right",tooltip:"Photon energy in KeV",default:"",iwidth:40,value:"",label2:"<i>KeV</i>",align2:"left",position:[7,0,1,1],showon:{UNITS_SEL:["E"]}},ENERGY_04:{type:"real_",label:"<i>E<sub>4</sub>:</i>",align:"right",tooltip:"Photon energy in KeV",default:"",iwidth:40,value:"",label2:"<i>KeV</i>",align2:"left",position:[8,0,1,1],showon:{UNITS_SEL:["E"]}},ENERGY_05:{type:"real_",label:"<i>E<sub>5</sub>:</i>",align:"right",tooltip:"Photon energy in KeV",default:"",iwidth:40,value:"",label2:"<i>KeV</i>",align2:"left",position:[9,0,1,1],showon:{UNITS_SEL:["E"]}},ENERGY_06:{type:"real_",label:"<i>E<sub>6</sub>:</i>",align:"right",tooltip:"Photon energy in KeV",default:"",iwidth:40,value:"",label2:"<i>KeV</i>",align2:"left",position:[10,0,1,1],showon:{UNITS_SEL:["E"]}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskCrosSec.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskCrosSec.prototype.constructor=TaskCrosSec,TaskCrosSec.prototype.icon=function(){return"task_crossec"},TaskCrosSec.prototype.desc_title=function(){return"interpolates X-ray cross sections and compute anomalous scattering factors"},TaskCrosSec.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskCrosSec.prototype.inputChanged=function(e,t,i){function o(e,t){return e.split(" (")[0]+" ("+t+")"}var n,s;"ATOM"==t&&(n=(n=checkElementSymbol(i))||i,this.title=o(this.title,n),this.name=o(this.name,n),(n=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),s=this.name.replace(/<(?:.|\n)*?>/gm,""),n.header.uname_inp.setStyle("text","",s),n.job_dialog.changeTitle(s),this.updateInputPanel(n),n.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node)),TaskTemplate.prototype.inputChanged.call(this,e,t,i)},TaskCrosSec.prototype.updateInputPanel=function(e){var t;this.state==job_code.new&&(t=new CustomEvent(cofe_signals.jobDlgSignal,{detail:job_dialog_reason.rename_node}),e.element.dispatchEvent(t))},TaskCrosSec.prototype.collectInput=function(e){var e=TaskTemplate.prototype.collectInput.call(this,e),t=checkElementSymbol(this.parameters.ATOM.value);return t?this.parameters.ATOM.value=t:e+="|<b>Invalid atom type "+this.parameters.ATOM.value+"</b>",e},TaskCrosSec.prototype.checkKeywords=function(e){return this.__check_keywords(e,["crossec","x-ray","cross","section","anomalous","scattering","factors"])},__template&&(conf=require("../../js-server/server.configuration"),TaskCrosSec.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.crossec",e,t,this.id]},module.exports.TaskCrosSec=TaskCrosSec);var __template=null,fs,path,conf,prj,utils,task_t;function TaskDeposition(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskDeposition",this.name="deposition",this.setOName("deposition"),this.title="Prepare data for deposition",this.input_dtypes=[{data_type:{DataRevision:["!xyz"]},label:"Structure revision",inputId:"revision",version:4,min:1,max:1}],this.parameters={_label:{type:"label",label:"<b><i>Target sequence(s):<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;",position:[0,0,1,1],showon:{"revision.subtype:seq":[0,-1]}},SEQUENCE_TA:{type:"aceditor_",tooltip:"",reportas:"Sequence(s)",placeholder:"Copy-paste your sequence(s) here, including title line(s).\n\nMore than one sequences of the same type (protein/dna/na)\ncan be given one after another. Example:\n\n>rnase_A\nDVSGTVCLSALPPEATDTLNLIASDGPFPYSQDGVVFQNRESVLPTQSYGYYHEYTVITPGARTRGTRRIICGE\nATQEDYYTGDHYATFSLIDQTC\n\n>1dtx_A\nQPRRKLCILHRNPGRCYDKIPAFYYNQKKKQCERFDWSGCGGNSNRFKTIEECRRTCIG",iwidth:700,iheight:300,value:"",position:[0,2,1,3],showon:{"revision.subtype:seq":[0,-1]}},_label_2:{type:"label",label:"&nbsp;",position:[1,0,1,1]},DEL0HYDR_CBX:{type:"checkbox",label:"Remove hydrogens with zero occupancy",tooltip:"Check to remove hydrogens with zero occupancy",value:!1,iwidth:340,position:[2,0,1,4]},PDBREPORT_CBX:{type:"checkbox",label:"Obtain the PDB Validation Report",tooltip:"Check to obtain the PDB Validation Report",value:!0,iwidth:340,position:[3,0,1,4]}},__template||this.state!=job_code.new||"commercial"==__user_licence&&(this.parameters.PDBREPORT_CBX.value=!1)}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskDeposition.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskDeposition.prototype.constructor=TaskDeposition,TaskDeposition.prototype.icon=function(){return"task_deposition"},TaskDeposition.prototype.desc_title=function(){return"prepares mmCIF files for deposition and acquires the PDB Validation report from wwPDB servers"},TaskDeposition.prototype.currentVersion=function(){return __template?3+__template.TaskTemplate.prototype.currentVersion.call(this):3+TaskTemplate.prototype.currentVersion.call(this)},TaskDeposition.prototype.checkKeywords=function(e){return this.__check_keywords(e,["deposition","pdb","report","deposit"])},__template?(fs=require("fs-extra"),path=require("path"),conf=require("../../js-server/server.configuration"),prj=require("../../js-server/server.fe.projects"),utils=require("../../js-server/server.utils"),task_t=require("./common.tasks.template"),TaskDeposition.prototype.makeInputData=function(e,t){"revision"in this.input_data.data&&(o=l=null,"file_xml"in(i=this.input_data.data.revision[0]).HKL.aimless_meta&&i.HKL.aimless_meta.file_xml?(l=i.HKL.aimless_meta.file_xml,o=i.HKL.aimless_meta.file_unm):"file"in i.HKL.aimless_meta&&i.HKL.aimless_meta.file&&(l=i.HKL.aimless_meta.file),l&&this.addInputFile(i.HKL.aimless_meta.jobId,l,t),o&&this.addInputFile(i.HKL.aimless_meta.jobId,o,t),this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure],this.input_data.data.seq=i.ASU.seq),__template.TaskTemplate.prototype.makeInputData.call(this,e,t);for(var i,o,n,s=[],a=fs.readdirSync(path.join(t,"..")),r=0;r<a.length;r++)!a[r].startsWith(prj.jobDirPrefix)||(n=utils.readObject(path.join(t,"..",a[r],task_t.jobDataFName)))&&n.hasOwnProperty("_type")&&s.indexOf(n._type)<0&&s.push(n._type);var l={list:s};utils.writeObject(path.join(t,"input","all_tasks.json"),l)},TaskDeposition.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.deposition",e,t,this.id]},module.exports.TaskDeposition=TaskDeposition):(TaskDeposition.prototype.desc_title=function(){return"prepares mmCIF files for PDB deposition and acquires PDB Validation Report"},TaskDeposition.prototype.taskDescription=function(){return"Prepares mmCIF files for PDB deposition and acquires PDB Validation Report"},TaskDeposition.prototype.collectInput=function(e){var e=TaskTemplate.prototype.collectInput.call(this,e),t=[],i=this.parameters.SEQUENCE_TA.value.trim();return 0<i.length&&!startsWith(i,">")&&t.push("Sequence data format is not valid"),0<t.length&&(e+="|<b>"+t.join("</b><br><b>")+"</b>"),e});var __template=null,conf;function TaskDimple(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskDimple",this.name="dimple",this.setOName("dimple"),this.title="Dimple refinement",this.input_dtypes=[{data_type:{DataRevision:["!hkl","!xyz"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Options",open:!1,position:[0,0,1,5],contains:{TITLE1:{type:"label",label:"<h3>Refinement parameters</h3>",position:[0,0,1,4]},REFLEVEL:{type:"combobox",keyword:"REFLEVEL",label:"Refinement level",iwidth:200,tooltip:"Higher refinement levels may produce better results at longer computation times",range:["0|Normal","1|Enhanced","2|Highest"],value:"2",position:[1,0,1,1]},NJELLY:{type:"integer_",keyword:"--jelly",label:"Number of jelly-body cycles",tooltip:"Number of jelly-body Refmac cycles (between 0 and 400) to run before final refinrmrnt (leave blank for automatic choice)",range:[0,400],value:"",default:0,position:[2,0,1,1]},NRESTR:{type:"integer_",keyword:"--restr-cycles",label:"Number of final cycles",tooltip:"Number of final Refmac cycles (between 0 and 400; leave blank for automatic choice)",range:[0,400],value:"",default:8,position:[3,0,1,1]},RESLIMIT:{type:"real_",keyword:"--reso",label:"Resolution limit (&Aring;)",tooltip:"Specify the high resolution limit or leave blank for automatic choice",range:[0,"*"],value:"",position:[4,0,1,1]},WEIGHT:{type:"real_",keyword:"--weight",label:"Refmac matrix weight",tooltip:"Specify weight value or leave blank for automatic choice",range:[0,"*"],value:"",position:[5,0,1,1]},TITLE2:{type:"label",label:"<h3>Molecular Replacement parameters</h3>",position:[6,0,1,4]},MRTHRESHOLD:{type:"real_",keyword:"--mr-when-r",label:"Threshold R<sub>free</sub> for MR",tooltip:"Will perform molecular replacement if R<sub>free</sub> is higher than the threshold value given",range:[0,1],value:"",default:.4,position:[7,0,1,1]},MRPROG:{type:"combobox",keyword:"--mr-prog",label:"MR program to use",tooltip:"Choose molecular replacement program",range:["phaser|Phaser","molrep|Molrep"],value:"phaser",position:[8,0,1,1]},MRNUM:{type:"integer_",keyword:"--mr-num",label:"Number of molecules",tooltip:"Specify the number of molecules for MR or leave blank for automatic choice",range:[0,400],value:"",position:[9,0,1,1]},MRRESO:{type:"real_",keyword:"--mr-reso",label:"Resolution cut-off (&Aring;)",tooltip:"Specify the high resolution cut-off for MR or leave blank for automatic choice",range:[0,"*"],value:"",default:3.25,position:[10,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskDimple.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskDimple.prototype.constructor=TaskDimple,TaskDimple.prototype.icon=function(){return"task_dimple"},TaskDimple.prototype.desc_title=function(){return"allows quick assessment of crystal data to see if a ligand has bound to the structure"},TaskDimple.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskDimple.prototype.checkKeywords=function(e){return this.__check_keywords(e,["dimple","refinement","ligand","finding","difference","map"])},__template?(conf=require("../../js-server/server.configuration"),TaskDimple.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],0<=i.subtype.indexOf("xyz")&&(this.input_data.data.istruct=[i.Structure])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskDimple.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.dimple",e,t,this.id]},module.exports.TaskDimple=TaskDimple):TaskDimple.prototype.hotButtons=function(){return[CootMBHotButton()]};var __template=null,conf;function TaskDocDev(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskDocDev",this.name="documentation development",this.setOName("*"),this.title="Documentation Development with Sphinx",this.input_dtypes=[],this.parameters={L1:{type:"label",label:"<h3>This task compiles and deploys documentation packages</h3>",position:[0,0,1,5]},DOC_SEL:{type:"combobox",label:"Documentation package:",tooltip:"Choose documentation package to compile",range:["taskref|Task Reference","tutorials|Tutorials","userguide|User Guide","dev|Developers Reference","source|CCP4docs"],value:"taskref",iwidth:260,position:[1,0,1,1]},THEME_SEL:{type:"combobox",label:"Documentation theme:",tooltip:"Choose documentation theme",range:["material|MATERIAL","haiku|HAIKU","agogo|AGOGO","insegel|INSEGEL","karma|KARMA","insipid|INSIPID","book|BOOK","furo|FURO"],value:"material",iwidth:260,position:[2,0,1,1]},OUTPUT_SEL:{type:"combobox",label:"Result required:",tooltip:"Choose required result",range:["compile|Compile only","deploy|Compile and deploy"],value:"compile",iwidth:260,position:[3,0,1,1]}}}function DocDevHotButton(){return{task:"TaskDocDev",tooltip:"Documentation Development with Sphinx"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskDocDev.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskDocDev.prototype.constructor=TaskDocDev,TaskDocDev.prototype.icon=function(){return"task_docdev"},TaskDocDev.prototype.requiredEnvironment=function(){return["DOCREPO"]},TaskDocDev.prototype.platforms=function(){return"LMU"},TaskDocDev.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskDocDev.prototype.checkKeywords=function(e){return this.__check_keywords(e,["doc","documentation","text"])},__template?(conf=require("../../js-server/server.configuration"),TaskDocDev.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.docdev",e,t,this.id]},module.exports.TaskDocDev=TaskDocDev):(TaskDocDev.prototype.hotButtons=function(){return[DocDevHotButton()]},TaskDocDev.prototype.onJobDialogStart=function(e){});var __template=null,conf;function TaskDUI(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskDUI",this.name="dui (image processing)",this.setOName("dials"),this.title="Interactive Image Processing with DUI",this.nc_type="client",this.input_dtypes=[],this.parameters={L1:{type:"label",label:"<h3>This task will launch DIALS GUI (DUI) on your computer.</h3>",position:[0,0,1,1]},L2:{type:"label",label:"<i>In the end of DUI session, simply save integrated MTZ in default directory</i>",position:[1,0,1,1]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskDUI.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskDUI.prototype.constructor=TaskDUI,TaskDUI.prototype.icon=function(){return"task_dui"},TaskDUI.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},TaskDUI.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskDUI.prototype.checkKeywords=function(e){return this.__check_keywords(e,["dui","dials","image","processing","gui"])},__template?(conf=require("../../js-server/server.configuration"),TaskDUI.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.dui",e,t,this.id]},module.exports.TaskDUI=TaskDUI):(TaskDUI.prototype.desc_title=function(){return"analyses X-ray data"},TaskDUI.prototype.onJobDialogStart=function(e){e.run_btn.click()});var __template=null,conf;function TaskEditRevisionASU(){__template?(__template.TaskTemplate.call(this),this.state=__template.job_code.retired):(TaskTemplate.call(this),this.state=job_code.retired),this._type="TaskEditRevisionASU",this.name="edit revision asu",this.setOName("edit_revision_asu"),this.title="Edit Revision: Asymmetric Unit",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataRevision:[]},label:"Structure revision",tooltip:"Structure revision, in which the ASU contents needs to be modified",inputId:"revision",customInput:"cell-info",version:5,min:1,max:1},{data_type:{DataHKL:[]},label:"Reflections",unchosen_label:"[do not change]",tooltip:"Reflection dataset to be used for phasing and refinement in further tasks. If no changes are required, choose [do not change].",inputId:"hkl",customInput:"cell-info",min:0,max:1},{data_type:{DataSequence:["~unknown"]},label:"Sequence",unchosen_label:"[do not change]",tooltip:"Macromolecular sequence(s) expected in ASU. If no changes in ASU compositon are required, choose [do not change].",inputId:"seq",customInput:"stoichiometry-wauto",version:0,min:0,max:10}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskEditRevisionASU.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskEditRevisionASU.prototype.constructor=TaskEditRevisionASU,TaskEditRevisionASU.prototype.icon=function(){return"task_editrevision_asu"},TaskEditRevisionASU.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskEditRevisionASU.prototype.doNotPackSuffixes=function(){return[]},TaskEditRevisionASU.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl0=[i.HKL],this.input_data.data.seq0=i.ASU.seq),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskEditRevisionASU.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.editrevision_asu",e,t,this.id]},module.exports.TaskEditRevisionASU=TaskEditRevisionASU):(TaskEditRevisionASU.prototype.checkObjects=function(e,t,i,o){if(0<=i.indexOf(t)){var s=e.grid.inpDataRef,i=s.input[0].dt[s.input[0].dropdown[0].getValue()].HKL,a=i.getSpaceGroup(),r=i.getCellParameters();function l(e,t){t=t.getValue();if(0<=t){e=s.input[e].dt[t],t=e.getSpaceGroup();if("Unspecified"==t)return"No space group";if(s_spg=t.replace(/\s/g,""),s_spg0=a.replace(/\s/g,""),s_spg!=s_spg0)return"Unmatched space group";var i=e.getCellParameters();if(i[0]<2)return"No cell parameters";for(var o=!0,n=0;n<3&&o;n++)(.005<Math.abs(i[n]-r[n])/(i[n]+r[n])||2<Math.abs(i[n+3]-r[n+3]))&&(o=!1);if(!o)return"Too distant cell parameters"}return""}for(var c=!1,n=1;n<s.input.length&&!c;n++)for(var d=s.input[n],h=0;h<d.dropdown.length&&!c;h++)c=0<=d.dropdown[h].getValue();function u(e){for(var t,i,o=-1,n=0;n<s.input.length&&o<0;n++)s.input[n].inputId==e&&(o=n);0<=o&&(i=l(o,t=s.input[o].dropdown[0]),t.customGrid.setLabel(i.fontcolor("red"),0,2,1,1).setFontItalic(!0).setNoWrap(),0<i.length&&(c=!1))}for(var p=0;p<o.length;p++)u(o[p]);return c}},TaskEditRevisionASU.prototype.inputChanged=function(e,t,i){TaskTemplate.prototype.inputChanged.call(this,e,t,i);i="";this.checkObjects(e,t,["revision","hkl","seq"],["hkl"])||(i="hide_run_button"),this.sendTaskStateSignal(e.grid.inputPanel,i)});var __template=null,conf,__template0;function TaskEditRevisionStruct(){__template?(__template.TaskEditRevisionASU.call(this),this.state=__template.job_code.retired):(TaskEditRevisionASU.call(this),this.state=job_code.retired),this._type="TaskEditRevisionStruct",this.name="edit revision structure",this.setOName("edit_revision_struct"),this.title="Edit Revision: Structure",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataRevision:["~substructure"]},label:"Structure revision",tooltip:"Structure revision, in which the Macromolecular Structure needs to be modified",inputId:"revision",customInput:"cell-info",version:5,min:1,max:1},{data_type:{DataStructure:["!xyz"],DataXYZ:[]},label:"Atomic coordinates",cast:"xyz",unchosen_label:"[remove]",tooltip:"Atomic model coordinates. In order to remove existing coordinates, choose [remove].",inputId:"xyz",customInput:"cell-info",force:1,version:0,min:0,max:1},{data_type:{DataStructure:["!phases"]},label:"Phases",cast:"phases",unchosen_label:"[do not change]",tooltip:"Phases to replace or set in structure revision, the top item corresponds to current phases. Phases cannot be removed, only replaced or left as is.",inputId:"phases",customInput:"cell-info",force:1,version:0,min:0,max:1},{data_type:{DataLigand:[],DataLibrary:[]},label:"Ligand data",unchosen_label:"[do not change]",tooltip:"Ligand(s). If no changes are required, choose [do not change]. Note that if ligand structures are given, they will replace any pre-existing ligands in structure revision.",inputId:"ligand",min:0,max:20}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.editrevisionasu")),TaskEditRevisionStruct.prototype=__template?Object.create(__template.TaskEditRevisionASU.prototype):Object.create(TaskEditRevisionASU.prototype),TaskEditRevisionStruct.prototype.constructor=TaskEditRevisionStruct,TaskEditRevisionStruct.prototype.icon=function(){return"task_editrevision_struct"},TaskEditRevisionStruct.prototype.currentVersion=function(){return __template?2+__template.TaskEditRevisionASU.prototype.currentVersion.call(this):2+TaskEditRevisionASU.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),__template0=require("./common.tasks.template"),TaskEditRevisionStruct.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl0=[i.HKL],i.Structure&&(this.input_data.data.struct0=[i.Structure])),__template0.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskEditRevisionStruct.prototype.makeOutputData=function(e){__template0.TaskTemplate.prototype.makeOutputData.call(this,e),this.input_data.addData(this.input_data.data.revision[0].Structure)},TaskEditRevisionStruct.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.editrevision_struct",e,t,this.id]},module.exports.TaskEditRevisionStruct=TaskEditRevisionStruct):TaskEditRevisionStruct.prototype.inputChanged=function(e,t,i){TaskTemplate.prototype.inputChanged.call(this,e,t,i);i="";this.checkObjects(e,t,["revision","xyz","phases","ligand"],["xyz","phases"])||(i="hide_run_button"),this.sendTaskStateSignal(e.grid.inputPanel,i)};var __template=null,conf,__template0;function TaskEditRevisionSubstr(){__template?(__template.TaskEditRevisionASU.call(this),this.state=__template.job_code.retired):(TaskEditRevisionASU.call(this),this.state=job_code.retired),this._type="TaskEditRevisionSubstr",this.name="edit revision substructure",this.setOName("edit_revision_substr"),this.title="Edit Revision: Substructure",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataRevision:["!substructure"]},label:"Structure revision",tooltip:"Structure revision, in which the Heavy-Atom Substructure needs to be modified",inputId:"revision",customInput:"cell-info",version:5,min:1,max:1},{data_type:{DataStructure:["!substructure"]},label:"Heavy-atom substructure",cast:"sub",unchosen_label:"[remove]",tooltip:"Atomic coordinates of the heavy-atom substructure. In order to remove existing coordinates, choose [remove].",inputId:"sub",customInput:"cell-info",version:0,force:1,min:0,max:1},{data_type:{DataStructure:["!phases"]},label:"Phases",cast:"phases",tooltip:"Phases to replace or set in heavy-atom substructure. If no changes are required, choose [do not change].",inputId:"phases",customInput:"cell-info",version:0,min:1,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.editrevisionasu")),TaskEditRevisionSubstr.prototype=__template?Object.create(__template.TaskEditRevisionASU.prototype):Object.create(TaskEditRevisionASU.prototype),TaskEditRevisionSubstr.prototype.constructor=TaskEditRevisionSubstr,TaskEditRevisionSubstr.prototype.icon=function(){return"task_editrevision_substr"},TaskEditRevisionSubstr.prototype.currentVersion=function(){return __template?2+__template.TaskEditRevisionASU.prototype.currentVersion.call(this):2+TaskEditRevisionASU.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),__template0=require("./common.tasks.template"),TaskEditRevisionSubstr.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl0=[i.HKL],i.Substructure&&(this.input_data.data.substr0=[i.Substructure])),__template0.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskEditRevisionSubstr.prototype.makeOutputData=function(e){__template0.TaskTemplate.prototype.makeOutputData.call(this,e),this.input_data.addData(this.input_data.data.revision[0].Substructure)},TaskEditRevisionSubstr.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.editrevision_substr",e,t,this.id]},module.exports.TaskEditRevisionSubstr=TaskEditRevisionSubstr):TaskEditRevisionSubstr.prototype.inputChanged=function(e,t,i){TaskTemplate.prototype.inputChanged.call(this,e,t,i)};var __template=null,conf;function TaskEditRevision(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskEditRevision",this.name="edit structure revision",this.setOName("editrevision"),this.title="Edit Structure Revision",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataRevision:[]},label:"Structure revision",tooltip:"Structure revision, in which the ASU contents needs to be modified",inputId:"revision",customInput:"cell-info",version:5,min:1,max:1},{data_type:{DataHKL:[]},label:"Reflections",unchosen_label:"[do not change]",tooltip:"Reflection dataset to be used for phasing and refinement in further tasks. If no changes are required, choose [do not change].",inputId:"hkl",customInput:"cell-info",min:0,max:1},{data_type:{DataSequence:["~unknown"]},label:"Sequence",unchosen_label:"[do not change]",tooltip:"Macromolecular sequence(s) expected in ASU. If no changes in ASU compositon are required, choose [do not change].",inputId:"seq",customInput:"stoichiometry-wauto",version:0,min:0,max:10},{data_type:{DataStructure:["xyz","substructure"],DataXYZ:[],DataRemove:[]},label:"Macromolecular model<br>or substructure",cast:"xyz",unchosen_label:"[do not change]",tooltip:"Atomic model of macromolecule(s) or heavy-atom substructure. If no changes are required, choose [do not change].",inputId:"xyz",customInput:"cell-info",version:0,min:0,max:1},{data_type:{DataStructure:["!phases","substructure"],DataRemove:[]},label:"Phases",cast:"phases",unchosen_label:"[do not change]",tooltip:"Phases to replace in current model or substructure (whichever is leading). If no changes are required, choose [do not change].",inputId:"phases",customInput:"cell-info",version:0,min:0,max:1},{data_type:{DataLigand:[],DataLibrary:[]},label:"Ligand data",unchosen_label:"[do not change]",tooltip:"Ligand(s). If no changes are required, choose [do not change]. Note that if ligand structures are given, they will replace any pre-existing ligands in structure revision.",inputId:"ligands",min:0,max:20}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskEditRevision.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskEditRevision.prototype.constructor=TaskEditRevision,TaskEditRevision.prototype.icon=function(){return"task_editrevision"},TaskEditRevision.prototype.currentVersion=function(){return __template?3+__template.TaskTemplate.prototype.currentVersion.call(this):3+TaskTemplate.prototype.currentVersion.call(this)},TaskEditRevision.prototype.checkKeywords=function(e){return this.__check_keywords(e,["edit","structure","revision"])},__template?(conf=require("../../js-server/server.configuration"),TaskEditRevision.prototype.doNotPackSuffixes=function(){return[]},TaskEditRevision.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl0=[i.HKL],this.input_data.data.seq0=i.ASU.seq,"substructure"==i.Options.leading_structure?this.input_data.data.struct0=[i.Substructure]:"structure"==i.Options.leading_structure&&(this.input_data.data.struct0=[i.Structure])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskEditRevision.prototype.makeOutputData=function(e){__template.TaskTemplate.prototype.makeOutputData.call(this,e),"revision"in this.input_data.data&&0<this.input_data.data.revision?(e=this.input_data.data.revision[0],this.input_data.addData(e.HKL),0<e.ASU.seq.length&&this.input_data.addData(e.ASU.seq[0]),e.Structure&&this.input_data.addData(e.Structure),e.Substructure&&this.input_data.addData(e.Substructure)):console.log(" **** "+this._type+": no revision in input data -- fatal")},TaskEditRevision.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.editrevision",e,t,this.id]},module.exports.TaskEditRevision=TaskEditRevision):(TaskEditRevision.prototype.desc_title=function(){return"replace reflection data, sequences, atomic model, phases or ligand descriptions"},TaskEditRevision.prototype.inputChanged=function(e,t,i){if(TaskTemplate.prototype.inputChanged.call(this,e,t,i),0<=["revision","hkl","seq","xyz","phases","ligands"].indexOf(t)){var s=e.grid.inpDataRef,i=s.input[0].dt[s.input[0].dropdown[0].getValue()].HKL,a=i.getSpaceGroup(),r=i.getCellParameters();function l(e,t){t=t.getValue();if(0<=t){e=s.input[e].dt[t];if(!e.hasSubtype("proxy")){t=e.getSpaceGroup();if("Unspecified"==t)return"No space group";if(t.replace(/\s/g,"")!=a.replace(/\s/g,""))return"Unmatched space group";var i=e.getCellParameters();if(i[0]<2)return"No cell parameters";for(var o=!0,n=0;n<3&&o;n++)(.005<Math.abs(i[n]-r[n])/(i[n]+r[n])||2<Math.abs(i[n+3]-r[n+3]))&&(o=!1);if(!o)return"Too distant cell parameters"}}return""}for(var c=!1,o=1;o<s.input.length&&!c;o++)for(var n=s.input[o],d=0;d<n.dropdown.length&&!c;d++)c=0<=n.dropdown[d].getValue();function h(e){for(var t,i,o=-1,n=0;n<s.input.length&&o<0;n++)s.input[n].inputId==e&&(o=n);0<=o&&(i=l(o,t=s.input[o].dropdown[0]),t.customGrid.setLabel(i.fontcolor("red"),0,2,1,1).setFontItalic(!0).setNoWrap(),0<i.length&&(c=!1))}console.log(" 1. input_ready="+c),h("hkl"),h("xyz"),h("phases"),console.log(" 2. input_ready="+c),c?this.sendTaskStateSignal(e.grid.inputPanel,"show_run_button"):this.sendTaskStateSignal(e.grid.inputPanel,"hide_run_button")}});var __template=null,path,conf,utils;function TaskEnsemblePrepMG(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskEnsemblePrepMG",this.name="ensemble preparation (ccp4mg)",this.setOName("ensemble"),this.title="Prepare MR Ensemble with CCP4mg",this.nc_type="client",this.input_dtypes=[{data_type:{DataSequence:["protein"]},label:"Sequence",inputId:"seq",min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{RLEVEL_SEL:{type:"combobox",keyword:"RLEVEL",label:"PDB sequence redundancy level",tooltip:"Choose appropriate redundancy level for keeping hits in the list of matches. ",range:["ALL|All","100|100%","95|95%","90|90%","70|70%","50|50%"],value:"100",position:[0,0,1,1]},AFDB_CBX:{type:"checkbox",label:"Include structures from AFDB",tooltip:"Check to include structures from AlphaFold-2 database",value:!0,position:[1,0,1,3]},AFLEVEL_SEL:{type:"combobox",keyword:"AFLEVEL",label:"EBI AlphaFold database model residue confidence cut-off (higher values are more confident)",tooltip:"Choose confidence level (pLDDT) cut-off for residues in AlphaFold predictions.The higher the value the higher the confidence threshold. Residues with lower values are removed from the search models ",range:["0|0","10|10","20|20","30|30","40|40","50|50","60|60","70|70","80|80","90|90"],value:"50",position:[2,0,1,1],hideon:{AFDB_CBX:[!1]}},MRNUM:{type:"integer",keyword:"MRNUM",label:"Maximum number of models to create",tooltip:"Specify the maximum number of models to generate (from 1 to 20).",range:[1,20],value:5,position:[3,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskEnsemblePrepMG.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskEnsemblePrepMG.prototype.constructor=TaskEnsemblePrepMG,TaskEnsemblePrepMG.prototype.icon=function(){return"task_ensembleprepmg"},TaskEnsemblePrepMG.prototype.desc_title=function(){return"use MrBump and CCP4mg for interactive preparation and trimming MR ensembles"},TaskEnsemblePrepMG.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},TaskEnsemblePrepMG.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskEnsemblePrepMG.prototype.checkKeywords=function(e){return this.__check_keywords(e,["ensemble","ensembles","model","preparation","mr","molecular","replacement","sequence"])},__template&&(path=require("path"),conf=require("../../js-server/server.configuration"),utils=require("../../js-server/server.utils"),TaskEnsemblePrepMG.prototype.cleanJobDir=function(e){__template.TaskTemplate.prototype.cleanJobDir.call(this,e);e=path.join(e,"mrbump_dir");utils.fileExists(e)&&(console.log(" +++ remove stray directory "+e+" from TaskEnsemblePrepMG job"),utils.removePath(e))},TaskEnsemblePrepMG.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.ensembleprepmg",e,t,this.id]},module.exports.TaskEnsemblePrepMG=TaskEnsemblePrepMG);var __template=null,path,conf,utils;function TaskEnsemblePrepSeq(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskEnsemblePrepSeq",this.name="ensemble preparation (seq)",this.setOName("ensemble"),this.title="Prepare MR Ensemble from Sequence",this.input_dtypes=[{data_type:{DataSequence:["protein"]},label:"Sequence",inputId:"seq",min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{RLEVEL_SEL:{type:"combobox",keyword:"RLEVEL",label:"Redundancy level",tooltip:"Choose appropriate redundancy level for keeping hits in the list of matches. ",range:["ALL|All","100|100%","95|95%","90|90%","70|70%","50|50%"],value:"ALL",position:[0,0,1,1]},AFDB_CBX:{type:"checkbox",label:"Include structures from AFDB",tooltip:"Check to include structures from AlphaFold-2 database",value:!0,position:[1,0,1,3]},AFLEVEL_SEL:{type:"combobox",keyword:"AFLEVEL",label:"EBI AlphaFold database model residue confidence cut-off (higher values are more confident)",tooltip:"Choose confidence level (pLDDT) cut-off for residues in AlphaFold predictions.The higher the value the higher the confidence threshold. Residues with lower values are removed from the search models ",range:["0|0","10|10","20|20","30|30","40|40","50|50","60|60","70|70","80|80","90|90"],value:"50",position:[2,0,1,1],hideon:{AFDB_CBX:[!1]}},MRNUM:{type:"integer",keyword:"MRNUM",label:"Number of ensembles",tooltip:"Specify the number of ensemblies to generate (from 1 to 20).",range:[1,20],value:5,position:[3,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskEnsemblePrepSeq.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskEnsemblePrepSeq.prototype.constructor=TaskEnsemblePrepSeq,TaskEnsemblePrepSeq.prototype.icon=function(){return"task_ensembleprepseq"},TaskEnsemblePrepSeq.prototype.desc_title=function(){return"finds relevant PDB/AFDB structures and makes MR ensembles from them"},TaskEnsemblePrepSeq.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskEnsemblePrepSeq.prototype.checkKeywords=function(e){return this.__check_keywords(e,["ensembles","model","preparation","mr","molecular","replacement"])},TaskEnsemblePrepSeq.prototype.checkKeywords=function(e){return this.__check_keywords(e,["ensemble","ensembles","model","preparation","mr","molecular","replacement","sequence","alphafold","alphafold2","af","af2"])},__template&&(path=require("path"),conf=require("../../js-server/server.configuration"),utils=require("../../js-server/server.utils"),TaskEnsemblePrepSeq.prototype.cleanJobDir=function(e){__template.TaskTemplate.prototype.cleanJobDir.call(this,e);e=path.join(e,"search_a");utils.fileExists(e)&&(console.log(" +++ remove stray directory "+e+" from TaskEnsemblePrepSeq job"),utils.removePath(e))},TaskEnsemblePrepSeq.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.ensembleprepseq",e,t,this.id]},module.exports.TaskEnsemblePrepSeq=TaskEnsemblePrepSeq);var __template=null,path,conf,utils;function TaskEnsemblePrepXYZ(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskEnsemblePrepXYZ",this.name="ensemble preparation (xyz)",this.setOName("ensemble"),this.title="Prepare MR Ensemble from Coordinate Data",this.input_dtypes=[{data_type:{DataSequence:["!protein"]},label:"Sequence",tooltip:"Specify macromolecular sequence to be associated with the resulting ensemble.",inputId:"seq",force:1,min:1,max:1},{data_type:{DataStructure:["~substructure","~substructure-am","!xyz"],DataXYZ:[]},label:"Coordinates",tooltip:"Specify coordinate sets to be merged in an ensamble for further use in Molecular Replacement. Usually you will choose homologous single chains of approximately equal length. The resulting ensemble will be named after the leading coordinat set.",inputId:"xyz",customInput:"chain-sel-protein",min:2,max:1e3}],this.parameters={sec1:{type:"section",title:"Model modification",open:!0,position:[0,0,1,5],contains:{MODIFICATION_SEQ_SEL:{type:"combobox",keyword:"none",label:"Modification protocol:",tooltip:"Choose trim option",range:["U|Unmodified","D|PDB Clip","M|Molrep","C|Chainsaw","S|Sculptor","P|Polyalanine"],value:"M",showon:{_:"&&",seq:[1],xyz:[1]},position:[0,0,1,1]},LEGEND_SEQ_U:{type:"label",label:"<i>(models are not changed)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],xyz:[1],MODIFICATION_SEQ_SEL:["U"]}},LEGEND_SEQ_D:{type:"label",label:"<i>(remove solvent, hydrogens, and select most probable conformations)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],xyz:[1],MODIFICATION_SEQ_SEL:["D"]}},LEGEND_SEQ_M:{type:"label",label:"<i>(side chain truncation based on Molrep)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],xyz:[1],MODIFICATION_SEQ_SEL:["M"]}},LEGEND_SEQ_C:{type:"label",label:"<i>(side chain truncation based on Chainsaw)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],xyz:[1],MODIFICATION_SEQ_SEL:["C"]}},LEGEND_SEQ_S:{type:"label",label:"<i>(side chain truncation based on Sculptor)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],xyz:[1],MODIFICATION_SEQ_SEL:["S"]}},LEGEND_SEQ_P:{type:"label",label:"<i>(removal of all side chains)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],xyz:[1],MODIFICATION_SEQ_SEL:["P"]}},MODIFICATION_SEQ_MXYZ_SEL:{type:"combobox",keyword:"none",label:"Modification protocol:",tooltip:"Choose trim option",range:["U|Unmodified","D|PDB Clip","M|Molrep","P|Polyalanine"],value:"M",showon:{_:"&&",seq:[1]},hideon:{xyz:[1]},position:[0,0,1,1]},LEGEND_SEQ_MXYZ_U:{type:"label",label:"<i>(models are not changed)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],MODIFICATION_SEQ_MXYZ_SEL:["U"]},hideon:{xyz:[1]}},LEGEND_SEQ_MXYZ_D:{type:"label",label:"<i>(remove solvent, hydrogens, and select most probable conformations)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],MODIFICATION_SEQ_MXYZ_SEL:["D"]},hideon:{xyz:[1]}},LEGEND_SEQ_MXYZ_M:{type:"label",label:"<i>(side chain truncation based on Molrep)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],MODIFICATION_SEQ_MXYZ_SEL:["M"]},hideon:{xyz:[1]}},LEGEND_SEQ_MXYZ_P:{type:"label",label:"<i>(removal of all side chains)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[1],MODIFICATION_SEQ_MXYZ_SEL:["P"]},hideon:{xyz:[1]}},MODIFICATION_NOSEQ_SEL:{type:"combobox",keyword:"none",label:"Modification protocol:",tooltip:"Choose trim option",range:["U|Unmodified","D|PDB Clip","P|Polyalanine"],value:"D",hideon:{seq:[1]},position:[0,0,1,1]},LEGEND_NOSEQ_U:{type:"label",label:"<i>(models are not changed)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[0,-1],MODIFICATION_NOSEQ_SEL:["U"]}},LEGEND_NOSEQ_D:{type:"label",label:"<i>(remove solvent, hydrogens, and select most probable conformations)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[0,-1],MODIFICATION_NOSEQ_SEL:["D"]}},LEGEND_NOSEQ_P:{type:"label",label:"<i>(removal of all side chains)</i>",position:[0,3,1,1],showon:{_:"&&",seq:[0,-1],MODIFICATION_NOSEQ_SEL:["P"]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskEnsemblePrepXYZ.prototype.checkKeywords=function(e){return this.__check_keywords(e,["ensemble","ensembles","model","preparation","mr","molecular","replacement","coordinates"])},TaskEnsemblePrepXYZ.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskEnsemblePrepXYZ.prototype.constructor=TaskEnsemblePrepXYZ,TaskEnsemblePrepXYZ.prototype.icon=function(){return"task_ensembleprepxyz"},TaskEnsemblePrepXYZ.prototype.desc_title=function(){return"make MR ensembles from atomic coordinates and sequence"},TaskEnsemblePrepXYZ.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(path=require("path"),conf=require("../../js-server/server.configuration"),utils=require("../../js-server/server.utils"),TaskEnsemblePrepXYZ.prototype.cleanJobDir=function(e){__template.TaskTemplate.prototype.cleanJobDir.call(this,e);e=path.join(e,"search_a");utils.fileExists(e)&&(console.log(" +++ remove stray directory "+e+" from TaskEnsemblePrepXYZ job"),utils.removePath(e))},TaskEnsemblePrepXYZ.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.ensembleprepxyz",e,t,this.id]},module.exports.TaskEnsemblePrepXYZ=TaskEnsemblePrepXYZ):TaskEnsemblePrepXYZ.prototype.collectInput=function(e){e=TaskTemplate.prototype.collectInput.call(this,e);if(e.length<=0){for(var t=this.input_data.getData("seq"),i=this.input_data.getData("xyz"),o=0,n=0,s=0,a=!1,r=!1,l=!1,c=null,c=t&&0<t.length?(a=0<=t[0].subtype.indexOf("protein"),r=0<=t[0].subtype.indexOf("dna"),l=0<=t[0].subtype.indexOf("rna"),this.parameters.sec1.contains.MODIFICATION_SEQ_SEL.value):this.parameters.sec1.contains.MODIFICATION_NOSEQ_SEL.value,d=0;d<i.length;d++)0<=i[d].subtype.indexOf("protein")&&o++,0<=i[d].subtype.indexOf("dna")&&n++,0<=i[d].subtype.indexOf("rna")&&s++;t=[];["U","D"].indexOf(c)<0&&(0<n+s||r||l)&&t.push(this.invalidParamMessage("incompatible modification protocol",'making nucleic acid MR ensembles is possible only for "Unmodified" and<br>"PDB Clip" modification protocols')),a&&0<n+s||r&&0<o+s||l&&0<n+o||!a&&!r&&!l&&(0<o*s||0<o*n||0<n*s)?t.push(this.invalidParamMessage("component types (protein,dna,rna) are not compatible.","Make sure that all components of ensemble have the same type.")):(1<n||1<s)&&t.push(this.invalidParamMessage("nucleic acid ensembles with more than one molecule are not supported.","Please leave only one nucleic acid polymer in the list.")),0<t.length&&(e=t.join("|"))}return e};var __template=null,conf;function TaskEnsembler(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskEnsembler",this.name="ensemble preparation (models)",this.setOName("ensemble"),this.title="Prepare MR Ensemble from Models",this.input_dtypes=[{data_type:{DataModel:[]},label:"Models",tooltip:"Specify models to be assembled in ensemble.",inputId:"models",force:2,min:2,max:1e3}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{TRIM_LEVELS:{type:"string_",keyword:"trimlevels",label:"<b><i>Trim levels</i></b>",tooltip:'Comma-separated list of trim levels. For example, "100,80,60,40" (default) will generate untrimmed ensemble and ensembles with 100%, 80%, 60% and 40% best matching residues aligned. Only values higher than 10% are allowed.',iwidth:400,value:"",placeholder:"100,80,60,40",position:[0,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskEnsembler.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskEnsembler.prototype.constructor=TaskEnsembler,TaskEnsembler.prototype.icon=function(){return"task_ensembler"},TaskEnsembler.prototype.desc_title=function(){return"make MR ensembles from MR search models"},TaskEnsembler.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskEnsembler.prototype.checkKeywords=function(e){return this.__check_keywords(e,["ensemble","ensembles","model","preparation","mr","molecular","replacement","coordinates"])},__template?(conf=require("../../js-server/server.configuration"),TaskEnsembler.prototype.makeInputData=function(e,t){var i=this.input_data.data.models[0];this.input_data.data.seq=[i.sequence],__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskEnsembler.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.ensembler",e,t,this.id]},module.exports.TaskEnsembler=TaskEnsembler):TaskEnsembler.prototype.collectInput=function(e){for(var e=TaskTemplate.prototype.collectInput.call(this,e),t=this.input_data.getData("models"),i=t[0].sequence.dname,o=!0,n=1;n<t.length&&o;n++)o=t[n].sequence.dname==i;if(o||(e+="|<b>All models must be associated with the same sequence, but they are not.</b>"),0<this.parameters.sec1.contains.TRIM_LEVELS.value.length){var s=this.parameters.sec1.contains.TRIM_LEVELS.value.split(",");o=!0;for(var a,n=0;n<s.length&&o;n++)(o=isInteger(s[n]))&&(o=10<=(a=parseInt(s[n]))&&a<=100);o||(e+="|<b>Errors in trim levels list (must contain comma-separated integers between 10 and 100)</b>")}return e};var __template=null,conf;function TaskFacilityImport(){__template?(__template.TaskTemplate.call(this),this.state=__template.job_code.retired):(TaskTemplate.call(this),this.state=job_code.retired),this._type="TaskFacilityImport",this.name="facility import",this.oname="*",this.title="Facility Import",this.fasttrack=!0,this.inprogress=0,this.upload_files=[]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskFacilityImport.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskFacilityImport.prototype.constructor=TaskFacilityImport,TaskFacilityImport.prototype.icon=function(){return"task_fimport"},TaskFacilityImport.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskFacilityImport.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.import_task",e,t,this.id]},module.exports.TaskFacilityImport=TaskFacilityImport):(TaskFacilityImport.prototype.customDataClone=function(e,t){this.uname=""},TaskFacilityImport.prototype.makeInputPanel=function(e){var t,i=this.makeInputLayout();return this.state==job_code.new||this.state==job_code.running?(i.header.setLabel(" ",2,0,1,1),i.header.setLabel(" ",2,1,1,1),i.header.setLabel("<hr/>Use the file selection button below to select and transfer facility data to the Project (use multiple file selections and repeat uploads if necessary). When done, hit <b><i>Import</i></b> button to process files transferred.<hr/>",3,0,1,4).setFontSize("80%")):i.header.uname_inp.setValue(this.uname.replace(/<(?:.|\n)*?>/gm,"")),i.grid.setWidth("100%"),i.select_btn=i.grid.setButton("Select file(s)",image_path("open_file"),0,0,1,1).setNoWrap(),i.grid.setHorizontalAlignment(0,0,"center"),i.fileListTitle=i.grid.setLabel("<b><i>Uploaded</i></b>",1,0,1,1),i.fileListPanel=i.grid.setLabel("",2,0,1,1),this.setUploadedFiles(i,[]),t=this,i.select_btn.addOnClickListener(function(){new FacilityBrowser(i,t)}),t.inprogress&&window.setTimeout(function(){i.select_btn.click()},0),i},TaskFacilityImport.prototype.setUploadedFiles=function(e,t){for(var i=0;i<t.length;i++)this.upload_files.indexOf(t[i])<0&&this.upload_files.push(t[i]);if("fileListPanel"in e&&(e.fileListTitle.setVisible(0<this.upload_files.length),0<this.upload_files.length)){for(var o=this.upload_files[0],i=1;i<this.upload_files.length;i++)o+="<br>"+this.upload_files[i];e.fileListPanel.setText(o).show()}},TaskFacilityImport.prototype.runButtonName=function(){return"Import"});var __template=null,conf;function TaskFindMySequence(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskFindMySequence",this.name="findmysequence",this.setOName("findmysequence"),this.title="FindMySequence",this.input_dtypes=[{data_type:{DataRevision:["!protein","!phases"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{SELSTR:{type:"string_",keyword:"selstr",label:"Model fragment selection",tooltip:"Atom selection string in a format: chain X and resi 10:100",default:"all",iwidth:400,value:"",emitting:!0,position:[0,0,1,1]},UPID:{type:"string_",keyword:"codes",label:"UniProt proteome identifier",tooltip:"UPID of a proteome for querying sequences, which will be downloaded automatically from UniProt. By defaulkt program will use a database of PDB sequences.",iwidth:200,value:"",emitting:!0,position:[1,0,1,1]},TOPHITS:{type:"integer_",keyword:"tophits",default:3,range:[1,"*"],label:"Number of best sequence hits to show",tooltip:"Number of top hits",iwidth:20,value:"",emitting:!0,position:[2,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskFindMySequence.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskFindMySequence.prototype.constructor=TaskFindMySequence,TaskFindMySequence.prototype.icon=function(){return"task_findmysequence"},TaskFindMySequence.prototype.desc_title=function(){return"reconstructs sequence from phases"},TaskFindMySequence.prototype.platforms=function(){return"LMUW"},TaskFindMySequence.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskFindMySequence.prototype.checkKeywords=function(e){return this.__check_keywords(e,["findmysequence","sequence"])},__template?(conf=require("../../js-server/server.configuration"),TaskFindMySequence.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskFindMySequence.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.findmysequence",e,t,this.id]},module.exports.TaskFindMySequence=TaskFindMySequence):TaskFindMySequence.prototype.taskDescription=function(){return"Protein sequence identification based on a map and backbone model"};var __template=null,conf;function TaskFitLigand(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskFitLigand",this.name="fit ligand",this.setOName("fitligand"),this.title="Find and Fit Ligand with Coot",this.input_dtypes=[{data_type:{DataRevision:["phases"]},label:"Structure revision",inputId:"revision",customInput:"map-sel",version:4,min:1,max:1},{data_type:{DataLigand:[]},label:"Ligand data",inputId:"ligand",min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{NCLUST:{type:"integer",keyword:"--clusters",label:"Number of clusters to fit",tooltip:"Specify the number of clusters to fit between 1 and 50",range:[1,50],value:"10",default:"10",position:[0,0,1,1]},LEVEL_SEL:{type:"combobox",keyword:"LEVEL_SEL",label:"Search level:",tooltip:"Specify search level reference",iwidth:140,range:["sigma|sigma","absolute|absolute"],value:"sigma",position:[1,0,1,1]},SIGMA:{type:"real",keyword:"--sigma",label:"value",tooltip:"Specify map level for ligand search",range:[0,10],value:"2.0",default:"2.0",position:[1,4,1,1],label2:"&sigma;'s",showon:{LEVEL_SEL:["sigma"]}},ABSOLUTE:{type:"real",keyword:"--absolute",label:"value",tooltip:"Specify map level for ligand search",range:[0,10],value:"2.0",default:"2.0",position:[1,4,1,1],label2:"e/&Aring;<sup>3</sup>",showon:{LEVEL_SEL:["absolute"]}},FIT_FRACTION:{type:"real",keyword:"--fit-fraction",label:"Fit fraction",tooltip:"the minimum fraction of atoms in density allowed after fit (0-1)",range:[0,1],value:"0.75",default:"0.75",position:[2,0,1,1]},FLEXIBLE_CBX:{type:"checkbox",keyword:"--flexible",label:"Flexible fit",tooltip:"Check in order to use torsional conformation ligand search",iwidth:140,value:!0,position:[3,0,1,1]},SAMPLES:{type:"integer",keyword:"--samples",label:"number of samples",tooltip:"Specify the number of flexible conformation samples",range:[1,1e4],value:"30",default:"30",position:[3,2,1,4],showon:{FLEXIBLE_CBX:[!0]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskFitLigand.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskFitLigand.prototype.constructor=TaskFitLigand,TaskFitLigand.prototype.icon=function(){return"task_fitligand"},TaskFitLigand.prototype.desc_title=function(){return"auto-fits ligand in density (does not launch Coot graphics)"},TaskFitLigand.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskFitLigand.prototype.checkKeywords=function(e){return this.__check_keywords(e,["fit","ligand","fitligand"])},__template?(conf=require("../../js-server/server.configuration"),TaskFitLigand.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskFitLigand.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.fitligand",e,t,this.id]},module.exports.TaskFitLigand=TaskFitLigand):TaskFitLigand.prototype.hotButtons=function(){return[RefmacHotButton(),CootMBHotButton()]};var __template=null,conf;function TaskFitWaters(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskFitWaters",this.name="fit waters",this.setOName("fitwaters"),this.title="Find and Fit Waters with Coot",this.input_dtypes=[{data_type:{DataRevision:["phases"]},label:"Structure revision",inputId:"revision",customInput:"map-sel",version:4,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{SIGMA:{type:"real",keyword:"--sigma",label:"Map level, &sigma;",tooltip:"Specify map level for water search",range:[0,10],value:"2.0",default:"2.0",position:[0,0,1,1]},FLOOD_CBX:{type:"checkbox",keyword:"--flood",label:"Flood",tooltip:"Check in order to fill everything (not just the density peaks) with water",iwidth:140,value:!1,position:[1,0,1,1]},FLOOD_RADIUS:{type:"real",keyword:"--flood-atom-radius",label:"Water molecule radius [&Aring;]",tooltip:"Needs adjustment only if solvent is something else but water.",range:[.1,"*"],value:"1.4",default:"1.4",position:[1,2,1,1],showon:{FLOOD_CBX:[!0]}},MIN_DIST:{type:"real",keyword:"--min-dist",label:"Minimum distance to macromolecule [&Aring;]",tooltip:"The minimum distance to macromolecular surface water molecules should be found at.",range:[0,"*"],value:"0.0",default:"0.0",position:[2,0,1,1],showon:{FLOOD_CBX:[!1]}},MAX_DIST:{type:"real",keyword:"--max-dist",label:"Maximum distance to macromolecule [&Aring;]",tooltip:"The maximum distance to macromolecular surface water molecules should be found at.",range:[0,"*"],value:"50.0",default:"50.0",position:[3,0,1,1],showon:{FLOOD_CBX:[!1]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskFitWaters.prototype.checkKeywords=function(e){return this.__check_keywords(e,["fit","water","waters","fitwater","coot"])},TaskFitWaters.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskFitWaters.prototype.constructor=TaskFitWaters,TaskFitWaters.prototype.icon=function(){return"task_fitwaters"},TaskFitWaters.prototype.desc_title=function(){return"auto-fits water molecules in density (does not launch Coot graphics)"},TaskFitWaters.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskFitWaters.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskFitWaters.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.fitwaters",e,t,this.id]},module.exports.TaskFitWaters=TaskFitWaters):TaskFitWaters.prototype.hotButtons=function(){return[RefmacHotButton(),CootMBHotButton()]};var __template=null,conf;function TaskFragon(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskFragon",this.name="fragon",this.setOName("fragon"),this.title="Molecular Replacement with fragments -- Fragon",this.input_dtypes=[{data_type:{DataRevision:["hkl"]},label:"Structure revision",inputId:"revision",version:7,min:1,max:1},{data_type:{DataStructure:["protein"],DataModel:["protein"],DataXYZ:["protein"]},label:"Custom fragment",inputId:"fragment",min:0,max:1}],this.parameters={_fragments_lbl:{type:"label",label:"<b>Predefined fragments</b>",position:[0,0,1,3],showon:{fragment:[0,-1]}},FRAGMENTS_SEL:{type:"combobox",keyword:"fragments",label:"",lwidth:0,tooltip:"Type of fragments to be serached for",range:["helix|Ideal helix","ensemble-anti5|Ensemble of antiparallel 5-residue strands","ensemble-para5|Ensemble of parallel 5-residue strands","ensemble-s3|Ensemble of 3-residue strands","ensemble-s4|Ensemble of 4-residue strands","ensemble-s5|Ensemble of 5-residue strands"],value:"helix",iwidth:360,position:[0,1,1,1],showon:{fragment:[0,-1]}},fragments_sec:{type:"section",title:"",open:!0,position:[1,3,1,1],showon:{fragment:[0,-1]},contains:{HELIX_LEN:{type:"integer",keyword:"helix",label:"<i>helix length</i> :",tooltip:"Choose a value between 5 and 20",range:[5,20],value:10,iwidth:40,label2:"<i>residues</i>",position:[0,0,1,1],showon:{FRAGMENTS_SEL:["helix"]}},HELIX_COPIES:{type:"integer",keyword:"helix",label:"<i>N<sub>copies</sub></i> :",tooltip:"Choose a value between 1 and 10",range:[1,10],value:1,iwidth:40,position:[1,0,1,1],showon:{FRAGMENTS_SEL:["helix"]}},STRAND_TILT:{type:"combobox",keyword:"tilt",label:"<i>strand tilt</i> :",tooltip:"Strand tilt in degrees",range:["0|0","5|5","10|10","15|15","20|20","25|25","30|30"],value:"0",iwidth:90,label2:"<i>degrees</i>",position:[0,0,1,1],showon:{FRAGMENTS_SEL:["ensemble-anti5","ensemble-para5"]}},STRAND_COPIES:{type:"integer",keyword:"helix",label:"<i>N<sub>copies</sub></i> :",tooltip:"Choose a value between 1 and 10",range:[1,10],value:1,iwidth:32,position:[2,0,1,1],hideon:{FRAGMENTS_SEL:["helix"]}}}},sec1:{type:"section",title:"Basic options",open:!1,position:[2,0,1,5],contains:{NSOLUTIONS:{type:"integer",keyword:"helix",label:"Maximum number of solutions to test",tooltip:"Choose a value between 4 and 200",range:[4,200],value:10,iwidth:50,label2:"&nbsp;&nbsp;&nbsp;",position:[0,0,1,1]},TESTALL_CBX:{type:"checkbox",label:"Test all solutions",tooltip:"Check for testing all candidate solutions",value:!1,iwidth:160,position:[0,5,1,1]},ACORN_CC:{type:"real",keyword:"ACORNCC",label:"Stop <b>when</b> ACORN CC is above",align:"right",reportas:"Acorn CC threshold",tooltip:"The default value (0.3) is unlikely to need changing",range:[1e-5,.99999],value:.3,iwidth:50,label2:"&nbsp;&nbsp;&nbsp;",position:[1,0,1,1]},ACORN_DCC:{type:"real",keyword:"ACORNDCC",label:"<b>or</b> the difference between best<br>and worst CC is above",align:"right",reportas:"Acorn CC difference threshold",tooltip:"The default value (0.15) is unlikely to need changing",range:[1e-5,.99999],value:.15,iwidth:50,position:[2,0,1,1]}}},sec2:{type:"section",title:"Advanced options",open:!1,position:[3,0,1,5],contains:{LIMITRF_CBX:{type:"checkbox",label:"Limit the number of rotation functions in multi-copy search",tooltip:"Turning this off may lead to much increased run time",value:!0,iwidth:460,position:[0,0,1,4]},MAXNRF:{type:"integer",keyword:"maxnrf",label:"Maximum number of RFs",tooltip:"Default number works well",range:[10,500],value:100,iwidth:50,position:[1,0,1,1],showon:{LIMITRF_CBX:[!0]}},TNCS_CBX:{type:"checkbox",label:"Turn off all tNCS corrections",tooltip:"May be necessary in some cases",value:!1,iwidth:240,position:[2,0,1,4]},RBREFINE_SEL:{type:"combobox",keyword:"RBREFINE",label:"Rigid body refine mode",tooltip:"Try default first as the other options increase the run time",range:["T|Both strands together","S|Each strand separately","H|Both halves of strand separately"],value:"T",iwidth:290,position:[3,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskFragon.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskFragon.prototype.constructor=TaskFragon,TaskFragon.prototype.icon=function(){return"task_fragon"},TaskFragon.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskFragon.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskFragon.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.fragon",e,t,this.id]},module.exports.TaskFragon=TaskFragon):TaskFragon.prototype.desc_title=function(){return"uses fragments of secondary structure such as ideal alpha helices or ensembles of beta strands as model for MR "};var __template=null,conf;function TaskFreeRFlag(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskFreeRFlag",this.name="free R-flag",this.setOName("freerflag"),this.title="Free R-flag (transfer or (re-)generate)",this.input_dtypes=[{data_type:{DataHKL:[]},label:"Free R-flag",inputId:"freer",cast:"free R-flag",version:1,min:0,max:1},{data_type:{DataHKL:[]},label:"Reflections",inputId:"hkl",version:0,min:1,max:200},{data_type:{DataRevision:[]},label:"Structure revision",inputId:"revision",version:0,min:0,max:0}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{FREERFRAC:{type:"real_",keyword:"FREERFRAC",label:"Fraction of reflections in freeR set",tooltip:"Choose a value less than 1",range:[.001,.999],value:"",default:"0.05",position:[0,0,1,1],showon:{freer:[-1,0]}},SEED_CBX:{type:"checkbox",keyword:"SEED",label:"Use random seed",tooltip:"Check to randomise the freeR seed",value:!0,position:[1,0,1,2]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskFreeRFlag.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskFreeRFlag.prototype.constructor=TaskFreeRFlag,TaskFreeRFlag.prototype.icon=function(){return"task_freerflag"},TaskFreeRFlag.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskFreeRFlag.prototype.checkKeywords=function(e){return this.__check_keywords(e,["freerflag","free","flag","r-flag"])},__template?(conf=require("../../js-server/server.configuration"),TaskFreeRFlag.prototype.makeInputData=function(e,t){var i;"freer"in this.input_data.data&&((i=this.input_data.data.freer[0]).freeRds&&(this.input_data.data.freer0=[i.freeRds])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskFreeRFlag.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.freerflag",e,t,this.id]},module.exports.TaskFreeRFlag=TaskFreeRFlag):(TaskFreeRFlag.prototype.desc_title=function(){return"tags each reflection in an MTZ file with a flag for cross-validation"},TaskFreeRFlag.prototype.inputChanged=function(e,t,i){function o(e,t){return e.split(" (")[0]+" ("+t+")"}var n,s;"freer"==t&&(s=e.grid.inpDataRef,s=this.getDataState(s).freer,n=this.name,s<=0?(this.title=o(this.title,"Regenerate"),this.name=o(this.name,"regenerate")):(this.title=o(this.title,"Extend"),this.name=o(this.name,"extend")),this.name!=n&&((s=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),s.header.uname_inp.setStyle("text","",this.name.replace(/<(?:.|\n)*?>/gm,"")),this.updateInputPanel(s),s.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node))),TaskTemplate.prototype.inputChanged.call(this,e,t,i)},TaskFreeRFlag.prototype.addDataDialogHints=function(e,t){return t.hints.push('Why <i>"Structure Revision"</i> is not allowed? This means that the task can be used only before a <i>"Structure Revision"</i> is created. If you are past this point in your Project, you may have to start, with this task, a new branch in your Project after data import or data processing.'),t});var __template=null,conf;function TaskGemmi(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskGemmi",this.name="gemmi tools",this.oname="gemmi",this.title="Gemmi terminal",this.nc_type="client",this.input_dtypes=[{data_type:{DataRevision:["xyz","substructure"],DataStructure:["xyz","substructure"],DataEnsemble:[],DataModel:[],DataXYZ:[]},label:"Structure data",inputId:"istruct",version:1,min:1,max:20}],this.parameters={TITLE:{type:"label",keyword:"none",label:'<hr><b style="font-size:1.125em;">Gemmi script</b>',position:[0,0,1,3]},MANUAL:{type:"label",keyword:"none",label:'&nbsp;<br><div style="font-size:14px;"><a href="https://gemmi.readthedocs.io/en/latest/" target="_blank"><i>gemmi reference</i></a> (opens in new window)</div>',position:[0,1,1,1]},SCRIPT:{type:"aceditor_",keyword:"none",tooltip:"",iwidth:800,iheight:320,value:'"""\n Place a python script here, assuming that:\n  - modules gemmi and math are imported\n  - structure data number N is read in gemmi documents "stN"\n  - document "st1" will be saved automatically as the corresponding input\n    data object (structure revision, structure, ensemble, model or xyz)\n\n For example, removal of all ligands, waters and empty chains requires just\n the following 2 lines:\n\nst1.remove_ligands_and_waters()\nst1.remove_empty_chains()\n"""\n',position:[1,0,1,5]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskGemmi.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskGemmi.prototype.constructor=TaskGemmi,TaskGemmi.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskGemmi.prototype.icon=function(){return"task_gemmi"},TaskGemmi.prototype.desc_title=function(){return"exposes python terminal to user for performing very custom operations on coordinate data"},TaskGemmi.prototype.checkKeywords=function(e){return this.__check_keywords(e,["gemmi","command","line","tool","tools","utilities"])},__template&&(conf=require("../../js-server/server.configuration"),TaskGemmi.prototype.makeInputData=function(e,t){var i=this.input_data.data.istruct;this.input_data.data.hkl=[],this.input_data.data.ist=[];for(var o=0;o<i.length;o++)"DataRevision"==i[o]._type&&(this.input_data.data.hkl.push(i[o].HKL),i[o].Structure&&this.input_data.data.ist.push(i[o].Structure),i[o].Substructure&&this.input_data.data.ist.push(i[o].Substructure));__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskGemmi.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.gemmi_task",e,t,this.id]},module.exports.TaskGemmi=TaskGemmi);var __template=null,conf;function TaskGesamt(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskGesamt",this.name="gesamt",this.oname="gesamt",this.setOName("gesamt"),this.title="Structure Alignment and Superposition with Gesamt",this.input_dtypes=[{data_type:{DataStructure:["protein"],DataEnsemble:["protein"],DataModel:["protein"],DataXYZ:["protein"]},label:"Structure",inputId:"xyz",customInput:"chain-sel-protein",force:2,min:1,max:10}],this.parameters={sec1:{type:"section",title:"Parameters",open:!1,position:[0,0,1,5],contains:{TITLE1:{type:"label",label:"<h3>PDB scanning parameters</h3>",position:[0,0,1,4],showon:{xyz:[1]}},MIN1:{type:"real",keyword:"MIN1",label:"Report hits where at least",tooltip:"Sets the minimum fraction of given structure that should be mapped on a PDB structure (0.7 by default). The lower the threshold, the higher number of hits is reported.",range:[0,1],value:"0.7",label2:"of all residues of given structure",position:[1,0,1,1],showon:{xyz:[1]}},MIN2:{type:"real",keyword:"MIN2",label:"is mapped on at least&nbsp;",align:"right",tooltip:"Sets the minimum fraction of PDB structure that should be mapped on given structure (0.7 by default). The lower the threshold, the higher number of hits is reported.",range:[0,1],value:"0.7",label2:"of all residues of matched PDB structure",position:[2,0,1,1],showon:{xyz:[1]}},QSCORE:{type:"real",keyword:"QSCORE",label:"Minimum Q-score to report",tooltip:"Sets the minimum Q-score (0.1 by default) to consider worth of reporting. Hits with lower Q-score are merely ignored. Q-score ranges from 0 (no alignment) to 1 (identical structures).",range:[0,1],value:"0.1",position:[3,0,1,1],showon:{xyz:[1]}},MAXHITS:{type:"integer",keyword:"MAXHITS",label:"Maximum number of hits to report",tooltip:"Sets the maximum nuber of hits to report (1000 by default). Use this parameter responsibly as excessive number of hits is usually not infomative but can slow down your computer significantly",range:[10,1e4],value:"1000",position:[4,0,1,1],showon:{xyz:[1]}},TITLE2:{type:"label",label:"<h3>Alignment parameters</h3>",position:[5,0,1,4]},MODE:{type:"combobox",keyword:"MODE",label:"Alignment mode",tooltip:'"Balanced" mode provides a reasonable balance between alignment quality and efficiency, while "Quality" mode achieves extra alignment quality at the expense of significantly higher CPU time',range:["-normal|Balance quality and efficiency","-high|Prefer higher aligment quality"],value:"-normal",position:[6,0,1,3]},R0:{type:"real_",keyword:"R0",label:"Q-score balancing (R<sub>0</sub> [&Aring;])",tooltip:"sets R0 parameter of Q-score (default is 3 angstrom). This parameter balances the alignment length (the number of aligned residue pairs) and r.m.s.d. The higher R0, the longer alignments are produced.",range:[.01,10],value:"",position:[7,0,1,1]},SIGMA:{type:"real_",keyword:"SIGMA",label:"Weighting parameter &sigma; [&Aring;]",tooltip:"sets Sigma parameter (in angstrom) used for weighted superposition. The lower Sigma, the more the superposition algorithm is focused on short atom contacts. If Sigma is not set, weighted superposition is not used.",range:[.01,10],value:"",position:[8,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskGesamt.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskGesamt.prototype.constructor=TaskGesamt,TaskGesamt.prototype.icon=function(){return"task_gesamt"},TaskGesamt.prototype.desc_title=function(){return"automatic, pairwise/multiple, structure alignment/superposition and PDB searches"},TaskGesamt.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskGesamt.prototype.checkKeywords=function(e){return this.__check_keywords(e,["gesamt","structural","alignment","pairwise","toolbox","comparison","multiple","pdb","scan"])},__template?(conf=require("../../js-server/server.configuration"),TaskGesamt.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.gesamt",e,t,this.id]},module.exports.TaskGesamt=TaskGesamt):(TaskGesamt.prototype.inputChanged=function(e,t,i){TaskTemplate.prototype.inputChanged.call(this,e,t,i),"xyz"==t&&this.state==job_code.new&&(i<2?(this.name="gesamt (scan)",this.title="PDB Scanning with GESAMT"):2==i?(this.name="gesamt (pairwise)",this.title="Pairwise Structural Alignment with GESAMT"):2<i&&(this.name="gesamt (multiple)",this.title="Multiple Structural Alignment with GESAMT"),(t=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),this.updateInputPanel(t))},TaskGesamt.prototype.updateInputPanel=function(e){var t;this.state==job_code.new&&(t=new CustomEvent(cofe_signals.jobDlgSignal,{detail:job_dialog_reason.rename_node}),e.element.dispatchEvent(t))});var __template=null,conf;function TaskImport(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskImport",this.name="file import",this.oname="*",this.title="File(s) Upload and Import",this.fasttrack=!0,this.file_mod={rename:{},annotation:[]},this.upload_files=[],this.input_dtypes=[{data_type:{DataRevision:[]},label:"",inputId:"void1",version:0,force:1e3,min:0,max:1e3}]}function _import_renameFile(e,t){for(var i=e,o=0;0<=t.indexOf(i);){o++;var n=e.split("."),i=1<n.length?(n.push(n[n.length-1]),n[n.length-2]="n"+padDigits(o,3),n.join(".")):e+".n"+padDigits(o,3)}return i}function _import_renameFile1(e,t){var i=e,o=-1,n=e.split("."),e="";1<n.length&&(e="."+n.pop());do{o++,i=n.join("."),0<o&&(i+=".n"+padDigits(o,3));for(var s=!1,a=0;a<t.length&&!s;a++)s=startsWith(t[a],i)}while(s);return e&&(i+=e),i}function _check_sequence(e,t,i,o,n,s){for(var a=e[n].name,r=_import_renameFile1(a,t),l=1,c={file:a,rename:r,items:[]},d=i.split(/\r\n|\r|\n/),h=0;h<d.length;h++)d[h]=d[h].trim(),">"==d[h]&&(d[h]=">no name");for(var u,p,m=d.join("\n").split(">"),h=0;h<m.length;h++)m[h].replace(/\s/g,"")&&(u=r,2<m.length&&((p=u.split(".")).push(p[p.length-1]),p[p.length-2]="s"+padDigits(l++,3),u=p.join(".")),c.items.push({rename:u,contents:">"+m[h].trim(),type:"none"}));o.annotation.push(c),_import_scanFiles(e,n+1,o,t,s)}function _import_scanFiles(t,e,i,o,n){if(e>=t.length)n(i);else{for(var s=e,a=!1;!a&&s<t.length;){var r=t[s].name.split("."),l=("txt"==r[r.length-1].toLowerCase()&&r.pop(),r.pop().toLowerCase());(a=0<r.length&&0<=["seq","fasta","pir"].indexOf(l))||((r=_import_renameFile(t[s].name,o))!=t[s].name&&(i.rename[t[s].name]=r),"sca"==l&&("scalepack"in i||(i.scalepack={}),i.scalepack[r]={wavelength:""}),s++)}a?"_type"in t[s]?_check_sequence(t,o,t[s].contents,i,s,n):((e=new FileReader).onload=function(e){_check_sequence(t,o,e.target.result,i,s,n)},e.readAsText(t[s])):n(i)}}function _import_checkFiles(e,t,i,o){for(var n=[],s="",a=0;a<e.length;a++){var r=e[a].name.toLowerCase();endsWith(r,".ccp4_demo")||endsWith(r,".ccp4cloud")||endsWith(r,".zip")?s+="<li><b>"+e[a].name+"</b></li>":n.push(e[a])}if(0<s.length&&new MessageBox("File(s) not importable","Archive file(s) <ul>"+s+"</ul> cannot be imported as data files and will be ignored.<p>If you try to import "+appName()+" projects, do this from<br><i>Project List</i> page."),0<n.length){t.rename={};for(var l=[],a=0;a<i.length;a++)l.push(getBasename(i[a]));_import_scanFiles(n,0,t,l,function(e){var t=e.annotation.length;"scalepack"in e&&!jQuery.isEmptyObject(e.scalepack)||0<t&&"none"==e.annotation[t-1].items[0].type?new ImportAnnotationDialog(e,o):o()})}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskImport.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskImport.prototype.constructor=TaskImport,TaskImport.prototype.desc_title=function(){return"upload and import various files from your device into the Project"},TaskImport.prototype.taskDescription=function(){return"Upload and import various files from your device into the Project"},TaskImport.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskImport.prototype.checkKeywords=function(e){return this.__check_keywords(e,["import","data"])},__template?(TaskImport.prototype.icon=function(){return this.state==__template.job_code.remdoc?"task_remdoc":"task_import"},conf=require("../../js-server/server.configuration"),TaskImport.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.import_task",e,t,this.id]},module.exports.TaskImport=TaskImport):(TaskImport.prototype.hotButtons=function(){return[AsuDefHotButton()]},TaskImport.prototype.customDataClone=function(e,t){this.uname="",this.file_mod={rename:{},annotation:[]},this.upload_files=[]},TaskImport.prototype.icon=function(){return this.state==job_code.remdoc?"task_remdoc":"task_import"},TaskImport.prototype.onJobDialogStart=function(e){},TaskImport.prototype.onJobDialogClose=function(e,t){0<this.upload_files.length&&this.state==job_code.new?new QuestionBox("Import not finished","<h3>Import not finished</h3>You have uploaded data files, however the import<br>is not finished yet: the files need to be processed<br>before they can be used in subsequent tasks.",[{name:"Finish now",onclick:function(){e.run_btn.click(),t(!1)}},{name:"Finish later",onclick:function(){t(!0)}}],"msg_question"):t(!0)},TaskImport.prototype.makeInputPanel=function(e){var i,t,o=this.makeInputLayout(),e=(this.setInputDataFields(o.grid,0,e,this),""),n=("void1"in this.input_data.data&&0<this.input_data.data.void1.length&&(e='<span style="font-size:16px;"><b>Are you trying to <u>replace</u> data in current structure?</b> Use <b><i>Import & replace</i></b> task instead or run <b><i>Edit Structure Revision</i></b> task after import. This task only adds data to the Project.</span><br>&nbsp;<br>'),o.grid.getNRows());return o.grid.setLabel(e+"Use the file selection button below to select and upload data files to the Project (use multiple file selections and repeat uploads if necessary). When done, hit <b><i>Import</i></b> button to process files uploaded.<br>&nbsp;",n,0,1,1).setFontSize("80%"),o.grid.setWidth("100%"),o.customData={},o.customData.login_token=__login_token,o.customData.project=this.project,o.customData.job_id=this.id,o.customData.file_mod=this.file_mod,t=this,(i=o).upload=new Upload(i.customData,{type:"project_data",accept:".pdb,.ent,.seq,.fasta,.pir,.mtz,.sca,.cif,.mmcif,.doc,.docx,.pdf,.txt,.jpg,.jpeg,.gif,.png,.html,.htm,.hkl,.hhr,.borges",gzip:!0},function(e,t){0<e.target.files.length&&_import_checkFiles(e.target.files,o.customData.file_mod,i.upload.upload_files,t)},null,function(e){e||t.sendInputStateEvent(i),0<i.upload.new_files.length&&__user_settings.guided_import&&(i.upload.button.setText("Upload more files"),e="",0<i.upload.ignored_list.length&&(e="<h3>Files ignored:</h3><ul><li>"+i.upload.ignored_list.join("</li><li>")+"</li></ul>"),new QuestionBox("Files uploaded","<h3>Files uploaded:</h3><ul><li>"+i.upload.new_files.join("</li><li>")+"</li></ul>"+e,[{name:"Upload more files",onclick:function(){i.upload.button.click()}},{name:"Finish import",onclick:function(){i.job_dialog.run_btn.click()}},{name:"Close"}],"msg_question"))}),i.upload.addSignalHandler(cofe_signals.uploadEvent,function(e){t.sendTaskStateSignal(i,e)}),o.upload.setUploadedFiles(this.upload_files),this.upload_files.length<=0?this.sendTaskStateSignal(o,"hide_run_button"):o.upload.button.setText("Upload more files"),o.grid.setWidget(o.upload,n+1,0,1,1),o.panel.setScrollable("hidden","hidden"),o},TaskImport.prototype.disableInputWidgets=function(e,t){TaskTemplate.prototype.disableInputWidgets.call(this,e,t),e.hasOwnProperty("upload")&&(e.upload.button.setDisabled(t),e.upload.link_button&&e.upload.link_button.setDisabled(t),e.upload.pdb_button&&e.upload.pdb_button.setDisabled(t))},TaskImport.prototype.collectInput=function(e){return TaskTemplate.prototype.collectInput.call(this,e),this.upload_files=e.upload.upload_files,this.file_mod=e.customData.file_mod,0<this.upload_files.length?"":"<b><i>No file(s) have been uploaded</i></b>"},TaskImport.prototype.runButtonName=function(){return"Import"});var __template=null,conf;function TaskImportPDB(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskImportPDB",this.name="import from PDB/AFDB",this.oname="*",this.title="Import from PDB/AFDB",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataRevision:[]},label:"",inputId:"void1",version:0,force:1e8,min:0,max:1e8}],this.parameters={CODES:{type:"string",keyword:"codes",label:"<i><b>PDB/UniProt code(s)</b></i>",tooltip:"Comma-separated list of PDB and/or UniProt codes to import data from",iwidth:680,value:"",emitting:!0,position:[0,0,1,4]},SEPARATOR_LBL:{type:"label",label:"&nbsp;",position:[1,0,1,1]},IMPORT_LBL:{type:"label",label:"<i><b>Import data:</b></i>",align:"right",position:[2,0,1,1],hideon:{CODES:[""]}},COORDINATES_CBX:{type:"checkbox",label:"coordinates",tooltip:"Check for importing coordinates.",value:!0,iwidth:130,position:[2,2,1,1],hideon:{CODES:[""]}},SEQUENCES_CBX:{type:"checkbox",label:"sequences",tooltip:"Check for importing sequences.",value:!1,iwidth:130,position:[2,3,1,1],hideon:{CODES:[""]}},REFLECTIONS_CBX:{type:"checkbox",label:"reflection data",tooltip:"Check for importing reflection data.",value:!1,iwidth:130,position:[2,4,1,1],hideon:{CODES:[""]}},REVISION_CBX:{type:"checkbox",label:"structure revision",tooltip:"Check for making structure revision(s).",value:!1,iwidth:150,position:[2,5,1,1],hideon:{_:"||",CODES:[""],COORDINATES_CBX:[!1],SEQUENCES_CBX:[!1],REFLECTIONS_CBX:[!1]}},SPRING_LBL:{type:"label",label:" ",position:[3,5,1,1],lwidth:150},ROW_BREAK1:{type:"label",label:"&nbsp;",position:[4,0,1,1]},PDB_LBL:{type:"label",label:"<i>wwPDB:</i>",align:"right",position:[5,0,1,1]},PDB_LINK:{type:"label",label:'<a href="https://www.wwpdb.org" target="_blank"><span style="color:blue;">https://www.wwpdb.org</span></a>',position:[5,2,1,1]},UNIPROT_LBL:{type:"label",label:"<i>UniProt:</i>",align:"right",position:[6,0,1,1]},UNIPROT_LINK:{type:"label",label:'<a href="https://www.uniprot.org" target="_blank"><span style="color:blue;">https://www.uniprot.org</span></a>',position:[6,2,1,1]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskImportPDB.prototype.checkKeywords=function(e){return this.__check_keywords(e,["import","data","pdb"])},TaskImportPDB.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskImportPDB.prototype.constructor=TaskImportPDB,TaskImportPDB.prototype.icon=function(){return"task_importpdbafdb"},TaskImportPDB.prototype.desc_title=function(){return"fetch coordinates, sequences and reflection data for given PDB/UniProt code(s)"},TaskImportPDB.prototype.taskDescription=function(){return"Fetch coordinates, sequences and reflection data for given PDB/UniProt code(s)"},TaskImportPDB.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskImportPDB.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.import_task",e,t,this.id]},module.exports.TaskImportPDB=TaskImportPDB):(TaskImportPDB.prototype.customDataClone=function(e,t){this.uname=""},TaskImportPDB.prototype.runButtonName=function(){return"Import"},TaskImportPDB.prototype.collectInput=function(e){return TaskTemplate.prototype.collectInput.call(this,e),this.parameters.CODES.value.trim().length<4?"<b>At least one PDB code must be specified</b>":this.parameters.COORDINATES_CBX.value||this.parameters.SEQUENCES_CBX.value||this.parameters.REFLECTIONS_CBX.value?"":'<b>At least one of "coordinates", "sequences" or "reflection data" must be requested</b>'});var __template=null,conf;function TaskImportSeqCP(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskImportSeqCP",this.name="import sequence",this.oname="sequence",this.title="Import Sequence(s) by Copy-Paste",this.parameters={SEQTYPE_SEL:{type:"combobox",label:"<b>Sequence type:</b>",tooltip:"Choose sequnce type",range:["none|[must be chosen]","protein|Protein","dna|DNA","rna|RNA"],value:"none",label2:" ",lwidth2:700,position:[0,0,1,1]},SEQUENCE_TA:{type:"aceditor_",tooltip:"",reportas:"Sequence(s)",value:"",placeholder:"# Copy-paste your sequence(s) here, including title line(s).\n\n# Several sequences of the same type (protein/dna/na) can be\n# given one after another. Example:\n\n>rnase_A\nDVSGTVCLSALPPEATDTLNLIASDGPFPYSQDGVVFQNRESVLPTQSYGYYHEYTVITPGARTRGTRRIICGE\nATQEDYYTGDHYATFSLIDQTC\n\n>1dtx_A\nQPRRKLCILHRNPGRCYDKIPAFYYNQKKKQCERFDWSGCGGNSNRFKTIEECRRTCIG",iwidth:700,iheight:240,position:[1,0,1,6]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskImportSeqCP.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskImportSeqCP.prototype.constructor=TaskImportSeqCP,TaskImportSeqCP.prototype.icon=function(){return"task_importseqcp"},TaskImportSeqCP.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskImportSeqCP.prototype.checkKeywords=function(e){return this.__check_keywords(e,["import","sequence","copy","paste","copypaste","copy-paste"])},__template?(conf=require("../../js-server/server.configuration"),TaskImportSeqCP.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.import_task",e,t,this.id]},module.exports.TaskImportSeqCP=TaskImportSeqCP):(TaskImportSeqCP.prototype.desc_title=function(){return"imports sequence copy-pasted from other web pages"},TaskImportSeqCP.prototype.customDataClone=function(e,t){this.uname=""},TaskImportSeqCP.prototype.collectInput=function(e){var e=TaskTemplate.prototype.collectInput.call(this,e),t=[];"none"==this.parameters.SEQTYPE_SEL.value&&t.push("Sequence type must be chosen");for(var i=(o=this.parameters.SEQUENCE_TA.value.trim()).split(/\r?\n/),o="",n=0;n<i.length;n++){var s=i[n].indexOf("#");o+=0<=s?i[n].substring(0,s):"\n"+i[n]}return(o=o.trim())?startsWith(o,">")||t.push("Sequence data format is not valid"):t.push("Sequence data is not given"),0<t.length&&(e+="|<b>"+t.join("</b><br><b>")+"</b>"),e});var __template=null,conf;function TaskIMosflm(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskIMosflm",this.name="iMosflm (image processing)",this.setOName("imosflm"),this.title="Interactive Image Processing with iMosflm",this.nc_type="client",this.input_dtypes=[],this.parameters={L1:{type:"label",label:"<h3>This task will launch iMosflm on your computer.</h3>",position:[0,0,1,1]},L2:{type:"label",label:"When iMosflm session is finished (Session &gt; Exit or main window closed):<br><ul><li>unmerged data files stored in the default location will be imported</li><li>unmerged data files stored in a custom location will NOT be imported</li><li>merged data files generated by Quick Scale will NOT be imported<br></li></ul>",position:[1,0,1,1]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskIMosflm.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskIMosflm.prototype.constructor=TaskIMosflm,TaskIMosflm.prototype.icon=function(){return"task_imosflm"},TaskIMosflm.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},TaskIMosflm.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskIMosflm.prototype.checkKeywords=function(e){return this.__check_keywords(e,["imosflm","image","processing","interactive","images"])},__template?(conf=require("../../js-server/server.configuration"),TaskIMosflm.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.imosflm",e,t,this.id]},module.exports.TaskIMosflm=TaskIMosflm):(TaskIMosflm.prototype.desc_title=function(){return"process diffraction data"},TaskIMosflm.prototype.onJobDialogStart=function(e){e.run_btn.click()});var __template=null,conf;function TaskJLigand(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskJLigand",this.name="jligand (ligands and links)",this.oname="jligand",this.title="Make Ligand and Covalent Links with jLigand",this.nc_type="client",this.input_dtypes=[{data_type:{DataRevision:[]},label:"",inputId:"revision",version:0,force:1,min:0,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskJLigand.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskJLigand.prototype.constructor=TaskJLigand,TaskJLigand.prototype.icon=function(){return"task_jligand"},TaskJLigand.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},TaskJLigand.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskJLigand.prototype.desc_title=function(){return"generates new ligand entries"},TaskJLigand.prototype.checkKeywords=function(e){return this.__check_keywords(e,["jligand","ligand","ligands"])},__template&&(conf=require("../../js-server/server.configuration"),TaskJLigand.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskJLigand.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.jligand",e,t,this.id]},module.exports.TaskJLigand=TaskJLigand);var __template=null,conf;function TaskLorestr(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskLorestr",this.name="lorestr",this.setOName("lorestr"),this.title="Low-Resolution Refinement with Lorestr",this.input_dtypes=[{data_type:{DataRevision:["xyz"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1},{data_type:{DataXYZ:[],DataStructure:[]},desc:"reference structure",label:"Reference structure",inputId:"rstruct",min:0,max:10}],this.parameters={sec1:{type:"section",title:"Basic options",open:!0,position:[0,0,1,5],contains:{AUTO:{type:"combobox",keyword:"none",label:"Use following databases to search for homologues",tooltip:"Select databases to search for homologous structures",range:["all|PDB and AlphaFold","pdb|PDB only","af|AlphaFold only","none|Do not search"],value:"all",position:[0,0,1,4]},MINRES:{type:"real_",keyword:"none",label:"Minimum resolution for PDB structural homologues",tooltip:"Minimum resolution for PDB structural homologues",range:[.1,"*"],value:"",showon:{AUTO:["all","pdb"]},position:[1,0,1,1]},OVB_CBX:{type:"checkbox",label:"Refine overall B-factors (for very low resolution)",tooltip:"Force overall B-factors refinement (for very low resolution)",value:!1,position:[2,0,1,4]},DNA_CBX:{type:"checkbox",label:"Generate restraints for DNA/RNA chains",tooltip:"Generate restraints for DNA/RNA chains",value:!1,position:[3,0,1,4]},MR_CBX:{type:"checkbox",label:"Run pre-refinement (after MR only)",tooltip:"Run pre-refinement (after MR only)",value:!1,position:[4,0,1,4]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskLorestr.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskLorestr.prototype.constructor=TaskLorestr,TaskLorestr.prototype.icon=function(){return"task_lorestr"},TaskLorestr.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskLorestr.prototype.desc_title=function(){return"performs low resolution (lower than around 3 ) refinement"},TaskLorestr.prototype.checkKeywords=function(e){return this.__check_keywords(e,["lorestr","low","resolution","refinement","lr"])},__template&&(conf=require("../../js-server/server.configuration"),TaskLorestr.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskLorestr.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.lorestr",e,t,this.id]},module.exports.TaskLorestr=TaskLorestr);var __template=null,conf;function TaskLsqKab(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskLsqKab",this.name="lsqkab",this.setOName("lsqkab"),this.title="Structure Superposition with LsqKab",this.maxFitParamRows=10,this.input_dtypes=[{data_type:{DataStructure:[],DataXYZ:[]},label:"Moving structure",inputId:"moving_xyz",min:1,max:1},{data_type:{DataStructure:[],DataXYZ:[]},label:"Fixed structure",inputId:"fixed_xyz",min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{SELECT_LBL:{type:"label",label:"<b><i>Atom selection</i></b>",align:"center",position:[0,2,1,1]},FROM_LBL:{type:"label",label:"<b><i>from</i></b>",align:"center",position:[0,5,1,1]},TO_LBL:{type:"label",label:"<b><i>to</i></b>",align:"center",position:[0,6,1,1]},CHAIN_LBL:{type:"label",label:"<b><i>Chain</i></b>",align:"center",position:[0,7,1,1]}}}};for(var e=0;e<this.maxFitParamRows;e++)this.makeFitParamRow(e);this.parameters.sec1.contains.SPHERE_SEC={type:"section",title:"",open:!0,position:[1+2*this.maxFitParamRows,0,1,15]},this.parameters.sec1.contains.SPHERE_SEC.contains={SPHERE_CBX:{type:"checkbox",label:"Only fit in sphere",tooltip:"Restrict fitted atoms by sphere",iwidth:200,value:!1,position:[0,0,1,3]},RADIUS:{type:"real",keyword:"RADIUS",label:"of radius",reportas:"sphere radius",align:"right",tooltip:"Sphere radius, &Aring;",range:[0,"*"],iwidth:60,value:"",position:[1,0,1,1],showon:{SPHERE_CBX:[!0]}},CENTER_SEL:{type:"combobox",keyword:"CENTER",label:"centered on",tooltip:"Sphere center reference",iwidth:250,range:["F|centre of fixed molecule","C|coordinates"],value:"F",position:[2,0,1,1],showon:{SPHERE_CBX:[!0]}},CENTER_X:{type:"real",keyword:"CENTER_X",label:"&nbsp;&nbsp;x:",align:"right",reportas:"sphere center - x",tooltip:"Sphere x-center, &Aring;",range:["*","*"],iwidth:60,value:"",position:[2,4,1,1],showon:{_:"&&",SPHERE_CBX:[!0],CENTER_SEL:["C"]}},CENTER_Y:{type:"real",keyword:"CENTER_Y",label:"&nbsp;&nbsp;y:",align:"right",reportas:"sphere center - y",tooltip:"Sphere y-center, &Aring;",range:["*","*"],iwidth:60,value:"",position:[2,7,1,1],showon:{_:"&&",SPHERE_CBX:[!0],CENTER_SEL:["C"]}},CENTER_Z:{type:"real",keyword:"CENTER_Z",label:"&nbsp;&nbsp;z:",align:"right",reportas:"sphere center - z",tooltip:"Sphere x-center, &Aring;",range:["*","*"],iwidth:60,value:"",position:[2,10,1,1],showon:{_:"&&",SPHERE_CBX:[!0],CENTER_SEL:["C"]}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskLsqKab.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskLsqKab.prototype.constructor=TaskLsqKab,TaskLsqKab.prototype.icon=function(){return"task_lsqkab"},TaskLsqKab.prototype.desc_title=function(){return"structure superposition with manual specification of matching atoms"},TaskLsqKab.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskLsqKab.prototype.makeFitParamRow=function(e){var t,i=1+2*e,o="FIT_"+e+"_SEL",n=(this.parameters.sec1.contains[o]=e<=0?{type:"combobox",keyword:"fit"+e,label:"<b>Fit</b>",tooltip:"Selection type",iwidth:440,range:["CA|C-alpha atoms of moving structure in residue range","MAIN|mainchain atoms of moving structure in residue range","SIDE|sidechain atoms of moving structure in residue range","ALL|all atoms of moving structure in residue range","AA|atoms of moving structure in serial number range"],value:"CA",position:[i,0,1,1]}:{type:"combobox",keyword:"fit"+e,label:"<b>and</b>",tooltip:"Selection type",iwidth:440,range:["NO|no other atoms","CA|C-alpha atoms of moving structure in residue range","MAIN|mainchain atoms of moving structure in residue range","SIDE|sidechain atoms of moving structure in residue range","ALL|all atoms of moving structure in residue range","AA|atoms of moving structure in serial number range"],value:"NO",position:[i,0,1,1]},{});n[o]=["NO"],1<e&&(n._="||",n[t="FIT_"+(e-1)+"_SEL"]=["NO"],this.parameters.sec1.contains[o].hideon={},this.parameters.sec1.contains[o].hideon[t]=["NO"]),this.parameters.sec1.contains["FITFROM"+e]={type:"integer",keyword:"from"+e,label:"",reportas:"fit range #"+(e+1)+' "from"',tooltip:"First number in the range",range:["*","*"],iwidth:60,value:"",position:[i,3,1,1],hideon:n},this.parameters.sec1.contains["FITTO"+e]={type:"integer",keyword:"to"+e,label:"",lwidth:0,reportas:"fit range #"+(e+1)+' "to"',tooltip:"Last number in the range",range:["*","*"],iwidth:60,value:"",position:[i,6,1,1],hideon:n},this.parameters.sec1.contains["FITCHAIN"+e+"_SEL"]={type:"combobox",keyword:"chain"+e,label:"",lwidth:0,tooltip:"Chain selection",range:["A|A"],value:"A",position:[i,7,1,1],hideon:n},this.parameters.sec1.contains["MOVING"+e+"_LBL"]={type:"label",label:"",align:"right",position:[++i,0,1,3],hideon:n},this.parameters.sec1.contains["FROM"+e]={type:"integer",keyword:"from"+e,label:"",reportas:"match range #"+(e+1)+' "from"',tooltip:"First number in the range",range:["*","*"],iwidth:60,value:"",position:[i,1,1,1],hideon:n},this.parameters.sec1.contains["TO"+e]={type:"integer",keyword:"to"+e,label:"",lwidth:0,reportas:"match range #"+(e+1)+' "to"',tooltip:"Last number in the range",range:["*","*"],iwidth:60,value:"",position:[i,4,1,1],hideon:n},this.parameters.sec1.contains["CHAIN"+e+"_SEL"]={type:"combobox",keyword:"chain"+e,label:"",lwidth:0,tooltip:"Chain selection",range:["A|A"],value:"A",position:[i,5,1,1],hideon:n}},TaskLsqKab.prototype.checkKeywords=function(e){return this.__check_keywords(e,["lsqkab","structure","superposition","alignment","comparison"])},__template?(conf=require("../../js-server/server.configuration"),TaskLsqKab.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.lsqkab",e,t,this.id]},module.exports.TaskLsqKab=TaskLsqKab):TaskLsqKab.prototype.inputChanged=function(e,t,i){if(TaskTemplate.prototype.inputChanged.call(this,e,t,i),this.state==job_code.new)if("moving_xyz"==t||"fixed_xyz"==t){var i=e.grid.inpDataRef,i=this.getInputItem(i,t).dropdown[0],o=i.dt[i.getValue()].getChainList(),n="FITCHAIN";"fixed_xyz"==t&&(n="CHAIN");for(var s=0;s<this.maxFitParamRows;s++){var a=n+s+"_SEL",r=e.parameters[a].input,l=e.parameters[a].ref.value;r.reset();for(var c=0;c<o.length;c++)r.addItem(o[c].label,"",o[c].id,o[c].id==l);r.make()}}else{i=t.split("_");"FIT"!=i[0]&&"RTYPE"!=i[0]||e.parameters["MOVING"+i[1]+"_LBL"].label.setText("to "+e.parameters["FIT_"+i[1]+"_SEL"].input.getText().replace("moving","fixed"))}};var __template=null,__coot_reserved_codes=("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),["XXX","LIG","DRG","INH","LG0","LG1","LG2","LG3","LG4","LG5","LG6","LG7","LG8","LG9"]),conf;function TaskMakeLigand(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskMakeLigand",this.name="make ligand",this.oname="",this.title="Make Ligand with Acedrg",this.input_dtypes=[{data_type:{DataRevision:[]},label:"",inputId:"void1",version:0,force:100,min:0,max:100}],this.parameters={SOURCE_SEL:{type:"combobox",label:"<b>Use</b>",tooltip:"Source of data for making a ligand",range:["S|SMILES string","M|Monomer library"],value:"S",position:[0,0,1,5]},SMILES:{type:"string",keyword:"smiles",label:"<i>SMILES string</i>",tooltip:"SMILES string to define ligand structure",iwidth:680,value:"",position:[1,2,1,5],showon:{SOURCE_SEL:["S"]}},CODE:{type:"string_",keyword:"code",label:"<i>Ligand Code</i>",tooltip:"3-letter ligand code for identification",default:"",iwidth:40,value:"",maxlength:3,label2:'<span style="font-size:85%;color:maroon;"><i>if no code is given (recommended), a suitable new one will be autogenerated</i></span>',lwidth2:"100%",position:[2,2,1,1],showon:{SOURCE_SEL:["S"]}},CODE3:{type:"string",label:"<i>3-letter Code</i>",tooltip:"3-letter ligand code",default:"",iwidth:40,value:"",maxlength:3,label2:"&nbsp;",lwidth2:100,position:[3,2,1,1],showon:{SOURCE_SEL:["M"]}},FORCE_ACEDRG_CBX:{type:"checkbox",label:"Recalculate with AceDrg",align:"left",tooltip:"Check for recalculating ligand data using AceDrg. If unchecked, both restraints and atomic coordinates will be merely copied from CCP4 Monomer Library.",value:!1,iwidth:200,position:[3,5,1,1],showon:{SOURCE_SEL:["M"]}},INFO2_LBL:{type:"label",label:'&nbsp;<br><span style="font-size:85%;color:maroon;"><i>Codes '+__coot_reserved_codes.join(", ")+"<br>are reserved by Coot and cannot be used here.</i></span>",position:[4,4,1,5]}}}TaskMakeLigand.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskMakeLigand.prototype.constructor=TaskMakeLigand,TaskMakeLigand.prototype.icon=function(){return"task_makeligand"},TaskMakeLigand.prototype.desc_title=function(){return"generate crystallographic restraints for fitting ligand in the density and refinement"},TaskMakeLigand.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskMakeLigand.prototype.checkKeywords=function(e){return this.__check_keywords(e,["acedrg","ligand","make","chemical","monomer","smile"])},__template?(conf=require("../../js-server/server.configuration"),TaskMakeLigand.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.makeligand",e,t,this.id]},module.exports.TaskMakeLigand=TaskMakeLigand,module.exports.__coot_reserved_codes=__coot_reserved_codes):TaskMakeLigand.prototype.collectInput=function(e){var e=TaskTemplate.prototype.collectInput.call(this,e),t=this.parameters.CODE.value;return"M"==this.parameters.SOURCE_SEL.value&&(t=this.parameters.CODE3.value),0<=__coot_reserved_codes.indexOf(t)&&(e+="<b>ligand code "+t+" is reserved by Coot for own purposes and cannot be used</b>"),e};var __template=null,conf;function TaskMergeData(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskMergeData",this.name="merge data",this.oname="*",this.title="Merge Data from Different Branches",this.input_dtypes=[]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskMergeData.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskMergeData.prototype.constructor=TaskMergeData,TaskMergeData.prototype.icon=function(){return"task_merge"},TaskMergeData.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskMergeData.prototype.checkKeywords=function(e){return this.__check_keywords(e,["merge","data","mergedata","coot"])},__template?(conf=require("../../js-server/server.configuration"),TaskMergeData.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.mergedata",e,t,this.id]},module.exports.TaskMergeData=TaskMergeData):(TaskMergeData.prototype.desc_title=function(){return""},TaskMergeData.prototype.makeInputPanel=function(e){var t=this.makeInputLayout(),i=(t.header.uname_lbl.setText("description:&nbsp;"),t.grid.setLabel("All downstream jobs will see data available for all upstream jobs in the current branch of the job tree, and, in addition, from the following jobs:",0,0,1,5).setFontBold(!0),new Widget("div")),o=(i.element.setAttribute("class","tree-content"),new JobTree);return o.element.style.paddingTop="0px",o.element.style.paddingBottom="25px",o.element.style.paddingRight="40px",i.addWidget(o),t.grid.setWidget(i,1,0,1,1),o.readProjectData("Project",!0,-1,function(){},function(e){},function(){o.openJob(null,i)},function(){}),t},TaskMergeData.prototype.collectInput=function(e){return""},TaskMergeData.prototype.runButtonName=function(){return null});var __template=null,__cmd=null,fs,path,conf,utils,uh,fcl;function TaskMigrate(){__template?(__template.TaskTemplate.call(this),this.name="hop on "+__cmd.appName().toLowerCase(),this.title="Hop on "+__cmd.appName(),this.inputMode=__template.input_mode.root):(TaskTemplate.call(this),this.name="hop on "+appName().toLowerCase(),this.title="Hop on "+appName(),this.inputMode=input_mode.root),this._type="TaskMigrate",this.setOName("hop-on"),this.fasttrack=!0,this.file_system="local",this.currentCloudPath="",this.file_mod={rename:{},annotation:[]},this.file_hkl="",this.file_mtz="",this.file_xyz="",this.file_lib="",this.upload_files=[]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template"),__cmd=require("../common.commands")),TaskMigrate.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskMigrate.prototype.constructor=TaskMigrate,TaskMigrate.prototype.icon=function(){return"task_migrate"},TaskMigrate.prototype.desc_title=function(){return"import phased structure (HKL, phases and/or XYZ) as Structure Revision"},TaskMigrate.prototype.taskDescription=function(){return"Import phased structure as Structure Revision"},TaskMigrate.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(fs=require("fs-extra"),path=require("path"),conf=require("../../js-server/server.configuration"),utils=require("../../js-server/server.utils"),uh=require("../../js-server/server.fe.upload_handler"),fcl=require("../../js-server/server.fe.facilities"),TaskMigrate.prototype.prepare_file=function(e,t,i){if(0<e.length){var o=e.split("/");if(2<o.length&&"cloudstorage::"==o[0]){for(var n=null,s=0;s<t.length&&!n;s++)t[s][0]==o[1]&&(n=path.join(t[s][1],o.slice(2).join("/")));if(n){i=path.join(i,o[o.length-1]);try{fs.copySync(n,i)}catch(e){console.log(" ***** cannot copy file "+n+"\n                   to "+i),console.log("       error: "+e)}}else console.log(" ***** path "+e+" not found")}}},TaskMigrate.prototype.makeInputData=function(e,t){var i=path.join(t,uh.uploadDir()),o=(utils.writeObject(path.join(t,"annotation.json"),this.file_mod)||console.log(' ***** cannot write "annotation.json" in '+i),utils.fileExists(i)||utils.mkDir(i)||console.log(" ***** cannot create directory "+i),fcl.getUserCloudMounts(e));this.prepare_file(this.file_hkl,o,i),this.prepare_file(this.file_mtz,o,i),this.prepare_file(this.file_xyz,o,i),this.prepare_file(this.file_lib,o,i);for(var n=0;n<this.file_mod.annotation.length;n++){utils.removeFile(path.join(i,this.file_mod.annotation[n].file));for(var s=0;s<this.file_mod.annotation[n].items.length;s++){var a=this.file_mod.annotation[n].items[s].rename;utils.writeString(path.join(i,a),this.file_mod.annotation[n].items[s].contents)}}__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskMigrate.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.migrate",e,t,this.id]},TaskMigrate.prototype.checkKeywords=function(e){return this.__check_keywords(e,["hopon","hop-on","hop","on","migrate","import"])},module.exports.TaskMigrate=TaskMigrate):(TaskMigrate.prototype.hotButtons=function(){return[CootMBHotButton(),RefmacHotButton()]},TaskMigrate.prototype.customDataClone=function(e,t){this.uname="",this.file_system=t.file_system,this.currentCloudPath=t.currentCloudPath,this.file_mod={rename:{},annotation:[]},"scalepack"in t.file_mod&&(this.file_mod.scalepack=t.file_mod.scalepack),"cloud"==this.file_system&&(this.file_hkl=t.file_hkl,this.file_mtz=t.file_mtz,this.file_xyz=t.file_xyz,this.file_lib=t.file_lib),this.upload_files=[]},TaskMigrate.prototype.makeInputPanel=function(e){var r=this,l=this.makeInputLayout(),e=(this.setInputDataFields(l.grid,0,e,this),this.state!=job_code.new&&this.state!=job_code.running&&l.header.uname_inp.setValue(this.uname.replace(/<(?:.|\n)*?>/gm,"")),l.customData={},l.customData.login_token=__login_token,l.customData.project=this.project,l.customData.job_id=this.id,l.customData.file_mod={rename:{},annotation:[]},l.task=this,l.file_system=this.file_system,l.upload_files=[],l.grid.getNRows());function c(e,t,i){t=l.grid1.setLabel(t,e,0,1,1).setTooltip(i).setFontItalic(!0).setFontBold(!0).setNoWrap();return l.grid1.setVerticalAlignment(e,0,"middle"),t}function t(e,t,i,o,n){var t=c(e,t,i),s=l.grid1.setSelectFile(!1,o,e,2,1,1),i=(s.hide(),l.grid1.addButton("Browse",image_path("open_file"),e,2,1,1)),a=(r.state==job_code.new&&"local"==l.file_system&&(n=""),l.grid1.setLabel("&nbsp;",e,1,1,1).setNoWrap(),l.grid1.setInputText(n,e,3,1,2).setWidth_px(400).setReadOnly(!0).setNoWrap());return l.grid1.setVerticalAlignment(e,2,"middle"),l.grid1.setVerticalAlignment(e,3,"middle"),l.grid1.setLabel("&nbsp;",e,4,1,1).setNoWrap(),i.addOnClickListener(function(){"local"==l.file_system?s.click():new CloudFileBrowser(l,l.task,4,o.split(","),function(e){var t,i;return 0<e.length&&(t={rename:{},annotation:[]},(i="cloudstorage::/"+l.task.currentCloudPath+"/"+e[0].name).toLowerCase().endsWith(".sca")?_import_checkFiles(e,t,l.upload_files,function(){"scalepack"in t&&(l.customData.file_mod.scalepack=t.scalepack),a.setValue(i)}):a.setValue(i)),1},null)}),s.addOnChangeListener(function(){var e,t=s.getFiles();0<t.length&&(e={rename:{},annotation:[]},t[0].name.toLowerCase().endsWith(".sca")?_import_checkFiles(t,e,l.upload_files,function(){"scalepack"in e&&(l.customData.file_mod.scalepack=e.scalepack),a.setValue(t[0].name)}):a.setValue(t[0].name))}),{label:t,fsel:s,browse:i,itext:a}}l.grid.setLabel(0==e?"<h2>Input Data</h2>":"&nbsp;<br><h3>Data to import and replace in revision</h3>",e++,0,1,5).setFontItalic(!0).setNoWrap(),l.grid1=l.grid.setGrid("",e,0,1,5),c(e=0,"Import data from","Specify data location"),l.source_select_ddn=new Dropdown,l.grid1.addWidget(l.source_select_ddn,0,2,1,2),l.source_select_ddn.addItem("local file system","","local","local"==l.file_system),l.source_select_ddn.addItem("cloud storage","","cloud","cloud"==l.file_system),l.source_select_ddn.make(),l.source_select_ddn.addOnChangeListener(function(e,t){l.file_system=t,l.select_hkl.itext.setValue(""),l.select_mtz.itext.setValue(""),l.select_xyz.itext.setValue(""),l.select_lib.itext.setValue("")}),l.source_select_ddn.setWidth("180px"),l.grid1.setVerticalAlignment(e++,2,"middle"),l.grid1.setLabel("",e++,0,1,1).setHeight_px(8),l.select_hkl=t(e++,"Reflection data","Navigate to MTZ file with merged reflections",".mtz,.sca",this.file_hkl),l.select_mtz=t(e++,"Phases","Navigate to MTZ file with electron density maps",".mtz",this.file_mtz),l.select_xyz=t(e++,"Atomic coordinates","Navigate to PDB or mmCIF file with atomic coordinates",".pdb,.mmcif",this.file_xyz),l.select_lib=t(+e,"Ligand descriptions","Navigate to CIF file with ligand descriptions",".cif,.lib",this.file_lib),this.layParameters(l.grid,l.grid.getNRows()+1,0);for(var i=l.grid1.getNCols(),o=1;o<i;o++)l.grid1.setLabel(" ",6,o,1,1).setHeight_px(8),l.grid1.setCellSize("auto","",6,o);return l.grid1.setLabel(" ",6,i,1,1).setHeight_px(8),l.grid1.setCellSize("95%","",6,i),l},TaskMigrate.prototype.collectInput=function(e){var t,i,o,n,s="";return this.file_hkl="",this.file_mtz="",this.file_xyz="",this.file_lib="","local"==e.file_system?(t=e.select_hkl.fsel.getFiles(),i=e.select_mtz.fsel.getFiles(),o=e.select_xyz.fsel.getFiles(),n=e.select_lib.fsel.getFiles(),0<t.length&&(this.file_hkl=t[0].name),0<i.length&&(this.file_mtz=i[0].name),0<o.length&&(this.file_xyz=o[0].name),0<n.length&&(this.file_lib=n[0].name)):(this.file_hkl=e.select_hkl.itext.getValue(),this.file_mtz=e.select_mtz.itext.getValue(),this.file_xyz=e.select_xyz.itext.getValue(),this.file_lib=e.select_lib.itext.getValue()),this.file_hkl.length<=0&&(s+="|<b><i>Reflection data must be given</i></b>"),this.file_mtz.length<=0&&this.file_xyz.length<=0&&(s+="|<b><i>Either phases or atomic coordinates, or both, must be given</i></b>"),this.file_system=e.file_system,this.file_mod=e.file_mod,TaskTemplate.prototype.collectInput.call(this,e),s},TaskMigrate.prototype.doRun=function(e,t){var i,o="",n="",s="",a="";this.file_system=e.file_system,this.file_mod=e.file_mod,"local"==e.file_system?(o=e.select_hkl.fsel.getFiles(),n=e.select_mtz.fsel.getFiles(),s=e.select_xyz.fsel.getFiles(),a=e.select_lib.fsel.getFiles(),0<o.length&&(this.file_hkl=o[0].name),0<n.length&&(this.file_mtz=n[0].name),0<s.length&&(this.file_xyz=s[0].name),0<a.length&&(this.file_lib=a[0].name)):(this.file_hkl=e.select_hkl.itext.getValue(),this.file_mtz=e.select_mtz.itext.getValue(),this.file_xyz=e.select_xyz.itext.getValue(),this.file_lib=e.select_lib.itext.getValue()),this.file_hkl.length+this.file_mtz.length+this.file_xyz.length+this.file_lib.length<=0?new MessageBox("Stop run","Task cannot be run as no data are<br>given for upload"):"local"==e.file_system?(i=[],0<o.length&&i.push(o),0<n.length&&i.push(n),0<s.length&&i.push(s),0<a.length&&i.push(a),new UploadDialog("Upload data",i,e.customData,!0,function(e){e?new MessageBox("Stop run","Task cannot be run due to upload errors:<p><b><i>"+e+"</i></b>",msg_error):t()})):t()},TaskMigrate.prototype.runButtonName=function(){return"Import"});var __template=null,__migrate=null,conf;function TaskImportReplace(){(__migrate?__migrate.TaskMigrate:TaskMigrate).call(this),this._type="TaskImportReplace",this.name="import-n-replace",this.title="Import & Replace",this.oname="*",this.inputMode=(__template?__template.input_mode:input_mode).standard,this.fasttrack=!0,this.input_dtypes=[{data_type:{DataRevision:[]},label:"Structure revision",inputId:"revision",version:7,min:1,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template"),__migrate=require("./common.tasks.migrate")),TaskImportReplace.prototype=__migrate?Object.create(__migrate.TaskMigrate.prototype):Object.create(TaskMigrate.prototype),TaskImportReplace.prototype.constructor=TaskImportReplace,TaskImportReplace.prototype.icon=function(){return"task_migrate"},TaskImportReplace.prototype.currentVersion=function(){return __migrate?0+__migrate.TaskMigrate.prototype.currentVersion.call(this):0+TaskMigrate.prototype.currentVersion.call(this)},TaskImportReplace.prototype.checkKeywords=function(e){return this.__check_keywords(e,["import","replace","data"])},__template?(conf=require("../../js-server/server.configuration"),TaskImportReplace.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.ihkl=[i.HKL],i.Structure&&(this.input_data.data.istruct=[i.Structure]),i.Substructure&&(this.input_data.data.isub=[i.Substructure])),__migrate.TaskMigrate.prototype.makeInputData.call(this,e,t)},TaskImportReplace.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.import_replace",e,t,this.id]},module.exports.TaskImportReplace=TaskImportReplace):(TaskImportReplace.prototype.desc_title=function(){return"import data from your device or "+appName()+" storage and replace it in Structure Revision"},TaskImportReplace.prototype.taskDescription=function(){return"Import data from your device or "+appName()+" storage and replace it in Structure Revision"},TaskImportReplace.prototype.collectInput=function(e){TaskMigrate.prototype.collectInput.call(this,e);e="";return this.file_hkl.length+this.file_mtz.length+this.file_xyz.length+this.file_lib.length<=0&&(e+="<b><i>no data is given for import</i></b>"),e});var __template=null,conf;function TaskModelCraft(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskModelCraft",this.name="modelcraft",this.setOName("modelcraft"),this.title="Automatic Model Building with ModelCraft",this.input_dtypes=[{data_type:{DataRevision:["!protein","!seq",["phases","xyz"]]},label:"Structure revision",inputId:"revision",customInput:"modelcraft",version:7,min:1,max:1}],this.parameters={SEP_LBL:{type:"label",label:"&nbsp;",position:[0,0,1,5]},sec1:{type:"section",title:"Parameters",open:!0,position:[1,0,1,5],contains:{MODE_SEL:{type:"combobox",keyword:"--basic",label:"Build mode",tooltip:"Basic mode will use only Buccaneer, Nautilus and Refmac. Parrot density modification is still used on the first cycle and starting models are still refined using Sheetbend and Refmac.",range:["full|Full","basic|Basic"],value:"full",iwidth:100,position:[0,0,1,3]},NCYCLES_MAX:{type:"integer",keyword:"--cycles",label:"Maximum number of build cycles",tooltip:"Choose a value between 1 and 100 (default 25).",range:[1,100],value:"25",iwidth:40,position:[1,0,1,1]},NOIMPROVE_CYCLES:{type:"integer",keyword:"--auto-stop-cycles",label:"Stop if results do not improve during",tooltip:"Choose a value between 0 and 100 (default 4). Improvement is measured by R-free. A cycle must improve on the previous best value to be marked as an improvement. Setting this value to less than 1 makes the program run to the maximum number of cycles.",range:[0,100],value:"4",iwidth:40,label2:"consequitive cycles",position:[2,0,1,1]}}}}}function ModelCraftHotButton(){return{task:"TaskModelCraft",tooltip:"Automated model building with ModelCraft"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskModelCraft.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskModelCraft.prototype.constructor=TaskModelCraft,TaskModelCraft.prototype.icon=function(){return"task_modelcraft"},TaskModelCraft.prototype.desc_title=function(){return"performs automatic model building after MR or Experimental Phasing"},TaskModelCraft.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskModelCraft.prototype.checkKeywords=function(e){return this.__check_keywords(e,["modelcraft","model","building","mb","auto-mb"])},__template?(conf=require("../../js-server/server.configuration"),TaskModelCraft.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq,"substructure"==i.Options.leading_structure?this.input_data.data.istruct=[i.Substructure]:(this.input_data.data.istruct=[i.Structure],i.Substructure&&(this.input_data.data.isubstruct=[i.Substructure]))),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskModelCraft.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.modelcraft",e,t,this.id]},module.exports.TaskModelCraft=TaskModelCraft):TaskModelCraft.prototype.hotButtons=function(){return[CootMBHotButton()]};var __template=null,conf;function TaskModelPrepXYZ(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskModelPrepXYZ",this.name="prepare single-chain MR model(s) from xyz",this.setOName("*"),this.title="Prepare Single-Chain MR Model(s) from Coordinate data",this.input_dtypes=[{data_type:{DataSequence:[]},label:"Sequence",tooltip:"Specify macromolecular sequence to be associated with the resulting models.",inputId:"seq",min:1,max:1},{data_type:{DataStructure:["~substructure","~substructure-am","!xyz"],DataXYZ:[]},label:"Coordinates",tooltip:"Specify coordinate data set(s) to be prepared as model(s) for Molecular Replacement. The model(s) will be named after the corresponding coordinate data set(s).",inputId:"xyz",customInput:"chain-sel-poly",min:1,max:1e3}],this.parameters={sec1:{type:"section",title:"Model modification",open:!0,position:[0,0,1,5],contains:{MODIFICATION_SEL:{type:"combobox",keyword:"none",label:"Modification protocol:",tooltip:"Choose trim option",range:["U|Unmodified","D|PDB Clip","M|Molrep","S|Sculptor","C|Chainsaw","P|Polyalanine"],value:"M",position:[0,0,1,1]},LEGEND_SEQ_U:{type:"label",label:"<i>(models are not changed)</i>",position:[0,3,1,1],showon:{MODIFICATION_SEL:["U"]}},LEGEND_SEQ_D:{type:"label",label:"<i>(remove solvent, hydrogens, and select most probable conformations)</i>",position:[0,3,1,1],showon:{MODIFICATION_SEL:["D"]}},LEGEND_SEQ_M:{type:"label",label:"<i>(side chain truncation based on Molrep)</i>",position:[0,3,1,1],showon:{MODIFICATION_SEL:["M"]}},LEGEND_SEQ_C:{type:"label",label:"<i>(side chain truncation based on Chainsaw)</i>",position:[0,3,1,1],showon:{MODIFICATION_SEL:["C"]}},LEGEND_SEQ_S:{type:"label",label:"<i>(side chain truncation based on Phaser.Sculptor)</i>",position:[0,3,1,1],showon:{MODIFICATION_SEL:["S"]}},LEGEND_SEQ_P:{type:"label",label:"<i>(removal of all side chains)</i>",position:[0,3,1,1],showon:{MODIFICATION_SEL:["P"]}},SCULPTOR_PROTOCOL_SEL:{type:"combobox",keyword:"none",label:"Sculptor protocol:",tooltip:"Choose Sculptor processing protocol",range:["1|#1","2|#2","3|#3","4|#4","5|#5","6|#6","7|#7","8|#8","9|#9","10|#10","11|#11","12|#12","13|#13"],value:"1",showon:{MODIFICATION_SEL:["S"]},position:[1,0,1,1]},CHAINSAW_MODE_SEL:{type:"combobox",keyword:"none",label:"Chainsaw protocol:",tooltip:"Choose Chainsaw processing protocol",range:["MIXS|gamma atom","MIXA|beta atom","MAXI|last common atom"],value:"MIXS",showon:{MODIFICATION_SEL:["C"]},position:[1,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskModelPrepXYZ.prototype.checkKeywords=function(e){return this.__check_keywords(e,["prepare","single-chain","mr","model(s)","from","coordinate","data","model","models","preparation","prepare single-chain mr model(s) from coordinate data","prepare  single-chain mr model from coordinate data"])},TaskModelPrepXYZ.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskModelPrepXYZ.prototype.constructor=TaskModelPrepXYZ,TaskModelPrepXYZ.prototype.icon=function(){return"task_modelprepxyz"},TaskModelPrepXYZ.prototype.desc_title=function(){return"prepare single-chain MR search model(s) from atomic coordinates and sequence"},TaskModelPrepXYZ.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskModelPrepXYZ.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.modelprepxyz",e,t,this.id]},module.exports.TaskModelPrepXYZ=TaskModelPrepXYZ):TaskModelPrepXYZ.prototype.collectInput=function(e){e=TaskTemplate.prototype.collectInput.call(this,e);if(e.length<=0){var t=this.input_data.getData("seq"),i=this.input_data.getData("xyz"),o=[],n=0,s=(t&&0<t.length&&(0<=t[0].subtype.indexOf("protein")&&(n+=1),0<=t[0].subtype.indexOf("dna")&&(n+=2),0<=t[0].subtype.indexOf("rna")&&(n+=4)),this.parameters.sec1.contains.MODIFICATION_SEL.value);if(0==(1&n)&&["U","D"].indexOf(s)<0)o.push(this.invalidParamMessage("incompatible modification protocol",'making nucleic acid MR models is possible only for "Unmodified" and<br>"PDB Clip" modification protocols'));else for(var a=0;a<i.length;a++){var r=0;"(none)"==i[a].chainSel?o.push(this.invalidParamMessage("no suitable chain selected in "+i[a].dname,"no chains suitable for making MR model with chosen target sequence<br>are found in coordinate data")):"(all)"==i[a].chainSel?0<=["U","D"].indexOf(s)?(0<=i[a].subtype.indexOf("protein")&&(r+=1),0<=i[a].subtype.indexOf("dna")&&(r+=2),0<=i[a].subtype.indexOf("rna")&&(r+=4)):o.push(this.invalidParamMessage("chain is not selected in "+i[a].dname,'selecting all chains is possible only for "Unmodified" and "PDB Clip"<br>modification protocols')):"protein"==i[a].chainSelType?r=1:"dna"==i[a].chainSelType?r=2:"rna"==i[a].chainSelType?r=4:"na"==i[a].chainSelType?r=6:"lig"==i[a].chainSelType&&o.push(this.invalidParamMessage("not allowed chain type in "+i[a].dname,"ligands cannot be used as MR search models")),0==(r&n)&&o.push(this.invalidParamMessage("incompatible chain type in "+i[a].dname,"the type of MR model chain must coincide with the type of target sequence"))}0<o.length&&(e=o.join("|"))}return e};var __template=null,conf;function TaskModelPrepAlgn(){(__template?__template.TaskModelPrepXYZ:TaskModelPrepXYZ).call(this),this._type="TaskModelPrepAlgn",this.name="prepare MR model(s) from alignment data",this.title="Prepare MR Model(s) from Alignment data",this.input_dtypes[1]={data_type:{DataAlignment:[]},label:"Alignment",tooltip:"Specify coordinate sets to be merged in an ensamble for further use in Molecular Replacement. Usually you will choose homologous single chains of approximately equal length. The resulting ensemble will be named after the leading coordinate set.",inputId:"alignment",customInput:"align-sel",min:1,max:1}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.modelprepxyz")),TaskModelPrepAlgn.prototype=__template?Object.create(__template.TaskModelPrepXYZ.prototype):Object.create(TaskModelPrepXYZ.prototype),TaskModelPrepAlgn.prototype.constructor=TaskModelPrepAlgn,TaskModelPrepAlgn.prototype.icon=function(){return"task_modelprepalgn"},TaskModelPrepAlgn.prototype.desc_title=function(){return"prepare MR search models from HHPRED alignments"},TaskModelPrepAlgn.prototype.currentVersion=function(){return __template?0+__template.TaskModelPrepXYZ.prototype.currentVersion.call(this):0+TaskModelPrepXYZ.prototype.currentVersion.call(this)},TaskModelPrepAlgn.prototype.checkKeywords=function(e){return this.__check_keywords(e,["model","preparation","mr","alignment"])},__template?(conf=require("../../js-server/server.configuration"),TaskModelPrepAlgn.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.modelprepalgn",e,t,this.id]},module.exports.TaskModelPrepAlgn=TaskModelPrepAlgn):TaskModelPrepAlgn.prototype.collectInput=function(e){return TaskTemplate.prototype.collectInput.call(this,e)};var __template=null,conf;function TaskModelPrepMC(){(__template?__template.TaskModelPrepXYZ:TaskModelPrepXYZ).call(this),this._type="TaskModelPrepMC",this.name="prepare multi-chain MR model",this.setOName("*"),this.title="Prepare Multi-Chain MR Model",this.input_dtypes=[{data_type:{DataStructure:["~substructure","~substructure-am","!xyz"],DataXYZ:[]},label:"Template structure",tooltip:"Template multi-chain structure.",inputId:"xyz",min:1,max:1},{data_type:{DataSequence:[]},label:"Sequence",tooltip:"Macromolecular sequence to be associated with the selected chains.",customInput:"chain-input-list",inputId:"seq",min:1,max:1e3}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.modelprepxyz")),TaskModelPrepMC.prototype=__template?Object.create(__template.TaskModelPrepXYZ.prototype):Object.create(TaskModelPrepXYZ.prototype),TaskModelPrepMC.prototype.constructor=TaskModelPrepMC,TaskModelPrepMC.prototype.icon=function(){return"task_modelprepmc"},TaskModelPrepMC.prototype.desc_title=function(){return"prepare multi-chain MR search model from template complex structure"},TaskModelPrepMC.prototype.currentVersion=function(){return __template?0+__template.TaskModelPrepXYZ.prototype.currentVersion.call(this):0+TaskModelPrepXYZ.prototype.currentVersion.call(this)},TaskModelPrepMC.prototype.checkKeywords=function(e){return this.__check_keywords(e,["model","preparation","mr","multichain","coordinates"])},__template?(conf=require("../../js-server/server.configuration"),TaskModelPrepMC.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.modelprepmc",e,t,this.id]},module.exports.TaskModelPrepMC=TaskModelPrepMC):TaskModelPrepMC.prototype.collectInput=function(e){e=TaskTemplate.prototype.collectInput.call(this,e);if(e.length<=0){for(var t=this.input_data.getData("seq"),i=this.input_data.getData("xyz"),o=[],n=i[0].xyzmeta.xyz[0].chains,s=0,a=(0<=i[0].subtype.indexOf("protein")&&(s|=1),0<=i[0].subtype.indexOf("dna")&&(s|=2),0<=i[0].subtype.indexOf("rna")&&(s|=4),[]),r=0,l=0;l<t.length;l++){var c="",d=(0<=t[l].subtype.indexOf("protein")&&(s|=1,c="protein"),0<=t[l].subtype.indexOf("dna")&&(s|=2,c="dna"),0<=t[l].subtype.indexOf("rna")&&(s|=4,c="rna"),t[l].chain_list.trim());if(d)if("*"==d)0<r||1<t.length?o.push("<b><i>All chains (*) may be requested only once for a homomeric complex</i></b>"):r++;else for(var h=d.split(",").map(function(e){return e.trim()}),u=0;u<h.length;u++){0<=a.indexOf(h[u])?o.push("<b><i>Chain "+h[u]+" used more than once</i></b>"):a.push(h[u]);for(var p,m=!1,f=0;f<n.length&&!m;f++)h[u]==n[f].id&&(m=!0,(p=n[f].type.toLowerCase())!=c&&o.push("<b><i>Chain "+h[u]+" type mismatch with sequence "+t[l].dataId+" ("+p+":"+c+")</i></b>"));m||o.push("<b><i>Chain "+h[u]+" not found in template structure</i></b>")}else o.push("<b><i>No chain selection found for sequence "+t[l].dataId+"</i></b>")}i=this.parameters.sec1.contains.MODIFICATION_SEL.value;s&&0==(1&s)&&["U","D"].indexOf(i)<0&&o.push("<b><i>"+this.invalidParamMessage("incompatible modification protocol",'making nucleic acid MR models is possible only for "Unmodified" and<br>"PDB Clip" modification protocols</i></b>')),0<o.length&&(e=o.join("|"))}return e};var __template=null;function TaskMolrep(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskMolrep",this.name="molrep",this.setOName("molrep"),this.title="Molecular Replacement with Molrep",this.input_dtypes=[{data_type:{DataRevision:["hkl"]},label:"Structure revision",inputId:"revision",customInput:"molrep1",version:7,min:1,max:1},{data_type:{DataEnsemble:[],DataModel:[]},label:"Model ensemble",inputId:"model",customInput:"model",version:0,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Search options",open:!0,position:[0,0,1,5],contains:{NMON:{type:"integer_",keyword:"NMON",label:"Number of copies to find",tooltip:"Choose a value between 1 and 200, or leave blank for automatic choice",range:[1,200],value:"",position:[0,0,1,1]},NP:{type:"integer_",keyword:"NP",label:"Number of RF peaks to use",tooltip:"Choose a value between 1 and 200, or leave blank for automatic choice",range:[1,200],value:"",position:[1,0,1,1]},NPT:{type:"integer_",keyword:"NPT",label:"Number of RF peaks to use in TF",tooltip:"Choose a value between 1 and 50, or leave blank for automatic choice",range:[1,50],value:"",position:[2,0,1,1]},LOCK:{type:"combobox",keyword:"LOCK",label:"Locked rotation function",tooltip:"Locked rotation function",range:["N|Do not use","A|Auto","Y|Use SRF table"],value:"N",position:[3,0,1,1]},NSRF:{type:"integer_",keyword:"NSRF",label:"&nbsp;&nbsp;&nbsp;&nbsp;with",reportas:"Number of top SRF peaks",tooltip:"Number of top SRF peaks to use in Locked RF. Choose a value between 1 and 50, or leave blank for automatic choice",range:[1,50],value:"",position:[3,3,1,1],align:"right",showon:{LOCK:["A","Y"]}},NSPL:{type:"label",label:"top SRF peaks",position:[3,6,1,1],showon:{LOCK:["A","Y"]}},PST:{type:"combobox",keyword:"PST",label:"Pseudo-translation",tooltip:"Using pseudo-translation",range:["A|Auto","N|Do not use"],value:"A",position:[4,0,1,1]}}},sec2:{type:"section",title:"Experimental data",open:!1,position:[1,0,1,5],contains:{TITLE2:{type:"label",label:"<h3>Change default behaviour for</h3>",position:[0,0,1,4]},RESMAX_CBX:{type:"checkbox",label:"High resolution cut-off",tooltip:"Check for using high resolution cut-off",value:!1,position:[1,0,1,1]},SEP2:{type:"label",label:"&nbsp;&nbsp;",lwidth:30,position:[1,1,1,1]},RESMAX:{type:"real_",keyword:"RESMAX",label:"R<sub>max</sub> [&Aring;]:",lwidth:60,reportas:"High resolution cut-off",tooltip:"High resolution limit to cut reflection data. Choose a value between 0 and 10 angstrom, or leave blank for automatic choice",range:[0,10],value:"",position:[1,2,1,1],showon:{RESMAX_CBX:[!0]}},SIM_CBX:{type:"checkbox",label:"Down-weighting high resolution data",tooltip:"Check for down-weighting high resolution data",value:!1,position:[2,0,1,1]},SIM_MOD:{type:"combobox",keyword:"SIM",label:"use",align:"right",lwidth:60,reportas:"Down-weighting model",tooltip:"Down-weighting model",range:["S|Similarity","B|BADD"],value:"S",position:[2,2,1,1],showon:{SIM_CBX:[!0]}},SIM:{type:"real_",keyword:"SIM",label:"&nbsp;&nbsp;&nbsp;&nbsp;equal to",align:"right",reportas:"Similarity value",tooltip:"Similarity value (must be given if no sequence is specified in group model)",range:[.1,1],value:"0.35",position:[2,5,1,1],showon:{SIM_CBX:[!0]}},RESMIN_CBX:{type:"checkbox",label:"Down-weighting low resolution data",tooltip:"Check for down-weighting low resolution data",value:!1,position:[3,0,1,1]},RESMIN:{type:"real_",keyword:"RESMIN",label:"R<sub>min</sub> [&Aring;]:",lwidth:60,reportas:"Down-weighting low resolution data",tooltip:"Down-weighting value for low resolution data. Choose a value about the radius of model used.",range:[1,"*"],value:"",position:[3,2,1,1],showon:{RESMIN_CBX:[!0]}},SCALING_CBX:{type:"checkbox",label:"Scaling",tooltip:"Check for scaling reflection data",value:!1,position:[4,0,1,1]},ANISO:{type:"combobox",keyword:"ANISO",label:"use",align:"right",lwidth:60,iwidth:240,reportas:"Scaling model",tooltip:"Scaling model",range:["Y|aniso scaling","C|aniso scaling in RF only","S|aniso scaling in TF only","N|isotropic scaling","K|overall scale factor only"],value:"Y",position:[4,2,1,4],showon:{SCALING_CBX:[!0]}}}},sec3:{type:"section",title:"Model",open:!1,position:[2,0,1,5],contains:{TITLE3:{type:"label",label:"<h3>Change default behaviour for</h3>",position:[0,0,1,4]},SURF_CBX:{type:"checkbox",label:"Additional model modification",tooltip:"Modification of search model (B-factors or using polyalanine model)",value:!1,position:[1,0,1,1]},SEP3:{type:"label",label:"&nbsp;",lwidth:30,position:[1,1,1,1]},SURF:{type:"combobox",keyword:"SURF",label:"",lwidth:0,iwidth:300,tooltip:"Modification of search model (B-factors or using polyalanine model)",range:["Y|Increase B-factors on surface","2|Set all B-factors equal","O|Use B-factors from file","A|Use polyalanine model"],value:"Y",position:[1,2,1,1],showon:{SURF_CBX:[!0]}},SURF_OLBL:{type:"label",label:"and",align:"right",position:[2,0,1,1],showon:{SURF_CBX:[!0],SURF:["O"]}},SURF_PFCBX:{type:"checkbox",label:"Increase B-factors on surface for Packing Function",tooltip:"Modify search model with increasing B-factors on surface for Packing Function calculations",value:!0,position:[2,2,1,1],showon:{SURF_CBX:[!0],SURF:["O"]}},NMR_CBX:{type:"checkbox",label:"Ensemble model",tooltip:"Handling input PDB containing an ensemble or NMR model",value:!1,position:[3,0,1,1]},NMR:{type:"checkbox",label:"average intensities for RF",keyword:"NMR",tooltip:"Average intensities for Rotation Function",value:!0,translate:["0","1"],position:[3,2,1,1],showon:{NMR_CBX:[!0]}}}},sec4:{type:"section",title:"Infrequently used options",open:!1,position:[3,0,1,5],contains:{TITLE4:{type:"label",label:"<h3>Change default behaviour for</h3>",position:[1,0,1,4]},PACK_CBX:{type:"checkbox",label:"Packing function",tooltip:"Using packing function",value:!1,position:[2,0,1,1]},SEP3:{type:"label",label:"&nbsp;",lwidth:30,position:[2,1,1,1]},PACK:{type:"checkbox",label:"do use PF",keyword:"PACK",tooltip:"check for using packing function",value:!0,translate:["N","Y"],position:[2,2,1,1],showon:{PACK_CBX:[!0]}},SCORE_CBX:{type:"checkbox",label:"Scoring function",tooltip:"Using scoring function",value:!1,position:[3,0,1,1]},SCORE:{type:"checkbox",label:"stop adding monomers if score does not improve",keyword:"SCORE",tooltip:"Check to terminate addition of monomers if overall score does not improves",value:!0,translate:["O","Y"],position:[3,2,1,1],showon:{SCORE_CBX:[!0]}}}}}}if("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskMolrep.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskMolrep.prototype.constructor=TaskMolrep,TaskMolrep.prototype.icon=function(){return"task_molrep"},TaskMolrep.prototype.desc_title=function(){return"perform MR using defined ASU and prepared MR models and/or ensembles"},TaskMolrep.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskMolrep.prototype.checkKeywords=function(e){return this.__check_keywords(e,["molrep","molecular","replacement","mr","auto-mr"])},__template){const conf=require("../../js-server/server.configuration");TaskMolrep.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],i.Structure&&("sph"==i.Options.mr_type&&(this.input_data.data.phases=[i.Structure]),i.Structure.hasXYZ()&&(this.input_data.data.xmodel=[i.Structure])),!i.Substructure||"substructure"!=i.Options.leading_structure&&"subph"!=i.Options.mr_type||(this.input_data.data.phases=[i.Substructure])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskMolrep.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.molrep",e,t,this.id]},module.exports.TaskMolrep=TaskMolrep}else TaskMolrep.prototype.hotButtons=function(){return[RefmacHotButton()]},TaskMolrep.prototype.MRTypeChanged=function(e,t){this.title=this.title.split(" (")[0],this.name=this.name.split(" (")[0],"refl"!=t&&(this.title+=" (density fit)",this.name+=" (density fit)");t=e.grid.parent.parent,t.header.title.setText("<b>"+this.title+"</b>"),e=this.name.replace(/<(?:.|\n)*?>/gm,"");t.header.uname_inp.setStyle("text","",e),t.job_dialog.changeTitle(e),t.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node)};var __template=null,conf;function TaskMorda(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskMorda",this.name="morda",this.setOName("morda"),this.title="Auto-MR with MoRDa",this.input_dtypes=[{data_type:{DataRevision:["!protein","!asu","~xyz"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1},{data_type:{DataXYZ:[],DataModel:[],DataEnsemble:[]},label:"Model(s)",inputId:"model",customInput:"model",unchosen_label:"[From MoRDa DB]",tooltip:"Prepare MR search models from this model, do not search for homologues in the database",version:0,min:0,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{ALTGROUPS_CBX:{type:"checkbox",label:"Check alternative space groups",tooltip:"Check to explore compatible space groups",value:!1,position:[0,0,1,3]},NMODELS:{type:"integer_",keyword:"NMODELS",label:"Maximum number of models to try",tooltip:"Choose a value between 1 and 20, or leave blank for automatic choice",range:[1,20],value:"",position:[1,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskMorda.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskMorda.prototype.constructor=TaskMorda,TaskMorda.prototype.icon=function(){return"task_morda"},TaskMorda.prototype.desc_title=function(){return"performs automated molecular replacement protein structure solution using own domain database"},TaskMorda.prototype.platforms=function(){return"LMU"},TaskMorda.prototype.requiredEnvironment=function(){return["CCP4",["$CCP4/share/mrd_data/VERSION","$CCP4/lib/py2/morda/LINKED"]]},TaskMorda.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskMorda.prototype.checkKeywords=function(e){return this.__check_keywords(e,["morda","molecular","replacement","mr","auto-mr"])},__template?(conf=require("../../js-server/server.configuration"),TaskMorda.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskMorda.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.morda",e,t,this.id]},module.exports.TaskMorda=TaskMorda):(TaskMorda.prototype.taskDescription=function(){return"Finds sequence homologs, prepares search models and performs MR"},TaskMorda.prototype.hotButtons=function(){return[CootMBHotButton()]});var __template=null,path,fs,conf,utils;function TaskMrBump(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskMrBump",this.name="mrbump",this.setOName("mrbump"),this.title="Auto-MR with MrBump",this.helpURL="./html/jscofe_task_mrbump.html",this.input_dtypes=[{data_type:{DataRevision:["!protein","!asu","~xyz"]},label:"Structure revision",inputId:"revision",version:0,force:1,min:1,max:1}],this.parameters={SEP_LBL:{type:"label",label:"&nbsp;",position:[0,0,1,5]},sec1:{type:"section",title:"Parameters",open:!0,position:[1,0,1,5],contains:{ALTGROUPS_CBX:{type:"checkbox",label:"Check alternative space groups",tooltip:"Check to explore compatible space groups",value:!1,position:[0,0,1,3]},RLEVEL_SEL:{type:"combobox",keyword:"RLEVEL",label:"PDB sequence redundancy level",tooltip:"Choose appropriate redundancy level for keeping hits in the list of matches. ",range:["ALL|All","100|100%","95|95%","90|90%","70|70%","50|50%"],value:"100",iwidth:100,position:[1,0,1,1]},AFDB_CBX:{type:"checkbox",label:"Include structures from AFDB",tooltip:"Check to include structures from AlphaFold-2 database",value:!0,position:[2,0,1,3]},AFLEVEL_SEL:{type:"combobox",keyword:"AFLEVEL",label:"EBI AlphaFold database model residue confidence cut-off (higher values are more confident)",tooltip:"Choose confidence level (pLDDT) cut-off for residues in AlphaFold predictions.The higher the value the higher the confidence threshold. Residues with lower values are removed from the search models ",range:["0|0","10|10","20|20","30|30","40|40","50|50","60|60","70|70","80|80","90|90"],value:"50",position:[3,0,1,1],hideon:{AFDB_CBX:[!1]}},MRNUM:{type:"integer",keyword:"MRNUM",label:"Maximum no. of models to test",tooltip:"Maximum number of search models to test",range:[1,"*"],value:20,iwidth:40,position:[4,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskMrBump.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskMrBump.prototype.constructor=TaskMrBump,TaskMrBump.prototype.icon=function(){return"task_mrbump"},TaskMrBump.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskMrBump.prototype.checkKeywords=function(e){return this.__check_keywords(e,["mrbump","molecular","replacement","mr","auto-mr","alphafold","alphafold2","af","af2"])},__template?(path=require("path"),fs=require("fs-extra"),conf=require("../../js-server/server.configuration"),utils=require("../../js-server/server.utils"),TaskMrBump.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskMrBump.prototype.cleanJobDir=function(i){var e;__template.TaskTemplate.prototype.cleanJobDir.call(this,i),this.state==__template.job_code.stopped||this.state==__template.job_code.failed?fs.readdirSync(i).forEach(function(t,e){if([__template.jobDataFName,__template.jobReportDirName,__template.jobInputDirName,__template.jobOutputDirName,"output_files","signal","rvapi_document","references.bib","_job.stde","_job.stdo"].indexOf(t)<0&&!t.endsWith(".log")&&!t.endsWith(".meta")&&!t.endsWith(".script")){t=path.join(i,t);if(fs.lstatSync(t).isDirectory())utils.removePath(t);else try{fs.unlinkSync(t)}catch(e){console.log(" +++ cannot remove file "+t+" from failed or terminated MrBump directory")}}}):(e=path.join(i,"search_a"),utils.fileExists(e)&&(console.log(" +++ remove stray directory "+e+" from MrBump job"),utils.removePath(e)))},TaskMrBump.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.mrbump",e,t,this.id]},module.exports.TaskMrBump=TaskMrBump):(TaskMrBump.prototype.desc_title=function(){return"finds sequence homologs, prepares search models and performs MR"},TaskMrBump.prototype.taskDescription=function(){return"Finds sequence homologs, prepares search models and performs MR"},TaskMrBump.prototype.hotButtons=function(){return[CootMBHotButton()]},TaskMrBump.prototype.inputChanged=function(e,t,i){TaskTemplate.prototype.inputChanged.call(this,e,t,i),"revision"!=t&&"seq"!=t||this.state!=job_code.new||(i=this.name,t=e.grid.inpDataRef,this.countInputData(t,"revision","")<=0?(this.name="mrbump-search",this.title="Search for MR Models with MrBump"):(this.name="mrbump",this.title="MrBump Automated Molecular Replacement"),this.name!=i&&((t=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),this.updateInputPanel(t)))},TaskMrBump.prototype.updateInputPanel=function(e){var t;this.state==job_code.new&&(t=new CustomEvent(cofe_signals.jobDlgSignal,{detail:job_dialog_reason.rename_node}),e.element.dispatchEvent(t))});var __template=null,conf;function TaskMrParse(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskMrParse",this.name="mrparse",this.setOName("*"),this.title="Find and prepare MR models with MrParse!",this.input_dtypes=[{data_type:{DataSequence:["protein"]},label:"Sequence",inputId:"seq",min:1,max:1},{data_type:{DataHKL:[]},label:"Reflections",tooltip:"Optional reflection dataset which will be used for phasing in following-up tasks.",inputId:"hkl",force:1,min:0,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{MAX_HITS:{type:"integer",keyword:"max_hits",label:"Maximum number of models to take from each database searched",tooltip:"Specify the number of models to generate from each database searched(from 1 to 40).",range:[1,40],value:5,position:[1,0,1,1]},DATABASE:{type:"combobox",keyword:"database",label:"Databases to search",tooltip:"Choose from PDB, AlphaFold DB or Allkeeping hits in the list of matches. ",range:["all|ALL","pdb|PDB","esmfold|ESMFold","afdb|AFDB"],value:"all",iwidth:100,position:[2,0,1,1]},PLDDT_CUTOFF:{type:"combobox",keyword:"plddt_cutoff",label:"pLDDT cutoff for residue truncation",tooltip:"Specify the pLDDT threshold to remove low confidence residues",range:["50|50","70|70","90|90"],value:70,iwidth:100,position:[3,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskMrParse.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskMrParse.prototype.constructor=TaskMrParse,TaskMrParse.prototype.icon=function(){return"task_mrparse"},TaskMrParse.prototype.desc_title=function(){return"finds relevant PDB/AFDB structures and prepares MR search models from them"},TaskMrParse.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskMrParse.prototype.checkKeywords=function(e){return this.__check_keywords(e,["mrprase","molecular","replacement","mr","model","preparation","mp","alphafold","alphafold2","af","af2"])},__template&&(conf=require("../../js-server/server.configuration"),TaskMrParse.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.mrparse",e,t,this.id]},module.exports.TaskMrParse=TaskMrParse);var __template=null,conf;function TaskNautilus(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskNautilus",this.name="nautilus",this.setOName("nautilus"),this.title="Automatic Model Building of RNA/DNA with Nautilus",this.helpURL="./html/jscofe_task_nautilus.html",this.input_dtypes=[{data_type:{DataRevision:[["rna","dna"],"!asu","!phases"]},label:"Structure revision",inputId:"revision",customInput:"nautilus",version:7,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Options",open:!0,position:[0,0,1,5],contains:{NCYCLES:{type:"integer",keyword:"cycles",label:"Number of cycles of building/refinement to run",tooltip:"Choose a value between 1 and 500",range:[1,500],value:"5",iwidth:40,position:[0,0,1,1]},ANISO_CBX:{type:"checkbox",label:"Apply anisotropy correction to input data",keyword:"nautilus-anisotropy-correction",tooltip:"Check to apply anisotropy correction to input data",value:!0,position:[1,0,1,2]},REFPHASES_CBX:{type:"checkbox",label:"Use phases in refinement",keyword:"refmac-mlhl",tooltip:"Select this option for MR phases in order to reduce bias",value:!1,translate:["0","1"],position:[2,0,1,2]},REFTWIN_CBX:{type:"checkbox",label:"Refine against twinned data",keyword:"refmac-twin",tooltip:"Twin refinement can give better results if data is twinned, but disables phases",value:!1,translate:["0","1"],position:[3,0,1,2]},AUTOWEIGH_CBX:{type:"checkbox",label:"Automatic weighting of restraints",keyword:"refmac-weight",tooltip:"Automatic weighting is safest, otherwise low values preserve geometry at the expense of R-factor",value:!0,position:[4,0,1,2]},WEIGHTVAL:{type:"real",keyword:"refweight",label:"weight value",tooltip:"Automatic weighting is safest, otherwise low values preserve geometry at the expense of R-factor",range:[1e-5,1],value:"0.1",iwidth:40,position:[4,3,1,1],showon:{AUTOWEIGH_CBX:[!1]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskNautilus.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskNautilus.prototype.constructor=TaskNautilus,TaskNautilus.prototype.icon=function(){return"task_nautilus"},TaskNautilus.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskNautilus.prototype.desc_title=function(){return"performs automated building of RNA/DNA from phases"},TaskNautilus.prototype.checkKeywords=function(e){return this.__check_keywords(e,["nautilus","model","building","mr","molecular","replacement","rna","dna","na"])},TaskNautilus.prototype.hotButtons=function(){return[CootMBHotButton()]},__template&&(conf=require("../../js-server/server.configuration"),TaskNautilus.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq,"substructure"==i.Options.leading_structure?(this.input_data.data.istruct=[i.Substructure],this.Structure&&(this.input_data.data.ixyz=[i.Structure])):this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskNautilus.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.nautilus",e,t,this.id]},module.exports.TaskNautilus=TaskNautilus);var __template=null,conf;function TaskOptimiseASU(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskOptimiseASU",this.name="optimise ASU",this.setOName("optimiseasu"),this.title="Optimise Asymmetric Unit",this.input_dtypes=[{data_type:{DataRevision:["!xyz"],DataXYZ:[]},label:"ASU coordinates",cast:"asu",inputId:"idata",version:1,min:1,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskOptimiseASU.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskOptimiseASU.prototype.constructor=TaskOptimiseASU,TaskOptimiseASU.prototype.icon=function(){return"task_optimiseasu"},TaskOptimiseASU.prototype.desc_title=function(){return"makes ASU compact by moving chains via symmetry operations"},TaskOptimiseASU.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskOptimiseASU.prototype.checkKeywords=function(e){return this.__check_keywords(e,["optimise","asu","rearrange"])},TaskOptimiseASU.prototype.hotButtons=function(){return[CootMBHotButton()]},__template&&(conf=require("../../js-server/server.configuration"),TaskOptimiseASU.prototype.makeInputData=function(e,t){var i;"idata"in this.input_data.data&&("Structure"in(i=this.input_data.data.idata[0])&&(this.input_data.data.istruct=[i.Structure])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskOptimiseASU.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.optimiseasu",e,t,this.id]},module.exports.TaskOptimiseASU=TaskOptimiseASU);var __template=null;function TaskPaiRef(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskPaiRef",this.name="pairef",this.setOName("pairef"),this.title="Paired refinement with PAIREF",this.input_dtypes=[{data_type:{DataRevision:["!xyz"]},label:"Structure revision",inputId:"revision",version:4,min:1,max:1}],this.parameters={SEP_LBL:{type:"label",label:"&nbsp;",position:[0,0,1,5]},sec1:{type:"section",title:"Parameters",open:!0,position:[1,0,1,5],contains:{MODE_SEL:{type:"combobox",keyword:"mode",label:"Check",tooltip:"Select either equidistant or arbitrary placed, hi-resolution shells to check for optimal  resolution cut-off.",range:["eqd|equidistant hi-resolution shells","list|given hi-resolution shells"],value:"eqd",iwidth:280,position:[0,0,1,5]},NSHELLS:{type:"integer_",keyword:"nshells",label:"number of hi-resolution shells:",tooltip:"Number of hi-resolution shells to check or leave blank for automatic choice",range:[2,50],value:"",placeholder:"20",iwidth:40,position:[1,2,1,1],showon:{MODE_SEL:["eqd"]}},RSTEP:{type:"real_",keyword:"rstep",label:"of",tooltip:"Thickness of resolution shells",range:[.01,2],value:"",placeholder:"0.05",iwidth:40,label2:"&Aring; each",position:[1,6,1,1],showon:{MODE_SEL:["eqd"]}},RLIST:{type:"string",keyword:"rlist",label:"resolution shells (&Aring;)",tooltip:"Comma-separated list of resolution shells",value:"",placeholder:"e.g., 1.5,1.6,1.75,1.90,2.10",iwidth:450,position:[2,2,1,1],showon:{MODE_SEL:["list"]}},PRENCYC:{type:"integer_",keyword:"prencyc",label:"Start with",tooltip:"Number of pre-refinement cycles to run at the initial low resolution. Put zero for if you do not wish to run them, or leave blank for automatic choice.",range:[0,50],value:"",placeholder:"10",iwidth:40,position:[3,0,1,1]},label:{type:"label",label:"refinement cycles",position:[3,3,1,6]}}}}}if("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskPaiRef.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskPaiRef.prototype.constructor=TaskPaiRef,TaskPaiRef.prototype.icon=function(){return"task_pairef"},TaskPaiRef.prototype.currentVersion=function(){return __template?2+__template.TaskTemplate.prototype.currentVersion.call(this):2+TaskTemplate.prototype.currentVersion.call(this)},TaskPaiRef.prototype.desc_title=function(){return"estimates the optimal high-resolution cut-off"},TaskPaiRef.prototype.checkKeywords=function(e){return this.__check_keywords(e,["pairef","paired","refinement","resolution","cut-off"])},__template||(TaskPaiRef.prototype.collectInput=function(e){e=TaskTemplate.prototype.collectInput.call(this,e);if("list"==this.parameters.sec1.contains.MODE_SEL.value){var t=this.parameters.sec1.contains.RLIST.value.trim().split(",");if(t.length<3)e+="|<b>resolution shells:</b> minimum 3 shells must be specified.";else{for(var i=!0,o=0;o<t.length&&i;o++)t[o].trim()&&isFloat(t[o])||(i=!1);i||(e+="|<b>resolution shells:</b> format violations or empty items.")}}return e}),__template){const conf=require("../../js-server/server.configuration");TaskPaiRef.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure],"file_unm"in i.HKL.aimless_meta&&i.HKL.aimless_meta.file_unm&&this.addInputFile(i.HKL.aimless_meta.jobId,i.HKL.aimless_meta.file_unm,t)),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskPaiRef.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.pairef",e,t,this.id]},module.exports.TaskPaiRef=TaskPaiRef}var __template=null,conf;function TaskParrot(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskParrot",this.name="parrot DM",this.setOName("parrot"),this.title="Density Modification with Parrot",this.input_dtypes=[{data_type:{DataRevision:["phases"]},label:"Structure revision",inputId:"revision",customInput:"parrot",version:7,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{NCYCLES:{type:"integer_",keyword:"cycles",label:"Number of cycles of phase improvement",tooltip:"Choose a value between 1 and 50",range:[1,50],value:"",placeholder:"auto",position:[1,0,1,1]},SOLVENT_CBX:{type:"checkbox",keyword:"solvent-flatten",label:"Solvent flattening",tooltip:"Check to use solvent flattening",value:!0,position:[3,0,1,2]},HISTOGRAM_CBX:{type:"checkbox",keyword:"histogram-match",label:"Histogram matching",tooltip:"Check to use histogram matching",value:!0,position:[4,0,1,2]},ANISO_CBX:{type:"checkbox",keyword:"anisotropy-correction",label:"Anisotropy correction",tooltip:"Check to apply anisotropy correction",value:!0,position:[6,0,1,2]},RESMIN:{type:"real",keyword:"resolution",label:"Truncate data beyond resolution limit [&Aring;]",tooltip:"Truncate resolution limit, in angstroms",range:[.1,"*"],value:"1.0",position:[7,0,1,1]},NCSRAD:{type:"real",keyword:"ncs-mask-filter-radius",label:"Radius for NCS mask determination [&Aring;]",tooltip:"Radius for NCS mask determination, in angstroms",range:[.1,"*"],value:"6.0",position:[8,0,1,1]},TITLE1:{type:"label",label:"<h3><i>Reference structure data</i></h3>",position:[9,0,1,4]},REFMDL_SEL:{type:"combobox",keyword:"REFMDL",label:"Library reference structure to use:",tooltip:"Choose library reference structure",range:["1tqw|1tqw","1ajr|1ajr"],value:"1tqw",position:[10,0,1,1]}}}}}function ParrotHotButton(){return{task:"TaskParrot",tooltip:"Density Modification with Parrot"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskParrot.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskParrot.prototype.constructor=TaskParrot,TaskParrot.prototype.icon=function(){return"task_parrot"},TaskParrot.prototype.doPackSuffixes=function(){return[".mtz_diff.map",".diff.map"]},TaskParrot.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskParrot.prototype.checkKeywords=function(e){return this.__check_keywords(e,["parrot","density","modification","dm"])},__template?(conf=require("../../js-server/server.configuration"),TaskParrot.prototype.makeInputData=function(e,t){if("revision"in this.input_data.data){var i=this.input_data.data.revision[0];switch(this.input_data.data.hkl=[i.HKL],"substructure"==i.Options.leading_structure?this.input_data.data.istruct=[i.Substructure]:this.input_data.data.istruct=[i.Structure],this.input_data.data.seq=i.ASU.seq,i.Options.ncsmodel_sel){case"substructure":this.input_data.data.ncs_struct=[i.Substructure];break;case"model":this.input_data.data.ncs_struct=[i.Structure]}}__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskParrot.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.parrot",e,t,this.id]},module.exports.TaskParrot=TaskParrot):(TaskParrot.prototype.desc_title=function(){return"performs automated density modification"},TaskParrot.prototype.hotButtons=function(){return[ModelCraftHotButton(),BuccaneerHotButton(),ArpWarpHotButton()]});var __template=null;function TaskPDBREDO(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskPDBREDO",this.name="PDB-REDO",this.setOName("pdbredo"),this.title="PDB-REDO: optimise, rebuild, refine and validate",this.input_dtypes=[{data_type:{DataRevision:["!xyz"]},label:"Structure revision",inputId:"revision",version:4,min:1,max:1}],this.parameters={}}if("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskPDBREDO.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskPDBREDO.prototype.constructor=TaskPDBREDO,TaskPDBREDO.prototype.icon=function(){return"task_pdbredo"},TaskPDBREDO.prototype.authorisationID=function(){return"pdb-redo"},TaskPDBREDO.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskPDBREDO.prototype.desc_title=function(){return"automatically optimise, rebuild, refine and validate structure model"},TaskPDBREDO.prototype.checkKeywords=function(e){return this.__check_keywords(e,["pdbredo","pdb-redo","refinement","rebuild","rebuilding","optimise","optimisation","validate","validation"])},__template){const path=require("path"),conf=require("../../js-server/server.configuration"),user=require("../../js-server/server.fe.user"),utils=require("../../js-server/server.utils");TaskPDBREDO.prototype.makeInputData=function(e,t){"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure]);var i=user.readUserData(e),o={status:"ok"};i?"authorisation"in i&&"pdb-redo"in i.authorisation?(o.auth_data=i.authorisation["pdb-redo"],new Date(o.auth_data.expiry_date).getTime()<Date.now()&&(o.status="expired")):o.status="no authorisation data":o.status="no user data",utils.writeObject(path.join(t,"input","authorisation.json"),o),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskPDBREDO.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.pdbredo",e,t,this.id]},module.exports.TaskPDBREDO=TaskPDBREDO}var __template=null,conf;function TaskPISA(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskPISA",this.name="pisa",this.setOName("pisa"),this.title="Surface, Interfaces and Assembly Analysis with PISA",this.input_dtypes=[{data_type:{DataStructure:["!xyz"],DataXYZ:[]},label:"Structure",inputId:"xyz",customInput:"pisa",min:1,max:1}],this.parameters={sec1:{type:"section",title:"Advanced parameters",open:!1,position:[0,0,1,5],contains:{LIGANDKEY_SEL:{type:"combobox",keyword:"ligand_key",label:"Ligand to exclude:",tooltip:'In most cases, exclude ligands that were added as crystallisation agents. The "common agents" option will automatically exclude common suspects, and should be used routinely. When choose "as listed", give a comma-separated list of 3-letter ligand codes.',range:["(agents)|common crystallisation agents","(all)|all","none|none","list|as listed"],value:"(agents)",position:[0,0,1,1]},LIGAND_LIST:{type:"string_",keyword:"codes",label:"",tooltip:"Comma-separated list of 3-letter ligand codes to exclude",iwidth:380,value:"",position:[0,4,1,1],showon:{LIGANDKEY_SEL:["list"]}},LIGANDMODE_SEL:{type:"combobox",keyword:"ligand_mode",label:"Ligand processing mode:",tooltip:'This option is more for testing and development, yet can be used in exceptional cases. For routine use, always choose "Auto", otherwise check with documentation.',range:["auto|auto","fixed|fixed","free|free"],value:"auto",position:[1,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskPISA.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskPISA.prototype.constructor=TaskPISA,TaskPISA.prototype.icon=function(){return"task_pisa"},TaskPISA.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskPISA.prototype.desc_title=function(){return"calculates macromolecular surfaces, interfaces and their various properties, and predicts macromolecular assemblies"},TaskPISA.prototype.checkKeywords=function(e){return this.__check_keywords(e,["pisa","surface","interfaces","assembly","analysis","assemblies","complexes","toolbox","interaction"])},__template?(conf=require("../../js-server/server.configuration"),TaskPISA.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.pisa",e,t,this.id]},module.exports.TaskPISA=TaskPISA):TaskPISA.prototype.collectInput=function(e){var t,e=TaskTemplate.prototype.collectInput.call(this,e);return"list"==this.parameters.sec1.contains.LIGANDKEY_SEL.value&&((t=this.parameters.sec1.contains.LIGAND_LIST.value.trim().split(",")).length<1||""==t[0])&&(e+="|<b>List of ligands:</b> list of ligands to exclude is empty. Either provide a comma-separated list of ligands to exclude from analysis or choose another ligand exclusion option."),e};var __template=null,conf;function TaskPhaserEP(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskPhaserEP",this.name="phaser EP",this.setOName("phaser-ep"),this.title="Experimental Phasing with Phaser-EP",this.input_dtypes=[{data_type:{DataRevision:["!anomalous","!asu",["xyz","substructure"]]},label:"Structure revision",inputId:"revision",customInput:"phaser-ep",version:7,min:1,max:1}],this.parameters={SEP0_LABEL:{type:"label",label:"&nbsp;",position:[0,0,1,5]},sec1:{type:"section",title:"Main options",open:!0,position:[1,0,1,5],contains:{LLG_SEL:{type:"combobox",keyword:"LLG",label:"LLG map completion",tooltip:"Choose LLG map completion mode",iwidth:250,range:["ON|on: all atom types","OFF|off","SEL|on: selected atom types"],value:"SEL",position:[0,0,1,3]},LLG_REAL_CBX:{type:"checkbox",label:"complete with purely real scatterers",tooltip:"Check to complete LLG map with purely real scatterers.",iwidth:350,value:!1,position:[1,2,1,3],showon:{LLG_SEL:["SEL"]}},LLG_ANOM_CBX:{type:"checkbox",label:"complete with purely anomalous scatterers",tooltip:"Check to complete LLG map with purely real scatterers.",iwidth:350,value:!1,position:[2,2,1,3],showon:{LLG_SEL:["SEL"]}},LLG_ATYPE:{type:"string_",keyword:"atomtype=",label:"complete with atom type(s)",tooltip:"Give a comma-separated list of atom types to be used to complete the LLG map.",iwidth:160,value:"",position:[3,2,1,1],showon:{LLG_SEL:["SEL"]}}}},sec2:{type:"section",title:"Accessory parameters",open:!1,position:[2,0,1,5],contains:{RESTRAIN_F11_SEL:{type:"combobox",keyword:"RESTRAIN_F11",label:'Restrain f" to starting value',tooltip:'Choose f" restrain mode',iwidth:80,range:["ON|on","OFF|off"],value:"ON",position:[0,0,1,1]},RESTRAIN_F11_SIGMA:{type:"real",keyword:"RESTRAIN_F11_SIGMA",label:"&nbsp;&nbsp;&nbsp;Sigma of restraint",align:"right",iwidth:50,default:"0.2",tooltip:"Choose a value between 0 and 1, or leave blank for automatic choice",range:[.001,1],value:"0.2",label2:'(times initial f")',position:[0,3,1,1],showon:{RESTRAIN_F11_SEL:["ON"]}},LLG_MAP_SIGMA:{type:"real",keyword:"LLG_MAP_SIGMA",label:"LLG map sigma cut-off for adding new atom sites",iwidth:50,default:"6.0",tooltip:"Choose a value between 0 and 100, or leave blank for automatic choice",range:[.001,100],value:"6.0",position:[1,0,1,1]},LLG_MAP_DIST_SEL:{type:"combobox",keyword:"LLG_MAP_DIST_SEL",label:"LLG map inter-atom distance cut-off default",tooltip:"Choose inter-atom distance cut-off mode",iwidth:80,range:["ON|on","OFF|off"],value:"ON",position:[2,0,1,1]},LLG_MAP_DIST:{type:"real",keyword:"LLG_MAP_DIST",label:"&nbsp;&nbsp;&nbsp;distance",align:"right",iwidth:50,default:"2.0",tooltip:"Choose a value between 0 and 100, or leave blank for automatic choice",range:[.001,100],value:"2.0",position:[2,3,1,1],showon:{LLG_MAP_DIST_SEL:["OFF"]}},LLG_NCYCLES:{type:"integer",keyword:"LLG_NCYCLES",label:"Maximum number of LLG-map completion cycles",iwidth:50,default:"50",tooltip:"Choose a value between 1 and 200, or leave blank for automatic choice",range:[1,200],value:"50",position:[3,0,1,1]},LLG_MAP_PEAKS_SEL:{type:"combobox",keyword:"LLG_MAP_PEAKS_SEL",label:"LLG-map completion picks peaks from",tooltip:"Choose the source of peaks",iwidth:240,range:["ATOMTYPE|all atom type LLG-maps","IMAGINARY|imaginary LLG-map only"],value:"ATOMTYPE",position:[4,0,1,3]}}},sec3:{type:"section",title:"Expert parameters",open:!1,position:[3,0,1,5],contains:{WILSON_BFACTOR_SEL:{type:"combobox",keyword:"WILSON_BFACTOR_SEL",label:"Set B-factors to Wilson B-factor",tooltip:"Choose the B-factors treatment mode",iwidth:80,range:["ON|on","OFF|off"],value:"ON",position:[0,0,1,1]}}}}}function PhaserEPHotButton(){return{task:"TaskPhaserEP",tooltip:"Calculate Experimental Phases with Phaser-EP"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskPhaserEP.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskPhaserEP.prototype.constructor=TaskPhaserEP,TaskPhaserEP.prototype.icon=function(){return"task_phaserep"},TaskPhaserEP.prototype.desc_title=function(){return"perform EP using a defined ASU and heavy-atom substructure"},TaskPhaserEP.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskPhaserEP.prototype.checkKeywords=function(e){return this.__check_keywords(e,["phaser","experimental","phasing","auto-ep","ep","substructure"])},__template?(conf=require("../../js-server/server.configuration"),TaskPhaserEP.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq,"substructure"==i.Options.phasing_sel?this.input_data.data.substructure=[i.Substructure]:this.input_data.data.xmodel=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskPhaserEP.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.phaserep",e,t,this.id]},module.exports.TaskPhaserEP=TaskPhaserEP):(TaskPhaserEP.prototype.getHelpURL=function(){return __task_reference_base_url+"doc.task.Phaser.html"},TaskPhaserEP.prototype.hotButtons=function(){return[ParrotHotButton(),AcornHotButton(),ShelxEMRHotButton(),CCP4BuildHotButton()]},TaskPhaserEP.prototype.inputChanged=function(e,t,i){function o(e,t){return e.split(" (")[0]+" ("+t+")"}var n,s,a,r,l,c;"revision"!=t&&"substructure"!=t&&"xmodel"!=t||(s=e.grid.inpDataRef,n=(n=this.getInputItem(s,"revision").dropdown[0]).dt[n.getValue()],s=this.getInputItem(s,"substructure"),a=0<=n.subtype.indexOf("substructure"),r=0<=n.subtype.indexOf("xyz"),l=this.name,(c=e.parameters.LLG_ATYPE.input).getValue()||c.setValue(n.ASU.ha_type),s&&(s=s.dropdown[0],e.grid.setRowVisible(s.row,!a)),r?(this.title=o(this.title,"MR-SAD"),this.name=o(this.name,"MR-SAD")):(this.title=o(this.title,"SAD"),this.name=o(this.name,"SAD")),this.name!=l&&((c=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),c.header.uname_inp.setStyle("text","",this.name.replace(/<(?:.|\n)*?>/gm,"")),this.updateInputPanel(c),c.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node))),TaskTemplate.prototype.inputChanged.call(this,e,t,i)},TaskPhaserEP.prototype.collectInput=function(e){var i=TaskTemplate.prototype.collectInput.call(this,e);function t(e,t){i+="|<b>"+e+":</b> "+t}e=this.parameters.sec1.contains;return"SEL"!=e.LLG_SEL.value||e.LLG_REAL_CBX.value||e.LLG_ANOM_CBX.value||""!=e.LLG_ATYPE.value.trim()||t(e.LLG_SEL.label,"Value of "+e.LLG_SEL.label+' in "<i>'+this.parameters.sec1.title+'</i>" does not specify any atom types to complete the map, which is not allowed'),i});var __template=null;function TaskPhaserMR(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskPhaserMR",this.name="phaser MR",this.setOName("phaser-mr"),this.title="Molecular Replacement with Phaser",this.input_dtypes=[{data_type:{DataRevision:["hkl"]},label:"Structure revision",inputId:"revision",customInput:"phaser-mr1",version:0,min:1,max:1},{data_type:{DataEnsemble:[],DataModel:[]},label:"Model ensemble",inputId:"model",customInput:"phaser-mr",min:1,max:1e3}],this.parameters={sep0:{type:"label",label:"&nbsp;",position:[0,0,1,5]},sec0:{type:"section",title:"Rotation and translation target function parameters",open:!1,position:[1,0,1,5],contains:{RF_TARGET_SEL:{type:"combobox",keyword:"TARGET ROT",label:"Rotation function search target",tooltip:"TARGET: Select the rotation target function to be used",iwidth:180,range:["FAST|Fast","BRUTE|Brute"],value:"FAST",position:[0,0,1,1]},RF_ANGLE_SEL:{type:"combobox",keyword:"ROTATE VOLUME",label:"Search",align:"right",tooltip:"Select angular search mode",iwidth:180,range:["AROUND|Around an angle","FULL|All angles"],value:"AROUND",position:[1,0,1,1],showon:{RF_TARGET_SEL:["BRUTE"]}},RF_ALPHA:{type:"real",keyword:"EULER",label:"&alpha;:",lwidth:30,align:"right",iwidth:50,default:"0.0",tooltip:"Choose a value between 0 and 180",range:[0,180],value:"0.0",position:[1,3,1,1],showon:{_:"&&",RF_TARGET_SEL:["BRUTE"],RF_ANGLE_SEL:["AROUND"]}},RF_BETA:{type:"real",keyword:"BETA",label:"&beta;:",lwidth:30,align:"right",iwidth:50,default:"0.0",tooltip:"Choose a value between 0 and 180",range:[0,180],value:"0.0",position:[1,6,1,1],showon:{_:"&&",RF_TARGET_SEL:["BRUTE"],RF_ANGLE_SEL:["AROUND"]}},RF_GAMMA:{type:"real",keyword:"GAMMA",label:"&gamma;:",lwidth:30,align:"right",iwidth:50,default:"0.0",tooltip:"Choose a value between 0 and 180",range:[0,180],value:"0.0",position:[1,9,1,1],showon:{_:"&&",RF_TARGET_SEL:["BRUTE"],RF_ANGLE_SEL:["AROUND"]}},RF_RANGE:{type:"real",keyword:"RANGE",label:"Range:",lwidth:50,align:"right",iwidth:50,default:"10.0",tooltip:"Choose a value between 0 and 360",range:[0,360],value:"10.0",position:[1,12,1,1],showon:{_:"&&",RF_TARGET_SEL:["BRUTE"],RF_ANGLE_SEL:["AROUND"]}},RF_CLUSTER_SEL:{type:"combobox",keyword:"PEAKS ROT CLUSTER",label:"Cluster rotation peaks before passing to TF",tooltip:"Select whether clustered or raw peaks are saved",iwidth:180,range:["ON|On","OFF|Off"],value:"ON",position:[2,0,1,1],showon:{RF_TARGET_SEL:["FAST"]}},TF_TARGET_SEL:{type:"combobox",keyword:"TARGET TRA",label:"Translation function search target",tooltip:"TARGET: Select the translation target function to be used",iwidth:180,range:["FAST|Fast","BRUTE|Brute"],value:"FAST",position:[3,0,1,1]},TF_POINT_SEL:{type:"combobox",keyword:"TRANSLATE VOLUME",label:"Search",align:"right",tooltip:"Select translation search mode",iwidth:180,range:["AROUND|Around a point","FULL|All points"],value:"AROUND",position:[4,0,1,1],showon:{TF_TARGET_SEL:["BRUTE"]}},TF_SPACE_SEL:{type:"combobox",keyword:"TRANSLATE",label:"Space",align:"right",tooltip:"Select orthogonal or fractional space",iwidth:180,range:["ORTH|Orthogonal","FRAC|Fractional"],value:"ORTH",position:[5,0,1,1],showon:{_:"&&",TF_TARGET_SEL:["BRUTE"],TF_POINT_SEL:["AROUND"]}},TF_X:{type:"real",keyword:"POINT",label:"X:",lwidth:30,align:"right",iwidth:50,default:"0.0",tooltip:"Choose a value between 0 and 180",range:[0,180],value:"0.0",position:[5,3,1,1],showon:{_:"&&",TF_TARGET_SEL:["BRUTE"],TF_POINT_SEL:["AROUND"]}},TF_Y:{type:"real",keyword:"BETA",label:"Y:",lwidth:30,align:"right",iwidth:50,default:"0.0",tooltip:"Choose a value between 0 and 180",range:[0,180],value:"0.0",position:[5,6,1,1],showon:{_:"&&",TF_TARGET_SEL:["BRUTE"],TF_POINT_SEL:["AROUND"]}},TF_Z:{type:"real",keyword:"GAMMA",label:"Z:",lwidth:30,align:"right",iwidth:50,default:"0.0",tooltip:"Choose a value between 0 and 180",range:[0,180],value:"0.0",position:[5,9,1,1],showon:{_:"&&",TF_TARGET_SEL:["BRUTE"],TF_POINT_SEL:["AROUND"]}},TF_RANGE:{type:"real",keyword:"RANGE",label:"Range:",lwidth:50,align:"right",iwidth:50,default:"10.0",tooltip:"Choose a value between 0 and 360",range:[0,360],value:"10.0",position:[5,12,1,1],showon:{_:"&&",TF_TARGET_SEL:["BRUTE"],TF_POINT_SEL:["AROUND"]}}}},sec1:{type:"section",title:"Search options",open:!1,position:[1,0,1,5],contains:{TNCS_SEL:{type:"combobox",keyword:"TNCS USE",label:"Use translational NCS if present",tooltip:"Check to use translational NCS if present",iwidth:220,range:["ON|on","OFF|off"],value:"ON",position:[0,0,1,1]},TNCS_LABEL:{type:"label",label:"Number of TNCS-related assemblies",position:[0,3,1,5],showon:{TNCS_SEL:["ON"]}},TNCS_NA:{type:"integer_",keyword:"TNCS NMOL",label:"",lwidth:0,iwidth:50,default:"2",tooltip:"Choose a value between 1 and 200, or leave blank for automatic choice",range:[1,200],value:"2",position:[0,4,1,1],showon:{TNCS_SEL:["ON"]}},PACK_SEL:{type:"combobox",keyword:"PACK SELECT",label:"Packing criterion",iwidth:220,tooltip:"Packing criterion",range:["PERCENT|pairwise percent","ALL|accept all solutions"],value:"PERCENT",position:[1,0,1,1]},PACK_CUTOFF:{type:"integer_",keyword:"PACK CUTOFF",label:"Cutoff (%)",iwidth:50,default:"5",tooltip:"Default value is 5%; increase for low-homology searches",range:[1,99],value:"5",position:[1,3,1,1],showon:{PACK_SEL:["PERCENT"]}},RS_PEAKS_SEL:{type:"combobox",keyword:"PEAKS ROT SELECT",label:"Rotation search peak selection",iwidth:220,tooltip:"Peaks selection",range:["PERCENT|percentage of top peak","SIGMA|sigma (Z-score) cutoff","NUMBER|number of peaks","ALL|all peaks"],value:"PERCENT",position:[2,0,1,1]},RS_PEAKS_P_CUTOFF:{type:"integer_",keyword:"PEAKS ROT CUTOFF",label:"Cutoff (%)",iwidth:50,default:"75",tooltip:"Choose a value between 1 and 99, or leave blank for automatic choice",range:[1,99],value:"75",position:[2,3,1,1],showon:{RS_PEAKS_SEL:["PERCENT"]}},RS_PEAKS_S_CUTOFF:{type:"real_",keyword:"PEAKS ROT CUTOFF",label:"Cutoff",iwidth:50,default:"2.0",tooltip:"Choose a value between 0 and 10, or leave blank for automatic choice",range:[1,10],value:"2.0",position:[2,3,1,1],showon:{RS_PEAKS_SEL:["SIGMA"]}},RS_PEAKS_N_CUTOFF:{type:"integer_",keyword:"PEAKS ROT CUTOFF",label:"Cutoff (N<sub>peaks</sub>)",iwidth:50,default:"30",tooltip:"Choose a value between 1 and 200, or leave blank for automatic choice",range:[1,200],value:"30",position:[2,3,1,1],showon:{RS_PEAKS_SEL:["NUMBER"]}},TS_PEAKS_SEL:{type:"combobox",keyword:"PEAKS TRA SELECT",label:"Translation search peak selection",iwidth:220,tooltip:"Peaks selection",range:["PERCENT|percentage of top peak","SIGMA|sigma (Z-score) cutoff","NUMBER|number of peaks","ALL|all peaks"],value:"PERCENT",position:[3,0,1,1]},TS_PEAKS_P_CUTOFF:{type:"integer_",keyword:"PEAKS TRA CUTOFF",label:"Cutoff (%)",iwidth:50,default:"75",tooltip:"Choose a value between 1 and 99, or leave blank for automatic choice",range:[1,99],value:"75",position:[3,3,1,1],showon:{TS_PEAKS_SEL:["PERCENT"]}},TS_PEAKS_S_CUTOFF:{type:"real_",keyword:"PEAKS TRA CUTOFF",label:"Cutoff",iwidth:50,default:"2.0",tooltip:"Choose a value between 0 and 10, or leave blank for automatic choice",range:[1,10],value:"2.0",position:[3,3,1,1],showon:{TS_PEAKS_SEL:["SIGMA"]}},TS_PEAKS_N_CUTOFF:{type:"integer_",keyword:"PEAKS TRA CUTOFF",label:"Cutoff (N<sub>peaks</sub>)",iwidth:50,default:"30",tooltip:"Choose a value between 1 and 200, or leave blank for automatic choice",range:[1,200],value:"30",position:[3,3,1,1],showon:{TS_PEAKS_SEL:["NUMBER"]}},DR_SEARCH_SEL:{type:"combobox",keyword:"",label:"Deep rotation search",iwidth:220,tooltip:"Second pass through rotation peaks for translation search",range:["ON|on","OFF|off"],value:"ON",position:[4,0,1,1]},DR_SEARCH_DOWN:{type:"integer_",keyword:"PEAKS ROT DOWN",label:"Down (%)",iwidth:50,default:"15",tooltip:"Choose a value between 1 and 99, or leave blank for automatic choice",range:[1,99],value:"15",position:[4,3,1,1],showon:{DR_SEARCH_SEL:["ON"]}},PURGE_ROT_SEL:{type:"combobox",keyword:"PURGE ROT ENABLE",label:"Purge rotation peaks",iwidth:220,tooltip:"Choose whether to purge the solutions from RF (Rotation Function)",range:["ON|on","OFF|off"],value:"ON",position:[5,0,1,1]},PURGE_ROT_CUTOFF:{type:"integer_",keyword:"PURGE ROT PERCENT",label:"Cutoff (%)",iwidth:50,default:"75",tooltip:"Choose a value between 1 and 99, or leave blank for automatic choice",range:[1,99],value:"75",position:[5,3,1,1],showon:{PURGE_ROT_SEL:["ON"]}},PURGE_ROT_NUMBER:{type:"integer_",keyword:"PURGE ROT NUMBER",label:"Max number",align:"right",lwidth:85,iwidth:50,default:"100",tooltip:"Choose a value between 1 and 99, or leave blank for automatic choice",range:[1,100],value:"",position:[5,6,1,1],showon:{PURGE_ROT_SEL:["ON"]}},PURGE_TRA_SEL:{type:"combobox",keyword:"PURGE TRA ENABLE",label:"Purge translation peaks",iwidth:220,tooltip:"Choose whether to purge the solutions from TF (Translation Function)",range:["ON|on","OFF|off"],value:"ON",position:[6,0,1,1]},PURGE_TRA_CUTOFF:{type:"integer_",keyword:"PURGE TRA PERCENT",label:"Cutoff (%)",iwidth:50,default:"75",tooltip:"Choose a value between 1 and 99, or leave blank for automatic choice",range:[1,99],value:"75",position:[6,3,1,1],showon:{PURGE_TRA_SEL:["ON"]}},PURGE_TRA_NUMBER:{type:"integer_",keyword:"PURGE TRA NUMBER",label:"Max number",align:"right",lwidth:85,iwidth:50,default:"40",tooltip:"Choose a value between 1 and 40, or leave blank for automatic choice",range:[1,40],value:"",position:[6,6,1,1],showon:{PURGE_TRA_SEL:["ON"]}},PURGE_RNP_SEL:{type:"combobox",keyword:"PURGE RNP ENABLE",label:"Purge refinement peaks",iwidth:220,tooltip:"Choose whether to purge the solutions from RNP (Translation Function)",range:["ON|on","OFF|off"],value:"ON",position:[7,0,1,1]},PURGE_RNP_CUTOFF:{type:"integer_",keyword:"PURGE RNP PERCENT",label:"Cutoff (%)",iwidth:50,default:"75",tooltip:"Choose a value between 1 and 99, or leave blank for automatic choice",range:[1,99],value:"75",position:[7,3,1,1],showon:{PURGE_RNP_SEL:["ON"]}},PURGE_RNP_NUMBER:{type:"integer_",keyword:"PURGE RNP NUMBER",label:"Max number",align:"right",lwidth:85,iwidth:50,default:"20",tooltip:"Choose a value between 1 and 20, or leave blank for automatic choice",range:[1,20],value:"",position:[7,6,1,1],showon:{PURGE_RNP_SEL:["ON"]}}}},sec2:{type:"section",title:"Output control",open:!1,position:[2,0,1,5],contains:{TOPFILES:{type:"integer_",keyword:"TOPFILES",label:"Number of top solutions to output",default:"1",tooltip:"Choose a value between 1 and 20, or leave blank for automatic choice",range:[1,20],value:"",position:[0,0,1,1]}}},sec3:{type:"section",title:"Expert parameters",open:!1,position:[3,0,1,5],contains:{SEARCH_METHOD_SEL:{type:"combobox",keyword:"SEARCH METHOD",label:"Search method for many copies in ASU",iwidth:80,tooltip:"Use FAST if you expect the TFZ to be high for each copy",range:["FAST|fast","FULL|full"],value:"FAST",position:[0,0,1,1]},PERMUTE_SEL:{type:"combobox",keyword:"PERMUTATIONS",label:"Permute search order",iwidth:80,tooltip:"Permute search order",range:["ON|on","OFF|off"],value:"OFF",position:[0,3,1,1],showon:{SEARCH_METHOD_SEL:["FULL"]}},SEARCH_PRUNE_SEL:{type:"combobox",keyword:"SEARCH PRUNE",label:"Prune high TFZ packing rejects",iwidth:80,tooltip:"High TFZ prunning parameter",range:["ON|on","OFF|off"],value:"ON",position:[1,0,1,1]},TRA_PACKING_SEL:{type:"combobox",keyword:"TRANSLATION PACKING USE",label:"Check for packing in translation function",iwidth:80,tooltip:"Translation function packing",range:["ON|on","OFF|off"],value:"ON",position:[2,0,1,1]},TRA_PACKING_OVERLAP:{type:"integer_",keyword:"TRANSLATION PACKING CUTOFF",label:"Overlap percent allowed",default:"50",tooltip:"Choose a value between 1 and 99, or leave blank for automatic choice",range:[1,99],value:"",position:[2,3,1,1],showon:{TRA_PACKING_SEL:["ON"]}},FORMFACTORS_SEL:{type:"combobox",keyword:"FORMFACTORS",label:"Formfactors from",tooltip:"Choose source for scattering factors",range:["XRAY|x-ray scattering","ELECTRON|electron scattering","NEUTRON|neutron scattering"],value:"XRAY",position:[3,0,1,2]}}}}}if("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskPhaserMR.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskPhaserMR.prototype.constructor=TaskPhaserMR,TaskPhaserMR.prototype.icon=function(){return"task_phasermr"},TaskPhaserMR.prototype.desc_title=function(){return"perform MR using a defined ASU and prepared MR models and/or ensembles"},TaskPhaserMR.prototype.currentVersion=function(){return __template?2+__template.TaskTemplate.prototype.currentVersion.call(this):2+TaskTemplate.prototype.currentVersion.call(this)},TaskPhaserMR.prototype.checkKeywords=function(e){return this.__check_keywords(e,["phaser","molecular","replacement","mr"])},__template){const conf=require("../../js-server/server.configuration"),dstruct=require("../../js-common/dtypes/common.dtypes.structure");TaskPhaserMR.prototype.makeInputData=function(e,t){if("revision"in this.input_data.data){var i=this.input_data.data.revision[0];if(this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq,"phaser_meta"in i&&["edfit","ignore"].indexOf(i.Options.structure_sel)<0){var o,n=i.phaser_meta.ensembles;for(o in n)this.input_data.data[o]=[n[o].data];this.input_data.data.sol=[i.phaser_meta.sol]}i.Structure&&("sph"==i.Options.mr_type&&(this.input_data.data.phases=[i.Structure]),0<=i.Structure.subtype.indexOf(dstruct.structure_subtype.XYZ)&&(this.input_data.data.xmodel=[i.Structure])),!i.Substructure||"substructure"!=i.Options.leading_structure&&"subph"!=i.Options.mr_type||(this.input_data.data.phases=[i.Substructure])}__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskPhaserMR.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.phasermr",e,t,this.id]},module.exports.TaskPhaserMR=TaskPhaserMR}else TaskPhaserMR.prototype.getHelpURL=function(){return __task_reference_base_url+"doc.task.Phaser.html"},TaskPhaserMR.prototype.hotButtons=function(){return[RefmacHotButton()]},TaskPhaserMR.prototype.MRTypeChanged=function(e,t){this.title=this.title.split(" (")[0],this.name=this.name.split(" (")[0],"refl"!=t&&(this.title+=" (density fit)",this.name+=" (density fit)");t=e.grid.parent.parent,t.header.title.setText("<b>"+this.title+"</b>"),e=this.name.replace(/<(?:.|\n)*?>/gm,"");t.header.uname_inp.setStyle("text","",e),t.job_dialog.changeTitle(e),t.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node)};var __template=null;function TaskPhaserRB(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskPhaserRB",this.name="phaser RB",this.setOName("phaser-rb"),this.title="Rigid-Body Refinement with Phaser",this.input_dtypes=[{data_type:{DataRevision:["!hkl","!asu","!xyz"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1}],this.parameters={}}if("undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskPhaserRB.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskPhaserRB.prototype.constructor=TaskPhaserRB,TaskPhaserRB.prototype.icon=function(){return"task_phaserrb"},TaskPhaserRB.prototype.desc_title=function(){return"optimises position of macromolecular chains"},TaskPhaserRB.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskPhaserRB.prototype.checkKeywords=function(e){return this.__check_keywords(e,["phaser","rigid","body","refinement"])},__template){const conf=require("../../js-server/server.configuration"),dstruct=require("../../js-common/dtypes/common.dtypes.structure");TaskPhaserRB.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq,i.Structure&&0<=i.Structure.subtype.indexOf(dstruct.structure_subtype.XYZ)&&(this.input_data.data.xyz=[i.Structure])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskPhaserRB.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.phaserrb",e,t,this.id]},module.exports.TaskPhaserRB=TaskPhaserRB}else TaskPhaserRB.prototype.hotButtons=function(){return[RefmacHotButton()]};var __template=null,conf;function TaskPrivateer(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskPrivateer",this.name="privateer",this.setOName("privateer"),this.title="Validation of carbohydrate structures with Privateer",this.input_dtypes=[{data_type:{DataRevision:["xyz"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskPrivateer.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskPrivateer.prototype.constructor=TaskPrivateer,TaskPrivateer.prototype.icon=function(){return"task_privateer"},TaskPrivateer.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskPrivateer.prototype.desc_title=function(){return"validates carbohydrate structures"},TaskPrivateer.prototype.checkKeywords=function(e){return this.__check_keywords(e,["privateer","validation","carbohydrate","sugar","monosaccharide","structure"])},__template&&(conf=require("../../js-server/server.configuration"),TaskPrivateer.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskPrivateer.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.privateer",e,t,this.id]},module.exports.TaskPrivateer=TaskPrivateer);var __template=null,conf;function TaskRabdam(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskRabdam",this.name="rabdam",this.setOName("rabdam"),this.title="Rabdam",this.input_dtypes=[{data_type:{DataRevision:["xyz"],DataEnsemble:[],DataModel:[],DataXYZ:[]},label:"Structure",inputId:"ixyz",min:1,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskRabdam.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskRabdam.prototype.constructor=TaskRabdam,TaskRabdam.prototype.icon=function(){return"task_rabdam"},TaskRabdam.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskRabdam.prototype.checkKeywords=function(e){return this.__check_keywords(e,["rabdam","radiation","damage","analysis"])},__template?(conf=require("../../js-server/server.configuration"),TaskRabdam.prototype.makeInputData=function(e,t){var i=this.input_data.data.ixyz[0];"DataRevision"==i._type&&(this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskRabdam.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.rabdam",e,t,this.id]},module.exports.TaskRabdam=TaskRabdam):TaskRabdam.prototype.desc_title=function(){return"estimates the extent of specific radiation damage"};var __template=null,conf;function TaskRampage(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskRampage",this.name="rampage",this.setOName("rampage"),this.title="Rampage",this.input_dtypes=[{data_type:{DataRevision:["xyz"],DataEnsemble:[],DataModel:[],DataXYZ:[]},label:"Structure",inputId:"ixyz",min:1,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskRampage.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskRampage.prototype.constructor=TaskRampage,TaskRampage.prototype.icon=function(){return"task_rampage"},TaskRampage.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskRampage.prototype.checkKeywords=function(e){return this.__check_keywords(e,["rampage","ramachandran","analysis"])},__template?(conf=require("../../js-server/server.configuration"),TaskRampage.prototype.makeInputData=function(e,t){var i=this.input_data.data.ixyz[0];"DataRevision"==i._type&&(this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskRampage.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.rampage",e,t,this.id]},module.exports.TaskRampage=TaskRampage):TaskRampage.prototype.desc_title=function(){return"Ramachandran plots and analysis"};var __template=null,conf;function TaskRefmac(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskRefmac",this.name="refmac5",this.setOName("refmac"),this.title="Refinement with Refmac",this.input_dtypes=[{data_type:{DataRevision:["!xyz"]},label:"Structure revision",inputId:"revision",customInput:"refmac",version:1,min:1,max:1},{data_type:{DataXYZ:["protein","dna","rna"]},label:"Homologous model",inputId:"hmodel",min:0,max:10},{data_type:{DataStructure:["!phases","!EP"]},label:"External phases",cast:"phases",tooltip:"External phases",inputId:"phases",version:0,min:0,max:1}],this.parameters={sec1:{type:"section",title:"Basic options",open:!0,position:[0,0,1,5],contains:{NCYC:{type:"integer",keyword:"none",label:"Number of refinement cycles",tooltip:"Number of refinement cycles",range:[0,"*"],value:"10",position:[0,0,1,1]},WAUTO_YES:{type:"combobox",keyword:"none",label:"Overall data-geometry weight",tooltip:"Overall Data-geometry weight",range:["yes|Auto","no|Fixed"],value:"yes",position:[1,0,1,1]},WAUTO_VAL:{type:"real",keyword:"none",label:"value",tooltip:"Weight for X-ray term",range:[0,"*"],value:"0.01",showon:{WAUTO_YES:["no"]},position:[1,3,1,1]},WAUTO_VAL_AUTO:{type:"real_",keyword:"none",label:"starting value",tooltip:"Weight for X-ray term",range:[0,"*"],value:"",default:"",showon:{WAUTO_YES:["yes"]},position:[1,3,1,1]},VDW_VAL:{type:"real_",keyword:"none",label:"VDW repulsion weight",tooltip:"Weight factor for the VDW repulsion (leave blank for default value)",range:[0,"*"],value:"",position:[2,0,1,1]},MKHYDR:{type:"combobox",keyword:"none",label:"Generate H-atoms for refinement",tooltip:"Select how to represent hydrogen atoms in refinement",range:["NO|No","YES|Yes if in input file","ALL|Yes"],value:"ALL",position:[3,0,1,3]}}},sec2:{type:"section",title:"Model Parameterisation",open:!1,position:[1,0,1,5],contains:{BFAC:{type:"combobox",keyword:"none",label:"Atomic B-factors",range:["ISOT|Isotropic","ANIS|Anisotropic","OVER|Overall","MIXED|Mixed"],value:"ISOT",position:[0,0,1,1]},TLS:{type:"combobox",keyword:"none",label:"TLS groups",tooltip:"Translation-Libration-Screw parameterisation",range:["none|None","auto|Automatic"],value:"none",showon:{BFAC:["ISOT"]},position:[1,0,1,1]},TLS_CYCLES:{type:"integer",keyword:"none",label:"&nbsp;&nbsp;&nbsp;&nbsp;Number of TLS cycles",tooltip:"Number of TLS refinement cycles",range:[0,"*"],value:"5",showon:{TLS:["auto"]},position:[2,2,1,1]},TLSOUT_ADDU:{type:"combobox",keyword:"none",label:"&nbsp;&nbsp;&nbsp;&nbsp;Add TLS contribution to B-factors",tooltip:"Add TLS contribution to output B-factors (only for analysis and deposition)",range:["yes|Yes","no|No"],value:"no",showon:{TLS:["auto"]},position:[3,2,1,1]},TLSOUT_ADDU_1:{type:"label",keyword:"none",label:"(only for analysis and deposition)",showon:{TLS:["auto"]},position:[3,5,1,3]},RESET_B:{type:"combobox",keyword:"none",label:"Reset all B-factors at start",tooltip:"Reset all B-factors at start",range:["yes|Yes","no|No"],value:"no",showon:{TLS:["none"]},position:[4,0,1,1]},RESET_B_VAL:{type:"real",keyword:"none",label:"&nbsp;&nbsp;&nbsp;&nbsp;to fixed value",tooltip:"to fixed value",range:[0,"*"],value:"30.0",showon:{TLS:["none"],RESET_B:["yes"]},position:[5,2,1,1]},RESET_B_TLS:{type:"combobox",keyword:"none",label:"Reset all B-factors at start",tooltip:"Reset all B-factors at start",range:["yes|Yes","no|No"],value:"yes",showon:{TLS:["auto"]},position:[6,0,1,1]},RESET_B_TLS_VAL:{type:"real",keyword:"none",label:"&nbsp;&nbsp;&nbsp;&nbsp;to fixed value",tooltip:"to fixed value",range:[0,"*"],value:"30.0",showon:{TLS:["auto"],RESET_B_TLS:["yes"]},position:[7,2,1,1]},SCALING:{type:"combobox",keyword:"none",label:"Solvent model type",tooltip:"Solvent model type",range:["SIMPLE|Simple","BULK|Bulk"],value:"SIMPLE",position:[8,0,1,1]},SOLVENT_MASK:{type:"combobox",keyword:"none",label:"Explicit solvent mask",tooltip:"Specify whether to use an explicit solvent mask",range:["explicit|Yes","no|No"],value:"explicit",position:[9,0,1,1]},SOLVENT_CUSTOM:{type:"combobox",keyword:"none",label:"&nbsp;&nbsp;&nbsp;&nbsp;Custom mask parameters",tooltip:"Use custom solvent mask parameters",range:["no|No","yes|Yes"],value:"no",showon:{SOLVENT_MASK:["explicit"]},position:[10,2,1,1]},SOLVENT_CUSTOM_VDW:{type:"real",keyword:"none",label:"&nbsp;&nbsp;&nbsp;&nbsp;Increase non-ion VDW radius by",tooltip:"Increase VDW radius of non-ion atoms",range:[0,"*"],value:"1.4",showon:{SOLVENT_MASK:["explicit"],SOLVENT_CUSTOM:["yes"]},position:[11,4,1,1]},SOLVENT_CUSTOM_ION:{type:"real",keyword:"none",label:"&nbsp;&nbsp;&nbsp;&nbsp;Increase radius of ions by",tooltip:"Increase ionic radius of potential ion atoms",range:[0,"*"],value:"0.8",showon:{SOLVENT_MASK:["explicit"],SOLVENT_CUSTOM:["yes"]},position:[12,4,1,1]},SOLVENT_CUSTOM_SHRINK:{type:"real",keyword:"none",label:"&nbsp;&nbsp;&nbsp;&nbsp;Shrink the mask area by",tooltip:"Shrink the mask area after calculation",range:[0,"*"],value:"0.8",showon:{SOLVENT_MASK:["explicit"],SOLVENT_CUSTOM:["yes"]},position:[13,4,1,1]}}},sec3:{type:"section",title:"Restraints",open:!1,position:[2,0,1,5],contains:{NCSR:{type:"combobox",keyword:"none",label:"Use automatic NCS restraints",tooltip:"Use automatic Non-Crystallographic Symmetry restraints",range:["yes|Yes","no|No"],value:"yes`",position:[0,0,1,1]},NCSR_TYPE:{type:"combobox",keyword:"none",label:"",tooltip:"Local or global Non-Crystallographic Symmetry restraints",range:["LOCAL|Local","GLOBAL|Global"],value:"LOCAL",showon:{NCSR:["yes"]},position:[0,3,1,1]},JELLY:{type:"combobox",keyword:"none",label:"Use jelly-body restraints",tooltip:"Use jelly-body restraints",range:["no|No","yes|Yes"],value:"no",position:[1,0,1,1]},JELLY_SIGMA:{type:"real",keyword:"none",label:"weight",tooltip:"Sigma parameter for jelly-body restraints",range:[0,"*"],value:"0.01",showon:{JELLY:["yes"]},position:[1,3,1,1]},JELLY_DMAX:{type:"real",keyword:"none",label:"max distance",tooltip:"Maximum distance between jelly-body restrained atoms",range:[0,"*"],value:"4.2",showon:{JELLY:["yes"]},position:[1,8,1,1]},MKLINKS:{type:"combobox",keyword:"none",label:"Covalent/metal link identification",tooltip:"Identify covalent/metal links automatlically and make the corresponding link records",range:["NO|No","YES|Yes"],value:"NO",position:[2,0,1,3]},HBOND_RESTR:{type:"combobox",keyword:"none",label:"Generate backbone H-bond restraints",tooltip:"Use ProSMART to generate H-bond restraints for the protein backbone",range:["no|No","yes|Yes"],value:"no",position:[3,0,1,1]},EXTE_GEN:{type:"label",keyword:"none",label:"Generate external restraints<br>with following ProSMART parameters:",hideon:{hmodel:[0,-1]},position:[4,0,1,1]},ALL_BEST:{type:"combobox",keyword:"none",label:"Use these chain(s) from the reference model(s)",tooltip:"Select whether to generate restraints using all chains, or just the one that is the most structurally similar to the target, from each homologous reference model",range:["all|All","best|Most structurally similar"],value:"all",hideon:{hmodel:[0,-1]},position:[4,3,1,1]},SEQID:{type:"real",keyword:"none",label:"Minimum sequence identity",tooltip:"Minimum sequence identity between reference and target chains",range:[0,100],value:"75.0",hideon:{hmodel:[0,-1]},position:[5,3,1,1]},SIDE_MAIN:{type:"combobox",keyword:"none",label:"Generate restraints between following atom-pairs",tooltip:"Select whether to generate restraints involving both main chain and side chain atoms, or main chain atoms only",range:["side|Main and side chain","main|Only main chain"],value:"side",hideon:{hmodel:[0,-1]},position:[6,3,1,1]},RMIN:{type:"real",keyword:"none",label:"Minimum interatomic distance range",tooltip:"Generate restraints with minimum interatomic distance (Angstroms)",range:[0,"*"],value:"2.5",hideon:{hmodel:[0,-1]},position:[7,3,1,1]},RMAX:{type:"real",keyword:"none",label:"Maximum interatomic distance range",tooltip:"Generate restraints with maximum interatomic distance (Angstroms)",range:[0,"*"],value:"6.0",hideon:{hmodel:[0,-1]},position:[8,3,1,1]},BFAC_RM:{type:"real",keyword:"none",label:"Remove restraints where homologue has B-factors<br>higher than median plus interquartile range multiplied<br>by a factor of",tooltip:"Remove restraints involving atoms, in the homologue, that have high B-factors relative to the rest of the model",range:[0,"*"],value:"2.0",hideon:{hmodel:[0,-1]},position:[9,3,1,1]},TOGGLE_ALT:{type:"combobox",keyword:"none",label:"Allow restraints involving atoms with alt codes",tooltip:"Allow restraints involving atoms with alt codes",range:["yes|Yes","no|No"],value:"no",hideon:{hmodel:[0,-1]},position:[10,3,1,1]},OCCUPANCY:{type:"real",keyword:"none",label:"Ignore atoms with occupancies lower than",tooltip:"Do not generate restraints involving atoms, either in the target or in homologous reference model, with occupancies lower than this value",range:[0,1],value:"0.0",hideon:{hmodel:[0,-1]},position:[11,3,1,1]},EXTE_APPLY:{type:"label",keyword:"none",label:"Apply external restraints<br>with following REFMAC5 parameters:",hideon:{hmodel:[0,-1]},position:[12,0,1,1]},EXTE_WEIGHT:{type:"real",keyword:"none",label:"Weight of external restraints",tooltip:"Overall strength of the external restraints (lower is stronger)",range:[0,"*"],value:"10.0",hideon:{hmodel:[0,-1]},position:[12,3,1,1]},EXTE_ALPHA:{type:"real",keyword:"none",label:"Robustness parameter",tooltip:"Alpha parameter - controls robustness to outliers, with lower values resulting in outliers having less of an effect. E.g. 2.0 corresponds to Least Squares, and -2.0 corresponds to the Geman-McClure loss function.",range:["*","*"],value:"1.0",hideon:{hmodel:[0,-1]},position:[13,3,1,1]},EXTE_MAXD:{type:"real",keyword:"none",label:"Maximal distance between restrained atoms",tooltip:"Maximum distance between externally restrained atoms",range:[0,"*"],value:"4.2",hideon:{hmodel:[0,-1]},position:[14,3,1,1]}}},sec4:{type:"section",title:"Output",open:!1,position:[3,0,1,5],contains:{RIDING_HYDROGENS:{type:"combobox",keyword:"none",label:"Output calculated riding hydrogens",tooltip:"Output calculated riding hydrogens",range:["DEFAULT|Default","YES|Yes","NO|No"],value:"DEFAULT",position:[0,0,1,1]},MAP_SHARPEN:{type:"combobox",keyword:"none",label:"Perform map sharpening when calculating maps",tooltip:"Perform map sharpening when calculating maps",range:["no|No","yes|Yes"],value:"no",position:[1,0,1,1]},MAP_SHARPEN_B:{type:"real_",keyword:"none",label:"using sharpening B-factor",tooltip:"Custom sharpening B-factor",range:["*","*"],value:"",default:"default (use overall B-factor)",iwidth:220,showon:{MAP_SHARPEN:["yes"]},position:[1,3,1,1]}}},sec5:{type:"section",title:"Advanced",open:!1,position:[4,0,1,5],contains:{EXPERIMENT:{type:"combobox",keyword:"none",label:"Diffraction experiment type",tooltip:"Diffraction experiment type",range:["xray|X-ray","electron|Electron","neutron|Neutron"],value:"xray",position:[0,0,1,1]},FORM_FACTOR:{type:"combobox",keyword:"none",label:"form factor calculation method",tooltip:"Electron form factor calculation method",range:["gaussian|Sum of Gaussians","mb|Mott-Bethe"],value:"gaussian",showon:{EXPERIMENT:["electron"]},position:[0,5,1,1]},KEYWORDS_LBL:{type:"label",keyword:"none",label:'<div style="font-size:14px;"><i>Type additional keywords here</i></div>',position:[2,0,1,6]},KEYWORDS:{type:"aceditor_",tooltip:"",reportas:"Keywords",value:"",iwidth:500,iheight:160,position:[3,0,1,6]}}}}}function RefmacHotButton(){return{task:"TaskRefmac",tooltip:"Refine results using parameters of last refinement"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskRefmac.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskRefmac.prototype.constructor=TaskRefmac,TaskRefmac.prototype.icon=function(){return"task_refmac"},TaskRefmac.prototype.currentVersion=function(){return __template?5+__template.TaskTemplate.prototype.currentVersion.call(this):5+TaskTemplate.prototype.currentVersion.call(this)},TaskRefmac.prototype.desc_title=function(){return"refine macromolecular structure"},TaskRefmac.prototype.checkKeywords=function(e){return this.__check_keywords(e,["refmac","refinement","refmac5"])},__template?(conf=require("../../js-server/server.configuration"),TaskRefmac.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskRefmac.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.refmac",e,t,this.id]},module.exports.TaskRefmac=TaskRefmac):(TaskRefmac.prototype.collectInput=function(e){e=TaskTemplate.prototype.collectInput.call(this,e);return e=0<this.input_data.getData("phases").length&&"F"!=this.input_data.getData("revision")[0].HKL.useHKLSet?"<b><i>external phases cannot be used with twin or SAD refinement</i></b>":e},TaskRefmac.prototype.hotButtons=function(){return[CootMBHotButton()]});var __template=null,conf;function TaskReindexHKL(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskReindexHKL",this.name="reindex dataset",this.setOName("rndx"),this.title="Reindex Dataset",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataHKL:[]},label:"Reflection Data",inputId:"idata",customInput:"cell-info",version:0,min:1,max:1},{data_type:{DataRevision:[]},label:"Structure revision",inputId:"revision",version:0,min:0,max:0}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,2,5],contains:{SYMM:{type:"string",label:"Space Group",tooltip:"The value is not validated and passed to reindex program as is",iwidth:"100",value:"",placeholder:"e.g. P 43 21 2",position:[0,0,1,1]},REINDEX:{type:"string",label:"Reindex",tooltip:"The value is not validated and passed to reindex program as is",iwidth:"200",value:"",placeholder:"e.g. h,k,2l",position:[1,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskReindexHKL.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskReindexHKL.prototype.constructor=TaskReindexHKL,TaskReindexHKL.prototype.icon=function(){return"task_reindexhkl"},TaskReindexHKL.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskReindexHKL.prototype.desc_title=function(){return"change space group and indexing"},TaskReindexHKL.prototype.checkKeywords=function(e){return this.__check_keywords(e,["reindex","hkl","dataset","toolbox"])},__template?(conf=require("../../js-server/server.configuration"),TaskReindexHKL.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.changespg",e,t,this.id]},module.exports.TaskReindexHKL=TaskReindexHKL):TaskReindexHKL.prototype.addDataDialogHints=function(e,t){return t.hints.push('Why <i>"Structure Revision"</i> is not allowed? This means that the task can be used only before a <i>"Structure Revision"</i> is created. If you are past this point in your Project, you may have to start, with this task, a new branch in your Project after data import or data processing.'),t};var __template=null;function TaskRemark(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskRemark",this.name="remark",this.oname="*",this.title="Custom remark",this.state=(__template?__template.job_code:job_code).remark,this.theme_no=6,this.doclink_type="none",this.doclink_url="",this.doclink_doi="",this.doclink_file="",this.input_dtypes=[],this.parameters={TITLE:{type:"label",keyword:"none",label:"<h3>Detail description</h3>",position:[0,0,1,1]},DESCRIPTION:{type:"textarea_",keyword:"none",tooltip:"",placeholder:"Optional detail description may be placed here",nrows:14,ncols:90,iwidth:750,value:"",position:[1,0,1,1]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskRemark.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskRemark.prototype.constructor=TaskRemark;var __remark_icon=[["task_remark_black","Black"],["task_remark_darkblue","Midnight"],["task_remark_navy","Navy"],["task_remark_blue","Blue"],["task_remark_green","Green"],["task_remark_cyan","Cyan"],["task_remark","Lemon"],["task_remark_yellow","Gold"],["task_remark_pink","Pink"],["task_remark_red","Red"],["task_remark_doc","Document link"]],__template=(__template||(TaskRemark.prototype.icon=function(){return __remark_icon[this.theme_no][0]},TaskRemark.prototype.customDataClone=function(e,t){this.theme_no=t.theme_no,this.state=t.state,"doclink_type"in t&&(this.doclink_type=t.doclink_type,this.doclink_url=t.doclink_url,this.doclink_doi=t.doclink_doi,this.doclink_file=t.doclink_file,this.theme_no==__remark_icon.length-1&&(this.theme_no=6,this.doclink_type="none"))},TaskRemark.prototype.isLink=function(){return"doclink_type"in this&&"none"!=this.doclink_type},TaskRemark.prototype.setTheme=function(e,t){var i,o,n,s;function a(e){o.setVisible("none"!=e),n.setVisible("none"!=e);var t="",i="";switch(e){case"url":t="URL",i=s.doclink_url;break;case"doi":t="DOI",i=s.doclink_doi;break;case"taskref":case"userguide":case"tutorial":t="File",i=s.doclink_file}o.setText(t),n.setValue(i)}this.theme_no=e,t.header.icon_menu.button.setBackground(image_path(__remark_icon[this.theme_no][0])),t.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.set_node_icon),this.theme_no==__remark_icon.length-1&&((e=new InputBox("Link document")).setText("","task_remark_doc"),(t=e.grid).setLabel("<h2>Set Document Link</h2>",0,2,2,3),t.setLabel("Link type:&nbsp;&nbsp;&nbsp;",2,3,1,1),t.setVerticalAlignment(2,3,"middle"),i=new Dropdown,t.addWidget(i,2,4,1,1),i.addItem("No link","","none","none"==this.doclink_type).addItem("Web page","","url","url"==this.doclink_type).addItem("DOI reference","","doi","doi"==this.doclink_type).setWidth("220px"),__user_role!=role_code.developer&&__user_role!=role_code.admin||i.addItem("Task documentation","","taskref","taskref"==this.doclink_type).addItem("User guide article","","userguide","userguide"==this.doclink_type).addItem("Tutorial description","","tutorial","tutorial"==this.doclink_type),i.make(),o=t.setLabel("URL:&nbsp;&nbsp;&nbsp;",3,3,1,1),t.setVerticalAlignment(3,3,"middle"),n=t.setInputText("",3,4,1,1).setWidth("500px"),a((s=this).doclink_type),i.addOnChangeListener(function(e,t){a(t)}),e.launch("Set link",function(){s.doclink_type=i.getValue();var e=n.getValue().trim();switch(s.doclink_type){case"url":s.doclink_url=e;break;case"doi":s.doclink_doi=e;break;case"taskref":case"userguide":case"tutorial":s.doclink_file=e}return"none"!=s.doclink_type&&window.setTimeout(function(){new MessageBox("Remark is being converted",'<div style="width:400px"><h2>The Remark is being converted</h2>The Remark will be permanently converted into document link. Make sure that you have chosen a suitable remark title before closing the Remark Dialog.')},0),!0}))},TaskRemark.prototype.makeThemeMenu=function(i,o){var n=new Menu("",image_path(__remark_icon[this.theme_no][0]+i));n.button.setWidth("80px"),n.button.setHeight("80px"),n.setTooltip("Click on icon to change theme"),$(n.button.element).css({"background-size":"80px",padding:"0px","background-position":"0.0em center"}),n.setOnClickCustomFunction(function(){n.setMaxHeight(o.height_px()-90+"px")});for(var e=0;e<__remark_icon.length;e++)!function(e,t){n.addItem(__remark_icon[e][1],image_path(__remark_icon[e][0]+i)).addOnClickListener(function(){t.setTheme(e,o)})}(e,this);return n},TaskRemark.prototype.makeInputPanel=function(e){e=TaskTemplate.prototype.makeInputPanel.call(this,e);return startsWith(this.doclink_type,"*")&&(this.doclink_type=this.doclink_type.substring(1)),e.header.uname_lbl.setText("Remark title:&nbsp;&nbsp;"),e.header.icon_menu=this.makeThemeMenu("",e),e.header.setWidget(e.header.icon_menu,0,0,3,1),e.header.setCellSize("","84px",0,0),e.header.setHLine(1,3,0,1,5),e},TaskRemark.prototype.openWebLink=function(){if("doclink_type"in this){var e=null,t="Document",i=!1;switch(this.doclink_type){case"url":i=!startsWith(e=this.doclink_url,__fe_url);break;case"doi":e="https://doi.org/"+this.doclink_doi,i=!0;break;case"taskref":e=__task_reference_base_url+this.doclink_file,t="";break;case"userguide":e=__user_guide_base_url+this.doclink_file,t="";break;case"tutorial":e=__tutorials_base_url+this.doclink_file,t="Tutorial info"}if(e)return i?window.open(e,"_blank"):new HelpBox(t,e,null),!0}return!1},TaskRemark.prototype.isWebLink=function(){return"doclink_type"in this&&"none"!=this.doclink_type},TaskRemark.prototype.isDocLink=function(){return"doclink_type"in this&&0<=["taskref","userguide","tutorial"].indexOf(this.doclink_type)}),TaskRemark.prototype.runButtonName=function(){return""},TaskRemark.prototype.canMove=function(e,t){return!1},TaskRemark.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},__template&&(TaskRemark.prototype.getCommandLine=function(e,t){return null},module.exports.TaskRemark=TaskRemark),null),conf;function TaskRotamer(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskRotamer",this.name="rotamer",this.setOName("rotamer"),this.title="Rotamer",this.input_dtypes=[{data_type:{DataRevision:["xyz"],DataEnsemble:[],DataModel:[],DataXYZ:[]},label:"Structure",inputId:"ixyz",min:1,max:1}],this.parameters={SEP_LBL:{type:"label",label:"&nbsp;",position:[0,0,1,5]},sec1:{type:"section",title:"Parameters",open:!0,position:[1,0,1,5],contains:{DELT:{type:"integer",keyword:"DELT",label:"Delta-Chi threshold",tooltip:"threshold from the equivalent one of the nearest rotamer",range:[1,"*"],value:30,iwidth:40,position:[0,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskRotamer.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskRotamer.prototype.constructor=TaskRotamer,TaskRotamer.prototype.icon=function(){return"task_rotamer"},TaskRotamer.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskRotamer.prototype.checkKeywords=function(e){return this.__check_keywords(e,["xyz","analysis","coordinates","toolbox","rotamer"])},__template?(conf=require("../../js-server/server.configuration"),TaskRotamer.prototype.makeInputData=function(e,t){var i=this.input_data.data.ixyz[0];"DataRevision"==i._type&&(this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskRotamer.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.rotamer",e,t,this.id]},module.exports.TaskRotamer=TaskRotamer):TaskRotamer.prototype.desc_title=function(){return"lists amino acids whose side chain torsion angles deviate from the Penultimate Rotamer Library"};var __template=null,conf;function TaskSeqAlign(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskSeqAlign",this.name="seqalign",this.setOName("seqalign"),this.title="Sequence Alignment with ClustalW",this.fasttrack=!0,this.input_dtypes=[{data_type:{DataStructure:["xyz"],DataEnsemble:[],DataModel:[],DataSequence:[],DataXYZ:[]},label:"Sequence source",inputId:"seq",customInput:"chain-sel",version:0,min:2,max:20}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskSeqAlign.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskSeqAlign.prototype.constructor=TaskSeqAlign,TaskSeqAlign.prototype.icon=function(){return"task_seqalign"},TaskSeqAlign.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskSeqAlign.prototype.desc_title=function(){return"aligns protein sequences"},TaskSeqAlign.prototype.checkKeywords=function(e){return this.__check_keywords(e,["clustalw","sequence","alignment","protein","toolbox","comparison"])},__template&&(conf=require("../../js-server/server.configuration"),TaskSeqAlign.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.seqalign",e,t,this.id]},module.exports.TaskSeqAlign=TaskSeqAlign);var __template=null,conf;function TaskSC(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskSC",this.name="SC",this.title="SC",this.input_dtypes=[{data_type:{DataStructure:["protein"],DataEnsemble:["protein"],DataModel:["protein"],DataXYZ:["protein"]},label:"Structure",inputId:"xyz",customInput:"chain-sel-poly-2",min:1,max:1}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskSC.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskSC.prototype.constructor=TaskSC,TaskSC.prototype.icon=function(){return"task_SC"},TaskSC.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskSC.prototype.checkKeywords=function(e){return this.__check_keywords(e,["xyz","analysis","coordinates","toolbox","sc"])},__template?(conf=require("../../js-server/server.configuration"),TaskSC.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.sc",e,t,this.id]},module.exports.TaskSC=TaskSC):(TaskSC.prototype.desc_title=function(){return"determines Sc shape complementarity of two interacting molecular surfaces"},TaskSC.prototype.collectInput=function(e){e=TaskTemplate.prototype.collectInput.call(this,e);return e=this.input_data.getData("xyz")[0].chainSel2?e:"<b><i>Usuitable coordinate data.</i></b>"});var __template=null,conf;function TaskSheetbend(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskSheetbend",this.name="sheetbend",this.setOName("sheetbend"),this.title="Post-MR model correction with Sheetbend",this.input_dtypes=[{data_type:{DataRevision:["!xyz","!phases"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{NCYCLES:{type:"integer",keyword:"cycles",label:"Number of cycles",tooltip:"Choose a value between 1 and 50",range:[1,50],value:"10",position:[0,0,1,1]}}}}}function SheetbendHotButton(){return{task:"TaskSheetbend",tooltip:"Post-MR model correction with Sheetbend"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskSheetbend.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskSheetbend.prototype.constructor=TaskSheetbend,TaskSheetbend.prototype.icon=function(){return"task_sheetbend"},TaskSheetbend.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskSheetbend.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskSheetbend.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.sheetbend",e,t,this.id]},module.exports.TaskSheetbend=TaskSheetbend):(TaskSheetbend.prototype.desc_title=function(){return""},TaskSheetbend.prototype.hotButtons=function(){return[ModelCraftHotButton(),BuccaneerHotButton(),ArpWarpHotButton()]});var __template=null,conf;function TaskShelxAuto(){(__template?__template.TaskCrank2:TaskCrank2).call(this),this._type="TaskShelxAuto",this.name="SHELX Auto-EP",this.setOName("shelx"),this.title="SHELX Automated Experimental Phasing via Crank-2",this.input_dtypes[0].data_type={DataRevision:["!anomalous","~xyz","~substructure"]},this.input_dtypes[0].customInput="shelx-auto",this.input_dtypes[1].customInput="anomData-Shelx",this.parameters.sec1.value="shelx-auto"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.crank2")),TaskShelxAuto.prototype=__template?Object.create(__template.TaskCrank2.prototype):Object.create(TaskCrank2.prototype),TaskShelxAuto.prototype.constructor=TaskShelxAuto,TaskShelxAuto.prototype.icon=function(){return"task_shelx"},TaskShelxAuto.prototype.desc_title=function(){return"finds heavy-atom substructure, performs EP and builds atomic model"},TaskShelxAuto.prototype.requiredEnvironment=function(){return["CCP4",["$CCP4/bin/shelxe","$CCP4/bin/shelxe.exe"]]},TaskShelxAuto.prototype.currentVersion=function(){return __template?0+__template.TaskCrank2.prototype.currentVersion.call(this):0+TaskCrank2.prototype.currentVersion.call(this)},TaskShelxAuto.prototype.getHelpURL=function(){return __task_reference_base_url+"doc.task.SHELX.html"},TaskShelxAuto.prototype.checkKeywords=function(e){return this.__check_keywords(e,["shelx","crank2","crank-2","experimental","phasing","auto-ep","ep","substructure"])},__template&&(conf=require("../../js-server/server.configuration"),TaskShelxAuto.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.shelxauto",e,t,this.id]},module.exports.TaskShelxAuto=TaskShelxAuto);var __template=null,conf;function TaskShelxEMR(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskShelxEMR",this.name="shelxe",this.setOName("shelxe"),this.title="Density Modification and C&alpha;-tracing with ShelxE",this.input_dtypes=[{data_type:{DataRevision:["!phases"]},label:"Structure revision",inputId:"revision",customInput:"shelxe",version:7,min:1,max:1}],this.parameters={SEP0_LABEL:{type:"label",label:"&nbsp;",position:[0,0,1,5]},sec1:{type:"section",title:"Main options",open:!0,position:[1,0,1,5],contains:{DM_CYCLES:{type:"integer",keyword:"-m",label:"Number of density modification cycles",align:"left",iwidth:50,default:"25",tooltip:"The total number of density modification cycles",range:[1,"*"],value:"25",position:[0,0,1,1]},SOLVENT_CONTENT:{type:"real_",keyword:"-s",label:"Efective solvent content",tooltip:"Solvent content to be used in calculations (must be between 0.01 and 0.99). If left blank, solvent fraction from asymmetric unit definition will be used.",iwidth:80,range:[.01,.99],value:"",default:"auto",position:[1,0,1,1],hideon:{sec1:["shelx-substr"]}},AUTOTRACE_CBX:{type:"checkbox",keyword:"autotrace",label:"Perform mainchain tracing",tooltip:"Check to perform the mainchain tracing.",value:!0,position:[2,0,1,3],emitting:!0},TRACING_CYCLES:{type:"integer",keyword:"-a",label:"Number of autotracing cycles",align:"left",iwidth:50,default:"10",tooltip:"The total number of global autotracing cycles",range:[0,"*"],value:"10",position:[3,0,1,1],hideon:{AUTOTRACE_CBX:[!1]}},AH_SEARCH_CBX:{type:"checkbox",keyword:"-q",label:"Perform Alpha-Helix search",tooltip:"Check to perform alpha-helix search.",value:!0,position:[4,0,1,3],hideon:{AUTOTRACE_CBX:[!1]}},NCS_CBX:{type:"checkbox",keyword:"-n",label:"Apply NCS in autotracing",tooltip:"Check to apply NCS in autotracing.",value:!0,position:[5,0,1,3],hideon:{AUTOTRACE_CBX:[!1]}},OMIT_RES_CBX:{type:"checkbox",keyword:"-o",label:"Omit residues from fragment to optimize CC",tooltip:"Check to omit residues from fragment to optimize CC.",value:!0,position:[6,0,1,3],hideon:{AUTOTRACE_CBX:[!1]}}}},sec2:{type:"section",title:"Extra options",open:!1,position:[2,0,1,5],contains:{TIME_FACTOR:{type:"real",keyword:"-t",label:"Time factor for peptide searches",align:"left",iwidth:50,default:"1",tooltip:"Time factor for peptides searches (increase if difficult)",range:[1,"*"],value:"1",position:[2,0,1,1]}}}}}function ShelxEMRHotButton(){return{task:"TaskShelxEMR",tooltip:"Density Modificaton and C&alpha;-tracing with ShelxE"}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskShelxEMR.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskShelxEMR.prototype.constructor=TaskShelxEMR,TaskShelxEMR.prototype.icon=function(){return"task_shelxemr"},TaskShelxEMR.prototype.requiredEnvironment=function(){return["CCP4",["$CCP4/bin/shelxe","$CCP4/bin/shelxe.exe"]]},TaskShelxEMR.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskShelxEMR.prototype.checkKeywords=function(e){return this.__check_keywords(e,["shelx","shelxe","density","modification","alpha","tracing","calpha","dm","c-alpha"])},__template?(conf=require("../../js-server/server.configuration"),TaskShelxEMR.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],(i.Structure||i.Substructure)&&("substructure"==i.Options.leading_structure?this.input_data.data.istruct=[i.Substructure]:this.input_data.data.istruct=[i.Structure])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskShelxEMR.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.shelxemr",e,t,this.id]},module.exports.TaskShelxEMR=TaskShelxEMR):(TaskShelxEMR.prototype.desc_title=function(){return"performs iterative density modification by the inclusion of automated protein main-chain tracing"},TaskShelxEMR.prototype.getHelpURL=function(){return __task_reference_base_url+"doc.task.SHELX.html#id1"},TaskShelxEMR.prototype.inputChanged=function(e,t,i){var o,n;"AUTOTRACE_CBX"==t&&(i?(this.title="Density Modificaton and C&alpha;-tracing with ShelxE",this.name="shelxe DM and autotrace"):(this.title="Density Modificaton with ShelxE",this.name="shelxe DM"),(o=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),n=this.name.replace(/<(?:.|\n)*?>/gm,""),o.header.uname_inp.setStyle("text","",n),o.job_dialog.changeTitle(n),this.updateInputPanel(o),o.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node)),TaskTemplate.prototype.inputChanged.call(this,e,t,i)},TaskShelxEMR.prototype.updateInputPanel=function(e){var t;this.state==job_code.new&&(t=new CustomEvent(cofe_signals.jobDlgSignal,{detail:job_dialog_reason.rename_node}),e.element.dispatchEvent(t))});var __template=null,conf;function TaskShelxCD(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskShelxCD",this.name="shelx-cd substructure search",this.setOName("shelx-cd"),this.title="Substructure Search with SHELX-C/D",this.input_dtypes=[{data_type:{DataRevision:["!anomalous","!asu","~xyz","~phases","~substructure"]},label:"Structure revision",inputId:"revision",customInput:"shelx-substr",version:5,min:1,max:1},{data_type:{DataHKL:["anomalous"]},label:"Anomalous reflection<br>data",inputId:"hkl",customInput:"shelx-substr",tooltip:"Only anomalous reflection datasets from all imported may be chosen here. Note that neither of reflection datasets may coincide with the native dataset, if one is specified above.",min:0,max:3},{data_type:{DataHKL:[]},desc:"native dataset",label:"Native dataset",inputId:"native",tooltip:"Native dataset is optional and may be chosen from both non-anomalous (typical case) and anomalous diffraction datasets. Native dataset must not coincide with any of the reflection datasets chosen above.",min:0,max:1}],this.parameters={sec1:{type:"section",title:"Search Parameters",open:!0,position:[0,0,1,5],contains:{FIND:{type:"integer_",keyword:"FIND",label:"Try to find a substructure of",tooltip:"Expected number of atoms in substructure.",range:[1,"*"],value:"",label2:"atoms",placeholder:"auto",position:[0,0,1,1]},DSUL:{type:"integer_",keyword:"DSUL",label:"Number of disulfides",tooltip:"Expected number of disulfides in substructure.",range:[0,"*"],value:"",placeholder:"auto",position:[1,0,1,1],showon:{SFAC:["S"]}},NTRY:{type:"integer_",keyword:"NTRY",label:"Number of trials",tooltip:"Number of global trials.",range:[1,"*"],value:"",placeholder:"1000",position:[2,0,1,1]},HIGHRES:{type:"real_",keyword:"HIGHRES",label:"Resolution range: from (&Aring;)",tooltip:"High resolution limit, leave blank for automatic choice.",range:[0,10],value:"",placeholder:"auto",position:[3,0,1,1]},LOWRES:{type:"real_",keyword:"LOWRES",label:"to (&Aring;)",align:"center",tooltip:"Lower resolution limit, leave blank for automatic choice.",range:[0,10],value:"",placeholder:"auto",position:[3,3,1,1]},MINDIST:{type:"real_",keyword:"MINDIST",label:"Minimal distance between atoms",tooltip:"The shortest distance allowed between atoms.",range:[0,10],value:"",placeholder:"auto",position:[4,0,1,1]},SPECIAL_POSITIONS_CBX:{type:"checkbox",label:"Allow for heavy atoms lying in special positions",tooltip:"Check to allow for heavy atoms to lie in special crystallohraphic positions.",value:!1,position:[5,0,1,3]},MINDEQ:{type:"real_",keyword:"MINDEQ",label:"Minimal distance between symmetry mates",tooltip:"The shortest distance allowed between atoms in symmetry equivalent positions.",range:[0,10],value:"",placeholder:"auto",position:[6,0,1,1],showon:{SPECIAL_POSITIONS_CBX:[!1]}},DSCA:{type:"real_",keyword:"DSCA",label:"Scaling factor for native data",tooltip:"The factor (default 0.98) by which to multiply the native data for SIRAS after the data have been put onto a common scale (this allows for the extra scattering power of the heavy atoms etc.)",range:[0,10],value:"",placeholder:"0.98",position:[7,0,1,1],showon:{_:"&&",hkl:[1],native:[1]}},ASCA:{type:"real_",keyword:"ASCA",label:"Scaling factor for anomalous signal",tooltip:"A scale factor (default 1.0) that is applied to the anomalous signal in a MAD experiment; to apply MAD to a small molecule, the factor should be between 0 and 1, the best values have to be found by trial and error.",range:[0,10],value:"",placeholder:"1.0",position:[8,0,1,1],showon:{hkl:[2,3,4]}},SMAD:{type:"checkbox",label:"Null dispersive term",tooltip:"Check to set the dispersive term to zero in a MAD experiment. This is equivalent to SAD using weighted mean anomalous differences from all the MAD datasets. This can be useful when MAD appears to fail (especially if the wavelengths were labeled wrongly).",value:!1,position:[9,0,1,1],showon:{hkl:[2,3,4]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskShelxCD.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskShelxCD.prototype.constructor=TaskShelxCD,TaskShelxCD.prototype.icon=function(){return"task_shelx_substr"},TaskShelxCD.prototype.desc_title=function(){return"find heavy-atom substructure for use in Phaser-EP"},TaskShelxCD.prototype.requiredEnvironment=function(){return["CCP4",["$CCP4/bin/shelxe","$CCP4/bin/shelxe.exe"]]},TaskShelxCD.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskShelxCD.prototype.checkKeywords=function(e){return this.__check_keywords(e,["shelx","shelxcd","shelx-cd","shelxc","shelxd","experimental","phasing","auto-ep","ep","substructure","search"])},__template?(conf=require("../../js-server/server.configuration"),TaskShelxCD.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hklrev=[i.HKL]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskShelxCD.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.shelxcd",e,t,this.id]},module.exports.TaskShelxCD=TaskShelxCD):(TaskShelxCD.prototype.getHelpURL=function(){return __task_reference_base_url+"doc.task.SHELX.html"},TaskShelxCD.prototype.hotButtons=function(){return[PhaserEPHotButton()]},TaskShelxCD.prototype.inputChanged=function(e,t,i){function o(e,t){return e.split(" (")[0]+" ("+t+")"}var n,s,a,r,l,c;"hkl"!=t&&"native"!=t||(l=e.grid.inpDataRef,n=(s=this.getDataState(l)).hkl,a=!1,0<(s=s.native)&&((c=this.getInputItem(l,"native"))&&c.dropdown[0].hasOwnProperty("customGrid")&&(r=c.dropdown[0].customGrid,c=0<s&&n<=0,a=(useForPhasing_cbx=r.useForPhasing).getValue(),useForPhasing_cbx.setVisible(c),r.setVisible(c))),this.state==job_code.new&&((c=this.getInputItem(l,"revision"))&&c.dropdown[0].hasOwnProperty("customGrid")&&(r=c.dropdown[0].customGrid).hasOwnProperty("wtype")&&(r.wtype_lbl.setVisible(0<n),r.wtype.setVisible(0<n)),l=this.name,n<=0?s<=0?(this.title=o(this.title,"SAD"),this.name=o(this.name,"SAD")):a?(this.title=o(this.title,"SIRAS"),this.name=o(this.name,"SIRAS")):(this.title=o(this.title,"SAD + Native"),this.name=o(this.name,"SAD + Native")):s<=0?(this.title=o(this.title,"MAD"),this.name=o(this.name,"MAD")):(this.title=o(this.title,"MAD + Native"),this.name=o(this.name,"MAD + Native")),this.name!=l&&((c=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),c.header.uname_inp.setStyle("text","",this.name.replace(/<(?:.|\n)*?>/gm,"")),this.updateInputPanel(c),c.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node)))),TaskTemplate.prototype.inputChanged.call(this,e,t,i)},TaskShelxCD.prototype.updateInputPanel=function(e){var t;this.state==job_code.new&&(t=new CustomEvent(cofe_signals.jobDlgSignal,{detail:job_dialog_reason.rename_node}),e.element.dispatchEvent(t))},TaskShelxCD.prototype.collectInput=function(e){var i=TaskTemplate.prototype.collectInput.call(this,e);function t(e,t){i+="|<b>"+e+":</b> "+t}for(var o=this.input_data.getData("hkl"),n=this.input_data.getData("native"),s=0;s<o.length;s++){for(var a=s+1;a<o.length;a++)o[s].dataId==o[a].dataId&&t("Reflection data","dataset "+o[s].dname+" is used in more than one input positions, which is not allowed");0<n.length&&o[s].dataId==n[0].dataId&&t("Native dataset","dataset "+o[s].dname+" is used as both anomalous data and native dataset, which is not allowed.")}return i});var __template=null,conf;function TaskShelxSubstr(){(__template?__template.TaskCrank2:TaskCrank2).call(this),this._type="TaskShelxSubstr",this.name="shelx substructure search (crank-2)",this.setOName("shelx-substr"),this.title="Substructure Search with SHELX via Crank-2",this.input_dtypes[0].data_type={DataRevision:["!anomalous","~xyz","~substructure"]},this.input_dtypes[0].customInput="shelx-substr",this.input_dtypes[1].customInput="anomData-Shelx",this.parameters.sec1.value="shelx-substr"}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.crank2")),TaskShelxSubstr.prototype=__template?Object.create(__template.TaskCrank2.prototype):Object.create(TaskCrank2.prototype),TaskShelxSubstr.prototype.constructor=TaskShelxSubstr,TaskShelxSubstr.prototype.icon=function(){return"task_shelx_substr"},TaskShelxSubstr.prototype.desc_title=function(){return"find heavy-atom substructure for use in Phaser-EP"},TaskShelxSubstr.prototype.currentVersion=function(){return __template?1+__template.TaskCrank2.prototype.currentVersion.call(this):1+TaskCrank2.prototype.currentVersion.call(this)},TaskShelxSubstr.prototype.requiredEnvironment=function(){return["CCP4",["$CCP4/bin/shelxe","$CCP4/bin/shelxe.exe"]]},TaskShelxSubstr.prototype.checkKeywords=function(e){return this.__check_keywords(e,["shelx","crank2","crank-2","experimental","phasing","ep","substructure"])},__template?(conf=require("../../js-server/server.configuration"),TaskShelxSubstr.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.shelxsubstr",e,t,this.id]},module.exports.TaskShelxSubstr=TaskShelxSubstr):(TaskShelxSubstr.prototype.hotButtons=function(){return[PhaserEPHotButton()]},TaskShelxSubstr.prototype.getHelpURL=function(){return __task_reference_base_url+"doc.task.SHELX.html"});var __template=null,path,fs,conf,utils;function TaskSimbad(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskSimbad",this.name="simbad",this.setOName("simbad"),this.title="Lattice and Contaminants Search with Simbad",this.input_dtypes=[{data_type:{DataRevision:["!asu","~xyz"],DataHKL:[],DataStructure:[],DataXYZ:[]},label:"ASU, reflection data or<br>symmetry reference",inputId:"idata",customInput:"simbad",force:1,min:0,max:1}],this.parameters={sec0:{type:"section",title:"",open:!0,position:[1,0,1,5],showon:{idata:[0,-1]},contains:{SPGROUP:{type:"string",keyword:"none",label:"<b><i>Space group</i></b>",reportas:"Space group",tooltip:"Space group",iwidth:200,value:"",placeholder:"e.g. P 21 21 21",maxlength:20,position:[0,0,1,7]},CELL_A:{type:"real",keyword:"none",label:"<b><i>Cell (a,b,c&nbsp;-&nbsp;&alpha;,&beta;,&gamma;):</i></b>",reportas:'Cell parameter "a"',tooltip:"Cell parameters to search for.",range:[.001,1e4],value:"",iwidth:60,position:[1,0,1,1]},CELL_B:{type:"real",keyword:"none",label:"",tooltip:"Cell parameters to search for.",reportas:'Cell parameter "b"',range:[.001,1e4],value:"",iwidth:60,position:[1,2,1,1]},CELL_C:{type:"real",keyword:"none",label:"",reportas:'Cell parameter "c"',tooltip:"Cell parameters to search for.",range:[.001,1e4],value:"",iwidth:60,position:[1,4,1,1]},CELL_ALPHA:{type:"real",keyword:"none",label:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>&mdash;</b>&nbsp;",reportas:'Cell parameter "&alpha;"',tooltip:"Cell parameters to search for.",range:[.001,1e4],value:"",iwidth:60,position:[1,7,1,1]},CELL_BETA:{type:"real",keyword:"none",label:"",reportas:'Cell parameter "&beta;"',tooltip:"Cell parameters to search for.",range:[.001,1e4],value:"",iwidth:60,position:[1,9,1,1]},CELL_GAMMA:{type:"real",keyword:"none",label:"",reportas:'Cell parameter "&gamma;"',tooltip:"Cell parameters to search for.",range:[.001,1e4],value:"",iwidth:60,position:[1,11,1,1]}}},sec1:{type:"section",title:"Search level",open:!0,position:[2,0,1,5],contains:{SEARCH_SEL:{type:"combobox",keyword:"search",label:"Search level",tooltip:"Choose the desirable search level. Lattice search is very quick; contaminants search may take up to an hour; structural search is comprehensive and long",range:["L|Lattice","C|Contaminants","S|Structural database","LC|Lattice and contaminants","LCS|Lattice, contaminants and structural database"],value:"LC",emitting:!0,position:[0,0,1,1],showon:{_:"||","idata.type:DataHKL":[1],"idata.type:DataRevision":[1]}},WARNING_LBL:{type:"label",label:"<i><b>Note:</b> this search level takes significant computational resources and may have adverse effect on your monthly quota.</i>",position:[1,2,1,5],showon:{SEARCH_SEL:["S","LCS"]}},MAXNLATTICES:{type:"integer_",keyword:"none",label:"Maximum number of candidates",tooltip:"Maximum number of candidate lattices to select and explore. The higher the number, the slower the search.",range:[1,100],value:"",default:"5",position:[2,0,1,1],showon:{_:"||",SEARCH_SEL:["L","LC"],idata:[0,-1],"idata.type:DataXYZ":[1]}},MAXPENALTY:{type:"integer_",keyword:"none",label:"Maximum penalty score",tooltip:"Maximum penalty score for selected candidate lattices. The higher the score, the slower the search.",range:[0,12],value:"",default:"4",position:[3,0,1,1],showon:{_:"||",SEARCH_SEL:["L","LC"],idata:[0,-1],"idata.type:DataXYZ":[1]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskSimbad.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskSimbad.prototype.constructor=TaskSimbad,TaskSimbad.prototype.icon=function(){return"task_simbad"},TaskSimbad.prototype.desc_title=function(){return"finds structural homologs by matching the dataset properties and performs MR"},TaskSimbad.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskSimbad.prototype.checkKeywords=function(e){return this.__check_keywords(e,["simbad","lattice","molecular","replacement","mr","auto","auto-mr","model","contaminant","search"])},__template?(path=require("path"),fs=require("fs-extra"),conf=require("../../js-server/server.configuration"),utils=require("../../js-server/server.utils"),TaskSimbad.prototype.getNCores=function(e){return e},TaskSimbad.prototype.makeInputData=function(e,t){"idata"in this.input_data.data&&"DataRevision"==this.input_data.data.idata[0]._type&&(this.input_data.data.hkl=[this.input_data.data.idata[0].HKL]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskSimbad.prototype.cleanJobDir=function(i){__template.TaskTemplate.prototype.cleanJobDir.call(this,i),this.state!=__template.job_code.stopped&&this.state!=__template.job_code.failed||fs.readdirSync(i).forEach(function(t,e){if([__template.jobDataFName,__template.jobReportDirName,__template.jobInputDirName,__template.jobOutputDirName,"output_files","signal","rvapi_document","references.bib","_job.stde","_job.stdo"].indexOf(t)<0&&!t.endsWith(".log")&&!t.endsWith(".meta")&&!t.endsWith(".script")){t=path.join(i,t);if(fs.lstatSync(t).isDirectory())utils.removePath(t);else try{fs.unlinkSync(t)}catch(e){console.log(" +++ cannot remove file "+t+" from failed or terminated Simbad directory")}}})},TaskSimbad.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.simbad",e,t,this.id]},module.exports.TaskSimbad=TaskSimbad):(TaskSimbad.prototype.changeTitle=function(e,t){e!=this.title&&(this.title=e,(e=t.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),this.updateInputPanel(e))},TaskSimbad.prototype.searchSelTitle=function(e,t){switch(e){case"C":this.changeTitle("Contaminants Search with Simbad",t);break;case"S":this.changeTitle("Structure Search with Simbad",t);break;case"LC":this.changeTitle("Lattice and Contaminants Search with Simbad",t);break;case"LC":this.changeTitle("Lattice, Contaminants and Structure Search with Simbad",t);break;default:this.changeTitle("Lattice Search with Simbad",t)}},TaskSimbad.prototype.inputChanged=function(e,t,i){var o;"idata"==t?(o=e.grid.inpDataRef,(o=this.getInputData(o,"idata"))&&0<o.length&&"DataHKL"==o[0]._type?this.searchSelTitle(e.parameters.SEARCH_SEL.input.getValue(),e):this.changeTitle("Lattice Search with Simbad",e)):"SEARCH_SEL"==t&&this.searchSelTitle(i,e),TaskTemplate.prototype.inputChanged.call(this,e,t,i)},TaskSimbad.prototype.collectInput=function(e){var t,e=TaskTemplate.prototype.collectInput.call(this,e),i=this.input_data.getData("idata");return 0<i.length&&(e="",t=i[0],"DataHKL"!=(t="DataRevision"==i[0]._type?i[0].HKL:t)._type&&("Unspecified"==t.getSpaceGroup()&&(e+="|<b><i>Space group undefined</i></b>"),"Unspecified"==t.getCellParametersHTML()&&(e+="|<b><i>Cell parameters undefined</i></b>"))),e},TaskSimbad.prototype.updateInputPanel=function(e){var t;this.state==job_code.new&&(t=new CustomEvent(cofe_signals.jobDlgSignal,{detail:job_dialog_reason.rename_node}),e.element.dispatchEvent(t))});var __template=null,conf;function TaskSlice(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskSlice",this.name="slice",this.setOName("slice"),this.title="Split MR model with Slice-n-Dice",this.input_dtypes=[{data_type:{DataStructure:["~substructure","~substructure-am","!xyz","!protein"],DataModel:["protein"],DataXYZ:["protein"]},label:"Template structure",tooltip:"Specify template structure to be split into domains.",inputId:"xyz",min:1,max:1}],this.parameters={SEP_LBL:{type:"label",label:"&nbsp;",position:[0,0,1,5]},sec1:{type:"section",title:"Parameters",open:!0,position:[1,0,1,5],contains:{NSPLITS:{type:"integer",keyword:"NSPLITS",label:"Number of splits",tooltip:"Number of splits to produce.",range:[1,"*"],value:2,iwidth:40,position:[0,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskSlice.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskSlice.prototype.constructor=TaskSlice,TaskSlice.prototype.icon=function(){return"task_slice"},TaskSlice.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskSlice.prototype.checkKeywords=function(e){return this.__check_keywords(e,["slice","split","mr","molecular","replacement","model","preparation"])},__template?(conf=require("../../js-server/server.configuration"),TaskSlice.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.slice",e,t,this.id]},module.exports.TaskSlice=TaskSlice):TaskSlice.prototype.desc_title=function(){return"cuts given structure into domains and make MR models"};var __template=null,conf;function TaskSliceNDice(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskSliceNDice",this.name="slicendice",this.setOName("slicendice"),this.title="MR with model splitting using Slice'N'Dice",this.input_dtypes=[{data_type:{DataRevision:["!protein","!asu","!hkl"]},label:"Structure revision",label:"Structure revision",inputId:"revision",version:0,min:1,max:1},{data_type:{DataStructure:["~substructure","~substructure-am","!xyz","!protein"],DataModel:["protein"],DataXYZ:["protein"]},label:"Template structure",tooltip:"Specify template structure to be split into domains.",inputId:"xyz",min:1,max:1}],this.parameters={SEP_LBL:{type:"label",label:"&nbsp;",position:[0,0,1,5]},sec1:{type:"section",title:"Parameters",open:!0,position:[1,0,1,5],contains:{MIN_NSPLITS:{type:"integer",keyword:"MIN_NSPLITS",label:"Try from",tooltip:"Minimum number of splits to try.",range:[1,"*"],value:1,iwidth:40,label2:"",position:[0,0,1,1]},MAX_NSPLITS:{type:"integer",keyword:"MAX_NSPLITS",label:"to",tooltip:"Maximum number of splits to try.",range:[1,"*"],value:3,iwidth:40,label2:"splits",position:[0,5,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskSliceNDice.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskSliceNDice.prototype.constructor=TaskSliceNDice,TaskSliceNDice.prototype.icon=function(){return"task_slicendice"},TaskSliceNDice.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskSliceNDice.prototype.checkKeywords=function(e){return this.__check_keywords(e,["slicendice","molecular","replacement","mr","model","preparation","auto","auto-mr"])},__template?(conf=require("../../js-server/server.configuration"),TaskSliceNDice.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.seq=i.ASU.seq),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskSliceNDice.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.slicendice",e,t,this.id]},module.exports.TaskSliceNDice=TaskSliceNDice):TaskSliceNDice.prototype.desc_title=function(){return"cuts given structure into domains and performs MR"};var __template=null,conf;function TaskSRF(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskSRF",this.name="srf analysis",this.oname="*",this.title="Self-Rotation Function Analysis with Molrep",this.input_dtypes=[{data_type:{DataHKL:[]},label:"Reflection Data",inputId:"hkl",version:0,min:1,max:1}],this.parameters={},this.parameters={SEPARATOR_LBL:{type:"label",label:"&nbsp",position:[0,1,1,1]},sec1:{type:"section",title:"SRF Options",open:!1,position:[1,0,1,5],contains:{MOLSIZE:{type:"real_",keyword:"rad",label:"Expected molecule size (&Aring;)",iwidth:60,tooltip:"An estimate for the integration radius for SRF calculations",range:[0,1e3],value:"",default:"",position:[0,0,1,1]},CHISEC:{type:"real_",keyword:"chi",label:"Select Chi sections at 180, 90, 120 and ",iwidth:60,tooltip:"Select Chi section or leave blank for default value",range:[0,360],value:"",placeholder:"60",label2:"degrees",position:[1,0,1,1]},TOPISO:{type:"real_",keyword:"scale",label:"Top isoline level:",iwidth:60,tooltip:"Specify top isoline level or leave blank for automatic choice",range:["*","*"],value:"",placeholder:"6.0",label2:"sigmas",position:[2,0,1,1]}}},sec2:{type:"section",title:"Experimental Data",open:!1,position:[2,0,1,5],contains:{HIRES:{type:"real_",keyword:"resmax",label:"High resolution cut-off (&Aring;)",iwidth:60,tooltip:"Ignore high resolution data above the specified threshold",range:[0,"*"],value:"",default:"",position:[0,0,1,1]},DWHIGH_SEL:{type:"combobox",keyword:"dwhigh",label:"Down-weighting high resolution data:",tooltip:"Select down-weighting mode",range:["N|none","S|by similarity","B|by BADD"],value:"N",position:[1,0,1,1]},DWSIM:{type:"real",keyword:"sim",label:"equal to",iwidth:60,tooltip:"W=1-exp(Boff*s<sup>2</sup>), where Boff=2*Resmin<sup>2</sup> and Resmin approximately equals to the dimension of the model",range:[0,"*"],value:"1.0",default:"1.0",position:[1,3,1,1],showon:{DWHIGH_SEL:["S"]}},DWBADD:{type:"real",keyword:"badd",label:"equal to",iwidth:60,tooltip:"W=1-exp(-BADD*s<sup>2</sup>), where BADD can be defined via sequence similarity",range:[0,"*"],value:"1.0",default:"1.0",position:[1,3,1,1],showon:{DWHIGH_SEL:["B"]}},DWBLOW:{type:"real_",keyword:"resmin",label:"Down-weighting low resolution data:",iwidth:60,tooltip:"W=1-exp(2*x<sup>2</sup>*s<sup>2</sup>) or leave blank for not down-weighting",range:[0,"*"],value:"",default:"",position:[2,0,1,1]},SCALING_SEL:{type:"combobox",keyword:"scaling",label:"Scaling:",tooltip:"Select scaling mode",range:["none|none","Y|anisotropic","C|anisotropic in RF only","S|anisotropic in TF only","N|isotropic","K|overall scale factor only"],value:"none",position:[3,0,1,3]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskSRF.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskSRF.prototype.constructor=TaskSRF,TaskSRF.prototype.icon=function(){return"task_srf"},TaskSRF.prototype.platforms=function(){return"LMU"},TaskSRF.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskSRF.prototype.desc_title=function(){return"helps to determine the internal symmetry of the reflection data"},TaskSRF.prototype.checkKeywords=function(e){return this.__check_keywords(e,["srf","self","rotation","function","self-rotation","selfrotation","analysis","tools","toolbox","symmetry"])},__template&&(conf=require("../../js-server/server.configuration"),TaskSRF.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.srf",e,t,this.id]},module.exports.TaskSRF=TaskSRF);var __template=null,conf;function TaskStructurePrediction(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskStructurePrediction",this.name="structure prediction",this.setOName("af_struct"),this.title="Structure Prediction",this.input_dtypes=[{data_type:{DataSequence:["protein"]},label:"Sequence",inputId:"seq",min:1,max:1}],this.parameters={sec1:{type:"section",title:"Main options",open:!0,position:[0,0,1,5],contains:{NSTRUCTS:{type:"integer",keyword:"NSTRUCTS",label:"Number of structures",tooltip:"Maximum number of structures to produce. Single structure is sufficient in most cases. Producing additional structures will increase wait times. Fewer structures may be produced if score thresholdis met.",range:[1,5],value:1,iwidth:40,position:[0,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskStructurePrediction.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskStructurePrediction.prototype.constructor=TaskStructurePrediction,TaskStructurePrediction.prototype.icon=function(){return"task_structureprediction"},TaskStructurePrediction.prototype.desc_title=function(){return"generate structure model with AlphaFold2"},TaskStructurePrediction.prototype.platforms=function(){return"LMU"},TaskStructurePrediction.prototype.requiredEnvironment=function(){return["CCP4","ALPHAFOLD_CFG"]},TaskStructurePrediction.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskStructurePrediction.prototype.checkKeywords=function(e){return this.__check_keywords(e,["structure","prediction","molecular","replacement","mr","model","preparation","generation","alphafold","alphafold2","af","af2","colabfold","colab","fold","openfold"])},__template&&(conf=require("../../js-server/server.configuration"),TaskStructurePrediction.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.structureprediction",e,t,this.id]},module.exports.TaskStructurePrediction=TaskStructurePrediction);var __template=null,conf;function TaskSymMatch(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskSymMatch",this.name="symmatch",this.setOName("symmatch"),this.title="Symmetry Match to Reference Structure with CSymMatch",this.input_dtypes=[{data_type:{DataRevision:["xyz","substructure"]},label:"Structure revision",inputId:"revision",tooltip:"Structure that will be matched to reference structure.",version:0,min:1,max:1},{data_type:{DataStructure:["xyz","substructure"],DataXYZ:[]},label:"Reference structure",tooltip:"Structure that will be used as a reference to match the structure revision to.",inputId:"refstruct",version:0,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Additional parameters",open:!0,position:[0,0,1,5],contains:{ORIGINS_CBX:{type:"checkbox",label:"Try all possible origins and hands",tooltip:"Check to explore all possible origins and hands when matching structures.",value:!0,position:[0,0,1,3]},RADIUS:{type:"real_",keyword:"-connectivity-radius",label:"Stiching radius",tooltip:"Radius to use in stiching floating fragments to chains.",range:[0,20],value:"",placeholder:"2.0",position:[1,0,1,1]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskSymMatch.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskSymMatch.prototype.constructor=TaskSymMatch,TaskSymMatch.prototype.icon=function(){return"task_symmatch"},TaskSymMatch.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskSymMatch.prototype.desc_title=function(){return"uses symmetry to match chains"},TaskSymMatch.prototype.checkKeywords=function(e){return this.__check_keywords(e,["csymmatch","symmatch","symmetry","match","comparison","analysis","tools","toolbox"])},__template&&(conf=require("../../js-server/server.configuration"),TaskSymMatch.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.istruct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskSymMatch.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.symmatch",e,t,this.id]},module.exports.TaskSymMatch=TaskSymMatch);var __template=null,conf;function TaskTextEditor(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskTextEditor",this.name="text editor",this.oname="text_editor",this.title="Text editor",this.upload=null,this.input_dtypes=[{data_type:{DataRevision:[],DataSequence:[],DataXYZ:[],DataModel:[],DataEnsemble:[],DataLigand:[],DataLibrary:[]},unchosen_label:"[Select data]",label:"Data object",inputId:"object",customInput:"texteditor",version:1,min:0,max:1}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskTextEditor.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskTextEditor.prototype.constructor=TaskTextEditor,TaskTextEditor.prototype.icon=function(){return"task_texteditor"},TaskTextEditor.prototype.desc_title=function(){return"edit text data in data objects and revisions"},TaskTextEditor.prototype.checkKeywords=function(e){return this.__check_keywords(e,["text","editor"])},TaskTextEditor.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},__template||(TaskTextEditor.prototype.customDataClone=function(e,t){this.upload=null},TaskTextEditor.prototype.runButtonName=function(){return"Save"},TaskTextEditor.prototype.getSelectedFile=function(i){var o,e=this.getInputData(i.inpDataRef,"object")[0],t={name:"",ftype:"",otype:"",stype:""};if(e){var n=e.files;switch(t.otype=e._type,t.otype){case"DataXYZ":case"DataModel":case"DataEnsemble":file_key.xyz in n&&(t.name=n[file_key.xyz],t.ftype=file_key.xyz);break;case"DataSequence":file_key.seq in n&&(t.name=n[file_key.seq],t.ftype=file_key.seq);break;case"DataLigand":case"DataLibrary":file_key.lib in n&&(t.name=n[file_key.lib],t.ftype=file_key.lib);break;case"DataRevision":t.name=e.Options.texteditor.fname,t.stype=e.Options.texteditor.stype;var s=this.getInputItem(i.inpDataRef,"object").dropdown[0];"listener"in s||(s.listener=!0,o=this,s.customGrid.textedit_sel.addOnChangeListener(function(e,t){o.loadFile(i)},!1))}}return i.aceditor.setVisible(0<t.name.length),t},TaskTextEditor.prototype.loadFile=function(t){var i;t.aceinit&&(i=null,(i=(this.upload?this.upload.fspec:this.getSelectedFile(t)).name)?fetchJobOutputFile(this,i,function(e){t.file_loaded=i,t.aceditor.setText(e),t.content_changed=!1},null,function(e){t.file_loaded=null,t.aceditor.setText(""),new MessageBox("Cannot load file","<h2>Cannot load file from server</h2><i>Error: "+e+"</i>.","msg_error"),t.content_changed=!1}):(t.file_loaded=null,t.aceditor.setText(""),t.content_changed=!1))},TaskTextEditor.prototype.inputChanged=function(e,t,i){TaskTemplate.prototype.inputChanged.call(this,e,t,i),this.loadFile(e.grid)},TaskTextEditor.prototype.makeInputPanel=function(e){var e=TaskTemplate.prototype.makeInputPanel.call(this,e),t=e.grid.getNRows();return e.grid.aceditor=new ACEditor(80,40,{"box-shadow":"6px 6px lightgray",theme:"chrome",mode:"python"}),e.grid.setWidget(e.grid.aceditor,t,0,1,5),e.grid.aceinit=!1,e.grid.file_loaded=null,e.grid.content_changed=!1,e.grid.ace_disable=!1,e},TaskTextEditor.prototype.inputPanelResize=function(e,t,i){e.job_dialog._created&&(e.grid.aceinit||(e.grid.aceditor.init("",""),e.grid.aceditor.addOnChangeListener(function(){e.grid.content_changed=!0}),e.grid.aceinit=!0,e.grid.content_changed=!1,this.loadFile(e.grid),e.grid.aceditor.setReadOnly(e.grid.ace_disable)),e.grid.aceditor.setSize_px(t-12,i-86))},TaskTextEditor.prototype.disableInputWidgets=function(e,t){TaskTemplate.prototype.disableInputWidgets.call(this,e,t),e.grid.ace_disable=t,e.grid.aceinit&&e.grid.aceditor.setReadOnly(t)},TaskTextEditor.prototype.doRun=function(e,t){var i;e.grid.file_loaded?e.grid.content_changed?(i=e.grid.aceditor.getText()).trim()?(this.upload={fspec:this.getSelectedFile(e.grid),data:i},TaskTemplate.prototype.doRun.call(this,e,t)):new MessageBox("No data","<h2>Empty data</h2><i>Cannot process empty data.</i>","msg_stop"):new MessageBox("No changes","<h2>Data not changed</h2><i>Nothing to do.</i>","msg_stop"):new MessageBox("No data selected","<h2>No data selected</h2><i>Nothing to do.</i>","msg_stop")},TaskTextEditor.prototype.postSubmit=function(){this.upload.data=null},TaskTextEditor.prototype.onJobDialogClose=function(e,t){this.state==job_code.new&&e.inputPanel.grid.file_loaded&&e.inputPanel.grid.content_changed?new QuestionBox("Close Job Dialog","<h2>Warning</h2><i>Changes will be lost if job dialog is closed without saving data.</i>",[{name:"Close anyway",onclick:function(){t(!0)}},{name:"Cancel",onclick:function(){}}],"msg_confirm"):t(!0)}),__template&&(conf=require("../../js-server/server.configuration"),TaskTextEditor.prototype.makeInputData=function(e,t){var i;"object"in this.input_data.data&&("DataRevision"==(i=this.input_data.data.object[0])._type&&(i.Structure&&"structure"==this.upload.fspec.stype&&(this.input_data.data.ixyz=[i.Structure]),i.Substructure&&"substructure"==this.upload.fspec.stype&&(this.input_data.data.ixyz=[i.Substructure]))),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskTextEditor.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.texteditor",e,t,this.id]},module.exports.TaskTextEditor=TaskTextEditor);var __template=null,path,conf,prj,utils,dtemp;function TaskWebCoot(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskWebCoot",this.name="webcoot (model building)",this.setOName("webcoot"),this.title="Model Building with WebCoot",this.nc_type="browser",this.input_dtypes=[{data_type:{DataRevision:["!phases"]},label:"Structure revision",inputId:"revision",customInput:"coot-mb",version:4,min:1,max:1},{data_type:{DataStructure:[],DataEnsemble:[],DataModel:[],DataXYZ:[]},label:"Additional structures",inputId:"aux_struct",version:0,min:0,max:20},{data_type:{DataLigand:[]},label:"Ligand data",inputId:"ligand",min:0,max:1},{data_type:{DataLigand:[]},label:"",inputId:"void1",version:0,force:1e3,min:0,max:1e3}]}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskWebCoot.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskWebCoot.prototype.constructor=TaskWebCoot,TaskWebCoot.prototype.icon=function(){return"task_webcoot"},TaskWebCoot.prototype.desc_title=function(){return"fit atoms and new ligands in electron density, validate and explore"},TaskWebCoot.prototype.taskDescription=function(){return"Fit atoms and new ligands in electron density, validate and explore"},TaskWebCoot.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},TaskWebCoot.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskWebCoot.prototype.checkKeywords=function(e){return this.__check_keywords(e,["webcoot","coot","model","building","manual-mb","mb","coordinate","editor"])},__template?(path=require("path"),conf=require("../../js-server/server.configuration"),prj=require("../../js-server/server.fe.projects"),utils=require("../../js-server/server.utils"),dtemp=require("../../js-common/dtypes/common.dtypes.template"),TaskWebCoot.prototype.makeInputData=function(e,t){var i,o=null,n=null;if("revision"in this.input_data.data&&(n="substructure"==(i=this.input_data.data.revision[0]).Options.leading_structure?(o=i.Substructure,i.Structure):(o=i.Structure,i.Substructure),this.input_data.data.istruct=[o],n&&"load_all"in i.Options&&i.Options.load_all&&(this.input_data.data.istruct2=[n])),__template.TaskTemplate.prototype.makeInputData.call(this,e,t),o&&"coot_meta"in o&&o.coot_meta)for(var s=o.coot_meta,a=prj.getSiblingJobDirPath(t,s.jobId),r=0;r<s.files.length;r++)utils.copyFile(path.join(a,s.files[r]),path.join(t,s.files[r]))},TaskWebCoot.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.webcoot",e,t,this.id]},module.exports.TaskWebCoot=TaskWebCoot):(TaskWebCoot.prototype.hotButtons=function(){return[RefmacHotButton()]},TaskWebCoot.prototype.launchWebApp=function(e){var n=new WebAppBox("Web-Coot"),s=(n.setOnCloseFunction(function(){e()}),n.launch(),this);fetchFile("js-lib/webCoot/webcoot.html",function(e){var t,e=e.replace("[[baseurl]]",window.location+"js-lib/webCoot/webcoot.html"),i=s.input_data.data.revision[0].Structure,o=[];i&&(file_key.xyz in i.files&&(t=s.getURL("input/"+i.files[file_key.xyz]),o.push({type:"pdb",args:[t,"molecule"]})),file_key.mtz in i.files&&(t=s.getURL("input/"+i.files[file_key.mtz]),i.FWT&&o.push({type:"mtz",args:[t,"map",{F:i.FWT,PHI:i.PHWT,Fobs:i.FP,SigFobs:i.SigFP,FreeR:i.FreeR_flag,isDifference:!1,useWeight:!1,calcStructFact:!0}]}),i.DELFWT&&o.push({type:"mtz",args:[t,"diff-map",{F:i.DELFWT,PHI:i.PHDELWT,isDifference:!0,useWeight:!1,calcStructFact:!1}]}))),e=e.replace("[[meta]]",JSON.stringify({project:s.project,id:s.id})).replace("[[inputFiles]]",JSON.stringify(o)),n.iframe.setHTML(e)},null,function(e){new MessageBox("File not found","file not found","msg_error")})});var __template=null,conf;function TaskWFlowAEP(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskWFlowAEP",this.name="EP automatic workflow",this.setOName("ccp4go_autoep"),this.title="Workflow: Automated Experimental Phasing with Crank-2",this.autoRunId="auto-EP",this.file_select=[{file_types:".mtz,.sca",label:"Reflection Data",tooltip:"[Mandatory] Provide a path to MTZ file with merged or unmerged reflections. Anomalous data should be present.",inputId:"fhkldata",annotate:!1,path:"",min:1},{file_types:".pir,.seq,.fasta",label:"Sequence(s)",tooltip:"[Desired] Provide a path to sequence file in .fasta or .pir format. For importing several sequences put them all in a single file.",inputId:"fseq",path:"",min:1}],this.input_ligands=[{source:"none",smiles:"",code:""}],this.input_dtypes=[{data_type:{DataUnmerged:[],DataHKL:["anomalous"]},label:"Reflection Data",inputId:"hkldata",version:0,min:1,max:1},{data_type:{DataSequence:[]},label:"Sequence",tooltip:"(Optional) Macromolecular sequence(s) expected in ASU.",inputId:"seq",version:0,force:10,min:1,max:10},{data_type:{DataLigand:[]},label:"Ligand data",tooltip:"(Optional) Specify ligands to be fit in electron density.",inputId:"ligand",min:0,max:this.input_ligands.length}],this.parameters={HATOM:{type:"string",keyword:"hatom",label:"<b><i>Main anomalous<br>scatterer</i></b>",reportas:"<b><i>Main anomalous scatterer</i></b>",tooltip:"Specify atom type of dominant anomalous scatterer (e.g., S, SE etc.), or leave blank if uncertain.",iwidth:40,value:"",maxlength:2,position:[0,0,1,1]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskWFlowAEP.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskWFlowAEP.prototype.constructor=TaskWFlowAEP,TaskWFlowAEP.prototype.icon=function(){return"task_wflowaep"},TaskWFlowAEP.prototype.desc_title=function(){return"data import, ASU definition, automatic EP, refinement, ligand fitting and PDB deposition"},TaskWFlowAEP.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskWFlowAEP.prototype.checkKeywords=function(e){return this.__check_keywords(e,["workflow","experimental","phasing","crank2","asu","refinement","auto","automation","auto-ep","automatic","automatization","automatisation","ep","substructure","deposition"])},__template?(conf=require("../../js-server/server.configuration"),TaskWFlowAEP.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.wflow_aep",e,t,this.id]},module.exports.TaskWFlowAEP=TaskWFlowAEP):TaskWFlowAEP.prototype.customDataClone=function(e,t){this.autoRunId0=""};var __template=null,conf;function TaskWFlowDPL(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskWFlowDPL",this.name="Dimple Refinement and Ligand Fitting Workflow",this.setOName("ccp4go_autodpl"),this.title="Workflow: Dimple Refinement and Ligand Fitting",this.autoRunId="auto-DPL",this.file_select=[{file_types:".mtz,.sca",label:"Reflection Data",tooltip:"[Mandatory] Provide a path to MTZ file with merged or unmerged reflections.",inputId:"fhkldata",annotate:!1,path:"",min:1},{file_types:".pdb,.mmcif",label:"Template structure",tooltip:"[Mandatory] Provide a path to PDB file with corresponding structure ",inputId:"fpdb",path:"",min:1},{file_types:".cif",label:"Ligand CIF definition",tooltip:"[Optional] Provide a path to CIF file with your ligand definition ",inputId:"fcif",path:"",min:0},{file_types:".pir,.seq,.fasta",label:"Sequence(s)",tooltip:"[Desired] Provide a path to sequence file in .fasta or .pir format. For importing several sequences put them all in a single file.",inputId:"fseq",path:"",min:1}],this.input_ligands=[{source:"none",smiles:"",code:""}],this.input_dtypes=[{data_type:{DataUnmerged:[],DataHKL:[""]},label:"Reflection Data",inputId:"hkldata",version:0,min:1,max:1},{data_type:{DataSequence:[]},label:"Sequence",tooltip:"(Optional) Macromolecular sequence(s) expected in ASU.",inputId:"seq",version:0,force:10,min:0,max:10},{data_type:{DataLigand:[]},label:"Ligand data",tooltip:"(Optional) Specify ligands to be fit in electron density.",inputId:"ligand",min:0,max:this.input_ligands.length}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskWFlowDPL.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskWFlowDPL.prototype.constructor=TaskWFlowDPL,TaskWFlowDPL.prototype.icon=function(){return"task_wflowdpl"},TaskWFlowDPL.prototype.desc_title=function(){return"data import, Dimple pipeline, ligand fitting, refinement and PDB deposition"},TaskWFlowDPL.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskWFlowDPL.prototype.checkKeywords=function(e){return this.__check_keywords(e,["workflow","dimple","refinement","ligand","finding","difference","fitting","map","refinement","auto","automation","automatic","automatization","automatisation"])},__template?(conf=require("../../js-server/server.configuration"),TaskWFlowDPL.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.wflow_dpl",e,t,this.id]},module.exports.TaskWFlowDPL=TaskWFlowDPL):TaskWFlowDPL.prototype.customDataClone=function(e,t){this.autoRunId0=""};var __template=null,__make_lig=null,conf;function TaskWFlowREL(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskWFlowREL",this.name="Refinement and ligand fitting automatic workflow",this.setOName("ccp4go_autorel"),this.title="Workflow: Automated refinement and ligand fitting",this.autoRunId="auto-REL",this.input_ligands=[{source:"none",smiles:"",code:""}],this.input_dtypes=[{data_type:{DataRevision:["phases"]},label:"Structure revision",inputId:"revision",version:4,min:1,max:1},{data_type:{DataLigand:[]},label:"Ligand data",tooltip:"(Optional) Specify ligands to be fit in electron density.",inputId:"ligand",force:1,min:0,max:this.input_ligands.length}];var e=null,e=__make_lig?__make_lig.__coot_reserved_codes:__coot_reserved_codes;this.parameters={LIGAND_LBL:{type:"label",label:"&nbsp;",position:[0,0,1,5],showon:{ligand:[0,-1]}},sec1:{type:"section",title:"",open:!0,position:[1,0,1,5],showon:{ligand:[0,-1]},contains:{SOURCE_SEL:{type:"combobox",label:"<b><i>Make Ligand</i></b>",tooltip:"Source of data for making a ligand",range:["N|No","S|using SMILES string","M|from Monomer library entry"],value:"N",position:[0,0,1,5]},SMILES:{type:"string_",keyword:"smiles",label:"<i>SMILES string</i>",tooltip:"SMILES string to define ligand structure",iwidth:680,value:"",position:[1,2,1,5],showon:{SOURCE_SEL:["S"]}},CODE:{type:"string_",keyword:"code",label:"<i>Ligand Code</i>",tooltip:"3-letter ligand code for identification",default:"",iwidth:40,value:"",maxlength:3,label2:'<span style="font-size:85%;color:maroon;"><i>if no code is given (recommended), a suitable new one will be autogenerated</i></span>',lwidth2:"100%",position:[2,2,1,1],showon:{SOURCE_SEL:["S"]}},CODE3:{type:"string_",label:"<i>3-letter Code</i>",tooltip:"3-letter ligand code",default:"",iwidth:40,value:"",maxlength:3,label2:"&nbsp;",lwidth2:100,position:[3,2,1,1],showon:{SOURCE_SEL:["M"]}},INFO2_LBL:{type:"label",label:'&nbsp;<br><span style="font-size:85%;color:maroon;"><i>Codes '+e.join(", ")+"<br>are reserved by Coot for own purposes and cannot be used here.</i></span>",position:[4,4,1,5],hideon:{SOURCE_SEL:["N"]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template"),__make_lig=require("./common.tasks.makeligand")),TaskWFlowREL.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskWFlowREL.prototype.constructor=TaskWFlowREL,TaskWFlowREL.prototype.icon=function(){return"task_wflowrel"},TaskWFlowREL.prototype.desc_title=function(){return"refinement, ligand fitting and PDB deposition, starting from a phased structure"},TaskWFlowREL.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskWFlowREL.prototype.checkKeywords=function(e){return this.__check_keywords(e,["workflow","refmac","refmac5","refinement","auto","automation","automatic","automatization","automatisation"])},__template?(conf=require("../../js-server/server.configuration"),TaskWFlowREL.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.wflow_rel",e,t,this.id]},module.exports.TaskWFlowREL=TaskWFlowREL):(TaskWFlowREL.prototype.customDataClone=function(e,t){this.autoRunId0=""},TaskMakeLigand.prototype.collectInput=function(e){var e=TaskTemplate.prototype.collectInput.call(this,e),t=this.parameters.CODE.value;return"M"==this.parameters.SOURCE_SEL.value&&(t=this.parameters.CODE3.value),0<=__coot_reserved_codes.indexOf(t)&&(e+="|<b>ligand code "+t+" is reserved by Coot for own purposes and cannot be used</b>"),e});var __template=null,conf;function TaskWFlowAMR(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskWFlowAMR",this.name="MR automatic workflow",this.setOName("ccp4go_automr"),this.title="Workflow: Automatic Molecular Replacement with MrBump or MoRDa",this.autoRunId="auto-MR",this.file_select=[{file_types:".mtz,.sca",label:"Reflection Data",tooltip:"[Mandatory] Provide a path to MTZ file with merged or unmerged reflections.",inputId:"fhkldata",annotate:!1,path:"",min:1},{file_types:".pir,.seq,.fasta",label:"Sequence(s)",tooltip:"[Desired] Provide a path to sequence file in .fasta or .pir format. For importing several sequences put them all in a single file.",inputId:"fseq",path:"",min:1}],this.input_ligands=[{source:"none",smiles:"",code:""}],this.input_dtypes=[{data_type:{DataUnmerged:[],DataHKL:[]},label:"Reflection Data",inputId:"hkldata",version:0,min:1,max:1},{data_type:{DataSequence:[]},label:"Sequence",tooltip:"(Optional) Macromolecular sequence(s) expected in ASU.",inputId:"seq",version:0,force:10,min:1,max:10},{data_type:{DataLigand:[]},label:"Ligand data",tooltip:"(Optional) Specify ligands to be fit in electron density.",inputId:"ligand",min:0,max:this.input_ligands.length}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskWFlowAMR.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskWFlowAMR.prototype.constructor=TaskWFlowAMR,TaskWFlowAMR.prototype.icon=function(){return"task_wflowamr"},TaskWFlowAMR.prototype.desc_title=function(){return"data import, ASU definition, automatic MR, refinement, ligand fitting and PDB deposition"},TaskWFlowAMR.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskWFlowAMR.prototype.checkKeywords=function(e){return this.__check_keywords(e,["workflow","molecular","replacement","simbad","morda","mrbump","auto","automation","auto-mr","automatic","automatization","automatisation","mr"])},__template?(conf=require("../../js-server/server.configuration"),TaskWFlowAMR.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.wflow_amr",e,t,this.id]},module.exports.TaskWFlowAMR=TaskWFlowAMR):TaskWFlowAMR.prototype.customDataClone=function(e,t){this.autoRunId0=""};var __template=null,conf;function TaskWFlowAFMR(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskWFlowAFMR",this.name="AlphaFold MR workflow",this.setOName("ccp4go_afmr"),this.title="Workflow: Molecular Replacement with AlphaFold Model",this.autoRunId="af-MR",this.file_select=[{file_types:".mtz,.sca",label:"Reflection Data",tooltip:"[Mandatory] Provide a path to MTZ file with merged or unmerged reflections.",inputId:"fhkldata",annotate:!1,path:"",min:1},{file_types:".pir,.seq,.fasta",label:"Sequence(s)",tooltip:"[Desired] Provide a path to sequence file in .fasta or .pir format. For importing several sequences put them all in a single file.",inputId:"fseq",path:"",min:1}],this.input_ligands=[{source:"none",smiles:"",code:""}],this.input_dtypes=[{data_type:{DataUnmerged:[],DataHKL:[]},label:"Reflection Data",inputId:"hkldata",version:0,min:1,max:1},{data_type:{DataSequence:[]},label:"Sequence",tooltip:"(Optional) Macromolecular sequence(s) expected in ASU.",inputId:"seq",version:0,force:10,min:1,max:10},{data_type:{DataLigand:[]},label:"Ligand data",tooltip:"(Optional) Specify ligands to be fit in electron density.",inputId:"ligand",min:0,max:this.input_ligands.length}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskWFlowAFMR.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskWFlowAFMR.prototype.constructor=TaskWFlowAFMR,TaskWFlowAFMR.prototype.icon=function(){return"task_wflowafmr"},TaskWFlowAFMR.prototype.desc_title=function(){return"data import, ASU definition, automatic MR, refinement, ligand fitting and PDB deposition"},TaskWFlowAFMR.prototype.platforms=function(){return"LMU"},TaskWFlowAFMR.prototype.requiredEnvironment=function(){return["CCP4","ALPHAFOLD_CFG"]},TaskWFlowAFMR.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskWFlowAFMR.prototype.checkKeywords=function(e){return this.__check_keywords(e,["workflow","molecular","replacement","af-mr","asu","auto","automation","auto-mr","automatic","automatization","automatisation","mr","structure","prediction","alphafold","alphafold2","af","af2","colabfold","colab","fold","openfold"])},__template?(conf=require("../../js-server/server.configuration"),TaskWFlowAFMR.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.wflow_afmr",e,t,this.id]},module.exports.TaskWFlowAFMR=TaskWFlowAFMR):TaskWFlowAFMR.prototype.customDataClone=function(e,t){this.autoRunId0=""};var __template=null,conf;function TaskWFlowSMR(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskWFlowSMR",this.name="Simple MR workflow",this.setOName("ccp4go_simplemr"),this.title="Workflow: Simple Molecular Replacement with Search Model",this.autoRunId="simple-MR",this.file_select=[{file_types:".mtz,.sca",label:"Reflection Data",tooltip:"[Mandatory] Provide a path to MTZ file with merged or unmerged reflections.",inputId:"fhkldata",annotate:!1,path:"",min:1},{file_types:".pdb,.mmcif",label:"Template structure",tooltip:"[Mandatory] Provide a path to PDB file with a search model",inputId:"fpdb",path:"",min:1},{file_types:".pir,.seq,.fasta",label:"Sequence(s)",tooltip:"[Desired] Provide a path to sequence file in .fasta or .pir format. For importing several sequences put them all in a single file.",inputId:"fseq",path:"",min:1}],this.input_ligands=[{source:"none",smiles:"",code:""}],this.input_dtypes=[{data_type:{DataUnmerged:[],DataHKL:[]},label:"Reflection Data",inputId:"hkldata",version:0,min:1,max:1},{data_type:{DataSequence:[]},label:"Sequence",tooltip:"(Optional) Macromolecular sequence(s) expected in ASU.",inputId:"seq",version:0,force:10,min:1,max:1},{data_type:{DataLigand:[]},label:"Ligand data",tooltip:"(Optional) Specify ligands to be fit in electron density.",inputId:"ligand",min:0,max:this.input_ligands.length},{data_type:{DataXYZ:["protein","dna","rna"]},label:"Template structure",inputId:"xyz",min:1,max:1}],this.parameters={}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskWFlowSMR.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskWFlowSMR.prototype.constructor=TaskWFlowSMR,TaskWFlowSMR.prototype.icon=function(){return"task_wflowsmr"},TaskWFlowSMR.prototype.desc_title=function(){return"data import, ASU definition, phaser MR, refinement, ligand fitting and PDB deposition"},TaskWFlowSMR.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskWFlowSMR.prototype.checkKeywords=function(e){return this.__check_keywords(e,["workflow","molecular","replacement","model","simple","refinement","auto","automation","automatic","automatization","automatisation","mr"])},__template?(conf=require("../../js-server/server.configuration"),TaskWFlowSMR.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.wflow_smr",e,t,this.id]},module.exports.TaskWFlowSMR=TaskWFlowSMR):TaskWFlowSMR.prototype.customDataClone=function(e,t){this.autoRunId0=""};var __template=null,conf;function TaskXDSGUI(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskXDSGUI",this.name="xds (image processing)",this.setOName("xds"),this.title="Interactive Image Processing with XDS",this.nc_type="client",this.input_dtypes=[],this.parameters={L1:{type:"label",label:"<h3>This task will launch XDS GUI on your computer.</h3>",position:[0,0,1,1]},L2:{type:"label",label:"<i>In the end of XDS GUI session, simply save integrated MTZ in default directory</i>",position:[1,0,1,1]}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskXDSGUI.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskXDSGUI.prototype.constructor=TaskXDSGUI,TaskXDSGUI.prototype.icon=function(){return"task_xdsgui"},TaskXDSGUI.prototype.requiredEnvironment=function(){return["CCP4","XDS_home","XDSGUI_home"]},TaskXDSGUI.prototype.lowestClientVersion=function(){return"1.6.005 [29.01.2019]"},TaskXDSGUI.prototype.cloneItems=function(){return["xds_dir"]},TaskXDSGUI.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskXDSGUI.prototype.checkKeywords=function(e){return this.__check_keywords(e,["xds","gui","image","processing"])},__template?(conf=require("../../js-server/server.configuration"),TaskXDSGUI.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.xdsgui",e,t,this.id]},module.exports.TaskXDSGUI=TaskXDSGUI):(TaskXDSGUI.prototype.desc_title=function(){return""},TaskXDSGUI.prototype.onJobDialogStart=function(e){e.run_btn.click()});var __template=null,path,conf,fcl,prj,utils;function TaskXia2(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskXia2",this.name="xia2",this.setOName("xia2"),this.title="Automatic Image Processing with Xia-2",this.nc_type="client-storage",this.imageDirMeta=[],this.hdf5_range="",this.datatype="images",this.file_system="local",this.currentCloudPath="",this.input_dtypes=[],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,8],contains:{PROJECT:{type:"string_",keyword:"project",label:"Project name",tooltip:"Project name for dataset identification (must start with a letter, no spaces)",iwidth:120,value:"",default:"AUTOMATIC",position:[0,0,1,3]},CRYSTAL:{type:"string_",keyword:"crystal",label:"Crystal name",tooltip:"Crystal name for dataset identification",iwidth:120,value:"",default:"DEFAULT",position:[1,0,1,3]},HATOM:{type:"string_",keyword:"atom",label:"Heavy atom type",tooltip:"Heavy atom giving anomalous scattering",iwidth:40,value:"",maxlength:2,position:[2,0,1,1]},HATOM_LBL:{type:"label",label:'<span style="color:maroon;"><i>(must be specified for generating anomalous data)</i></span>',position:[2,3,1,2]}}},sec2:{type:"section",title:"Advanced options",open:!1,position:[1,0,1,8],contains:{PIPELINE:{type:"combobox",keyword:"pipeline",label:"Processing pipeline",tooltip:"Choose the image processing pipeline",range:["2d|MOSFLM & Aimless (2d)","3d|XDS & XSCALE (3d)","3dii|XDS & XSCALE (3d) with indexing using peaks found from all images","dials|DIALS & Aimless (3d)"],value:"dials",position:[0,0,1,5]},PLUGIN:{type:"combobox",keyword:"plugin",label:"Custom plugin",tooltip:"Choose the custom Xia-2 plugin to use",range:["none|None","durin|Durin"],value:"none",position:[1,0,1,5]},SMALL_MOLECULE:{type:"checkbox",label:"Small molecule",tooltip:"If checked, makes processing in manner more suited to small molecule data.",value:!1,position:[2,0,1,3]},SPACE_GROUP:{type:"string_",keyword:"space_group",label:"Space group",tooltip:"Custom space group, e.g. P21",iwidth:80,value:"",maxlength:7,position:[3,0,1,1]},UNIT_CELL:{type:"string_",keyword:"unit_cell",label:"&nbsp;Unit cell:",tooltip:"Comma-separated list of custom unit cell parameters given as a,b,c,&alpha;,&beta;,&gamma;",iwidth:400,value:"",position:[3,4,1,1]},TITLE1:{type:"label",label:"<h3>Resolution limits</h3>",position:[4,0,1,4]},D_MIN:{type:"real_",keyword:"d_min",label:"High resolution cut-off (&Aring;)",tooltip:"High resolution cut-off for scaling and merging",range:[.001,"*"],value:"",position:[5,0,1,1]},CC_HALF:{type:"real_",keyword:"cc_half",label:"Minimum <i>CC<sub>1/2</sub></i>",tooltip:"If given, the resolution cut-off will be chosen such as to keep <i>CC<sub>1/2</sub></i> above the specified value",range:[.001,"*"],value:"",position:[6,0,1,1]},MISIGMA:{type:"real_",keyword:"misigma",label:"Minimum merged <i>I/&sigma;<sub>I</sub></i>",tooltip:"If given, the resolution cut-off will be chosen such as to keep merged <i>I/&sigma;<sub>I</sub></i> above the specified value",range:[.001,"*"],value:"",position:[7,0,1,1]},ISIGMA:{type:"real_",keyword:"isigma",label:"Minimum unmerged <i>I/&sigma;<sub>I</sub></i>",tooltip:"If given, the resolution cut-off will be chosen such as to keep unmerged <i>I/&sigma;<sub>I</sub></i> above the specified value",range:[.001,"*"],value:"",position:[8,0,1,1]}}}},__template||__environ_server.indexOf("Xia2_durin")<0&&delete this.parameters.sec2.contains.PLUGIN}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskXia2.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskXia2.prototype.constructor=TaskXia2,TaskXia2.prototype.icon=function(){return"task_xia2"},TaskXia2.prototype.lowestClientVersion=function(){return"1.6.001 [01.01.2019]"},TaskXia2.prototype.currentVersion=function(){return __template?2+__template.TaskTemplate.prototype.currentVersion.call(this):2+TaskTemplate.prototype.currentVersion.call(this)},TaskXia2.prototype.checkKeywords=function(e){return this.__check_keywords(e,["xia2","xia-2","xia","2","image","processing"])},__template?(path=require("path"),conf=require("../../js-server/server.configuration"),fcl=require("../../js-server/server.fe.facilities"),prj=require("../../js-server/server.fe.projects"),utils=require("../../js-server/server.utils"),TaskXia2.prototype.getNCores=function(e){return e},TaskXia2.prototype.makeInputData=function(e,t){var i=[];if("local"==this.file_system)i=this.imageDirMeta,this.nc_type="client";else{for(var o=fcl.getUserCloudMounts(e),n=0;n<this.imageDirMeta.length;n++){i.push(this.imageDirMeta[n]);var s=i[n].path.split("/");if(2<s.length&&"cloudstorage::"==s[0]){for(var a=null,r=0;r<o.length&&!a;r++)o[r][0]==s[1]&&(a=o[r]);a&&(i[n].path=path.join(a[1],s.slice(2).join("/")))}}this.nc_type="ordinary"}utils.writeObject(prj.getJobDataPath(e,this.project,this.id),this),utils.writeObject(path.join(prj.getInputDirPath(t),"__imageDirMeta.json"),{imageDirMeta:i}),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskXia2.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.xia2",e,t,this.id]},module.exports.TaskXia2=TaskXia2):(TaskXia2.prototype.desc_title=function(){return"performs X-ray diffraction data processing"},TaskXia2.prototype.disableDirectoryInput=function(e,t){for(var i=0;i<e.dir_input.length;i++)e.dir_input[i].browse_btn.setDisabled(t);e.source_select_ddn&&e.source_select_ddn.setDisabled(t),e.datatype_ddn&&e.datatype_ddn.setDisabled(t)},TaskXia2.prototype.collectRangesInput=function(e){for(var t=0;t<e.dir_input.length;t++)if(""!=e.dir_input[t].dir_path.getValue())for(var i=e.dir_input[t].sectors_inp,o=e.imageDirMeta[t].sectors,n=0;n<i.length;n++)o[n].ranges_inp=i[n].getValue()},TaskXia2.prototype.layDirLine=function(e,t,i){var o={},n="";if((n=t<e.imageDirMeta.length?e.imageDirMeta[t].path:n)||(this.hdf5_range=""),"images"==e.datatype?o.label=e.grid1.setLabel("Image "+(c=0<t?"directory #"+(t+1):"directory")+":&nbsp;&nbsp;",i,0,1,1).setTooltip("Path to "+c+" containing diffraction images").setFontItalic(!0).setFontBold(!0).setNoWrap():(o.label=e.grid1.setLabel("Master HDF5 file:&nbsp;&nbsp;",i,0,1,1).setTooltip("Path to master file of HDF5 set of diffraction images").setFontItalic(!0).setFontBold(!0).setNoWrap(),n&&(e.grid1.setLabel("Image range and block size:",i+1,0,1,2).setTooltip("Optional specification of image range and block size").setFontItalic(!0).setFontBold(!0).setNoWrap(),o.hdf5_range=e.grid1.setInputText(this.hdf5_range,i+1,1,1,1).setStyle("text","","e.g., 1:9600:1200 or leave blank","Use processing in blocks if the dataset is excessively large. Format:  start:end:block").setWidth("400px").setNoWrap())),o.browse_btn=e.grid1.setButton("Browse",image_path("open_file"),i,1,1,1).setWidth("120px"),o.dir_path=e.grid1.setInputText(n,i,2,1,1).setWidth("100%").setReadOnly(!0).setNoWrap(),0<t&&t>=e.imageDirMeta.length?o.dir_path.setStyle("","","not used",'Use "Browse" button to choose directory with image files, or leave empty'):o.dir_path.setTooltip('Use "Browse" button to choose directory with image files'),o.remove_btn=e.grid1.setImageButton(image_path("close"),"18px","18px",i,3,1,1),o.sectors_inp=[],t<e.imageDirMeta.length){var s=e.imageDirMeta[t].sectors;if(0<s.length){o.sectors_grid=e.grid1.setGrid("",i+1,2,1,1);for(var a=0;a<s.length;a++){o.sectors_grid.setLabel(s[a].template,a,0,1,1).setFontItalic(!0).setTooltip("Image files template").setNoWrap();for(var r="",l=0;l<s[a].ranges.length;l++)""!=r&&(r+=","),r+=s[a].ranges[l][0]+"-"+s[a].ranges[l][1];"ranges_inp"in s[a]||(s[a].ranges_inp=r),o.sectors_inp.push(o.sectors_grid.setInputText(s[a].ranges_inp,a,1,1,1).setWidth("99%").setNoWrap()),o.sectors_inp[a].setStyle("","","not used; available range(s) "+r,'Give a comma-separated list of desirable image ranges (e.g., "1-10,20-30"), or leave empty if the corresponding file template should not be used. Available range(s) include"'+r+'"'),o.sectors_grid.setVerticalAlignment(a,0,"middle"),o.sectors_grid.setVerticalAlignment(a,1,"middle"),o.sectors_grid.setCellSize("3%","",a,0),o.sectors_grid.setCellSize("auto","",a,1)}o.sectors_grid.setLabel("&nbsp;",s.length,0,1,1)}}e.grid1.setVerticalAlignment(i,0,"middle"),e.grid1.setVerticalAlignment(i,1,"middle"),e.grid1.setVerticalAlignment(i,2,"middle"),e.grid1.setCellSize("auto","",i,0),e.grid1.setCellSize("auto","",i,1),e.grid1.setCellSize("95%","",i,2);var c=e.imageDirMeta.length;return(c<=1||t==c&&""==n)&&o.remove_btn.setVisible(!1),o},TaskXia2.prototype.layDirectoryInput=function(i){for(var e=i.drow,t=(i.dir_input.length,i.imageDirMeta.length),o=(0<t&&"images"==i.datatype?""!=i.imageDirMeta[t-1].path&&t++:t=1,i.grid1.truncateRows(e),i.dir_input=[],this),n=0;n<t;n++)i.dir_input.push(this.layDirLine(i,n,e)),function(t){var e=i.dir_input[t];e.remove_btn.addOnClickListener(function(){o.collectRangesInput(i),i.imageDirMeta.splice(t,1),window.setTimeout(function(){o.layDirectoryInput(i)},0)}),e.browse_btn.addOnClickListener(function(){o.disableDirectoryInput(i,!0),"local"==i.file_system?"images"==i.datatype?localCommand(nc_command.selectImageDir,{dataType:"X-ray",title:"Select Directory with X-ray Diffraction Images"},"Select Directory",function(e){return!!e&&(e.status==nc_retcode.ok?""!=e.data.path&&(o.collectRangesInput(i),t<i.imageDirMeta.length?i.imageDirMeta[t]=e.data:i.imageDirMeta.push(e.data),window.setTimeout(function(){o.layDirectoryInput(i)},0)):new MessageBox("Select Directory Error","Directory selection failed:<p><b>stdout</b>:&nbsp;&nbsp;"+e.data.stdout+"<br><b>stderr</b>:&nbsp;&nbsp;"+e.data.stderr),o.disableDirectoryInput(i,!1),!0)}):localCommand(nc_command.selectFile,{dataType:"HDF5",filters:"HDF5 files (*.h5);All files (*)",title:"Select Master HDF5 file"},"Select Master HDF5 file",function(e){return!!e&&(e.status==nc_retcode.ok?""!=e.data.file&&(i.imageDirMeta=[{path:e.data.file,sectors:[]}],window.setTimeout(function(){o.layDirectoryInput(i)},0)):new MessageBox("Select File Error","File selection failed:<p><b>stdout</b>:&nbsp;&nbsp;"+e.data.stdout+"<br><b>stderr</b>:&nbsp;&nbsp;"+e.data.stderr),o.disableDirectoryInput(i,!1),!0)}):"images"==i.datatype?new CloudFileBrowser(i,o,2,[],function(e){return o.collectRangesInput(i),e.path="cloudstorage::/"+e.path,t<i.imageDirMeta.length?i.imageDirMeta[t]=e:i.imageDirMeta.push(e),window.setTimeout(function(){o.layDirectoryInput(i)},0),0},function(){o.disableDirectoryInput(i,!1)}):new CloudFileBrowser(i,o,0,[],function(e){return 0<e.length&&(e="cloudstorage::/"+o.currentCloudPath+"/"+e[0].name,i.imageDirMeta=[{path:e,sectors:[]}],window.setTimeout(function(){o.layDirectoryInput(i)},0)),1},function(){o.disableDirectoryInput(i,!1)})})}(n),e+=2},TaskXia2.prototype.makeInputPanel=function(e){var t,i=this.makeInputLayout();return i.grid.setWidth("100%"),i.task=this,i.imageDirMeta=this.imageDirMeta,i.file_system=this.file_system,i.datatype=this.datatype,this.setInputDataFields(i.grid,0,e,this),__local_service||__cloud_storage?(this.state!=job_code.new&&this.state!=job_code.running&&i.header.uname_inp.setValue(this.uname.replace(/<(?:.|\n)*?>/gm,"")),i.grid.setLabel("<h2>Input Data</h2>",0,0,1,4).setFontItalic(!0).setNoWrap(),i.grid1=i.grid.setGrid("",1,0,1,4),i.grid.setLabel("&nbsp;",2,0,1,4),i.grid2=i.grid1.setGrid("-compact",0,0,1,4),i.grid2.setLabel("Look for&nbsp;&nbsp;",0,0,1,1).setTooltip('Choose "X-ray images" if your experimental data is presented in form of directories with image files, and "HDF5 datasets" if images are packed in .h5 containers.').setFontItalic(!0).setFontBold(!0).setNoWrap(),i.datatype_ddn=new Dropdown,i.grid2.addWidget(i.datatype_ddn,0,1,1,1),i.datatype_ddn.addItem("X-ray images","","images","images"==i.datatype),i.datatype_ddn.addItem("HDF5 datasets","","hdf5","hdf5"==i.datatype),i.datatype_ddn.make(),i.grid2.setVerticalAlignment(0,0,"middle"),i.grid2.setVerticalAlignment(0,1,"middle"),i.datatype_ddn.addOnChangeListener(function(e,t){i.imageDirMeta=[],i.dir_path=[],i.datatype=t,i.task.layDirectoryInput(i)}),i.datatype_ddn.setWidth("180px"),__local_service&&__cloud_storage?(t='Choose "local" if diffraction images are found in your computer, and choose "cloud" if images are stored in cloud.',i.grid2.setLabel("in&nbsp;&nbsp;",0,2,1,1).setTooltip(t).setFontItalic(!0).setFontBold(!0).setNoWrap(),i.source_select_ddn=new Dropdown,i.grid2.addWidget(i.source_select_ddn,0,3,1,1),i.source_select_ddn.addItem("local file system","","local","local"==i.file_system),i.source_select_ddn.addItem("cloud storage","","cloud","cloud"==i.file_system),i.source_select_ddn.make(),i.source_select_ddn.addOnChangeListener(function(e,t){i.imageDirMeta=[],i.dir_path=[],i.file_system=t,i.task.layDirectoryInput(i)}),i.source_select_ddn.setWidth("180px"),i.source_select_ddn.setTooltip(t)):(i.source_select_ddn=null,i.file_system=__local_service?"local":"cloud",this.file_system=i.file_system,t="",t="local"==this.file_system?(this.nc_type="client","Only images in local file system are available."):(this.nc_type="ordinary","Only images in cloud storage are available. To browse your local file system, connect to CCP4 Cloud using CCP4 Cloud icon launcher found in CCP4 setup."),i.grid2.setLabel("in&nbsp;&nbsp;",0,2,1,1).setTooltip(t).setFontItalic(!0).setFontBold(!0).setNoWrap(),e=new Dropdown,i.grid2.addWidget(e,0,3,1,1),"local"==i.file_system?e.addItem("local file system","","local",!0):e.addItem("cloud storage","","cloud",!0),e.make(),e.setTooltip(t),e.setWidth("180px")),i.grid2.setVerticalAlignment(0,2,"middle"),i.grid2.setVerticalAlignment(0,3,"middle"),i.grid1.setLabel("&nbsp;",1,0,1,1),i.drow=2,i.dir_input=[],this.layDirectoryInput(i),"0"<=(t=this.project.replace(/[^a-zA-Z0-9]/g,"_"))[0]&&t[0]<="9"&&(t="P"+t),this.parameters.sec1.contains.PROJECT.default=t,this.layParameters(i.grid,i.grid.getNRows()+1,0)):i.grid.setLabel("<h2>Neither local service nor cloud storage are available</h2>This task requires either local service running or cloud storage available to user, but neither are detected.",0,0,1,4),i},TaskXia2.prototype.collectInput=function(e){var t="";if(__local_service||__cloud_storage){if(this.datatype=e.datatype,this.file_system=e.file_system,"local"==this.file_system?this.nc_type="client":this.nc_type="ordinary",this.collectRangesInput(e),this.imageDirMeta=[],"images"==this.datatype){for(var i=!0,o=0;o<e.dir_input.length;o++)if(""!=e.dir_input[o].dir_path.getValue()){for(var n=e.imageDirMeta[o].sectors,s=0;s<n.length;s++){var a=n[s].ranges;if(n[s].ranges_sel=[],""!=n[s].ranges_inp)for(var r=n[s].ranges_inp.split(","),l=0;l<r.length;l++){var c=r[l].split("-");if(2!=c.length)t+='|<b><i>Range specification error in "'+r[l]+'" of "'+n[s].ranges_inp+'"</i></b>';else if(isNaN(c[0])||isNaN(c[1]))t+='|<b><i>Numeric format error in "'+r[l]+'" of "'+n[s].ranges_inp+'"</i></b>';else{for(var d=parseInt(c[0]),h=parseInt(c[1]),u=0,p=0;p<a.length&&!u;p++)a[p][0]<=d&&d<=a[p][1]&&(u=a[p][0]<=h&&h<=a[p][1]?1:-1);0<u?(n[s].ranges_sel.push([Math.min(d,h),Math.max(d,h)]),i=!1):u<=0&&(t+='|<b><i>Range "'+r[l]+'" of "'+n[s].ranges_inp+' is not within available options"</i></b>')}}}this.imageDirMeta.push(e.imageDirMeta[o])}}else 0<e.imageDirMeta.length&&(this.imageDirMeta=[e.imageDirMeta[0]],this.hdf5_range=e.dir_input[0].hdf5_range.getValue(),!this.hdf5_range||3==(r=this.hdf5_range.split(":")).length&&isInteger(r[0])&&isInteger(r[1])&&isInteger(r[2])||(t+="|<b><i>Image range and block size specification misformatted</i></b>"));this.imageDirMeta.length<=0?t+="|<b><i>No directory with X-ray images is specified</i></b>":i&&(t+="|<b><i>No images selected</i></b>")}t+=TaskTemplate.prototype.collectInput.call(this,e);var m=this.parameters.sec1.contains.PROJECT.value;return m&&!/^[A-Za-z]([A-Za-z0-9\\-\\._-]{0,})$/.test(m)&&(t+="|<b><i>Parameters/Project name should contain only latin letters, numbers, undescores,<br>dashes and dots, and must start with a letter</i></b>"),startsWith(this.parameters.sec2.contains.PIPELINE.value,"3d")&&(m=__environ_server,"local"==this.file_system&&(m=__environ_client),this.compareEnvironment(["CCP4","XDS_home"],m)||(t+="|<b><i>Chosen pipeline protocol requires XDS Software,<br>however, it was not found installed</i></b>")),t},TaskXia2.prototype.customDataClone=function(e,t){this.currentCloudPath=t.currentCloudPath,this.imageDirMeta=[];for(var i=0;i<t.imageDirMeta.length;i++)this.imageDirMeta.push($.extend(!0,{},t.imageDirMeta[i]));this.file_system=t.file_system,this.datatype=t.datatype,this.hdf5_range=t.hdf5_range,this.uname=""});var __template=null,conf;function TaskXyz2Revision(){for(var e in __template?(__template.TaskDimple.call(this),this.state=__template.job_code.retired):(TaskDimple.call(this),this.state=job_code.retired),this._type="TaskXyz2Revision",this.name="link xyz and hkl",this.oname="*",this.title="Link Coordinates and Reflections",this.input_dtypes=[{data_type:{DataHKL:[]},label:"Reflections",inputId:"hkl",customInput:"cell-info",min:1,max:1},{data_type:{DataXYZ:[]},label:"Coordinates",inputId:"xyz",customInput:"cell-info",min:1,max:1}],this.parameters.sec1.contains)this.parameters.sec1.contains[e].position[0]++,this.parameters.sec1.contains[e].showon={USEDIMPLE_CBX:[!0]};this.parameters.sec1.open=!0,this.parameters.sec1.contains.USEDIMPLE_CBX={type:"checkbox",label:"Run Dimple",tooltip:"Check to run Dimple for optional molecular replacement and refinement",iwidth:280,value:!1,position:[0,0,1,4]},this.forceDimple=!1}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.dimple")),TaskXyz2Revision.prototype=__template?Object.create(__template.TaskDimple.prototype):Object.create(TaskDimple.prototype),TaskXyz2Revision.prototype.constructor=TaskXyz2Revision,TaskXyz2Revision.prototype.icon=function(){return"task_formstructure"},TaskXyz2Revision.prototype.currentVersion=function(){return __template?1+__template.TaskDimple.prototype.currentVersion.call(this):1+TaskDimple.prototype.currentVersion.call(this)},__template?(conf=require("../../js-server/server.configuration"),TaskXyz2Revision.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.xyz2revision",e,t,this.id]},module.exports.TaskXyz2Revision=TaskXyz2Revision):(TaskXyz2Revision.prototype.inputChanged=function(e,t,i){TaskDimple.prototype.inputChanged.call(this,e,t,i);i=e.parameters.USEDIMPLE_CBX.input;if("hkl"==t||"xyz"==t){var o=e.grid.inpDataRef,n=o.input[0].dropdown[0],n=o.input[0].dt[n.getValue()],s=o.input[1].dropdown[0],o=o.input[1].dt[s.getValue()],a="";if("Unspecified"==o.getSpaceGroup())a="No space group -- Dimple will be forced";else if(o.getSpaceGroup()!=n.getSpaceGroup())a="Unmatched space group -- Dimple will be forced";else if(hklp=n.getCellParameters(),(xyzp=o.getCellParameters())[0]<2)a="No cell parameters -- Dimple will be forced";else if(2<Math.abs(hklp[3]-xyzp[3])||2<Math.abs(hklp[4]-xyzp[4])||2<Math.abs(hklp[5]-xyzp[5]))a="Too distant cell parameters -- Dimple will be forced";else{for(var r=!0,l=0;l<3;l++).01<Math.abs(hklp[l]-xyzp[l])/hklp[l]&&(r=!1);r||(a="Too distant cell parameters -- Dimple will be forced")}i.setDisabled(!1),a?(this.forceDimple=!0,s.customGrid.setLabel(a.fontcolor("red"),0,2,1,1).setFontItalic(!0).setNoWrap(),i.getValue()||i.click()):(this.forceDimple=!1,i.getValue()&&i.click()),i.setDisabled(this.forceDimple)}else"USEDIMPLE_CBX"==t&&(i.getValue()?(endsWith(this.title," + Dimple")||(this.title+=" + Dimple"),endsWith(this.name," + dimple")||(this.name+=" + dimple")):(endsWith(this.title," + Dimple")&&(this.title=this.title.substr(0,this.title.length-9)),endsWith(this.name," + dimple")&&(this.name=this.name.substr(0,this.name.length-9))),(n=e.grid.parent.parent).header.title.setText("<b>"+this.title+"</b>"),n.header.uname_inp.setStyle("text","",this.name.replace(/<(?:.|\n)*?>/gm,"")),this.updateInputPanel(n),n.emitSignal(cofe_signals.jobDlgSignal,job_dialog_reason.rename_node))},TaskXyz2Revision.prototype.collectInput=function(e){return(this.forceDimple?TaskDimple:TaskTemplate).prototype.collectInput.call(this,e)});var __template=null,conf;function TaskXyzUtils(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskXyzUtils",this.name="xyz utils",this.oname="*",this.title="Coordinate Utilities",this.input_dtypes=[{data_type:{DataRevision:["xyz"],DataEnsemble:[],DataModel:[],DataXYZ:[]},label:"Structure",inputId:"istruct",min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{ACTION_SEL:{type:"combobox",label:"Perform operation:",tooltip:"",range:["T|Transform structure","S|Split structure in chains","E|Extract sequences","P|Run PDBSET"],value:"T",iwidth:260,position:[0,0,1,1]},SPACER_LBL:{type:"label",keyword:"none",lwidth:"80%",label:" ",position:[0,3,1,2]},SOLLIG_SEL:{type:"combobox",label:"Solvent and ligands:",tooltip:"",range:["U|Leave as is","W|Remove waters","WL|Remove waters and ligands"],value:"U",iwidth:260,position:[1,0,1,1],hideon:{ACTION_SEL:["P"]}},CHAINS_SEL:{type:"combobox",label:"Polymeric chains:",tooltip:"",range:["U|Leave as is","P|Remove protein chains","D|Remove dna/rna chains","S|Remove selected chains"],value:"U",iwidth:260,position:[2,0,1,1],hideon:{ACTION_SEL:["P"]}},CHAIN_LIST:{type:"string",label:"chains:",tooltip:"Comma-separated list of chains to remove",iwidth:"200",value:"",placeholder:"A,B,...",position:[2,4,1,1],showon:{CHAINS_SEL:["S"]}},PDBSET_LBL:{type:"label",keyword:"none",lwidth:800,label:'<div style="font-size:14px;">Set PDBSET keywords and values in the input field below (consult <a href="https://www.ccp4.ac.uk/html/pdbset.html" target="_blank"><i>PDBSET reference</i></a> for more details).<sub>&nbsp;</sub></div>',position:[3,0,1,5],showon:{ACTION_SEL:["P"]}},PDBSET_INPUT:{type:"aceditor_",keyword:"none",tooltip:"",iwidth:800,iheight:320,placeholder:"# For example:\nSYMGEN -X,Y,-Z\nSYMGEN 1/2+X,1/2+Y,Z",value:"",position:[4,0,1,5],showon:{ACTION_SEL:["P"]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskXyzUtils.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskXyzUtils.prototype.constructor=TaskXyzUtils,TaskXyzUtils.prototype.icon=function(){return"task_xyzutils"},TaskXyzUtils.prototype.currentVersion=function(){return __template?0+__template.TaskTemplate.prototype.currentVersion.call(this):0+TaskTemplate.prototype.currentVersion.call(this)},TaskXyzUtils.prototype.checkKeywords=function(e){return this.__check_keywords(e,["xyz","utilities","coordinate","tool","toolbox","pdbset"])},__template?(conf=require("../../js-server/server.configuration"),TaskXyzUtils.prototype.makeInputData=function(e,t){for(var i=[],o=this.input_data.data.istruct,n=0;n<o.length;n++)"DataRevision"==o[n]._type?i.push(o[n].Structure):i.push(o[n]);this.input_data.data.ixyz=i,__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskXyzUtils.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.xyzutils",e,t,this.id]},module.exports.TaskXyzUtils=TaskXyzUtils):(TaskXyzUtils.prototype.desc_title=function(){return"various coordinate transformations, including PDBSET functions"},TaskXyzUtils.prototype.collectInput=function(e){e=TaskTemplate.prototype.collectInput.call(this,e);return"U"==this.parameters.sec1.contains.SOLLIG_SEL.value&&"U"==this.parameters.sec1.contains.CHAINS_SEL.value&&"T"==this.parameters.sec1.contains.ACTION_SEL.value?e+="|<b><i>at least one transformation must be specified</i></b>":"P"!=this.parameters.sec1.contains.ACTION_SEL.value||this.parameters.sec1.contains.PDBSET_INPUT.value.trim()||(e+="|<b><i>no PDBSET instructions -- nothing to do</i></b>"),e});var __template=null,conf;function TaskZanuda(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskZanuda",this.name="zanuda",this.setOName("zanuda"),this.title="Space Group Validation with Zanuda",this.input_dtypes=[{data_type:{DataRevision:["xyz"]},label:"Structure revision",inputId:"revision",version:0,min:1,max:1}],this.parameters={sec1:{type:"section",title:"Parameters",open:!0,position:[0,0,1,5],contains:{MODE:{type:"combobox",keyword:"cloudmode",label:"Work mode",tooltip:"Work mode and results handling",range:["refine_clear|Refine in all space groups, keep the best one","refine_keep|Refine in all space groups, keep all results","transform|Only transform to all space groups, don't refine"],value:"refine_clear",position:[0,0,1,5]}}},sec2:{type:"section",title:"Advanced parameters",open:!1,position:[1,0,1,5],contains:{AVER_CBX:{type:"checkbox",label:"Start from structure transformed into pseudosymmetry space group",tooltip:"Check to start from structure transformed into pseudosymmetry space group",value:!1,position:[0,0,1,3]},NOTWIN_CBX:{type:"checkbox",label:"Check only space group with the same point group as input structure",tooltip:"Check to limit to space group with the same point group as input structure",value:!1,position:[1,0,1,3]}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskZanuda.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskZanuda.prototype.constructor=TaskZanuda,TaskZanuda.prototype.icon=function(){return"task_zanuda"},TaskZanuda.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},TaskZanuda.prototype.desc_title=function(){return"validates space group in case of the presence of pseudosymmetry and twinning"},TaskZanuda.prototype.checkKeywords=function(e){return this.__check_keywords(e,["zanuda","space","group","validation","pseudosymmetry","pseudo-symmetry","pseudo","symmetry","analysis"])},__template&&(conf=require("../../js-server/server.configuration"),TaskZanuda.prototype.makeInputData=function(e,t){var i;"revision"in this.input_data.data&&(i=this.input_data.data.revision[0],this.input_data.data.hkl=[i.HKL],this.input_data.data.struct=[i.Structure]),__template.TaskTemplate.prototype.makeInputData.call(this,e,t)},TaskZanuda.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.zanuda",e,t,this.id]},module.exports.TaskZanuda=TaskZanuda);var __template=null,conf;function TaskHelloWorld(){(__template?__template.TaskTemplate:TaskTemplate).call(this),this._type="TaskHelloWorld",this.name="Hello World!",this.oname="*",this.title="Hello World! First Example",this.input_dtypes=[{data_type:{DataXYZ:[]},label:"XYZ Coordinates",inputId:"xyz",force:1,version:0,min:0,max:20}],this.parameters={sec1:{type:"section",title:"Main options",open:!0,position:[0,0,1,5],contains:{NCLUST:{type:"integer",label:"Number of clusters",tooltip:"Specify the number of clusters between 1 and 50",range:[1,50],value:"10",default:"10",position:[0,0,1,1],hideon:{xyz:[-1,0]}},HATOM:{type:"string",label:"Atom type",tooltip:"Substructure atom giving anomalous scattering",value:"Se",maxlength:2,emitting:!0,position:[1,0,1,1]},PROGRAM:{type:"combobox",label:"Substructure determination program",tooltip:"The program that will be used for substructure determination",range:["_blank_|Auto","pgm_shelxd|ShelXD","pgm_prasa|Prasa"],value:"_blank_",position:[2,0,1,1]},HANDDET_DO:{type:"checkbox",label:"Perform hand determination",tooltip:"Unselect if you wish to skip the hand determination and directly proceed with the current hand",value:!0,position:[3,0,1,1],showon:{HATOM:["Se","Hg"]},hideon:{PROGRAM:["pgm_prasa"]}}}}}}"undefined"!=typeof module&&void 0!==module.exports&&(__template=require("./common.tasks.template")),TaskHelloWorld.prototype=__template?Object.create(__template.TaskTemplate.prototype):Object.create(TaskTemplate.prototype),TaskHelloWorld.prototype.constructor=TaskHelloWorld,TaskHelloWorld.prototype.icon=function(){return"task_helloworld"},TaskHelloWorld.prototype.currentVersion=function(){return __template?1+__template.TaskTemplate.prototype.currentVersion.call(this):1+TaskTemplate.prototype.currentVersion.call(this)},__template&&(conf=require("../../js-server/server.configuration"),TaskHelloWorld.prototype.getCommandLine=function(e,t){return[conf.pythonName(),"-m","pycofe.tasks.helloworld",e,t,this.id]},module.exports.TaskHelloWorld=TaskHelloWorld);
//# sourceMappingURL=jscofe.min.js.map