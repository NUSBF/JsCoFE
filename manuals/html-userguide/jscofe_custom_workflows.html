<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#00020a">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>7. Custom (user-created) project workflows &#8212; CCP4 Cloud 1.8 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="_static/contentui.css" />
    <script src="_static/jquery.js?v=5d32c60e"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/documentation_options.js?v=d13700ae"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/contentui.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. CCP4 Cloud Archive" href="jscofe_archive.html" />
    <link rel="prev" title="6. Cloud Run facility in CCP4i interface" href="jscofe_i1toCloud.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=#005BBB data-md-color-accent=yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#jscofe_custom_workflows" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="CCP4 Cloud 1.8 documentation"
           class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">CCP4 Cloud 1.8 documentation</span>
          <span class="md-header-nav__topic"> 7. Custom (user-created) project workflows </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <script src="_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "versions.json",
        target_loc = "../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">CCP4 Cloud 1.8 documentation</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="CCP4 Cloud 1.8 documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    <a href="index.html"
       title="CCP4 Cloud 1.8 documentation">CCP4 Cloud 1.8 documentation</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="jscofe_about.html" class="md-nav__link">1. About CCP4 Cloud</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_interface.html" class="md-nav__link">2. CCP4 Cloud interface documentation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_workflows.html" class="md-nav__link">3. Structure solution with CCP4 Cloud</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_cloudrun.html" class="md-nav__link">4. Starting CCP4 Cloud projects from the command line</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_globus.html" class="md-nav__link">5. Transferring data to CCP4 Cloud via Globus</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_i1toCloud.html" class="md-nav__link">6. Cloud Run facility in CCP4i interface</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> 7. Custom (user-created) project workflows </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">7. Custom (user-created) project workflows</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#jscofe-custom-workflows--page-root" class="md-nav__link">7. Custom (user-created) project workflows</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#what-are-custom-workflows-and-how-one-can-use-them" class="md-nav__link">7.1. What are custom workflows and how one can use them</a>
        </li>
        <li class="md-nav__item"><a href="#writing-the-workflow-script-wscript" class="md-nav__link">7.2. Writing the Workflow script (WScript)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#simple-mr-workflow" class="md-nav__link">7.2.1. Simple MR Workflow</a>
        </li>
        <li class="md-nav__item"><a href="#conditional-statements-and-other-advanced-operations" class="md-nav__link">7.2.2. Conditional statements and other advanced operations</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#custom-workflow-library" class="md-nav__link">7.3. Custom Workflow Library</a>
        </li>
        <li class="md-nav__item"><a href="#wscript-reference" class="md-nav__link">7.4. WScript Reference</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#header-section" class="md-nav__link">7.4.1. Header section</a>
        </li>
        <li class="md-nav__item"><a href="#input-data-section" class="md-nav__link">7.4.2. Input data section</a>
        </li>
        <li class="md-nav__item"><a href="#input-parameters-section" class="md-nav__link">7.4.3. Input parameters section</a>
        </li>
        <li class="md-nav__item"><a href="#workflow-body-section" class="md-nav__link">7.4.4. Workflow body section</a>
        </li>
        <li class="md-nav__item"><a href="#pre-defined-variables" class="md-nav__link">7.4.5. Pre-defined variables</a>
        </li>
        <li class="md-nav__item"><a href="#mathematrical-expressions-syntax" class="md-nav__link">7.4.6. Mathematrical expressions syntax</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#what-are-custom-workflows-and-how-one-can-use-them" class="md-nav__link">7.1. What are custom workflows and how one can use them</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#writing-the-workflow-script-wscript" class="md-nav__link">7.2. Writing the Workflow script (WScript)</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#simple-mr-workflow" class="md-nav__link">7.2.1. Simple MR Workflow</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#conditional-statements-and-other-advanced-operations" class="md-nav__link">7.2.2. Conditional statements and other advanced operations</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#custom-workflow-library" class="md-nav__link">7.3. Custom Workflow Library</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#wscript-reference" class="md-nav__link">7.4. WScript Reference</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#header-section" class="md-nav__link">7.4.1. Header section</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#input-data-section" class="md-nav__link">7.4.2. Input data section</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#input-parameters-section" class="md-nav__link">7.4.3. Input parameters section</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#workflow-body-section" class="md-nav__link">7.4.4. Workflow body section</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#pre-defined-variables" class="md-nav__link">7.4.5. Pre-defined variables</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#mathematrical-expressions-syntax" class="md-nav__link">7.4.6. Mathematrical expressions syntax</a>
      
    
    </li></ul>
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_archive.html" class="md-nav__link">8. CCP4 Cloud Archive</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_CloudED.html" class="md-nav__link">9. CCP4 Cloud education capabilities</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_QnA.html" class="md-nav__link">10. Questions and Answers</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_troubleshooting.html" class="md-nav__link">11. Troubleshooting</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jscofe_version_log.html" class="md-nav__link">12. CCP4 Cloud Version Log</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#jscofe-custom-workflows--page-root" class="md-nav__link">7. Custom (user-created) project workflows</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#what-are-custom-workflows-and-how-one-can-use-them" class="md-nav__link">7.1. What are custom workflows and how one can use them</a>
        </li>
        <li class="md-nav__item"><a href="#writing-the-workflow-script-wscript" class="md-nav__link">7.2. Writing the Workflow script (WScript)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#simple-mr-workflow" class="md-nav__link">7.2.1. Simple MR Workflow</a>
        </li>
        <li class="md-nav__item"><a href="#conditional-statements-and-other-advanced-operations" class="md-nav__link">7.2.2. Conditional statements and other advanced operations</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#custom-workflow-library" class="md-nav__link">7.3. Custom Workflow Library</a>
        </li>
        <li class="md-nav__item"><a href="#wscript-reference" class="md-nav__link">7.4. WScript Reference</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#header-section" class="md-nav__link">7.4.1. Header section</a>
        </li>
        <li class="md-nav__item"><a href="#input-data-section" class="md-nav__link">7.4.2. Input data section</a>
        </li>
        <li class="md-nav__item"><a href="#input-parameters-section" class="md-nav__link">7.4.3. Input parameters section</a>
        </li>
        <li class="md-nav__item"><a href="#workflow-body-section" class="md-nav__link">7.4.4. Workflow body section</a>
        </li>
        <li class="md-nav__item"><a href="#pre-defined-variables" class="md-nav__link">7.4.5. Pre-defined variables</a>
        </li>
        <li class="md-nav__item"><a href="#mathematrical-expressions-syntax" class="md-nav__link">7.4.6. Mathematrical expressions syntax</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="custom-user-created-project-workflows">
<span id="custom-workflows"></span><h1 id="jscofe-custom-workflows--page-root"><span class="section-number">7. </span>Custom (user-created) project workflows<a class="headerlink" href="#jscofe-custom-workflows--page-root" title="Link to this heading">¶</a></h1>
<p>CCP4 Cloud projects can be developed automatically, using one of pre-defined
<a class="reference internal" href="jscofe_automated_workflows.html#workflows-guide"><span class="std std-ref">automatic workflows</span></a>, as well as <em>custom workflows</em>,
defined by user.</p>
<section id="what-are-custom-workflows-and-how-one-can-use-them">
<span id="custom-workflows-use"></span><h2 id="what-are-custom-workflows-and-how-one-can-use-them"><span class="section-number">7.1. </span>What are custom workflows and how one can use them<a class="headerlink" href="#what-are-custom-workflows-and-how-one-can-use-them" title="Link to this heading">¶</a></h2>
<p>Custom workflow is a script (<em>WScript</em>) describing tasks that need to be
performed and the order of their invocation, <em>i.e.</em>, the workflow algorithm.
The script is placed in a plain text file with extension <code class="docutils literal notranslate"><span class="pre">.wscript</span></code>,
which can be created by most text editors, such as <em>vim</em>, <em>nano</em>, <em>notepad</em>
(Windows), <em>TextEdit</em> (Mac) and similar. Make sure that you save file as
“plain text” when using advanced editors such as <em>MS Word</em>, <em>Libre Office</em>
(not recommended).</p>
<p>Custom workflow can be started in one of 3 ways:</p>
<ul class="simple">
<li><p>Import <code class="docutils literal notranslate"><span class="pre">.wscript</span></code> file with other needed files, such as <code class="docutils literal notranslate"><span class="pre">.mtz</span></code>
(reflections, phases), <code class="docutils literal notranslate"><span class="pre">.pdb</span></code>, <code class="docutils literal notranslate"><span class="pre">.mmcif</span></code> (structure models),
<code class="docutils literal notranslate"><span class="pre">.cif</span></code> (ligand descriptions), <code class="docutils literal notranslate"><span class="pre">.lib</span></code> (restraint libraries),
<code class="docutils literal notranslate"><span class="pre">.seq</span></code>, in a <em>single</em> import task. After importing, the task will
start workflow automatically if <em>WScript</em> is correct and all necessary
data files are provided</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">.wscript</span></code> files to the set of data files in
<a class="reference internal" href="jscofe_cloudrun.html#cloudrun"><span class="std std-ref">CloudRun command file</span></a> (use generic <a class="reference internal" href="jscofe_cloudrun.html#cloudrun-file"><span class="std std-ref">FILE</span></a>
keyword), choose <a class="reference internal" href="jscofe_cloudrun.html#cloudrun-task"><span class="std std-ref">import</span></a> task and execute the
<code class="docutils literal notranslate"><span class="pre">CloudRun</span></code> utility. All file will be uploaded to CCP4 Cloud, project
created and workflow started automatically</p></li>
<li><p>Add <em>WScript</em> to the <em>My Workflows</em> list in the <em>Workflows</em> tab of the
<em>Task List</em>, after which it can be used as any other task in the
system.</p></li>
</ul>
</section>
<section id="writing-the-workflow-script-wscript">
<h2 id="writing-the-workflow-script-wscript"><span class="section-number">7.2. </span>Writing the Workflow script (WScript)<a class="headerlink" href="#writing-the-workflow-script-wscript" title="Link to this heading">¶</a></h2>
<p>The main idea behind workflows is to automate operations when the same project (or branch of a project) needs to be repeated many (100s) times with  different input data, and <strong>WScript</strong> is limited to that purpose.</p>
<p>The easiest way to create a <strong>WScript</strong> file is through using <strong>Workflow Creator</strong> in CCP4 Cloud. Login in your account and open <strong>Task List</strong> in any project.
Then open tab <strong>Workflows</strong>, scroll it to section <strong>My Workflows</strong> in the end and push button <strong>Add workflow</strong>. This will launch <strong>Workflow Creator</strong> window with a template script loaded. It makes a good sense to save the newly created workflow in your personal library, therefore give it a unique <em>Workflow ID</em> on top of the dialog window. For easier workflow identification in <strong>My Workflows</strong> library, you may also change the colour of the workflow icon – simply click on it and choose from available options. Now you can save the script – it will appear in the <strong>My Workflows</strong> section of the <strong>Task List</strong>. You can run it as any other task now, but doing so will result in an empty <strong>Job Dialog</strong>, because we only saved a template, which does nothing.</p>
<p>Let’s give it a useful content now. Click on <strong>Edit</strong> button on the right from  the just created workflow in <strong>My Workflows</strong>, this opens <strong>Workflow Creator</strong> again, with the previous content looking something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># * THIS IS A WORKFLOW SCRIPT TEMPLATE</span>
<span class="c1"># * DO NOT ASSUME THAT IT IS FUNCTIONAL WITHOUT EDITING</span>
<span class="c1"># * CONSULT DOCUMENTATION</span>
<span class="c1">#</span>

<span class="c1"># -----------------------------------------------------</span>
<span class="c1"># Give Workflow Title here</span>
<span class="c1"># -----------------------------------------------------</span>
<span class="c1"># Sun Dec 31 2023</span>
<span class="c1">#</span>

<span class="n">VERSION</span>  <span class="mf">1.0</span>    <span class="c1"># script version for backward compatibility</span>
<span class="n">DEBUG</span>    <span class="n">OFF</span>    <span class="c1"># ON/OFF</span>
<span class="n">COMMENTS</span> <span class="n">ON</span>     <span class="c1"># ON/OFF</span>
<span class="n">WID</span>      <span class="n">d</span><span class="o">-</span><span class="n">imp</span>  <span class="c1"># (optional) workflow ID for import mode</span>

<span class="c1"># ==========================================================================</span>
<span class="c1"># Workflow header -- EDIT AS NECESSARY</span>

<span class="c1"># General workflow descriptors</span>
<span class="n">NAME</span>     <span class="n">my</span> <span class="n">workflow</span>             <span class="c1"># to show in Job Tree</span>
<span class="n">ONAME</span>    <span class="n">my_wflow</span>                <span class="c1"># to use for naming output files</span>
<span class="n">TITLE</span>    <span class="n">My</span> <span class="n">Workflow</span> <span class="n">Title</span>       <span class="c1"># to display in Task List</span>
<span class="n">DESC</span>     <span class="n">my</span> <span class="n">workflow</span> <span class="n">description</span> <span class="c1"># to display in Task List</span>
<span class="n">ICON</span>     <span class="n">Maraschino</span>              <span class="c1"># (optional) workflow icon colour</span>
<span class="n">KEYWORDS</span> <span class="n">my</span> <span class="n">own</span> <span class="n">workflow</span>         <span class="c1"># for using in A-Z keyword search</span>

<span class="n">ALLOW_UPLOAD</span>       <span class="c1"># create file upload widgets if started from project root</span>

<span class="c1"># ==========================================================================</span>
<span class="c1"># Input data section. List all data required, "!" specifies mandatory items.</span>
<span class="c1"># Edit template statements below as necessary:</span>

<span class="c1"># !DATA HKL UNMERGED TYPES anomalous</span>
<span class="c1"># !DATA XYZ          TYPES protein dna rna</span>
<span class="c1"># DATA LIBRARY</span>
<span class="c1"># DATA SEQ           TYPES protein dna rna</span>
<span class="c1"># DATA LIGAND</span>

<span class="c1"># ==========================================================================</span>
<span class="c1"># Workflow parameters section. List all parameters required, "!" specifies</span>
<span class="c1"># mandatory items. Edit template statements below as necessary:</span>

<span class="c1"># !PAR_INTEGER nCycles  # variable name to be used in workflow's expressions</span>
<span class="c1">#    LABEL     Number of cycles</span>
<span class="c1">#    TOOLTIP   Number of refiniement cycles</span>
<span class="c1">#    IWIDTH    40        # (optional) input field width is set to 40 pixels</span>
<span class="c1">#    RANGE     0 50      # (optional) allowed min/max values</span>
<span class="c1">#    DEFAULT   10        # (optional) default integer value</span>

<span class="c1"># PAR_REAL     resHigh   # variable name to be used in workflow's expressions</span>
<span class="c1">#    LABEL     High resolution cut-off (&amp;Aring;)</span>
<span class="c1">#    TOOLTIP   High resolution cut-off, angstrom</span>
<span class="c1">#    IWIDTH    40        # input field width is set to 40 pixels</span>
<span class="c1">#    RANGE     0.1 5.0   # allowed min/max values</span>
<span class="c1">#    DEFAULT   1.5       # default real value</span>

<span class="c1"># !PAR_STRING  atomType  # variable name to be used in workflow's expressions</span>
<span class="c1">#    LABEL     Anomalous scatterer</span>
<span class="c1">#    TOOLTIP   Expected main anomalous scatterer</span>
<span class="c1">#    IWIDTH    20        # input field width is set to 20 pixels</span>
<span class="c1">#    MAXLENGTH 2         # (optional) maximum 2 characters</span>
<span class="c1">#    DEFAULT   Se        # (optional) default string value "Se"</span>

<span class="c1"># PAR_CHECK    reqValReport # variable name to be used in workflow's expressions</span>
<span class="c1">#    LABEL     Request PDB Validation Report</span>
<span class="c1">#    TOOLTIP   Check if deposition files should be prepared and PDB validation report obtained</span>
<span class="c1">#    DEFAULT   Unchecked</span>

<span class="c1"># PAR_COMBO   useBFactors # variable name to be used in workflow's expressions</span>
<span class="c1">#    LABEL     Use isotropic B-factors</span>
<span class="c1">#    TOOLTIP   B-factor mode for refinement</span>
<span class="c1">#    IWIDTH    60        # input field width is set to 60 pixels</span>
<span class="c1">#    OPTION    none  Select from list  # value "none" text "Select from list"</span>
<span class="c1">#    OPTION    yes   Yes               # value "yes"  text "Yes"</span>
<span class="c1">#    OPTION    no    No                # value "no"  text  "No"</span>
<span class="c1">#    DEFAULT   none                    # default string value "none"</span>

<span class="c1"># ==========================================================================</span>
<span class="c1"># Workflow run body</span>
</pre></div>
</div>
<p>In <strong>WScript</strong> lines, everything on the right from the hash “#” sign is a comment and may be safely deleted. Perhaps you may want to delete first few lines from the template, but in general, the more comments you make in the script, the more
understandable and maintainable it is. You can use spaces to your aesthetic
preferences; where there must be a space separator, any number of spaces can be
used.</p>
<p><strong>WScript</strong> is based on single-line statements, containing keywords and values.
Keywords, which normally start <strong>WScript</strong> statements, are case-insensitive.
Values, on contrary, should be specified with respect to upper/lower case. Full
list of keywords is given in the end of this document.</p>
<p>We will create new workflow in several steps now.</p>
<section id="simple-mr-workflow">
<span id="id1"></span><h3 id="simple-mr-workflow"><span class="section-number">7.2.1. </span>Simple MR Workflow<a class="headerlink" href="#simple-mr-workflow" title="Link to this heading">¶</a></h3>
<p>As first example, let’s write a simple workflow, which takes reflection data,
structure template, sequence and solves structure with Molecular Replacement
using Molrep.</p>
<p>Firstly, remove unnecessary lines and put a reasonable annotation in the
header section of the <strong>WScript</strong> file, so that it starts with this
workflow header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># -----------------------------------------------------</span>
<span class="c1"># Molecular Replacement with Molrep</span>
<span class="c1"># -----------------------------------------------------</span>
<span class="c1"># Sun Dec 31 2023</span>
<span class="c1">#</span>

<span class="n">VERSION</span>  <span class="mf">1.0</span>    <span class="c1"># script version for backward compatibility</span>
<span class="n">DEBUG</span>    <span class="n">OFF</span>    <span class="c1"># ON/OFF</span>
<span class="n">COMMENTS</span> <span class="n">ON</span>     <span class="c1"># ON/OFF</span>

<span class="c1"># ==========================================================================</span>
<span class="c1"># Workflow header</span>

<span class="c1"># General workflow descriptors</span>
<span class="n">NAME</span>     <span class="n">molrep</span> <span class="n">workflow</span>         <span class="c1"># to show in Job Tree</span>
<span class="n">ONAME</span>    <span class="n">mrp_wflow</span>               <span class="c1"># to use for naming output files</span>
<span class="n">TITLE</span>    <span class="n">Molrep</span><span class="o">-</span><span class="n">based</span> <span class="n">Workflow</span>   <span class="c1"># to display in Task List</span>
<span class="n">DESC</span>     <span class="n">takes</span> <span class="n">HKL</span><span class="p">,</span> <span class="n">XYZ</span> <span class="ow">and</span> <span class="n">SEQ</span> <span class="ow">and</span> <span class="n">solves</span> <span class="n">structure</span> <span class="k">with</span> <span class="n">Molrep</span>
<span class="n">ICON</span>     <span class="n">Maraschino</span>              <span class="c1"># (optional) workflow icon colour</span>
<span class="n">KEYWORDS</span> <span class="n">molrep</span> <span class="n">workflow</span>         <span class="c1"># for using in A-Z keyword search</span>

<span class="n">ALLOW_UPLOAD</span>       <span class="c1"># create file upload widgets if started from project root</span>
</pre></div>
</div>
<p>You may save the workflow now and check how its description changed in
<strong>My Workflows</strong> list. Re-open it again by pushing the relevant <strong>Edit</strong> button.</p>
<p>Secondly, specify data, which workflow will use, in <strong>WScript</strong>’s’ input data
section (just append these statements to the script):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># ==========================================================================
# Input data section. List all data required, "!" specifies mandatory items.

!DATA HKL
!DATA XYZ  TYPES protein
!DATA SEQ  TYPES protein
</pre></div>
</div>
<p>These statements mean that the workflow requires 3 mandatory items: reflection
data (HKL), search model (XYZ, must be protein chain(s)) and sequence (SEQ,
also of aminoacid type). In order to understand what these statements do, save
the script and create a new task with it from the root of your project – you
should see input fields for data files. To check further, run Cloud’s
<strong>File Import</strong> task and import all needed files, then append your workflow as
the next task – you should see selectors for imported data. You can even run
the workflows now; it will fail immediately though because we did not specify
any tasks in the <strong>WScript</strong> file yet.</p>
<p>We now want to make a sequence of at least 5 tasks:</p>
<ul class="simple">
<li><p>prepare MR model</p></li>
<li><p>define ASU</p></li>
<li><p>run Molrep</p></li>
<li><p>re-build model with, e.g., Modelcraft</p></li>
<li><p>refine with Refmac</p></li>
</ul>
<p>Re-open molrep workflow script in <strong>Workflow Cretor</strong> again. In the bottom of
the dialog window, click button <strong>Add task</strong> and select <em>“Model Preparation XYZ”</em>
in the combobox found in the header. This populates the dialog window with
default task options like in original task interfaces. Choose options that you
want to change, set their values, and push <strong>Add to workflow</strong> button. This
will append the following construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@MODELPREPXYZ</span>
    <span class="n">RUN</span> <span class="n">ModelPrepXYZ</span>
</pre></div>
</div>
<p>to the end of the script if you did not change anything in task parameters.
If a non-default parameter value were chosen, <em>e.g.</em>, if you changed
<em>“Modification protocol”</em> for <em>“PDB Clip”</em>, then the construct would
look slightly different:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@MODELPREPXYZ</span>
    <span class="n">PARAMETER</span> <span class="n">MODIFICATION_SEL</span> <span class="n">D</span>  <span class="c1"># Modification protocol</span>
    <span class="n">RUN</span> <span class="n">ModelPrepXYZ</span>
</pre></div>
</div>
<p>These examples give an idea of how CCP4 Cloud tasks are described in custom
workflows. Each task is represented by a block of lines, which starts with
<em>RUN NAME</em> and finishes with <em>RUN</em> statement. <em>RUN NAME</em> must be a unique
alphanumeric identifier starting with <em>“@”</em> symbol. Other lines between
<em>RUN NAME</em> and <em>RUN</em> statements may contain values for task parameters,
and only non-default parameters should be specified for brevity. See more
details in the <a class="reference internal" href="#wscript-reference"><span class="std std-ref">WScript Reference</span></a> below.</p>
<p>Similarly to the <em>“Model Preparation XYZ”</em> task, you can now add
<em>“ASU Definition”</em>, <em>“Molrep”</em>, <em>“Modelcraft”</em> and <em>“Refmac”</em> tasks to the
workflow, in that order. The resulting <strong>WScript</strong> will look like
the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#
# -----------------------------------------------------
# Molecular Replacement with Molrep
# -----------------------------------------------------
# Sun Dec 31 2023
#

VERSION  1.0    # script version for backward compatibility
DEBUG    OFF    # ON/OFF
COMMENTS ON     # ON/OFF

# ==========================================================================
# Workflow header

# General workflow descriptors
NAME     molrep workflow         # to show in Job Tree
ONAME    mrp_wflow               # to use for naming output files
TITLE    Molrep-based Workflow   # to display in Task List
DESC     takes HKL, XYZ and SEQ and solves structure with Molrep
ICON     Maraschino              # (optional) workflow icon colour
KEYWORDS molrep workflow         # for using in A-Z keyword search

ALLOW_UPLOAD       # create file upload widgets if started from project root

# ==========================================================================
# Input data section. List all data required, "!" specifies mandatory items.

!DATA HKL
!DATA XYZ  TYPES protein
!DATA SEQ  TYPES protein

# ==========================================================================
# Workflow parameters section. List all parameters required, "!" specifies
# mandatory items.

# ==========================================================================
# Workflow run body

@MODELPREPXYZ
    RUN ModelPrepXYZ
#

@ASUDEF
    RUN ASUDef
#

@MOLREP
    RUN Molrep
#

@MODELCRAFT
    RUN ModelCraft
#

@REFMAC
    RUN Refmac
#
</pre></div>
</div>
<p>This makes a completely functional workflow, which you can run now by any of
the three methods described in <a class="reference internal" href="#custom-workflows-use"><span class="std std-ref">What are custom workflows and how one can use them</span></a> (you need to
copy-paste <strong>WScript</strong> from <strong>Workflow Creator</strong> into external file with
<code class="docutils literal notranslate"><span class="pre">.wscript</span></code> extension for using it with the <strong>Import</strong> task or <strong>CloudRun</strong>
utility).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike in manually-developed CCP4 Cloud projects, where a user cannot
create a task if there is no suitable data for it, workflows do not
check or control that task order is correct from the data flow point of
view. Therefore, you should have a good understanding of task order
suitable for your purposes, or, better, take it from a manually developed
project representing your workflow in design.</p>
</div>
</section>
<section id="conditional-statements-and-other-advanced-operations">
<h3 id="conditional-statements-and-other-advanced-operations"><span class="section-number">7.2.2. </span>Conditional statements and other advanced operations<a class="headerlink" href="#conditional-statements-and-other-advanced-operations" title="Link to this heading">¶</a></h3>
<p>At the moment, our molrep workflow is quite straightforward in respect to its
input data and algorithm. We may wish to make it more flexible. For example, it would be good if you can take both merged and unmerged reflection data on input, optimize refinement parameters and, optionally, prepare file for PDB deposition from the best results achieved.</p>
<p><strong>Conditions based on availability of data</strong></p>
<p>Let’s start from optional unmerged reflections input. We can instruct the
workflow to accept both merged and unmerged reflections by modifying the
corresponding <code class="docutils literal notranslate"><span class="pre">DATA</span></code> statement as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!DATA HKL UNMERGED
!DATA XYZ  TYPES protein
!DATA SEQ  TYPES protein
</pre></div>
</div>
<p>Now we need scale and merge unmerged reflections with <em>“Aimless”</em> task, which
should be run before merged reflections are used, <em>i.e.</em>, before
<em>“ASU Definition”</em> or even <em>“Model Preparation XYZ”</em>. To do that, open
workflow’s <strong>WScript</strong> in <strong>Workflow Creator</strong>, place cursor on line just
above the <code class="docutils literal notranslate"><span class="pre">@MODELPREPXYZ</span></code> line and push <strong>Insert task</strong> button, then select
<em>“Aimless”</em> task in new window and push <strong>Insert in workflow</strong> button. This
should modify the beginning of workflow body as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==========================================================================</span>
<span class="c1"># Workflow run body</span>

<span class="nd">@AIMLESS</span>
    <span class="n">DATA</span>      <span class="n">ds0</span>  <span class="n">unmerged</span>
    <span class="n">RUN</span> <span class="n">Aimless</span>
<span class="c1">#</span>

<span class="nd">@MODELPREPXYZ</span>
    <span class="n">RUN</span> <span class="n">ModelPrepXYZ</span>
<span class="c1">#</span>

<span class="nd">@ASUDEF</span>
    <span class="n">RUN</span> <span class="n">ASUDef</span>
<span class="c1">#</span>
</pre></div>
</div>
<p>This fragment will work fine if workflow receives unmerged reflections on input.
However, if, instead, already scaled and merged reflections are supplied,
the <em>“Aimless”</em> task will fail and workflow stop. In order to skip invocation
of <em>“Aimless”</em> task if no data is available, put <code class="docutils literal notranslate"><span class="pre">IFDATA</span></code> statement into
task’s description:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@AIMLESS</span>
    <span class="n">IFDATA</span>    <span class="n">unmerged</span>
    <span class="n">DATA</span>      <span class="n">ds0</span>  <span class="n">unmerged</span>
    <span class="n">RUN</span> <span class="n">Aimless</span>
<span class="c1">#</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>in <code class="docutils literal notranslate"><span class="pre">IFDATA</span></code> statement, <code class="docutils literal notranslate"><span class="pre">unmerged</span></code> must be in lower case.</p>
</div>
<p>Now, the workflow will work with both merged and unmerged reflection data. If a
task needs to be run when data <em>is not</em> available, use <code class="docutils literal notranslate"><span class="pre">IFNOTDATA</span></code> instead.
For example, an equivalent (but less obvious) solution could be</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@AIMLESS</span>
    <span class="n">IFNOTDATA</span> <span class="n">hkl</span>
    <span class="n">DATA</span>      <span class="n">ds0</span>  <span class="n">unmerged</span>
    <span class="n">RUN</span> <span class="n">Aimless</span>
<span class="c1">#</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>data names in <code class="docutils literal notranslate"><span class="pre">IFDATA</span></code> and <code class="docutils literal notranslate"><span class="pre">IFNOTDATA</span></code> statements are given by the
lower-case versions of the corresponding data types used in <code class="docutils literal notranslate"><span class="pre">DATA</span></code>
statements, i.e., <code class="docutils literal notranslate"><span class="pre">hkl</span></code>, <code class="docutils literal notranslate"><span class="pre">unmerged</span></code>, <code class="docutils literal notranslate"><span class="pre">xyz</span></code>, <code class="docutils literal notranslate"><span class="pre">seq</span></code> and so on.
See <a class="reference internal" href="#wscript-reference"><span class="std std-ref">WScript Reference</span></a>  for details.</p>
</div>
<p><strong>Looping and Branching</strong></p>
<p>Sometimes, a task needs to be run with same data but varying parameters. In
CCP4 Cloud terms, this is equivalent to cloning task with suitable modification
of parameter(s) of interest. For example, imagine that you wish to repeat
<em>“Refmac”</em> task with suggested parameters until no suggestions are generated or
number of runs exceeds a certain number (let’s say, 5). The following fragment
gives an idea of how this may be programmed in <strong>WScript</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialise loop control parameters</span>

<span class="n">let</span> <span class="nb">iter</span>   <span class="o">=</span> <span class="mi">1</span>     <span class="c1"># iteration serial number</span>
<span class="n">let</span> <span class="n">iter0</span>  <span class="o">=</span> <span class="mi">0</span>     <span class="c1"># iteration number of result with the lowest Rfree</span>
<span class="n">let</span> <span class="n">Rfree0</span> <span class="o">=</span> <span class="mf">1.0</span>   <span class="c1"># the lowest Rfree achieved</span>

<span class="nd">@REFINE</span><span class="o">-</span><span class="n">OPT</span><span class="p">[</span><span class="nb">iter</span><span class="p">]</span>  <span class="c1"># [iter] modifies the RUN NAME implicitly to make it unique</span>
    <span class="n">USE_SUGGESTED_PARAMETERS</span>   <span class="c1"># use suggested parameters or defaults if none</span>
    <span class="n">RUN</span>       <span class="n">Refmac</span>

<span class="c1"># capture iteration number with the lowest Rfree achieved</span>
<span class="n">let</span> <span class="n">iter0</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">;</span> <span class="n">Rfree0</span> <span class="o">=</span> <span class="n">Rfree</span>  <span class="k">if</span>  <span class="n">Rfree</span><span class="o">&lt;</span><span class="n">Rfree0</span>
<span class="n">let</span> <span class="nb">iter</span>  <span class="o">=</span> <span class="nb">iter</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># keep iterating if conditions are met and pass otherwise</span>
<span class="n">repeat</span> <span class="nd">@REFINE</span><span class="o">-</span><span class="n">OPT</span> <span class="k">while</span> <span class="n">suggested</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">iter</span><span class="o">&lt;</span><span class="mi">5</span>

<span class="c1"># continue further down from iteration with the lowest Rfree</span>
<span class="n">branch</span> <span class="nd">@REFINE</span><span class="o">-</span><span class="n">OPT</span><span class="p">[</span><span class="n">iter0</span><span class="p">]</span>
</pre></div>
</div>
<p>In this fragment, workflow allocates 3 variables <code class="docutils literal notranslate"><span class="pre">iter</span></code>, <code class="docutils literal notranslate"><span class="pre">iter0</span></code> and
<code class="docutils literal notranslate"><span class="pre">Rfree0</span></code> and uses predefined variables <code class="docutils literal notranslate"><span class="pre">Rfree</span></code> (achieved <em>R_free</em>) and
<code class="docutils literal notranslate"><span class="pre">suggested</span></code> (the number of suggested changes to <em>Refmac</em> parameters).
You may replace <code class="docutils literal notranslate"><span class="pre">@REFMAC</span></code> run construct with this entire fragment in our
molrep workflow and re-run it to see the result.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">branch</span></code> statement specifies results from which particular task will be
taken for further processing. In this example, results with lowest <em>R_free</em>
will be chosen. To see this, append another task, such as
<em>“PDB Validation Report”</em> to the workflow and re-run it.</p>
<p><strong>Workflow parameters</strong></p>
<p>Suppose now that we want to introduce workflow parameters, which a user could manipulate as in any other task. For example, let the user set a resolution cut-off in <strong>Aimless</strong> and decide whether to run the <strong>Modelcraft</strong> task. For this, add input of real-number parameter and a checkbox in
<a class="reference internal" href="#wscript-reference-input-parameters"><span class="std std-ref">Input parameters section</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==========================================================================</span>
<span class="c1"># Workflow parameters section. List all parameters required, "!" specifies</span>
<span class="c1"># mandatory items.</span>

<span class="n">PAR_REAL</span>      <span class="n">resHigh</span>   <span class="c1"># variable name to be used in workflow's expressions</span>
    <span class="n">LABEL</span>     <span class="n">High</span> <span class="n">resolution</span> <span class="n">cut</span><span class="o">-</span><span class="n">off</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">Aring</span><span class="p">;)</span>
    <span class="n">TOOLTIP</span>   <span class="n">High</span> <span class="n">resolution</span> <span class="n">cut</span><span class="o">-</span><span class="n">off</span><span class="p">,</span> <span class="n">angstrom</span>
    <span class="n">IWIDTH</span>    <span class="mi">40</span>        <span class="c1"># input field width is set to 40 pixels</span>
    <span class="n">RANGE</span>     <span class="mf">0.1</span> <span class="mf">5.0</span>   <span class="c1"># allowed min/max values</span>
    <span class="n">DEFAULT</span>   <span class="mf">1.5</span>       <span class="c1"># default value</span>

<span class="n">PAR_CHECK</span>     <span class="n">runModelcraft</span> <span class="c1"># variable name to be used in workflow's expressions</span>
    <span class="n">LABEL</span>     <span class="n">Re</span><span class="o">-</span><span class="n">build</span> <span class="n">model</span>
    <span class="n">TOOLTIP</span>   <span class="n">Check</span> <span class="k">if</span> <span class="n">phased</span> <span class="n">model</span> <span class="n">should</span> <span class="n">be</span> <span class="n">re</span><span class="o">-</span><span class="n">built</span>
    <span class="n">DEFAULT</span>   <span class="n">Checked</span>
</pre></div>
</div>
<p>Save <strong>WScript</strong>, create a new molrep workflow task and check how graphical
widgets for parameters look like.</p>
<p>When workflow is started, it assigns input parameters (either given by user or
read from <em>DEFAULT</em> fields) to internal variables specified in <em>PAR_XXX</em>
statements. In the above example, two variables: <em>resHigh</em> and <em>runModelcraft</em>
will be created for high-resolution cutoff (real) and flag for running
<em>Modelcraft</em> (boolean <em>True/False</em>), respectively. In order to use these flags,
remove <em>Aimless</em> task from the workflow and re-insert it in the same place
with <strong>Workflow Creator</strong>. When selecting <em>Aimless</em> in the task menu, specify
a non-default value for the high-resolution cut-off, for example, 1.4A. This
will give code fragment as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@AIMLESS</span>
    <span class="n">DATA</span>      <span class="n">ds0</span>  <span class="n">unmerged</span>
    <span class="n">PARAMETER</span> <span class="n">RESO_HIGH</span> <span class="mf">1.4</span>  <span class="c1"># high resolution cut-off (&amp;Aring;)</span>
    <span class="n">RUN</span> <span class="n">Aimless</span>
</pre></div>
</div>
<p>Now specify place the internal variable from the resolution cut-off widget
instead of “1.4” and restore the <code class="docutils literal notranslate"><span class="pre">IFDATA</span></code> statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@AIMLESS</span>
    <span class="n">IFDATA</span>    <span class="n">unmerged</span>
    <span class="n">DATA</span>      <span class="n">ds0</span>  <span class="n">unmerged</span>
    <span class="n">PARAMETER</span> <span class="n">RESO_HIGH</span> <span class="n">resHigh</span>  <span class="c1"># high resolution cut-off (&amp;Aring;)</span>
    <span class="n">RUN</span> <span class="n">Aimless</span>
<span class="c1">#</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Where a variable is used, any function can be used as well. For example,
one can put <code class="docutils literal notranslate"><span class="pre">2*resHigh</span></code>, <code class="docutils literal notranslate"><span class="pre">max(1.5,resHigh)</span></code> and similar expressions
instead of <code class="docutils literal notranslate"><span class="pre">resHigh</span></code> in the above <strong>WScript</strong> fragment.</p>
</div>
<p>As for the <em>Modelcraft</em>, we need simply to indicate that the task should be
run if <code class="docutils literal notranslate"><span class="pre">runModelcraft</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@MODELCRAFT</span>
    <span class="n">IF</span> <span class="n">runModelcraft</span>
    <span class="n">RUN</span> <span class="n">ModelCraft</span>
</pre></div>
</div>
<p>The final <strong>WScript</strong> for our molrep workflow reads as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#
# -----------------------------------------------------
# Molecular Replacement with Molrep
# -----------------------------------------------------
# Sun Dec 31 2023
#

VERSION  1.0    # script version for backward compatibility
DEBUG    OFF    # ON/OFF
COMMENTS ON     # ON/OFF

# ==========================================================================
# Workflow header

# General workflow descriptors
NAME     molrep workflow         # to show in Job Tree
ONAME    mrp_wflow               # to use for naming output files
TITLE    Molrep-based Workflow   # to display in Task List
DESC     takes HKL, XYZ and SEQ and solves structure with Molrep # to display in Task List
ICON     Maraschino              # (optional) workflow icon colour
KEYWORDS molrep workflow         # for using in A-Z keyword search

ALLOW_UPLOAD       # create file upload widgets if started from project root

# ==========================================================================
# Input data section. List all data required, "!" specifies mandatory items.

!DATA HKL
!DATA XYZ  TYPES protein
!DATA SEQ  TYPES protein

# ==========================================================================
# Workflow parameters section. List all parameters required, "!" specifies
# mandatory items.

PAR_REAL     resHigh   # variable name to be used in workflow's expressions
    LABEL     High resolution cut-off (&amp;Aring;)
    TOOLTIP   High resolution cut-off, angstrom
    IWIDTH    40        # input field width is set to 40 pixels
    RANGE     0.1 5.0   # allowed min/max values
    DEFAULT   1.5       # default real value

PAR_CHECK     runModelcraft # variable name to be used in workflow's expressions
    LABEL     Re-build model
    TOOLTIP   Check if phased model should be re-built
    DEFAULT   Checked

# ==========================================================================
# Workflow run body

@AIMLESS
    IFDATA    unmerged
    DATA      ds0  unmerged
    PARAMETER RESO_HIGH resHigh  # high resolution cut-off (&amp;Aring;)
    RUN Aimless
#

@MODELPREPXYZ
    RUN ModelPrepXYZ
#

@ASUDEF
    RUN ASUDef
#

@MOLREP
    RUN Molrep
#

@MODELCRAFT
    IF runModelcraft
    RUN ModelCraft
#

# Initialise loop control parameters

let iter   = 1     # iteration serial number
let iter0  = 0     # iteration number of result with the lowest Rfree
let Rfree0 = 1.0   # the lowest Rfree achieved

@REFINE-OPT[iter]  # [iter] modifies the RUN NAME implicitly to make it unique
    USE_SUGGESTED_PARAMETERS   # use suggested parameters or defaults if none
    RUN       Refmac

# capture iteration number with the lowest Rfree achieved
let iter0 = iter; Rfree0 = Rfree  if  Rfree&lt;Rfree0
let iter  = iter + 1

# keep iterating if conditions are met and pass otherwise
repeat @REFINE-OPT while suggested&gt;0 and iter&lt;5

# continue further down from iteration with the lowest Rfree
branch @REFINE-OPT[iter0]

#

@PDBVAL
    RUN PDBVal
#
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Workflows with input parameters cannot be used in <em>Import</em> task and in the
<em>CloudRun</em> utility.</p>
</div>
</section>
</section>
<section id="custom-workflow-library">
<h2 id="custom-workflow-library"><span class="section-number">7.3. </span>Custom Workflow Library<a class="headerlink" href="#custom-workflow-library" title="Link to this heading">¶</a></h2>
<p>CCP4 Cloud comes with a library of custom workflows, which give <strong>WScript</strong>
examples for few typical scenarios. They can be also used as templates for
your own developments. Just open <strong>Workflow Creator</strong>, push <strong>Library</strong>
button and select a suitable <strong>WScript</strong>. It can be further modified to your
needs as any text file.</p>
</section>
<section id="wscript-reference">
<span id="id2"></span><h2 id="wscript-reference"><span class="section-number">7.4. </span>WScript Reference<a class="headerlink" href="#wscript-reference" title="Link to this heading">¶</a></h2>
<p><strong>WScript</strong> file consists of four <strong>sections</strong>, which must follow order presented
in this Reference. Each section contains a specific set of <strong>WScript</strong>
statements; no statement from one section can appear in another one. Section
separators are not used; <strong>WScript</strong> recognises sections automatically. Only
<a class="reference internal" href="#wscript-reference-input-parameters"><span class="std std-ref">Input parameters section</span></a> can be empty.</p>
<p>All <strong>WScript</strong> <strong>statements</strong> occupy a single line. Statements start with a
case-insensitive primary key, which may be followed by additional case-insensitive
key(s) and values. Any number of consecutive spaces is equivalent to one space,
except when these spaces occur in string-type values. Part of line starting
from hash sign “#” is considered as a comment and is ignored; empty lines are
ignored, too.</p>
<p>Some <strong>WScript</strong> constructs are made of several statements, which must be
placed on consecutive lines (comments and empty lines ignored). Such constructs
have mandatory leading and trailing statements, other statements can be placed
in arbitrary order.</p>
<p><strong>WScript</strong> supports pre-defined and user-defined variables, which can hold
real, integer, boolean and string values. String literals must be double-quoted
(<em>e.g.</em>, “this is a string literal”), boolean literals are case-sensitive
<code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code>. Pre-defined variables get their values from completed
tasks; see details in <a class="reference internal" href="#wscript-reference-predefined-variables"><span class="std std-ref">Pre-defined variables</span></a>.</p>
<p>Wherever variable’s value is used, any in-line expression can be placed instead,
which may also include other variables; reference to variable’s value should be
viewed as a computable trivial expression made of a single variable. See
available functions, constants and operators in
<a class="reference internal" href="#wscript-reference-expression-syntax"><span class="std std-ref">Mathematrical expressions syntax</span></a>.</p>
<section id="header-section">
<span id="wscript-reference-header"></span><h3 id="header-section"><span class="section-number">7.4.1. </span>Header section<a class="headerlink" href="#header-section" title="Link to this heading">¶</a></h3>
<p>Header section comes first in <strong>WScript</strong> and cannot be empty.</p>
<table id="id3">
<caption><span class="caption-text">Header section</span><a class="headerlink" href="#id3" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 8.0%"/>
<col style="width: 6.0%"/>
<col style="width: 6.0%"/>
<col style="width: 80.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Mandatory</p></th>
<th class="head"><p>Values</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VERSION</p></td>
<td><p>No</p></td>
<td><p>Numeric</p></td>
<td><p>Version number, dependent on CCP4 Cloud version, for backward compatibility.
Outdated versions will be reported when workflow is used. Default value:
<code class="docutils literal notranslate"><span class="pre">1.0</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>DEBUG</p></td>
<td><p>No</p></td>
<td><p>ON/OFF</p></td>
<td><p>Flag to produce extended workflow log and diagnostics. Default value:
<code class="docutils literal notranslate"><span class="pre">OFF</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>COMMENTS</p></td>
<td><p>No</p></td>
<td><p>ON/OFF</p></td>
<td><p>Flag to produce additional comments such as results of <em>LET</em> statements
in workflow log. Default value: <code class="docutils literal notranslate"><span class="pre">ON</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>WID</p></td>
<td><p>Yes/No</p></td>
<td><p>String</p></td>
<td><p>Workflow ID which <strong>must be given</strong> when workflow is used in <em>Import</em> task
or via <strong>CloudRun</strong> utility. Ignored if workflow is used as task included
in <strong>My Workflows</strong> section of the <strong>Task List</strong>. Default value is not set.</p></td>
</tr>
<tr class="row-even"><td><p>NAME</p></td>
<td><p>No</p></td>
<td><p>String</p></td>
<td><p>Workflow name which identifies workflow task in <strong>Job Tree</strong>; can contain
several space-separated words if necessary. Default value: <code class="docutils literal notranslate"><span class="pre">Workflow</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>ONAME</p></td>
<td><p>No</p></td>
<td><p>String</p></td>
<td><p>Alphanumeric word used to name data objects created by the <em>Workflow</em> task.
Default value: <code class="docutils literal notranslate"><span class="pre">workflow</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>TITLE</p></td>
<td><p>No</p></td>
<td><p>String</p></td>
<td><p>Workflow title which identifies workflow task in <strong>Task List</strong> and
report pages; can contain several space-separated words if necessary.
Default value: <code class="docutils literal notranslate"><span class="pre">Workflow</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>DESC</p></td>
<td><p>No</p></td>
<td><p>String</p></td>
<td><p>Workflow description which appears in small font under the workflow title
in <strong>Task List</strong> and report pages; can contain several space-separated
words if necessary. Default value: <code class="docutils literal notranslate"><span class="pre">custom</span> <span class="pre">workflow</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>ICON</p></td>
<td><p>No</p></td>
<td><p>String</p></td>
<td><p>Colour code for workflow’s icon, which can help to organise
<strong>My Workflows</strong> section in <strong>Task List</strong>. Available codes include:
<code class="docutils literal notranslate"><span class="pre">Aqua</span></code>, <code class="docutils literal notranslate"><span class="pre">Asparagus</span></code>, <code class="docutils literal notranslate"><span class="pre">Black</span></code>, <code class="docutils literal notranslate"><span class="pre">Gold</span></code>, <code class="docutils literal notranslate"><span class="pre">Grape</span></code>, <code class="docutils literal notranslate"><span class="pre">Lavender</span></code>,
<code class="docutils literal notranslate"><span class="pre">Maraschino</span></code>, <code class="docutils literal notranslate"><span class="pre">Maroon</span></code>, <code class="docutils literal notranslate"><span class="pre">Mocha</span></code>, <code class="docutils literal notranslate"><span class="pre">Pink</span></code>, <code class="docutils literal notranslate"><span class="pre">Salmon</span></code>, <code class="docutils literal notranslate"><span class="pre">Spring</span></code>,
<code class="docutils literal notranslate"><span class="pre">Tangerine</span></code>, <code class="docutils literal notranslate"><span class="pre">Teal</span></code>, <code class="docutils literal notranslate"><span class="pre">Tin</span></code>. Default value: <code class="docutils literal notranslate"><span class="pre">Aqua</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>KEYWORDS</p></td>
<td><p>No</p></td>
<td><p>String</p></td>
<td><p>Space-separated listr of keywords to be used in <strong>A-Z</strong> tab of
<strong>Task List</strong> for keyword-based task searches. Default value:
<code class="docutils literal notranslate"><span class="pre">workflow</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>ALLOW_UPLOAD</p></td>
<td><p>No</p></td>
<td></td>
<td><p>If given, this keyword creates file upload widgets, which are used
instead of object selection widgets when workflow task is invoked from
the root of <strong>Job Tree</strong>. This keyword should not be used if workflow
cannot be run from the root (for example, if it uses <em>Structure Revision</em>
as one input data type).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="input-data-section">
<span id="wscript-reference-input-data"></span><h3 id="input-data-section"><span class="section-number">7.4.2. </span>Input data section<a class="headerlink" href="#input-data-section" title="Link to this heading">¶</a></h3>
<p>Input data section must follow <a class="reference internal" href="#wscript-reference-header"><span class="std std-ref">Header section</span></a> and cannot
be empty. The section may contain only <code class="docutils literal notranslate"><span class="pre">DATA</span></code> and <code class="docutils literal notranslate"><span class="pre">!DATA</span></code> statements, where
exclamation mark means that data input is mandatory. One <code class="docutils literal notranslate"><span class="pre">DATA</span></code> statement
creates a single graphical widget, which can take specified data objects. The
statement has the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DATA</span> <span class="nb">object</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">[</span><span class="n">TYPES</span> <span class="n">subtype</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">TYPES</span></code> part is optional.</p>
<table id="id4">
<caption><span class="caption-text">Header section: data objects</span><a class="headerlink" href="#id4" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 15.0%"/>
<col style="width: 85.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Object name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>UNMERGED</p></td>
<td><p>Unmerged reflection dataset</p></td>
</tr>
<tr class="row-odd"><td><p>HKL</p></td>
<td><p>Merged reflection dataset</p></td>
</tr>
<tr class="row-even"><td><p>XYZ</p></td>
<td><p>Structure model coordinates</p></td>
</tr>
<tr class="row-odd"><td><p>SEQ</p></td>
<td><p>Macromolecular sequence</p></td>
</tr>
<tr class="row-even"><td><p>LIBRARY</p></td>
<td><p>Crystallographic restraints’ library for non-standard residues and
ligands not found in CCP4 Monomer Library</p></td>
</tr>
<tr class="row-odd"><td><p>LIGAND</p></td>
<td><p>Ligand descriptions for fitting in electron density. This will create
graphical widgets for specifying either a SMILES string, 3-letter ligand
code or upload a <code class="docutils literal notranslate"><span class="pre">.cif</span></code> file with ligand descriptions.</p></td>
</tr>
</tbody>
</table>
<table id="id5">
<caption><span class="caption-text">Header section: data objects subtypes</span><a class="headerlink" href="#id5" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 15.0%"/>
<col style="width: 85.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Subtype name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>anomalous</p></td>
<td><p>Reflection dataset with anomalous scattering</p></td>
</tr>
<tr class="row-odd"><td><p>protein</p></td>
<td><p>Structure coordinates or sequence corresponding to an amino acid chain</p></td>
</tr>
<tr class="row-even"><td><p>RNA</p></td>
<td><p>Structure coordinates or sequence corresponding to a ribonucleic acid
chain</p></td>
</tr>
<tr class="row-odd"><td><p>DNA</p></td>
<td><p>Structure coordinates or sequence corresponding to a deoxyribonucleic
acid chain</p></td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Mandatory input of either unmerged or merged reflection dataset
# containing anomalous signal
!DATA UNMERGED HKL TYPES anomalous

# Optional input of protein structure model
DATA XYZ TYPES protein

# Mandatory input of sequence of any type
!DATA SEQ

# Mandatory input of sequence of any type (alternative)
!DATA SEQ TYPES protein dna rna
</pre></div>
</div>
</section>
<section id="input-parameters-section">
<span id="wscript-reference-input-parameters"></span><h3 id="input-parameters-section"><span class="section-number">7.4.3. </span>Input parameters section<a class="headerlink" href="#input-parameters-section" title="Link to this heading">¶</a></h3>
<p>Input parameters section is optional. If used, it must follow
<a class="reference internal" href="#wscript-reference-input-data"><span class="std std-ref">Input data section</span></a>. The section is made of principal
statements <code class="docutils literal notranslate"><span class="pre">PAR_*</span></code> or <code class="docutils literal notranslate"><span class="pre">!PAR_*</span></code> followed by their specifications. The leading
exclamation mark means that user’s input is mandatory and the corresponding
parameter cannot have a default value. On contrary, <code class="docutils literal notranslate"><span class="pre">PAR_*</span></code> statements must
have a default parameter specified. The exclamation mark cannot be applied in
case of <code class="docutils literal notranslate"><span class="pre">PAR_CHECK</span></code> and <code class="docutils literal notranslate"><span class="pre">PAR_COMBO</span></code> parameters, which always have a
default value.</p>
<table id="id6">
<caption><span class="caption-text">Principal parameter statements</span><a class="headerlink" href="#id6" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 8.0%"/>
<col style="width: 10.0%"/>
<col style="width: 82.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PAR_INTEGER</p></td>
<td><p>variable’s name</p></td>
<td><p>Creates graphical widget for integer number input. The input is assigned
to internal workflow variable with specified name, which is created
automatically.</p></td>
</tr>
<tr class="row-odd"><td><p>PAR_REAL</p></td>
<td><p>variable’s name</p></td>
<td><p>Creates graphical widget for real number input. The input is assigned to
internal workflow variable with specified name, which is created
automatically.</p></td>
</tr>
<tr class="row-even"><td><p>PAR_STRING</p></td>
<td><p>variable’s name</p></td>
<td><p>Creates graphical widget for string value input (such as atom name of
anomalous scatterer). The input is assigned to internal workflow variable
with specified name, which is created automatically.</p></td>
</tr>
<tr class="row-odd"><td><p>PAR_CHECK</p></td>
<td><p>variable’s name</p></td>
<td><p>Creates graphical widget for a checkbox input. The input (<code class="docutils literal notranslate"><span class="pre">True/False</span></code>
for checked/unchecked states, respectively) is assigned to internal
workflow variable with specified name, which is created automatically.
PAR_CHECK cannot be preceded with the exclamation sign, and it always
has a default value (unchecked if not specified).</p></td>
</tr>
<tr class="row-even"><td><p>PAR_COMBO</p></td>
<td><p>variable’s name</p></td>
<td><p>Creates graphical widget for combobox input. The input (value associated
with the selected combobox item) is assigned to internal workflow variable
with specified name, which is created automatically. PAR_COMBO cannot be
preceded with the exclamation sign, and it always has a default value
(first item if not specified).</p></td>
</tr>
</tbody>
</table>
<table id="id7">
<caption><span class="caption-text">Input parameters specifications</span><a class="headerlink" href="#id7" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 8.0%"/>
<col style="width: 8.0%"/>
<col style="width: 8.0%"/>
<col style="width: 76.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Mandatory</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>LABEL</p></td>
<td><p>String</p></td>
<td><p>yes</p></td>
<td><p>Descriptive label for input widget, could be several space-separated
words. Example: <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">refinement</span> <span class="pre">cycles</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>TOOLTIP</p></td>
<td><p>String</p></td>
<td><p>no</p></td>
<td><p>Extend description for input widget, which appears on mouse hovering
over widget’s fields. Could be several space-separated words.</p></td>
</tr>
<tr class="row-even"><td><p>IWIDTH</p></td>
<td><p>number</p></td>
<td><p>no</p></td>
<td><p>Width of input widget’s active field, in pixels. Default values depend
on the widget type and should be suitable in most cases.</p></td>
</tr>
<tr class="row-odd"><td><p>MAXLENGTH</p></td>
<td><p>number</p></td>
<td><p>no</p></td>
<td><p>Maximum number of input characters in <code class="docutils literal notranslate"><span class="pre">PAR_STRING</span></code> widget (unlimited
by default)</p></td>
</tr>
<tr class="row-even"><td><p>RANGE</p></td>
<td><p>2 numbers</p></td>
<td><p>no</p></td>
<td><p>Minimum and maximum acceptable values for <code class="docutils literal notranslate"><span class="pre">PAR_INTEGER</span></code> and
<code class="docutils literal notranslate"><span class="pre">PAR_REAL</span></code> widgets, space-separated. If only one limit should be used,
the other limit should be represented by asterisk <code class="docutils literal notranslate"><span class="pre">*</span></code>. For example,
<code class="docutils literal notranslate"><span class="pre">RANGE</span>  <span class="pre">1</span> <span class="pre">*</span></code> means that value cannot be less than 1 but no upper limit.</p></td>
</tr>
<tr class="row-odd"><td><p>OPTION</p></td>
<td><p>word and string</p></td>
<td><p>yes</p></td>
<td><p>Selection item for <code class="docutils literal notranslate"><span class="pre">PAR_COMBO</span></code> widget. Statement’s value consists of a
key and text string, which is displayed as a selectable string in the
combobox. If string is selected by user, widget’s variable is assigned
the corresponding key. For example, <code class="docutils literal notranslate"><span class="pre">OPTION</span> <span class="pre">A</span> <span class="pre">Choose</span> <span class="pre">option</span> <span class="pre">A</span></code> will
put line <code class="docutils literal notranslate"><span class="pre">Choose</span> <span class="pre">option</span> <span class="pre">A</span></code> in the combobox. If this line is selected,
combobox’s value is string <code class="docutils literal notranslate"><span class="pre">"A"</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>DEFAULT</p></td>
<td><p>String or number</p></td>
<td><p>yes/no</p></td>
<td><p>Default value for widget/parameter. This statement is mandatory if
widget is described with leading exclamation sign, <em>e.g.</em>, <code class="docutils literal notranslate"><span class="pre">!PAR_REAL</span></code>.
For <code class="docutils literal notranslate"><span class="pre">PAR_COMBO</span></code>, default value must be one of keys listed in
<code class="docutils literal notranslate"><span class="pre">OPTION</span></code> statements.</p></td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!PAR_REAL     resHigh  # name to be used in workflow's expressions
    LABEL     High resolution cut-off (&amp;Aring;)
    TOOLTIP   High resolution cut-off, angstrom
    IWIDTH    40       # input field width is set to 40 pixels
    RANGE     0.1 5.0  # allowed min/max values
    DEFAULT   1.5      # default real value

PAR_COMBO     useBFactors   # name to be used in workflow's expressions
    LABEL     Use isotropic B-factors
    TOOLTIP   B-factor mode for refinement
    IWIDTH    60            # combobox width is set to 60 pixels
    OPTION    none  Select from list  # value "none" text "Select from list"
    OPTION    yes   Yes               # value "yes"  text "Yes"
    OPTION    no    No                # value "no"  text  "No"
    DEFAULT   none                    # default string value "none"

PAR_CHECK     reqValReport  # name to be used in workflow's expressions
    LABEL     Request PDB Validation Report
    TOOLTIP   Check to prepare PDB deposition files and validation report
    DEFAULT   Unchecked
</pre></div>
</div>
</section>
<section id="workflow-body-section">
<span id="wscript-reference-workflow-body"></span><h3 id="workflow-body-section"><span class="section-number">7.4.4. </span>Workflow body section<a class="headerlink" href="#workflow-body-section" title="Link to this heading">¶</a></h3>
<p>Workflow body must be the last section in <strong>WScript</strong> file. It may contain
task run instructions, variables and workflow control statements.</p>
<p>Task run instructions represent a set of statements which starts with <em>Run Name</em>
statement and finishes with <em>Run</em> statenment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@RUN_NAME</span>
    <span class="c1"># ... other optional statements ...</span>
    <span class="n">RUN</span>  <span class="n">TaskName</span>
</pre></div>
</div>
<p>The most convenient way of making run instruction is through using the
<strong>Workflow Creator</strong>, as described in <a class="reference internal" href="#simple-mr-workflow"><span class="std std-ref">Simple MR Workflow</span></a> with many
examples and explanations. Therefore, here only the reference of relevant
statements is provided.</p>
<table id="id8">
<caption><span class="caption-text">Task run statements</span><a class="headerlink" href="#id8" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 8.0%"/>
<col style="width: 18.0%"/>
<col style="width: 74.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Parameters</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>@RUN_NAME</p></td>
<td><p>None</p></td>
<td><p>Unique name, which opens the set of relevant statements and is used
for referencing task in looping and branching</p></td>
</tr>
<tr class="row-odd"><td><p>@RUN_NAME[x]</p></td>
<td><p>None</p></td>
<td><p>Same as <code class="docutils literal notranslate"><span class="pre">@RUN_NAME</span></code> but modified with the value of variable <code class="docutils literal notranslate"><span class="pre">x</span></code>.
Such modification is used in loops and branching, see examples in
<a class="reference internal" href="#simple-mr-workflow"><span class="std std-ref">Simple MR Workflow</span></a>.</p></td>
</tr>
<tr class="row-even"><td><p>IF</p></td>
<td><p>expression</p></td>
<td><p>Instructs to run the task only if <code class="docutils literal notranslate"><span class="pre">expression</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>,
for example, <code class="docutils literal notranslate"><span class="pre">IF</span>  <span class="pre">Rfree&lt;0.4</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>IFDATA</p></td>
<td><p>data type</p></td>
<td><p>Instructs to run the task only if data of specified type is present.
data type should be given as a lowercase of data types used in <code class="docutils literal notranslate"><span class="pre">DATA</span></code>
statements in <a class="reference internal" href="#wscript-reference-input-data"><span class="std std-ref">Input data section</span></a>, for example,
<code class="docutils literal notranslate"><span class="pre">hkl</span></code>, <code class="docutils literal notranslate"><span class="pre">unmerged</span></code>, <code class="docutils literal notranslate"><span class="pre">xyz</span></code>, <code class="docutils literal notranslate"><span class="pre">seq</span></code>, <code class="docutils literal notranslate"><span class="pre">library</span></code>, <code class="docutils literal notranslate"><span class="pre">ligand</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>IFNOTDATA</p></td>
<td><p>data type</p></td>
<td><p>Instructs to run the task only if data of specified type is <em>NOT</em> present.
data type should be given as a lowercase of data types used in <code class="docutils literal notranslate"><span class="pre">DATA</span></code>
statements in <a class="reference internal" href="#wscript-reference-input-data"><span class="std std-ref">Input data section</span></a>, for example,
<code class="docutils literal notranslate"><span class="pre">hkl</span></code>, <code class="docutils literal notranslate"><span class="pre">unmerged</span></code>, <code class="docutils literal notranslate"><span class="pre">xyz</span></code>, <code class="docutils literal notranslate"><span class="pre">seq</span></code>, <code class="docutils literal notranslate"><span class="pre">library</span></code>, <code class="docutils literal notranslate"><span class="pre">ligand</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>DATA</p></td>
<td><p>data id and data name</p></td>
<td><p>Forces placement of specified data in particular item of CCP4 Cloud task.
This is necessary when task interface has “not standard” data id, or
when task does not use Structure Revision that is already in the branch.</p>
<p>Example 1. <em>Aimless</em> task
assumes input of merged or unmerged reflections for symmetry reference in
data object with id <code class="docutils literal notranslate"><span class="pre">ds0</span></code>. This id is not recognised automatically as a
recipient of reflection data, therefore, statement <code class="docutils literal notranslate"><span class="pre">DATA</span> <span class="pre">ds0</span> <span class="pre">unmerged</span></code>
or <code class="docutils literal notranslate"><span class="pre">DATA</span> <span class="pre">ds0</span> <span class="pre">hkl</span></code> must be placed in task instructions for <em>Aimless</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@AIMLESS</span>
    <span class="n">IFDATA</span>    <span class="n">unmerged</span>
    <span class="n">DATA</span>      <span class="n">ds0</span>  <span class="n">unmerged</span>
    <span class="n">RUN</span> <span class="n">Aimless</span>
</pre></div>
</div>
<p>Example 2. Sequence alignment task expects input of mixed objects, such
as sequences and models, in a single field named <code class="docutils literal notranslate"><span class="pre">seq</span></code>. The corresponding
description is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@SEQALIGN</span>
    <span class="n">DATA</span> <span class="n">seq</span> <span class="n">seq</span>
    <span class="n">DATA</span> <span class="n">seq</span> <span class="n">xyz</span>
    <span class="n">RUN</span> <span class="n">SeqAlign</span>
</pre></div>
</div>
<p>Example 3. Dimple-MR takes merged reflections and atomic coordinates
rather than Structure Revision:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@DIMPLEMR</span>
    <span class="n">DATA</span> <span class="n">hkl</span> <span class="n">hkl</span>
    <span class="n">DATA</span> <span class="n">xyz</span> <span class="n">xyz</span>
    <span class="n">RUN</span> <span class="n">DimpleMR</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>ALIAS</p></td>
<td><p>standard data id and task data id</p></td>
<td><p>Used in cases when data id, used in task interface, is not “standard”,
such as <code class="docutils literal notranslate"><span class="pre">revision</span></code>, <code class="docutils literal notranslate"><span class="pre">hkl</span></code>, <code class="docutils literal notranslate"><span class="pre">seq</span></code>, <code class="docutils literal notranslate"><span class="pre">xyz</span></code> and similar. Example:
<code class="docutils literal notranslate"><span class="pre">ALIAS</span>  <span class="pre">revision</span> <span class="pre">istruct</span></code> (for <em>XyzUtils</em>).</p></td>
</tr>
<tr class="row-odd"><td><p>USE</p></td>
<td><p>data name and number / variable / expression</p></td>
<td><p>Used for data object specification in cases when several data objects
with given name are available. For example, <em>Crank-2</em> creates up to 4
<em>Structure Revisions</em> after MAD phasing, and the following statement:
<code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">REVISION</span> <span class="pre">2</span></code> could be used in next task description in order to
force using 2nd revision produced.</p></td>
</tr>
<tr class="row-even"><td><p>PROPERTY</p></td>
<td><p>data name, property id and property value</p></td>
<td><p>Used for modifying properties of data objects. For example,
<code class="docutils literal notranslate"><span class="pre">PROPERTY</span> <span class="pre">HKL</span> <span class="pre">res_high</span> <span class="pre">1.4</span></code> request cutting reflection dataset to
1.4A in <em>Change Resolution</em> task; <code class="docutils literal notranslate"><span class="pre">PROPERTY</span> <span class="pre">REVISION&gt;HKL</span> <span class="pre">wtype</span> <span class="pre">"peak"</span></code>
sets string value <code class="docutils literal notranslate"><span class="pre">"peak"</span></code> (not to be mistaken with <code class="docutils literal notranslate"><span class="pre">peak</span></code> variable,
therefore, enquoted) for the wavelength type in <em>Crank-2</em> or <em>ShelxCD</em>.</p></td>
</tr>
<tr class="row-odd"><td><p>PARAMETER</p></td>
<td><p>parameter id and value (expression)</p></td>
<td><p>Assigns the specified value (or result of specified expression) to
task parameter with specified id. Parameters ids coincide with keys in
“parameters” structure of the corrsponding task class. Example:
<code class="docutils literal notranslate"><span class="pre">PARAMETER</span> <span class="pre">VDW_VAL</span> <span class="pre">2.0</span></code> (for <em>Refmac</em>).</p></td>
</tr>
<tr class="row-even"><td><p>USE_SUGGESTED_PARAMETERS</p></td>
<td><p>none</p></td>
<td><p>Forces using parameters suggested based on results of previous task of
the same types. Currently, this is applicable only to <em>Refmac</em>.</p></td>
</tr>
<tr class="row-odd"><td><p>RUN</p></td>
<td><p>Task name</p></td>
<td><p>Gives the name of CCP4 Cloud task that must be run, and finishes the set
of task run statements.</p></td>
</tr>
</tbody>
</table>
<table id="id9">
<caption><span class="caption-text">Workflow variables and control</span><a class="headerlink" href="#id9" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 8.0%"/>
<col style="width: 92.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Operator</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>let x = <em>expression</em> [if <em>condition</em>]</p></td>
<td><p>Variable assignment, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Several assignments can be placed in a single statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">PI</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
</pre></div>
</div>
<p>The whole statement may be made conditional:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">PI</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span> <span class="k">if</span> <span class="n">Rfree</span><span class="o">&lt;</span><span class="mf">0.3</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>repeat @RUN_NAME while <em>condition</em></p></td>
<td><p>Instruction to repeat the specified task while <em>condition</em> evaluates to
<em>True</em>, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">repeat</span> <span class="nd">@REFINEMENT</span> <span class="k">while</span> <span class="n">Rfree</span><span class="o">&gt;</span><span class="mf">0.4</span> <span class="ow">and</span> <span class="nb">iter</span><span class="o">&lt;</span><span class="mi">10</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Task, used in <code class="docutils literal notranslate"><span class="pre">repeat</span></code> statement, should be described with modificator,
<em>e.g.</em>, <code class="docutils literal notranslate"><span class="pre">@REFINEMENT[iter]</span></code>, and modificator should be advanced
within the repeat loop scope, <em>e.g.</em>, <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">iter</span> <span class="pre">=</span> <span class="pre">iter</span> <span class="pre">+</span> <span class="pre">1</span></code>. Always
limit the maximum number of repeats (10 in the above example) to avoid
infinite looping. Note that <code class="docutils literal notranslate"><span class="pre">@RUN_NAME</span></code> is specified without
modificator in <code class="docutils literal notranslate"><span class="pre">repeat</span></code> statement.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p>branch @RUN_NAME [if <em>condition</em>]</p></td>
<td><p>Instruction to continue next task from the specified task, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">branch</span> <span class="nd">@MODEL_BUILDING</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>If task was described with modificator, it <em>must be</em> explicitly specified
as a variable with correct value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">branch</span> <span class="nd">@DENSITY_MODIFICATION</span><span class="p">[</span><span class="n">hand0</span><span class="p">]</span>
</pre></div>
</div>
<p>Branching may be subject to <em>condition</em>, evaluated to <em>True</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">branch</span> <span class="nd">@MODEL_BUILDING</span><span class="o">-</span><span class="mi">2</span> <span class="k">if</span> <span class="n">Rfree</span><span class="o">&gt;</span><span class="mf">0.4</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>continue @RUN_NAME [if <em>condition</em>]</p></td>
<td><p>Instruction to continue the workflow from the specified task, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">continue</span> <span class="nd">@REFINEMENT</span>
</pre></div>
</div>
<p>continuation may be subject to <em>condition</em>, evaluated to <em>True</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">continue</span> <span class="nd">@REFINEMENT</span> <span class="k">if</span> <span class="n">Rfree</span><span class="o">&gt;</span><span class="mf">0.4</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>POINT @RUN_NAME</p></td>
<td><p>Marks point in the workflow which can be used in <code class="docutils literal notranslate"><span class="pre">continue</span></code> (and only
in <code class="docutils literal notranslate"><span class="pre">continue</span></code>). There are no actions associated with this operator.</p></td>
</tr>
<tr class="row-odd"><td><p>PARALLEL ON|OFF</p></td>
<td><p>Tasks found between <code class="docutils literal notranslate"><span class="pre">PARALLEL</span> <span class="pre">ON</span></code> and <code class="docutils literal notranslate"><span class="pre">PARALLEL</span> <span class="pre">OFF</span></code> statements will
be executed in parallel. Each such task will start a new branch, and
statements after <code class="docutils literal notranslate"><span class="pre">PARALLEL</span> <span class="pre">OFF</span></code> will be applied in each branch. Therefore,
parallel tasks should produce compatible output.</p></td>
</tr>
<tr class="row-even"><td><p>PRINT_VAR</p></td>
<td><p>Prints current values of all workflow variables in CCP4 Cloud task’s log
file. example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PRINT_VAR</span>  <span class="n">Rfactor</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>checkTask(name)</p></td>
<td><p>Queries task availability and assignes <code class="docutils literal notranslate"><span class="pre">True/False</span></code> to variable
<code class="docutils literal notranslate"><span class="pre">name_available</span></code>, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">checkTask</span><span class="p">(</span><span class="n">StructurePrediction</span><span class="p">)</span>
<span class="n">PRINT_VAR</span>   <span class="n">StructurePrediction_available</span>
<span class="k">continue</span>  <span class="nd">@AUTO_MR</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">StructurePrediction_available</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>STOP [if <em>condition</em>]</p></td>
<td><p>Stops the workflow. If condition is given, then workflow is stopped if
<em>condition</em> evaluates <code class="docutils literal notranslate"><span class="pre">True</span></code>, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STOP</span> <span class="k">if</span> <span class="n">Rfree</span><span class="o">&lt;</span><span class="mf">0.22</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>END</p></td>
<td><p>Ends the workflow.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pre-defined-variables">
<span id="wscript-reference-predefined-variables"></span><h3 id="pre-defined-variables"><span class="section-number">7.4.5. </span>Pre-defined variables<a class="headerlink" href="#pre-defined-variables" title="Link to this heading">¶</a></h3>
<p><strong>WScript</strong> has direct access to certain metrics produced by tasks through
pre-defined variables. For example, <em>R_free</em> value produced by <em>Refmac</em> is
assigned to variable <code class="docutils literal notranslate"><span class="pre">Rfree</span></code>.</p>
<table id="id10">
<caption><span class="caption-text">Pre-defined variables</span><a class="headerlink" href="#id10" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 8.0%"/>
<col style="width: 18.0%"/>
<col style="width: 74.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Producing tasks</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nasu</p></td>
<td><p>ASU Definition</p></td>
<td><p>Predicted number of monomeric units in ASU.</p></td>
</tr>
<tr class="row-odd"><td><p>nfitted</p></td>
<td><p>PhaserMR Molrep</p></td>
<td><p>Number of fitted (molecular replaced) monomeric units in ASU.</p></td>
</tr>
<tr class="row-even"><td><p>Rfree</p></td>
<td><p>All tasks with refinement</p></td>
<td><p>Free R-factor (varies between 0 and 1).</p></td>
</tr>
<tr class="row-odd"><td><p>Rfactor</p></td>
<td><p>All tasks with refinement</p></td>
<td><p>Work R-factor (varies between 0 and 1).</p></td>
</tr>
<tr class="row-even"><td><p>suggested</p></td>
<td><p>Refmac</p></td>
<td><p>Number of suggested parameters to change.</p></td>
</tr>
<tr class="row-odd"><td><p>N_unmerged</p></td>
<td><p>Workflow</p></td>
<td><p>Number of unmerged datasets given to workflow by user.</p></td>
</tr>
<tr class="row-even"><td><p>N_hkl</p></td>
<td><p>Workflow, Aimless</p></td>
<td><p>Number of merged datasets given to workflow by user or produced by <code class="docutils literal notranslate"><span class="pre">Aimless</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>N_hkl_anom</p></td>
<td><p>Workflow, Aimless</p></td>
<td><p>Number of merged datasets with anomalous signal, given to workflow by user or produced by <code class="docutils literal notranslate"><span class="pre">Aimless</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>N_seq</p></td>
<td><p>Workflow</p></td>
<td><p>Number of sequences given to workflow by user.</p></td>
</tr>
<tr class="row-odd"><td><p>N_xyz</p></td>
<td><p>Workflow</p></td>
<td><p>Number of molecular models given to workflow by user.</p></td>
</tr>
<tr class="row-even"><td><p>N_lig</p></td>
<td><p>Workflow, MakeLigand</p></td>
<td><p>Number of ligand files given to workflow by user or produced by <code class="docutils literal notranslate"><span class="pre">MakeLigand</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>N_ligdesc</p></td>
<td><p>Workflow</p></td>
<td><p>Number of ligand descriptinos defined by user in workflow’s input section.</p></td>
</tr>
<tr class="row-even"><td><p>N_lib</p></td>
<td><p>Workflow</p></td>
<td><p>Number of ligand libraries given by user to workflow.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="mathematrical-expressions-syntax">
<span id="wscript-reference-expression-syntax"></span><h3 id="mathematrical-expressions-syntax"><span class="section-number">7.4.6. </span>Mathematrical expressions syntax<a class="headerlink" href="#mathematrical-expressions-syntax" title="Link to this heading">¶</a></h3>
<p><strong>WScript</strong> allows almost full range of <em>Python</em> mathematical expressions in
<em>LET</em> statements and conditional statements. Available functions and operators
are listed in this section.</p>
<table id="id11">
<caption><span class="caption-text">Operator precedence</span><a class="headerlink" href="#id11" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 15.0%"/>
<col style="width: 15.0%"/>
<col style="width: 70.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Operator</p></th>
<th class="head"><p>Associativity</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>(…)</p></td>
<td><p>None</p></td>
<td><p>Grouping</p></td>
</tr>
<tr class="row-odd"><td><p>f(), x.y, a[i]</p></td>
<td><p>Left</p></td>
<td><p>Function call, property access, array indexing</p></td>
</tr>
<tr class="row-even"><td><p>!</p></td>
<td><p>Left</p></td>
<td><p>Factorial</p></td>
</tr>
<tr class="row-odd"><td><p>^</p></td>
<td><p>Right</p></td>
<td><p>Exponentiation</p></td>
</tr>
<tr class="row-even"><td><p>+, -, not, sqrt, etc.</p></td>
<td><p>Right</p></td>
<td><p>Unary prefix operators (see below for the full list)</p></td>
</tr>
<tr class="row-odd"><td><p>*, /, %</p></td>
<td><p>Left</p></td>
<td><p>Multiplication, division, remainder</p></td>
</tr>
<tr class="row-even"><td><p>+, -, ||</p></td>
<td><p>Left</p></td>
<td><p>Addition, subtraction, array/list concatenation</p></td>
</tr>
<tr class="row-odd"><td><p>==, !=, &gt;=, &lt;=, &gt;, &lt;, in</p></td>
<td><p>Left</p></td>
<td><p>Equals, not equals, etc. “in” means “is the left operand included in the right array operand?”</p></td>
</tr>
<tr class="row-even"><td><p>and</p></td>
<td><p>Left</p></td>
<td><p>Logical AND</p></td>
</tr>
<tr class="row-odd"><td><p>or</p></td>
<td><p>Left</p></td>
<td><p>Logical OR</p></td>
</tr>
<tr class="row-even"><td><p>x ? y : z</p></td>
<td><p>Right</p></td>
<td><p>Ternary conditional (if x then y else z)</p></td>
</tr>
<tr class="row-odd"><td><p>=</p></td>
<td><p>Right</p></td>
<td><p>Variable assignment</p></td>
</tr>
<tr class="row-even"><td><p>;</p></td>
<td><p>Left</p></td>
<td><p>Expression separator</p></td>
</tr>
</tbody>
</table>
<table id="id12">
<caption><span class="caption-text">Unary operators</span><a class="headerlink" href="#id12" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 15.0%"/>
<col style="width: 85.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Operator</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-x</p></td>
<td><p>Negation</p></td>
</tr>
<tr class="row-odd"><td><p>+x</p></td>
<td><p>Unary plus. This converts it’s operand to a number, but has no other effect.</p></td>
</tr>
<tr class="row-even"><td><p>x!</p></td>
<td><p>Factorial (x * (x-1) * (x-2) * … * 2 * 1). gamma(x + 1) for non-integers.</p></td>
</tr>
<tr class="row-odd"><td><p>abs(x)</p></td>
<td><p>Absolute value (magnitude) of x</p></td>
</tr>
<tr class="row-even"><td><p>acos(x)</p></td>
<td><p>Arc cosine of x (in radians)</p></td>
</tr>
<tr class="row-odd"><td><p>acosh(x)</p></td>
<td><p>Hyperbolic arc cosine of x (in radians)</p></td>
</tr>
<tr class="row-even"><td><p>asin(x)</p></td>
<td><p>Arc sine of x (in radians)</p></td>
</tr>
<tr class="row-odd"><td><p>asinh(x)</p></td>
<td><p>Hyperbolic arc sine of x (in radians)</p></td>
</tr>
<tr class="row-even"><td><p>atan(x)</p></td>
<td><p>Arc tangent of x (in radians)</p></td>
</tr>
<tr class="row-odd"><td><p>atanh(x)</p></td>
<td><p>Hyperbolic arc tangent of x (in radians)</p></td>
</tr>
<tr class="row-even"><td><p>cbrt(x)</p></td>
<td><p>Cube root of x</p></td>
</tr>
<tr class="row-odd"><td><p>ceil(x)</p></td>
<td><p>Ceiling of x — the smallest integer that’s &gt;= x</p></td>
</tr>
<tr class="row-even"><td><p>cos(x)</p></td>
<td><p>Cosine of x (x is in radians)</p></td>
</tr>
<tr class="row-odd"><td><p>cosh(x)</p></td>
<td><p>Hyperbolic cosine of x (x is in radians)</p></td>
</tr>
<tr class="row-even"><td><p>exp(x)</p></td>
<td><p>e^x (exponential/antilogarithm function with base e)</p></td>
</tr>
<tr class="row-odd"><td><p>expm1(x)</p></td>
<td><p>e^x - 1</p></td>
</tr>
<tr class="row-even"><td><p>floor(x)</p></td>
<td><p>Floor of x — the largest integer that’s &lt;= x</p></td>
</tr>
<tr class="row-odd"><td><p>length(x)</p></td>
<td><p>String or array length of x</p></td>
</tr>
<tr class="row-even"><td><p>ln(x)</p></td>
<td><p>Natural logarithm of x</p></td>
</tr>
<tr class="row-odd"><td><p>log(x)</p></td>
<td><p>Natural logarithm of x (synonym for ln, not base-10)</p></td>
</tr>
<tr class="row-even"><td><p>log10(x)</p></td>
<td><p>Base-10 logarithm of x</p></td>
</tr>
<tr class="row-odd"><td><p>log2(x)</p></td>
<td><p>Base-2 logarithm of x</p></td>
</tr>
<tr class="row-even"><td><p>log1p(x)</p></td>
<td><p>Natural logarithm of (1 + x)</p></td>
</tr>
<tr class="row-odd"><td><p>not x</p></td>
<td><p>Logical NOT operator</p></td>
</tr>
<tr class="row-even"><td><p>round(x)</p></td>
<td><p>X, rounded to the nearest integer, using “grade-school rounding”</p></td>
</tr>
<tr class="row-odd"><td><p>sign(x)</p></td>
<td><p>Sign of x (-1, 0, or 1 for negative, zero, or positive respectively)</p></td>
</tr>
<tr class="row-even"><td><p>sin(x)</p></td>
<td><p>Sine of x (x is in radians)</p></td>
</tr>
<tr class="row-odd"><td><p>sinh(x)</p></td>
<td><p>Hyperbolic sine of x (x is in radians)</p></td>
</tr>
<tr class="row-even"><td><p>sqrt(x)</p></td>
<td><p>Square root of x. Result is NaN (Not a Number) if x is negative.</p></td>
</tr>
<tr class="row-odd"><td><p>tan(x)</p></td>
<td><p>Tangent of x (x is in radians)</p></td>
</tr>
<tr class="row-even"><td><p>tanh(x)</p></td>
<td><p>Hyperbolic tangent of x (x is in radians)</p></td>
</tr>
<tr class="row-odd"><td><p>trunc(x)</p></td>
<td><p>Integral part of a X, looks like floor(x) unless for negative number</p></td>
</tr>
</tbody>
</table>
<table id="id13">
<caption><span class="caption-text">Pre-defined functions</span><a class="headerlink" href="#id13" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 17.0%"/>
<col style="width: 83.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>random(n)</p></td>
<td><p>Get a random number in the range [0, n]. If n is zero, or not provided, it defaults to 1.</p></td>
</tr>
<tr class="row-odd"><td><p>fac(n)</p></td>
<td><p>n! (factorial of n: “n * (n-1) * (n-2) * … * 2 * 1”) Deprecated. Use the ! operator instead.</p></td>
</tr>
<tr class="row-even"><td><p>min(a,b,…)</p></td>
<td><p>Get the smallest (minimum) number in the list.</p></td>
</tr>
<tr class="row-odd"><td><p>max(a,b,…)</p></td>
<td><p>Get the largest (maximum) number in the list.</p></td>
</tr>
<tr class="row-even"><td><p>hypot(a,b)</p></td>
<td><p>Hypotenuse, i.e. the square root of the sum of squares of its arguments.</p></td>
</tr>
<tr class="row-odd"><td><p>pyt(a, b)</p></td>
<td><p>Alias for hypot.</p></td>
</tr>
<tr class="row-even"><td><p>pow(x, y)</p></td>
<td><p>Equivalent to x^y. For consistency with JavaScript’s Math object.</p></td>
</tr>
<tr class="row-odd"><td><p>atan2(y, x)</p></td>
<td><p>Arc tangent of x/y. i.e. the angle between (0, 0) and (x, y) in radians.</p></td>
</tr>
<tr class="row-even"><td><p>roundTo(x, n)</p></td>
<td><p>Rounds x to n places after the decimal point.</p></td>
</tr>
<tr class="row-odd"><td><p>map(f, a)</p></td>
<td><p>Array map: Pass each element of <cite>a</cite> the function <cite>f</cite>, and return an array of the results.</p></td>
</tr>
<tr class="row-even"><td><p>fold(f, y, a)</p></td>
<td><p>Array fold: Fold/reduce array <cite>a</cite> into a single value, <cite>y</cite> by setting <cite>y = f(y, x, index)</cite> for each element <cite>x</cite> of the array.</p></td>
</tr>
<tr class="row-odd"><td><p>filter(f, a)</p></td>
<td><p>Array filter: Return an array containing only the values from <cite>a</cite> where <cite>f(x, index)</cite> is <cite>true</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>indexOf(x, a)</p></td>
<td><p>Return the first index of string or array <cite>a</cite> matching the value <cite>x</cite>, or <cite>-1</cite> if not found.</p></td>
</tr>
<tr class="row-odd"><td><p>join(sep, a)</p></td>
<td><p>Concatenate the elements of <cite>a</cite>, separated by <cite>sep</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>if(c, a, b)</p></td>
<td><p>Function form of c ? a : b. Note: This always evaluates both <cite>a</cite> and <cite>b</cite>, regardless of whether <cite>c</cite> is <cite>true</cite> or not. Use <cite>c ? a : b</cite> instead if there are side effects, or if evaluating the branches could be expensive.</p></td>
</tr>
</tbody>
</table>
<table id="id14">
<caption><span class="caption-text">Constants</span><a class="headerlink" href="#id14" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 15.0%"/>
<col style="width: 85.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Constant</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>E</p></td>
<td><p>The value of <cite>Math.E</cite> from your JavaScript runtime</p></td>
</tr>
<tr class="row-odd"><td><p>PI</p></td>
<td><p>The value of <cite>Math.PI</cite> from your JavaScript runtime</p></td>
</tr>
<tr class="row-even"><td><p>True</p></td>
<td><p>Logical <cite>true</cite> value</p></td>
</tr>
<tr class="row-odd"><td><p>False</p></td>
<td><p>Logical <cite>false</cite> value</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="jscofe_i1toCloud.html" title="6. Cloud Run facility in CCP4i interface"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> <span class="section-number">6. </span>Cloud Run facility in CCP4i interface </span>
              </div>
            </a>
          
          
            <a href="jscofe_archive.html" title="8. CCP4 Cloud Archive"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> <span class="section-number">8. </span>CCP4 Cloud Archive </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>