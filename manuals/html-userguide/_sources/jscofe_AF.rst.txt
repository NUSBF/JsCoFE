:orphan:

==============================
CCP4 Cloud AlphaFold Utilities
==============================

`AlphaFold2 <https://www.nature.com/articles/s41586-021-03819-2>`_ and `RosettaFold <https://robetta.bakerlab.org/>`_ predicted models are widely acknowledged as good structure templates for Molecular Replacement. This article describes AlphaFold2 integration in CCP4 Cloud for different stages of a structure determination process.

.. include:: jscofe_tips.AlphaFold.rst
    :start-line: 4
    :end-line: 24

-----------------------------------
Generate or obtain predicted models
-----------------------------------

Not only CCP4 Cloud allows `import <../html-taskref/doc.task.Import.html>`__ of predicted models but it also allows to generate models for further use in molecular replacement programs (`Phaser <../html-taskref/doc.task.Phaser.html>`_ and `Molrep <../html-taskref/doc.task.Molrep.html>`_)

In order to **generate models** CCP4 Cloud offers a following tasks:

#. `Structure Prediction <../html-taskref/doc.task.StructurePrediction.html>`_ task, which uses AlphaFold-2 for generating structure models from a given sequence.

    .. image:: images/structure_prediction_all_tasks.png
         :scale: 50 %
         :align: center



    After importing or generating the model using `Prepare MR Model(s) from Coordinate data <../html-taskref/doc.task.ModelPrepXYZ.html>`_ task prepares MR search model(s) using predicted models.

#. `Find and prepare MR models with MrParse <../html-taskref/doc.task.MrParse.html>`_ task identifies structural homologs, suitable for making MR search models, in the PDB and **AlphaFold2 Data Base**. Relevant structures are selected on the basis of sequence alignment with `PHMMER <http://hmmer.org/>`_ software.

#. `Prepare MR Ensemble with CCP4mg <../html-taskref/doc.task.EnsemblePrepMG.html>`_ task uses `MrBump <../html-taskref/doc.task.MrBump.html>`__ software to make the `MR Ensemble <../html-taskref/doc.task.Ensembler.html>`_ from given structural homologs. MR Ensembles are obtained with an alignment and truncation procedure using homologues structures found in the PDB and **AlphaFold2 DataBase** with a sequence-based search.

#. `Prepare MR Ensemble from Sequence <../html-taskref/doc.task.EnsemblePrepSeq.html>`_ task uses `MrBump <../html-taskref/doc.task.MrBump.html>`__ software to prepare `MR Ensemble <../html-taskref/doc.task.Ensembler.html>`_ for the given target sequence. The process is completely automatic and includes finding suitable structure homologs in the PDB and, optionally, **AlphaFold2 DataBase**, trimming them, and bringing in the best superposition.


-----------------------
Process predicted model
-----------------------

Inaccuracy in domain-domain orientations is often a key limitation when using predicted models for MR. `Split MR model with Slice-n-Dice <../html-taskref/doc.task.Slice.html>`_ task allows to slice of predicted models into distinct structural units which are then can be placed in an automatic MR pipeline.


-------------------------------
Automated Molecular Replacement
-------------------------------

Automated Molecular Replacement pipelines **search for homologous structures in n PDB and AlphaFold DataBase**, **create a set of suitable search models** from the template structures, **perform molecular replacement**, and **test the solutions** with some rounds of restrained refinement.

The following Automated Molecular Replacement in CCP4 cloud support AlphaFold DataBase search:

#. `MrBump's <../html-taskref/doc.task.MrBump.html>`__ model search is obtained with an alignment and truncation procedure using homologues structures found in the `PDB <https://www.rcsb.org/>`_ and `AlphaFold DataBase <https://doi.org/10.1038/s41586-021-03819-2>`_ with a sequence-based search.

#. `MR with model splitting using Slice-n-Dice <../html-taskref/doc.task.SliceNDice.html>`_ task designed to pre-process `AlphaFold2 <https://www.nature.com/articles/s41586-021-03819-2>`_ and `RosettaFold <https://robetta.bakerlab.org/>`_ models by removing low confidence regions and converting confidence scores into predicted B-factors. It also slices predicted models into distinct structural units and then automatically places the slices using `Phaser <../html-taskref/doc.task.Phaser.html>`_. The slicing step can use AlphaFold2’s predicted aligned error (PAE) or can operate via a variety of Cɑ atom clustering algorithms, extending applicability to structures of any origin. **Slice-n-Dice helps to deal with inaccuracy in domain-domain orientations of predicted models.**

#. `Arcimboldo Shredder <../html-taskref/doc.task.ArcimboldoShredder.html>`_ automatically pre-process an Alphafold or RoseTTAFold model by eliminating unstructured and disconnected areas and verifies MR solution.

----------
Refinement
----------

As a final step in the process of solving a macromolecular crystal structure, refinement is carried out to maximize the agreement between the model and the X-ray data. In order to perform structure refinement at low resolution (lower than around 3 Å) it is necessary to use as much available information about macromolecules as possible. `Low-Resolution Refinement with Lorestr <../html-taskref/doc.task.Lorestr.html>`_ task uses **AlphaFold2 DataBase** to identify homologues and then Lorestr uses them in order to determine the set of most appropriate refinement parameters. 

-------------------
Automatic workflows
-------------------

In order to understand how AlphaFold2 can be implemented in a structure solution CCP4 Clouds offers an automatic project **workflow: Molecular Replacement with AlphaFold Model** which starts with data import and then uses `Structure Prediction <../html-taskref/doc.task.StructurePrediction.html>`_ and `MR with model splitting using Slice-n-Dice <../html-taskref/doc.task.SliceNDice.html>`_ tasks to automatically create the structure solution project automatically. The result may be further improved with the elementary tasks in manual mode, allowing finer control over the task's parameters.

---------
Tutorials
---------


We also recommend to use `Creating Molecular Replacement Search Ensembles with CCP4MG/MrBUMP <../demo_project.html?cmount=Tutorials&project=T2_001.%20Creating%20Molecular%20Replacement%20Search%20Ensembles%20with%20CCP4MG.ccp4cloud>`_ tutorial to learn on practice how to create the ensembles for Molecular Replacement with `CCP4mg <https://www.ccp4.ac.uk/MG/>`_ molecular viewer.


**ACKNOWLEDGEMENTS**

This article uses materials kindly provided by Dr. Ronan Keegan, whose help is greatly appreciated.
