======
Molrep
======

`Molrep <http://scripts.iucr.org/cgi-bin/paper?S0907444909042589>`_ is the program for molecular replacement witch can be used in those cases where a homologous structure has already been identified.

**Molecular Replacement (MR)** is a method for approximating initial *phases* by positioning a suitable structure homolog (MR search model) such as to achieve best agreement between calculated and observed structure factors *moduli*. Phase components of thus calculated structure factors may be then taken as an approximation of "true" phases. 

**Molrep** performs molecular replacement in two steps:

    #. **Rotation function (RF)** search orientation of model
    
    #. **Cross Translation function (TF)** and **Packing function (PF)** search position of oriented model

--------------
Search options
--------------

**Rotation** and **Translation** are correlation functions (or overlapping functions) between observed and calculated model Pattersons. 

The **Patterson function** is a Fourier summation with intensities as coefficients and without phase angles, or, rather, with all phase angles equal to zero. 

The **Patterson function** has the following properties:

    1. The **Patterson map** has peaks at end points of vectors u equal to vectors between atoms in the real cell.
    
    2. For every pair of atoms in the real cell, there exists a unique peak in the Patterson map. This is the interatomic vector map. We can generate a vector map of a molecule by putting each atom at the origin and marking the position of all other atoms. By doing so we've got 2 types of vector (**intramolecular (self) vectors** are used for **Rotation function** and **intermolecular (cross-)vectors** are used for **Translation function**.
    
    3. A Patterson map is always centrosymmetric.

The **number of copies** in the asymmetric unit estimated through `Matthews Coefficient <https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2323984/>`_

The result of the **Rotation function** depends on the radius of a spherical domain in the centre of the Patterson function (the so-called cut-off radius). This radius must be chosen so as to **maximize the ratio between the number of inter- and intramolecular vectors**. The program chooses the value of this radius as twice the radius of gyration, but can also use an input value. Anisotropic correction of data before computing RF can be useful for data with high anisotropy. MOLREP use Crowther Fast Rotation Function. ``The program can compute the Rotation Function for three different orientations of model and average them.`` That reduces the noise of Rotation function.

The **Translation function** can check several peaks of the rotation function by computing a correlation coefficient for each peak and sorting the result. For scaling observed and calculated structure factors, the program uses the scaling by the origin peak of Patterson, but for data with high anisotropy the program can use anisotropic scaling. The Translation function can take into account the fixed model and also, if the number of monomers is known, MOLREP can position the input number of monomers in a simple run. Also in this case, the possibility to choose from symmetry-related models closest to which was found before is useful.

**Locked rotation function** helps restrict dimensionality in an exhaustive search.

The program can detect and use **pseudo-translation vectors**. In this case, the pseudo-translation related copy will be added to the final model. ``Peaks with height comparable with origin (in MOLREP 0.15 of origin) are indicative of pseudotranslation which often complicates MR – can give unreasonably high correlation coefficient (CC) for the wrong solution.``

-----------------
Experimental data
-----------------


The **low-resolution cut-off** is applied in the form of a Gaussian F = F :subscript:`obs` (1 - exp | - B :subscript:`off` (sin θ/λ) :superscript:`2` | )`, where B :subscript:`off` = (2d :subscript:`max` ) :superscript:`2`

The common practice is to exclude low resolution reflections from calculations because they are corrupted by the bulk solvent contribution. However, this results in the series termination effect and introduces systematic errors in the electron density, particularly at the surface of the molecule `[Vagin and Teplyakov, 1997] <https://scripts.iucr.org/cgi-bin/paper?li5010>`_

The radius of gyration of the model and its sequence identity with the target protein, are translated into the parameters of Gaussian low-pass and high-pass filters, which define the resolution-dependence of reflection weights in the RF and TF. It is assumed that the reflections of low resolution, the intensities of which mostly depend on large-scale details of the crystal and are almost independent of the internal features of the molecules forming it, produce only noise in the RF and TF. High noise and low signal are also produced by high-resolution reflections, defining structural details of finer scale than the r.m.s.d. between the search and target molecules. The exact value of this r.m.s.d. is unknown until the structure is solved, but it correlates with the known sequence identity `[Lebedev,Vagin, Murshudov, 2007] <https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2394799/>`_

Weighting parameters for the rotation (RF) and translation (TF) functions are more reliable if they are derived from the original sequence and atomic coordinates of the homologous protein.

For low similarity the high resolution reflections are **weighted down**. Program uses for this additional overall factor **Badd**:

F :subscript:`new` = F :subscript:`old` exp(-Badd*s :superscript:`2` )

Value of **similarity** can be: from 0.1 to 1.0 (1 means normalized F will be used). It directly corresponds to **Badd** ranging from (B :subscript:`limit` - B :subscript:`overall` ) to (-B :subscript:`overall` ), where B :subscript:`limit` refers to the so-called **Optical Resolution**. **Optical resolution** is defined as an expected minimum distance between two resolved peaks in the electron density map. It is computed from the width of the Patterson origin peak.

For low completeness, e.g. when there are several molecules in the asymmetric unit, the contribution of low resolution reflections is weighted down. To manage the completeness of model, the program uses low resolution cut-off (B :subscript:`off`). Completeness of model can be: from 0.2 to 1.0. It corresponds to B :subscript:`off`: from 400 to 1600.

**Scaling** of the observed and calculated structure factors is based on the scaling of the corresponding Patterson origin peaks [Rogers, 1965]. This method is advantageous when only low-resolution data are available. In such a case, the estimation of the overall B factor from the Wilson plot may be inaccurate. Scaling by Patterson synthesis is also useful for the cross RF where there are different cells for the search model and for the unknown structure. 

-------------------------
Infrequently used options
-------------------------

The **Packing function** (PF) is very important in removing wrong solutions which correspond to overlapping symmetry-related or different models. The overlap between two molecules can be defined as a product of their electron densities. The total overlap is a function of the position of the search model, r. It is computed using a single Fast Fourier Transform (FFT) run, but it accounts for all the symmetry-generated contacts. The packing function PF(r) is derived from the total overlap and is an estimate of the likelihood of the molecular packing corresponding to a given r. It takes values from 0 to 1, with PF(r) = 1 if there are no clashes `[Lebedev,Vagin, Murshudov, 2007] <https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2394799/>`_ . Program use to calculate Packing Function only atoms which lying inside of molecule. 

-------
Scores
-------

    • RFZ – rotation search score should be greater than 5 and peak should be clear/

    • TFZ – translation search score. You should see a clear peak.


The maps should show plausible information which was not in the model (new side chains, parts missing from the model). If you don’t see new features, then the model is probably wrong (model bias). In case of doubt, you can remove part of the model to see if it comes back.  

If there is a single unique solution, it is more likely to be correct than if there are many solutions with similar scores.


**References**


Rogers, D. (1965). Computing Methods in Crystallography, edited by J. S. Rollett, pp. 117-148. Oxford University Press. 

`Vagin, A. & Teplyakov, A. (1997). MOLREP: an Automated Program for Molecular Replacement, pp. 1022–1025. Appl. Cryst. 30. <https://scripts.iucr.org/cgi-bin/paper?li5010>`_

`Vagin, A. & Teplyakov, A. (2010). Molecular replacement with MOLREP, pp. 22-25, Acta Cryst. D66 <http://journals.iucr.org/d/issues/2010/01/00/dz5175/>`_

`Lebedev A., Vagin A., Murshudov G. (2008).  Model preparation in MOLREP and examples of model improvement using X-ray data. pp. 33–39, Acta Cryst. D64 <https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2394799/>`_
