======
PAIREF
======

PAIREF is a tool for macromolecular crystallographers that performs the PAIRed REFinement protocol `[1] <https://doi.org/10.1126%2Fscience.1218231>`_ automatically to estimate the optimal high-resolution cutoff. 


.. note:: To obtain meaningful results, the refinement setting during the paired refinement protocol should be very similar to the setting that has been used in previous refinement steps. 

.. note:: The usage of unmerged data is not obligatory, however, it is strongly recommended as they are required for the CC* calculation. Various file formats are supported (.HKL from XDS, .mtz, .sca).

+++++++++++++++++++++++++
Complete cross-validation
+++++++++++++++++++++++++

Use complete cross-validation option to run the paired refinement protocol for each individual free reflections set (*e.i.* to perform the complete cross-validation). The input structure model is modified to remove the bias of previous free reflection selection. The default setting is: 

* the atomic coordinates are perturbed by an average of 0.25 Å,
* ADPs are set to their average value. 

The modified model is then refined at the starting resolution, the number of refinement cycles is controlled by an option :code:`--prerefinement-ncyc` (20 cycles by default). To disable the automatic modification, use an option :code:`--prerefinement-no-modification`. For further information about the input model modification, see the Modification of input structure model section. 

.. warning:: It will require sufficient time to complete cross-validation


+++++++++++++++++++++++++++++++++++++
Modification of input structure model
+++++++++++++++++++++++++++++++++++++


The input structure model can be modified and refined at the starting resolution before the paired refinement. These options should be used if the structure has been refined in another software or another version than it is currently used, or the bias of previous free reflection selection is present. The number of refinement cycles at the starting resolution is being controlled by the option :code:`--prerefinement-ncyc` (20 cycles by default).

Possible modifications of the structure model:

* reset ADPs their mean value: :code:`--prerefinement-reset-bfactor`,
* add a value to the ADPs: :code:`--prerefinement-add-to-bfactor ADD_TO_BFACTOR`,
* set ADPs to a value: :code:`--prerefinement-set-bfactor`,
* perturb the atomic coordinates by an average of a value (0.25 Å by default): :code:`--prerefinement-shake-sites [SHAKE_SITES]`,
* no modification :code:`--prerefinement-no-modification`.


**Useful links**

`PAIREF - Documentation <https://pairef.fjfi.cvut.cz/docs/index.html>`_

`PAIREF webinar <https://pairef.fjfi.cvut.cz/dokuwiki/doku.php?id=webinar_2021-03>`_

`PAIREF GitHub <https://github.com/MartinMalyMM/pairef>`_

`Example cases <https://pairef.fjfi.cvut.cz/dokuwiki/doku.php?id=start#example_cases>`_

**References**

`P.A. Karplus, K. Diederichs: “Linking crystallographic model and data quality.” (2012) Science, 336(6084):1030-3. <https://doi.org/10.1126%2Fscience.1218231>`_

`M. Maly, K. Diederichs, J. Dohnalek, P. Kolenko: Paired refinement under the control of PAIREF (2020) IUCrJ 7, 681-692 <https://doi.org/10.1107/S2052252520005916>`_

`M. Maly, K. Diederichs, J. Dohnalek, P. Kolenko: PAIREF: paired refinement also for Phenix users (2021) Acta Cryst F77, 226-229 <https://doi.org/10.1107/S2053230X21006129>`_