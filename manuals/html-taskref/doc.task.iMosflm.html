

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.3. Interactive Image Processing with iMosflm &mdash; CCP4 Cloud 1.7 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3.4. Data Reduction with Aimless" href="doc.task.Aimless.html" />
    <link rel="prev" title="3.2. Interactive Image Processing with DIALS/DUI" href="doc.task.DUI.html" /> 

</head>

<body>
    <header>
        <div class="container">
            <a class="site-nav-toggle hidden-lg-up"><i class="icon-menu"></i></a>
            <a class="site-title" href="index.html">
                CCP4 Cloud
            </a>
        </div>
    </header>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="index.html">Docs</a></li>
        
          <li><a href="Data_Processing.html"><span class="section-number">3. </span>Data Processing</a></li>
        
      <li><span class="section-number">3.3. </span>Interactive Image Processing with iMosflm</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="_sources/doc.task.iMosflm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Workflows.html">1. Automatic workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.WFlowAEP.html">1.1. Automatic Experimental Phasing Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.WFlowAMR.html">1.2. Automatic Molecular Replacement Workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Data_Import.html">2. Data Import</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Import.html">2.1. Data Import</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.ImportSeqCP.html">2.2. Import Sequence(s) by Copy-Paste</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.ImportPDB.html">2.3. Import from PDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.CloudImport.html">2.4. Import from Cloud Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.ImportReplace.html">2.5. Import &amp; Replace</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Migrate.html">2.6. Hop on CCP4 Cloud</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="Data_Processing.html">3. Data Processing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="doc.task.Xia2.html">3.1. Automatic Image Processing with Xia-2</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.DUI.html">3.2. Interactive Image Processing with DIALS/DUI</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.3. Interactive Image Processing with iMosflm</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Aimless.html">3.4. Data Reduction with Aimless</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Asymmetric_Unit_and_Structure_Revision.html">4. Asymmetric Unit and Structure Revision</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Asymmetric_Unit_and_Structure_Revision.html#asymmetric-unit">4.1. Asymmetric Unit</a></li>
<li class="toctree-l2"><a class="reference internal" href="Asymmetric_Unit_and_Structure_Revision.html#structure-revision">4.2. Structure Revision</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Automated_Molecular_Replacement.html">5. Automated Molecular Replacement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Morda.html">5.1. Morda</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.MrBump.html">5.2. MrBump</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Balbes.html">5.3. Balbes</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Simbad.html">5.4. Simbad</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Ample.html">5.5. Ample</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Molecular_Replacement.html">6. Molecular Replacement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.MR_model_preparation.html">6.1. Molecular Replacement Models and Ensembles</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Phaser.html">6.2. Phaser</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Molrep.html">6.3. Molrep</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Fragment-Based_Molecular_Replacement.html">7. Fragment-Based Molecular Replacement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Arcimboldo.html">7.1. Fragment Molecular Replacement with Arcimboldo</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.ArcimboldoBorges.html">7.2. Arcimboldo Borges</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.ArcimboldoShredder.html">7.3. Arcimboldo Shredder</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Experimental_Phasing.html">8. Experimental Phasing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Crank2.html">8.1. Crank-2</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.SHELX.html">8.2. SHELXCD</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.SHELX.html#id1">8.3. SHELXE</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Phaser.html">6.2. Phaser</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Density_Modification.html">9. Density Modification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Parrot.html">9.1. Density Modification with Parrot</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Acorn.html">9.2. Phase Refinement and Dynamic Density Modification with ACORN</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.SHELX.html">8.2. SHELXCD</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.SHELX.html#id1">8.3. SHELXE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Refinement_and_Model_Building.html">10. Refinement and Model Building</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Refmac.html">10.1. REFMAC5</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Buster.html">10.2. Buster Refinement</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Lorestr.html">10.3. Low-Resolution Refinement with Lorestr</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.CCP4Build.html">10.4. Automatic Model Building with CCP4Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Buccaneer.html">10.5. Automatic Model Building with Buccaneer</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.ArpWarp.html">10.6. Automated Model Building with Arp/wArp</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.ModelCraft.html">10.7. Automatic Model Building with Modelcraft</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Nautilus.html">10.8. Automatic Model Building of RNA/DNA with Nautilus</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Dimple.html">10.9. Dimple</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.CombStructure.html">10.10. Comb Structure with Coot/Refmac</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="COOT.html">11. COOT</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.CootMB.html">11.1. Model Building with Coot</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.CootCE.html">11.2. Edit Coordinates with Coot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Ligands.html">12. Ligands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.MakeLigand.html">12.1. Make Ligand with Acedrg</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.FitLigand.html">12.2. Find and Fit Ligand with Coot</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.FitWaters.html">12.3. Find and Fit Waters with Coot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Validation_Analysis_and_Deposition.html">13. Validation, Analysis and Deposition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Zanuda.html">13.1. Space Group Validation with Zanuda</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Privateer.html">13.2. Validation of carbohydrate structures with Privateer</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.PISA.html">13.3. Surface, Interfaces and Assembly Analysis with PISA</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Deposition.html">13.4. Prepare data for deposition</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Toolbox.html">14. Toolbox</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Auspex.html">14.1. Reflection data diagnostics with Auspex plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.SRF.html">14.2. Self-Rotation Function Analysis with Molrep</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.CrosSec.html">14.3. X-ray cross sections and anomalous scattering factors</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.XyzUtils.html">14.4. Coordinate Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Gemmi.html">14.5. Gemmi</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.Gesamt.html">14.6. Pairwise Structural Alignment with GESAMT</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.LsqKab.html">14.7. Structure Superposition with LsqKab</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.SeqAlign.html">14.8. Sequence Alignment with ClustalW</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc.task.SymMatch.html">14.9. Symmetry Match to Reference Structure with CSymMatch</a></li>
</ul>
</li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <div class="section" id="interactive-image-processing-with-imosflm">
<h1><span class="section-number">3.3. </span>Interactive Image Processing with iMosflm<a class="headerlink" href="#interactive-image-processing-with-imosflm" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3069742/" rel="noopener noreferrer" target="_blank">iMOSFLM</a> is a graphical user interface to the diffraction data-integration program <a class="reference external" href="http://journals.iucr.org/d/issues/2006/01/00/ba5082/index.html" rel="noopener noreferrer" target="_blank">MOSFLM</a>.
MOSFLM  is a program to process diffraction data collected using the oscillation method (Arndt &amp; Wonacott, 1977). MOSFLM process the resulting diffraction images into three stages. The first is the determination of the crystal parameters, in particular the crystal lattice (unit cell) and its orientation relative to a laboratory axial system (usually based on the X-ray beam direction and the rotation axis). This is usually referred to as autoindexing. Knowledge of these parameters then allows an initial estimate of the crystal mosaicity. The second step is the determination of accurate unit-cell parameters, using a procedure known as post-refinement. This requires the integration of one or more segments of data with a few images in each segment. The final step is the integration of the entire set of diffraction images, while simultaneously refining parameters associated with both the crystal and the detector.</p>
<p>There are the six basic “tasks” that iMosflm can perform:</p>
<p><strong>Images</strong>, <strong>Indexing</strong>, <strong>Strategy</strong>, <strong>Cell Refinement</strong>, <strong>Integration</strong>, <strong>History</strong></p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">By</span> <span class="pre">clicking</span> <span class="pre">on</span> <span class="pre">&quot;User</span> <span class="pre">Guide&quot;</span> <span class="pre">you</span> <span class="pre">will</span> <span class="pre">guide</span> <span class="pre">to</span> <span class="pre">iMOSFILM</span> <span class="pre">user</span> <span class="pre">guide</span> <span class="pre">sections.</span></code></p>
</div>
<div class="section" id="images">
<h2><span class="section-number">3.3.1. </span>Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver730/documentation/tutorial.html#mozTocId486119" rel="noopener noreferrer" target="_blank">User Guide</a></p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">There</span> <span class="pre">is</span> <span class="pre">no</span> <span class="pre">need</span> <span class="pre">to</span> <span class="pre">select</span> <span class="pre">all</span> <span class="pre">the</span> <span class="pre">images</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">dataset</span> <span class="pre">-</span> <span class="pre">iMosflm</span> <span class="pre">assumes</span> <span class="pre">that</span> <span class="pre">(normally)</span> <span class="pre">you</span> <span class="pre">will</span> <span class="pre">want</span> <span class="pre">to</span> <span class="pre">load</span> <span class="pre">a</span> <span class="pre">complete</span> <span class="pre">dataset,</span> <span class="pre">so</span> <span class="pre">it</span> <span class="pre">finds</span> <span class="pre">all</span> <span class="pre">images</span> <span class="pre">that</span> <span class="pre">fit</span> <span class="pre">the</span> <span class="pre">&quot;image</span> <span class="pre">template&quot;</span> <span class="pre">if</span> <span class="pre">you</span> <span class="pre">pick</span> <span class="pre">any</span> <span class="pre">file</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">dataset</span> <span class="pre">and</span> <span class="pre">the</span> <span class="pre">displayed</span> <span class="pre">image</span> <span class="pre">will</span> <span class="pre">the</span> <span class="pre">one</span> <span class="pre">you</span> <span class="pre">chose.</span></code></p>
</div>
<p>Images collected using the Dectris Eiger detector are not written as a single file per image, but multiple images are written to a single file in <strong>HDF5</strong> format. iMosflm will read <strong>HDF5 “master” files</strong> (Not NeXus files). The program has been tested on HDF5 files produced at Diamond Light Source and ESRF. However, at present, there is no well defined standard for the way in which the experimental information is stored in the HDF5 files (wavelength, detector distance, beam coordinates, rotation angles etc), and so this information may be incomplete or incorrect.  It may therefore be necessary to enter or correct this data in iMosflm before attempting to process the images (see the <a class="reference external" href="https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver730/documentation/tutorial.html#mozTocId215473" rel="noopener noreferrer" target="_blank">iMosflm tutorial</a> ).</p>
</div>
<div class="section" id="indexing">
<h2><span class="section-number">3.3.2. </span>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><strong>The cell dimensions derived from autoindexing usually give a good indication of the true symmetry of the crystal.</strong></div></blockquote>
<p><a class="reference external" href="https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver730/documentation/tutorial.html#mozTocId325663" rel="noopener noreferrer" target="_blank">User Guide</a></p>
<div class="section" id="indexing-overview">
<h3><span class="section-number">3.3.2.1. </span>Indexing – overview<a class="headerlink" href="#indexing-overview" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Find spots on the image</p>
</li>
<li><p class="first">Convert 2D co-ordinates (image) to scattering vectors (corresponding to 3D RL co-ordinates)</p>
</li>
<li><p class="first">Index</p>
</li>
<li><p class="first">Cell reduction</p>
</li>
<li><p class="first">Apply Bravais lattice symmetry</p>
</li>
<li><p class="first">Pick a putative solution</p>
</li>
<li><p class="first">Estimate mosaic spread</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">indexing</span> <span class="pre">only</span> <span class="pre">gives</span> <span class="pre">an</span> <span class="pre">approximate</span> <span class="pre">solution;</span> <span class="pre">we</span> <span class="pre">hope</span> <span class="pre">it</span> <span class="pre">will</span> <span class="pre">be</span> <span class="pre">good</span> <span class="pre">enough</span> <span class="pre">to</span> <span class="pre">proceed.</span></code></p>
</div></blockquote>
</li>
</ul>
<p>The 2D image co-ordinates of the spots can be converted to scattering vectors (that
correspond to lattice points):</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/doc.task.iMOSFILM1.png"><img alt="_images/doc.task.iMOSFILM1.png" src="_images/doc.task.iMOSFILM1.png" style="width: 220.75px; height: 188.75px;" /></a>
</div></blockquote>
<p>Here, <strong>D</strong> is the crystal to detector distance, <strong>X</strong> <sub>d</sub> and <strong>Y</strong> <sub>d</sub> are the spot co-ordinates relative to the beam centre on the image, and <strong>r</strong> is derived above (usually these are all in mm). In this calculation, <strong>s</strong> is in dimensionless reciprocal lattice units and the radius of the Ewald sphere is unity.</p>
<p><strong>wavelength, crystal to detector distance and beam centre must all be known</strong></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">the</span> <span class="pre">spots</span> <span class="pre">that</span> <span class="pre">are</span> <span class="pre">visible</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">image</span> <span class="pre">correspond</span> <span class="pre">to</span> <span class="pre">reciprocal</span> <span class="pre">lattice</span> <span class="pre">points</span> <span class="pre">that</span> <span class="pre">are</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">Ewald</span> <span class="pre">sphere</span> <span class="pre">at</span> <span class="pre">some</span> <span class="pre">point</span> <span class="pre">during</span> <span class="pre">this</span> <span class="pre">individual</span> <span class="pre">exposure</span></code></div></blockquote>
<p>The default autoindexing in Mosflm operates with spots found on a single image; although each can include spots from multiple images. Mosflm works best with spots from a series of non-contiguous images, which are well separated in φ; by default, iMosflm will use spots from two images that are as close as possible to 90° apart in φ. It assigns the midpoint of the rotation range of each image as the value for the reflection in the autoindexing procedure, so if contiguous images are used, different parts of a single reflection may be found on consecutive images, and each part of the same reflection will be assigned a different φ; autoindexing is likely to fail.</p>
<p>Indexing itself within Mosflm uses a “real-space” method (i.e. the real space unit cell dimensions are obtained directly, rather than via the reciprocal space unit cell) using an <a class="reference external" href="http://journals.iucr.org/d/issues/1999/10/00/ba0024/ba0024.pdf" rel="noopener noreferrer" target="_blank">FFT-based method</a>. For reciprocal lattice planes that have a simple relationship to each other, the projected vectors will also have a simple relationship. For example, the vectors corresponding to the 1kl, 2kl, 3kl planes will have lengths in the ratio 1:2:3. The projections which have more contributing planes will have more regularly spaced peaks, and so give rise to Fourier Transforms with peaks which are more distinct from the background. The indexing in Mosflm calculates several hundred projections, regularly spaced around a hemisphere of reciprocal space and applies a Fast Fourier Transform (FFT) to each. Although in principle, we only need to find the 3 FFTs corresponding to the three principal cell axes, they may not all be present (e.g. if the crystal orientation does not allow it), or we may find vectors corresponding to edges in a non-reduced cell. In practice, 30 FFTs produced which have the largest peaks are selected to determine which can be combined to give a real space unit cell which accounts for the majority of the reflections.</p>
</div>
</div>
<div class="section" id="data-collection-strategy">
<h2><span class="section-number">3.3.3. </span>Data collection strategy<a class="headerlink" href="#data-collection-strategy" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><strong>Suggestion for optimization of data collection</strong></div></blockquote>
<p><a class="reference external" href="https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver711/documentation/tutorial.html#mozTocId339960" rel="noopener noreferrer" target="_blank">User Guide</a></p>
<p>The total φ rotation to be used is normally calculated by MOSFLM based on the Laue group and the crystal orientation (the Auto setting).</p>
</div>
<div class="section" id="cell-refinement">
<h2><span class="section-number">3.3.4. </span>Cell Refinement<a class="headerlink" href="#cell-refinement" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><strong>Optimize the fit of observed to predicted spot positions, so that the measurement boxes can be placed accurately over the spots.</strong></div></blockquote>
<p><a class="reference external" href="https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver711/documentation/tutorial.html#mozTocId885357" rel="noopener noreferrer" target="_blank">User guide</a></p>
<p>Indexing is based on approximations, and the fit of observed spots to their calculated positions can be improved by refinement. These approximations include the phi position of the centroid of each reflection and various parameters like crystal to detector distance and detector mis-setting angles. Provided that there are sufficient usable data at high enough resolution, refinement not only gives better information about where on the detector the spots occur, but also gives better estimates of both the crystal and instrument parameters.</p>
<p>Mosflm combines “positional refinement” based on the spot positions on the detector surface with another method, which is based on the relative intensities of the different parts of partial reflections across several images.</p>
<p><strong>Positional refinement</strong></p>
<ul>
<li><p class="first">uses the spot positions on each image, so it can be done for each image without reference to the others. Both fully and partially recorded reflections can be used.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Positional</span> <span class="pre">refinement</span> <span class="pre">can</span> <span class="pre">be</span> <span class="pre">done</span> <span class="pre">on</span> <span class="pre">an</span> <span class="pre">image-by-image</span> <span class="pre">basis,</span> <span class="pre">since</span> <span class="pre">all</span> <span class="pre">the</span> <span class="pre">information</span> <span class="pre">required</span> <span class="pre">is</span> <span class="pre">present</span> <span class="pre">on</span> <span class="pre">each</span> <span class="pre">image;</span> <span class="pre">all</span> <span class="pre">integration</span> <span class="pre">programs</span> <span class="pre">allow</span> <span class="pre">this</span></code></p>
</div></blockquote>
</li>
</ul>
<p><strong>Post-refinement or “phi-centroid” method</strong></p>
<ul class="simple">
<li>needs intensity measurements for spots which are spread across at least two images; we cannot use fully recorded reflections for this</li>
<li>needs at least two adjacent images (and probably more for fine-phi slicing, where the mosaic spread is more than twice the rotation angle)</li>
</ul>
</div>
<div class="section" id="integration">
<h2><span class="section-number">3.3.5. </span>Integration<a class="headerlink" href="#integration" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><strong>recording how many counts in each spot, subtract background, usually fit reflection profiles.</strong></div></blockquote>
<p><a class="reference external" href="https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver730/documentation/tutorial.html#mozTocId907047" rel="noopener noreferrer" target="_blank">User guide</a></p>
<p>The first part of integration is to work out where the diffraction spot is, and where it ends. The assumption is made that, in the region of the spot, the background is planar and may have a slope. The background plane and its slope are calculated from pixels in the neighbourhood of the spot, once the spot pixels have been determined. Mosflm uses a rectangular mask, which is divided between an octagonal spot region and the background region</p>
<div class="section" id="summation-integration">
<h3><span class="section-number">3.3.5.1. </span>Summation integration<a class="headerlink" href="#summation-integration" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the absence of background, just add the pixel counts in the spot region together - but there is always some background, so this needs to be taken into account. It is impossible to measure the background directly under the spot, but its intensity can be inferred by assuming it to be a sloping plane in the neighbourhood of the spot. If the plane is steeper than some threshold value (e.g. because the spot is near an ice-ring), Mosflm will issue a warning.</li>
<li>Need to define spot and background regions - we cannot measure background directly under the spots, so we calculate a local background plane and slope from nearby non-spot pixels</li>
<li>Use this to subtract the background under the spots</li>
<li>Weak spots may have their shoulders under the background, so that their measurement is impaired.</li>
</ul>
</div>
<div class="section" id="profile-fitting">
<h3><span class="section-number">3.3.5.2. </span>Profile fitting<a class="headerlink" href="#profile-fitting" title="Permalink to this headline">¶</a></h3>
<p>intended to improve weak spots</p>
<ul class="simple">
<li><a class="reference external" href="http://journals.iucr.org/d/issues/1999/10/00/ba0027/ba0027.pdf" rel="noopener noreferrer" target="_blank">two-dimensional (2D)</a> – builds up reflections from profiles on single images (but we can use spots on different images)</li>
<li><a class="reference external" href="http://journals.iucr.org/d/issues/1999/10/00/ba0030/ba0030.pdf" rel="noopener noreferrer" target="_blank">three-dimensional (3D)</a> – builds up profiles across several adjacent images</li>
</ul>
<p>the profiles used for partials over several images for 2D integration are the same for each part of the reflection, whereas for 3D integration, the profile for different parts of the same reflection can change significantly.</p>
</div>
</div>
<div class="section" id="analysing-the-results-of-integration">
<h2><span class="section-number">3.3.6. </span>Analysing the results of integration<a class="headerlink" href="#analysing-the-results-of-integration" title="Permalink to this headline">¶</a></h2>
<p>Check graphs - they should vary smoothly without obvious discontinuities. If there are discontinuities in the graphs, they often occur around the same images for different graphs. Look at any images in the region of the discontinuities and see if there is anything obviously wrong with them</p>
<ul class="simple">
<li>Large changes in parameters may indicate problems with the crystal or instrument.</li>
<li>Look at any images corresponding to discontinuities in the graphs.</li>
<li>I/sigma(I) at (high resolution limit-~0.2Å) should be ≳1. If the graphs corresponding to I/sigma(I) fall gradually to lower values towards the end of the dataset, it is usually an indication that the crystal is exhibiting radiation damage.</li>
<li>Check any warnings issued by the program; it may be best to re-process after following the advice given (all warnings given by Mosflm are accompanied by suggestions on how to improve the processing)</li>
</ul>
<p><strong>more tips</strong> you can find <a class="reference external" href="https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver730/documentation/tutorial.html#mozTocId727216" rel="noopener noreferrer" target="_blank">here</a></p>
<p><strong>Useful links</strong></p>
<p><a class="reference external" href="https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver730/introduction.html" rel="noopener noreferrer" target="_blank">https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver730/introduction.html</a></p>
<p><strong>References</strong></p>
<p>Arndt, U. W. &amp; Wonacott, A. J. (1977). Editors. The Rotation Method in Crystallography Amsterdam: North-Holland</p>
<p><strong>ACKNOWLEDGEMENTS</strong></p>
<p>This article uses materials from Dr. Harry Powell lecture  “Integration and Scaling”.   We wish to thank  Dr. Harry Powell, Dr. Andrew Leslie, Dr. Owen Johnson for an amazing <a class="reference external" href="https://www.mrc-lmb.cam.ac.uk/harry/imosflm/ver730/documentation/tutorial.html" rel="noopener noreferrer" target="_blank">iMosflm Tutorial</a>.</p>
</div>
</div>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.7',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/contentui.js"></script>
    <script type="text/javascript" src="_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.0.1.
        </div>
    </div>  

</body>
</html>