=======================================
Linking MrParse to local databases
=======================================

----------------------------
MrParse search in CCP4 Cloud
----------------------------

In CCP4 Cloud, *MrParse* can be used to search various databases for possible
homologous structures in the *Protein databank* (*PDB*) or entries in the `EBI 
AlphaFold Database`_ (*EBI-AFDB*) or `ESMAtlas`_ Database. It can also be used 
to run *ESMFold* (through the *ESMAtlas* API) to generate a prediction for a 
given sequence (limited to 350 residues). The default behaviour is to use 
various online resources such as the `EBI Phmmer`_ API to search for matches. A 
reduced version of the *PDB* and *EBI-AFDB* sequence listings is also distributed
with *CCP4* and *MrParse* makes use of these. To improve results and keep them up to
date, a locally installed mirror of the *PDB* and its sequence listing can be
used. In addition, local versions of the *EBI-AFDB* sequence listings (~92GBs) 
and the *ESMAtlas* database sequence listings (~120GBs) can be used to enable a 
complete search of these databases.

.. _EBI AlphaFold Database: https://alphafold.ebi.ac.uk

.. _ESMAtlas: https://esmatlas.com/

.. _EBI Phmmer: https://www.ebi.ac.uk/Tools/hmmer/search/phmmer

------------------------------------------
Configuring MrParse to use local resources
------------------------------------------

There are 4 local database options that can be configured:

**1 A local PDB mirror**

The general CCP4 Cloud environment variable **PDB_DIR** is used to specify the 
location of a local mirror of the *PDB*. If this is set in start-nc.sh, *MrParse* 
will copy the coordinate files of hits that it finds in the *PDB* from this location,
removing the need to download them from the main *PDB* servers.

**2 A local copy of the PDB pdb sequence listing file (pdb_seqres.txt)**

This file is made available as part of a *PDB* mirror that includes the 
"derived_data" folder. *MrParse* can use this file to search the *PDB* and
give up-to-date hits, provided the mirror is synchronized on a regular basis. To enable
this option in MrParse, set the **PDB_SEQDB** environment variable in the start-nc.sh
script to point at the file's location.

**3 A local copy of the EBI-AFDB sequence listing file (sequences.fasta)**

This file, containing the complete list of the sequences of the 
predictions in the *EBI-AFDB*, is available for download from the `AFDB ftp site`_. 
Setting the **AFDB_SEQDB** environment variable in start-nc.sh to point at the
file's location on the local file system will enable MrParse to search the 
entire *EBI-AFDB* for hits.

.. _AFDB ftp site: https://ftp.ebi.ac.uk/pub/databases/alphafold/

**4 A local copy of the ESMAtlas sequence listing file**

*Available soon..*
