
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5. CCP4 Cloud Task Development: Hello World! &#8212; CCP4 Cloud 1.7 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css" />
    <link rel="stylesheet" type="text/css" href="_static/contentui.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/contentui.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="4. Task Interface Description" href="interface_desc.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>CCP4 Cloud 1.7 documentation</span></a></h1>
        <h2 class="heading"><span>5. CCP4 Cloud Task Development: Hello World!</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="interface_desc.html"><span class="section-number">4. </span>Task Interface Description</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <div class="section" id="ccp4-cloud-task-development-hello-world">
<span id="hello-world"></span><h1><span class="section-number">5. </span>CCP4 Cloud Task Development: Hello World!<a class="headerlink" href="#ccp4-cloud-task-development-hello-world" title="Permalink to this headline">¶</a></h1>
<p>CCP4 Cloud runs <em>tasks</em>. A <em>task</em> may be anything; it may or may not have input
data and parameters, it may or may not produce output data, and the least what
a <em>task</em> should do is to print messages. CCP4 Cloud is designed to run complex
<em>tasks</em>, way beyond just printing messages, operating with and producing
complex data structures, passable from one <em>task</em> to another. However, we start
introduction into task development for CCP4 Cloud with a simplest possible task
that only prints “Hello World!”.</p>
<p>First, let’s overview parts of CCP4 Cloud code relevant to task development.</p>
<div class="section" id="ccp4-cloud-source-code-structure">
<h2><span class="section-number">5.1. </span>CCP4 Cloud source code structure<a class="headerlink" href="#ccp4-cloud-source-code-structure" title="Permalink to this headline">¶</a></h2>
<p>From task developer perspective, CCP4 Cloud source code has 6 main parts:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">js-client</span></code>: javascript code that runs on client side (browser). Task
developer need to modify only one file from this part:
<code class="docutils literal notranslate"><span class="pre">js-client/cofe.dialog_tasklist.js</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">js-common</span></code>: javascript code that runs on both client and server. Task
developer is supposed to contribute relevant data classes in
<code class="docutils literal notranslate"><span class="pre">js-common/dtypes</span></code> (only if necessary), and new task classes in
<code class="docutils literal notranslate"><span class="pre">js-common/tasks</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">pycofe</span></code>: python code that actually runs tasks on number crunchers.
<code class="docutils literal notranslate"><span class="pre">pycofe/dtypes</span></code> must include python equivalents of all data classes from
<code class="docutils literal notranslate"><span class="pre">js-common/dtypes</span></code>, and <code class="docutils literal notranslate"><span class="pre">pycofe/tasks</span></code> must include task drivers for all
task classes from <code class="docutils literal notranslate"><span class="pre">js-common/tasks</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">images</span></code>: icons used in task’s web-pages. Task developer is supposed to
design a task icon and place 2 copies of it: one of size 20x20px, and one
of size at least 96x96px (unless in svg format), conventionally named
(see below), and copy them in this directory.</li>
<li><code class="docutils literal notranslate"><span class="pre">jscofe.html</span></code>: a bootstrap HTML file, where URLs to newly developed
javascript classes need to be inserted.</li>
<li><code class="docutils literal notranslate"><span class="pre">html</span></code>: task documentation (HTML). Task developers should document the use
of their tasks by placing properly named html files in this directory.</li>
</ul>
<p>File locations in CCP4 Cloud source code are fixed, which is essential for
CCP4 Cloud framework. In addition, data and task classes and respective file names
must follow conventions as described below.</p>
</div>
<div class="section" id="hello-world-task-in-stages">
<h2><span class="section-number">5.2. </span>“Hello, World!” task in stages<a class="headerlink" href="#hello-world-task-in-stages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-task-class">
<span id="task-class"></span><h3><span class="section-number">5.2.1. </span>Create Task Class<a class="headerlink" href="#create-task-class" title="Permalink to this headline">¶</a></h3>
<p>In CCP4 Cloud, task classes must be named as <code class="docutils literal notranslate"><span class="pre">TaskClassName</span></code> and be placed in
file named <code class="docutils literal notranslate"><span class="pre">js-common/tasks/common.tasks.classname.js</span></code>. The absolute minimal
class should be defined as follows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>  <span class="cm">/*  ------------------------------------------------------------------------</span>
<span class="linenos"> 2</span><span class="cm">   *  file js-common/tasks/common.tasks.helloworld.js</span>
<span class="linenos"> 3</span><span class="cm">   *  ------------------------------------------------------------------------</span>
<span class="linenos"> 4</span><span class="cm">   */</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>  <span class="kd">var</span> <span class="nx">__template</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>   <span class="c1">// null __template indicates that the code runs in</span>
<span class="linenos"> 7</span>                           <span class="c1">// client browser</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>  <span class="c1">// otherwise, the code runs on a server, in which case __template references</span>
<span class="linenos">10</span>  <span class="c1">// a module with Task Template Class:</span>
<span class="linenos">11</span>
<span class="linenos">12</span>  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">module</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
<span class="linenos">13</span>    <span class="nx">__template</span> <span class="o">=</span> <span class="nx">require</span> <span class="p">(</span> <span class="s1">&#39;./common.tasks.template&#39;</span> <span class="p">);</span>
<span class="linenos">14</span>
<span class="linenos">15</span>  <span class="c1">// ===========================================================================</span>
<span class="linenos">16</span>
<span class="linenos">17</span>  <span class="c1">// 1. Define task constructor</span>
<span class="linenos">18</span>
<span class="linenos">19</span>  <span class="kd">function</span> <span class="nx">TaskHelloWorld</span><span class="p">()</span>  <span class="p">{</span>   <span class="c1">// must start with Task...</span>
<span class="linenos">20</span>
<span class="linenos">21</span>    <span class="c1">// invoke the template class constructor:</span>
<span class="linenos">22</span>    <span class="k">if</span> <span class="p">(</span><span class="nx">__template</span><span class="p">)</span>  <span class="nx">__template</span><span class="p">.</span><span class="nx">TaskTemplate</span><span class="p">.</span><span class="nx">call</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
<span class="linenos">23</span>               <span class="k">else</span>  <span class="nx">TaskTemplate</span><span class="p">.</span><span class="nx">call</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="c1">// define fields important for |jsCoFE| framework</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="k">this</span><span class="p">.</span><span class="nx">_type</span>   <span class="o">=</span> <span class="s1">&#39;TaskHelloWorld&#39;</span><span class="p">;</span>  <span class="c1">// must give name of the class</span>
<span class="linenos">28</span>    <span class="k">this</span><span class="p">.</span><span class="nx">name</span>    <span class="o">=</span> <span class="s1">&#39;Hello World!&#39;</span><span class="p">;</span>    <span class="c1">// default name to be shown in Job Tree</span>
<span class="linenos">29</span>    <span class="k">this</span><span class="p">.</span><span class="nx">oname</span>   <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">;</span>               <span class="c1">// default output file name template;</span>
<span class="linenos">30</span>                                      <span class="c1">// asterisk means do not use</span>
<span class="linenos">31</span>    <span class="k">this</span><span class="p">.</span><span class="nx">title</span>   <span class="o">=</span> <span class="s1">&#39;Hello World! First Example&#39;</span><span class="p">;</span>         <span class="c1">// title for job dialog</span>
<span class="linenos">32</span>    <span class="k">this</span><span class="p">.</span><span class="nx">helpURL</span> <span class="o">=</span> <span class="s1">&#39;./html/jscofe_task_helloworld.html&#39;</span><span class="p">;</span> <span class="c1">// documentation link,</span>
<span class="linenos">33</span>                                          <span class="c1">// please follow file name convention</span>
<span class="linenos">34</span>
<span class="linenos">35</span>  <span class="p">}</span>
<span class="linenos">36</span>
<span class="linenos">37</span>  <span class="c1">// finish constructor definition</span>
<span class="linenos">38</span>
<span class="linenos">39</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">__template</span><span class="p">)</span>
<span class="linenos">40</span>        <span class="nx">TaskHelloWorld</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="p">(</span> <span class="nx">__template</span><span class="p">.</span><span class="nx">TaskTemplate</span><span class="p">.</span><span class="nx">prototype</span> <span class="p">);</span>
<span class="linenos">41</span>  <span class="k">else</span>  <span class="nx">TaskHelloWorld</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="p">(</span> <span class="nx">TaskTemplate</span><span class="p">.</span><span class="nx">prototype</span> <span class="p">);</span>
<span class="linenos">42</span>  <span class="nx">TaskHelloWorld</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">TaskHelloWorld</span><span class="p">;</span>
<span class="linenos">43</span>
<span class="linenos">44</span>  <span class="c1">// ===========================================================================</span>
<span class="linenos">45</span>
<span class="linenos">46</span>  <span class="c1">// 2. Define task icons. Any graphics formats (*.svg, *.png, *.jpg) may be used,</span>
<span class="linenos">47</span>  <span class="c1">//    but please follow file name convention as below. Small 20x20px icon is</span>
<span class="linenos">48</span>  <span class="c1">//    used in Job Tree, and the large icon is used in Job Dialog and documentation.</span>
<span class="linenos">49</span>
<span class="linenos">50</span>  <span class="nx">TaskHelloWorld</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">icon_small</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>  <span class="p">{</span>
<span class="linenos">51</span>    <span class="k">return</span> <span class="s1">&#39;./images/task_helloworld_20x20.png&#39;</span><span class="p">;</span>
<span class="linenos">52</span>  <span class="p">}</span>
<span class="linenos">53</span>
<span class="linenos">54</span>  <span class="nx">TaskHelloWorld</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">icon_large</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>  <span class="p">{</span>
<span class="linenos">55</span>    <span class="k">return</span> <span class="s1">&#39;./images/task_helloworld.png&#39;</span><span class="p">;</span>
<span class="linenos">56</span>  <span class="p">}</span>
<span class="linenos">57</span>
<span class="linenos">58</span>  <span class="c1">// 3. Define task version. Whenever task changes (e.g. receives new input</span>
<span class="linenos">59</span>  <span class="c1">//    parameters or data), the version number must be advanced. |jsCoFE| framework</span>
<span class="linenos">60</span>  <span class="c1">//    forbids cloning jobs with version numbers lower than specified here.</span>
<span class="linenos">61</span>
<span class="linenos">62</span>  <span class="nx">TaskHelloWorld</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">currentVersion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>  <span class="p">{</span> <span class="k">return</span> <span class="mf">0</span><span class="p">;</span> <span class="p">}</span>
<span class="linenos">63</span>
<span class="linenos">64</span>  <span class="c1">// ===========================================================================</span>
<span class="linenos">65</span>
<span class="linenos">66</span>  <span class="c1">//  4. Add server-side code</span>
<span class="linenos">67</span>
<span class="linenos">68</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">__template</span><span class="p">)</span>  <span class="p">{</span>  <span class="c1">//  will run only on server side</span>
<span class="linenos">69</span>
<span class="linenos">70</span>    <span class="c1">// acquire configuration module</span>
<span class="linenos">71</span>    <span class="kd">var</span> <span class="nx">conf</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../js-server/server.configuration&#39;</span><span class="p">);</span>
<span class="linenos">72</span>
<span class="linenos">73</span>    <span class="c1">// form command line for server&#39;s node js to start task&#39;s python driver;</span>
<span class="linenos">74</span>    <span class="c1">// note that last 3 parameters are optional and task driver will not use</span>
<span class="linenos">75</span>    <span class="c1">// them in most cases.</span>
<span class="linenos">76</span>
<span class="linenos">77</span>    <span class="nx">TaskHelloWorld</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getCommandLine</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">exeType</span><span class="p">,</span><span class="nx">jobDir</span> <span class="p">)</span>  <span class="p">{</span>
<span class="linenos">78</span>      <span class="k">return</span> <span class="p">[</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">pythonName</span><span class="p">(),</span>         <span class="c1">// will use python from configuration</span>
<span class="linenos">79</span>               <span class="s1">&#39;-m&#39;</span><span class="p">,</span>                      <span class="c1">// will run task as a python module</span>
<span class="linenos">80</span>               <span class="s1">&#39;pycofe.tasks.helloworld&#39;</span><span class="p">,</span> <span class="c1">// path to python driver</span>
<span class="linenos">81</span>                <span class="nx">exeType</span><span class="p">,</span>                  <span class="c1">// framework&#39;s type of run: &#39;SHELL&#39; or &#39;SGE&#39;</span>
<span class="linenos">82</span>                <span class="nx">jobDir</span><span class="p">,</span>                   <span class="c1">// path to job directory given by framework</span>
<span class="linenos">83</span>                <span class="k">this</span><span class="p">.</span><span class="nx">id</span>                   <span class="c1">// task id (assigned by the framework)</span>
<span class="linenos">84</span>              <span class="p">];</span>
<span class="linenos">85</span>    <span class="p">}</span>
<span class="linenos">86</span>
<span class="linenos">87</span>    <span class="c1">// -------------------------------------------------------------------------</span>
<span class="linenos">88</span>    <span class="c1">// export such that it could be used in server&#39;s node js</span>
<span class="linenos">89</span>
<span class="linenos">90</span>    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">TaskHelloWorld</span> <span class="o">=</span> <span class="nx">TaskHelloWorld</span><span class="p">;</span>
<span class="linenos">91</span>
<span class="linenos">92</span>  <span class="p">}</span>
</pre></div>
</div>
<p>Obviously, the significance of various statements in this code cannot be clear
without knowing fine details of CCP4 Cloud frameworks, but this knowledge is not
required for the development of most tasks. One should perceive this example as
a set of formal statements, which may be modified to specific needs.</p>
<p>You may download the source code file from
<a class="reference download internal" download="" href="_downloads/e8dd4e3db54c80dca022a9e171092b19/common.tasks.helloworld.js"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>,
and copy it into <code class="docutils literal notranslate"><span class="pre">js-common/tasks</span></code> directory of your CCP4 Cloud setup. The source
code mentions <code class="docutils literal notranslate"><span class="pre">helloworld</span></code> icons; download them both
<a class="reference download internal" download="" href="_downloads/a46abf21347707ed52582689e4b09b43/task_helloworld_20x20.png"><code class="xref download docutils literal notranslate"><span class="pre">small</span> <span class="pre">(20x20)</span></code></a> and
<a class="reference download internal" download="" href="_downloads/be614178b19d12caa47b7abd059270d6/task_helloworld.png"><code class="xref download docutils literal notranslate"><span class="pre">large</span></code></a>, and copy them into
<code class="docutils literal notranslate"><span class="pre">images</span></code> directory of your CCP4 Cloud setup. Make sure that file names are exactly
as specified in the source code.</p>
</div>
<div class="section" id="create-task-documentation">
<h3><span class="section-number">5.2.2. </span>Create Task Documentation<a class="headerlink" href="#create-task-documentation" title="Permalink to this headline">¶</a></h3>
<p>Task Documentation should be written in HTML and placed in <code class="docutils literal notranslate"><span class="pre">html</span></code> directory
under the name given by <code class="docutils literal notranslate"><span class="pre">helpURL</span></code> variable of the task class (<em>cf.</em>
<a class="reference internal" href="#task-class"><span class="std std-ref">Create Task Class</span></a>). In order to comply with with the rest of documentation on
style, use template downloadable from
<a class="reference download internal" download="" href="_downloads/88455e3e8b703cc94c07780736580d22/jscofe_task_helloworld.html"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="linenos"> 2</span><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="linenos"> 5</span>  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;content-type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="p">&gt;</span>
<span class="linenos"> 6</span>  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
<span class="linenos"> 7</span>  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;pragma&quot;</span>  <span class="na">content</span><span class="o">=</span><span class="s">&quot;no-cache&quot;</span><span class="p">&gt;</span>
<span class="linenos"> 8</span>  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;expires&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">&gt;</span>
<span class="linenos"> 9</span>  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>|jsCoFE| Help - Hello World! Example<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="linenos">10</span><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;jscofe-help.css&quot;</span><span class="p">&gt;</span>
<span class="linenos">13</span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;jscofe-help-header.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width:100%;height:auto;overflow:auto;&quot;</span><span class="p">&gt;</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="linenos">20</span><span class="nx">makeHeader</span> <span class="p">([</span>
<span class="linenos">21</span>  <span class="p">[</span><span class="s1">&#39;Contents&#39;</span><span class="p">,</span><span class="s1">&#39;index.html&#39;</span><span class="p">],</span>
<span class="linenos">22</span>  <span class="p">[</span><span class="s1">&#39;Tasks&#39;</span><span class="p">,</span><span class="s1">&#39;jscofe_tasks.html&#39;</span><span class="p">],</span>
<span class="linenos">23</span>  <span class="p">[</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span><span class="s1">&#39;jscofe_task_helloworld.html&#39;</span><span class="p">]</span>
<span class="linenos">24</span><span class="p">]);</span>
<span class="linenos">25</span><span class="nx">makeTaskTitle</span> <span class="p">(</span> <span class="s1">&#39;task_helloworld.png&#39;</span><span class="p">,</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">,</span>
<span class="linenos">26</span>                <span class="s1">&#39;Example of the simplest task in |jsCoFE| framework.&#39;</span><span class="p">,</span>
<span class="linenos">27</span>                <span class="s1">&#39;task_helloworld.png&#39;</span>
<span class="linenos">28</span>              <span class="p">);</span>
<span class="linenos">29</span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="linenos">30</span>
<span class="linenos">31</span>to be written
<span class="linenos">32</span>
<span class="linenos">33</span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;height:120px;&quot;</span><span class="p">&gt;</span><span class="ni">&amp;nbsp;</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos">34</span>
<span class="linenos">35</span><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="linenos">36</span><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><a class="reference download internal" download="" href="_downloads/88455e3e8b703cc94c07780736580d22/jscofe_task_helloworld.html"><code class="xref download docutils literal notranslate"><span class="pre">Download</span></code></a> this file, edit
as necessary and copy it in <code class="docutils literal notranslate"><span class="pre">html</span></code> directory of your CCP4 Cloud setup.</p>
</div>
<div class="section" id="insert-new-task-in-the-task-list">
<h3><span class="section-number">5.2.3. </span>Insert New Task in the Task List<a class="headerlink" href="#insert-new-task-in-the-task-list" title="Permalink to this headline">¶</a></h3>
<p>Open file <code class="docutils literal notranslate"><span class="pre">js-client/cofe.dialog_tasklist.js</span></code> in any text editor and look for
the following fragment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">__login_user</span><span class="o">==</span><span class="s1">&#39;Developer&#39;</span><span class="p">)</span>
  <span class="n">this</span><span class="o">.</span><span class="n">makeSection</span> <span class="p">(</span> <span class="s1">&#39;Tasks in Development&#39;</span><span class="p">,[</span>
  <span class="p">]);</span>
</pre></div>
</div>
<p>This code makes section of tasks called <em>Tasks in Development</em> in the very end
of the task list. Furthermore, this section is created only for for user with
name <em>Developer</em>. This is a special user that always exists in CCP4 Cloud, with
login name <code class="docutils literal notranslate"><span class="pre">devel</span></code> and initial password <code class="docutils literal notranslate"><span class="pre">devel</span></code>. Insert the newly created
class <code class="docutils literal notranslate"><span class="pre">TaskHelloWorld</span></code> in this section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">__login_user</span><span class="o">==</span><span class="s1">&#39;Developer&#39;</span><span class="p">)</span>
  <span class="n">this</span><span class="o">.</span><span class="n">makeSection</span> <span class="p">(</span> <span class="s1">&#39;Tasks in Development&#39;</span><span class="p">,[</span>
    <span class="n">new</span> <span class="n">TaskHelloWorld</span><span class="p">()</span>
  <span class="p">]);</span>
</pre></div>
</div>
<p>and save the file.</p>
<p>Now we need to modify the HTML bootstrap file such that it loads javascript file
with the new task in browser. Open file <code class="docutils literal notranslate"><span class="pre">jscofe.html</span></code> in a suitable editor.
Although the task code may be loaded in any point before <code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code> statement,
it would be more accurate to keep task in developments in a separate, easily
identifiable place. Look for the following fragment in the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- Tasks in Development --&gt;
&lt;!-- ~~~~~~~~~~~~~~~~~~~~ --&gt;
</pre></div>
</div>
<p>and insert the link to the <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">World!</span></code> task script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- Tasks in Development --&gt;
&lt;script src=&quot;js-common/tasks/common.tasks.helloworld.js&quot;&gt;&lt;/script&gt;
&lt;!-- ~~~~~~~~~~~~~~~~~~~~ --&gt;
</pre></div>
</div>
<p>and save the file.</p>
<p>Now restart CCP4 Cloud servers and (re)load the HTML bootstrap file in your browser.
Login as <em>Developer</em> (login name <code class="docutils literal notranslate"><span class="pre">devel</span></code>), create new project if you do not
have any, open it and start the <em>Task List Dialog</em> (it will start automatically
for empty projects; otherwise, click the <em>Add job</em> button in the toolbar). Scroll
down to the last section, open it and click on <em>Hello World!</em> icon. The task
should appear in the <em>Job Tree</em>, and the corresponding <em>Job Dialog</em> should
start.</p>
</div>
<div class="section" id="making-the-task-driver">
<span id="task-driver"></span><h3><span class="section-number">5.2.4. </span>Making the Task Driver<a class="headerlink" href="#making-the-task-driver" title="Permalink to this headline">¶</a></h3>
<p>At this point, the new <em>task</em> appears on the client side, but it cannot be
started as we have not supplied the corresponding module, called <em>Task Driver</em>,
to run on a number cruncher. <em>Task Driver</em> is a program, which is started with
command line returned by the  <code class="docutils literal notranslate"><span class="pre">getCommandLine(...)</span></code> function of the
<em>Task Class</em>. Principally, it may be written in any language and do its job
in a number of different ways. Current version of CCP4 Cloud comes with a developed
support for <em>Task Drivers</em> written in Python, which includes many service
functions simplifying data exchange between the tasks and report writing.</p>
<p>The simplest possible <em>Task Driver</em> for the <em>Hello World!</em> task is represented
by the following Python script:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>##!/usr/bin/python
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>import os
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>from pycofe.tasks  import basic
<span class="linenos"> 6</span>
<span class="linenos"> 7</span># ============================================================================
<span class="linenos"> 8</span># HelloWorld driver
<span class="linenos"> 9</span>
<span class="linenos">10</span>class HelloWorld(basic.TaskDriver):
<span class="linenos">11</span>
<span class="linenos">12</span>    def run(self):
<span class="linenos">13</span>
<span class="linenos">14</span>        # put message
<span class="linenos">15</span>        self.putMessage ( &quot;Hello World!&quot; )
<span class="linenos">16</span>
<span class="linenos">17</span>        # print in standard output and standard error streams
<span class="linenos">18</span>        self.file_stdout.write ( &quot;Hello World!\n&quot; )
<span class="linenos">19</span>        self.file_stderr.write ( &quot;Hello World!\n&quot; )
<span class="linenos">20</span>
<span class="linenos">21</span>        # close execution logs and quit
<span class="linenos">22</span>        self.success()
<span class="linenos">23</span>        return
<span class="linenos">24</span>
<span class="linenos">25</span># ============================================================================
<span class="linenos">26</span>
<span class="linenos">27</span>if __name__ == &quot;__main__&quot;:
<span class="linenos">28</span>
<span class="linenos">29</span>    drv = HelloWorld ( &quot;&quot;,os.path.basename(__file__) )
<span class="linenos">30</span>    drv.run()
</pre></div>
</div>
<p><a class="reference download internal" download="" href="_downloads/4425a09b3826c2bb7fef5f900149f296/helloworld.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span></code></a> this file and copy it in
<code class="docutils literal notranslate"><span class="pre">pycofe/tasks</span></code> directories of all CCP4 Cloud number crunchers. Now you can
press <em>Run</em> button in <em>Hello World!</em> job dialog to run the task, which only
prints “Hellow World!” messages in the main output tab and output tabs for
standard output and standard error streams.</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="interface_desc.html"><span class="section-number">4. </span>Task Interface Description</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.1.
    </div>
  </body>
</html>