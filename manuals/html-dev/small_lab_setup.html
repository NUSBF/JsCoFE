
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#00020a">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Small Lab Setup, or how to convert CCP4 setup into CCP4 Cloud server &#8212; CCP4 Cloud 1.7 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/material.css" />
    <link rel="stylesheet" type="text/css" href="_static/contentui.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/contentui.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=#005BBB data-md-color-accent=yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#small_lab_setup" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="CCP4 Cloud 1.7 documentation"
           class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">CCP4 Cloud 1.7 documentation</span>
          <span class="md-header-nav__topic"> Small Lab Setup, or how to convert CCP4 setup into CCP4 Cloud server </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <script src="_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "_static/versions.json",
        target_loc = "../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">CCP4 Cloud 1.7 documentation</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="CCP4 Cloud 1.7 documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    <a href="index.html"
       title="CCP4 Cloud 1.7 documentation">CCP4 Cloud 1.7 documentation</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="setup.html" class="md-nav__link">1. Setup</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="launchers.html" class="md-nav__link">2. CCP4 Cloud Launch Scripts</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="configuration.html" class="md-nav__link">3. CCP4 Cloud Configuration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pm2.html" class="md-nav__link">4. Managing CCP4 Cloud with PM2</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="nginx.html" class="md-nav__link">5. Configuration of CCP4 Cloud with Nginx</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="af_setup.html" class="md-nav__link">6. Linking AlphaFold setup with CCP4 Cloud</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mrparse_server_setup.html" class="md-nav__link">7. Linking MrParse to local databases</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="interface_desc.html" class="md-nav__link">8. Task Interface Description</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dev_hello_world.html" class="md-nav__link">9. CCP4 Cloud Task Development: Hello World!</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tests.html" class="md-nav__link">10. Software testing in CCP4</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tests.html#ccp4-cloud-tests" class="md-nav__link">11. CCP4 Cloud tests</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="clientsetup.html" class="md-nav__link">12. CCP4 Cloud Client Setup</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="clientwhatfor.html" class="md-nav__link">13. What is CCP4 Cloud Client Software</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="documentation.html" class="md-nav__link">14. How to add a new Sphinx theme</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#small-lab-setup--page-root" class="md-nav__link">Small Lab Setup, or how to convert CCP4 setup into CCP4 Cloud server</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#basic-idea" class="md-nav__link">Basic idea</a>
        </li>
        <li class="md-nav__item"><a href="#step-by-step-setup-procedure" class="md-nav__link">Step-by-step setup procedure</a>
        </li>
        <li class="md-nav__item"><a href="#prerequisites-and-general-notes" class="md-nav__link">Prerequisites and general notes</a>
        </li>
        <li class="md-nav__item"><a href="#setup-procedure" class="md-nav__link">Setup procedure</a>
        </li>
        <li class="md-nav__item"><a href="#configuration-of-ccp4-cloud-clients" class="md-nav__link">Configuration of CCP4 Cloud Clients</a>
        </li>
        <li class="md-nav__item"><a href="#maintenance-and-updates" class="md-nav__link">Maintenance and Updates</a>
        </li>
        <li class="md-nav__item"><a href="#contact" class="md-nav__link">Contact</a>
        </li>
        <li class="md-nav__item"><a href="#appendix-a-installation-of-ccp4" class="md-nav__link">Appendix A. Installation of CCP4</a>
        </li>
        <li class="md-nav__item"><a href="#appendix-b-adjusting-configuration-file-for-number-cruncher-servers" class="md-nav__link">Appendix B. Adjusting configuration file for Number Cruncher Servers</a>
        </li>
        <li class="md-nav__item"><a href="#appendix-c-adjusting-configuration-file-for-the-front-end-server" class="md-nav__link">Appendix C. Adjusting configuration file for the Front-End Server</a>
        </li>
        <li class="md-nav__item"><a href="#appendix-d-adjusting-start-script-for-number-cruncher-servers" class="md-nav__link">Appendix D. Adjusting start script for Number Cruncher Servers</a>
        </li>
        <li class="md-nav__item"><a href="#appendix-e-adjusting-start-script-for-the-front-end-server" class="md-nav__link">Appendix E. Adjusting start script for the Front-End Server</a>
        </li>
        <li class="md-nav__item"><a href="#appendix-f-adjusting-apache-configuration-on-host-machines" class="md-nav__link">Appendix F. Adjusting Apache configuration on host machines</a>
        </li>
        <li class="md-nav__item"><a href="#appendix-g-tests-and-checks" class="md-nav__link">Appendix G. Tests and checks</a>
        </li>
        <li class="md-nav__item"><a href="#appendix-h-creating-1st-user-with-administrative-privileges" class="md-nav__link">Appendix H. Creating 1st user with administrative privileges</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="small-lab-setup--page-root">Small Lab Setup, or how to convert CCP4 setup into CCP4 Cloud server<a class="headerlink" href="#small-lab-setup--page-root" title="Permalink to this headline">¶</a></h1>
<p>Read this article if thinking about running CCP4 Cloud on your home or laboratory
network. Home network is coming readily with your router, which your internet
provider normally supply as part of your internet subscription. All your domestic
devices, connected to the router, either via cable or wirelessly, are found on
the same network and can communicate not only with the Internet, but also
with each other. In your workplace, your laboratory computers are often
connected to LAN (Local Area Network) and can talk to each other just the same
way as if the were connected to your home router.</p>
<p>Having home or local network makes it possible to set CCP4 Cloud on a single
machine (for example, a productive Linux workstation), and work with it from
any other machine on the network, be it Linux, Mac, Windows or even a tablet
or smartphone.</p>
<p>Doing this requires only access to root or sudo-enabled account on computer
designated to be CCP4 Cloud server.</p>

<h2 id="basic-idea">Basic idea<a class="headerlink" href="#basic-idea" title="Permalink to this headline">¶</a></h2>
<p>CCP4 Setup series 8.0 and higher comes with CCP4 Cloud server, running on
machine’s internal network, known as <strong>localhost</strong>. This server is already
known to you as CCP4 Cloud Desktop Mode. By default, a server running on
<strong>localhost</strong> cannot be accessed from other machines, because they are found
on network different from <strong>localhost</strong>.</p>
<p>We can, however, use technique called <em>Reverse proxying</em>, for forwarding
requests between the networks. The techique is used to expose a particular
URL on one network, as another URL which can be accessed on another network.
<em>Reverse proxying</em> is commonly provided by HTTP servers such as Apache,
Tomcat, NGINX and similar. In this article, we will use Apache, which
comes pre-installed on most modern Linux and Mac systems, or can be
easily installed from system repositories.</p>


<h2 id="step-by-step-setup-procedure">Step-by-step setup procedure<a class="headerlink" href="#step-by-step-setup-procedure" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Choose computer that will run CCP4 Cloud Server. A productive Linux
workstation would be a good choice. Although any high-end laptop would be
suitable, you probably want to have a desktop with at least 16GB RAM, 16
cores and few TBs of disk space for user projects (this would be suitable
for a small Lab with 1-3 users, focusing on wetlab, rather computational,
aspects).</p>
<p>As this machine will be a server, expect it to run 24/7; CCP4 CLoud would
need to be restarted each time this machine is rebooted. The machine must
have either a DNS-resolved network name or <em>fixed</em> IP address. As an
example, you have DNS-resolved URL lab.uni.ac.uk, if you can ping that
machine like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ping lab.uni.ac.uk
</pre></div>
</div>
<p>Fixed IP address can be found in network settings of your machines. For
home routers, it will be something like 192.168.8.142, so pinging on such
address will produce something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ping 192.168.8.142
</pre></div>
</div>
<p>PING 192.168.8.142 (192.168.8.142): 56 data bytes
64 bytes from 192.168.8.142: icmp_seq=0 ttl=64 time=0.081 ms
64 bytes from 192.168.8.142: icmp_seq=1 ttl=64 time=0.093 ms
64 bytes from 192.168.8.142: icmp_seq=2 ttl=64 time=0.074 ms
64 bytes from 192.168.8.142: icmp_seq=3 ttl=64 time=0.172 ms
64 bytes from 192.168.8.142: icmp_seq=4 ttl=64 time=0.088 ms</p>
<p>Find out local network address for CCP4 Cloud - designated machine and
verify it with pinging as above. In what follows, we will use IP address,
which can be replaced with DNS-resolved URL if you have one.</p>
</li>
<li><p class="first">Have CCP4 8.0+ installed on CCP4 Cloud - designated machine as usual, for
example, in <strong>/Xtal/ccp4-8.0</strong>. It is a good idea to install CCP4 in
a protected account, different from one that will be running CCP4 Cloud.</p>
</li>
<li><p class="first">Create unpriveleged user account for runnning CCP4 Cloud server, for example,
<em>ccp4cloud</em>. It is equally possible, but not advisable, to run CCP4 Cloud
with external access in one of user’s accounts.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">DO NOT run CCP4 Cloud server in a priveleged (root or sudo-enabled) account!</p>
</div>
</li>
<li><p class="first"><em>Login in CCP4 Cloud account</em> and prepare CCP4 Cloud storage for users,
for example, in <strong>/home/ccp4cloud</strong>:</p>
<p>cd ~
mkdir ccp4cloud-data
mkdir ccp4cloud-data/cofe-users
mkdir ccp4cloud-data/cofe-projects
mkdir ccp4cloud-data/cofe-nc-storage
mkdir ccp4cloud-data/cofe-client-storage
mkdir ccp4cloud-data/cofe-facilities
mkdir ccp4cloud-data/cofe-archive
mkdir ccp4cloud-data/tutorials</p>
</li>
</ol>
<p>In this Section, we describe the most popular CCP4 Cloud setup, comprising one Front-End Server (<strong>FE</strong>) and one or more Number Crunchers (<strong>NCs</strong>).</p>


<h2 id="prerequisites-and-general-notes">Prerequisites and general notes<a class="headerlink" href="#prerequisites-and-general-notes" title="Permalink to this headline">¶</a></h2>
<p>The Setup procedure is described in terms of servers and file systems, rather than machines (hardware hosts). Allocation of servers to hosts, virtual or real, should be done in respect to your requirements and resources. In simplest case, all servers can be placed on the same host. A few points should be taken into account:</p>
<ul class="simple">
<li><strong>FE</strong> does not perform computations, but should be efficient for file operations and network communication.</li>
<li><strong>NC(s)</strong> must be able to submit jobs to your computational infrastructure (<strong>Queue(s)</strong>), but they do not require a particular CPU power by themselves. However, if <strong>Queue</strong> represents a queue-less shell (<em>cf.</em> below), jobs will be run on the <strong>NC’s</strong> host machine, in which case a more powerful machine will be needed</li>
<li>we recommend having at least two <strong>NCs</strong> in CCP4 Cloud, such that jobs can be run even if one <strong>NC</strong> is temporarily down. Duplicate <strong>NCs</strong> can be placed on the same host machine and work with the same <strong>Queue</strong>. Should you wish to install only one <em>NC</em> at the beginning, simply ignore all instructions and configurations related to <em>NC2</em> in this document.</li>
</ul>
<p><strong>For setting up CCP4 Cloud, you will require:</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">in what follows, <code class="docutils literal notranslate"><span class="pre">/path/to/</span></code> does not stand for any particular path. Rather, it means any path of your choice, specific to the context including the host machine. Therefore, assume using <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">login@host</span></code> or <code class="docutils literal notranslate"><span class="pre">scp</span></code> instead of <code class="docutils literal notranslate"><span class="pre">cp</span></code> where necessary.</p>
</div>
<ol class="arabic">
<li><p class="first">Computational infrastructure (<strong>Queue(s)</strong>), such as SGE or SLURM cluster. If clusters are not available, jobs can run in Linux shell on <strong>NC’s</strong> host machine.</p>
</li>
<li><p class="first">CCP4 Setup version 7.1 or higher (download link). All <strong>FE</strong> , <strong>NC(s)</strong> and <strong>Queue(s)</strong> must have access to CCP4 Setup. For convenience, we assume that CCP4 will be installed in the following location, visible from all servers and <strong>Queue(s)</strong> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">CCP4</span><span class="o">/</span><span class="n">ccp4</span><span class="o">-</span><span class="mf">8.0</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">having different CCP4 Setups for different servers or hosts is possible but inconvenient from the maintenance point of view.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">we always recommend using the latest CCP4 release; upgrading CCP4 in CCP4 Cloud setup involves only a minor adjustment of configuration files and start scripts</p>
</div>
</div></blockquote>
<ol class="arabic" start="3">
<li><p class="first">Directories for <strong>FE</strong> and <strong>NC(s)</strong> <em>in respective hardware hosts</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span>
</pre></div>
</div>
</li>
<li><p class="first">Disk area(s) for keeping user data and projects. They need to be visible only for <strong>FE</strong> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk1</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk2</span>
</pre></div>
</div>
</li>
<li><p class="first">(All optional) disk area(s) for keeping X-ray diffraction images, other data, tutorials and safe for failed jobs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">images</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">pdb</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">job_safe</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">data</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">tutorials</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">images</span></code>, <code class="docutils literal notranslate"><span class="pre">pdb</span></code> (read-only) and <code class="docutils literal notranslate"><span class="pre">job</span> <span class="pre">safe</span></code> (read/write) areas must be accessible from all <strong>FE</strong> , <strong>NC(s)</strong> and <strong>Queue(s)</strong> . Other areas need a read-only access from <strong>FE</strong> only.</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li>Apache servers running <em>on each host machine</em> in the setup (excluding <strong>Queue(s)</strong> ).</li>
<li>CCP4 Cloud account <em>in each host machine</em>. This account does not need elevated privileges, but it must have access to disk areas as described above.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>FE</strong>, <strong>NC(s)</strong> and computational jobs will run in the CCP4 Cloud account. For security reasons, do not use a personal account for running CCP4 Cloud and restrict the designated account such that no changes or unauthorised access can be made in sensitive parts of your system and personal disk areas.</p>
</div>


<h2 id="setup-procedure">Setup procedure<a class="headerlink" href="#setup-procedure" title="Permalink to this headline">¶</a></h2>
<p>All actions, except 1 and 9, should be done in the designated CCP4 Cloud account on respective hosts (excluding <a class="reference internal" href="#appendix-f"><span class="std std-ref">Apache configuration</span></a>).</p>
<ol class="arabic">
<li><p class="first">Install CCP4 (see details in <a class="reference internal" href="#appendix-a"><span class="std std-ref">Appendix A</span></a>).</p>
</li>
<li><p class="first">Download and unpack the CCP4 Cloud setup tarball (choose convenient disk area visible from all servers, or repeat the following command on every host):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span>
<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ccp4serv6</span><span class="o">.</span><span class="n">rc</span><span class="o">-</span><span class="n">harwell</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="o">/</span><span class="n">jscofe</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">ccp4cloud</span><span class="o">-</span><span class="n">setup</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="o">&gt;</span> <span class="n">ccp4cloud</span><span class="o">-</span><span class="n">setup</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xvzf</span> <span class="n">ccp4cloud</span><span class="o">-</span><span class="n">setup</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</li>
<li><p class="first">Create server directories and copy content of prototype contents from the CCP4 Cloud setup tarball (commands to be executed in respective hosts):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span><span class="o">/</span><span class="n">ccp4cloud</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">FE</span><span class="o">/*</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span><span class="o">/</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span><span class="o">/</span><span class="n">ccp4cloud</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">NC</span><span class="o">/*</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span><span class="o">/</span><span class="n">ccp4cloud</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">NC</span><span class="o">/*</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p class="first">Create directories for user projects and miscellaneous items:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk1</span><span class="o">/</span><span class="n">users</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk1</span><span class="o">/</span><span class="n">projects</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk1</span><span class="o">/</span><span class="n">facilities</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk2</span><span class="o">/</span><span class="n">projects</span>
</pre></div>
</div>
</li>
</ol>
<p>At list one disk must be allocated for user and project data. Additional disks (<code class="docutils literal notranslate"><span class="pre">disk2</span></code> in this example) may be added later.</p>
<ol class="arabic" start="5">
<li><p class="first">Make necessary changes in <strong>NC</strong> configuration files (see details in
<a class="reference internal" href="#appendix-b"><span class="std std-ref">Appendix B</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">json</span>
<span class="n">vi</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</li>
<li><p class="first">Make necessary changes in <strong>FE</strong> configuration file (see details in
<a class="reference internal" href="#appendix-c"><span class="std std-ref">Appendix C</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this step uses data from <strong>NC</strong> configuration files.</p>
</div>
</div></blockquote>
<ol class="arabic" start="7">
<li><p class="first">Make necessary changes in <strong>NC(s)</strong> start script(s) (see details in <a class="reference internal" href="#appendix-d"><span class="std std-ref">Appendix D</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">nc</span><span class="o">.</span><span class="n">sh</span>
<span class="n">vi</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">nc</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p class="first">Make necessary changes in <strong>FE</strong> start script (see details in <a class="reference internal" href="#appendix-e"><span class="std std-ref">Appendix E</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">fe</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p class="first">Modify Apache configuration <em>on every host</em> (see details in <a class="reference internal" href="#appendix-f"><span class="std std-ref">Appendix F</span></a>)</p>
</li>
<li><p class="first">Start CCP4 Cloud servers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">nc</span><span class="o">.</span><span class="n">sh</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">nc</span><span class="o">.</span><span class="n">sh</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">fe</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">you may receive a confusing message <em>‘’configuration file not found’’</em> here. This may be indeed due to a typo in configuration file paths within the scripts, but also because of misformatted configuration file(s). Typically, extra commas between JSON items are introduced or get omitted at manual editing.</p>
</div>
<ol class="arabic" start="11">
<li><p class="first">Perform checks and tests (see details in <a class="reference internal" href="#appendix-g"><span class="std std-ref">Appendix G</span></a>).</p>
</li>
<li><p class="first">Create CCP4 Cloud user with administrative privileges (see details in <a class="reference internal" href="#appendix-h"><span class="std std-ref">Appendix H</span></a>)</p>
</li>
<li><p class="first">Delete the temporary setup directory (optional)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>The End.</strong></p>


<h2 id="configuration-of-ccp4-cloud-clients">Configuration of CCP4 Cloud Clients<a class="headerlink" href="#configuration-of-ccp4-cloud-clients" title="Permalink to this headline">¶</a></h2>
<p>It is recommended that users access CCP4 Cloud via CCP4 Cloud Client, rather than direct web-link in browser. Using CCP4 Cloud Client allows to use interactive graphical software, such as <code class="docutils literal notranslate"><span class="pre">Coot</span></code>, with the remote CCP4 Cloud instance.</p>
<p>CCP4 Cloud Client is launched by clicking on icon with CCP4 Diamond, cloud and Wi-Fi sign, found in CCP4 Setup 8.0 on user machines. By default, it connects to CCP4 Cloud run by CCP4 at Harwell, and should be re-configured for using your own CCP4 Cloud instance. For that, launch CCP4 Cloud Client Configurator by clicking on icon with CCP4 Diamond, cloud and gear sign, and change the URL in the field provided. In terms, used in this document, the URL will be</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">mysite</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ccp4cloud</span><span class="o">/</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>the trailing slash is significant</li>
<li>this operation needs to be performed only once by every user of your new CCP4 Cloud instance</li>
</ul>
</div>


<h2 id="maintenance-and-updates">Maintenance and Updates<a class="headerlink" href="#maintenance-and-updates" title="Permalink to this headline">¶</a></h2>
<p>CCP4 Cloud can be started and restarted as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">nc</span><span class="o">.</span><span class="n">sh</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">nc</span><span class="o">.</span><span class="n">sh</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">fe</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>You may find it more convenient to write a single script for (re)starting CCP4 Cloud, possibly using ssh access to all hosts involved.</p>
<p>CCP4 Software is regularly updated (once in 2-4 weeks). CCP4 Cloud maintainer will be informed by e-mail when a new update is issued; in addition, CCP4 Cloud users may see notification of new updates when working via CCP4 Cloud Client. Updates may be applied with the following commands, which can be, again, put into a single convenience script):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">CCP4</span><span class="o">/</span><span class="n">ccp4</span><span class="o">-</span><span class="mf">8.0</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ccp4um</span> <span class="o">-</span><span class="n">auto</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">nc</span><span class="o">.</span><span class="n">sh</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">nc</span><span class="o">.</span><span class="n">sh</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">fe</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">CCP4 must be updated in the account used for its installation, and CCP4 Cloud servers must be restarted in CCP4 Cloud accounts in respective hosts</p>
</div>


<h2 id="contact">Contact<a class="headerlink" href="#contact" title="Permalink to this headline">¶</a></h2>
<p>In case of problems with CCP4 Cloud setup or questions on further customisation of your CCP4 Cloud instance, do not hesitate to contact CCP4 at <a class="reference external" href="mailto:ccp4%40ccp4.ac.uk" rel="noopener noreferrer" target="_blank">ccp4<span>@</span>ccp4<span>.</span>ac<span>.</span>uk</a> .</p>


<span id="appendix-a"></span><h2 id="appendix-a-installation-of-ccp4">Appendix A. Installation of CCP4<a class="headerlink" href="#appendix-a-installation-of-ccp4" title="Permalink to this headline">¶</a></h2>
<p>The latest CCP4 can be conveniently installed with the following script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Installing the latest CCP4 version series 7.1 for Linux (minimal configuration)
cd /path/to/CCP4
h=http://series-71.fg.oisin.rc-harwell.ac.uk/downloads/packages_others
x=$(curl -s ${h}/md5sums.txt | grep linux64)
x=${x/* }
echo ${x} # on 26 Oct 2020 prints ccp4-7.1.006-linux64.tar.gz
curl -O ${h}/${x}
tar -zxf ${x}
rm ${x}
cd ccp4-7.1
./BINARY.setup
bin/ccp4um -m 99 # tells that ccp4 is up to date; can be used for updating later on
exit
</pre></div>
</div>


<span id="appendix-b"></span><h2 id="appendix-b-adjusting-configuration-file-for-number-cruncher-servers">Appendix B. Adjusting configuration file for Number Cruncher Servers<a class="headerlink" href="#appendix-b-adjusting-configuration-file-for-number-cruncher-servers" title="Permalink to this headline">¶</a></h2>
<p>Below is an <em>excerpt</em> of <strong>NC</strong> configuration settings that must be revised. Other settings are for fine tuning and development, and can be left as is in most cases. Please refer to <a class="reference internal" href="configuration.html#ccp4-cloud-configuration"><span class="std std-ref">CCP4 Cloud configuration reference</span></a> for more details :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="s2">"NumberCrunchers"</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"name"</span>             <span class="p">:</span> <span class="s2">"server-name"</span><span class="p">,</span>
        <span class="s2">"port"</span>             <span class="p">:</span> <span class="mi">8086</span><span class="p">,</span>
        <span class="s2">"externalURL"</span>      <span class="p">:</span> <span class="s2">"https://www.mysite.com/ccp4cloud-nc-01"</span><span class="p">,</span>
        <span class="s2">"capacity"</span>         <span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
        <span class="s2">"max_nproc"</span>        <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">"storage"</span>          <span class="p">:</span> <span class="s2">"/path/to/NC/nc-storage"</span><span class="p">,</span>
        <span class="s2">"jobs_safe"</span>        <span class="p">:</span> <span class="p">{</span>
            <span class="s2">"path"</span>     <span class="p">:</span> <span class="s2">"/path/to/job_safe"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">"exeType"</span>          <span class="p">:</span> <span class="s2">"SGE"</span><span class="p">,</span>
        <span class="s2">"exeData"</span>          <span class="p">:</span> <span class="p">[</span><span class="s2">"-cwd"</span><span class="p">,</span><span class="s2">"-V"</span><span class="p">,</span><span class="s2">"-b"</span><span class="p">,</span><span class="s2">"y"</span><span class="p">,</span><span class="s2">"-q"</span><span class="p">,</span><span class="s2">"all.q"</span><span class="p">,</span><span class="s2">"-notify"</span><span class="p">],</span>
        <span class="s2">"logflow"</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">"log_file"</span>     <span class="p">:</span> <span class="s2">"/path/to/NC/logs/node_nc"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">],</span>

<span class="s2">"Emailer"</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"type"</span>            <span class="p">:</span> <span class="s2">"telnet"</span><span class="p">,</span>
        <span class="s2">"emailFrom"</span>       <span class="p">:</span> <span class="s2">"name@mysite.com"</span><span class="p">,</span>
        <span class="s2">"maintainerEmail"</span> <span class="p">:</span> <span class="s2">"name@mysite.com"</span><span class="p">,</span>
        <span class="s2">"host"</span>            <span class="p">:</span> <span class="s2">"mail.server.at.mysite.com"</span><span class="p">,</span>
        <span class="s2">"port"</span>            <span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
        <span class="s2">"headerFrom"</span>      <span class="p">:</span> <span class="s2">"CCP4 Cloud &lt;name@mysite.com&gt;"</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong>name</strong></dt><dd><strong>NC</strong> name, which is used exclusively in report and log pages for <strong>NC</strong> identification</dd>
<dt><strong>port</strong></dt><dd>port number on <em>localhost</em>. The port should be used exclusively for the given <strong>NC</strong></dd>
<dt><strong>externalURL</strong></dt><dd>this is a DNS-resolved URL for accessing <strong>NC</strong> from other hosts. If <strong>NC</strong> shares host with <strong>FE</strong>, put blank line <code class="docutils literal notranslate"><span class="pre">""</span></code></dd>
<dt><strong>capacity</strong></dt><dd>this is an estimate for the number of <em>jobs</em> that given <strong>NC</strong> can run simultaneously</dd>
<dt><strong>max_nproc</strong></dt><dd>this is the number of cores that a <em>job</em> can use on given <strong>NC</strong></dd>
<dt><strong>storage</strong></dt><dd><p>path to disk area, used for making job’s working directories. The area is self-cleaning; working directories are deleted when job is finished and sent back to <strong>FE</strong> . Do not mistake this area with temporary disk space on individual cluster nodes. In general, this area can be located anywhere, the template distribution tarball assumes that it is within the <strong>NC</strong> directory. E.g., for 1st <strong>NC</strong>, put</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span><span class="n">nc</span><span class="o">-</span><span class="n">storage</span>
</pre></div>
</div>
</dd>
<dt><strong>jobs_safe</strong></dt><dd><p>this is disk area for retaining working directories for failed jobs; only a limited number of latest failed jobs is captured. In general, this area can be located anywhere, however, it is convenient to have it on file system that is shared between <strong>FE</strong> and <strong>NC(s)</strong> . If such file system is not available, a directory within <strong>NC’s</strong> directory can be used, for example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span><span class="n">job_safe</span>
</pre></div>
</div>
</dd>
</dl>
<p>In any case, this directory must exist before starting CCP4 Cloud.</p>
<dl class="docutils">
<dt><strong>exeType</strong></dt><dd>this is type of used <strong>Queue</strong>, which may be one of the following:  <code class="docutils literal notranslate"><span class="pre">SHELL</span></code>, <code class="docutils literal notranslate"><span class="pre">SGE</span></code>, <code class="docutils literal notranslate"><span class="pre">SLURM</span></code> or <code class="docutils literal notranslate"><span class="pre">SCRIPT</span></code> . The template provided assumes Sungrid Engine (<code class="docutils literal notranslate"><span class="pre">SGE</span></code>). Change it for <code class="docutils literal notranslate"><span class="pre">SHELL</span></code> to run jobs on <strong>NC</strong> without any queue management (recommended only at relatively low number of jobs passing).</dd>
<dt><strong>exeData</strong></dt><dd>configuration options for <strong>Queue</strong>. The template shows some keywords for the Sungrid Engine (<code class="docutils literal notranslate"><span class="pre">SGE</span></code> type). For <code class="docutils literal notranslate"><span class="pre">SHELL</span></code> execution type, put empty line <code class="docutils literal notranslate"><span class="pre">""</span></code>.</dd>
<dt><strong>log_file</strong></dt><dd>this is optional but useful configuration, which is used to split excessively long log files in chunks.</dd>
</dl>
<dl class="docutils" id="ccp4-cloud-emailer">
<dt><strong>Emailer</strong></dt><dd><p><strong>NC</strong> may send e-mail messages to the maintainer in case of malfunction. This may be configured in several ways. The template shows e-mailer configuration for the <code class="docutils literal notranslate"><span class="pre">telnet</span></code> type of the e-mailer. Other possible configurations include <code class="docutils literal notranslate"><span class="pre">nodemailer</span></code> (GMail-based example):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">"Emailer"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">"type"</span>               <span class="p">:</span> <span class="s2">"nodemailer"</span><span class="p">,</span>
    <span class="s2">"emailFrom"</span>          <span class="p">:</span> <span class="s2">"CCP4 Cloud &lt;name@gmail.com&gt;"</span><span class="p">,</span>
    <span class="s2">"maintainerEmail"</span>    <span class="p">:</span> <span class="s2">"name@gmail.com"</span><span class="p">,</span>
    <span class="s2">"host"</span>               <span class="p">:</span> <span class="s2">"smtp.gmail.com"</span><span class="p">,</span>
    <span class="s2">"port"</span>               <span class="p">:</span> <span class="mi">465</span><span class="p">,</span>
    <span class="s2">"secure"</span>             <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">"auth"</span>               <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"user"</span> <span class="p">:</span> <span class="s2">"name@gmail.com"</span><span class="p">,</span>
        <span class="s2">"pass"</span> <span class="p">:</span> <span class="s2">"insecure-password"</span>
        <span class="s2">"file"</span> <span class="p">:</span> <span class="s2">"path-to-file-with-userId-and-password-space-separated"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where <strong>auth</strong> should contain either <strong>user</strong> and <strong>pass</strong> or <strong>file</strong> but not both.</p>
<p>Configuration</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">"Emailer"</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"desktop"</span> <span class="p">}</span>
</pre></div>
</div>
<p>will put content of e-mails in <strong>NC’s</strong> log files and display in user’s browser (when appropriate). Configuration</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">"Emailer"</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"none"</span> <span class="p">}</span>
</pre></div>
</div>
<p>will switch the e-mailer off.</p>
</dd>
</dl>


<span id="appendix-c"></span><h2 id="appendix-c-adjusting-configuration-file-for-the-front-end-server">Appendix C. Adjusting configuration file for the Front-End Server<a class="headerlink" href="#appendix-c-adjusting-configuration-file-for-the-front-end-server" title="Permalink to this headline">¶</a></h2>
<p>Below is an <em>excerpt</em> of <strong>FE</strong> configuration settings that must be revised. Other settings are for fine tuning and development, and can be left as is in most cases. Please refer to <a class="reference internal" href="configuration.html#ccp4-cloud-configuration"><span class="std std-ref">CCP4 Cloud configuration reference</span></a> for more details :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

    <span class="s2">"FrontEnd"</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"description"</span>      <span class="p">:</span> <span class="p">{</span>
            <span class="s2">"id"</span>   <span class="p">:</span> <span class="s2">"ccp4-cloud-instance-id"</span><span class="p">,</span>
            <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"CCP4 Cloud at my site"</span><span class="p">,</span>
            <span class="s2">"icon"</span> <span class="p">:</span> <span class="s2">"images_com/setup-harwell.png"</span>
        <span class="p">},</span>
        <span class="s2">"port"</span>             <span class="p">:</span> <span class="mi">8085</span><span class="p">,</span>
        <span class="s2">"externalURL"</span>      <span class="p">:</span> <span class="s2">"https://www.mysite.com/ccp4cloud"</span><span class="p">,</span>
        <span class="s2">"reportURL"</span>        <span class="p">:</span> <span class="s2">"https://www.mysite.com/ccp4cloud/"</span><span class="p">,</span>
        <span class="s2">"userDataPath"</span>     <span class="p">:</span> <span class="s2">"/path/to/disk1/users"</span><span class="p">,</span>
        <span class="s2">"storage"</span>          <span class="p">:</span> <span class="s2">"/path/to/disk1/projects"</span><span class="p">,</span>
        <span class="s2">"projectsPath"</span>     <span class="p">:</span> <span class="p">{</span>
            <span class="s2">"disk1"</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">"path"</span>        <span class="p">:</span> <span class="s2">"/path/to/disk1/projects"</span><span class="p">,</span>
                      <span class="p">},</span>
            <span class="s2">"disk2"</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">"path"</span>        <span class="p">:</span> <span class="s2">"/path/to/disk2/projects"</span><span class="p">,</span>
                      <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">"jobs_safe"</span>        <span class="p">:</span> <span class="p">{</span>
            <span class="s2">"path"</span>     <span class="p">:</span> <span class="s2">"/path/to/job_safe"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">"facilitiesPath"</span>   <span class="p">:</span> <span class="s2">"/path/to/disk1/facilities"</span><span class="p">,</span>
        <span class="s2">"regMode"</span>          <span class="p">:</span> <span class="s2">"admin"</span><span class="p">,</span>
        <span class="s2">"cloud_mounts"</span>     <span class="p">:</span> <span class="p">{</span>
            <span class="s2">"xtal-data"</span>      <span class="p">:</span> <span class="s2">"/path/to/data"</span><span class="p">,</span>
            <span class="s2">"tutorial-data"</span>  <span class="p">:</span> <span class="s2">"/path/to/tutorials"</span>
        <span class="p">},</span>
        <span class="s2">"logflow"</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">"log_file"</span>     <span class="p">:</span> <span class="s2">"/path/to/FE/logs/node_fe"</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="s2">"NumberCrunchers"</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"serNo"</span>            <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"serNo"</span>            <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">],</span>

    <span class="s2">"Emailer"</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"type"</span>            <span class="p">:</span> <span class="s2">"telnet"</span><span class="p">,</span>
        <span class="s2">"emailFrom"</span>       <span class="p">:</span> <span class="s2">"name@mysite.com"</span><span class="p">,</span>
        <span class="s2">"maintainerEmail"</span> <span class="p">:</span> <span class="s2">"name@mysite.com"</span><span class="p">,</span>
        <span class="s2">"host"</span>            <span class="p">:</span> <span class="s2">"mail.server.at.mysite.com"</span><span class="p">,</span>
        <span class="s2">"port"</span>            <span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
        <span class="s2">"headerFrom"</span>      <span class="p">:</span> <span class="s2">"CCP4 Cloud &lt;name@mysite.com&gt;"</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">have all <strong>NC(s)</strong> configured first and copy-paste their configurations in the <strong>NumberCrunchers</strong> list (<em>cf.</em> template provided), then only change <strong>serNo</strong> fields as shown above</p>
</div>
<dl class="docutils">
<dt><strong>description</strong></dt><dd>this serves your CCP4 Cloud instance identification. <strong>id</strong> is reserved for possible use in future, just put something unique, <strong>name</strong> is used to decorate some output pages, <strong>icon</strong> can specify path to custom setup icon. The path provided in template can also be used.</dd>
<dt><strong>port</strong></dt><dd>port number on <em>localhost</em>. The port should be used exclusively for the <strong>FE</strong></dd>
<dt><strong>externalURL</strong></dt><dd>this is a DNS-resolved URL for accessing <strong>FE</strong> by users and <strong>NC(s)</strong></dd>
<dt><strong>reportURL</strong></dt><dd>in most cases, this should coincide with <strong>externalURL</strong> (however note the trailing slash). Different <strong>reportURL</strong> is used in rare instances when CCP4 Cloud servers are accessed through layers of proxies and redirections</dd>
<dt><strong>userDataPath</strong></dt><dd>path to directory for user data (in this document referenced as <code class="docutils literal notranslate"><span class="pre">/path/to/disk1/users</span></code>)</dd>
<dt><strong>storage</strong></dt><dd>path to directory for miscellaneous items, which must coincide with <code class="docutils literal notranslate"><span class="pre">projects</span></code> directory on one of disks (<code class="docutils literal notranslate"><span class="pre">/path/to/disk1/projects</span></code>)</dd>
<dt><strong>projectsPath</strong></dt><dd><p>at least one disk for user projects must be configured:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">"projectsPath"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">"disk1"</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">"path"</span>        <span class="p">:</span> <span class="s2">"/path/to/disk1/projects"</span><span class="p">,</span>
                <span class="s2">"type"</span>        <span class="p">:</span> <span class="s2">"volume"</span><span class="p">,</span>
                <span class="s2">"diskReserve"</span> <span class="p">:</span> <span class="mi">10000</span>
            <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">"disk1"</span></code> is the logical disk name, which can be chosen arbitrarily. Disk names cannot be changed once user accounts are created</p>
</dd>
<dt><strong>jobs_safe</strong></dt><dd>this is disk area for retaining working directories for failed jobs. In <strong>FE</strong> configuration, it should be given only if <strong>NC</strong> configurations place it in a shared file system</dd>
<dt><strong>facilitiesPath</strong></dt><dd><p>this item is a rudimental item but still needed. Put this directory on <code class="docutils literal notranslate"><span class="pre">"disk1"</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">"facilitiesPath"</span>   <span class="p">:</span> <span class="s2">"/path/to/disk1/facilities"</span>
</pre></div>
</div>
</dd>
<dt><strong>regMode</strong></dt><dd>can be either <code class="docutils literal notranslate"><span class="pre">"admin"</span></code> or <code class="docutils literal notranslate"><span class="pre">"email"</span></code>. In <code class="docutils literal notranslate"><span class="pre">"admin"</span></code> mode, new users can be registered only by CCP4 Cloud administrator. In <code class="docutils literal notranslate"><span class="pre">"email"</span></code> mode, new users can register by themselves using their e-mail for verification.</dd>
<dt><strong>cloud_mounts</strong></dt><dd><p>this optional configuration sets logical names for directories with read-only data for user projects. In the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">"cloud_mounts"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">"xtal-data"</span>  <span class="p">:</span> <span class="s2">"/path/to/data"</span>
<span class="p">}</span>
</pre></div>
</div>
<p>users will see files in <code class="docutils literal notranslate"><span class="pre">/path/to/data</span></code> as <code class="docutils literal notranslate"><span class="pre">/xtal-data</span></code> . Configuration may be made user-specific. For example, in case</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">"cloud_mounts"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">"xtal-data"</span>  <span class="p">:</span> <span class="s2">"/path/to/$LOGIN/data"</span>
<span class="p">}</span>
</pre></div>
</div>
<p>user with login <code class="docutils literal notranslate"><span class="pre">ccp4cat</span></code> will see directory <code class="docutils literal notranslate"><span class="pre">/path/to/ccp4cat/data</span></code> as <code class="docutils literal notranslate"><span class="pre">/xtal-data</span></code>.</p>
</dd>
<dt><strong>log_file</strong></dt><dd>this is optional but useful configuration, which is used to split excessively long log files in chunks.</dd>
<dt><strong>Emailer</strong></dt><dd>this configuration is the same as in <a class="reference internal" href="#ccp4-cloud-emailer"><span class="std std-ref">case of NC</span></a>.</dd>
</dl>


<span id="appendix-d"></span><h2 id="appendix-d-adjusting-start-script-for-number-cruncher-servers">Appendix D. Adjusting start script for Number Cruncher Servers<a class="headerlink" href="#appendix-d-adjusting-start-script-for-number-cruncher-servers" title="Permalink to this headline">¶</a></h2>
<p>Replace paths in the following lines of the provided <strong>NC</strong> start script (<code class="docutils literal notranslate"><span class="pre">/path/to/NC/start-nc.sh</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccp4_dir</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">CCP4</span><span class="o">/</span><span class="n">ccp4</span><span class="o">-</span><span class="mf">7.1</span>
<span class="n">nc_dir</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">NC</span>
<span class="n">export</span> <span class="n">PDB_DIR</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">pdb</span>
<span class="n">export</span> <span class="n">PDB_SEQDB</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">pdb</span><span class="o">/</span><span class="n">derived_data</span><span class="o">/</span><span class="n">pdb_seqres</span><span class="o">.</span><span class="n">txt</span>
<span class="n">export</span> <span class="n">AFDB_SEQDB</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">afdb</span><span class="o">/</span><span class="n">sequences</span><span class="o">.</span><span class="n">fasta</span>
</pre></div>
</div>
<p><strong>PDB_DIR</strong> is the local location of a pdb mirror, <strong>PDB_SEQDB</strong> is the sequence listings for the full set of pdb entries (available to download from the PDB <a class="reference external" href="https://files.wwpdb.org/pub/pdb/derived_data/" rel="noopener noreferrer" target="_blank">ftp area</a>) and <strong>AFDB_SEQDB</strong> is the sequence listings for the full set of entries in the EBI AlphaFold Database (also available to download from the EBI-AFDB <a class="reference external" href="https://ftp.ebi.ac.uk/pub/databases/alphafold/" rel="noopener noreferrer" target="_blank">ftp area</a>)</p>


<span id="appendix-e"></span><h2 id="appendix-e-adjusting-start-script-for-the-front-end-server">Appendix E. Adjusting start script for the Front-End Server<a class="headerlink" href="#appendix-e-adjusting-start-script-for-the-front-end-server" title="Permalink to this headline">¶</a></h2>
<p>Replace paths in the following lines of the provided <strong>FE</strong> start script (<code class="docutils literal notranslate"><span class="pre">/path/to/FE/start-fe.sh</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccp4_dir</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">CCP4</span><span class="o">/</span><span class="n">ccp4</span><span class="o">-</span><span class="mf">7.1</span>
<span class="n">fe_dir</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span>
<span class="n">export</span> <span class="n">PDB_DIR</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">pdb</span>
<span class="n">export</span> <span class="n">PDB_SEQDB</span><span class="o">=/</span><span class="n">data1</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">pdb_derived_data</span><span class="o">/</span><span class="n">pdb_seqres</span><span class="o">.</span><span class="n">txt</span>
<span class="n">export</span> <span class="n">AFDB_SEQDB</span><span class="o">=/</span><span class="n">data1</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">afdb</span><span class="o">/</span><span class="n">sequences</span><span class="o">.</span><span class="n">fasta</span>
</pre></div>
</div>


<span id="appendix-f"></span><h2 id="appendix-f-adjusting-apache-configuration-on-host-machines">Appendix F. Adjusting Apache configuration on host machines<a class="headerlink" href="#appendix-f-adjusting-apache-configuration-on-host-machines" title="Permalink to this headline">¶</a></h2>
<p>CCP4 Cloud’s Front-End Server listens to the specified port of the <em>localhost</em> service running on their host machines. External requests from users must be redirected to that port. In order to do that:</p>
<ol class="arabic">
<li><p class="first">Note the port number and <code class="docutils literal notranslate"><span class="pre">externalURL's</span></code> path in <strong>FE</strong> <a class="reference internal" href="#appendix-c"><span class="std std-ref">configuration</span></a>. In this document, the suggested values are <code class="docutils literal notranslate"><span class="pre">8085</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;=ccp4cloud</span></code>, respectively.</p>
</li>
<li><p class="first">Identify site directory of your Apache setup. In Debian-based systems, this is typically <code class="docutils literal notranslate"><span class="pre">apache_site_dir=/etc/apache2/sites-enabled</span></code>, and in Redhat-based systems <code class="docutils literal notranslate"><span class="pre">apache_site_dir=/etc/httpd/conf.d</span></code></p>
</li>
<li><p class="first">Edit and install the provided template configuration module for Apache:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span><span class="o">/</span><span class="n">ccp4cloud</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">apache</span><span class="o">.</span><span class="n">conf</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span><span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;.</span><span class="n">conf</span>
<span class="c1"># in &lt;path&gt;.conf, replace all occurrences of:</span>
<span class="c1">#      '0000'  for the selected port number</span>
<span class="c1">#      'path'  for the chosen URL path ('&lt;path&gt;')</span>
<span class="n">vi</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span><span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;.</span><span class="n">conf</span>
<span class="n">sudo</span> <span class="n">cp</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">tmp</span><span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;.</span><span class="n">conf</span> <span class="n">apache_site_dir</span><span class="o">/</span>
</pre></div>
</div>
</li>
</ol>
<p>For example, for port number and <strong>FE</strong> URL path used in this document, <code class="docutils literal notranslate"><span class="pre">apache_site_dir</span></code> should receive file <code class="docutils literal notranslate"><span class="pre">ccp4cloud.conf</span></code> with the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Proxy</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8085</span><span class="o">/*&gt;</span>
  <span class="n">Allow</span> <span class="kn">from</span> <span class="nn">all</span>
<span class="o">&lt;/</span><span class="n">Proxy</span><span class="o">&gt;</span>

<span class="n">ProxyRequests</span> <span class="n">Off</span>
<span class="n">ProxyPass</span> <span class="o">/</span><span class="n">ccp4cloud</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8085</span>
<span class="n">SetOutputFilter</span> <span class="n">INFLATE</span><span class="p">;</span><span class="n">proxy</span><span class="o">-</span><span class="n">html</span><span class="p">;</span><span class="n">DEFLATE</span>
<span class="n">ProxyHTMLURLMap</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8085</span> <span class="o">/</span><span class="n">ccp4cloud</span>
<span class="n">LogLevel</span> <span class="n">Info</span>
<span class="n">ProxyPassReverse</span> <span class="o">/</span><span class="n">ccp4cloud</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8085</span>
</pre></div>
</div>
<ol class="arabic" start="4">
<li><p class="first">Restart Apache:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apachectl</span> <span class="n">stop</span>
<span class="n">sudo</span> <span class="n">apachectl</span> <span class="n">start</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">at this point, Apache may refuse to start if modules, required for the redirection, were not installed. Should this happen, inspect the error message and install the missing modules. Typically, <code class="docutils literal notranslate"><span class="pre">mod_proxy</span></code> and <code class="docutils literal notranslate"><span class="pre">mod_proxy_http</span></code> are missing.</p>
</div>
<p><strong>Apache configuration for Number Cruncher Server</strong></p>
<p>If <strong>NC</strong> is placed on a host machine, different from <strong>FE’s</strong> host, then DNS-resolved <code class="docutils literal notranslate"><span class="pre">externalURL</span></code> should be specified in its configuration, and the corresponding redirection module provided for it, in exactly the same fashion as above.</p>


<span id="appendix-g"></span><h2 id="appendix-g-tests-and-checks">Appendix G. Tests and checks<a class="headerlink" href="#appendix-g-tests-and-checks" title="Permalink to this headline">¶</a></h2>
<p>After starting CCP4 Cloud and Apache servers:</p>
<ol class="arabic">
<li><p class="first">Check <strong>FE</strong> and <strong>NC’s</strong> log files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">path</span><span class="o">.</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">node_fe</span><span class="o">.</span><span class="n">err</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">path</span><span class="o">.</span><span class="n">to</span><span class="o">/</span><span class="n">FE</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">node_fe</span><span class="o">.</span><span class="n">log</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">path</span><span class="o">.</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">node_nc</span><span class="o">.</span><span class="n">err</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">path</span><span class="o">.</span><span class="n">to</span><span class="o">/</span><span class="n">NC1</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">node_nc</span><span class="o">.</span><span class="n">log</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">path</span><span class="o">.</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">node_nc</span><span class="o">.</span><span class="n">err</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">path</span><span class="o">.</span><span class="n">to</span><span class="o">/</span><span class="n">NC2</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">node_nc</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
</li>
</ol>
<p>Normal content of <code class="docutils literal notranslate"><span class="pre">*.err</span></code> logs may contain</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span><span class="p">:</span> <span class="mi">1</span><span class="p">:</span> <span class="n">kill</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">processError</span><span class="p">:</span>
</pre></div>
</div>
<p>anything else indicates a problem. A message similar to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">listen</span> <span class="n">EADDRINUSE</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8085</span>
</pre></div>
</div>
<p>may mean that the selected <em>localhost</em> port is used by another process running on the host machine. Messages similar to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">EBUSY</span><span class="p">:</span> <span class="n">resource</span> <span class="n">busy</span> <span class="ow">or</span> <span class="n">locked</span>
<span class="n">Error</span><span class="p">:</span> <span class="n">ENOENT</span><span class="p">:</span> <span class="n">no</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
</pre></div>
</div>
<p>indicate problems with file systems or with directory specifications in CCP4 Cloud’s configuration files and/or start scripts. Errors are complemented with code trace, which may help a developer to identify the exact problem. Therefore, please include code traces in the respective communications.</p>
<p>If <strong>FE</strong> server starts normally, its <code class="docutils literal notranslate"><span class="pre">*.log</span></code> file should start with messages similar to the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span><span class="p">:</span> <span class="n">line</span> <span class="mi">0</span><span class="p">:</span> <span class="n">kill</span><span class="p">:</span> <span class="p">(</span><span class="mi">2982</span><span class="p">)</span> <span class="o">-</span> <span class="n">No</span> <span class="n">such</span> <span class="n">process</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.226</span><span class="n">Z</span><span class="p">]</span> <span class="mi">14</span><span class="o">-</span><span class="mi">001</span> <span class="o">+++</span> <span class="n">cannot</span> <span class="n">kill</span> <span class="n">process</span> <span class="n">pid</span><span class="o">=</span><span class="mi">2982</span>
<span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span><span class="p">:</span> <span class="n">line</span> <span class="mi">0</span><span class="p">:</span> <span class="n">kill</span><span class="p">:</span> <span class="p">(</span><span class="mi">2994</span><span class="p">)</span> <span class="o">-</span> <span class="n">No</span> <span class="n">such</span> <span class="n">process</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.232</span><span class="n">Z</span><span class="p">]</span> <span class="mi">14</span><span class="o">-</span><span class="mi">001</span> <span class="o">+++</span> <span class="n">cannot</span> <span class="n">kill</span> <span class="n">process</span> <span class="n">pid</span><span class="o">=</span><span class="mi">2994</span>
<span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span><span class="p">:</span> <span class="n">line</span> <span class="mi">0</span><span class="p">:</span> <span class="n">kill</span><span class="p">:</span> <span class="p">(</span><span class="mi">2995</span><span class="p">)</span> <span class="o">-</span> <span class="n">No</span> <span class="n">such</span> <span class="n">process</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.237</span><span class="n">Z</span><span class="p">]</span> <span class="mi">14</span><span class="o">-</span><span class="mi">001</span> <span class="o">+++</span> <span class="n">cannot</span> <span class="n">kill</span> <span class="n">process</span> <span class="n">pid</span><span class="o">=</span><span class="mi">2995</span>
<span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span><span class="p">:</span> <span class="n">line</span> <span class="mi">0</span><span class="p">:</span> <span class="n">kill</span><span class="p">:</span> <span class="p">(</span><span class="mi">2982</span><span class="p">)</span> <span class="o">-</span> <span class="n">No</span> <span class="n">such</span> <span class="n">process</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.241</span><span class="n">Z</span><span class="p">]</span> <span class="mi">14</span><span class="o">-</span><span class="mi">001</span> <span class="o">+++</span> <span class="n">cannot</span> <span class="n">kill</span> <span class="n">process</span> <span class="n">pid</span><span class="o">=</span><span class="mi">2982</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.250</span><span class="n">Z</span><span class="p">]</span> <span class="mi">03</span><span class="o">-</span><span class="mi">005</span> <span class="o">...</span> <span class="n">python</span> <span class="n">version</span><span class="p">:</span> <span class="n">ccp4</span><span class="o">-</span><span class="n">python</span> <span class="ow">not</span> <span class="n">found</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.295</span><span class="n">Z</span><span class="p">]</span> <span class="mi">03</span><span class="o">-</span><span class="mi">001</span> <span class="o">...</span> <span class="n">FE</span><span class="p">:</span> <span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8081</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.296</span><span class="n">Z</span><span class="p">]</span> <span class="mi">03</span><span class="o">-</span><span class="mi">001</span> <span class="o">...</span> <span class="n">FE</span><span class="o">-</span><span class="n">Proxy</span><span class="p">:</span> <span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8085</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.296</span><span class="n">Z</span><span class="p">]</span> <span class="mi">03</span><span class="o">-</span><span class="mi">002</span> <span class="o">...</span> <span class="n">NC</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">name</span><span class="o">=</span><span class="n">local</span><span class="o">-</span><span class="n">nc</span> <span class="nb">type</span><span class="o">=</span><span class="n">SHELL</span> <span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8083</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.296</span><span class="n">Z</span><span class="p">]</span> <span class="mi">03</span><span class="o">-</span><span class="mi">002</span> <span class="o">...</span> <span class="n">NC</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">name</span><span class="o">=</span><span class="n">client</span> <span class="nb">type</span><span class="o">=</span><span class="n">CLIENT</span> <span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8084</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.299</span><span class="n">Z</span><span class="p">]</span> <span class="mi">03</span><span class="o">-</span><span class="mi">003</span> <span class="o">...</span> <span class="n">configuration</span> <span class="n">written</span> <span class="n">to</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">zf</span><span class="o">/</span><span class="mi">9</span><span class="n">_j6y85s4l743fzs2py3gztc0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">tmp</span><span class="o">-</span><span class="mi">8053</span><span class="n">T07Ej39eTIQ7</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.302</span><span class="n">Z</span><span class="p">]</span> <span class="mi">23</span><span class="o">-</span><span class="mi">003</span> <span class="o">...</span> <span class="n">server</span> <span class="n">local</span><span class="o">-</span><span class="n">nc</span> <span class="n">started</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="mi">8063</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.303</span><span class="n">Z</span><span class="p">]</span> <span class="mi">23</span><span class="o">-</span><span class="mi">003</span> <span class="o">...</span> <span class="n">server</span> <span class="n">client</span> <span class="n">started</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="mi">8064</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.304</span><span class="n">Z</span><span class="p">]</span> <span class="mi">00</span><span class="o">-</span><span class="mi">001</span> <span class="o">...</span> <span class="n">FE</span><span class="p">:</span> <span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8081</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.304</span><span class="n">Z</span><span class="p">]</span> <span class="mi">00</span><span class="o">-</span><span class="mi">002</span> <span class="o">...</span> <span class="n">NC</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">type</span><span class="o">=</span><span class="n">SHELL</span> <span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8083</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.304</span><span class="n">Z</span><span class="p">]</span> <span class="mi">00</span><span class="o">-</span><span class="mi">002</span> <span class="o">...</span> <span class="n">NC</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">type</span><span class="o">=</span><span class="n">CLIENT</span> <span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8084</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.304</span><span class="n">Z</span><span class="p">]</span> <span class="mi">00</span><span class="o">-</span><span class="mi">003</span> <span class="o">...</span> <span class="n">Emailer</span><span class="p">:</span> <span class="n">desktop</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.307</span><span class="n">Z</span><span class="p">]</span> <span class="mi">00</span><span class="o">-</span><span class="mi">005</span> <span class="o">...</span> <span class="n">front</span><span class="o">-</span><span class="n">end</span> <span class="n">started</span><span class="p">,</span> <span class="n">listening</span> <span class="n">to</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8081</span> <span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">exclusive</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.307</span><span class="n">Z</span><span class="p">]</span> <span class="mi">22</span><span class="o">-</span><span class="mi">001</span> <span class="o">...</span> <span class="n">setting</span> <span class="n">up</span> <span class="n">proxy</span> <span class="k">for</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8081</span> <span class="n">localhost</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.308</span><span class="n">Z</span><span class="p">]</span> <span class="mi">22</span><span class="o">-</span><span class="mi">002</span> <span class="o">...</span> <span class="n">setting</span> <span class="n">up</span> <span class="n">proxy</span> <span class="k">for</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8084</span> <span class="n">localhost</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.308</span><span class="n">Z</span><span class="p">]</span> <span class="mi">22</span><span class="o">-</span><span class="mi">003</span> <span class="o">...</span> <span class="n">front</span><span class="o">-</span><span class="n">end</span> <span class="n">proxy</span> <span class="n">started</span><span class="p">,</span> <span class="n">listening</span> <span class="n">to</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8085</span> <span class="p">(</span><span class="n">exclusive</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.310</span><span class="n">Z</span><span class="p">]</span> <span class="mi">23</span><span class="o">-</span><span class="mi">005</span> <span class="o">...</span> <span class="n">client</span> <span class="n">application</span> <span class="s2">"/bin/bash -c 'open -a Opera http://localhost:8085'"</span> <span class="n">started</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="mi">8065</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.425</span><span class="n">Z</span><span class="p">]</span> <span class="mi">23</span><span class="o">-</span><span class="mi">006</span> <span class="o">...</span> <span class="n">client</span> <span class="n">application</span> <span class="s2">"/bin/bash -c 'open -a Opera http://localhost:8085'"</span> <span class="n">quit</span> <span class="k">with</span> <span class="n">code</span> <span class="mi">0</span>
</pre></div>
</div>
<p>and a normal <strong>NC</strong> log starts with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.722</span><span class="n">Z</span><span class="p">]</span> <span class="mi">01</span><span class="o">-</span><span class="mi">001</span> <span class="o">...</span> <span class="n">NC</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">type</span><span class="o">=</span><span class="n">SHELL</span> <span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8083</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.724</span><span class="n">Z</span><span class="p">]</span> <span class="mi">01</span><span class="o">-</span><span class="mi">002</span> <span class="o">...</span> <span class="n">Emailer</span><span class="p">:</span> <span class="n">desktop</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.726</span><span class="n">Z</span><span class="p">]</span> <span class="mi">11</span><span class="o">-</span><span class="mi">031</span> <span class="o">...</span> <span class="n">total</span> <span class="n">unassigned</span> <span class="n">job</span> <span class="n">tokens</span> <span class="n">removed</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.727</span><span class="n">Z</span><span class="p">]</span> <span class="mi">11</span><span class="o">-</span><span class="mi">033</span> <span class="o">...</span> <span class="n">total</span> <span class="n">abandoned</span> <span class="n">job</span> <span class="n">directories</span> <span class="n">removed</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.743</span><span class="n">Z</span><span class="p">]</span> <span class="mi">01</span><span class="o">-</span><span class="mi">007</span> <span class="o">...</span> <span class="n">number</span> <span class="n">cruncher</span> <span class="c1">#0 started, listening to http://localhost:8083 (exclusive)</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="n">T12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">30.743</span><span class="n">Z</span><span class="p">]</span> <span class="mi">03</span><span class="o">-</span><span class="mi">005</span> <span class="o">...</span> <span class="n">python</span> <span class="n">version</span><span class="p">:</span> <span class="n">ccp4</span><span class="o">-</span><span class="n">python</span> <span class="ow">not</span> <span class="n">found</span>
</pre></div>
</div>
<p>In these logs, triple dots <code class="docutils literal notranslate"><span class="pre">...</span></code> denote messages that are merely informative, triple stars <code class="docutils literal notranslate"><span class="pre">***</span></code> highlight warnings and triple pluses <code class="docutils literal notranslate"><span class="pre">+++</span></code> indicate errors (which are not fatal in most cases; fatal errors are usually found in <code class="docutils literal notranslate"><span class="pre">*.err</span></code> logs). The above logs are copied from a perfectly functional system, despite confusing errors on the very top and unspecified python versions.</p>
<ol class="arabic" start="2">
<li><p class="first">Poll all <em>localhost</em> ports from their host machines, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8085</span><span class="o">/</span><span class="n">whoareyou</span>
</pre></div>
</div>
</li>
</ol>
<p>For the Front-End, the answer should be something like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CCP4</span> <span class="n">Cloud</span> <span class="n">FE</span> <span class="mf">1.6</span><span class="o">.</span><span class="mi">016</span> <span class="p">[</span><span class="mf">26.10</span><span class="o">.</span><span class="mi">2020</span><span class="p">]</span> <span class="n">CCP4</span><span class="o">-</span><span class="mf">7.1</span><span class="o">.</span><span class="mi">006</span>
</pre></div>
</div>
<p>and Number Crunchers should reply</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CCP4</span> <span class="n">Cloud</span> <span class="n">NC</span><span class="o">-</span><span class="mi">0</span> <span class="p">(</span><span class="n">local</span><span class="o">-</span><span class="n">nc</span><span class="p">)</span> <span class="mf">1.6</span><span class="o">.</span><span class="mi">016</span> <span class="p">[</span><span class="mf">26.10</span><span class="o">.</span><span class="mi">2020</span><span class="p">]</span> <span class="mi">0</span>
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p class="first">If <em>localhost</em> ports reply as above, repeat the same requests using respective <code class="docutils literal notranslate"><span class="pre">externalURLs</span></code> from configuration files, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">mysite</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ccp4cloud</span><span class="o">/</span><span class="n">whoareyou</span>
</pre></div>
</div>
</li>
<li><p class="first">If all replies are sensible, start CCP4 Cloud login page in browser, using <code class="docutils literal notranslate"><span class="pre">reportURL</span></code> from <strong>FE</strong> configuration, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">firefox</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">mysite</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ccp4cloud</span><span class="o">/</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">trailing slash is significant</p>
</div>
<ol class="arabic simple" start="5">
<li>Use login name <code class="docutils literal notranslate"><span class="pre">devel</span></code> and password <code class="docutils literal notranslate"><span class="pre">devel</span></code> for the first login. You should land in empty project list, where you can create first project and run a few jobs (e.g., <em>Data Import</em>) in it.</li>
</ol>


<span id="appendix-h"></span><h2 id="appendix-h-creating-1st-user-with-administrative-privileges">Appendix H. Creating 1st user with administrative privileges<a class="headerlink" href="#appendix-h-creating-1st-user-with-administrative-privileges" title="Permalink to this headline">¶</a></h2>
<p>Admin user account is essential for CCP4 Cloud maintenance. By default, CCP4 Cloud is installed with <code class="docutils literal notranslate"><span class="pre">devel</span></code> user, which cannot be removed. Admin users can grant admin privileges to any other user, but 1st Admin must be created manually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">devel</span><span class="o">.</span><span class="n">user</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">admin</span><span class="o">.</span><span class="n">user</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk1</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">devel</span><span class="o">.</span><span class="n">projects</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk1</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">admin</span><span class="o">.</span><span class="n">projects</span>

<span class="c1"># in /path/to/disk1/users/admin.user, edit:</span>
<span class="c1">#        "name"  : "Admin"</span>
<span class="c1">#        "email" : "your@email"</span>
<span class="c1">#        "login" : "admin"</span>
<span class="c1">#        "role"  : "admin"</span>
<span class="n">vi</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">disk1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">admin</span><span class="o">.</span><span class="n">user</span>
</pre></div>
</div>
<p>After this, go to CCP4 Cloud login page, and login as <code class="docutils literal notranslate"><span class="pre">admin</span></code> with password <code class="docutils literal notranslate"><span class="pre">devel</span></code>. After login, proceed to <em>My Account</em> and change password to your liking.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">for security purposes, change password for <code class="docutils literal notranslate"><span class="pre">devel</span></code> user promptly.</p>
</div>




          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.0.1.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>